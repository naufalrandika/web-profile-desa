!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mapbox-gl")):"function"==typeof define&&define.amd?define(["exports","mapbox-gl"],t):t((e=e||self).L7={},e.mapboxgl)}(this,(function(e,t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var n={},r={},i=function(e){return r[e]},o=function(e,t){r[e]=t},a=function(e,t){n[e]=t},s={},u={};function c(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function l(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function h(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function f(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+h(-e,6):e>9999?"+"+h(e,6):h(e,4)}(e.getUTCFullYear())+"-"+h(e.getUTCMonth()+1,2)+"-"+h(e.getUTCDate(),2)+(i?"T"+h(t,2)+":"+h(n,2)+":"+h(r,2)+"."+h(i,3)+"Z":r?"T"+h(t,2)+":"+h(n,2)+":"+h(r,2)+"Z":n||t?"T"+h(t,2)+":"+h(n,2)+"Z":"")}var p=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],o=e.length,a=0,c=0,l=o<=0,h=!1;function f(){if(l)return u;if(h)return h=!1,s;var t,r,i=a;if(34===e.charCodeAt(i)){for(;a++<o&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=o?l=!0:10===(r=e.charCodeAt(a++))?h=!0:13===r&&(h=!0,10===e.charCodeAt(a)&&++a),e.slice(i+1,t-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=e.charCodeAt(t=a++)))h=!0;else if(13===r)h=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(i,t)}return l=!0,e.slice(i,o)}for(10===e.charCodeAt(o-1)&&--o,13===e.charCodeAt(o-1)&&--o;(r=f())!==u;){for(var p=[];r!==s&&r!==u;)p.push(r),r=f();t&&null==(p=t(p,c++))||i.push(p)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function o(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?f(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,o=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=c(e);return function(r,i){return t(n(r),i,e)}}(e,t):c(e)}));return o.columns=i||[],o},parseRows:r,format:function(t,n){return null==n&&(n=l(t)),[n.map(a).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=l(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(o).join("\n")},formatRow:o,formatValue:a}}(",").parse;function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(){g=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),s=new T(i||[]);return r(a,"_invoke",{value:S(e,n,s)}),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h={};function f(){}function p(){}function d(){}var v={};u(v,o,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(C([])));y&&y!==t&&n.call(y,o)&&(v=y);var _=d.prototype=f.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){var i;r(this,"_invoke",{value:function(r,o){function a(){return new t((function(i,a){!function r(i,o,a,s){var u=l(e[i],e,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(h).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,s)}))}s(u.arg)}(r,o,i,a)}))}return i=i?i.then(a,a):a()}})}function S(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return k()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function E(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=d,r(_,"constructor",{value:d,configurable:!0}),r(d,"constructor",{value:p,configurable:!0}),p.displayName=u(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,u(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},b(x.prototype),u(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new x(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(_),u(_,s,"Generator"),u(_,o,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=C,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;w(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function _(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){y(o,r,i,a,s,"next",e)}function s(e){y(o,r,i,a,s,"throw",e)}a(void 0)}))}}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,j(r.key),r)}}function S(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function E(e,t,n){return(t=j(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function C(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function k(e,t,n){return(k=C()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&T(i,n.prototype),i}).apply(null,arguments)}function M(e){var t="function"==typeof Map?new Map:void 0;return(M=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return k(e,arguments,w(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),T(r,e)})(e)}function P(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return I(e)}function O(e){var t=C();return function(){var n,r=w(e);if(t){var i=w(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return L(this,n)}}function R(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}function N(){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=R(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||B(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e){return function(e){if(Array.isArray(e))return z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||B(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){if(e){if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=B(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function j(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function V(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function G(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var H="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function W(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Y(e,t){return e(t={exports:{}},t.exports),t.exports}var X,Z,q=function(e){return e&&e.Math==Math&&e},K=q("object"==typeof globalThis&&globalThis)||q("object"==typeof window&&window)||q("object"==typeof self&&self)||q("object"==typeof H&&H)||function(){return this}()||H||Function("return this")(),Q=Object.defineProperty,$=function(e,t){try{Q(K,e,{value:t,configurable:!0,writable:!0})}catch(n){K[e]=t}return t},J=K["__core-js_shared__"]||$("__core-js_shared__",{}),ee=Y((function(e){(e.exports=function(e,t){return J[e]||(J[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"})})),te=function(e){try{return!!e()}catch(e){return!0}},ne=!te((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),re=Function.prototype,ie=re.call,oe=ne&&re.bind.bind(ie,ie),ae=ne?oe:function(e){return function(){return ie.apply(e,arguments)}},se=function(e){return null==e},ue=TypeError,ce=function(e){if(se(e))throw ue("Can't call method on "+e);return e},le=Object,he=function(e){return le(ce(e))},fe=ae({}.hasOwnProperty),pe=Object.hasOwn||function(e,t){return fe(he(e),t)},de=0,ve=Math.random(),ge=ae(1..toString),me=function(e){return"Symbol("+(void 0===e?"":e)+")_"+ge(++de+ve,36)},ye="undefined"!=typeof navigator&&String(navigator.userAgent)||"",_e=K.process,be=K.Deno,xe=_e&&_e.versions||be&&be.version,Se=xe&&xe.v8;Se&&(Z=(X=Se.split("."))[0]>0&&X[0]<4?1:+(X[0]+X[1])),!Z&&ye&&(!(X=ye.match(/Edge\/(\d+)/))||X[1]>=74)&&(X=ye.match(/Chrome\/(\d+)/))&&(Z=+X[1]);var Ee=Z,Ae=K.String,we=!!Object.getOwnPropertySymbols&&!te((function(){var e=Symbol();return!Ae(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ee&&Ee<41})),Te=we&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ce=K.Symbol,ke=ee("wks"),Me=Te?Ce.for||Ce:Ce&&Ce.withoutSetter||me,Pe=function(e){return pe(ke,e)||(ke[e]=we&&pe(Ce,e)?Ce[e]:Me("Symbol."+e)),ke[e]},Ie={};Ie[Pe("toStringTag")]="z";var Le="[object z]"===String(Ie),Oe="object"==typeof document&&document.all,Re={all:Oe,IS_HTMLDDA:void 0===Oe&&void 0!==Oe},Ne=Re.all,De=Re.IS_HTMLDDA?function(e){return"function"==typeof e||e===Ne}:function(e){return"function"==typeof e},Fe=!te((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Be=Re.all,ze=Re.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:De(e)||e===Be}:function(e){return"object"==typeof e?null!==e:De(e)},Ue=K.document,je=ze(Ue)&&ze(Ue.createElement),Ve=function(e){return je?Ue.createElement(e):{}},Ge=!Fe&&!te((function(){return 7!=Object.defineProperty(Ve("div"),"a",{get:function(){return 7}}).a})),He=Fe&&te((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),We=String,Ye=TypeError,Xe=function(e){if(ze(e))return e;throw Ye(We(e)+" is not an object")},Ze=Function.prototype.call,qe=ne?Ze.bind(Ze):function(){return Ze.apply(Ze,arguments)},Ke=function(e){return De(e)?e:void 0},Qe=function(e,t){return arguments.length<2?Ke(K[e]):K[e]&&K[e][t]},$e=ae({}.isPrototypeOf),Je=Object,et=Te?function(e){return"symbol"==typeof e}:function(e){var t=Qe("Symbol");return De(t)&&$e(t.prototype,Je(e))},tt=String,nt=function(e){try{return tt(e)}catch(e){return"Object"}},rt=TypeError,it=function(e){if(De(e))return e;throw rt(nt(e)+" is not a function")},ot=function(e,t){var n=e[t];return se(n)?void 0:it(n)},at=TypeError,st=TypeError,ut=Pe("toPrimitive"),ct=function(e,t){if(!ze(e)||et(e))return e;var n,r=ot(e,ut);if(r){if(void 0===t&&(t="default"),n=qe(r,e,t),!ze(n)||et(n))return n;throw st("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var n,r;if("string"===t&&De(n=e.toString)&&!ze(r=qe(n,e)))return r;if(De(n=e.valueOf)&&!ze(r=qe(n,e)))return r;if("string"!==t&&De(n=e.toString)&&!ze(r=qe(n,e)))return r;throw at("Can't convert object to primitive value")}(e,t)},lt=function(e){var t=ct(e,"string");return et(t)?t:t+""},ht=TypeError,ft=Object.defineProperty,pt=Object.getOwnPropertyDescriptor,dt={f:Fe?He?function(e,t,n){if(Xe(e),t=lt(t),Xe(n),"function"==typeof e&&"prototype"===t&&"value"in n&&"writable"in n&&!n.writable){var r=pt(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return ft(e,t,n)}:ft:function(e,t,n){if(Xe(e),t=lt(t),Xe(n),Ge)try{return ft(e,t,n)}catch(e){}if("get"in n||"set"in n)throw ht("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},vt=Function.prototype,gt=Fe&&Object.getOwnPropertyDescriptor,mt=pe(vt,"name"),yt={EXISTS:mt,PROPER:mt&&"something"===function(){}.name,CONFIGURABLE:mt&&(!Fe||Fe&&gt(vt,"name").configurable)},_t=ae(Function.toString);De(J.inspectSource)||(J.inspectSource=function(e){return _t(e)});var bt,xt,St,Et=J.inspectSource,At=K.WeakMap,wt=De(At)&&/native code/.test(String(At)),Tt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ct=Fe?function(e,t,n){return dt.f(e,t,Tt(1,n))}:function(e,t,n){return e[t]=n,e},kt=ee("keys"),Mt=function(e){return kt[e]||(kt[e]=me(e))},Pt={},It=K.TypeError,Lt=K.WeakMap;if(wt||J.state){var Ot=J.state||(J.state=new Lt);Ot.get=Ot.get,Ot.has=Ot.has,Ot.set=Ot.set,bt=function(e,t){if(Ot.has(e))throw It("Object already initialized");return t.facade=e,Ot.set(e,t),t},xt=function(e){return Ot.get(e)||{}},St=function(e){return Ot.has(e)}}else{var Rt=Mt("state");Pt[Rt]=!0,bt=function(e,t){if(pe(e,Rt))throw It("Object already initialized");return t.facade=e,Ct(e,Rt,t),t},xt=function(e){return pe(e,Rt)?e[Rt]:{}},St=function(e){return pe(e,Rt)}}var Nt={set:bt,get:xt,has:St,enforce:function(e){return St(e)?xt(e):bt(e,{})},getterFor:function(e){return function(t){var n;if(!ze(t)||(n=xt(t)).type!==e)throw It("Incompatible receiver, "+e+" required");return n}}},Dt=Y((function(e){var t=yt.CONFIGURABLE,n=Nt.enforce,r=Nt.get,i=String,o=Object.defineProperty,a=ae("".slice),s=ae("".replace),u=ae([].join),c=Fe&&!te((function(){return 8!==o((function(){}),"length",{value:8}).length})),l=String(String).split("String"),h=e.exports=function(e,r,h){"Symbol("===a(i(r),0,7)&&(r="["+s(i(r),/^Symbol\(([^)]*)\)/,"$1")+"]"),h&&h.getter&&(r="get "+r),h&&h.setter&&(r="set "+r),(!pe(e,"name")||t&&e.name!==r)&&(Fe?o(e,"name",{value:r,configurable:!0}):e.name=r),c&&h&&pe(h,"arity")&&e.length!==h.arity&&o(e,"length",{value:h.arity});try{h&&pe(h,"constructor")&&h.constructor?Fe&&o(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var f=n(e);return pe(f,"source")||(f.source=u(l,"string"==typeof r?r:"")),e};Function.prototype.toString=h((function(){return De(this)&&r(this).source||Et(this)}),"toString")})),Ft=function(e,t,n,r){r||(r={});var i=r.enumerable,o=void 0!==r.name?r.name:t;if(De(n)&&Dt(n,o,r),r.global)i?e[t]=n:$(t,n);else{try{r.unsafe?e[t]&&(i=!0):delete e[t]}catch(e){}i?e[t]=n:dt.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},Bt=ae({}.toString),zt=ae("".slice),Ut=function(e){return zt(Bt(e),8,-1)},jt=Pe("toStringTag"),Vt=Object,Gt="Arguments"==Ut(function(){return arguments}()),Ht=Le?Ut:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Vt(e),jt))?n:Gt?Ut(t):"Object"==(r=Ut(t))&&De(t.callee)?"Arguments":r},Wt=Le?{}.toString:function(){return"[object "+Ht(this)+"]"};Le||Ft(Object.prototype,"toString",Wt,{unsafe:!0});var Yt={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Xt=Ve("span").classList,Zt=Xt&&Xt.constructor&&Xt.constructor.prototype,qt=Zt===Object.prototype?void 0:Zt,Kt=function(e){if("Function"===Ut(e))return ae(e)},Qt=Kt(Kt.bind),$t=function(e,t){return it(e),void 0===t?e:ne?Qt(e,t):function(){return e.apply(t,arguments)}},Jt=Object,en=ae("".split),tn=te((function(){return!Jt("z").propertyIsEnumerable(0)}))?function(e){return"String"==Ut(e)?en(e,""):Jt(e)}:Jt,nn=Math.ceil,rn=Math.floor,on=Math.trunc||function(e){var t=+e;return(t>0?rn:nn)(t)},an=function(e){var t=+e;return t!=t||0===t?0:on(t)},sn=Math.min,un=function(e){return e>0?sn(an(e),9007199254740991):0},cn=function(e){return un(e.length)},ln=Array.isArray||function(e){return"Array"==Ut(e)},hn=function(){},fn=[],pn=Qe("Reflect","construct"),dn=/^\s*(?:class|function)\b/,vn=ae(dn.exec),gn=!dn.exec(hn),mn=function(e){if(!De(e))return!1;try{return pn(hn,fn,e),!0}catch(e){return!1}},yn=function(e){if(!De(e))return!1;switch(Ht(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return gn||!!vn(dn,Et(e))}catch(e){return!0}};yn.sham=!0;var _n=!pn||te((function(){var e;return mn(mn.call)||!mn(Object)||!mn((function(){e=!0}))||e}))?yn:mn,bn=Pe("species"),xn=Array,Sn=function(e,t){return new(function(e){var t;return ln(e)&&(t=e.constructor,(_n(t)&&(t===xn||ln(t.prototype))||ze(t)&&null===(t=t[bn]))&&(t=void 0)),void 0===t?xn:t}(e))(0===t?0:t)},En=ae([].push),An=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(u,c,l,h){for(var f,p,d=he(u),v=tn(d),g=$t(c,l),m=cn(v),y=0,_=h||Sn,b=t?_(u,m):n||a?_(u,0):void 0;m>y;y++)if((s||y in v)&&(p=g(f=v[y],y,d),e))if(t)b[y]=p;else if(p)switch(e){case 3:return!0;case 5:return f;case 6:return y;case 2:En(b,f)}else switch(e){case 4:return!1;case 7:En(b,f)}return o?-1:r||i?i:b}},wn={forEach:An(0),map:An(1),filter:An(2),some:An(3),every:An(4),find:An(5),findIndex:An(6),filterReject:An(7)},Tn=function(e,t){var n=[][e];return!!n&&te((function(){n.call(null,t||function(){return 1},1)}))},Cn=wn.forEach,kn=Tn("forEach")?[].forEach:function(e){return Cn(this,e,arguments.length>1?arguments[1]:void 0)},Mn=function(e){if(e&&e.forEach!==kn)try{Ct(e,"forEach",kn)}catch(t){e.forEach=kn}};for(var Pn in Yt)Yt[Pn]&&Mn(K[Pn]&&K[Pn].prototype);Mn(qt);var In={}.propertyIsEnumerable,Ln=Object.getOwnPropertyDescriptor,On={f:Ln&&!In.call({1:2},1)?function(e){var t=Ln(this,e);return!!t&&t.enumerable}:In},Rn=function(e){return tn(ce(e))},Nn=Object.getOwnPropertyDescriptor,Dn={f:Fe?Nn:function(e,t){if(e=Rn(e),t=lt(t),Ge)try{return Nn(e,t)}catch(e){}if(pe(e,t))return Tt(!qe(On.f,e,t),e[t])}},Fn=Math.max,Bn=Math.min,zn=function(e,t){var n=an(e);return n<0?Fn(n+t,0):Bn(n,t)},Un=function(e){return function(t,n,r){var i,o=Rn(t),a=cn(o),s=zn(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},jn={includes:Un(!0),indexOf:Un(!1)},Vn=jn.indexOf,Gn=ae([].push),Hn=function(e,t){var n,r=Rn(e),i=0,o=[];for(n in r)!pe(Pt,n)&&pe(r,n)&&Gn(o,n);for(;t.length>i;)pe(r,n=t[i++])&&(~Vn(o,n)||Gn(o,n));return o},Wn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Yn=Wn.concat("length","prototype"),Xn={f:Object.getOwnPropertyNames||function(e){return Hn(e,Yn)}},Zn={f:Object.getOwnPropertySymbols},qn=ae([].concat),Kn=Qe("Reflect","ownKeys")||function(e){var t=Xn.f(Xe(e)),n=Zn.f;return n?qn(t,n(e)):t},Qn=function(e,t,n){for(var r=Kn(t),i=dt.f,o=Dn.f,a=0;a<r.length;a++){var s=r[a];pe(e,s)||n&&pe(n,s)||i(e,s,o(t,s))}},$n=/#|\.prototype\./,Jn=function(e,t){var n=tr[er(e)];return n==rr||n!=nr&&(De(t)?te(t):!!t)},er=Jn.normalize=function(e){return String(e).replace($n,".").toLowerCase()},tr=Jn.data={},nr=Jn.NATIVE="N",rr=Jn.POLYFILL="P",ir=Jn,or=Dn.f,ar=function(e,t){var n,r,i,o,a,s=e.target,u=e.global,c=e.stat;if(n=u?K:c?K[s]||$(s,{}):(K[s]||{}).prototype)for(r in t){if(o=t[r],i=e.dontCallGetSet?(a=or(n,r))&&a.value:n[r],!ir(u?r:s+(c?".":"#")+r,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;Qn(o,i)}(e.sham||i&&i.sham)&&Ct(o,"sham",!0),Ft(n,r,o,e)}},sr=Pe("species"),ur=function(e){return Ee>=51||!te((function(){var t=[];return(t.constructor={})[sr]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},cr=wn.filter,lr=ur("filter");ar({target:"Array",proto:!0,forced:!lr},{filter:function(e){return cr(this,e,arguments.length>1?arguments[1]:void 0)}});var hr=function e(t,n){var r,i=t&&t.type;if("FeatureCollection"===i)for(r=0;r<t.features.length;r++)e(t.features[r],n);else if("GeometryCollection"===i)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],n);else if("Feature"===i)e(t.geometry,n);else if("Polygon"===i)fr(t.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<t.coordinates.length;r++)fr(t.coordinates[r],n);return t};function fr(e,t){if(0!==e.length){pr(e[0],t);for(var n=1;n<e.length;n++)pr(e[n],!t)}}function pr(e,t){for(var n=0,r=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!t&&e.reverse()}var dr={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function vr(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function gr(e,t,n){void 0===n&&(n={});for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return vr({type:"Polygon",coordinates:e},t,n)}function mr(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return vr({type:"LineString",coordinates:e},t,n)}function yr(e){return 180*(e%(2*Math.PI))/Math.PI}function _r(e){return e%360*Math.PI/180}function br(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function xr(e){return"Feature"===e.type?e.geometry:e}function Sr(e,t){!function(e,t){var n,r,i,o,a,s,u,c,l,h,f=0,p="FeatureCollection"===e.type,d="Feature"===e.type,v=p?e.features.length:1;for(n=0;n<v;n++){for(s=p?e.features[n].geometry:d?e.geometry:e,c=p?e.features[n].properties:d?e.properties:{},l=p?e.features[n].bbox:d?e.bbox:void 0,h=p?e.features[n].id:d?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,f,c,l,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],f,c,l,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,c,l,h))return!1;f++}}(e,(function(e,n,r,i,o){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==t(vr(e,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<e.coordinates.length;u++){var c=e.coordinates[u];if(!1===t(vr({type:a,coordinates:c},r),n,u))return!1}}))}function Er(e,t){var n=t.x,r=t.y,i=t.x1,o=t.y1,a=t.coordinates,s=t.geometry,u=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter((function(e){return e[s]&&e[s].type&&e[s].coordinates&&e[s].coordinates.length>0})).forEach((function(e,t){Sr(hr(v({},e[s]),!0),(function(n){var r=br(n),i=v(v({},e),{},{_id:t,coordinates:r});u.push(i)}))})),{dataArray:u};for(var c=0;c<e.length;c++){var l=e[c],h=[];if(a){var f="Polygon";Array.isArray(a[0])||(f="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(f="LineString"),h=hr({type:f,coordinates:F(l[a])},!0).coordinates}else if(n&&r&&i&&o){h=[[parseFloat(l[n]),parseFloat(l[r])],[parseFloat(l[i]),parseFloat(l[o])]]}else n&&r&&(h=[parseFloat(l[n]),parseFloat(l[r])]);var p=v(v({},l),{},{_id:c,coordinates:h});u.push(p)}return{dataArray:u}}var Ar=String,wr=function(e){if("Symbol"===Ht(e))throw TypeError("Cannot convert a Symbol value to a string");return Ar(e)},Tr=function(){var e=Xe(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Cr=RegExp.prototype,kr=function(e){var t=e.flags;return void 0!==t||"flags"in Cr||pe(e,"flags")||!$e(Cr,e)?t:qe(Tr,e)},Mr=yt.PROPER,Pr=RegExp.prototype.toString,Ir=te((function(){return"/a/b"!=Pr.call({source:"a",flags:"b"})})),Lr=Mr&&"toString"!=Pr.name;(Ir||Lr)&&Ft(RegExp.prototype,"toString",(function(){var e=Xe(this);return"/"+wr(e.source)+"/"+wr(kr(e))}),{unsafe:!0});var Or,Rr,Nr,Dr,Fr="undefined"!=typeof process&&"process"==Ut(process),Br=String,zr=TypeError,Ur=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=function(e,t,n){try{return ae(it(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}}(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Xe(n),function(e){if("object"==typeof e||De(e))return e;throw zr("Can't set "+Br(e)+" as a prototype")}(r),t?e(n,r):n.__proto__=r,n}}():void 0),jr=dt.f,Vr=Pe("toStringTag"),Gr=function(e,t,n){e&&!n&&(e=e.prototype),e&&!pe(e,Vr)&&jr(e,Vr,{configurable:!0,value:t})},Hr=function(e,t,n){return n.get&&Dt(n.get,t,{getter:!0}),n.set&&Dt(n.set,t,{setter:!0}),dt.f(e,t,n)},Wr=Pe("species"),Yr=function(e){var t=Qe(e);Fe&&t&&!t[Wr]&&Hr(t,Wr,{configurable:!0,get:function(){return this}})},Xr=TypeError,Zr=function(e,t){if($e(t,e))return e;throw Xr("Incorrect invocation")},qr=TypeError,Kr=function(e){if(_n(e))return e;throw qr(nt(e)+" is not a constructor")},Qr=Pe("species"),$r=function(e,t){var n,r=Xe(e).constructor;return void 0===r||se(n=Xe(r)[Qr])?t:Kr(n)},Jr=Function.prototype,ei=Jr.apply,ti=Jr.call,ni="object"==typeof Reflect&&Reflect.apply||(ne?ti.bind(ei):function(){return ti.apply(ei,arguments)}),ri=Qe("document","documentElement"),ii=ae([].slice),oi=TypeError,ai=function(e,t){if(e<t)throw oi("Not enough arguments");return e},si=/(?:ipad|iphone|ipod).*applewebkit/i.test(ye),ui=K.setImmediate,ci=K.clearImmediate,li=K.process,hi=K.Dispatch,fi=K.Function,pi=K.MessageChannel,di=K.String,vi=0,gi={};te((function(){Or=K.location}));var mi=function(e){if(pe(gi,e)){var t=gi[e];delete gi[e],t()}},yi=function(e){return function(){mi(e)}},_i=function(e){mi(e.data)},bi=function(e){K.postMessage(di(e),Or.protocol+"//"+Or.host)};ui&&ci||(ui=function(e){ai(arguments.length,1);var t=De(e)?e:fi(e),n=ii(arguments,1);return gi[++vi]=function(){ni(t,void 0,n)},Rr(vi),vi},ci=function(e){delete gi[e]},Fr?Rr=function(e){li.nextTick(yi(e))}:hi&&hi.now?Rr=function(e){hi.now(yi(e))}:pi&&!si?(Dr=(Nr=new pi).port2,Nr.port1.onmessage=_i,Rr=$t(Dr.postMessage,Dr)):K.addEventListener&&De(K.postMessage)&&!K.importScripts&&Or&&"file:"!==Or.protocol&&!te(bi)?(Rr=bi,K.addEventListener("message",_i,!1)):Rr="onreadystatechange"in Ve("script")?function(e){ri.appendChild(Ve("script")).onreadystatechange=function(){ri.removeChild(this),mi(e)}}:function(e){setTimeout(yi(e),0)});var xi={set:ui,clear:ci},Si=function(){this.head=null,this.tail=null};Si.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var Ei,Ai,wi,Ti,Ci,ki=Si,Mi=/ipad|iphone|ipod/i.test(ye)&&"undefined"!=typeof Pebble,Pi=/web0s(?!.*chrome)/i.test(ye),Ii=Dn.f,Li=xi.set,Oi=K.MutationObserver||K.WebKitMutationObserver,Ri=K.document,Ni=K.process,Di=K.Promise,Fi=Ii(K,"queueMicrotask"),Bi=Fi&&Fi.value;if(!Bi){var zi=new ki,Ui=function(){var e,t;for(Fr&&(e=Ni.domain)&&e.exit();t=zi.get();)try{t()}catch(e){throw zi.head&&Ei(),e}e&&e.enter()};si||Fr||Pi||!Oi||!Ri?!Mi&&Di&&Di.resolve?((Ti=Di.resolve(void 0)).constructor=Di,Ci=$t(Ti.then,Ti),Ei=function(){Ci(Ui)}):Fr?Ei=function(){Ni.nextTick(Ui)}:(Li=$t(Li,K),Ei=function(){Li(Ui)}):(Ai=!0,wi=Ri.createTextNode(""),new Oi(Ui).observe(wi,{characterData:!0}),Ei=function(){wi.data=Ai=!Ai}),Bi=function(e){zi.head||Ei(),zi.add(e)}}var ji,Vi,Gi,Hi=Bi,Wi=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Yi=K.Promise,Xi="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Zi=!Xi&&!Fr&&"object"==typeof window&&"object"==typeof document,qi=(Yi&&Yi.prototype,Pe("species")),Ki=!1,Qi=De(K.PromiseRejectionEvent),$i={CONSTRUCTOR:ir("Promise",(function(){var e=Et(Yi),t=e!==String(Yi);if(!t&&66===Ee)return!0;if(!Ee||Ee<51||!/native code/.test(e)){var n=new Yi((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[qi]=r,!(Ki=n.then((function(){}))instanceof r))return!0}return!t&&(Zi||Xi)&&!Qi})),REJECTION_EVENT:Qi,SUBCLASSING:Ki},Ji=TypeError,eo=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw Ji("Bad Promise constructor");t=e,n=r})),this.resolve=it(t),this.reject=it(n)},to={f:function(e){return new eo(e)}},no=xi.set,ro=$i.CONSTRUCTOR,io=$i.REJECTION_EVENT,oo=$i.SUBCLASSING,ao=Nt.getterFor("Promise"),so=Nt.set,uo=Yi&&Yi.prototype,co=Yi,lo=uo,ho=K.TypeError,fo=K.document,po=K.process,vo=to.f,go=vo,mo=!!(fo&&fo.createEvent&&K.dispatchEvent),yo=function(e){var t;return!(!ze(e)||!De(t=e.then))&&t},_o=function(e,t){var n,r,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,u=e.resolve,c=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&Ao(t),t.rejection=1),!0===s?n=o:(l&&l.enter(),n=s(o),l&&(l.exit(),i=!0)),n===e.promise?c(ho("Promise-chain cycle")):(r=yo(n))?qe(r,n,u,c):u(n)):c(o)}catch(e){l&&!i&&l.exit(),c(e)}},bo=function(e,t){e.notified||(e.notified=!0,Hi((function(){for(var n,r=e.reactions;n=r.get();)_o(n,e);e.notified=!1,t&&!e.rejection&&So(e)})))},xo=function(e,t,n){var r,i;mo?((r=fo.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),K.dispatchEvent(r)):r={promise:t,reason:n},!io&&(i=K["on"+e])?i(r):"unhandledrejection"===e&&function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}}("Unhandled promise rejection",n)},So=function(e){qe(no,K,(function(){var t,n=e.facade,r=e.value;if(Eo(e)&&(t=Wi((function(){Fr?po.emit("unhandledRejection",r,n):xo("unhandledrejection",n,r)})),e.rejection=Fr||Eo(e)?2:1,t.error))throw t.value}))},Eo=function(e){return 1!==e.rejection&&!e.parent},Ao=function(e){qe(no,K,(function(){var t=e.facade;Fr?po.emit("rejectionHandled",t):xo("rejectionhandled",t,e.value)}))},wo=function(e,t,n){return function(r){e(t,r,n)}},To=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,bo(e,!0))},Co=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw ho("Promise can't be resolved itself");var r=yo(t);r?Hi((function(){var n={done:!1};try{qe(r,t,wo(Co,n,e),wo(To,n,e))}catch(t){To(n,t,e)}})):(e.value=t,e.state=1,bo(e,!1))}catch(t){To({done:!1},t,e)}}};if(ro&&(lo=(co=function(e){Zr(this,lo),it(e),qe(ji,this);var t=ao(this);try{e(wo(Co,t),wo(To,t))}catch(e){To(t,e)}}).prototype,(ji=function(e){so(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new ki,rejection:!1,state:0,value:void 0})}).prototype=Ft(lo,"then",(function(e,t){var n=ao(this),r=vo($r(this,co));return n.parent=!0,r.ok=!De(e)||e,r.fail=De(t)&&t,r.domain=Fr?po.domain:void 0,0==n.state?n.reactions.add(r):Hi((function(){_o(r,n)})),r.promise})),Vi=function(){var e=new ji,t=ao(e);this.promise=e,this.resolve=wo(Co,t),this.reject=wo(To,t)},to.f=vo=function(e){return e===co||void 0===e?new Vi(e):go(e)},De(Yi)&&uo!==Object.prototype)){Gi=uo.then,oo||Ft(uo,"then",(function(e,t){var n=this;return new co((function(e,t){qe(Gi,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete uo.constructor}catch(e){}Ur&&Ur(uo,lo)}ar({global:!0,constructor:!0,wrap:!0,forced:ro},{Promise:co}),Gr(co,"Promise",!1),Yr("Promise");var ko={},Mo=Pe("iterator"),Po=Array.prototype,Io=function(e){return void 0!==e&&(ko.Array===e||Po[Mo]===e)},Lo=Pe("iterator"),Oo=function(e){if(!se(e))return ot(e,Lo)||ot(e,"@@iterator")||ko[Ht(e)]},Ro=TypeError,No=function(e,t){var n=arguments.length<2?Oo(e):t;if(it(n))return Xe(qe(n,e));throw Ro(nt(e)+" is not iterable")},Do=function(e,t,n){var r,i;Xe(e);try{if(!(r=ot(e,"return"))){if("throw"===t)throw n;return n}r=qe(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return Xe(r),n},Fo=TypeError,Bo=function(e,t){this.stopped=e,this.result=t},zo=Bo.prototype,Uo=function(e,t,n){var r,i,o,a,s,u,c,l=n&&n.that,h=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),d=!(!n||!n.INTERRUPTED),v=$t(t,l),g=function(e){return r&&Do(r,"normal",e),new Bo(!0,e)},m=function(e){return h?(Xe(e),d?v(e[0],e[1],g):v(e[0],e[1])):d?v(e,g):v(e)};if(f)r=e.iterator;else if(p)r=e;else{if(!(i=Oo(e)))throw Fo(nt(e)+" is not iterable");if(Io(i)){for(o=0,a=cn(e);a>o;o++)if((s=m(e[o]))&&$e(zo,s))return s;return new Bo(!1)}r=No(e,i)}for(u=f?e.next:r.next;!(c=qe(u,r)).done;){try{s=m(c.value)}catch(e){Do(r,"throw",e)}if("object"==typeof s&&s&&$e(zo,s))return s}return new Bo(!1)},jo=Pe("iterator"),Vo=!1;try{var Go=0,Ho={next:function(){return{done:!!Go++}},return:function(){Vo=!0}};Ho[jo]=function(){return this},Array.from(Ho,(function(){throw 2}))}catch(e){}var Wo=function(e,t){if(!t&&!Vo)return!1;var n=!1;try{var r={};r[jo]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Yo=$i.CONSTRUCTOR||!Wo((function(e){Yi.all(e).then(void 0,(function(){}))}));ar({target:"Promise",stat:!0,forced:Yo},{all:function(e){var t=this,n=to.f(t),r=n.resolve,i=n.reject,o=Wi((function(){var n=it(t.resolve),o=[],a=0,s=1;Uo(e,(function(e){var u=a++,c=!1;s++,qe(n,t,e).then((function(e){c||(c=!0,o[u]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise}});var Xo=$i.CONSTRUCTOR,Zo=Yi&&Yi.prototype;if(ar({target:"Promise",proto:!0,forced:Xo,real:!0},{catch:function(e){return this.then(void 0,e)}}),De(Yi)){var qo=Qe("Promise").prototype.catch;Zo.catch!==qo&&Ft(Zo,"catch",qo,{unsafe:!0})}ar({target:"Promise",stat:!0,forced:Yo},{race:function(e){var t=this,n=to.f(t),r=n.reject,i=Wi((function(){var i=it(t.resolve);Uo(e,(function(e){qe(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}}),ar({target:"Promise",stat:!0,forced:$i.CONSTRUCTOR},{reject:function(e){var t=to.f(this);return qe(t.reject,void 0,e),t.promise}});var Ko=$i.CONSTRUCTOR;Qe("Promise");ar({target:"Promise",stat:!0,forced:Ko},{resolve:function(e){return function(e,t){if(Xe(e),ze(t)&&t.constructor===e)return t;var n=to.f(e);return(0,n.resolve)(t),n.promise}(this,e)}});var Qo=wn.map,$o=ur("map");function Jo(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function ea(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)ta(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)ta(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)ta(e,t[r][i])}(i),i}function ta(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function na(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)ra(i,s);else if("MultiPoint"===o)for(var c=0;c<i.length;c++)ra(i[c],s);else if("LineString"===o)ia(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(c=0;c<i.length;c++)s=[],ia(i[c],s,a,!1),e.push(ea(u,"LineString",s,t.properties));return}oa(i,s,a,!1)}else if("Polygon"===o)oa(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<t.geometry.geometries.length;c++)na(e,{id:u,geometry:t.geometry.geometries[c],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<i.length;c++){var l=[];oa(i[c],l,a,!0),s.push(l)}}e.push(ea(u,o,s,t.properties))}}function ra(e,t){t.push(aa(e[0])),t.push(sa(e[1])),t.push(0)}function ia(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=aa(e[s][0]),c=sa(e[s][1]);t.push(u),t.push(c),t.push(0),s>0&&(a+=r?(i*c-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(c-o,2))),i=u,o=c}var l=t.length-3;t[2]=1,function e(t,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,c=t[n],l=t[n+1],h=t[r],f=t[r+1],p=n+3;p<r;p+=3){var d=Jo(t[p],t[p+1],c,l,h,f);if(d>a)o=p,a=d;else if(d===a){var v=Math.abs(p-s);v<u&&(o=p,u=v)}}a>i&&(o-n>3&&e(t,n,o,i),t[o+2]=a,r-o>3&&e(t,o,r,i))}(t,0,l,n),t[l+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function oa(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];ia(e[i],o,n,r),t.push(o)}}function aa(e){return e/360+.5}function sa(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function ua(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],c=0;c<e.length;c++){var l=e[c],h=l.geometry,f=l.type,p=0===i?l.minX:l.minY,d=0===i?l.maxX:l.maxY;if(p>=n&&d<r)u.push(l);else if(!(d<n||p>=r)){var v=[];if("Point"===f||"MultiPoint"===f)ca(h,v,n,r,i);else if("LineString"===f)la(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===f)fa(h,v,n,r,i,!1);else if("Polygon"===f)fa(h,v,n,r,i,!0);else if("MultiPolygon"===f)for(var g=0;g<h.length;g++){var m=[];fa(h[g],m,n,r,i,!0),m.length&&v.push(m)}if(v.length){if(s.lineMetrics&&"LineString"===f){for(g=0;g<v.length;g++)u.push(ea(l.id,f,v[g],l.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===v.length?(f="LineString",v=v[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===v.length?"Point":"MultiPoint"),u.push(ea(l.id,f,v,l.tags))}}}return u.length?u:null}function ca(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function la(e,t,n,r,i,o,a){for(var s,u,c=ha(e),l=0===i?da:va,h=e.start,f=0;f<e.length-3;f+=3){var p=e[f],d=e[f+1],v=e[f+2],g=e[f+3],m=e[f+4],y=0===i?p:d,_=0===i?g:m,b=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(d-m,2))),y<n?_>n&&(u=l(c,p,d,g,m,n),a&&(c.start=h+s*u)):y>r?_<r&&(u=l(c,p,d,g,m,r),a&&(c.start=h+s*u)):pa(c,p,d,v),_<n&&y>=n&&(u=l(c,p,d,g,m,n),b=!0),_>r&&y<=r&&(u=l(c,p,d,g,m,r),b=!0),!o&&b&&(a&&(c.end=h+s*u),t.push(c),c=ha(e)),a&&(h+=s)}var x=e.length-3;p=e[x],d=e[x+1],v=e[x+2],(y=0===i?p:d)>=n&&y<=r&&pa(c,p,d,v),x=c.length-3,o&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&pa(c,c[0],c[1],c[2]),c.length&&t.push(c)}function ha(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function fa(e,t,n,r,i,o){for(var a=0;a<e.length;a++)la(e[a],t,n,r,i,o,!1)}function pa(e,t,n,r){e.push(t),e.push(n),e.push(r)}function da(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function va(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function ga(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=ma(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(ma(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],c=0;c<o.geometry[s].length;c++)u.push(ma(o.geometry[s][c],t));i.push(u)}n.push(ea(o.id,a,i,o.tags))}return n}function ma(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function ya(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],c=u.geometry,l=u.type;if(u.geometry=[],1===l)for(r=0;r<c.length;r+=2)u.geometry.push(_a(c[r],c[r+1],t,o,a,s));else for(r=0;r<c.length;r++){var h=[];for(i=0;i<c[r].length;i+=2)h.push(_a(c[r][i],c[r][i+1],t,o,a,s));u.geometry.push(h)}}return e.transformed=!0,e}function _a(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function ba(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,xa(a,e[s],o,i);var u=e[s].minX,c=e[s].minY,l=e[s].maxX,h=e[s].maxY;u<a.minX&&(a.minX=u),c<a.minY&&(a.minY=c),l>a.maxX&&(a.maxX=l),h>a.maxY&&(a.maxY=h)}return a}function xa(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)Sa(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)Sa(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var c=i[u];for(s=0;s<c.length;s++)Sa(a,c[s],e,n,!0,0===s)}if(a.length){var l=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in l={},t.tags)l[h]=t.tags[h];l.mapbox_clip_start=i.start/i.size,l.mapbox_clip_end=i.end/i.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:l};null!==t.id&&(f.id=t.id),e.features.push(f)}}function Sa(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function Ea(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)na(n,e.features[r],t,r);else"Feature"===e.type?na(n,e,t):na(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var n=t.buffer/t.extent,r=e,i=ua(e,1,-1-n,n,0,-1,2,t),o=ua(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=ua(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=ga(i,1).concat(r)),o&&(r=r.concat(ga(o,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Aa(e,t,n){return 32*((1<<e)*n+t)+e}ar({target:"Array",proto:!0,forced:!$o},{map:function(e){return Qo(this,e,arguments.length>1?arguments[1]:void 0)}}),Ea.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ea.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,c=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var l=1<<t,h=Aa(t,n,r),f=this.tiles[h];if(!f&&(c>1&&console.time("creation"),f=this.tiles[h]=ba(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=e,i){if(t===u.maxZoom||t===i)continue;var d=1<<i-t;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(t===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==e.length){c>1&&console.time("clipping");var v,g,m,y,_,b,x=.5*u.buffer/u.extent,S=.5-x,E=.5+x,A=1+x;v=g=m=y=null,_=ua(e,l,n-x,n+E,0,f.minX,f.maxX,u),b=ua(e,l,n+S,n+A,0,f.minX,f.maxX,u),e=null,_&&(v=ua(_,l,r-x,r+E,1,f.minY,f.maxY,u),g=ua(_,l,r+S,r+A,1,f.minY,f.maxY,u),_=null),b&&(m=ua(b,l,r-x,r+E,1,f.minY,f.maxY,u),y=ua(b,l,r+S,r+A,1,f.minY,f.maxY,u),b=null),c>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(m||[],t+1,2*n+1,2*r),s.push(y||[],t+1,2*n+1,2*r+1)}}},Ea.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=Aa(e,t=(t%a+a)%a,n);if(this.tiles[s])return ya(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,c=e,l=t,h=n;!u&&c>0;)c--,l=Math.floor(l/2),h=Math.floor(h/2),u=this.tiles[Aa(c,l,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,l,h),o>1&&console.time("drilling down"),this.splitTile(u.source,c,l,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?ya(this.tiles[s],i):null):null};var wa=function(){function e(t,n,r,i){b(this,e),E(this,"vectorTile",void 0),E(this,"vectorLayerCache",{}),E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),this.x=n,this.y=r,this.z=i,this.vectorTile=t}return S(e,[{key:"getTileData",value:function(e){return e&&this.vectorTile.layers[e]?this.vectorLayerCache[e]?this.vectorLayerCache[e]:this.vectorTile.layers[e].features:[]}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Ta={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function Ca(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}var ka=["Unknown","Point","LineString","Polygon"];function Ma(e,t,n,r,i){var o,a,s=i.geometry,u=i.type,c=i.tags,l=i.id,h=e*Math.pow(2,r),f=e*t,p=e*n,d=ka[u];function v(e){for(var t=0;t<e.length;t++){var n=e[t];if(n[3])break;var r=180-360*(n[1]+p)/h,i=360*(n[0]+f)/h-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;e[t]=[i,o,0,1]}}switch(u){case 1:var g=[];for(o=0;o<s.length;o++)g[o]=s[o][0];v(s=g);break;case 2:for(o=0;o<s.length;o++)v(s[o]);break;case 3:for(s=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var a=Ca(e[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}return n&&i.push(n),i}(s),o=0;o<s.length;o++)for(a=0;a<s[o].length;a++)v(s[o][a])}return 1===s.length?s=s[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:s},properties:c,id:l,tileOrigin:[0,0],coord:""}}var Pa=function(){var e=_(g().mark((function e(t,n,r,i){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var o=n.getTile(t.z,t.x,t.y),a=o?o.features.map((function(e){return Ma(i,r.x,r.y,r.z,e)})):[];e(new wa({layers:{defaultLayer:{features:a}}},t.x,t.y,t.z))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}();var Ia=TypeError,La=function(e){if(e>9007199254740991)throw Ia("Maximum allowed index exceeded");return e},Oa=function(e,t,n){var r=lt(t);r in e?dt.f(e,r,Tt(0,n)):e[r]=n},Ra=Pe("isConcatSpreadable"),Na=Ee>=51||!te((function(){var e=[];return e[Ra]=!1,e.concat()[0]!==e})),Da=function(e){if(!ze(e))return!1;var t=e[Ra];return void 0!==t?!!t:ln(e)},Fa=!Na||!ur("concat");ar({target:"Array",proto:!0,arity:1,forced:Fa},{concat:function(e){var t,n,r,i,o,a=he(this),s=Sn(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(Da(o=-1===t?a:arguments[t]))for(i=cn(o),La(u+i),n=0;n<i;n++,u++)n in o&&Oa(s,u,o[n]);else La(u+1),Oa(s,u++,o);return s.length=u,s}});var Ba=Object.keys||function(e){return Hn(e,Wn)},za=te((function(){Ba(1)}));ar({target:"Object",stat:!0,forced:za},{keys:function(e){return Ba(he(e))}});var Ua,ja={f:Fe&&!He?Object.defineProperties:function(e,t){Xe(e);for(var n,r=Rn(t),i=Ba(t),o=i.length,a=0;o>a;)dt.f(e,n=i[a++],r[n]);return e}},Va=Mt("IE_PROTO"),Ga=function(){},Ha=function(e){return"<script>"+e+"<\/script>"},Wa=function(e){e.write(Ha("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ya=function(){try{Ua=new ActiveXObject("htmlfile")}catch(e){}var e,t;Ya="undefined"!=typeof document?document.domain&&Ua?Wa(Ua):((t=Ve("iframe")).style.display="none",ri.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Ha("document.F=Object")),e.close(),e.F):Wa(Ua);for(var n=Wn.length;n--;)delete Ya.prototype[Wn[n]];return Ya()};Pt[Va]=!0;var Xa=Object.create||function(e,t){var n;return null!==e?(Ga.prototype=Xe(e),n=new Ga,Ga.prototype=null,n[Va]=e):n=Ya(),void 0===t?n:ja.f(n,t)},Za=dt.f,qa=Pe("unscopables"),Ka=Array.prototype;null==Ka[qa]&&Za(Ka,qa,{configurable:!0,value:Xa(null)});var Qa,$a,Ja,es=function(e){Ka[qa][e]=!0},ts=!te((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),ns=Mt("IE_PROTO"),rs=Object,is=rs.prototype,os=ts?rs.getPrototypeOf:function(e){var t=he(e);if(pe(t,ns))return t[ns];var n=t.constructor;return De(n)&&t instanceof n?n.prototype:t instanceof rs?is:null},as=Pe("iterator"),ss=!1;[].keys&&("next"in(Ja=[].keys())?($a=os(os(Ja)))!==Object.prototype&&(Qa=$a):ss=!0),(!ze(Qa)||te((function(){var e={};return Qa[as].call(e)!==e})))&&(Qa={}),De(Qa[as])||Ft(Qa,as,(function(){return this}));var us={IteratorPrototype:Qa,BUGGY_SAFARI_ITERATORS:ss},cs=us.IteratorPrototype,ls=function(){return this},hs=function(e,t,n,r){var i=t+" Iterator";return e.prototype=Xa(cs,{next:Tt(+!r,n)}),Gr(e,i,!1),ko[i]=ls,e},fs=yt.PROPER,ps=yt.CONFIGURABLE,ds=us.IteratorPrototype,vs=us.BUGGY_SAFARI_ITERATORS,gs=Pe("iterator"),ms=function(){return this},ys=function(e,t,n,r,i,o,a){hs(n,t,r);var s,u,c,l=function(e){if(e===i&&v)return v;if(!vs&&e in p)return p[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},h=t+" Iterator",f=!1,p=e.prototype,d=p[gs]||p["@@iterator"]||i&&p[i],v=!vs&&d||l(i),g="Array"==t&&p.entries||d;if(g&&(s=os(g.call(new e)))!==Object.prototype&&s.next&&(os(s)!==ds&&(Ur?Ur(s,ds):De(s[gs])||Ft(s,gs,ms)),Gr(s,h,!0)),fs&&"values"==i&&d&&"values"!==d.name&&(ps?Ct(p,"name","values"):(f=!0,v=function(){return qe(d,this)})),i)if(u={values:l("values"),keys:o?v:l("keys"),entries:l("entries")},a)for(c in u)(vs||f||!(c in p))&&Ft(p,c,u[c]);else ar({target:t,proto:!0,forced:vs||f},u);return p[gs]!==v&&Ft(p,gs,v,{name:i}),ko[t]=v,u},_s=function(e,t){return{value:e,done:t}},bs=dt.f,xs=Nt.set,Ss=Nt.getterFor("Array Iterator"),Es=ys(Array,"Array",(function(e,t){xs(this,{type:"Array Iterator",target:Rn(e),index:0,kind:t})}),(function(){var e=Ss(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,_s(void 0,!0)):_s("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)}),"values"),As=ko.Arguments=ko.Array;if(es("keys"),es("values"),es("entries"),Fe&&"values"!==As.name)try{bs(As,"name",{value:"values"})}catch(e){}var ws,Ts,Cs,ks="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ms=Nt.enforce,Ps=Nt.get,Is=K.Int8Array,Ls=Is&&Is.prototype,Os=K.Uint8ClampedArray,Rs=Os&&Os.prototype,Ns=Is&&os(Is),Ds=Ls&&os(Ls),Fs=Object.prototype,Bs=K.TypeError,zs=Pe("toStringTag"),Us=me("TYPED_ARRAY_TAG"),js=ks&&!!Ur&&"Opera"!==Ht(K.opera),Vs=!1,Gs={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Hs={BigInt64Array:8,BigUint64Array:8},Ws=function(e){var t=os(e);if(ze(t)){var n=Ps(t);return n&&pe(n,"TypedArrayConstructor")?n.TypedArrayConstructor:Ws(t)}},Ys=function(e){if(!ze(e))return!1;var t=Ht(e);return pe(Gs,t)||pe(Hs,t)};for(ws in Gs)(Cs=(Ts=K[ws])&&Ts.prototype)?Ms(Cs).TypedArrayConstructor=Ts:js=!1;for(ws in Hs)(Cs=(Ts=K[ws])&&Ts.prototype)&&(Ms(Cs).TypedArrayConstructor=Ts);if((!js||!De(Ns)||Ns===Function.prototype)&&(Ns=function(){throw Bs("Incorrect invocation")},js))for(ws in Gs)K[ws]&&Ur(K[ws],Ns);if((!js||!Ds||Ds===Fs)&&(Ds=Ns.prototype,js))for(ws in Gs)K[ws]&&Ur(K[ws].prototype,Ds);if(js&&os(Rs)!==Ds&&Ur(Rs,Ds),Fe&&!pe(Ds,zs))for(ws in Vs=!0,Hr(Ds,zs,{configurable:!0,get:function(){return ze(this)?this[Us]:void 0}}),Gs)K[ws]&&Ct(K[ws],Us,ws);var Xs={NATIVE_ARRAY_BUFFER_VIEWS:js,TYPED_ARRAY_TAG:Vs&&Us,aTypedArray:function(e){if(Ys(e))return e;throw Bs("Target is not a typed array")},aTypedArrayConstructor:function(e){if(De(e)&&(!Ur||$e(Ns,e)))return e;throw Bs(nt(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,r){if(Fe){if(n)for(var i in Gs){var o=K[i];if(o&&pe(o.prototype,e))try{delete o.prototype[e]}catch(n){try{o.prototype[e]=t}catch(e){}}}Ds[e]&&!n||Ft(Ds,e,n?t:js&&Ls[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(Fe){if(Ur){if(n)for(r in Gs)if((i=K[r])&&pe(i,e))try{delete i[e]}catch(e){}if(Ns[e]&&!n)return;try{return Ft(Ns,e,n?t:js&&Ns[e]||t)}catch(e){}}for(r in Gs)!(i=K[r])||i[e]&&!n||Ft(i,e,t)}},getTypedArrayConstructor:Ws,isView:function(e){if(!ze(e))return!1;var t=Ht(e);return"DataView"===t||pe(Gs,t)||pe(Hs,t)},isTypedArray:Ys,TypedArray:Ns,TypedArrayPrototype:Ds},Zs=Xs.NATIVE_ARRAY_BUFFER_VIEWS,qs=K.ArrayBuffer,Ks=K.Int8Array,Qs=!Zs||!te((function(){Ks(1)}))||!te((function(){new Ks(-1)}))||!Wo((function(e){new Ks,new Ks(null),new Ks(1.5),new Ks(e)}),!0)||te((function(){return 1!==new Ks(new qs(2),1,void 0).length})),$s=function(e,t,n){for(var r in t)Ft(e,r,t[r],n);return e},Js=RangeError,eu=function(e){if(void 0===e)return 0;var t=an(e),n=un(t);if(t!==n)throw Js("Wrong length or index");return n},tu=Array,nu=Math.abs,ru=Math.pow,iu=Math.floor,ou=Math.log,au=Math.LN2,su=function(e,t,n){var r,i,o,a=tu(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?ru(2,-24)-ru(2,-77):0,h=e<0||0===e&&1/e<0?1:0,f=0;for((e=nu(e))!=e||e===1/0?(i=e!=e?1:0,r=u):(r=iu(ou(e)/au),e*(o=ru(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?l/o:l*ru(2,1-c))*o>=2&&(r++,o/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*o-1)*ru(2,t),r+=c):(i=e*ru(2,c-1)*ru(2,t),r=0));t>=8;)a[f++]=255&i,i/=256,t-=8;for(r=r<<t|i,s+=t;s>0;)a[f++]=255&r,r/=256,s-=8;return a[--f]|=128*h,a},uu=function(e,t){var n,r=e.length,i=8*r-t-1,o=(1<<i)-1,a=o>>1,s=i-7,u=r-1,c=e[u--],l=127&c;for(c>>=7;s>0;)l=256*l+e[u--],s-=8;for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;)n=256*n+e[u--],s-=8;if(0===l)l=1-a;else{if(l===o)return n?NaN:c?-1/0:1/0;n+=ru(2,t),l-=a}return(c?-1:1)*n*ru(2,l-t)},cu=function(e){for(var t=he(this),n=cn(t),r=arguments.length,i=zn(r>1?arguments[1]:void 0,n),o=r>2?arguments[2]:void 0,a=void 0===o?n:zn(o,n);a>i;)t[i++]=e;return t},lu=Array,hu=Math.max,fu=function(e,t,n){for(var r=cn(e),i=zn(t,r),o=zn(void 0===n?r:n,r),a=lu(hu(o-i,0)),s=0;i<o;i++,s++)Oa(a,s,e[i]);return a.length=s,a},pu=Xn.f,du=yt.PROPER,vu=yt.CONFIGURABLE,gu=Nt.getterFor("ArrayBuffer"),mu=Nt.getterFor("DataView"),yu=Nt.set,_u=K.ArrayBuffer,bu=_u,xu=bu&&bu.prototype,Su=K.DataView,Eu=Su&&Su.prototype,Au=Object.prototype,wu=K.Array,Tu=K.RangeError,Cu=ae(cu),ku=ae([].reverse),Mu=su,Pu=uu,Iu=function(e){return[255&e]},Lu=function(e){return[255&e,e>>8&255]},Ou=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Ru=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Nu=function(e){return Mu(e,23,4)},Du=function(e){return Mu(e,52,8)},Fu=function(e,t,n){Hr(e.prototype,t,{configurable:!0,get:function(){return n(this)[t]}})},Bu=function(e,t,n,r){var i=eu(n),o=mu(e);if(i+t>o.byteLength)throw Tu("Wrong index");var a=o.bytes,s=i+o.byteOffset,u=fu(a,s,s+t);return r?u:ku(u)},zu=function(e,t,n,r,i,o){var a=eu(n),s=mu(e);if(a+t>s.byteLength)throw Tu("Wrong index");for(var u=s.bytes,c=a+s.byteOffset,l=r(+i),h=0;h<t;h++)u[c+h]=l[o?h:t-h-1]};if(ks){var Uu=du&&"ArrayBuffer"!==_u.name;if(te((function(){_u(1)}))&&te((function(){new _u(-1)}))&&!te((function(){return new _u,new _u(1.5),new _u(NaN),1!=_u.length||Uu&&!vu})))Uu&&vu&&Ct(_u,"name","ArrayBuffer");else{(bu=function(e){return Zr(this,xu),new _u(eu(e))}).prototype=xu;for(var ju,Vu=pu(_u),Gu=0;Vu.length>Gu;)(ju=Vu[Gu++])in bu||Ct(bu,ju,_u[ju]);xu.constructor=bu}Ur&&os(Eu)!==Au&&Ur(Eu,Au);var Hu=new Su(new bu(2)),Wu=ae(Eu.setInt8);Hu.setInt8(0,2147483648),Hu.setInt8(1,2147483649),!Hu.getInt8(0)&&Hu.getInt8(1)||$s(Eu,{setInt8:function(e,t){Wu(this,e,t<<24>>24)},setUint8:function(e,t){Wu(this,e,t<<24>>24)}},{unsafe:!0})}else xu=(bu=function(e){Zr(this,xu);var t=eu(e);yu(this,{type:"ArrayBuffer",bytes:Cu(wu(t),0),byteLength:t}),Fe||(this.byteLength=t,this.detached=!1)}).prototype,Eu=(Su=function(e,t,n){Zr(this,Eu),Zr(e,xu);var r=gu(e),i=r.byteLength,o=an(t);if(o<0||o>i)throw Tu("Wrong offset");if(o+(n=void 0===n?i-o:un(n))>i)throw Tu("Wrong length");yu(this,{type:"DataView",buffer:e,byteLength:n,byteOffset:o,bytes:r.bytes}),Fe||(this.buffer=e,this.byteLength=n,this.byteOffset=o)}).prototype,Fe&&(Fu(bu,"byteLength",gu),Fu(Su,"buffer",mu),Fu(Su,"byteLength",mu),Fu(Su,"byteOffset",mu)),$s(Eu,{getInt8:function(e){return Bu(this,1,e)[0]<<24>>24},getUint8:function(e){return Bu(this,1,e)[0]},getInt16:function(e){var t=Bu(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Bu(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Ru(Bu(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return Ru(Bu(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return Pu(Bu(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return Pu(Bu(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){zu(this,1,e,Iu,t)},setUint8:function(e,t){zu(this,1,e,Iu,t)},setInt16:function(e,t){zu(this,2,e,Lu,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){zu(this,2,e,Lu,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){zu(this,4,e,Ou,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){zu(this,4,e,Ou,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){zu(this,4,e,Nu,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){zu(this,8,e,Du,t,arguments.length>2?arguments[2]:void 0)}});Gr(bu,"ArrayBuffer"),Gr(Su,"DataView");var Yu={ArrayBuffer:bu,DataView:Su},Xu=Math.floor,Zu=Number.isInteger||function(e){return!ze(e)&&isFinite(e)&&Xu(e)===e},qu=RangeError,Ku=RangeError,Qu=function(e,t){var n=function(e){var t=an(e);if(t<0)throw qu("The argument can't be less than 0");return t}(e);if(n%t)throw Ku("Wrong offset");return n},$u=function(e){var t=Ht(e);return"BigInt64Array"==t||"BigUint64Array"==t},Ju=TypeError,ec=function(e){var t=ct(e,"number");if("number"==typeof t)throw Ju("Can't convert number to bigint");return BigInt(t)},tc=Xs.aTypedArrayConstructor,nc=function(e){var t,n,r,i,o,a,s,u,c=Kr(this),l=he(e),h=arguments.length,f=h>1?arguments[1]:void 0,p=void 0!==f,d=Oo(l);if(d&&!Io(d))for(u=(s=No(l,d)).next,l=[];!(a=qe(u,s)).done;)l.push(a.value);for(p&&h>2&&(f=$t(f,arguments[2])),n=cn(l),r=new(tc(c))(n),i=$u(r),t=0;n>t;t++)o=p?f(l[t],t):l[t],r[t]=i?ec(o):+o;return r},rc=function(e,t,n){var r,i;return Ur&&De(r=t.constructor)&&r!==n&&ze(i=r.prototype)&&i!==n.prototype&&Ur(e,i),e},ic=Y((function(e){var t=Xn.f,n=wn.forEach,r=Nt.get,i=Nt.set,o=Nt.enforce,a=dt.f,s=Dn.f,u=Math.round,c=K.RangeError,l=Yu.ArrayBuffer,h=l.prototype,f=Yu.DataView,p=Xs.NATIVE_ARRAY_BUFFER_VIEWS,d=Xs.TYPED_ARRAY_TAG,v=Xs.TypedArray,g=Xs.TypedArrayPrototype,m=Xs.aTypedArrayConstructor,y=Xs.isTypedArray,_=function(e,t){m(e);for(var n=0,r=t.length,i=new e(r);r>n;)i[n]=t[n++];return i},b=function(e,t){Hr(e,t,{configurable:!0,get:function(){return r(this)[t]}})},x=function(e){var t;return $e(h,e)||"ArrayBuffer"==(t=Ht(e))||"SharedArrayBuffer"==t},S=function(e,t){return y(e)&&!et(t)&&t in e&&Zu(+t)&&t>=0},E=function(e,t){return t=lt(t),S(e,t)?Tt(2,e[t]):s(e,t)},A=function(e,t,n){return t=lt(t),!(S(e,t)&&ze(n)&&pe(n,"value"))||pe(n,"get")||pe(n,"set")||n.configurable||pe(n,"writable")&&!n.writable||pe(n,"enumerable")&&!n.enumerable?a(e,t,n):(e[t]=n.value,e)};Fe?(p||(Dn.f=E,dt.f=A,b(g,"buffer"),b(g,"byteOffset"),b(g,"byteLength"),b(g,"length")),ar({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:E,defineProperty:A}),e.exports=function(e,s,h){var m=e.match(/\d+/)[0]/8,b=e+(h?"Clamped":"")+"Array",S="get"+e,E="set"+e,A=K[b],w=A,T=w&&w.prototype,C={},k=function(e,t){a(e,t,{get:function(){return function(e,t){var n=r(e);return n.view[S](t*m+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var i=r(e);h&&(n=(n=u(n))<0?0:n>255?255:255&n),i.view[E](t*m+i.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};p?Qs&&(w=s((function(e,t,n,r){return Zr(e,T),rc(ze(t)?x(t)?void 0!==r?new A(t,Qu(n,m),r):void 0!==n?new A(t,Qu(n,m)):new A(t):y(t)?_(w,t):qe(nc,w,t):new A(eu(t)),e,w)})),Ur&&Ur(w,v),n(t(A),(function(e){e in w||Ct(w,e,A[e])})),w.prototype=T):(w=s((function(e,t,n,r){Zr(e,T);var o,a,s,u=0,h=0;if(ze(t)){if(!x(t))return y(t)?_(w,t):qe(nc,w,t);o=t,h=Qu(n,m);var p=t.byteLength;if(void 0===r){if(p%m)throw c("Wrong length");if((a=p-h)<0)throw c("Wrong length")}else if((a=un(r)*m)+h>p)throw c("Wrong length");s=a/m}else s=eu(t),o=new l(a=s*m);for(i(e,{buffer:o,byteOffset:h,byteLength:a,length:s,view:new f(o)});u<s;)k(e,u++)})),Ur&&Ur(w,v),T=w.prototype=Xa(g)),T.constructor!==w&&Ct(T,"constructor",w),o(T).TypedArrayConstructor=w,d&&Ct(T,d,b);var M=w!=A;C[b]=w,ar({global:!0,constructor:!0,forced:M,sham:!p},C),"BYTES_PER_ELEMENT"in w||Ct(w,"BYTES_PER_ELEMENT",m),"BYTES_PER_ELEMENT"in T||Ct(T,"BYTES_PER_ELEMENT",m),Yr(b)}):e.exports=function(){}}));ic("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var oc=TypeError,ac=function(e,t){if(!delete e[t])throw oc("Cannot delete property "+nt(t)+" of "+nt(e))},sc=Math.min,uc=ae([].copyWithin||function(e,t){var n=he(this),r=cn(n),i=zn(e,r),o=zn(t,r),a=arguments.length>2?arguments[2]:void 0,s=sc((void 0===a?r:zn(a,r))-o,r-i),u=1;for(o<i&&i<o+s&&(u=-1,o+=s-1,i+=s-1);s-- >0;)o in n?n[i]=n[o]:ac(n,i),i+=u,o+=u;return n}),cc=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("copyWithin",(function(e,t){return uc(cc(this),e,t,arguments.length>2?arguments[2]:void 0)}));var lc=wn.every,hc=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("every",(function(e){return lc(hc(this),e,arguments.length>1?arguments[1]:void 0)}));var fc=Xs.aTypedArray,pc=Xs.exportTypedArrayMethod,dc=ae("".slice);pc("fill",(function(e){var t=arguments.length;fc(this);var n="Big"===dc(Ht(this),0,3)?ec(e):+e;return qe(cu,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),te((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var vc=Xs.aTypedArrayConstructor,gc=Xs.getTypedArrayConstructor,mc=function(e){return vc($r(e,gc(e)))},yc=function(e,t){return function(e,t){for(var n=0,r=cn(t),i=new e(r);r>n;)i[n]=t[n++];return i}(mc(e),t)},_c=wn.filter,bc=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("filter",(function(e){var t=_c(bc(this),e,arguments.length>1?arguments[1]:void 0);return yc(this,t)}));var xc=wn.find,Sc=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("find",(function(e){return xc(Sc(this),e,arguments.length>1?arguments[1]:void 0)}));var Ec=wn.findIndex,Ac=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("findIndex",(function(e){return Ec(Ac(this),e,arguments.length>1?arguments[1]:void 0)}));var wc=wn.forEach,Tc=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("forEach",(function(e){wc(Tc(this),e,arguments.length>1?arguments[1]:void 0)}));var Cc=jn.includes,kc=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("includes",(function(e){return Cc(kc(this),e,arguments.length>1?arguments[1]:void 0)}));var Mc=jn.indexOf,Pc=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("indexOf",(function(e){return Mc(Pc(this),e,arguments.length>1?arguments[1]:void 0)}));var Ic=Pe("iterator"),Lc=K.Uint8Array,Oc=ae(Es.values),Rc=ae(Es.keys),Nc=ae(Es.entries),Dc=Xs.aTypedArray,Fc=Xs.exportTypedArrayMethod,Bc=Lc&&Lc.prototype,zc=!te((function(){Bc[Ic].call([1])})),Uc=!!Bc&&Bc.values&&Bc[Ic]===Bc.values&&"values"===Bc.values.name,jc=function(){return Oc(Dc(this))};Fc("entries",(function(){return Nc(Dc(this))}),zc),Fc("keys",(function(){return Rc(Dc(this))}),zc),Fc("values",jc,zc||!Uc,{name:"values"}),Fc(Ic,jc,zc||!Uc,{name:"values"});var Vc=Xs.aTypedArray,Gc=Xs.exportTypedArrayMethod,Hc=ae([].join);Gc("join",(function(e){return Hc(Vc(this),e)}));var Wc=Math.min,Yc=[].lastIndexOf,Xc=!!Yc&&1/[1].lastIndexOf(1,-0)<0,Zc=Tn("lastIndexOf"),qc=Xc||!Zc?function(e){if(Xc)return ni(Yc,this,arguments)||0;var t=Rn(this),n=cn(t),r=n-1;for(arguments.length>1&&(r=Wc(r,an(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:Yc,Kc=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return ni(qc,Kc(this),t>1?[e,arguments[1]]:[e])}));var Qc=wn.map,$c=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("map",(function(e){return Qc($c(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(mc(e))(t)}))}));var Jc=TypeError,el=function(e){return function(t,n,r,i){it(n);var o=he(t),a=tn(o),s=cn(o),u=e?s-1:0,c=e?-1:1;if(r<2)for(;;){if(u in a){i=a[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw Jc("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=c)u in a&&(i=n(i,a[u],u,o));return i}},tl={left:el(!1),right:el(!0)},nl=tl.left,rl=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return nl(rl(this),e,t,t>1?arguments[1]:void 0)}));var il=tl.right,ol=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return il(ol(this),e,t,t>1?arguments[1]:void 0)}));var al=Xs.aTypedArray,sl=Xs.exportTypedArrayMethod,ul=Math.floor;sl("reverse",(function(){for(var e,t=al(this).length,n=ul(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var cl=K.RangeError,ll=K.Int8Array,hl=ll&&ll.prototype,fl=hl&&hl.set,pl=Xs.aTypedArray,dl=Xs.exportTypedArrayMethod,vl=!te((function(){var e=new Uint8ClampedArray(2);return qe(fl,e,{length:1,0:3},1),3!==e[1]})),gl=vl&&Xs.NATIVE_ARRAY_BUFFER_VIEWS&&te((function(){var e=new ll(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));dl("set",(function(e){pl(this);var t=Qu(arguments.length>1?arguments[1]:void 0,1),n=he(e);if(vl)return qe(fl,this,n,t);var r=this.length,i=cn(n),o=0;if(i+t>r)throw cl("Wrong length");for(;o<i;)this[t+o]=n[o++]}),!vl||gl);var ml=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("slice",(function(e,t){for(var n=ii(ml(this),e,t),r=mc(this),i=0,o=n.length,a=new r(o);o>i;)a[i]=n[i++];return a}),te((function(){new Int8Array(1).slice()})));var yl=wn.some,_l=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("some",(function(e){return yl(_l(this),e,arguments.length>1?arguments[1]:void 0)}));var bl=Math.floor,xl=function(e,t){var n=e.length,r=bl(n/2);return n<8?Sl(e,t):El(e,xl(fu(e,0,r),t),xl(fu(e,r),t),t)},Sl=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},El=function(e,t,n,r){for(var i=t.length,o=n.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?r(t[a],n[s])<=0?t[a++]:n[s++]:a<i?t[a++]:n[s++];return e},Al=xl,wl=ye.match(/firefox\/(\d+)/i),Tl=!!wl&&+wl[1],Cl=/MSIE|Trident/.test(ye),kl=ye.match(/AppleWebKit\/(\d+)\./),Ml=!!kl&&+kl[1],Pl=Xs.aTypedArray,Il=Xs.exportTypedArrayMethod,Ll=K.Uint16Array,Ol=Ll&&Kt(Ll.prototype.sort),Rl=!(!Ol||te((function(){Ol(new Ll(2),null)}))&&te((function(){Ol(new Ll(2),{})}))),Nl=!!Ol&&!te((function(){if(Ee)return Ee<74;if(Tl)return Tl<67;if(Cl)return!0;if(Ml)return Ml<602;var e,t,n=new Ll(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(Ol(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));Il("sort",(function(e){return void 0!==e&&it(e),Nl?Ol(this,e):Al(Pl(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!Nl||Rl);var Dl=Xs.aTypedArray;(0,Xs.exportTypedArrayMethod)("subarray",(function(e,t){var n=Dl(this),r=n.length,i=zn(e,r);return new(mc(n))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,un((void 0===t?r:zn(t,r))-i))}));var Fl=K.Int8Array,Bl=Xs.aTypedArray,zl=Xs.exportTypedArrayMethod,Ul=[].toLocaleString,jl=!!Fl&&te((function(){Ul.call(new Fl(1))}));zl("toLocaleString",(function(){return ni(Ul,jl?ii(Bl(this)):Bl(this),ii(arguments))}),te((function(){return[1,2].toLocaleString()!=new Fl([1,2]).toLocaleString()}))||!te((function(){Fl.prototype.toLocaleString.call([1,2])})));var Vl=Xs.exportTypedArrayMethod,Gl=K.Uint8Array,Hl=Gl&&Gl.prototype||{},Wl=[].toString,Yl=ae([].join);te((function(){Wl.call({})}))&&(Wl=function(){return Yl(this)});var Xl=Hl.toString!=Wl;Vl("toString",Wl,Xl);var Zl=yt.EXISTS,ql=Function.prototype,Kl=ae(ql.toString),Ql=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,$l=ae(Ql.exec);Fe&&!Zl&&Hr(ql,"name",{configurable:!0,get:function(){try{return $l(Ql,Kl(this))[1]}catch(e){return""}}});var Jl=K.RegExp,eh=te((function(){var e=Jl("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),th=eh||te((function(){return!Jl("a","y").sticky})),nh={BROKEN_CARET:eh||te((function(){var e=Jl("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),MISSED_STICKY:th,UNSUPPORTED_Y:eh},rh=K.RegExp,ih=te((function(){var e=rh(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),oh=K.RegExp,ah=te((function(){var e=oh("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),sh=Nt.get,uh=ee("native-string-replace",String.prototype.replace),ch=RegExp.prototype.exec,lh=ch,hh=ae("".charAt),fh=ae("".indexOf),ph=ae("".replace),dh=ae("".slice),vh=function(){var e=/a/,t=/b*/g;return qe(ch,e,"a"),qe(ch,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),gh=nh.BROKEN_CARET,mh=void 0!==/()??/.exec("")[1];(vh||mh||gh||ih||ah)&&(lh=function(e){var t,n,r,i,o,a,s,u=this,c=sh(u),l=wr(e),h=c.raw;if(h)return h.lastIndex=u.lastIndex,t=qe(lh,h,l),u.lastIndex=h.lastIndex,t;var f=c.groups,p=gh&&u.sticky,d=qe(Tr,u),v=u.source,g=0,m=l;if(p&&(d=ph(d,"y",""),-1===fh(d,"g")&&(d+="g"),m=dh(l,u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==hh(l,u.lastIndex-1))&&(v="(?: "+v+")",m=" "+m,g++),n=new RegExp("^(?:"+v+")",d)),mh&&(n=new RegExp("^"+v+"$(?!\\s)",d)),vh&&(r=u.lastIndex),i=qe(ch,p?n:u,m),p?i?(i.input=dh(i.input,g),i[0]=dh(i[0],g),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:vh&&i&&(u.lastIndex=u.global?i.index+i[0].length:r),mh&&i&&i.length>1&&qe(uh,i[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&f)for(i.groups=a=Xa(null),o=0;o<f.length;o++)a[(s=f[o])[0]]=i[s[1]];return i});var yh=lh;ar({target:"RegExp",proto:!0,forced:/./.exec!==yh},{exec:yh});var _h=Pe("species"),bh=RegExp.prototype,xh=function(e,t,n,r){var i=Pe(e),o=!te((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=o&&!te((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[_h]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!a||n){var s=Kt(/./[i]),u=t(i,""[e],(function(e,t,n,r,i){var a=Kt(e),u=t.exec;return u===yh||u===bh.exec?o&&!i?{done:!0,value:s(t,n,r)}:{done:!0,value:a(n,t,r)}:{done:!1}}));Ft(String.prototype,e,u[0]),Ft(bh,i,u[1])}r&&Ct(bh[i],"sham",!0)},Sh=ae("".charAt),Eh=ae("".charCodeAt),Ah=ae("".slice),wh=function(e){return function(t,n){var r,i,o=wr(ce(t)),a=an(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=Eh(o,a))<55296||r>56319||a+1===s||(i=Eh(o,a+1))<56320||i>57343?e?Sh(o,a):r:e?Ah(o,a,a+2):i-56320+(r-55296<<10)+65536}},Th={codeAt:wh(!1),charAt:wh(!0)},Ch=Th.charAt,kh=function(e,t,n){return t+(n?Ch(e,t).length:1)},Mh=Math.floor,Ph=ae("".charAt),Ih=ae("".replace),Lh=ae("".slice),Oh=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Rh=/\$([$&'`]|\d{1,2})/g,Nh=function(e,t,n,r,i,o){var a=n+e.length,s=r.length,u=Rh;return void 0!==i&&(i=he(i),u=Oh),Ih(o,u,(function(o,u){var c;switch(Ph(u,0)){case"$":return"$";case"&":return e;case"`":return Lh(t,0,n);case"'":return Lh(t,a);case"<":c=i[Lh(u,1,-1)];break;default:var l=+u;if(0===l)return o;if(l>s){var h=Mh(l/10);return 0===h?o:h<=s?void 0===r[h-1]?Ph(u,1):r[h-1]+Ph(u,1):o}c=r[l-1]}return void 0===c?"":c}))},Dh=TypeError,Fh=function(e,t){var n=e.exec;if(De(n)){var r=qe(n,e,t);return null!==r&&Xe(r),r}if("RegExp"===Ut(e))return qe(yh,e,t);throw Dh("RegExp#exec called on incompatible receiver")},Bh=Pe("replace"),zh=Math.max,Uh=Math.min,jh=ae([].concat),Vh=ae([].push),Gh=ae("".indexOf),Hh=ae("".slice),Wh="$0"==="a".replace(/./,"$0"),Yh=!!/./[Bh]&&""===/./[Bh]("a","$0");xh("replace",(function(e,t,n){var r=Yh?"$":"$0";return[function(e,n){var r=ce(this),i=se(e)?void 0:ot(e,Bh);return i?qe(i,e,r,n):qe(t,wr(r),e,n)},function(e,i){var o=Xe(this),a=wr(e);if("string"==typeof i&&-1===Gh(i,r)&&-1===Gh(i,"$<")){var s=n(t,o,a,i);if(s.done)return s.value}var u=De(i);u||(i=wr(i));var c=o.global;if(c){var l=o.unicode;o.lastIndex=0}for(var h=[];;){var f=Fh(o,a);if(null===f)break;if(Vh(h,f),!c)break;""===wr(f[0])&&(o.lastIndex=kh(a,un(o.lastIndex),l))}for(var p,d="",v=0,g=0;g<h.length;g++){for(var m=wr((f=h[g])[0]),y=zh(Uh(an(f.index),a.length),0),_=[],b=1;b<f.length;b++)Vh(_,void 0===(p=f[b])?p:String(p));var x=f.groups;if(u){var S=jh([m],_,y,a);void 0!==x&&Vh(S,x);var E=wr(ni(i,void 0,S))}else E=Nh(m,a,y,_,x,i);y>=v&&(d+=Hh(a,v,y)+E,v=y+m.length)}return d+Hh(a,v)}]}),!!te((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!Wh||Yh);var Xh=ur("slice"),Zh=Pe("species"),qh=Array,Kh=Math.max;ar({target:"Array",proto:!0,forced:!Xh},{slice:function(e,t){var n,r,i,o=Rn(this),a=cn(o),s=zn(e,a),u=zn(void 0===t?a:t,a);if(ln(o)&&(n=o.constructor,(_n(n)&&(n===qh||ln(n.prototype))||ze(n)&&null===(n=n[Zh]))&&(n=void 0),n===qh||void 0===n))return ii(o,s,u);for(r=new(void 0===n?qh:n)(Kh(u-s,0)),i=0;s<u;s++,i++)s in o&&Oa(r,i,o[s]);return r.length=i,r}});var Qh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function $h(e){this.message=e}function Jh(e){for(var t,n,r,i,o="",a=0,s=(e=String(e)).length%3;a<e.length;){if((n=e.charCodeAt(a++))>255||(r=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");o+=Qh.charAt((t=n<<16|r<<8|i)>>18&63)+Qh.charAt(t>>12&63)+Qh.charAt(t>>6&63)+Qh.charAt(63&t)}return s?o.slice(0,s-3)+"===".substring(s):o}$h.prototype=new Error,$h.prototype.name="InvalidCharacterError";var ef,tf=function(){function e(t,n){b(this,e),this.buffers=t,this.type=n}return S(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(e,t,n){throw new Error("not implemented")}}]),e}();ar({global:!0,forced:K.globalThis!==K},{globalThis:K}),ef="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(e){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(e){return null},clearMeasures:function(e){return null},clearMarks:function(e){return null},measure:function(e,t,n){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(e){return!0},Event:function(e,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window;var nf="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:ef.devicePixelRatio,rf=TypeError,of=Object.getOwnPropertyDescriptor,af=Fe&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}()?function(e,t){if(ln(e)&&!of(e,"length").writable)throw rf("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},sf=ur("splice"),uf=Math.max,cf=Math.min;ar({target:"Array",proto:!0,forced:!sf},{splice:function(e,t){var n,r,i,o,a,s,u=he(this),c=cn(u),l=zn(e,c),h=arguments.length;for(0===h?n=r=0:1===h?(n=0,r=c-l):(n=h-2,r=cf(uf(an(t),0),c-l)),La(c+n-r),i=Sn(u,r),o=0;o<r;o++)(a=l+o)in u&&Oa(i,o,u[a]);if(i.length=r,n<r){for(o=l;o<c-r;o++)s=o+n,(a=o+r)in u?u[s]=u[a]:ac(u,s);for(o=c;o>c-r+n;o--)ac(u,o-1)}else if(n>r)for(o=c-r;o>l;o--)s=o+n-1,(a=o+r-1)in u?u[s]=u[a]:ac(u,s);for(o=0;o<n;o++)u[o+l]=arguments[o+2];return af(u,c-r+n),i}});var lf=S((function e(t,n){b(this,e),E(this,"cancelBubble",void 0),E(this,"cancelable",void 0),E(this,"target",void 0),E(this,"currentTarget",void 0),E(this,"preventDefault",void 0),E(this,"stopPropagation",void 0),E(this,"type",void 0),E(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=t,this.timeStamp=Date.now()})),hf=Object.assign,ff=Object.defineProperty,pf=ae([].concat),df=!hf||te((function(){if(Fe&&1!==hf({b:1},hf(ff({},"a",{enumerable:!0,get:function(){ff(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=hf({},e)[n]||"abcdefghijklmnopqrst"!=Ba(hf({},t)).join("")}))?function(e,t){for(var n=he(e),r=arguments.length,i=1,o=Zn.f,a=On.f;r>i;)for(var s,u=tn(arguments[i++]),c=o?pf(Ba(u),o(u)):Ba(u),l=c.length,h=0;l>h;)s=c[h++],Fe&&!qe(a,u,s)||(n[s]=u[s]);return n}:hf;ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==df},{assign:df});var vf=wn.findIndex,gf=!0;"findIndex"in[]&&Array(1).findIndex((function(){gf=!1})),ar({target:"Array",proto:!0,forced:gf},{findIndex:function(e){return vf(this,e,arguments.length>1?arguments[1]:void 0)}}),es("findIndex");var mf=Th.charAt,yf=Nt.set,_f=Nt.getterFor("String Iterator");ys(String,"String",(function(e){yf(this,{type:"String Iterator",string:wr(e),index:0})}),(function(){var e,t=_f(this),n=t.string,r=t.index;return r>=n.length?_s(void 0,!0):(e=mf(n,r),t.index+=e.length,_s(e,!1))}));var bf=!te((function(){return Object.isExtensible(Object.preventExtensions({}))})),xf=Xn.f,Sf="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Ef={f:function(e){return Sf&&"Window"==Ut(e)?function(e){try{return xf(e)}catch(e){return fu(Sf)}}(e):xf(Rn(e))}},Af=te((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),wf=Object.isExtensible,Tf=te((function(){wf(1)}))||Af?function(e){return!!ze(e)&&((!Af||"ArrayBuffer"!=Ut(e))&&(!wf||wf(e)))}:wf,Cf=Y((function(e){var t=dt.f,n=!1,r=me("meta"),i=0,o=function(e){t(e,r,{value:{objectID:"O"+i++,weakData:{}}})},a=e.exports={enable:function(){a.enable=function(){},n=!0;var e=Xn.f,t=ae([].splice),i={};i[r]=1,e(i).length&&(Xn.f=function(n){for(var i=e(n),o=0,a=i.length;o<a;o++)if(i[o]===r){t(i,o,1);break}return i},ar({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Ef.f}))},fastKey:function(e,t){if(!ze(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!pe(e,r)){if(!Tf(e))return"F";if(!t)return"E";o(e)}return e[r].objectID},getWeakData:function(e,t){if(!pe(e,r)){if(!Tf(e))return!0;if(!t)return!1;o(e)}return e[r].weakData},onFreeze:function(e){return bf&&n&&Tf(e)&&!pe(e,r)&&o(e),e}};Pt[r]=!0})),kf=(Cf.enable,Cf.fastKey,Cf.getWeakData,Cf.onFreeze,function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=K[e],s=a&&a.prototype,u=a,c={},l=function(e){var t=ae(s[e]);Ft(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!ze(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return i&&!ze(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!ze(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(ir(e,!De(a)||!(i||s.forEach&&!te((function(){(new a).entries().next()})))))u=n.getConstructor(t,e,r,o),Cf.enable();else if(ir(e,!0)){var h=new u,f=h[o](i?{}:-0,1)!=h,p=te((function(){h.has(1)})),d=Wo((function(e){new a(e)})),v=!i&&te((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));d||((u=t((function(e,t){Zr(e,s);var n=rc(new a,e,u);return se(t)||Uo(t,n[o],{that:n,AS_ENTRIES:r}),n}))).prototype=s,s.constructor=u),(p||v)&&(l("delete"),l("has"),r&&l("get")),(v||f)&&l(o),i&&s.clear&&delete s.clear}return c[e]=u,ar({global:!0,constructor:!0,forced:u!=a},c),Gr(u,e),i||n.setStrong(u,e,r),u}),Mf=Cf.getWeakData,Pf=Nt.set,If=Nt.getterFor,Lf=wn.find,Of=wn.findIndex,Rf=ae([].splice),Nf=0,Df=function(e){return e.frozen||(e.frozen=new Ff)},Ff=function(){this.entries=[]},Bf=function(e,t){return Lf(e.entries,(function(e){return e[0]===t}))};Ff.prototype={get:function(e){var t=Bf(this,e);if(t)return t[1]},has:function(e){return!!Bf(this,e)},set:function(e,t){var n=Bf(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=Of(this.entries,(function(t){return t[0]===e}));return~t&&Rf(this.entries,t,1),!!~t}};var zf,Uf={getConstructor:function(e,t,n,r){var i=e((function(e,i){Zr(e,o),Pf(e,{type:t,id:Nf++,frozen:void 0}),se(i)||Uo(i,e[r],{that:e,AS_ENTRIES:n})})),o=i.prototype,a=If(t),s=function(e,t,n){var r=a(e),i=Mf(Xe(t),!0);return!0===i?Df(r).set(t,n):i[r.id]=n,e};return $s(o,{delete:function(e){var t=a(this);if(!ze(e))return!1;var n=Mf(e);return!0===n?Df(t).delete(e):n&&pe(n,t.id)&&delete n[t.id]},has:function(e){var t=a(this);if(!ze(e))return!1;var n=Mf(e);return!0===n?Df(t).has(e):n&&pe(n,t.id)}}),$s(o,n?{get:function(e){var t=a(this);if(ze(e)){var n=Mf(e);return!0===n?Df(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),i}},jf=Nt.enforce,Vf=Object,Gf=Array.isArray,Hf=Vf.isExtensible,Wf=Vf.isFrozen,Yf=Vf.isSealed,Xf=Vf.freeze,Zf=Vf.seal,qf={},Kf={},Qf=!K.ActiveXObject&&"ActiveXObject"in K,$f=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Jf=kf("WeakMap",$f,Uf),ep=Jf.prototype,tp=ae(ep.set);if(wt)if(Qf){zf=Uf.getConstructor($f,"WeakMap",!0),Cf.enable();var np=ae(ep.delete),rp=ae(ep.has),ip=ae(ep.get);$s(ep,{delete:function(e){if(ze(e)&&!Hf(e)){var t=jf(this);return t.frozen||(t.frozen=new zf),np(this,e)||t.frozen.delete(e)}return np(this,e)},has:function(e){if(ze(e)&&!Hf(e)){var t=jf(this);return t.frozen||(t.frozen=new zf),rp(this,e)||t.frozen.has(e)}return rp(this,e)},get:function(e){if(ze(e)&&!Hf(e)){var t=jf(this);return t.frozen||(t.frozen=new zf),rp(this,e)?ip(this,e):t.frozen.get(e)}return ip(this,e)},set:function(e,t){if(ze(e)&&!Hf(e)){var n=jf(this);n.frozen||(n.frozen=new zf),rp(this,e)?tp(this,e,t):n.frozen.set(e,t)}else tp(this,e,t);return this}})}else bf&&te((function(){var e=Xf([]);return tp(new Jf,e,1),!Wf(e)}))&&$s(ep,{set:function(e,t){var n;return Gf(e)&&(Wf(e)?n=qf:Yf(e)&&(n=Kf)),tp(this,e,t),n==qf&&Xf(e),n==Kf&&Zf(e),this}});var op=Pe("iterator"),ap=Pe("toStringTag"),sp=Es.values,up=function(e,t){if(e){if(e[op]!==sp)try{Ct(e,op,sp)}catch(t){e[op]=sp}if(e[ap]||Ct(e,ap,t),Yt[t])for(var n in Es)if(e[n]!==Es[n])try{Ct(e,n,Es[n])}catch(t){e[n]=Es[n]}}};for(var cp in Yt)up(K[cp]&&K[cp].prototype,cp);up(qt,"DOMTokenList");var lp,hp,fp,pp,dp=new WeakMap,vp=function(){function e(){b(this,e),dp.set(this,{})}return S(e,[{key:"addEventListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=dp.get(this);r||(r={}),r[e]||(r[e]=[]),r[e].push(t),dp.set(this,r),n.capture,n.once,n.passive}},{key:"removeEventListener",value:function(e,t){var n=dp.get(this);if(n){var r=n[e];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===t){r.splice(i,1);break}}}},{key:"dispatchEvent",value:function(e){var t=dp.get(this)[e.type];if(t){var n,r=U(t);try{for(r.s();!(n=r.n()).done;){(0,n.value)(e)}}catch(e){r.e(e)}finally{r.f()}}}}]),e}(),gp=function(e){A(n,e);var t=O(n);function n(){var e;return b(this,n),E(I(e=t.call(this)),"childNodes",void 0),e.childNodes=[],e}return S(n,[{key:"appendChild",value:function(e){this.childNodes.push(e)}},{key:"cloneNode",value:function(){var e=Object.create(this);return Object.assign(e,this),e}},{key:"removeChild",value:function(e){var t=this.childNodes.findIndex((function(t){return t===e}));return t>-1?this.childNodes.splice(t,1):null}}]),n}(vp),mp=function(e){A(n,e);var t=O(n);function n(){var e;return b(this,n),E(I(e=t.call(this)),"className",void 0),E(I(e),"children",void 0),e.className="",e.children=[],e}return S(n,[{key:"setAttribute",value:function(e,t){this[e]=t}},{key:"getAttribute",value:function(e){return this[e]}},{key:"setAttributeNS",value:function(e,t){this[e]=t}},{key:"getAttributeNS",value:function(e){return this[e]}}]),n}(gp);if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var yp=my.getSystemInfoSync();lp=yp.screenWidth,hp=yp.screenHeight,fp=yp.windowWidth,pp=yp.windowHeight}else{var _p=ef.innerWidth,bp=ef.innerHeight;lp=_p,hp=bp,fp=_p,pp=bp}var xp={width:lp,height:hp,availWidth:fp,availHeight:pp,availLeft:0,availTop:0},Sp=xp.availWidth,Ep=xp.availHeight,Ap={style:[]};function wp(e,t){var n,r;"parentNode"in e||(n=0===t?function(){return null}:1===t?function(){return Ap}:function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:n}));"parentElement"in e||(r=0===t?function(){return null}:1===t?function(){return Ap}:function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:r}))}function Tp(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:Sp+"px",height:Ep+"px",margin:"0px",padding:"0px"})}function Cp(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=Sp,e.clientHeight=Ep),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function kp(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=Sp,e.offsetHeight=Ep)}function Mp(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=Sp,e.scrollHeight=Ep)}function Pp(e){var t=function(){return!0};e.classList=[],e.classList.add=t,e.classList.remove=t,e.classList.contains=t,e.classList.toggle=t}function Ip(){}var Lp=function(e){A(n,e);var t=O(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;return b(this,n),E(I(e=t.call(this)),"className",void 0),E(I(e),"children",void 0),E(I(e),"focus",void 0),E(I(e),"blur",void 0),E(I(e),"insertBefore",void 0),E(I(e),"appendChild",void 0),E(I(e),"removeChild",void 0),E(I(e),"remove",void 0),E(I(e),"innerHTML",void 0),E(I(e),"tagName",void 0),e.className="",e.children=[],e.focus=Ip,e.blur=Ip,e.insertBefore=Ip,e.appendChild=Ip,e.removeChild=Ip,e.remove=Ip,e.innerHTML="",e.tagName=r.toUpperCase(),wp(I(e),i),Tp(I(e)),Pp(I(e)),Cp(I(e)),kp(I(e)),Mp(I(e)),e}return S(n)}(mp),Op=function(e){A(n,e);var t=O(n);function n(e){return b(this,n),t.call(this,e)}return S(n,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),n}(Lp),Rp=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.call(this,"video")}return S(n)}(Op),Np={};function Dp(){return Np}var Fp=S((function e(){b(this,e);var t=Dp(),n=t.createImage&&t.createImage()||{};return"tagName"in n||(n.tagName="IMG",n.__proto__=e.prototype),wp(n),Pp(n),Object.assign(n,{addEventListener:function(e,t){n["on".concat(e)]=t.bind(n)},removeEventListener:function(e){n["on".concat(e)]=null}}),n})),Bp={href:"",protocol:"",host:""},zp=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.call(this,"body",0)}return S(n,[{key:"addEventListener",value:function(e,t){}},{key:"removeEventListener",value:function(e,t,n){}},{key:"dispatchEvent",value:function(e){}}]),n}(Lp),Up=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.call(this,"html",0)}return S(n,[{key:"addEventListener",value:function(e,t){}},{key:"removeEventListener",value:function(e,t){}},{key:"dispatchEvent",value:function(e){}}]),n}(Lp),jp={},Vp={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Bp,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(e){return"canvas"===(e=e.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===e?new Fp:"video"===e?new Rp:new Lp(e)},createElementNS:function(e,t){return this.createElement(t)},createTextNode:function(e){return e},getElementById:function(e){return null},getElementsByTagName:function(e){return e=e.toLowerCase(),[]},getElementsByTagNameNS:function(e,t){return this.getElementsByTagName(t)},getElementsByName:function(e){return[]},querySelector:function(e){return null},querySelectorAll:function(e){return[]},addEventListener:function(e,t,n){jp[e]||(jp[e]=[]),jp[e].push(t)},removeEventListener:function(e,t){var n=jp[e];if(n&&n.length>0)for(var r=n.length;r--;r>0)if(n[r]===t){n.splice(r,1);break}},dispatchEvent:function(e){var t=e.type,n=jp[t];if(n)for(var r=0;r<n.length;r++)n[r](e);e.target&&"function"==typeof e.target["on"+t]&&e.target["on"+t](e)},createEvent:function(e){return new lf(e)}};Vp.documentElement=new Up,Vp.head=new Lp("head"),Vp.body=new zp;var Gp=Object;ic("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0);var Hp,Wp,Yp,Xp,Zp=function(){function e(){b(this,e),E(this,"_w",void 0),E(this,"_h",void 0),E(this,"_data",void 0);var t=arguments.length;if(2===t){if("number"==typeof arguments[0]&&"number"==typeof arguments[1])return this._w=arguments[0],this._h=arguments[1],void(this._data=new Uint8ClampedArray(this._w*this._h*4))}else 3===t&&"object"===m(arguments[0])&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return S(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}();if(xh("match",(function(e,t,n){return[function(t){var n=ce(this),r=se(t)?void 0:ot(t,e);return r?qe(r,t,n):new RegExp(t)[e](wr(n))},function(e){var r=Xe(this),i=wr(e),o=n(t,r,i);if(o.done)return o.value;if(!r.global)return Fh(r,i);var a=r.unicode;r.lastIndex=0;for(var s,u=[],c=0;null!==(s=Fh(r,i));){var l=wr(s[0]);u[c]=l,""===l&&(r.lastIndex=kh(i,un(r.lastIndex),a)),c++}return 0===c?null:u}]})),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var qp=my.getSystemInfoSync();Hp=qp.system,Wp=qp.platform,Yp=qp.language}else{var Kp={versions:(Xp=ef.navigator.userAgent,{trident:Xp.indexOf("Trident")>-1,presto:Xp.indexOf("Presto")>-1,webKit:Xp.indexOf("AppleWebKit")>-1,gecko:Xp.indexOf("Gecko")>-1&&-1===Xp.indexOf("KHTML"),mobile:!!Xp.match(/AppleWebKit.*Mobile.*/),ios:!!Xp.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Xp.indexOf("Android")>-1||Xp.indexOf("Linux")>-1,iPhone:Xp.indexOf("iPhone")>-1,iPad:Xp.indexOf("iPad")>-1,webApp:-1===Xp.indexOf("Safari"),weixin:Xp.indexOf("MicroMessenger")>-1,qq:" qq"===Xp.match(/\sQQ/i)}),language:(ef.navigator.browserLanguage||ef.navigator.language).toLowerCase()};Kp.versions.android?Wp="android":Kp.versions.trident?Wp="IE":Kp.versions.presto?Wp="Opera":Kp.versions.webKit?Wp="webKit":Kp.versions.gecko?Wp="Firefox":Kp.versions.mobile?Wp="mobile":Kp.versions.ios?Wp="ios":Kp.versions.iPhone?Wp="iPhone":Kp.versions.iPad?Wp="ipad":Kp.versions.webApp?Wp="webApp":Kp.versions.weixin?Wp="weixin":Kp.versions.qq&&(Wp="qq"),Hp=ef.navigator.userAgent,Yp=Kp.language}var Qp=-1!==Hp.toLowerCase().indexOf("android")?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",$p="Mozilla/5.0 (".concat(Qp,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Yp),Jp={platform:Wp,language:Yp,appVersion:"5.0 (".concat(Qp,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:$p},ed=0;var td=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";b(this,e),E(this,"href",void 0),0!=t.indexOf("http://")&&0!=t.indexOf("https://")?this.href=n+t:this.href=t}return S(e,null,[{key:"createObjectURL",value:function(e){var t=e.buffers[0],n=e.type,r=function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return Jh(t)}(t);return"data:".concat(n,";base64, ")+r}}]),e}();var nd=Cf.fastKey,rd=Nt.set,id=Nt.getterFor,od={getConstructor:function(e,t,n,r){var i=e((function(e,i){Zr(e,o),rd(e,{type:t,index:Xa(null),first:void 0,last:void 0,size:0}),Fe||(e.size=0),se(i)||Uo(i,e[r],{that:e,AS_ENTRIES:n})})),o=i.prototype,a=id(t),s=function(e,t,n){var r,i,o=a(e),s=u(e,t);return s?s.value=n:(o.last=s={index:i=nd(t,!0),key:t,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=s),r&&(r.next=s),Fe?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},u=function(e,t){var n,r=a(e),i=nd(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return $s(o,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Fe?e.size=0:this.size=0},delete:function(e){var t=a(this),n=u(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first==n&&(t.first=r),t.last==n&&(t.last=i),Fe?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=a(this),r=$t(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),$s(o,n?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Fe&&Hr(o,"size",{configurable:!0,get:function(){return a(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=id(t),o=id(r);ys(e,t,(function(e,t){rd(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?_s("keys"==t?n.key:"values"==t?n.value:[n.key,n.value],!1):(e.target=void 0,_s(void 0,!0))}),n?"entries":"values",!n,!0),Yr(t)}};kf("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),od);var ad=ae([].join),sd=tn!=Object||!Tn("join",",");ar({target:"Array",proto:!0,forced:sd},{join:function(e){return ad(Rn(this),void 0===e?",":e)}});var ud=new Map,cd=new Map,ld=new Map,hd=function(e){A(n,e);var t=O(n);function n(){var e;return b(this,n),E(I(e=t.call(this)),"onabort",void 0),E(I(e),"onerror",void 0),E(I(e),"onload",void 0),E(I(e),"onloadstart",void 0),E(I(e),"onprogress",void 0),E(I(e),"ontimeout",void 0),E(I(e),"onloadend",void 0),E(I(e),"onreadystatechange",void 0),E(I(e),"readyState",void 0),E(I(e),"response",void 0),E(I(e),"responseText",void 0),E(I(e),"_responseType",void 0),E(I(e),"responseXML",void 0),E(I(e),"status",void 0),E(I(e),"statusText",void 0),E(I(e),"upload",void 0),E(I(e),"withCredentials",void 0),E(I(e),"timeout",void 0),E(I(e),"_url",void 0),E(I(e),"_method",void 0),e.onabort=null,e.onerror=null,e.onload=null,e.onloadstart=null,e.onprogress=null,e.ontimeout=null,e.onloadend=null,e.onreadystatechange=null,e.readyState=0,e.response=null,e.responseText=null,e._responseType="text",e.responseXML=null,e.status=0,e.statusText="",e.upload={},e.withCredentials=!1,ud.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),e}return S(n,[{key:"responseType",set:function(e){this._responseType=e}},{key:"abort",value:function(){var e=ld.get("requestTask");e&&e.abort()}},{key:"getAllResponseHeaders",value:function(){var e=cd.get("responseHeader");return Object.keys(e).map((function(t){return"".concat(t,": ").concat(e[t])})).join("\n")}},{key:"getResponseHeader",value:function(e){return cd.get("responseHeader")[e]}},{key:"open",value:function(e,t,n){this._method=e,this._url=t}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(e,t){var n=ud.get("requestHeader");n[e]=t,ud.set("requestHeader",n)}},{key:"addEventListener",value:function(e,t){var n=this;"function"==typeof t&&(this["on"+e]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.target=e.target||n,t.call(n,e)})}},{key:"removeEventListener",value:function(e,t){this["on"+e]===t&&(this["on"+e]=null)}}]),n}(vp);function fd(e){return function(t){t.type=e,Vp.dispatchEvent(t)}}E(hd,"UNSEND",void 0),E(hd,"OPENED",void 0),E(hd,"HEADERS_RECEIVED",void 0),E(hd,"LOADING",void 0),E(hd,"DONE",void 0),hd.UNSEND=0,hd.OPENED=1,hd.HEADERS_RECEIVED=2,hd.LOADING=3,hd.DONE=4;var pd=fd("mousedown"),dd=fd("mousemove"),vd=fd("mouseup"),gd=function(e){A(n,e);var t=O(n);function n(e){var r;return b(this,n),E(I(r=t.call(this,e)),"buttons",void 0),E(I(r),"which",void 0),E(I(r),"pointerId",void 0),E(I(r),"bubbles",void 0),E(I(r),"button",void 0),E(I(r),"width",void 0),E(I(r),"height",void 0),E(I(r),"pressure",void 0),E(I(r),"isPrimary",void 0),E(I(r),"pointerType",void 0),E(I(r),"altKey",void 0),E(I(r),"ctrlKey",void 0),E(I(r),"metaKey",void 0),E(I(r),"shiftKey",void 0),r.target=Dp(),r.currentTarget=Dp(),r}return S(n)}(lf),md=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],yd=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0];function _d(e,t,n){for(var r=new gd(e),i=0;i<md.length;i++){var o=md[i];r[o]=t[o]||yd[i]}return r.type=e,r.target=Dp(),r.currentTarget=Dp(),r.buttons=function(e){var t=0;"touchstart"!==e&&"touchmove"!==e&&"pointerdown"!==e&&"pointermove"!==e||(t=1);return t}(e),r.which=r.buttons,r.pointerId=(t.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=2*(t.radiusX||.5),r.height=2*(t.radiusY||.5),r.pressure=t.force||.5,r.isPrimary=function(e){return bd===e.identifier}(t),r.pointerType="touch",r.altKey=n.altKey,r.ctrlKey=n.ctrlKey,r.metaKey=n.metaKey,r.shiftKey=n.shiftKey,n.preventDefault&&(r.preventDefault=function(){n.preventDefault()}),r}var bd=null;function xd(e){null===bd&&(bd=e.identifier)}function Sd(e){bd===e.identifier&&(bd=null)}function Ed(e){return function(t){for(var n=t.changedTouches,r=0;r<n.length;r++){var i=n[r];0===r&&"pointerdown"===e?xd(i):"pointerup"!==e&&"pointercancel"!==e||Sd(i);var o=_d(e,i,t);Vp.dispatchEvent(o)}}}var Ad=Ed("pointerdown"),wd=Ed("pointermove"),Td=Ed("pointerup"),Cd=function(e){A(n,e);var t=O(n);function n(e){var r;return b(this,n),E(I(r=t.call(this,e)),"touches",void 0),E(I(r),"targetTouches",void 0),E(I(r),"changedTouches",void 0),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=Dp(),r.currentTarget=Dp(),r}return S(n)}(lf);function kd(e){var t=e||{},n=t.x,r=void 0===n?0:n,i=t.y,o=void 0===i?0:i,a=t.clientX,s=void 0===a?0:a,u=t.clientY,c=void 0===u?0:u;-1!==Object.keys(e).indexOf("x")?(e.pageX=e.clientX=r,e.pageY=e.clientY=o):(e.x=s,e.y=c)}function Md(e){return function(t){var n=new Cd(e);n.changedTouches=t.changedTouches,n.touches=t.touches,n.targetTouches=Array.prototype.slice.call(t.touches),n.timeStamp=t.timeStamp,n.changedTouches.forEach((function(e){return kd(e)})),n.touches.forEach((function(e){return kd(e)})),n.targetTouches.forEach((function(e){return kd(e)})),Vp.dispatchEvent(n)}}var Pd,Id=Md("touchstart"),Ld=Md("touchmove"),Od=Md("touchend"),Rd=(Pd="mapCameaParams",function(e){e.type=Pd,Vp.dispatchEvent(e)});function Nd(t){e.isMiniScene=t}e.isMiniScene=!1;var Dd="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Fd="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Bd=(Dd||Fd)&&e.isMiniScene,zd={atob:function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new $h("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i="",o=0,a=0;r=t.charAt(a++);~r&&(n=o%4?64*n+r:r,o++%4)?i+=String.fromCharCode(255&n>>(-2*o&6)):0)r=Qh.indexOf(r);return i},btoa:Jh,devicePixelRatio:nf,Blob:tf,document:Vp,Element:mp,Event:lf,EventTarget:vp,HTMLCanvasElement:Gp,HTMLElement:Lp,HTMLMediaElement:Op,HTMLVideoElement:Rp,Image:Fp,ImageData:Zp,navigator:Jp,Node:gp,requestAnimationFrame:function(e){var t=Dp();return t.requestAnimationFrame?t.requestAnimationFrame(e):function(e){var t=Date.now(),n=Math.max(ed+23,t);return setTimeout((function(){e(ed=n)}),n-t)}(e)},cancelAnimationFrame:function(e){var t=Dp();return t.cancelAnimationFrame?t.cancelAnimationFrame(e):clearTimeout(e)},screen:xp,XMLHttpRequest:hd,performance:{mark:function(e){return null},clearMeasures:function(e){return null},clearMarks:function(e){return null},measure:function(e,t,n){return{duration:0}},now:function(){}},URL:td,WebGLRenderingContext:{GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},WebGL2RenderingContext:{},addEventListener:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Vp.addEventListener(e,t,n)},removeEventListener:function(e,t,n){Vp.removeEventListener(e,t)},dispatchEvent:function(e){Vp.dispatchEvent(e)},innerWidth:xp.availWidth,innerHeight:xp.availHeight,setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval},Ud=Bd?zd:ef,jd=Bd?hd:ef.XMLHttpRequest,Vd=Bd?Bp:ef.location,Gd=function(e){A(n,e);var t=O(n);function n(e,r,i,o){var a;return b(this,n),E(I(a=t.call(this,"AJAXError: ".concat(r," (").concat(e,"): ").concat(i))),"status",void 0),E(I(a),"statusText",void 0),E(I(a),"url",void 0),E(I(a),"body",void 0),a.status=e,a.statusText=r,a.url=i,a.body=o,a}return S(n)}(M(Error));function Hd(e,t){var n=new jd,r=Array.isArray(e.url)?e.url[0]:e.url;for(var i in n.open(e.method||"GET",r,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)e.headers.hasOwnProperty(i)&&n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});t(new Gd(n.status,n.statusText,r.toString(),o))}},n.send(e.body),n}function Wd(e){return new Promise((function(t,n){Hd(e,(function(e,r,i,o,a){e?n({err:e,data:null,xhr:a}):t({err:null,data:r,cacheControl:i,expires:o,xhr:a})}))}))}function Yd(e,t){return Hd(e,t)}var Xd=function(e,t){return Yd(v(v({},e),{},{type:"json"}),t)},Zd=function(e,t){return Yd(v(v({},e),{},{type:"arrayBuffer"}),t)};var qd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Kd(e,t){var n=new Ud.Image,r=Ud.URL||Ud.webkitURL;n.crossOrigin="anonymous",n.onload=function(){t(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((function(){n.src=qd}))},n.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?r.createObjectURL(i):qd}function Qd(e,t){var n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}var $d=function(e,t,n){var r=function(e,r){if(e)t(e);else if(r){var i="function"==typeof createImageBitmap,o=n?n(r):r;i?Qd(o,t):Kd(o,t)}};return"json"===e.type?Xd(e,r):Zd(e,r)},Jd=function(e,t){"function"==typeof createImageBitmap?Qd(e,t):Kd(e,t)},ev=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),tv={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function nv(e,t,n){var r=e.classList;for(var i in tv)tv.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(t))}function rv(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function iv(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function ov(){}ar({target:"Array",proto:!0},{fill:cu}),es("fill");var av="\\s*([+-]?\\d+)\\s*",sv="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",uv="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",cv=/^#([0-9a-f]{3,8})$/,lv=new RegExp("^rgb\\("+[av,av,av]+"\\)$"),hv=new RegExp("^rgb\\("+[uv,uv,uv]+"\\)$"),fv=new RegExp("^rgba\\("+[av,av,av,sv]+"\\)$"),pv=new RegExp("^rgba\\("+[uv,uv,uv,sv]+"\\)$"),dv=new RegExp("^hsl\\("+[sv,uv,uv]+"\\)$"),vv=new RegExp("^hsla\\("+[sv,uv,uv,sv]+"\\)$"),gv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function mv(){return this.rgb().formatHex()}function yv(){return this.rgb().formatRgb()}function _v(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=cv.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?bv(t):3===n?new Av(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?xv(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?xv(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=lv.exec(e))?new Av(t[1],t[2],t[3],1):(t=hv.exec(e))?new Av(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=fv.exec(e))?xv(t[1],t[2],t[3],t[4]):(t=pv.exec(e))?xv(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=dv.exec(e))?kv(t[1],t[2]/100,t[3]/100,1):(t=vv.exec(e))?kv(t[1],t[2]/100,t[3]/100,t[4]):gv.hasOwnProperty(e)?bv(gv[e]):"transparent"===e?new Av(NaN,NaN,NaN,0):null}function bv(e){return new Av(e>>16&255,e>>8&255,255&e,1)}function xv(e,t,n,r){return r<=0&&(e=t=n=NaN),new Av(e,t,n,r)}function Sv(e){return e instanceof ov||(e=_v(e)),e?new Av((e=e.rgb()).r,e.g,e.b,e.opacity):new Av}function Ev(e,t,n,r){return 1===arguments.length?Sv(e):new Av(e,t,n,null==r?1:r)}function Av(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function wv(){return"#"+Cv(this.r)+Cv(this.g)+Cv(this.b)}function Tv(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Cv(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function kv(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Pv(e,t,n,r)}function Mv(e){if(e instanceof Pv)return new Pv(e.h,e.s,e.l,e.opacity);if(e instanceof ov||(e=_v(e)),!e)return new Pv;if(e instanceof Pv)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=t===o?(n-r)/s+6*(n<r):n===o?(r-t)/s+2:(t-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new Pv(a,s,u,e.opacity)}function Pv(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Iv(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Lv(e){var t=_v(e),n=[0,0,0,0];return null!=t&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function Ov(e){return(e&&e[0])+256*(e&&e[1])+65536*(e&&e[2])-1}function Rv(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Nv(e){var t=Ud.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=null,i=n.createLinearGradient(0,0,256,1),o=e.positions[0],a=e.positions[e.positions.length-1],s=0;s<e.colors.length;++s){var u=(e.positions[s]-o)/(a-o);i.addColorStop(u,e.colors[s])}if(n.fillStyle=i,n.fillRect(0,0,256,1),Bd)return r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),t=null,n=null,{data:r,width:256,height:1};r=n.getImageData(0,0,256,1).data;for(var c=n.createImageData(256,1),l=0;l<c.data.length;l+=4)c.data[l+0]=r[l+0],c.data[l+1]=r[l+1],c.data[l+2]=r[l+2],c.data[l+3]=r[l+3];return t=null,n=null,c}function Dv(e,t){var n=Ud.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=t[1]-t[0],a=0;a<e.colors.length;++a){var s=Math.max((e.positions[a]-t[0])/o,0);i.addColorStop(s,e.colors[a])}r.fillStyle=i,r.fillRect(0,0,256,1);var u=r.getImageData(0,0,256,1).data,c=Uv(r,u);return n=null,r=null,c}function Fv(e){var t=Ud.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;var r=n.createImageData(256,1);return r.data.fill(0),e.positions.forEach((function(t,n){var i=Lv(e.colors[n]);r.data[4*t+0]=255*i[0],r.data[4*t+1]=255*i[1],r.data[4*t+2]=255*i[2],r.data[4*t+3]=255*i[3]})),t=null,n=null,r}function Bv(e){var t=Ud.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;for(var r=256/e.colors.length,i=0;i<e.colors.length;i++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[i],n.moveTo(i*r,0),n.lineTo((i+1)*r,0),n.stroke();var o=n.getImageData(0,0,256,1).data,a=Uv(n,o);return t=null,n=null,a}function zv(e,t){var n=Ud.document.createElement("canvas"),r=n.getContext("2d");r.globalAlpha=1,n.width=256,n.height=1;var i=t[1]-t[0];e.positions.length-e.colors.length!=1&&console.warn("positions çæ°å­ä¸ªæ°åºå½æ¯ colors çæ ·å¼å¤ä¸ä¸ª,poisitions çé¦å°¾å¼ä¸è¬ä¸ºæ°æ®çæå¤§ææ°å¼");for(var o=0;o<e.colors.length;o++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[o],r.moveTo((e.positions[o]-t[0])/i*255,0),r.lineTo((e.positions[o+1]-t[0])/i*255,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=Uv(r,a);return n=null,r=null,s}function Uv(e,t){for(var n=e.createImageData(256,1),r=0;r<n.data.length;r+=4)n.data[r+0]=t[r+0],n.data[r+1]=t[r+1],n.data[r+2]=t[r+2],n.data[r+3]=t[r+3];return n}function jv(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}rv(ov,_v,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:mv,formatHex:mv,formatHsl:function(){return Mv(this).formatHsl()},formatRgb:yv,toString:yv}),rv(Av,Ev,iv(ov,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new Av(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Av(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:wv,formatHex:wv,formatRgb:Tv,toString:Tv})),rv(Pv,(function(e,t,n,r){return 1===arguments.length?Mv(e):new Pv(e,t,n,null==r?1:r)}),iv(ov,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new Pv(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Pv(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Av(Iv(e>=240?e-240:e+120,i,r),Iv(e,i,r),Iv(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var Vv=1029,Gv=1028;function Hv(e){switch(e){case"GAODE1.x":case"GAODE2.x":return Vv;case"MAPBOX":case"SIMPLE":return Gv;case"GLOBEL":return Vv;case"DEBAULT":default:return Gv}}var Wv=function(e){return e};var Yv=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},Xv=Math.max;var Zv=function(e,t,n){return t=Xv(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=Xv(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),Yv(e,this,s)}};var qv=function(e){return function(){return e}},Kv="object"==typeof H&&H&&H.Object===Object&&H,Qv="object"==typeof self&&self&&self.Object===Object&&self,$v=Kv||Qv||Function("return this")(),Jv=$v.Symbol,eg=Object.prototype,tg=eg.hasOwnProperty,ng=eg.toString,rg=Jv?Jv.toStringTag:void 0;var ig=function(e){var t=tg.call(e,rg),n=e[rg];try{e[rg]=void 0;var r=!0}catch(e){}var i=ng.call(e);return r&&(t?e[rg]=n:delete e[rg]),i},og=Object.prototype.toString;var ag=function(e){return og.call(e)},sg=Jv?Jv.toStringTag:void 0;var ug=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":sg&&sg in Object(e)?ig(e):ag(e)};var cg=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var lg=function(e){if(!cg(e))return!1;var t=ug(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},hg=$v["__core-js_shared__"],fg=function(){var e=/[^.]+$/.exec(hg&&hg.keys&&hg.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var pg=function(e){return!!fg&&fg in e},dg=Function.prototype.toString;var vg=function(e){if(null!=e){try{return dg.call(e)}catch(e){}try{return e+""}catch(e){}}return""},gg=/^\[object .+?Constructor\]$/,mg=Function.prototype,yg=Object.prototype,_g=mg.toString,bg=yg.hasOwnProperty,xg=RegExp("^"+_g.call(bg).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Sg=function(e){return!(!cg(e)||pg(e))&&(lg(e)?xg:gg).test(vg(e))};var Eg=function(e,t){return null==e?void 0:e[t]};var Ag=function(e,t){var n=Eg(e,t);return Sg(n)?n:void 0},wg=function(){try{var e=Ag(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Tg=wg?function(e,t){return wg(e,"toString",{configurable:!0,enumerable:!1,value:qv(t),writable:!0})}:Wv,Cg=Date.now;var kg=function(e){var t=0,n=0;return function(){var r=Cg(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Tg);var Mg=function(e,t){return kg(Zv(e,t,Wv),e+"")};var Pg=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var Ig=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1};var Lg=function(e){return e!=e};var Og=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1};var Rg=function(e,t,n){return t==t?Og(e,t,n):Ig(e,Lg,n)};var Ng=function(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1};var Dg=function(e){return function(t){return e(t)}};var Fg=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},Bg=Array.prototype.splice;var zg=function(e,t,n,r){var i=r?Ng:Rg,o=-1,a=t.length,s=e;for(e===t&&(t=Fg(t)),n&&(s=Pg(e,Dg(n)));++o<a;)for(var u=0,c=t[o],l=n?n(c):c;(u=i(s,l,u,r))>-1;)s!==e&&Bg.call(s,u,1),Bg.call(e,u,1);return e};var Ug,jg=Mg((function(e,t){return e&&e.length&&t&&t.length?zg(e,t):e})),Vg="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",Gg=ae("".replace),Hg=RegExp("^["+Vg+"]+"),Wg=RegExp("(^|[^"+Vg+"])["+Vg+"]+$"),Yg=function(e){return function(t){var n=wr(ce(t));return 1&e&&(n=Gg(n,Hg,"")),2&e&&(n=Gg(n,Wg,"$1")),n}},Xg={start:Yg(1),end:Yg(2),trim:Yg(3)},Zg=yt.PROPER,qg=Xg.trim;ar({target:"String",proto:!0,forced:(Ug="trim",te((function(){return!!Vg[Ug]()||"âÂá "!=="âÂá "[Ug]()||Zg&&Vg[Ug].name!==Ug})))},{trim:function(){return qg(this)}});var Kg=Pe("match"),Qg=function(e){var t;return ze(e)&&(void 0!==(t=e[Kg])?!!t:"RegExp"==Ut(e))},$g=nh.UNSUPPORTED_Y,Jg=Math.min,em=[].push,tm=ae(/./.exec),nm=ae(em),rm=ae("".slice);xh("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=wr(ce(this)),i=void 0===n?4294967295:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!Qg(e))return qe(t,r,e,i);for(var o,a,s,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,h=new RegExp(e.source,c+"g");(o=qe(yh,h,r))&&!((a=h.lastIndex)>l&&(nm(u,rm(r,l,o.index)),o.length>1&&o.index<r.length&&ni(em,u,fu(o,1)),s=o[0].length,l=a,u.length>=i));)h.lastIndex===o.index&&h.lastIndex++;return l===r.length?!s&&tm(h,"")||nm(u,""):nm(u,rm(r,l)),u.length>i?fu(u,0,i):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:qe(t,this,e,n)}:t,[function(t,n){var i=ce(this),o=se(t)?void 0:ot(t,e);return o?qe(o,t,i,n):qe(r,wr(i),t,n)},function(e,i){var o=Xe(this),a=wr(e),s=n(r,o,a,i,r!==t);if(s.done)return s.value;var u=$r(o,RegExp),c=o.unicode,l=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+($g?"g":"y"),h=new u($g?"^(?:"+o.source+")":o,l),f=void 0===i?4294967295:i>>>0;if(0===f)return[];if(0===a.length)return null===Fh(h,a)?[a]:[];for(var p=0,d=0,v=[];d<a.length;){h.lastIndex=$g?0:d;var g,m=Fh(h,$g?rm(a,d):a);if(null===m||(g=Jg(un(h.lastIndex+($g?d:0)),a.length))===p)d=kh(a,d,c);else{if(nm(v,rm(a,p,d)),v.length===f)return v;for(var y=1;y<=m.length-1;y++)if(nm(v,m[y]),v.length===f)return v;d=p=g}}return nm(v,rm(a,p)),v}]}),!!te((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),$g);var im=dt.f,om=function(e,t,n){n in e||im(e,n,{configurable:!0,get:function(){return t[n]},set:function(e){t[n]=e}})},am=Xn.f,sm=Nt.enforce,um=Pe("match"),cm=K.RegExp,lm=cm.prototype,hm=K.SyntaxError,fm=ae(lm.exec),pm=ae("".charAt),dm=ae("".replace),vm=ae("".indexOf),gm=ae("".slice),mm=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,ym=/a/g,_m=/a/g,bm=new cm(ym)!==ym,xm=nh.MISSED_STICKY,Sm=nh.UNSUPPORTED_Y,Em=Fe&&(!bm||xm||ih||ah||te((function(){return _m[um]=!1,cm(ym)!=ym||cm(_m)==_m||"/a/i"!=cm(ym,"i")})));if(ir("RegExp",Em)){for(var Am=function(e,t){var n,r,i,o,a,s,u=$e(lm,this),c=Qg(e),l=void 0===t,h=[],f=e;if(!u&&c&&l&&e.constructor===Am)return e;if((c||$e(lm,e))&&(e=e.source,l&&(t=kr(f))),e=void 0===e?"":wr(e),t=void 0===t?"":wr(t),f=e,ih&&"dotAll"in ym&&(r=!!t&&vm(t,"s")>-1)&&(t=dm(t,/s/g,"")),n=t,xm&&"sticky"in ym&&(i=!!t&&vm(t,"y")>-1)&&Sm&&(t=dm(t,/y/g,"")),ah&&(e=(o=function(e){for(var t,n=e.length,r=0,i="",o=[],a={},s=!1,u=!1,c=0,l="";r<=n;r++){if("\\"===(t=pm(e,r)))t+=pm(e,++r);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:fm(mm,gm(e,r+1))&&(r+=2,u=!0),i+=t,c++;continue;case">"===t&&u:if(""===l||pe(a,l))throw new hm("Invalid capture group name");a[l]=!0,o[o.length]=[l,c],u=!1,l="";continue}u?l+=t:i+=t}return[i,o]}(e))[0],h=o[1]),a=rc(cm(e,t),u?this:lm,Am),(r||i||h.length)&&(s=sm(a),r&&(s.dotAll=!0,s.raw=Am(function(e){for(var t,n=e.length,r=0,i="",o=!1;r<=n;r++)"\\"!==(t=pm(e,r))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),i+=t):i+="[\\s\\S]":i+=t+pm(e,++r);return i}(e),n)),i&&(s.sticky=!0),h.length&&(s.groups=h)),e!==f)try{Ct(a,"source",""===f?"(?:)":f)}catch(e){}return a},wm=am(cm),Tm=0;wm.length>Tm;)om(Am,cm,wm[Tm++]);lm.constructor=Am,Am.prototype=lm,Ft(K,"RegExp",Am,{constructor:!0})}Yr("RegExp");var Cm=wn.find,km=!0;"find"in[]&&Array(1).find((function(){km=!1})),ar({target:"Array",proto:!0,forced:km},{find:function(e){return Cm(this,e,arguments.length>1?arguments[1]:void 0)}}),es("find");var Mm=On.f,Pm=ae(Mm),Im=ae([].push),Lm=function(e){return function(t){for(var n,r=Rn(t),i=Ba(r),o=i.length,a=0,s=[];o>a;)n=i[a++],Fe&&!Pm(r,n)||Im(s,e?[n,r[n]]:r[n]);return s}},Om={entries:Lm(!0),values:Lm(!1)},Rm=Om.entries;function Nm(e){var t=e;return"string"==typeof e&&(t=Ud.document.getElementById(e)),t}function Dm(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Fm(e){return Dm(e).split(/\s+/)}function Bm(e,t,n){var r=Ud.document.createElement(e);return t&&(r.className=t||""),n&&n.appendChild(r),r}function zm(e){var t=e.parentNode;t&&t.removeChild(e)}function Um(e,t){if(void 0!==e.classList)for(var n=Fm(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!Vm(e,t)){var o=Hm(e);Gm(e,(o?o+" ":"")+t)}}function jm(e,t){void 0!==e.classList?Fm(t).forEach((function(t){e.classList.remove(t)})):Gm(e,Dm((" "+Hm(e)+" ").replace(" "+t+" "," ")))}function Vm(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=Hm(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function Gm(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function Hm(e){return e instanceof SVGElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}ar({target:"Object",stat:!0},{entries:function(e){return Rm(e)}});var Wm=function(e){var t,n,r=null==Ud||null===(t=Ud.document)||void 0===t||null===(n=t.documentElement)||void 0===n?void 0:n.style;if(!r)return e[0];for(var i in e)if(e[i]&&e[i]in r)return e[i];return e[0]}(["transform","WebkitTransform"]);function Ym(e,t){e.style[Wm]=t}function Xm(){if("function"==typeof Event)Ud.dispatchEvent(new Event("resize"));else{var e=Ud.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Ud,0),Ud.dispatchEvent(e)}}function Zm(){var e,t=Ud.document.querySelector('meta[name="viewport"]');if(!t)return 1;var n=(null===(e=t.content)||void 0===e?void 0:e.split(",")).find((function(e){return"initial-scale"===D(e.split("="),1)[0]}));return n?1*n.split("=")[1]:1}var qm=Zm()<1?1:Ud.devicePixelRatio;function Km(e,t){e.setAttribute("style","".concat(e.style.cssText).concat(t))}function Qm(e){return e.split(";").map((function(e){return e.trim()})).filter((function(e){return e}))}function $m(e){return Object.entries(e).map((function(e){var t=D(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)})).join(";")}function Jm(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function ey(e,t){e.checked=t,t?e.setAttribute("checked","true"):e.removeAttribute("checked")}function ty(e){e.innerHTML=""}function ny(e){e.setAttribute("draggable","false")}function ry(e,t){if("string"==typeof t){var n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.append(n.firstChild)}else Array.isArray(t)?e.append.apply(e,F(t)):e.append(t)}var iy,oy=Object.freeze({__proto__:null,getContainer:Nm,trim:Dm,splitWords:Fm,create:Bm,remove:zm,addClass:Um,removeClass:jm,hasClass:Vm,setClass:Gm,getClass:Hm,empty:function(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)},setTransform:Ym,triggerResize:Xm,printCanvas:function(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log("%c\n",t.join(""))},getViewPortScale:Zm,DPR:qm,addStyle:Km,getStyleList:Qm,removeStyle:function(e,t){var n,r=Qm(null!==(n=e.getAttribute("style"))&&void 0!==n?n:""),i=Qm(t),o=jg.apply(void 0,[r].concat(F(i)));e.setAttribute("style",o.join(";"))},css2Style:$m,getDiffRect:Jm,setChecked:ey,clearChildren:ty,setUnDraggable:ny,appendElementType:ry});function ay(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}function sy(){return"function"==typeof importScripts}var uy=sy()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===window.location.protocol?window.parent:window).location.href},cy=null===(iy=navigator)||void 0===iy?void 0:iy.userAgent,ly=!!cy.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),hy=cy.indexOf("Android")>-1||cy.indexOf("Adr")>-1;function fy(){for(var e=cy,t=!0,n=0,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];n<r.length;n++){var i=r[n];if(e.indexOf(i)>0){t=!1;break}}return t}function py(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}var dy=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;b(this,e),E(this,"duration",16),E(this,"timestamp",(new Date).getTime()),this.duration=t}return S(e,[{key:"run",value:function(e){var t=(new Date).getTime(),n=t-this.timestamp;this.timestamp=t,n>=this.duration&&e()}}]),e}(),vy=K,gy=ae(1..valueOf),yy=Xn.f,_y=Dn.f,by=dt.f,xy=Xg.trim,Sy=K.Number,Ey=(vy.Number,Sy.prototype),Ay=K.TypeError,wy=ae("".slice),Ty=ae("".charCodeAt),Cy=function(e){var t=ct(e,"number");return"bigint"==typeof t?t:ky(t)},ky=function(e){var t,n,r,i,o,a,s,u,c=ct(e,"number");if(et(c))throw Ay("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=xy(c),43===(t=Ty(c,0))||45===t){if(88===(n=Ty(c,2))||120===n)return NaN}else if(48===t){switch(Ty(c,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(a=(o=wy(c,2)).length,s=0;s<a;s++)if((u=Ty(o,s))<48||u>i)return NaN;return parseInt(o,r)}return+c},My=ir("Number",!Sy(" 0o1")||!Sy("0b1")||Sy("+0x1")),Py=function(e){return $e(Ey,e)&&te((function(){gy(e)}))},Iy=function(e){var t=arguments.length<1?0:Sy(Cy(e));return Py(this)?rc(Object(t),this,Iy):t};Iy.prototype=Ey,My&&(Ey.constructor=Iy),ar({global:!0,constructor:!0,wrap:!0,forced:My},{Number:Iy});My&&function(e,t){for(var n,r=Fe?yy(t):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),i=0;r.length>i;i++)pe(t,n=r[i])&&!pe(e,n)&&by(e,n,_y(t,n))}(vy.Number,Sy);var Ly=RangeError,Oy=function(e){var t=wr(ce(this)),n="",r=an(e);if(r<0||r==1/0)throw Ly("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},Ry=RangeError,Ny=String,Dy=Math.floor,Fy=ae(Oy),By=ae("".slice),zy=ae(1..toFixed),Uy=function(e,t,n){return 0===t?n:t%2==1?Uy(e,t-1,n*e):Uy(e*e,t/2,n)},jy=function(e,t,n){for(var r=-1,i=n;++r<6;)i+=t*e[r],e[r]=i%1e7,i=Dy(i/1e7)},Vy=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=Dy(r/t),r=r%t*1e7},Gy=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=Ny(e[t]);n=""===n?r:n+Fy("0",7-r.length)+r}return n},Hy=te((function(){return"0.000"!==zy(8e-5,3)||"1"!==zy(.9,0)||"1.25"!==zy(1.255,2)||"1000000000000000128"!==zy(0xde0b6b3a7640080,0)}))||!te((function(){zy({})}));function Wy(e){var t=[1/0,1/0,-1/0,-1/0];return function e(t,n,r){if(null!==t)for(var i,o,a,s,u,c,l,h,f=0,p=0,d=t.type,v="FeatureCollection"===d,g="Feature"===d,m=v?t.features.length:1,y=0;y<m;y++){u=(h=!!(l=v?t.features[y].geometry:g?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var _=0;_<u;_++){var b=0,x=0;if(null!==(s=h?l.geometries[_]:l)){c=s.coordinates;var S=s.type;switch(f=!r||"Polygon"!==S&&"MultiPolygon"!==S?0:1,S){case null:break;case"Point":if(!1===n(c,p,y,b,x))return!1;p++,b++;break;case"LineString":case"MultiPoint":for(i=0;i<c.length;i++){if(!1===n(c[i],p,y,b,x))return!1;p++,"MultiPoint"===S&&b++}"LineString"===S&&b++;break;case"Polygon":case"MultiLineString":for(i=0;i<c.length;i++){for(o=0;o<c[i].length-f;o++){if(!1===n(c[i][o],p,y,b,x))return!1;p++}"MultiLineString"===S&&b++,"Polygon"===S&&x++}"Polygon"===S&&b++;break;case"MultiPolygon":for(i=0;i<c.length;i++){for(x=0,o=0;o<c[i].length;o++){for(a=0;a<c[i][o].length-f;a++){if(!1===n(c[i][o][a],p,y,b,x))return!1;p++}x++}b++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===e(s.geometries[i],n,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}function Yy(e){return"number"==typeof e}ar({target:"Number",proto:!0,forced:Hy},{toFixed:function(e){var t,n,r,i,o=gy(this),a=an(e),s=[0,0,0,0,0,0],u="",c="0";if(a<0||a>20)throw Ry("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return Ny(o);if(o<0&&(u="-",o=-o),o>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(o*Uy(2,69,1))-69)<0?o*Uy(2,-t,1):o/Uy(2,t,1),n*=4503599627370496,(t=52-t)>0){for(jy(s,0,n),r=a;r>=7;)jy(s,1e7,0),r-=7;for(jy(s,Uy(10,r,1),0),r=t-1;r>=23;)Vy(s,1<<23),r-=23;Vy(s,1<<r),jy(s,1,1),Vy(s,2),c=Gy(s)}else jy(s,0,n),jy(s,1<<-t,0),c=Gy(s)+Fy("0",a);return c=a>0?u+((i=c.length)<=a?"0."+Fy("0",a-i)+c:By(c,0,i-a)+"."+By(c,i-a)):u+c}}),Wy.default=Wy;var Xy=2*Math.PI*6378137/2;function Zy(e,t){var n=D(t,4),r=n[0],i=n[1],o=n[2],a=n[3];return e.lng>r&&e.lng<=o&&e.lat>i&&e.lat<=a}function qy(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach((function(e){var n=e.coordinates;!function e(t,n){Array.isArray(n[0])?n.forEach((function(n){e(t,n)})):(t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1]));return t}(t,n)})),t}function Ky(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(e=Jy(e,t))[0],i=e[1],o=r*Xy/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*Xy/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===e.length?[o,a,e[2]]:[o,a]}function Qy(e){if(null==e)throw new Error("lng is required");return(e>180||e<-180)&&((e%=360)>180&&(e=-360+e),e<-180&&(e=360+e),0===e&&(e=0)),e}function $y(e){if(null==e)throw new Error("lat is required");return(e>90||e<-90)&&((e%=180)>90&&(e=-180+e),e<-90&&(e=180+e),0===e&&(e=0)),e}function Jy(e,t){if(!1===t)return e;var n=Qy(e[0]),r=$y(e[1]);return r>85&&(r=85),r<-85&&(r=-85),3===e.length?[n,r,e[2]]:[n,r]}function e_(e){var t=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),n=Math.PI/180,r=e[0]*n,i=t*n;i=Math.log(Math.tan(Math.PI/4+i/2));return r=(256<<20)*(.5/Math.PI*r+.5),i=(256<<20)*(-.5/Math.PI*i+(n=.5)),[Math.floor(r),Math.floor(i)]}function t_(e,t){var n=85.0511287798,r=Math.PI/180;return t=Math.max(Math.min(n,t),-n),t*=r,[6378137*(e*=r),6378137*(t=Math.log(Math.tan(Math.PI/4+t/2)))]}function n_(e,t){var n=Math.PI/180;return[e/6378137/n,2*(Math.atan(Math.exp(t/6378137))-Math.PI/4)/n]}function r_(e,t,n){var r=_r(t[1]-e[1]),i=_r(t[0]-e[0]),o=_r(e[1]),a=_r(t[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return function(e,t){void 0===t&&(t="kilometers");var n=dr[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function i_(e,t){var n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function o_(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function a_(e){return[[e[0],e[1]],[e[2],e[3]]]}function s_(e){var t=u_(e,[0,0]);return[e[0]/t,e[1]/t]}function u_(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function c_(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function l_(e,t){return t[0]>0?t[1]>0?90-180*Math.atan(t[1]/t[0])/Math.PI:90+180*Math.atan(-t[1]/t[0])/Math.PI:t[1]<0?90-180*Math.atan(t[1]/t[0])/Math.PI+180:270+180*Math.atan(t[1]/-t[0])/Math.PI}function h_(e){if(Yy(e[0]))return e;if(Yy(e[0][0]))throw new Error("å½åæ°æ®ä¸æ¯ææ æ³¨");if(Yy(e[0][0][0])){var t=0,n=0,r=0;return e.forEach((function(e){e.forEach((function(e){t+=e[0],n+=e[1],r++}))})),[t/r,n/r,0]}throw new Error("å½åæ°æ®ä¸æ¯ææ æ³¨")}function f_(e){for(var t=e[0],n=e[1],r=e[0],i=e[1],o=0,a=0,s=0,u=0;u<e.length;u+=2){var c=e[u],l=e[u+1];c&&l&&(t=Math.max(c,t),n=Math.max(l,n),r=Math.min(c,r),i=Math.min(l,i),o+=c,a+=l,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(t-r,2)+Math.pow(n-i,2))/2}}function p_(e){return Wy(function(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}([mr(e)]))}function d_(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var v_=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function g_(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=arguments.length>6?arguments[6]:void 0,s=n;return a&&(s=Math.round(n*(o-1))/(o-1)),__(e,t,s,r||.314,i)}function m_(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function y_(e,t,n){var r,i,o=[t[0]-e[0],t[1]-e[1]],a=(r=o,i=[0,0],Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2))),s=Math.atan2(o[1],o[0]),u=a/2/Math.cos(n),c=s+n;return[u*Math.cos(c)+e[0],u*Math.sin(c)+e[1]]}function __(e,t,n,r,i){if(i===v_["GAODE2.x"]){var o=t_(e[0],e[1]),a=t_(t[0],t[1]),s=y_(o,a,r),u=[o[0],s[0],a[0]],c=[o[1],s[1],a[1]];return[].concat(F(n_(m_(u,n),m_(c,n))),[0])}var l=y_(e,t,r),h=[e[0],l[0],t[0]],f=[e[1],l[1],t[1]];return[m_(h,n),m_(f,n),0]}function b_(e,t,n,r,i){var o=arguments.length>6?arguments[6]:void 0,a=n;return o&&(a=Math.round(29*n)/29),S_(e,t,a,i)}function x_(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function S_(e,t,n,r){var i=[_r(e[0]),_r(e[1])],o=[_r(t[0]),_r(t[1])];if("GAODE2.x"===r){var a=function(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=u_(n,[0,0]),i=Math.atan2(n[1],n[0]),o=r/2/Math.cos(.314),a=i+.314;return[o*Math.cos(a)+e[0],o*Math.sin(a)+e[1]]}(i,o),s=[i[0],a[0],o[0]],u=[i[1],a[1],o[1]];return[x_(s,n),x_(u,n),0]}var c=function(e,t){var n=[e[0]-t[0],e[1]-t[1]],r=[Math.sin(n[0]/2),Math.sin(n[1]/2)],i=r[1]*r[1]+Math.cos(e[1])*Math.cos(t[1])*r[0]*r[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}(i,o);if(Math.abs(c-Math.PI)<.001)return[(1-n)*i[0]+n*o[0],(1-n)*i[1]+n*o[1]];var l=Math.sin((1-n)*c)/Math.sin(c),h=Math.sin(n*c)/Math.sin(c),f=[Math.sin(i[0]),Math.sin(i[1])],p=[Math.cos(i[0]),Math.cos(i[1])],d=[Math.sin(o[0]),Math.sin(o[1])],v=[Math.cos(o[0]),Math.cos(o[1])],g=l*p[1]*p[0]+h*v[1]*v[0],m=l*p[1]*f[0]+h*v[1]*d[0],y=l*f[1]+h*d[1];return[yr(Math.atan2(m,g)),yr(Math.atan2(y,Math.sqrt(g*g+m*m)))]}function E_(e,t,n){return[e[0]*n+t[0]*(1-n),e[1]*n+t[1]*(1-n)]}function A_(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function w_(e,t){var n=t.featureId,r=e.data.dataArray;return"number"==typeof n&&(r=r.filter((function(e){return e.id===n}))),r.map((function(e){var n=function(e,t){var n=t.offset,r=t.shape,i=t.thetaOffset,o=t.mapVersion,a=t.segmentNumber,s=void 0===a?30:a,u=t.autoFit,c=void 0===u||u,l=e.coordinates;if("line"===r)return function(e,t){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=A_(o,a),u=n;n+=s,r.push({p1:o,p2:a,totalDistance:n,distance:s,lastTotalDistance:u})}for(var c,l,h=n*t,f=0,p=r;f<p.length;f++){var d=p[f];if(d.totalDistance>h){var v=d.p1,g=E_(d.p2,v,(h-d.lastTotalDistance)/d.distance);c=g[0],l=g[1];break}}return{lng:c,lat:l,height:0}}(l,n);var h,f=l[0],p=l[1],d="string"==typeof i?e[i]||0:i;switch(r){case"arc":h=g_;break;case"greatcircle":h=b_;break;default:h=g_}var v=D(h(f,p,n,d,o,s,c),3),g=v[0],m=v[1],y=v[2];return{lng:g,lat:m,height:y}}(e,t);return v(v({},e),n)}))}var T_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;b(this,e),E(this,"limit",void 0),E(this,"cache",void 0),E(this,"destroy",void 0),E(this,"order",void 0),this.limit=t,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return S(e,[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}},{key:"defaultDestroy",value:function(e,t){return null}}]),e}(),C_=[],k_=ae(C_.sort),M_=ae(C_.push),P_=te((function(){C_.sort(void 0)})),I_=te((function(){C_.sort(null)})),L_=Tn("sort"),O_=!te((function(){if(Ee)return Ee<70;if(!(Tl&&Tl>3)){if(Cl)return!0;if(Ml)return Ml<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)C_.push({k:t+r,v:n})}for(C_.sort((function(e,t){return t.v-e.v})),r=0;r<C_.length;r++)t=C_[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));function R_(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return 1*t}function N_(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return 1*t}function D_(e){if(0===e.length)return 0;for(var t=1*e[0],n=1;n<e.length;n++)t+=1*e[n];return t}function F_(e){if(0===e.length)throw new Error("mean requires at least one data point");return D_(e)/e.length}function B_(e){if(0===e.length)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],n=NaN,r=0,i=1,o=1;o<e.length+1;o++)e[o]!==t?(i>r&&(r=i,n=t),i=1,t=e[o]):i++;return 1*n}ar({target:"Array",proto:!0,forced:P_||!I_||!L_||!O_},{sort:function(e){void 0!==e&&it(e);var t=he(this);if(O_)return void 0===e?k_(t):k_(t,e);var n,r,i=[],o=cn(t);for(r=0;r<o;r++)r in t&&M_(i,t[r]);for(Al(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:wr(t)>wr(n)?1:-1}}(e)),n=cn(i),r=0;r<n;)t[r]=i[r++];for(;r<o;)ac(t,r++);return t}});var z_={min:N_,max:R_,mean:F_,sum:D_,mode:B_};function U_(e,t){return e.map((function(e){return e[t]}))}function j_(e,t){return z_[e](t)}var V_=Object.freeze({__proto__:null,sum:D_,max:R_,min:N_,mean:F_,mode:B_,statMap:z_,getColumn:U_,getSatByColumn:j_}),G_=jn.includes,H_=te((function(){return!Array(1).includes()}));ar({target:"Array",proto:!0,forced:H_},{includes:function(e){return G_(this,e,arguments.length>1?arguments[1]:void 0)}}),es("includes");var W_=TypeError,Y_=function(e){if(Qg(e))throw W_("The method doesn't accept regular expressions");return e},X_=Pe("match"),Z_=ae("".indexOf);function q_(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r];return gr([[a,[i,r],[i,o],[n,o],a]],t.properties,{bbox:e,id:t.id})}ar({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[X_]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~Z_(wr(ce(this)),wr(Y_(e)),arguments.length>1?arguments[1]:void 0)}});var K_=Y((function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,o),!0;case 6:return l.fn.call(l.context,t,r,i,o,a),!0}for(c=1,u=new Array(h-1);c<h;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&c.push(s[u]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})),Q_=K_.EventEmitter,$_=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),J_=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),eb=K.isFinite,tb=Number.isFinite||function(e){return"number"==typeof e&&eb(e)};ar({target:"Number",stat:!0},{isFinite:tb});var nb;function rb(e){for(;e;){if(e.isLoaded)return e.properties.state|=2,!0;e=e.parent}return!1}function ib(e){e.children.forEach((function(e){e.isLoaded?e.properties.state|=2:ib(e)}))}var ob=[-1/0,-1/0,1/0,1/0],ab=(E(nb={},$_.Realtime,(function(e){e.forEach((function(e){e.isCurrent&&(e.isVisible=e.isLoaded)}))})),E(nb,$_.Overlap,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&!rb(e)&&ib(e)})),e.forEach((function(e){e.isVisible=Boolean(2&e.properties.state)}))})),E(nb,$_.Replace,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&rb(e)})),e.slice().sort((function(e,t){return e.z-t.z})).forEach((function(e){e.isVisible=Boolean(2&e.properties.state),e.children.length&&(e.isVisible||1&e.properties.state)?e.children.forEach((function(e){e.properties.state=1})):e.isCurrent&&ib(e)}))})),nb),sb=function(){};function ub(e,t,n){return[Math.floor((e+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}function cb(e,t,n){var r=e/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var lb=function(e,t,n){var r=D(cb(e,t,n),2),i=r[0],o=r[1],a=D(cb(e+1,t+1,n),2),s=a[0];return[i,a[1],s,o]};function hb(e){var t=e.zoom,n=e.latLonBounds,r=e.maxZoom,i=void 0===r?1/0:r,o=e.minZoom,a=void 0===o?0:o,s=e.zoomOffset,u=void 0===s?0:s,c=e.extent,l=void 0===c?ob:c,h=Math.ceil(t)+u;if(Number.isFinite(a)&&h<a)return[];Number.isFinite(i)&&h>i&&(h=i);for(var f=D(n,4),p=f[0],d=f[1],v=f[2],g=f[3],m=[Math.max(p,l[0]),Math.max(d,l[1]),Math.min(v,l[2]),Math.min(g,l[3])],y=[],_=D(ub(m[0],m[1],h),2),b=_[0],x=_[1],S=D(ub(m[2],m[3],h),2),E=S[0],A=S[1],w=b;w<=E;w++)for(var T=A;T<=x;T++)y.push({x:w,y:T,z:h});var C=(E+b)/2,k=(x+A)/2,M=function(e,t){return Math.abs(e-C)+Math.abs(t-k)};return y.sort((function(e,t){return M(e.x,e.y)-M(t.x,t.y)})),y}var fb=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Math.pow(2,n),o=i-1,a=e;return r&&(a<0?a+=i:a>o&&(a%=i)),{warpX:a,warpY:t}},pb=function(e){A(r,e);var t,n=O(r);function r(e){var t;b(this,r),E(I(t=n.call(this)),"x",void 0),E(I(t),"y",void 0),E(I(t),"z",void 0),E(I(t),"warp",void 0),E(I(t),"tileSize",256),E(I(t),"isVisible",!1),E(I(t),"isCurrent",!1),E(I(t),"isVisibleChange",!1),E(I(t),"loadedLayers",0),E(I(t),"isLayerLoaded",!1),E(I(t),"isLoad",!1),E(I(t),"isChildLoad",!1),E(I(t),"parent",null),E(I(t),"children",[]),E(I(t),"data",null),E(I(t),"properties",{}),E(I(t),"xhrCancel",void 0),E(I(t),"loadStatus",void 0),E(I(t),"abortController",void 0),E(I(t),"loadDataId",0);var i=e.x,o=e.y,a=e.z,s=e.tileSize,u=e.warp,c=void 0===u||u;return t.x=i,t.y=o,t.z=a,t.warp=c||!0,t.tileSize=s,t}return S(r,[{key:"isLoading",get:function(){return this.loadStatus===J_.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===J_.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===J_.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===J_.Cancelled}},{key:"isDone",get:function(){return[J_.Loaded,J_.Cancelled,J_.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return lb(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var e=D(this.bounds,4),t=e[0],n=e[1],r=[(e[2]-t)/2,(e[3]-n)/2];return q_(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:r,meta:"\n      ".concat(this.key,"\n      ")}})}},{key:"key",get:function(){return"".concat(this.x,"_").concat(this.y,"_").concat(this.z)}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:(t=_(g().mark((function e(t){var n,r,i,o,a,s,u,c,l,h,f,p,d,v,m,y,_;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getData,r=t.onLoad,i=t.onError,this.loadDataId++,o=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=J_.Loading,a=null,e.prev=7,u=this.x,c=this.y,l=this.z,h=this.bounds,f=this.tileSize,p=this.warp,d=fb(u,c,l,p),v=d.warpX,m=d.warpY,y=this.abortController.signal,_={x:v,y:m,z:l,bounds:h,tileSize:f,signal:y,warp:p},e.next=14,n(_,this);case 14:a=e.sent,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),s=e.t0;case 20:if(o===this.loadDataId){e.next=22;break}return e.abrupt("return");case 22:if(!this.isCancelled||a){e.next=24;break}return e.abrupt("return");case 24:if(!s&&a){e.next=28;break}return this.loadStatus=J_.Failure,i(s,this),e.abrupt("return");case 28:this.loadStatus=J_.Loaded,this.data=a,r(this);case 31:case"end":return e.stop()}}),e,this,[[7,17]])}))),function(e){return t.apply(this,arguments)})},{key:"reloadData",value:function(e){this.isLoading&&this.abortLoad(),this.loadData(e)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=J_.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(Q_),db=function(){return $v.Date.now()},vb=/\s/;var gb=function(e){for(var t=e.length;t--&&vb.test(e.charAt(t)););return t},mb=/^\s+/;var yb=function(e){return e?e.slice(0,gb(e)+1).replace(mb,""):e};var _b=function(e){return null!=e&&"object"==typeof e};var bb=function(e){return"symbol"==typeof e||_b(e)&&"[object Symbol]"==ug(e)},xb=/^[-+]0x[0-9a-f]+$/i,Sb=/^0b[01]+$/i,Eb=/^0o[0-7]+$/i,Ab=parseInt;var wb=function(e){if("number"==typeof e)return e;if(bb(e))return NaN;if(cg(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=cg(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=yb(e);var n=Sb.test(e);return n||Eb.test(e)?Ab(e.slice(2),n?2:8):xb.test(e)?NaN:+e},Tb=Math.max,Cb=Math.min;var kb=function(e,t,n){var r,i,o,a,s,u,c=0,l=!1,h=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,o=i;return r=i=void 0,c=t,a=e.apply(o,n)}function d(e){return c=e,s=setTimeout(g,t),l?p(e):a}function v(e){var n=e-u;return void 0===u||n>=t||n<0||h&&e-c>=o}function g(){var e=db();if(v(e))return m(e);s=setTimeout(g,function(e){var n=t-(e-u);return h?Cb(n,o-(e-c)):n}(e))}function m(e){return s=void 0,f&&r?p(e):(r=i=void 0,a)}function y(){var e=db(),n=v(e);if(r=arguments,i=this,u=e,n){if(void 0===s)return d(u);if(h)return clearTimeout(s),s=setTimeout(g,t),p(u)}return void 0===s&&(s=setTimeout(g,t)),a}return t=wb(t)||0,cg(n)&&(l=!!n.leading,o=(h="maxWait"in n)?Tb(wb(n.maxWait)||0,t):o,f="trailing"in n?!!n.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=u=i=s=void 0},y.flush=function(){return void 0===s?a:m(db())},y};var Mb=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return cg(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),kb(e,t,{leading:r,maxWait:t,trailing:i})},Pb=function(e,t,n,r){try{return r?t(Xe(n)[0],n[1]):t(n)}catch(t){Do(e,"throw",t)}},Ib=Array,Lb=function(e){var t=he(e),n=_n(this),r=arguments.length,i=r>1?arguments[1]:void 0,o=void 0!==i;o&&(i=$t(i,r>2?arguments[2]:void 0));var a,s,u,c,l,h,f=Oo(t),p=0;if(!f||this===Ib&&Io(f))for(a=cn(t),s=n?new this(a):Ib(a);a>p;p++)h=o?i(t[p],p):t[p],Oa(s,p,h);else for(l=(c=No(t,f)).next,s=n?new this:[];!(u=qe(l,c)).done;p++)h=o?Pb(c,i,[u.value,p],!0):u.value,Oa(s,p,h);return s.length=p,s},Ob=!Wo((function(e){Array.from(e)}));ar({target:"Array",stat:!0,forced:Ob},{from:Lb});var Rb=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),Nb=function(e){A(n,e);var t=O(n);function n(e){var r;return b(this,n),E(I(r=t.call(this)),"currentZoom",void 0),E(I(r),"currentTiles",[]),E(I(r),"options",void 0),E(I(r),"cacheTiles",new Map),E(I(r),"lastViewStates",void 0),E(I(r),"throttleUpdate",Mb((function(e,t){r.update(e,t)}),16)),E(I(r),"onTileLoad",(function(e){r.emit(Rb.TileLoaded,e),r.updateTileVisible(),r.loadFinished()})),E(I(r),"onTileError",(function(e,t){r.emit(Rb.TileError,{error:e,tile:t}),r.updateTileVisible(),r.loadFinished()})),E(I(r),"onTileUnload",(function(e){r.emit(Rb.TileUnload,e),r.loadFinished()})),r.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:ob,getTileData:sb,warp:!0,updateStrategy:$_.Overlap},r.updateOptions(e),r}return S(n,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(e){return e.isDone}))}},{key:"tiles",get:function(){return Array.from(this.cacheTiles.values()).sort((function(e,t){return e.z-t.z}))}},{key:"updateOptions",value:function(e){var t=void 0===e.minZoom?this.options.minZoom:Math.ceil(e.minZoom),n=void 0===e.maxZoom?this.options.maxZoom:Math.floor(e.maxZoom);this.options=v(v(v({},this.options),e),{},{minZoom:t,maxZoom:n})}},{key:"update",value:function(e,t){var n=this,r=Math.max(0,Math.ceil(e));if(!this.lastViewStates||this.lastViewStates.zoom!==r||!function(e,t){return o_(a_(e),a_(t))}(this.lastViewStates.latLonBoundsBuffer,t)){var i=function(e,t){var n=i_(a_(e),t);return[Math.max(n[0][0],-900),Math.max(n[0][1],-85.0511287798065),Math.min(n[1][0],900),Math.min(n[1][1],85.0511287798065)]}(t,.2);this.lastViewStates={zoom:r,latLonBounds:t,latLonBoundsBuffer:i},this.currentZoom=r;var o=!1,a=this.getTileIndices(r,i).filter((function(e){return n.options.warp||e.x>=0&&e.x<Math.pow(2,r)}));this.emit(Rb.TilesLoadStart),this.currentTiles=a.map((function(e){var t,r,i=e.x,a=e.y,s=e.z,u=n.getTile(i,a,s);return u?(((null===(t=u)||void 0===t?void 0:t.isFailure)||(null===(r=u)||void 0===r?void 0:r.isCancelled))&&u.loadData({getData:n.options.getTileData,onLoad:n.onTileLoad,onError:n.onTileError}),u):(u=n.createTile(i,a,s),o=!0,u)})),o&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var e,t=U(this.cacheTiles);try{for(t.s();!(e=t.n()).done;){var n=D(e.value,2),r=n[0],i=n[1];if(!this.currentTiles.includes(i))return this.cacheTiles.delete(r),void this.onTileUnload(i);this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(e){t.e(e)}finally{t.f()}}},{key:"reloadTileById",value:function(e,t,n){var r=this.cacheTiles.get("".concat(t,",").concat(n,",").concat(e));r&&(this.onTileUnload(r),r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(e,t,n){var r=this.getTileByLngLat(e,t,n);r&&this.reloadTileById(r.z,r.x,r.y)}},{key:"reloadTileByExtent",value:function(e,t){var n=this;this.getTileIndices(t,e).forEach((function(e){n.reloadTileById(e.z,e.x,e.y)}))}},{key:"pruneRequests",value:function(){var e,t=[],n=U(this.cacheTiles.values());try{for(n.s();!(e=n.n()).done;){var r=e.value;r.isLoading&&(r.isCurrent||r.isVisible||t.push(r))}}catch(e){n.e(e)}finally{n.f()}for(;t.length>0;){t.shift().abortLoad()}}},{key:"getTileByLngLat",value:function(e,t,n){var r=this.options.zoomOffset,i=Math.ceil(n)+r,o=ub(e,t,i);return this.tiles.filter((function(e){return e.key==="".concat(o[0],"_").concat(o[1],"_").concat(i)}))[0]}},{key:"getTileExtent",value:function(e,t){return this.getTileIndices(t,e)}},{key:"getTileByZXY",value:function(e,t,n){return this.tiles.filter((function(r){return r.key==="".concat(t,"_").concat(n,"_").concat(e)}))[0]}},{key:"clear",value:function(){var e,t=U(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLoading?n.abortLoad():this.onTileUnload(n)}}catch(e){t.e(e)}finally{t.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var e,t=this.options.updateStrategy,n=new Map,r=U(this.cacheTiles.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(e){r.e(e)}finally{r.f()}var o,a=U(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(e){a.e(e)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof t?t(u):ab[t](u);var c=!1;Array.from(this.cacheTiles.values()).forEach((function(e){e.isVisible!==n.get(e.key)?(e.isVisibleChange=!0,c=!0):e.isVisibleChange=!1})),c&&this.emit(Rb.TileUpdate)}},{key:"getTileIndices",value:function(e,t){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset;return hb({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:e,latLonBounds:t,extent:i})}},{key:"getTileId",value:function(e,t,n){return"".concat(e,",").concat(t,",").concat(n)}},{key:"loadFinished",value:function(){var e=!this.currentTiles.some((function(e){return!e.isDone}));return e&&this.emit(Rb.TilesLoadFinished),e}},{key:"getTile",value:function(e,t,n){var r=this.getTileId(e,t,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(e,t,n){var r=this.getTileId(e,t,n),i=new pb({x:e,y:t,z:n,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var e=5*this.currentTiles.length;if(this.cacheTiles.size>e){var t,n=U(this.cacheTiles);try{for(n.s();!(t=n.n()).done;){var r=D(t.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=e)break}}catch(e){n.e(e)}finally{n.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var e,t=U(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.parent=null,n.children.length=0}}catch(e){t.e(e)}finally{t.f()}var r,i=U(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(e){i.e(e)}finally{i.f()}}},{key:"getNearestAncestor",value:function(e,t,n){for(;n>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),n-=1;var r=this.getTile(e,t,n);if(r)return r}return null}}]),n}(K_);function Db(e){var t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)t.push(e.replace(n[0],String.fromCharCode(r)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)t.push(e.replace(n[0],s.toString()));return t}return t.push(e),t}function Fb(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");var n=t.x,r=t.y,i=t.z,o=Db(e);return o[Math.abs(n+r)%o.length].replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,lb(n,r,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}function Bb(e,t){var n=t.x,r=t.y,i=t.z,o=t.layer,a=t.version,s=void 0===a?"1.0.0":a,u=t.style,c=void 0===u?"default":u,l=t.format,h=t.service,f=void 0===h?"WMTS":h,p=t.tileMatrixset;return"".concat(e,"&SERVICE=").concat(f,"&REQUEST=GetTile&VERSION=").concat(s,"&LAYER=").concat(o,"&STYLE=").concat(c,"&TILEMATRIXSET=").concat(p,"&FORMAT=").concat(l,"&TILECOL=").concat(n,"&TILEROW=").concat(r,"&TILEMATRIX=").concat(i)}function zb(e,t){if(!e)throw new Error(t||"web worker helper assertion failed.")}var Ub="undefined"!=typeof window&&void 0!==window.orientation,jb=function(){function e(e,t){var n=this;this.name=e,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return e.prototype.postMessage=function(e,t){this.workerThread.postMessage({source:"Main thread",type:e,payload:t})},e.prototype.done=function(e){zb(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(e)},e.prototype.error=function(e){zb(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(e)},e}(),Vb=new Map;function Gb(e){zb(e.source&&!e.url||!e.source&&e.url);var t=Vb.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return Hb((t=e,"try {\n  importScripts('"+t+"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}"));var t}(e.url),Vb.set(e.url,t)),e.source&&(t=Hb(e.source),Vb.set(e.source,t))),zb(t),t}function Hb(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Wb(e,t,n){void 0===t&&(t=!0);var r=n||new Set;if(e){if(Yb(e))r.add(e);else if(Yb(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(var i in e)Wb(e[i],t,r)}else;return void 0===n?Array.from(r):[]}function Yb(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}var Xb=function(){},Zb=function(){function e(e){this.terminated=!1,this.loadableURL="";var t=e.name,n=e.source,r=e.url;zb(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=Xb,this.onError=function(e){return console.log(e)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return"undefined"!=typeof Worker},e.prototype.destroy=function(){this.onMessage=Xb,this.onError=Xb,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(e,t){t=t||Wb(e),this.worker.postMessage(e,t)},e.prototype.getErrorFromErrorEvent=function(e){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",e.message&&(t+=e.message+" in "),e.lineno&&(t+=":"+e.lineno+":"+e.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var e=this;this.loadableURL=Gb({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(t){t.data?e.onMessage(t.data):e.onError(new Error("No data received"))},t.onerror=function(t){e.onError(e.getErrorFromErrorEvent(t)),e.terminated=!0},t.onmessageerror=function(t){return console.error("worker "+e.name+", message error: "+t)},t},e}(),qb=function(){return(qb=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Kb=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},Qb=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},$b=function(){function e(e){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=e.source,this.url=e.url,this.setProps(e)}return e.prototype.destroy=function(){this.idleQueue.forEach((function(e){return e.destroy()})),this.isDestroyed=!0},e.prototype.setProps=function(e){this.props=qb(qb({},this.props),e),void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)},e.prototype.startJob=function(e,t,n){return void 0===t&&(t=function(e,t,n){return e.done(n)}),void 0===n&&(n=function(e,t){return e.error(t)}),Kb(this,void 0,void 0,(function(){var r,i=this;return Qb(this,(function(o){switch(o.label){case 0:return r=new Promise((function(r){return i.jobQueue.push({name:e,onMessage:t,onError:n,onStart:r}),i})),this.startQueuedJob(),[4,r];case 1:return[2,o.sent()]}}))}))},e.prototype.startQueuedJob=function(){return Kb(this,void 0,void 0,(function(){var e,t,n;return Qb(this,(function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(!(e=this.getAvailableWorker()))return[2];if(!(t=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:e}),n=new jb(t.name,e),e.onMessage=function(e){return t.onMessage(n,e.type,e.payload)},e.onError=function(e){return t.onError(n,e)},t.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(e),[7];case 4:return[2]}}))}))},e.prototype.returnWorkerToQueue=function(e){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var e=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Zb({name:e,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return Ub?this.maxMobileConcurrency:this.maxConcurrency},e}(),Jb=function(){return(Jb=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ex=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},tx={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},nx=function(){function e(e){this.workerPools=new Map,this.props=Jb({},tx),this.setProps(e),this.workerPools=new Map}return e.isSupported=function(){return Zb.isSupported()},e.getWorkerFarm=function(t){return void 0===t&&(t={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(t),e.workerFarm},e.prototype.destroy=function(){var e,t;try{for(var n=ex(this.workerPools.values()),r=n.next();!r.done;r=n.next()){r.value.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setProps=function(e){var t,n;this.props=Jb(Jb({},this.props),e);try{for(var r=ex(this.workerPools.values()),i=r.next();!i.done;i=r.next()){i.value.setProps(this.getWorkerPoolProps())}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(e){var t=e.name,n=e.source,r=e.url,i=this.workerPools.get(t);return i||((i=new $b({name:t,source:n,url:r})).setProps(this.getWorkerPoolProps()),this.workerPools.set(t,i)),i},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),rx=new Map,ix=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(e){self.onmessage=function(t){if(ox(t)){var n=t.data,r=n.type,i=n.payload;e(r,i)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(e){var t=rx.get(e);t||(t=function(t){if(ox(t)){var n=t.data,r=n.type,i=n.payload;e(r,i)}}),self.addEventListener("message",t)},e.removeEventListener=function(e){var t=rx.get(e);rx.delete(e),self.removeEventListener("message",t)},e.postMessage=function(e,t){if(self){var n={source:"Worker thread",type:e,payload:t},r=Wb(t);self.postMessage(n,r)}},e}();function ox(e){var t=e.type,n=e.data;return"message"===t&&n&&"string"==typeof n.source&&"Main thread"===n.source}var ax,sx,ux=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(e){return this.enqueue(e)},e.prototype.enqueue=function(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();e instanceof Error?t.reject(e):t.resolve({value:e})}else this._values.push(e)},e.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var e=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(t,n){e._settlers.push({resolve:t,reject:n})}))},e}(),cx=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},lx=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},hx=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}},fx=0;function px(e,t){return void 0===t&&(t={}),new Promise((function(n,r){var i=fx++,o=function(e,t){if(t.id===i)switch(e){case"done":ix.removeEventListener(o),n(t.result);break;case"error":ix.removeEventListener(o),r(t.error)}};ix.addEventListener(o);var a={id:i,input:e,options:t};ix.postMessage("process",a)}))}function dx(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}function vx(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}function gx(e){return e.filter?[1]:[0]}function mx(e,t){return[t]}var yx=bx,_x=bx;function bx(e,t,n){n=n||2;var r,i,o,a,s,u,c,l=t&&t.length,h=l?t[0]*n:e.length,f=xx(e,0,h,n,!0),p=[];if(!f||f.next===f.prev)return p;if(l&&(f=function(e,t,n,r){var i,o,a,s,u,c=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,s=i<o-1?t[i+1]*r:e.length,(u=xx(e,a,s,r,!1))===u.next&&(u.steiner=!0),c.push(Ox(u));for(c.sort(Mx),i=0;i<c.length;i++)n=Px(c[i],n);return n}(e,t,f,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var d=n;d<h;d+=n)(s=e[d])<r&&(r=s),(u=e[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);c=0!==(c=Math.max(o-r,a-i))?32767/c:0}return Ex(f,p,n,r,i,c,0),p}function xx(e,t,n,r,i){var o,a;if(i===Yx(e,t,n,r)>0)for(o=t;o<n;o+=r)a=Gx(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=Gx(o,e[o],e[o+1],a);return a&&Fx(a,a.next)&&(Hx(a),a=a.next),a}function Sx(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Fx(r,r.next)&&0!==Dx(r.prev,r,r.next))r=r.next;else{if(Hx(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function Ex(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=Lx(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,o);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?Tx(e,r,i,o):Ax(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(u.i/n|0),Hx(e),e=u.next,c=u.next;else if((e=u)===c){a?1===a?Ex(e=Cx(Sx(e),t,n),t,n,r,i,o,2):2===a&&kx(e,t,n,r,i,o):Ex(Sx(e),t,n,r,i,o,1);break}}}function Ax(e){var t=e.prev,n=e,r=e.next;if(Dx(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,a=r.x,s=t.y,u=n.y,c=r.y,l=i<o?i<a?i:a:o<a?o:a,h=s<u?s<c?s:c:u<c?u:c,f=i>o?i>a?i:a:o>a?o:a,p=s>u?s>c?s:c:u>c?u:c,d=r.next;d!==t;){if(d.x>=l&&d.x<=f&&d.y>=h&&d.y<=p&&Rx(i,s,o,u,a,c,d.x,d.y)&&Dx(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function Tx(e,t,n,r){var i=e.prev,o=e,a=e.next;if(Dx(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,c=a.x,l=i.y,h=o.y,f=a.y,p=s<u?s<c?s:c:u<c?u:c,d=l<h?l<f?l:f:h<f?h:f,v=s>u?s>c?s:c:u>c?u:c,g=l>h?l>f?l:f:h>f?h:f,m=Lx(p,d,t,n,r),y=Lx(v,g,t,n,r),_=e.prevZ,b=e.nextZ;_&&_.z>=m&&b&&b.z<=y;){if(_.x>=p&&_.x<=v&&_.y>=d&&_.y<=g&&_!==i&&_!==a&&Rx(s,l,u,h,c,f,_.x,_.y)&&Dx(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,b.x>=p&&b.x<=v&&b.y>=d&&b.y<=g&&b!==i&&b!==a&&Rx(s,l,u,h,c,f,b.x,b.y)&&Dx(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;_&&_.z>=m;){if(_.x>=p&&_.x<=v&&_.y>=d&&_.y<=g&&_!==i&&_!==a&&Rx(s,l,u,h,c,f,_.x,_.y)&&Dx(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=v&&b.y>=d&&b.y<=g&&b!==i&&b!==a&&Rx(s,l,u,h,c,f,b.x,b.y)&&Dx(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Cx(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!Fx(i,o)&&Bx(i,r,r.next,o)&&jx(i,o)&&jx(o,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(o.i/n|0),Hx(r),Hx(r.next),r=e=o),r=r.next}while(r!==e);return Sx(r)}function kx(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Nx(a,s)){var u=Vx(a,s);return a=Sx(a,a.next),u=Sx(u,u.next),Ex(a,t,n,r,i,o,0),void Ex(u,t,n,r,i,o,0)}s=s.next}a=a.next}while(a!==e)}function Mx(e,t){return e.x-t.x}function Px(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var u,c=n,l=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&Rx(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),jx(r,e)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&Ix(n,r)))&&(n=r,f=u)),r=r.next}while(r!==c);return n}(e,t);if(!n)return t;var r=Vx(n,e);return Sx(r,r.next),Sx(n,n.next)}function Ix(e,t){return Dx(e.prev,e,t.prev)<0&&Dx(t.next,e,e.next)<0}function Lx(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ox(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Rx(e,t,n,r,i,o,a,s){return(i-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(r-s)>=(n-a)*(t-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function Nx(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Bx(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(jx(e,t)&&jx(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Dx(e.prev,e,t.prev)||Dx(e,t.prev,t))||Fx(e,t)&&Dx(e.prev,e,e.next)>0&&Dx(t.prev,t,t.next)>0)}function Dx(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Fx(e,t){return e.x===t.x&&e.y===t.y}function Bx(e,t,n,r){var i=Ux(Dx(e,t,n)),o=Ux(Dx(e,t,r)),a=Ux(Dx(n,r,e)),s=Ux(Dx(n,r,t));return i!==o&&a!==s||(!(0!==i||!zx(e,n,t))||(!(0!==o||!zx(e,r,t))||(!(0!==a||!zx(n,e,r))||!(0!==s||!zx(n,t,r)))))}function zx(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Ux(e){return e>0?1:e<0?-1:0}function jx(e,t){return Dx(e.prev,e,e.next)<0?Dx(e,t,e.next)>=0&&Dx(e,e.prev,t)>=0:Dx(e,t,e.prev)<0||Dx(e,e.next,t)<0}function Vx(e,t){var n=new Wx(e.i,e.x,e.y),r=new Wx(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Gx(e,t,n,r){var i=new Wx(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Hx(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Wx(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Yx(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}bx.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(Yx(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var c=t[s]*n,l=s<u-1?t[s+1]*n:e.length;a-=Math.abs(Yx(e,c,l,n))}var h=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((e[f]-e[d])*(e[p+1]-e[f+1])-(e[f]-e[p])*(e[d+1]-e[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},bx.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n},yx.default=_x;var Xx=/"/g,Zx=ae("".replace),qx=function(e,t,n,r){var i=wr(ce(e)),o="<"+t;return""!==n&&(o+=" "+n+'="'+Zx(wr(r),Xx,"&quot;")+'"'),o+">"+i+"</"+t+">"},Kx=function(e){return te((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))};ar({target:"String",proto:!0,forced:Kx("sub")},{sub:function(){return qx(this,"sub","","")}});var Qx=1e-6,$x="undefined"!=typeof Float32Array?Float32Array:Array,Jx=Math.random;function eS(){var e=new $x(16);return $x!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function tS(e){var t=new $x(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function nS(e,t,n,r,i,o,a,s,u,c,l,h,f,p,d,v){var g=new $x(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=o,g[6]=a,g[7]=s,g[8]=u,g[9]=c,g[10]=l,g[11]=h,g[12]=f,g[13]=p,g[14]=d,g[15]=v,g}function rS(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function iS(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15],y=n*s-r*a,_=n*u-i*a,b=n*c-o*a,x=r*u-i*s,S=r*c-o*s,E=i*c-o*u,A=l*v-h*d,w=l*g-f*d,T=l*m-p*d,C=h*g-f*v,k=h*m-p*v,M=f*m-p*g,P=y*M-_*k+b*C+x*T-S*w+E*A;return P?(P=1/P,e[0]=(s*M-u*k+c*C)*P,e[1]=(i*k-r*M-o*C)*P,e[2]=(v*E-g*S+m*x)*P,e[3]=(f*S-h*E-p*x)*P,e[4]=(u*T-a*M-c*w)*P,e[5]=(n*M-i*T+o*w)*P,e[6]=(g*b-d*E-m*_)*P,e[7]=(l*E-f*b+p*_)*P,e[8]=(a*k-s*T+c*A)*P,e[9]=(r*T-n*k-o*A)*P,e[10]=(d*S-v*b+m*y)*P,e[11]=(h*b-l*S-p*y)*P,e[12]=(s*w-a*C-u*A)*P,e[13]=(n*C-r*w+i*A)*P,e[14]=(v*_-d*x-g*y)*P,e[15]=(l*x-h*_+f*y)*P,e):null}function oS(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=t[8],f=t[9],p=t[10],d=t[11],v=t[12],g=t[13],m=t[14],y=t[15],_=n[0],b=n[1],x=n[2],S=n[3];return e[0]=_*r+b*s+x*h+S*v,e[1]=_*i+b*u+x*f+S*g,e[2]=_*o+b*c+x*p+S*m,e[3]=_*a+b*l+x*d+S*y,_=n[4],b=n[5],x=n[6],S=n[7],e[4]=_*r+b*s+x*h+S*v,e[5]=_*i+b*u+x*f+S*g,e[6]=_*o+b*c+x*p+S*m,e[7]=_*a+b*l+x*d+S*y,_=n[8],b=n[9],x=n[10],S=n[11],e[8]=_*r+b*s+x*h+S*v,e[9]=_*i+b*u+x*f+S*g,e[10]=_*o+b*c+x*p+S*m,e[11]=_*a+b*l+x*d+S*y,_=n[12],b=n[13],x=n[14],S=n[15],e[12]=_*r+b*s+x*h+S*v,e[13]=_*i+b*u+x*f+S*g,e[14]=_*o+b*c+x*p+S*m,e[15]=_*a+b*l+x*d+S*y,e}function aS(e,t,n){var r,i,o,a,s,u,c,l,h,f,p,d,v=n[0],g=n[1],m=n[2];return t===e?(e[12]=t[0]*v+t[4]*g+t[8]*m+t[12],e[13]=t[1]*v+t[5]*g+t[9]*m+t[13],e[14]=t[2]*v+t[6]*g+t[10]*m+t[14],e[15]=t[3]*v+t[7]*g+t[11]*m+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=t[8],f=t[9],p=t[10],d=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=h,e[9]=f,e[10]=p,e[11]=d,e[12]=r*v+s*g+h*m+t[12],e[13]=i*v+u*g+f*m+t[13],e[14]=o*v+c*g+p*m+t[14],e[15]=a*v+l*g+d*m+t[15]),e}function sS(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function uS(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=a*i+l*r,e[6]=s*i+h*r,e[7]=u*i+f*r,e[8]=c*i-o*r,e[9]=l*i-a*r,e[10]=h*i-s*r,e[11]=f*i-u*r,e}function cS(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[8],l=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*r,e[1]=a*i-l*r,e[2]=s*i-h*r,e[3]=u*i-f*r,e[8]=o*r+c*i,e[9]=a*r+l*i,e[10]=s*r+h*i,e[11]=u*r+f*i,e}function lS(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[4],l=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*r,e[1]=a*i+l*r,e[2]=s*i+h*r,e[3]=u*i+f*r,e[4]=c*i-o*r,e[5]=l*i-a*r,e[6]=h*i-s*r,e[7]=f*i-u*r,e}function hS(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fS(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,c=o+o,l=r*s,h=r*u,f=r*c,p=i*u,d=i*c,v=o*c,g=a*s,m=a*u,y=a*c;return e[0]=1-(p+v),e[1]=h+y,e[2]=f-m,e[3]=0,e[4]=h-y,e[5]=1-(l+v),e[6]=d+g,e[7]=0,e[8]=f+m,e[9]=d-g,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function pS(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,c,l),e}function dS(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var vS=dS;function gS(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*c,e[15]=1,e}var mS=gS;function yS(e,t,n,r){var i,o,a,s,u,c,l,h,f,p,d=t[0],v=t[1],g=t[2],m=r[0],y=r[1],_=r[2],b=n[0],x=n[1],S=n[2];return Math.abs(d-b)<Qx&&Math.abs(v-x)<Qx&&Math.abs(g-S)<Qx?rS(e):(l=d-b,h=v-x,f=g-S,i=y*(f*=p=1/Math.hypot(l,h,f))-_*(h*=p),o=_*(l*=p)-m*f,a=m*h-y*l,(p=Math.hypot(i,o,a))?(i*=p=1/p,o*=p,a*=p):(i=0,o=0,a=0),s=h*a-f*o,u=f*i-l*a,c=l*o-h*i,(p=Math.hypot(s,u,c))?(s*=p=1/p,u*=p,c*=p):(s=0,u=0,c=0),e[0]=i,e[1]=s,e[2]=l,e[3]=0,e[4]=o,e[5]=u,e[6]=h,e[7]=0,e[8]=a,e[9]=c,e[10]=f,e[11]=0,e[12]=-(i*d+o*v+a*g),e[13]=-(s*d+u*v+c*g),e[14]=-(l*d+h*v+f*g),e[15]=1,e)}function _S(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function bS(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],p=e[11],d=e[12],v=e[13],g=e[14],m=e[15],y=t[0],_=t[1],b=t[2],x=t[3],S=t[4],E=t[5],A=t[6],w=t[7],T=t[8],C=t[9],k=t[10],M=t[11],P=t[12],I=t[13],L=t[14],O=t[15];return Math.abs(n-y)<=Qx*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-_)<=Qx*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-b)<=Qx*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-x)<=Qx*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-S)<=Qx*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(s-E)<=Qx*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-A)<=Qx*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-w)<=Qx*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(l-T)<=Qx*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(h-C)<=Qx*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(f-k)<=Qx*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(p-M)<=Qx*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-P)<=Qx*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(v-I)<=Qx*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(g-L)<=Qx*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(m-O)<=Qx*Math.max(1,Math.abs(m),Math.abs(O))}var xS=oS,SS=_S,ES=Object.freeze({__proto__:null,create:eS,clone:tS,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:nS,set:function(e,t,n,r,i,o,a,s,u,c,l,h,f,p,d,v,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=h,e[11]=f,e[12]=p,e[13]=d,e[14]=v,e[15]=g,e},identity:rS,transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:iS,adjoint:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15];return e[0]=s*(f*m-p*g)-h*(u*m-c*g)+v*(u*p-c*f),e[1]=-(r*(f*m-p*g)-h*(i*m-o*g)+v*(i*p-o*f)),e[2]=r*(u*m-c*g)-s*(i*m-o*g)+v*(i*c-o*u),e[3]=-(r*(u*p-c*f)-s*(i*p-o*f)+h*(i*c-o*u)),e[4]=-(a*(f*m-p*g)-l*(u*m-c*g)+d*(u*p-c*f)),e[5]=n*(f*m-p*g)-l*(i*m-o*g)+d*(i*p-o*f),e[6]=-(n*(u*m-c*g)-a*(i*m-o*g)+d*(i*c-o*u)),e[7]=n*(u*p-c*f)-a*(i*p-o*f)+l*(i*c-o*u),e[8]=a*(h*m-p*v)-l*(s*m-c*v)+d*(s*p-c*h),e[9]=-(n*(h*m-p*v)-l*(r*m-o*v)+d*(r*p-o*h)),e[10]=n*(s*m-c*v)-a*(r*m-o*v)+d*(r*c-o*s),e[11]=-(n*(s*p-c*h)-a*(r*p-o*h)+l*(r*c-o*s)),e[12]=-(a*(h*g-f*v)-l*(s*g-u*v)+d*(s*f-u*h)),e[13]=n*(h*g-f*v)-l*(r*g-i*v)+d*(r*f-i*h),e[14]=-(n*(s*g-u*v)-a*(r*g-i*v)+d*(r*u-i*s)),e[15]=n*(s*f-u*h)-a*(r*f-i*h)+l*(r*u-i*s),e},determinant:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11],p=e[12],d=e[13],v=e[14],g=e[15];return(t*a-n*o)*(h*g-f*v)-(t*s-r*o)*(l*g-f*d)+(t*u-i*o)*(l*v-h*d)+(n*s-r*a)*(c*g-f*p)-(n*u-i*a)*(c*v-h*p)+(r*u-i*s)*(c*d-l*p)},multiply:oS,translate:aS,scale:sS,rotate:function(e,t,n,r){var i,o,a,s,u,c,l,h,f,p,d,v,g,m,y,_,b,x,S,E,A,w,T,C,k=r[0],M=r[1],P=r[2],I=Math.hypot(k,M,P);return I<Qx?null:(k*=I=1/I,M*=I,P*=I,i=Math.sin(n),a=1-(o=Math.cos(n)),s=t[0],u=t[1],c=t[2],l=t[3],h=t[4],f=t[5],p=t[6],d=t[7],v=t[8],g=t[9],m=t[10],y=t[11],_=k*k*a+o,b=M*k*a+P*i,x=P*k*a-M*i,S=k*M*a-P*i,E=M*M*a+o,A=P*M*a+k*i,w=k*P*a+M*i,T=M*P*a-k*i,C=P*P*a+o,e[0]=s*_+h*b+v*x,e[1]=u*_+f*b+g*x,e[2]=c*_+p*b+m*x,e[3]=l*_+d*b+y*x,e[4]=s*S+h*E+v*A,e[5]=u*S+f*E+g*A,e[6]=c*S+p*E+m*A,e[7]=l*S+d*E+y*A,e[8]=s*w+h*T+v*C,e[9]=u*w+f*T+g*C,e[10]=c*w+p*T+m*C,e[11]=l*w+d*T+y*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:uS,rotateY:cS,rotateZ:lS,fromTranslation:hS,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);return c<Qx?null:(a*=c=1/c,s*=c,u*=c,r=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=a*a*o+i,e[1]=s*a*o+u*r,e[2]=u*a*o-s*r,e[3]=0,e[4]=a*s*o-u*r,e[5]=s*s*o+i,e[6]=u*s*o+a*r,e[7]=0,e[8]=a*u*o+s*r,e[9]=s*u*o-a*r,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:fS,fromQuat2:function(e,t){var n=new $x(3),r=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=r*r+i*i+o*o+a*a;return h>0?(n[0]=2*(s*a+l*r+u*o-c*i)/h,n[1]=2*(u*a+l*i+c*r-s*o)/h,n[2]=2*(c*a+l*o+s*i-u*r)/h):(n[0]=2*(s*a+l*r+u*o-c*i),n[1]=2*(u*a+l*i+c*r-s*o),n[2]=2*(c*a+l*o+s*i-u*r)),fS(e,t,n),e},getTranslation:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling:pS,getRotation:function(e,t){var n=new $x(3);pS(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],a=t[0]*r,s=t[1]*i,u=t[2]*o,c=t[4]*r,l=t[5]*i,h=t[6]*o,f=t[8]*r,p=t[9]*i,d=t[10]*o,v=a+l+d,g=0;return v>0?(g=2*Math.sqrt(v+1),e[3]=.25*g,e[0]=(h-p)/g,e[1]=(f-u)/g,e[2]=(s-c)/g):a>l&&a>d?(g=2*Math.sqrt(1+a-l-d),e[3]=(h-p)/g,e[0]=.25*g,e[1]=(s+c)/g,e[2]=(f+u)/g):l>d?(g=2*Math.sqrt(1+l-a-d),e[3]=(f-u)/g,e[0]=(s+c)/g,e[1]=.25*g,e[2]=(h+p)/g):(g=2*Math.sqrt(1+d-a-l),e[3]=(s-c)/g,e[0]=(f+u)/g,e[1]=(h+p)/g,e[2]=.25*g),e},fromRotationTranslationScale:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,c=o+o,l=a+a,h=i*u,f=i*c,p=i*l,d=o*c,v=o*l,g=a*l,m=s*u,y=s*c,_=s*l,b=r[0],x=r[1],S=r[2];return e[0]=(1-(d+g))*b,e[1]=(f+_)*b,e[2]=(p-y)*b,e[3]=0,e[4]=(f-_)*x,e[5]=(1-(h+g))*x,e[6]=(v+m)*x,e[7]=0,e[8]=(p+y)*S,e[9]=(v-m)*S,e[10]=(1-(h+d))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],c=o+o,l=a+a,h=s+s,f=o*c,p=o*l,d=o*h,v=a*l,g=a*h,m=s*h,y=u*c,_=u*l,b=u*h,x=r[0],S=r[1],E=r[2],A=i[0],w=i[1],T=i[2],C=(1-(v+m))*x,k=(p+b)*x,M=(d-_)*x,P=(p-b)*S,I=(1-(f+m))*S,L=(g+y)*S,O=(d+_)*E,R=(g-y)*E,N=(1-(f+v))*E;return e[0]=C,e[1]=k,e[2]=M,e[3]=0,e[4]=P,e[5]=I,e[6]=L,e[7]=0,e[8]=O,e[9]=R,e[10]=N,e[11]=0,e[12]=n[0]+A-(C*A+P*w+O*T),e[13]=n[1]+w-(k*A+I*w+R*T),e[14]=n[2]+T-(M*A+L*w+N*T),e[15]=1,e},fromQuat:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,h=r*s,f=i*a,p=i*s,d=i*u,v=o*a,g=o*s,m=o*u;return e[0]=1-h-d,e[1]=l+m,e[2]=f-g,e[3]=0,e[4]=l-m,e[5]=1-c-d,e[6]=p+v,e[7]=0,e[8]=f+g,e[9]=p-v,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e},perspectiveNO:dS,perspective:vS,perspectiveZO:function(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=i*o,e[14]=i*r*o):(e[10]=-1,e[14]=-r),e},perspectiveFromFieldOfView:function(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},orthoNO:gS,ortho:mS,orthoZO:function(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=o*c,e[15]=1,e},lookAt:yS,targetTo:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=r[0],u=r[1],c=r[2],l=i-n[0],h=o-n[1],f=a-n[2],p=l*l+h*h+f*f;p>0&&(l*=p=1/Math.sqrt(p),h*=p,f*=p);var d=u*f-c*h,v=c*l-s*f,g=s*h-u*l;return(p=d*d+v*v+g*g)>0&&(d*=p=1/Math.sqrt(p),v*=p,g*=p),e[0]=d,e[1]=v,e[2]=g,e[3]=0,e[4]=h*g-f*v,e[5]=f*d-l*g,e[6]=l*v-h*d,e[7]=0,e[8]=l,e[9]=h,e[10]=f,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},subtract:_S,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:bS,mul:xS,sub:SS});function AS(){var e=new $x(3);return $x!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function wS(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function TS(e,t,n){var r=new $x(3);return r[0]=e,r[1]=t,r[2]=n,r}function CS(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function kS(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function MS(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function PS(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function IS(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function LS(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function OS(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function RS(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function NS(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function DS(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function FS(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}function BS(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function zS(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),c=u&&DS(e,t)/u;return Math.acos(Math.min(Math.max(c,-1),1))}var US,jS=CS,VS=kS,GS=MS,HS=IS,WS=LS,YS=wS,XS=OS,ZS=(US=AS(),function(e,t,n,r,i,o){var a,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)US[0]=e[a],US[1]=e[a+1],US[2]=e[a+2],i(US,US,o),e[a]=US[0],e[a+1]=US[1],e[a+2]=US[2];return e}),qS=Object.freeze({__proto__:null,create:AS,clone:function(e){var t=new $x(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:wS,fromValues:TS,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},subtract:CS,multiply:kS,divide:MS,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:PS,scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},distance:IS,squaredDistance:LS,squaredLength:OS,negate:RS,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:NS,dot:DS,cross:FS,lerp:function(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e},hermite:function(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*c+i[0]*l,e[1]=t[1]*s+n[1]*u+r[1]*c+i[1]*l,e[2]=t[2]*s+n[2]*u+r[2]*c+i[2]*l,e},bezier:function(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,l=3*o*s,h=3*u*a,f=u*o;return e[0]=t[0]*c+n[0]*l+r[0]*h+i[0]*f,e[1]=t[1]*c+n[1]*l+r[1]*h+i[1]*f,e[2]=t[2]*c+n[2]*l+r[2]*h+i[2]*f,e},random:function(e,t){t=t||1;var n=2*Jx()*Math.PI,r=2*Jx()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},transformMat4:BS,transformMat3:function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},transformQuat:function(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],c=t[2],l=i*c-o*u,h=o*s-r*c,f=r*u-i*s,p=i*f-o*h,d=o*l-r*f,v=r*h-i*l,g=2*a;return l*=g,h*=g,f*=g,p*=2,d*=2,v*=2,e[0]=s+l+p,e[1]=u+h+d,e[2]=c+f+v,e},rotateX:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},rotateY:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},rotateZ:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},angle:zS,zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(n-o)<=Qx*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=Qx*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=Qx*Math.max(1,Math.abs(i),Math.abs(s))},sub:jS,mul:VS,div:GS,dist:HS,sqrDist:WS,len:YS,sqrLen:XS,forEach:ZS});function KS(){var e=new $x(4);return $x!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function QS(e,t,n,r){var i=new $x(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function $S(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}!function(){var e=KS()}();function JS(){var e=new $x(2);return $x!=Float32Array&&(e[0]=0,e[1]=0),e}function eE(e,t){var n=new $x(2);return n[0]=e,n[1]=t,n}function tE(e,t){return e[0]=t[0],e[1]=t[1],e}function nE(e,t,n){return e[0]=t,e[1]=n,e}function rE(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function iE(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function oE(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function aE(e,t){return e[0]*t[0]+e[1]*t[1]}function sE(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}var uE=iE,cE=(function(){var e=JS()}(),JS()),lE=(JS(),JS()),hE=JS(),fE=JS();function pE(e,t,n,r,i){return rE(e,n,r),oE(e,e),[i/aE(t=eE(-e[1],e[0]),eE(-n[1],n[0])),t]}function dE(e,t){return nE(e,-t[1],t[0])}function vE(e,t,n){return uE(e,t,n),oE(e,e),e}function gE(e,t){return e[0]===t[0]&&e[1]===t[1]}var mE=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b(this,e),E(this,"complex",void 0),E(this,"join",void 0),E(this,"cap",void 0),E(this,"miterLimit",void 0),E(this,"thickness",void 0),E(this,"normal",void 0),E(this,"lastFlip",-1),E(this,"miter",eE(0,0)),E(this,"started",!1),E(this,"dash",!1),E(this,"totalDistance",0),E(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return S(e,[{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=e[o-1];c.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var l=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(F(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,c,h,p,l,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=e[o-1];c.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var l=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(F(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,c,h,p,l,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"segment_gaode2",value:function(e,t,n,r,i,o,a,s){var u=0,c=e.indices,l=e.positions,h=e.normals,f="square"===this.cap,p="bevel"===this.join,d=e_([a[0],a[1]]),v=e_([o[0],o[1]]);vE(lE,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=JS(),dE(this.normal,lE)),!this.started)if(this.started=!0,f){var m=JS(),y=JS();rE(m,this.normal,lE),rE(y,this.normal,lE),h.push(y[0],y[1],0),h.push(m[0],m[1],0),l.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,n,this.normal,this.thickness,this.totalDistance-g);if(c.push(t+0,t+1,t+2),i){gE(r,i)&&rE(i,r,oE(i,iE(i,r,n))),vE(hE,i,r);var _=D(pE(fE,JS(),lE,hE,this.thickness),2),b=_[0],x=_[1],S=aE(fE,this.normal)<0?-1:1,E=p;if(!E&&"miter"===this.join)b>this.miterLimit&&(E=!0);E?(h.push(this.normal[0],this.normal[1],0),h.push(x[0],x[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,F(this.lastFlip!==-S?[t,t+2,t+3]:[t+2,t+1,t+3])),c.push(t+2,t+3,t+4),dE(cE,hE),tE(this.normal,cE),h.push(this.normal[0],this.normal[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,h,r,x,b,this.totalDistance),c.push.apply(c,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),S=-1,tE(this.normal,x),u+=2),this.lastFlip=S}else{if(dE(this.normal,lE),f){var A=JS(),w=JS();uE(w,lE,this.normal),rE(A,lE,this.normal),h.push(w[0],w[1],0),h.push(A[0],A[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,r,this.normal,this.thickness,this.totalDistance);c.push.apply(c,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"simpleSegment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,c=e_([r[0],r[1]]),l=e_([n[0],n[1]]);vE(lE,c,l);var h=0;if(this.dash&&(h=this.lineSegmentDistance(c,l),this.totalDistance+=h),this.normal||(this.normal=JS(),dE(this.normal,lE)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(t+0,t+1,t+2),i){var f=e_([i[0],i[1]]);gE(c,f)&&rE(f,c,oE(f,iE(f,c,l))),vE(hE,f,c);var p=D(pE(fE,JS(),lE,hE,this.thickness),2),d=p[0],v=p[1];aE(fE,this.normal);this.extrusions(s,u,r,v,d,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,tE(this.normal,v),o+=2,this.lastFlip=-1}else dE(this.normal,lE),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2;return o}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,c="square"===this.cap,l="bevel"===this.join,h=e_([r[0],r[1]]),f=e_([n[0],n[1]]);vE(lE,h,f);var p=0;if(this.dash&&(p=this.lineSegmentDistance(h,f),this.totalDistance+=p),this.normal||(this.normal=JS(),dE(this.normal,lE)),!this.started)if(this.started=!0,c){var d=JS(),v=JS();rE(d,this.normal,lE),rE(v,this.normal,lE),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(a.push(t+0,t+1,t+2),i){var g=e_([i[0],i[1]]);gE(h,g)&&rE(g,h,oE(g,iE(g,h,f))),vE(hE,g,h);var m=D(pE(fE,JS(),lE,hE,this.thickness),2),y=m[0],_=m[1],b=aE(fE,this.normal)<0?-1:1,x=l;if(!x&&"miter"===this.join)y>this.miterLimit&&(x=!0);x?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,F(this.lastFlip!==-b?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),dE(cE,hE),tE(this.normal,cE),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,_,y,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),b=-1,tE(this.normal,_),o+=2),this.lastFlip=b}else{if(dE(this.normal,lE),c){var S=JS(),E=JS();uE(E,lE,this.normal),rE(S,lE,this.normal),u.push(E[0],E[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();function yE(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new mE({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],c=a[s];i.extrude_gaode2(u,c)}}else{var l=t;l[0]&&!Array.isArray(l[0][0])&&(l=[t]),l.forEach((function(e){i.extrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function _E(e){var t=h_(e.coordinates);return{vertices:[].concat(F(t),F(t),F(t),F(t)),indices:[0,1,2,2,3,0],size:t.length}}function bE(e){var t=e.coordinates,n=yx.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:yx(r,o,i),vertices:r,size:i}}var xE=function(){var e=_(g().mark((function e(t){var n,r,i,o,a,s,u,c,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o=t.iconMap,a={a_Color:dx,a_Position:vx,filter:gx,a_vertexId:mx,a_PickingColor:function(e){var t=e.id;return i?Rv(t):[0,0,0]},a_DistanceAndIndex:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]},a_Total_Distance:function(e,t,n){return[n[5]]},a_Size:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]},a_Normal:function(e,t,n,r,i){return i},a_Miter:function(e,t,n){return[n[4]]},a_iconMapUV:function(e){var t=e.texture,n=o[t]||{x:0,y:0};return[n.x,n.y]}},s={sizePerElement:0,elements:[]},u=0,c=[],l=3,r.forEach((function(e,t){var r=yE(e),i=r.indices,o=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(e){c.push(e+u)})),l=f;var d=o.length/f;s.sizePerElement=l,s.elements.push({featureIdx:t,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*f,r*f+f),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,F(a[n.name](e,t,s,r,i,u)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:s,indices:c});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),SE={pointFill:function(){var e=_(g().mark((function e(t){var n,r,i,o,a,s,u,c,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o=t.shape2d,a={a_Color:dx,a_Position:vx,filter:gx,a_vertexId:mx,a_PickingColor:function(e){var t=e.id;return i?Rv(t):[0,0,0]},a_Shape:function(e){var t=e.shape,n=void 0===t?2:t;return[o.indexOf(n)]},a_Extrude:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]},a_Size:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}},s={sizePerElement:0,elements:[]},u=0,c=[],l=3,r.forEach((function(e,t){var r=_E(e),i=r.indices,o=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(e){c.push(e+u)})),l=f;var d=o.length/f;s.sizePerElement=l,s.elements.push({featureIdx:t,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*f,r*f+f),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,F(a[n.name](e,t,s,r,i,u)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:s,indices:c});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),line:xE,polygonFill:function(){var e=_(g().mark((function e(t){var n,r,i,o,a,s,u,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o={a_Color:dx,a_Position:vx,filter:gx,a_vertexId:mx,a_PickingColor:function(e){var t=e.id;return i?Rv(t):[0,0,0]}},a={sizePerElement:0,elements:[]},s=0,u=[],c=3,r.forEach((function(e,t){var r=bE(e),i=r.indices,l=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(e){u.push(e+s)})),c=f;var d=l.length/f;a.sizePerElement=c,a.elements.push({featureIdx:t,vertices:l,normals:h,offset:s}),s+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],a=l.slice(r*f,r*f+f),s=0;p&&void 0!==p[r]&&(s=p[r]),n.forEach((function(n){var u;n&&o[n.name]&&(u=n.buffer.data).push.apply(u,F(o[n.name](e,t,a,r,i,s)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:a,indices:u});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},EE=v({},SE);function AE(){return(AE=_(g().mark((function e(t){var n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.workerType,r=t.data,!EE[n]){e.next=3;break}return e.abrupt("return",EE[n](r));case 3:return e.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e,t){var n=this;if("undefined"!=typeof self){var r={process:px};ix.onmessage=function(i,o){return cx(n,void 0,void 0,(function(){var n,a,s,u,c,l,h,f,p,d;return lx(this,(function(v){switch(v.label){case 0:switch(v.trys.push([0,19,,20]),i){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},r)];case 2:return n=v.sent(),ix.postMessage("done",{result:n}),[3,18];case 3:if(!t)throw new Error("Worker does not support batched processing");ax=new ux,sx=o.options||{},a=t(ax,sx,r),v.label=4;case 4:v.trys.push([4,9,10,15]),s=hx(a),v.label=5;case 5:return[4,s.next()];case 6:if((u=v.sent()).done)return[3,8];c=u.value,ix.postMessage("output-batch",{result:c}),v.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return l=v.sent(),p={error:l},[3,15];case 10:return v.trys.push([10,,13,14]),u&&!u.done&&(d=s.return)?[4,d.call(s)]:[3,12];case 11:v.sent(),v.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ix.postMessage("done",{}),[3,18];case 16:return ax.push(o.input),[3,18];case 17:return ax.close(),[3,18];case 18:return[3,20];case 19:return h=v.sent(),f=h instanceof Error?h.message:"",ix.postMessage("error",{error:f}),[3,20];case 20:return[2]}}))}))}}}((function(e){return AE.apply(this,arguments)}));var wE=new Map;function TE(e){!function(e,t){wE.set(e,t)}("l7-worker",e)}function CE(){var e,t=(e="l7-worker",wE.get(e));if(!t)throw new Error("get worker failed by workerName: ".concat("l7-worker","."));return t}function kE(){return(kE=_(g().mark((function e(t,n){var r,i,o,a,s;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=CE(),i=nx.getWorkerFarm({maxConcurrency:3,reuseWorkers:!0}),o=i.getWorkerPool({name:"l7-worker",source:r}),e.next=5,o.startJob("l7-worker",(function(e,t,n){return e.done(n)}));case 5:return(a=e.sent).postMessage("process",{input:{workerType:t,data:n}}),e.next=9,a.result;case 9:return s=e.sent,e.abrupt("return",s.result);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ME(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(t){e instanceof HTMLImageElement||ay(e)?t([e]):function(e,t){var n=e,r=[];if("string"==typeof n)$d({url:n},(function(e,n){n&&(r.push(n),t(r))}));else{var i=n.length,o=0;n.forEach((function(e){$d({url:e},(function(e,n){o++,n&&r.push(n),o===i&&t(r)}))}))}}(e,(function(e){t(e)}))}));return{originData:e,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]}}TE('var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),u=new T(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var h={};function p(){}function v(){}function d(){}var y={};c(y,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(k([])));m&&m!==e&&n.call(m,a)&&(y=m);var b=d.prototype=p.prototype=Object.create(y);function x(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var r;o(this,"_invoke",{value:function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=l(t[o],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=A(a,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function A(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a \'"+r+"\' method")),h;var o=l(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,h;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=d,o(b,"constructor",{value:d,configurable:!0}),o(d,"constructor",{value:v,configurable:!0}),v.displayName=c(d,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},x(w.prototype),c(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(b),c(b,s,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return(e=b(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],s=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);s=!0);}catch(t){c=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function b(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function w(t,e){return t(e={exports:{}},e.exports),e.exports}var E,A,O=function(t){return t&&t.Math==Math&&t},S=O("object"==typeof globalThis&&globalThis)||O("object"==typeof window&&window)||O("object"==typeof self&&self)||O("object"==typeof x&&x)||function(){return this}()||x||Function("return this")(),T=Object.defineProperty,k=function(t,e){try{T(S,t,{value:e,configurable:!0,writable:!0})}catch(r){S[t]=e}return e},I=S["__core-js_shared__"]||k("__core-js_shared__",{}),j=w((function(t){(t.exports=function(t,e){return I[t]||(I[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"})})),P=function(t){try{return!!t()}catch(t){return!0}},_=!P((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),M=Function.prototype,L=M.call,R=_&&M.bind.bind(L,L),N=_?R:function(t){return function(){return L.apply(t,arguments)}},C=function(t){return null==t},D=TypeError,F=function(t){if(C(t))throw D("Can\'t call method on "+t);return t},W=Object,z=function(t){return W(F(t))},B=N({}.hasOwnProperty),U=Object.hasOwn||function(t,e){return B(z(t),e)},G=0,V=Math.random(),H=N(1..toString),q=function(t){return"Symbol("+(void 0===t?"":t)+")_"+H(++G+V,36)},Z="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Y=S.process,$=S.Deno,K=Y&&Y.versions||$&&$.version,Q=K&&K.v8;Q&&(A=(E=Q.split("."))[0]>0&&E[0]<4?1:+(E[0]+E[1])),!A&&Z&&(!(E=Z.match(/Edge\\/(\\d+)/))||E[1]>=74)&&(E=Z.match(/Chrome\\/(\\d+)/))&&(A=+E[1]);var X=A,J=S.String,tt=!!Object.getOwnPropertySymbols&&!P((function(){var t=Symbol();return!J(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&X&&X<41})),et=tt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,rt=S.Symbol,nt=j("wks"),ot=et?rt.for||rt:rt&&rt.withoutSetter||q,it=function(t){return U(nt,t)||(nt[t]=tt&&U(rt,t)?rt[t]:ot("Symbol."+t)),nt[t]},at={};at[it("toStringTag")]="z";var ut="[object z]"===String(at),st="object"==typeof document&&document.all,ct={all:st,IS_HTMLDDA:void 0===st&&void 0!==st},ft=ct.all,lt=ct.IS_HTMLDDA?function(t){return"function"==typeof t||t===ft}:function(t){return"function"==typeof t},ht=!P((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),pt=ct.all,vt=ct.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:lt(t)||t===pt}:function(t){return"object"==typeof t?null!==t:lt(t)},dt=S.document,yt=vt(dt)&&vt(dt.createElement),gt=function(t){return yt?dt.createElement(t):{}},mt=!ht&&!P((function(){return 7!=Object.defineProperty(gt("div"),"a",{get:function(){return 7}}).a})),bt=ht&&P((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),xt=String,wt=TypeError,Et=function(t){if(vt(t))return t;throw wt(xt(t)+" is not an object")},At=Function.prototype.call,Ot=_?At.bind(At):function(){return At.apply(At,arguments)},St=function(t){return lt(t)?t:void 0},Tt=function(t,e){return arguments.length<2?St(S[t]):S[t]&&S[t][e]},kt=N({}.isPrototypeOf),It=Object,jt=et?function(t){return"symbol"==typeof t}:function(t){var e=Tt("Symbol");return lt(e)&&kt(e.prototype,It(t))},Pt=String,_t=function(t){try{return Pt(t)}catch(t){return"Object"}},Mt=TypeError,Lt=function(t){if(lt(t))return t;throw Mt(_t(t)+" is not a function")},Rt=function(t,e){var r=t[e];return C(r)?void 0:Lt(r)},Nt=TypeError,Ct=TypeError,Dt=it("toPrimitive"),Ft=function(t,e){if(!vt(t)||jt(t))return t;var r,n=Rt(t,Dt);if(n){if(void 0===e&&(e="default"),r=Ot(n,t,e),!vt(r)||jt(r))return r;throw Ct("Can\'t convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&lt(r=t.toString)&&!vt(n=Ot(r,t)))return n;if(lt(r=t.valueOf)&&!vt(n=Ot(r,t)))return n;if("string"!==e&&lt(r=t.toString)&&!vt(n=Ot(r,t)))return n;throw Nt("Can\'t convert object to primitive value")}(t,e)},Wt=function(t){var e=Ft(t,"string");return jt(e)?e:e+""},zt=TypeError,Bt=Object.defineProperty,Ut=Object.getOwnPropertyDescriptor,Gt={f:ht?bt?function(t,e,r){if(Et(t),e=Wt(e),Et(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Ut(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Bt(t,e,r)}:Bt:function(t,e,r){if(Et(t),e=Wt(e),Et(r),mt)try{return Bt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw zt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Vt=Function.prototype,Ht=ht&&Object.getOwnPropertyDescriptor,qt=U(Vt,"name"),Zt={EXISTS:qt,PROPER:qt&&"something"===function(){}.name,CONFIGURABLE:qt&&(!ht||ht&&Ht(Vt,"name").configurable)},Yt=N(Function.toString);lt(I.inspectSource)||(I.inspectSource=function(t){return Yt(t)});var $t,Kt,Qt,Xt=I.inspectSource,Jt=S.WeakMap,te=lt(Jt)&&/native code/.test(String(Jt)),ee=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},re=ht?function(t,e,r){return Gt.f(t,e,ee(1,r))}:function(t,e,r){return t[e]=r,t},ne=j("keys"),oe=function(t){return ne[t]||(ne[t]=q(t))},ie={},ae=S.TypeError,ue=S.WeakMap;if(te||I.state){var se=I.state||(I.state=new ue);se.get=se.get,se.has=se.has,se.set=se.set,$t=function(t,e){if(se.has(t))throw ae("Object already initialized");return e.facade=t,se.set(t,e),e},Kt=function(t){return se.get(t)||{}},Qt=function(t){return se.has(t)}}else{var ce=oe("state");ie[ce]=!0,$t=function(t,e){if(U(t,ce))throw ae("Object already initialized");return e.facade=t,re(t,ce,e),e},Kt=function(t){return U(t,ce)?t[ce]:{}},Qt=function(t){return U(t,ce)}}var fe={set:$t,get:Kt,has:Qt,enforce:function(t){return Qt(t)?Kt(t):$t(t,{})},getterFor:function(t){return function(e){var r;if(!vt(e)||(r=Kt(e)).type!==t)throw ae("Incompatible receiver, "+t+" required");return r}}},le=w((function(t){var e=Zt.CONFIGURABLE,r=fe.enforce,n=fe.get,o=String,i=Object.defineProperty,a=N("".slice),u=N("".replace),s=N([].join),c=ht&&!P((function(){return 8!==i((function(){}),"length",{value:8}).length})),f=String(String).split("String"),l=t.exports=function(t,n,l){"Symbol("===a(o(n),0,7)&&(n="["+u(o(n),/^Symbol\\(([^)]*)\\)/,"$1")+"]"),l&&l.getter&&(n="get "+n),l&&l.setter&&(n="set "+n),(!U(t,"name")||e&&t.name!==n)&&(ht?i(t,"name",{value:n,configurable:!0}):t.name=n),c&&l&&U(l,"arity")&&t.length!==l.arity&&i(t,"length",{value:l.arity});try{l&&U(l,"constructor")&&l.constructor?ht&&i(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var h=r(t);return U(h,"source")||(h.source=s(f,"string"==typeof n?n:"")),t};Function.prototype.toString=l((function(){return lt(this)&&n(this).source||Xt(this)}),"toString")})),he=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(lt(r)&&le(r,i,n),n.global)o?t[e]=r:k(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Gt.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},pe=N({}.toString),ve=N("".slice),de=function(t){return ve(pe(t),8,-1)},ye=it("toStringTag"),ge=Object,me="Arguments"==de(function(){return arguments}()),be=ut?de:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ge(t),ye))?r:me?de(e):"Object"==(n=de(e))&&lt(e.callee)?"Arguments":n},xe=ut?{}.toString:function(){return"[object "+be(this)+"]"};ut||he(Object.prototype,"toString",xe,{unsafe:!0});var we={}.propertyIsEnumerable,Ee=Object.getOwnPropertyDescriptor,Ae={f:Ee&&!we.call({1:2},1)?function(t){var e=Ee(this,t);return!!e&&e.enumerable}:we},Oe=Object,Se=N("".split),Te=P((function(){return!Oe("z").propertyIsEnumerable(0)}))?function(t){return"String"==de(t)?Se(t,""):Oe(t)}:Oe,ke=function(t){return Te(F(t))},Ie=Object.getOwnPropertyDescriptor,je={f:ht?Ie:function(t,e){if(t=ke(t),e=Wt(e),mt)try{return Ie(t,e)}catch(t){}if(U(t,e))return ee(!Ot(Ae.f,t,e),t[e])}},Pe=Math.ceil,_e=Math.floor,Me=Math.trunc||function(t){var e=+t;return(e>0?_e:Pe)(e)},Le=function(t){var e=+t;return e!=e||0===e?0:Me(e)},Re=Math.max,Ne=Math.min,Ce=function(t,e){var r=Le(t);return r<0?Re(r+e,0):Ne(r,e)},De=Math.min,Fe=function(t){return t>0?De(Le(t),9007199254740991):0},We=function(t){return Fe(t.length)},ze=function(t){return function(e,r,n){var o,i=ke(e),a=We(i),u=Ce(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},Be={includes:ze(!0),indexOf:ze(!1)},Ue=Be.indexOf,Ge=N([].push),Ve=function(t,e){var r,n=ke(t),o=0,i=[];for(r in n)!U(ie,r)&&U(n,r)&&Ge(i,r);for(;e.length>o;)U(n,r=e[o++])&&(~Ue(i,r)||Ge(i,r));return i},He=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qe=He.concat("length","prototype"),Ze={f:Object.getOwnPropertyNames||function(t){return Ve(t,qe)}},Ye={f:Object.getOwnPropertySymbols},$e=N([].concat),Ke=Tt("Reflect","ownKeys")||function(t){var e=Ze.f(Et(t)),r=Ye.f;return r?$e(e,r(t)):e},Qe=function(t,e,r){for(var n=Ke(e),o=Gt.f,i=je.f,a=0;a<n.length;a++){var u=n[a];U(t,u)||r&&U(r,u)||o(t,u,i(e,u))}},Xe=/#|\\.prototype\\./,Je=function(t,e){var r=er[tr(t)];return r==nr||r!=rr&&(lt(e)?P(e):!!e)},tr=Je.normalize=function(t){return String(t).replace(Xe,".").toLowerCase()},er=Je.data={},rr=Je.NATIVE="N",nr=Je.POLYFILL="P",or=Je,ir=je.f,ar=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?S:c?S[u]||k(u,{}):(S[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=ir(r,n))&&a.value:r[n],!or(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qe(i,o)}(t.sham||o&&o.sham)&&re(i,"sham",!0),he(r,n,i,t)}},ur="undefined"!=typeof process&&"process"==de(process),sr=String,cr=TypeError,fr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=function(t,e,r){try{return N(Lt(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(t){}}(Object.prototype,"__proto__","set"))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return Et(r),function(t){if("object"==typeof t||lt(t))return t;throw cr("Can\'t set "+sr(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),lr=Gt.f,hr=it("toStringTag"),pr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!U(t,hr)&&lr(t,hr,{configurable:!0,value:e})},vr=function(t,e,r){return r.get&&le(r.get,e,{getter:!0}),r.set&&le(r.set,e,{setter:!0}),Gt.f(t,e,r)},dr=it("species"),yr=function(t){var e=Tt(t);ht&&e&&!e[dr]&&vr(e,dr,{configurable:!0,get:function(){return this}})},gr=TypeError,mr=function(t,e){if(kt(e,t))return t;throw gr("Incorrect invocation")},br=function(){},xr=[],wr=Tt("Reflect","construct"),Er=/^\\s*(?:class|function)\\b/,Ar=N(Er.exec),Or=!Er.exec(br),Sr=function(t){if(!lt(t))return!1;try{return wr(br,xr,t),!0}catch(t){return!1}},Tr=function(t){if(!lt(t))return!1;switch(be(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Or||!!Ar(Er,Xt(t))}catch(t){return!0}};Tr.sham=!0;var kr,Ir,jr,Pr,_r=!wr||P((function(){var t;return Sr(Sr.call)||!Sr(Object)||!Sr((function(){t=!0}))||t}))?Tr:Sr,Mr=TypeError,Lr=function(t){if(_r(t))return t;throw Mr(_t(t)+" is not a constructor")},Rr=it("species"),Nr=function(t,e){var r,n=Et(t).constructor;return void 0===n||C(r=Et(n)[Rr])?e:Lr(r)},Cr=Function.prototype,Dr=Cr.apply,Fr=Cr.call,Wr="object"==typeof Reflect&&Reflect.apply||(_?Fr.bind(Dr):function(){return Fr.apply(Dr,arguments)}),zr=function(t){if("Function"===de(t))return N(t)},Br=zr(zr.bind),Ur=function(t,e){return Lt(t),void 0===e?t:_?Br(t,e):function(){return t.apply(e,arguments)}},Gr=Tt("document","documentElement"),Vr=N([].slice),Hr=TypeError,qr=function(t,e){if(t<e)throw Hr("Not enough arguments");return t},Zr=/(?:ipad|iphone|ipod).*applewebkit/i.test(Z),Yr=S.setImmediate,$r=S.clearImmediate,Kr=S.process,Qr=S.Dispatch,Xr=S.Function,Jr=S.MessageChannel,tn=S.String,en=0,rn={};P((function(){kr=S.location}));var nn=function(t){if(U(rn,t)){var e=rn[t];delete rn[t],e()}},on=function(t){return function(){nn(t)}},an=function(t){nn(t.data)},un=function(t){S.postMessage(tn(t),kr.protocol+"//"+kr.host)};Yr&&$r||(Yr=function(t){qr(arguments.length,1);var e=lt(t)?t:Xr(t),r=Vr(arguments,1);return rn[++en]=function(){Wr(e,void 0,r)},Ir(en),en},$r=function(t){delete rn[t]},ur?Ir=function(t){Kr.nextTick(on(t))}:Qr&&Qr.now?Ir=function(t){Qr.now(on(t))}:Jr&&!Zr?(Pr=(jr=new Jr).port2,jr.port1.onmessage=an,Ir=Ur(Pr.postMessage,Pr)):S.addEventListener&&lt(S.postMessage)&&!S.importScripts&&kr&&"file:"!==kr.protocol&&!P(un)?(Ir=un,S.addEventListener("message",an,!1)):Ir="onreadystatechange"in gt("script")?function(t){Gr.appendChild(gt("script")).onreadystatechange=function(){Gr.removeChild(this),nn(t)}}:function(t){setTimeout(on(t),0)});var sn={set:Yr,clear:$r},cn=function(){this.head=null,this.tail=null};cn.prototype={add:function(t){var e={item:t,next:null},r=this.tail;r?r.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var fn,ln,hn,pn,vn,dn=cn,yn=/ipad|iphone|ipod/i.test(Z)&&"undefined"!=typeof Pebble,gn=/web0s(?!.*chrome)/i.test(Z),mn=je.f,bn=sn.set,xn=S.MutationObserver||S.WebKitMutationObserver,wn=S.document,En=S.process,An=S.Promise,On=mn(S,"queueMicrotask"),Sn=On&&On.value;if(!Sn){var Tn=new dn,kn=function(){var t,e;for(ur&&(t=En.domain)&&t.exit();e=Tn.get();)try{e()}catch(t){throw Tn.head&&fn(),t}t&&t.enter()};Zr||ur||gn||!xn||!wn?!yn&&An&&An.resolve?((pn=An.resolve(void 0)).constructor=An,vn=Ur(pn.then,pn),fn=function(){vn(kn)}):ur?fn=function(){En.nextTick(kn)}:(bn=Ur(bn,S),fn=function(){bn(kn)}):(ln=!0,hn=wn.createTextNode(""),new xn(kn).observe(hn,{characterData:!0}),fn=function(){hn.data=ln=!ln}),Sn=function(t){Tn.head||fn(),Tn.add(t)}}var In,jn,Pn,_n=Sn,Mn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Ln=S.Promise,Rn="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Nn=!Rn&&!ur&&"object"==typeof window&&"object"==typeof document,Cn=(Ln&&Ln.prototype,it("species")),Dn=!1,Fn=lt(S.PromiseRejectionEvent),Wn={CONSTRUCTOR:or("Promise",(function(){var t=Xt(Ln),e=t!==String(Ln);if(!e&&66===X)return!0;if(!X||X<51||!/native code/.test(t)){var r=new Ln((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Dn=r.then((function(){}))instanceof n))return!0}return!e&&(Nn||Rn)&&!Fn})),REJECTION_EVENT:Fn,SUBCLASSING:Dn},zn=TypeError,Bn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw zn("Bad Promise constructor");e=t,r=n})),this.resolve=Lt(e),this.reject=Lt(r)},Un={f:function(t){return new Bn(t)}},Gn=sn.set,Vn=Wn.CONSTRUCTOR,Hn=Wn.REJECTION_EVENT,qn=Wn.SUBCLASSING,Zn=fe.getterFor("Promise"),Yn=fe.set,$n=Ln&&Ln.prototype,Kn=Ln,Qn=$n,Xn=S.TypeError,Jn=S.document,to=S.process,eo=Un.f,ro=eo,no=!!(Jn&&Jn.createEvent&&S.dispatchEvent),oo=function(t){var e;return!(!vt(t)||!lt(e=t.then))&&e},io=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&fo(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Xn("Promise-chain cycle")):(n=oo(r))?Ot(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},ao=function(t,e){t.notified||(t.notified=!0,_n((function(){for(var r,n=t.reactions;r=n.get();)io(r,t);t.notified=!1,e&&!t.rejection&&so(t)})))},uo=function(t,e,r){var n,o;no?((n=Jn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),S.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=S["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){try{1==arguments.length?console.error(t):console.error(t,e)}catch(t){}}("Unhandled promise rejection",r)},so=function(t){Ot(Gn,S,(function(){var e,r=t.facade,n=t.value;if(co(t)&&(e=Mn((function(){ur?to.emit("unhandledRejection",n,r):uo("unhandledrejection",r,n)})),t.rejection=ur||co(t)?2:1,e.error))throw e.value}))},co=function(t){return 1!==t.rejection&&!t.parent},fo=function(t){Ot(Gn,S,(function(){var e=t.facade;ur?to.emit("rejectionHandled",e):uo("rejectionhandled",e,t.value)}))},lo=function(t,e,r){return function(n){t(e,n,r)}},ho=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,ao(t,!0))},po=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Xn("Promise can\'t be resolved itself");var n=oo(e);n?_n((function(){var r={done:!1};try{Ot(n,e,lo(po,r,t),lo(ho,r,t))}catch(e){ho(r,e,t)}})):(t.value=e,t.state=1,ao(t,!1))}catch(e){ho({done:!1},e,t)}}};if(Vn&&(Qn=(Kn=function(t){mr(this,Qn),Lt(t),Ot(In,this);var e=Zn(this);try{t(lo(po,e),lo(ho,e))}catch(t){ho(e,t)}}).prototype,(In=function(t){Yn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new dn,rejection:!1,state:0,value:void 0})}).prototype=he(Qn,"then",(function(t,e){var r=Zn(this),n=eo(Nr(this,Kn));return r.parent=!0,n.ok=!lt(t)||t,n.fail=lt(e)&&e,n.domain=ur?to.domain:void 0,0==r.state?r.reactions.add(n):_n((function(){io(n,r)})),n.promise})),jn=function(){var t=new In,e=Zn(t);this.promise=t,this.resolve=lo(po,e),this.reject=lo(ho,e)},Un.f=eo=function(t){return t===Kn||void 0===t?new jn(t):ro(t)},lt(Ln)&&$n!==Object.prototype)){Pn=$n.then,qn||he($n,"then",(function(t,e){var r=this;return new Kn((function(t,e){Ot(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete $n.constructor}catch(t){}fr&&fr($n,Qn)}ar({global:!0,constructor:!0,wrap:!0,forced:Vn},{Promise:Kn}),pr(Kn,"Promise",!1),yr("Promise");var vo={},yo=it("iterator"),go=Array.prototype,mo=function(t){return void 0!==t&&(vo.Array===t||go[yo]===t)},bo=it("iterator"),xo=function(t){if(!C(t))return Rt(t,bo)||Rt(t,"@@iterator")||vo[be(t)]},wo=TypeError,Eo=function(t,e){var r=arguments.length<2?xo(t):e;if(Lt(r))return Et(Ot(r,t));throw wo(_t(t)+" is not iterable")},Ao=function(t,e,r){var n,o;Et(t);try{if(!(n=Rt(t,"return"))){if("throw"===e)throw r;return r}n=Ot(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return Et(n),r},Oo=TypeError,So=function(t,e){this.stopped=t,this.result=e},To=So.prototype,ko=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=Ur(e,f),y=function(t){return n&&Ao(n,"normal",t),new So(!0,t)},g=function(t){return l?(Et(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Oo(_t(t)+" is not iterable");if(mo(o)){for(i=0,a=We(t);a>i;i++)if((u=g(t[i]))&&kt(To,u))return u;return new So(!1)}n=Eo(t,o)}for(s=h?t.next:n.next;!(c=Ot(s,n)).done;){try{u=g(c.value)}catch(t){Ao(n,"throw",t)}if("object"==typeof u&&u&&kt(To,u))return u}return new So(!1)},Io=it("iterator"),jo=!1;try{var Po=0,_o={next:function(){return{done:!!Po++}},return:function(){jo=!0}};_o[Io]=function(){return this},Array.from(_o,(function(){throw 2}))}catch(t){}var Mo=function(t,e){if(!e&&!jo)return!1;var r=!1;try{var n={};n[Io]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Lo=Wn.CONSTRUCTOR||!Mo((function(t){Ln.all(t).then(void 0,(function(){}))}));ar({target:"Promise",stat:!0,forced:Lo},{all:function(t){var e=this,r=Un.f(e),n=r.resolve,o=r.reject,i=Mn((function(){var r=Lt(e.resolve),i=[],a=0,u=1;ko(t,(function(t){var s=a++,c=!1;u++,Ot(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Ro=Wn.CONSTRUCTOR,No=Ln&&Ln.prototype;if(ar({target:"Promise",proto:!0,forced:Ro,real:!0},{catch:function(t){return this.then(void 0,t)}}),lt(Ln)){var Co=Tt("Promise").prototype.catch;No.catch!==Co&&he(No,"catch",Co,{unsafe:!0})}ar({target:"Promise",stat:!0,forced:Lo},{race:function(t){var e=this,r=Un.f(e),n=r.reject,o=Mn((function(){var o=Lt(e.resolve);ko(t,(function(t){Ot(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ar({target:"Promise",stat:!0,forced:Wn.CONSTRUCTOR},{reject:function(t){var e=Un.f(this);return Ot(e.reject,void 0,t),e.promise}});var Do=Wn.CONSTRUCTOR;Tt("Promise");function Fo(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ar({target:"Promise",stat:!0,forced:Do},{resolve:function(t){return function(t,e){if(Et(t),vt(e)&&e.constructor===t)return e;var r=Un.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Wo="undefined"!=typeof window&&void 0!==window.orientation,zo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Fo(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Fo(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),Bo=new Map;function Uo(t){Fo(t.source&&!t.url||!t.source&&t.url);var e=Bo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Go((e=t,"try {\\n  importScripts(\'"+e+"\');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),Bo.set(t.url,e)),t.source&&(e=Go(t.source),Bo.set(t.source,e))),Fo(e),e}function Go(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Vo(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Vo(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var qo=function(){},Zo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Fo(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=qo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=qo,this.onError=qo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Vo(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Uo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Yo=self&&self.__assign||function(){return(Yo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},$o=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},Ko=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Qo=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Yo(Yo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),$o(this,void 0,void 0,(function(){var n,o=this;return Ko(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return $o(this,void 0,void 0,(function(){var t,e,r;return Ko(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new zo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Zo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Wo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Xo=self&&self.__assign||function(){return(Xo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Jo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ti={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ei=(function(){function t(t){this.workerPools=new Map,this.props=Xo({},ti),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return Zo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Jo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Xo(Xo({},this.props),t);try{for(var n=Jo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Qo({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ri=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ni(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ei.get(t);e||(e=function(e){if(ni(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ei.get(t);ei.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Vo(e);self.postMessage(r,n)}},t}();function ni(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var oi,ii,ai=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ui=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},si=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ci=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},fi=0;function li(t,e){var r=this;if("undefined"!=typeof self){var n={process:hi};ri.onmessage=function(o,i){return ui(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return si(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ri.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");oi=new ai,ii=i.options||{},a=e(oi,ii,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=ci(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ri.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ri.postMessage("done",{}),[3,18];case 16:return oi.push(i.input),[3,18];case 17:return oi.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ri.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function hi(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=fi++,i=function(t,e){if(e.id===o)switch(t){case"done":ri.removeEventListener(i),r(e.result);break;case"error":ri.removeEventListener(i),n(e.error)}};ri.addEventListener(i);var a={id:o,input:t,options:e};ri.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var pi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},vi=gt("span").classList,di=vi&&vi.constructor&&vi.constructor.prototype,yi=di===Object.prototype?void 0:di,gi=Array.isArray||function(t){return"Array"==de(t)},mi=it("species"),bi=Array,xi=function(t,e){return new(function(t){var e;return gi(t)&&(e=t.constructor,(_r(e)&&(e===bi||gi(e.prototype))||vt(e)&&null===(e=e[mi]))&&(e=void 0)),void 0===e?bi:e}(t))(0===e?0:e)},wi=N([].push),Ei=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=z(s),d=Te(v),y=Ur(c,f),g=We(d),m=0,b=l||xi,x=e?b(s,g):r||a?b(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)x[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:wi(x,h)}else switch(t){case 4:return!1;case 7:wi(x,h)}return i?-1:n||o?o:x}},Ai={forEach:Ei(0),map:Ei(1),filter:Ei(2),some:Ei(3),every:Ei(4),find:Ei(5),findIndex:Ei(6),filterReject:Ei(7)},Oi=function(t,e){var r=[][t];return!!r&&P((function(){r.call(null,e||function(){return 1},1)}))},Si=Ai.forEach,Ti=Oi("forEach")?[].forEach:function(t){return Si(this,t,arguments.length>1?arguments[1]:void 0)},ki=function(t){if(t&&t.forEach!==Ti)try{re(t,"forEach",Ti)}catch(e){t.forEach=Ti}};for(var Ii in pi)pi[Ii]&&ki(S[Ii]&&S[Ii].prototype);ki(yi);var ji=function(t,e,r){var n=Wt(e);n in t?Gt.f(t,n,ee(0,r)):t[n]=r},Pi=it("species"),_i=function(t){return X>=51||!P((function(){var e=[];return(e.constructor={})[Pi]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Mi=_i("slice"),Li=it("species"),Ri=Array,Ni=Math.max;ar({target:"Array",proto:!0,forced:!Mi},{slice:function(t,e){var r,n,o,i=ke(this),a=We(i),u=Ce(t,a),s=Ce(void 0===e?a:e,a);if(gi(i)&&(r=i.constructor,(_r(r)&&(r===Ri||gi(r.prototype))||vt(r)&&null===(r=r[Li]))&&(r=void 0),r===Ri||void 0===r))return Vr(i,u,s);for(n=new(void 0===r?Ri:r)(Ni(s-u,0)),o=0;u<s;u++,o++)u in i&&ji(n,o,i[u]);return n.length=o,n}});var Ci=Zt.EXISTS,Di=Function.prototype,Fi=N(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=N(Wi.exec);ht&&!Ci&&vr(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi,Ui=Object.keys||function(t){return Ve(t,He)},Gi={f:ht&&!bt?Object.defineProperties:function(t,e){Et(t);for(var r,n=ke(e),o=Ui(e),i=o.length,a=0;i>a;)Gt.f(t,r=o[a++],n[r]);return t}},Vi=oe("IE_PROTO"),Hi=function(){},qi=function(t){return"<script>"+t+"<\\/script>"},Zi=function(t){t.write(qi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Yi=function(){try{Bi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Yi="undefined"!=typeof document?document.domain&&Bi?Zi(Bi):((e=gt("iframe")).style.display="none",Gr.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(qi("document.F=Object")),t.close(),t.F):Zi(Bi);for(var r=He.length;r--;)delete Yi.prototype[He[r]];return Yi()};ie[Vi]=!0;var $i=Object.create||function(t,e){var r;return null!==t?(Hi.prototype=Et(t),r=new Hi,Hi.prototype=null,r[Vi]=t):r=Yi(),void 0===e?r:Gi.f(r,e)},Ki=Gt.f,Qi=it("unscopables"),Xi=Array.prototype;null==Xi[Qi]&&Ki(Xi,Qi,{configurable:!0,value:$i(null)});var Ji,ta,ea,ra=function(t){Xi[Qi][t]=!0},na=!P((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),oa=oe("IE_PROTO"),ia=Object,aa=ia.prototype,ua=na?ia.getPrototypeOf:function(t){var e=z(t);if(U(e,oa))return e[oa];var r=e.constructor;return lt(r)&&e instanceof r?r.prototype:e instanceof ia?aa:null},sa=it("iterator"),ca=!1;[].keys&&("next"in(ea=[].keys())?(ta=ua(ua(ea)))!==Object.prototype&&(Ji=ta):ca=!0),(!vt(Ji)||P((function(){var t={};return Ji[sa].call(t)!==t})))&&(Ji={}),lt(Ji[sa])||he(Ji,sa,(function(){return this}));var fa={IteratorPrototype:Ji,BUGGY_SAFARI_ITERATORS:ca},la=fa.IteratorPrototype,ha=function(){return this},pa=Zt.PROPER,va=Zt.CONFIGURABLE,da=fa.IteratorPrototype,ya=fa.BUGGY_SAFARI_ITERATORS,ga=it("iterator"),ma=function(){return this},ba=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=$i(la,{next:ee(+!n,r)}),pr(t,o,!1),vo[o]=ha}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ya&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[ga]||p["@@iterator"]||o&&p[o],d=!ya&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ua(y.call(new t)))!==Object.prototype&&u.next&&(ua(u)!==da&&(fr?fr(u,da):lt(u[ga])||he(u,ga,ma)),pr(u,l,!0)),pa&&"values"==o&&v&&"values"!==v.name&&(va?re(p,"name","values"):(h=!0,d=function(){return Ot(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ya||h||!(c in p))&&he(p,c,s[c]);else ar({target:e,proto:!0,forced:ya||h},s);return p[ga]!==d&&he(p,ga,d,{name:o}),vo[e]=d,s},xa=function(t,e){return{value:t,done:e}},wa=Gt.f,Ea=fe.set,Aa=fe.getterFor("Array Iterator"),Oa=ba(Array,"Array",(function(t,e){Ea(this,{type:"Array Iterator",target:ke(t),index:0,kind:e})}),(function(){var t=Aa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,xa(void 0,!0)):xa("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),Sa=vo.Arguments=vo.Array;if(ra("keys"),ra("values"),ra("entries"),ht&&"values"!==Sa.name)try{wa(Sa,"name",{value:"values"})}catch(t){}var Ta,ka,Ia,ja="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Pa=fe.enforce,_a=fe.get,Ma=S.Int8Array,La=Ma&&Ma.prototype,Ra=S.Uint8ClampedArray,Na=Ra&&Ra.prototype,Ca=Ma&&ua(Ma),Da=La&&ua(La),Fa=Object.prototype,Wa=S.TypeError,za=it("toStringTag"),Ba=q("TYPED_ARRAY_TAG"),Ua=ja&&!!fr&&"Opera"!==be(S.opera),Ga=!1,Va={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ha={BigInt64Array:8,BigUint64Array:8},qa=function(t){var e=ua(t);if(vt(e)){var r=_a(e);return r&&U(r,"TypedArrayConstructor")?r.TypedArrayConstructor:qa(e)}},Za=function(t){if(!vt(t))return!1;var e=be(t);return U(Va,e)||U(Ha,e)};for(Ta in Va)(Ia=(ka=S[Ta])&&ka.prototype)?Pa(Ia).TypedArrayConstructor=ka:Ua=!1;for(Ta in Ha)(Ia=(ka=S[Ta])&&ka.prototype)&&(Pa(Ia).TypedArrayConstructor=ka);if((!Ua||!lt(Ca)||Ca===Function.prototype)&&(Ca=function(){throw Wa("Incorrect invocation")},Ua))for(Ta in Va)S[Ta]&&fr(S[Ta],Ca);if((!Ua||!Da||Da===Fa)&&(Da=Ca.prototype,Ua))for(Ta in Va)S[Ta]&&fr(S[Ta].prototype,Da);if(Ua&&ua(Na)!==Da&&fr(Na,Da),ht&&!U(Da,za))for(Ta in Ga=!0,vr(Da,za,{configurable:!0,get:function(){return vt(this)?this[Ba]:void 0}}),Va)S[Ta]&&re(S[Ta],Ba,Ta);var Ya={NATIVE_ARRAY_BUFFER_VIEWS:Ua,TYPED_ARRAY_TAG:Ga&&Ba,aTypedArray:function(t){if(Za(t))return t;throw Wa("Target is not a typed array")},aTypedArrayConstructor:function(t){if(lt(t)&&(!fr||kt(Ca,t)))return t;throw Wa(_t(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(ht){if(r)for(var o in Va){var i=S[o];if(i&&U(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}Da[t]&&!r||he(Da,t,r?e:Ua&&La[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(ht){if(fr){if(r)for(n in Va)if((o=S[n])&&U(o,t))try{delete o[t]}catch(t){}if(Ca[t]&&!r)return;try{return he(Ca,t,r?e:Ua&&Ca[t]||e)}catch(t){}}for(n in Va)!(o=S[n])||o[t]&&!r||he(o,t,e)}},getTypedArrayConstructor:qa,isView:function(t){if(!vt(t))return!1;var e=be(t);return"DataView"===e||U(Va,e)||U(Ha,e)},isTypedArray:Za,TypedArray:Ca,TypedArrayPrototype:Da},$a=Ya.NATIVE_ARRAY_BUFFER_VIEWS,Ka=S.ArrayBuffer,Qa=S.Int8Array,Xa=!$a||!P((function(){Qa(1)}))||!P((function(){new Qa(-1)}))||!Mo((function(t){new Qa,new Qa(null),new Qa(1.5),new Qa(t)}),!0)||P((function(){return 1!==new Qa(new Ka(2),1,void 0).length})),Ja=function(t,e,r){for(var n in e)he(t,n,e[n],r);return t},tu=RangeError,eu=function(t){if(void 0===t)return 0;var e=Le(t),r=Fe(e);if(e!==r)throw tu("Wrong length or index");return r},ru=Array,nu=Math.abs,ou=Math.pow,iu=Math.floor,au=Math.log,uu=Math.LN2,su=function(t,e,r){var n,o,i,a=ru(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?ou(2,-24)-ou(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=nu(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=iu(au(t)/uu),t*(i=ou(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*ou(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*ou(2,e),n+=c):(o=t*ou(2,c-1)*ou(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},cu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=ou(2,e),f-=a}return(c?-1:1)*r*ou(2,f-e)},fu=function(t){for(var e=z(this),r=We(e),n=arguments.length,o=Ce(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ce(i,r);a>o;)e[o++]=t;return e},lu=Array,hu=Math.max,pu=function(t,e,r){for(var n=We(t),o=Ce(e,n),i=Ce(void 0===r?n:r,n),a=lu(hu(i-o,0)),u=0;o<i;o++,u++)ji(a,u,t[o]);return a.length=u,a},vu=Ze.f,du=Zt.PROPER,yu=Zt.CONFIGURABLE,gu=fe.getterFor("ArrayBuffer"),mu=fe.getterFor("DataView"),bu=fe.set,xu=S.ArrayBuffer,wu=xu,Eu=wu&&wu.prototype,Au=S.DataView,Ou=Au&&Au.prototype,Su=Object.prototype,Tu=S.Array,ku=S.RangeError,Iu=N(fu),ju=N([].reverse),Pu=su,_u=cu,Mu=function(t){return[255&t]},Lu=function(t){return[255&t,t>>8&255]},Ru=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Nu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Cu=function(t){return Pu(t,23,4)},Du=function(t){return Pu(t,52,8)},Fu=function(t,e,r){vr(t.prototype,e,{configurable:!0,get:function(){return r(this)[e]}})},Wu=function(t,e,r,n){var o=eu(r),i=mu(t);if(o+e>i.byteLength)throw ku("Wrong index");var a=i.bytes,u=o+i.byteOffset,s=pu(a,u,u+e);return n?s:ju(s)},zu=function(t,e,r,n,o,i){var a=eu(r),u=mu(t);if(a+e>u.byteLength)throw ku("Wrong index");for(var s=u.bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(ja){var Bu=du&&"ArrayBuffer"!==xu.name;if(P((function(){xu(1)}))&&P((function(){new xu(-1)}))&&!P((function(){return new xu,new xu(1.5),new xu(NaN),1!=xu.length||Bu&&!yu})))Bu&&yu&&re(xu,"name","ArrayBuffer");else{(wu=function(t){return mr(this,Eu),new xu(eu(t))}).prototype=Eu;for(var Uu,Gu=vu(xu),Vu=0;Gu.length>Vu;)(Uu=Gu[Vu++])in wu||re(wu,Uu,xu[Uu]);Eu.constructor=wu}fr&&ua(Ou)!==Su&&fr(Ou,Su);var Hu=new Au(new wu(2)),qu=N(Ou.setInt8);Hu.setInt8(0,2147483648),Hu.setInt8(1,2147483649),!Hu.getInt8(0)&&Hu.getInt8(1)||Ja(Ou,{setInt8:function(t,e){qu(this,t,e<<24>>24)},setUint8:function(t,e){qu(this,t,e<<24>>24)}},{unsafe:!0})}else Eu=(wu=function(t){mr(this,Eu);var e=eu(t);bu(this,{type:"ArrayBuffer",bytes:Iu(Tu(e),0),byteLength:e}),ht||(this.byteLength=e,this.detached=!1)}).prototype,Ou=(Au=function(t,e,r){mr(this,Ou),mr(t,Eu);var n=gu(t),o=n.byteLength,i=Le(e);if(i<0||i>o)throw ku("Wrong offset");if(i+(r=void 0===r?o-i:Fe(r))>o)throw ku("Wrong length");bu(this,{type:"DataView",buffer:t,byteLength:r,byteOffset:i,bytes:n.bytes}),ht||(this.buffer=t,this.byteLength=r,this.byteOffset=i)}).prototype,ht&&(Fu(wu,"byteLength",gu),Fu(Au,"buffer",mu),Fu(Au,"byteLength",mu),Fu(Au,"byteOffset",mu)),Ja(Ou,{getInt8:function(t){return Wu(this,1,t)[0]<<24>>24},getUint8:function(t){return Wu(this,1,t)[0]},getInt16:function(t){var e=Wu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Wu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Nu(Wu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Nu(Wu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return _u(Wu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return _u(Wu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){zu(this,1,t,Mu,e)},setUint8:function(t,e){zu(this,1,t,Mu,e)},setInt16:function(t,e){zu(this,2,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){zu(this,2,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){zu(this,4,t,Ru,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){zu(this,4,t,Ru,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){zu(this,4,t,Cu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){zu(this,8,t,Du,e,arguments.length>2?arguments[2]:void 0)}});pr(wu,"ArrayBuffer"),pr(Au,"DataView");var Zu={ArrayBuffer:wu,DataView:Au},Yu=Math.floor,$u=Number.isInteger||function(t){return!vt(t)&&isFinite(t)&&Yu(t)===t},Ku=RangeError,Qu=RangeError,Xu=function(t,e){var r=function(t){var e=Le(t);if(e<0)throw Ku("The argument can\'t be less than 0");return e}(t);if(r%e)throw Qu("Wrong offset");return r},Ju=function(t){var e=be(t);return"BigInt64Array"==e||"BigUint64Array"==e},ts=TypeError,es=function(t){var e=Ft(t,"number");if("number"==typeof e)throw ts("Can\'t convert number to bigint");return BigInt(e)},rs=Ya.aTypedArrayConstructor,ns=function(t){var e,r,n,o,i,a,u,s,c=Lr(this),f=z(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!mo(v))for(s=(u=Eo(f,v)).next,f=[];!(a=Ot(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=Ur(h,arguments[2])),r=We(f),n=new(rs(c))(r),o=Ju(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?es(i):+i;return n},os=function(t,e,r){var n,o;return fr&&lt(n=e.constructor)&&n!==r&&vt(o=n.prototype)&&o!==r.prototype&&fr(t,o),t},is=w((function(t){var e=Ze.f,r=Ai.forEach,n=fe.get,o=fe.set,i=fe.enforce,a=Gt.f,u=je.f,s=Math.round,c=S.RangeError,f=Zu.ArrayBuffer,l=f.prototype,h=Zu.DataView,p=Ya.NATIVE_ARRAY_BUFFER_VIEWS,v=Ya.TYPED_ARRAY_TAG,d=Ya.TypedArray,y=Ya.TypedArrayPrototype,g=Ya.aTypedArrayConstructor,m=Ya.isTypedArray,b=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},x=function(t,e){vr(t,e,{configurable:!0,get:function(){return n(this)[e]}})},w=function(t){var e;return kt(l,t)||"ArrayBuffer"==(e=be(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!jt(e)&&e in t&&$u(+e)&&e>=0},A=function(t,e){return e=Wt(e),E(t,e)?ee(2,t[e]):u(t,e)},O=function(t,e,r){return e=Wt(e),!(E(t,e)&&vt(r)&&U(r,"value"))||U(r,"get")||U(r,"set")||r.configurable||U(r,"writable")&&!r.writable||U(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};ht?(p||(je.f=A,Gt.f=O,x(y,"buffer"),x(y,"byteOffset"),x(y,"byteLength"),x(y,"length")),ar({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:O}),t.exports=function(t,u,l){var g=t.match(/\\d+/)[0]/8,x=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,O=S[x],T=O,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?Xa&&(T=u((function(t,e,r,n){return mr(t,k),os(vt(e)?w(e)?void 0!==n?new O(e,Xu(r,g),n):void 0!==r?new O(e,Xu(r,g)):new O(e):m(e)?b(T,e):Ot(ns,T,e):new O(eu(e)),t,T)})),fr&&fr(T,d),r(e(O),(function(t){t in T||re(T,t,O[t])})),T.prototype=k):(T=u((function(t,e,r,n){mr(t,k);var i,a,u,s=0,l=0;if(vt(e)){if(!w(e))return m(e)?b(T,e):Ot(ns,T,e);i=e,l=Xu(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Fe(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=eu(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),fr&&fr(T,d),k=T.prototype=$i(y)),k.constructor!==T&&re(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&re(k,v,x);var P=T!=O;I[x]=T,ar({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||re(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||re(k,"BYTES_PER_ELEMENT",g),yr(x)}):t.exports=function(){}}));is("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var as=TypeError,us=function(t,e){if(!delete t[e])throw as("Cannot delete property "+_t(e)+" of "+_t(t))},ss=Math.min,cs=N([].copyWithin||function(t,e){var r=z(this),n=We(r),o=Ce(t,n),i=Ce(e,n),a=arguments.length>2?arguments[2]:void 0,u=ss((void 0===a?n:Ce(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:us(r,o),o+=s,i+=s;return r}),fs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("copyWithin",(function(t,e){return cs(fs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ls=Ai.every,hs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("every",(function(t){return ls(hs(this),t,arguments.length>1?arguments[1]:void 0)}));var ps=Ya.aTypedArray,vs=Ya.exportTypedArrayMethod,ds=N("".slice);vs("fill",(function(t){var e=arguments.length;ps(this);var r="Big"===ds(be(this),0,3)?es(t):+t;return Ot(fu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),P((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var ys=Ya.aTypedArrayConstructor,gs=Ya.getTypedArrayConstructor,ms=function(t){return ys(Nr(t,gs(t)))},bs=function(t,e){return function(t,e){for(var r=0,n=We(e),o=new t(n);n>r;)o[r]=e[r++];return o}(ms(t),e)},xs=Ai.filter,ws=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("filter",(function(t){var e=xs(ws(this),t,arguments.length>1?arguments[1]:void 0);return bs(this,e)}));var Es=Ai.find,As=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("find",(function(t){return Es(As(this),t,arguments.length>1?arguments[1]:void 0)}));var Os=Ai.findIndex,Ss=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("findIndex",(function(t){return Os(Ss(this),t,arguments.length>1?arguments[1]:void 0)}));var Ts=Ai.forEach,ks=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("forEach",(function(t){Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Be.includes,js=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("includes",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Be.indexOf,_s=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("indexOf",(function(t){return Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=it("iterator"),Ls=S.Uint8Array,Rs=N(Oa.values),Ns=N(Oa.keys),Cs=N(Oa.entries),Ds=Ya.aTypedArray,Fs=Ya.exportTypedArrayMethod,Ws=Ls&&Ls.prototype,zs=!P((function(){Ws[Ms].call([1])})),Bs=!!Ws&&Ws.values&&Ws[Ms]===Ws.values&&"values"===Ws.values.name,Us=function(){return Rs(Ds(this))};Fs("entries",(function(){return Cs(Ds(this))}),zs),Fs("keys",(function(){return Ns(Ds(this))}),zs),Fs("values",Us,zs||!Bs,{name:"values"}),Fs(Ms,Us,zs||!Bs,{name:"values"});var Gs=Ya.aTypedArray,Vs=Ya.exportTypedArrayMethod,Hs=N([].join);Vs("join",(function(t){return Hs(Gs(this),t)}));var qs=Math.min,Zs=[].lastIndexOf,Ys=!!Zs&&1/[1].lastIndexOf(1,-0)<0,$s=Oi("lastIndexOf"),Ks=Ys||!$s?function(t){if(Ys)return Wr(Zs,this,arguments)||0;var e=ke(this),r=We(e),n=r-1;for(arguments.length>1&&(n=qs(n,Le(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Zs,Qs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Wr(Ks,Qs(this),e>1?[t,arguments[1]]:[t])}));var Xs=Ai.map,Js=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("map",(function(t){return Xs(Js(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(ms(t))(e)}))}));var tc=TypeError,ec=function(t){return function(e,r,n,o){Lt(r);var i=z(e),a=Te(i),u=We(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw tc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},rc={left:ec(!1),right:ec(!0)},nc=rc.left,oc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return nc(oc(this),t,e,e>1?arguments[1]:void 0)}));var ic=rc.right,ac=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return ic(ac(this),t,e,e>1?arguments[1]:void 0)}));var uc=Ya.aTypedArray,sc=Ya.exportTypedArrayMethod,cc=Math.floor;sc("reverse",(function(){for(var t,e=uc(this).length,r=cc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var fc=S.RangeError,lc=S.Int8Array,hc=lc&&lc.prototype,pc=hc&&hc.set,vc=Ya.aTypedArray,dc=Ya.exportTypedArrayMethod,yc=!P((function(){var t=new Uint8ClampedArray(2);return Ot(pc,t,{length:1,0:3},1),3!==t[1]})),gc=yc&&Ya.NATIVE_ARRAY_BUFFER_VIEWS&&P((function(){var t=new lc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));dc("set",(function(t){vc(this);var e=Xu(arguments.length>1?arguments[1]:void 0,1),r=z(t);if(yc)return Ot(pc,this,r,e);var n=this.length,o=We(r),i=0;if(o+e>n)throw fc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!yc||gc);var mc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Vr(mc(this),t,e),n=ms(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),P((function(){new Int8Array(1).slice()})));var bc=Ai.some,xc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("some",(function(t){return bc(xc(this),t,arguments.length>1?arguments[1]:void 0)}));var wc=Math.floor,Ec=function(t,e){var r=t.length,n=wc(r/2);return r<8?Ac(t,e):Oc(t,Ec(pu(t,0,n),e),Ec(pu(t,n),e),e)},Ac=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Oc=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},Sc=Ec,Tc=Z.match(/firefox\\/(\\d+)/i),kc=!!Tc&&+Tc[1],Ic=/MSIE|Trident/.test(Z),jc=Z.match(/AppleWebKit\\/(\\d+)\\./),Pc=!!jc&&+jc[1],_c=Ya.aTypedArray,Mc=Ya.exportTypedArrayMethod,Lc=S.Uint16Array,Rc=Lc&&zr(Lc.prototype.sort),Nc=!(!Rc||P((function(){Rc(new Lc(2),null)}))&&P((function(){Rc(new Lc(2),{})}))),Cc=!!Rc&&!P((function(){if(X)return X<74;if(kc)return kc<67;if(Ic)return!0;if(Pc)return Pc<602;var t,e,r=new Lc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Rc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Mc("sort",(function(t){return void 0!==t&&Lt(t),Cc?Rc(this,t):Sc(_c(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!Cc||Nc);var Dc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("subarray",(function(t,e){var r=Dc(this),n=r.length,o=Ce(t,n);return new(ms(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Fe((void 0===e?n:Ce(e,n))-o))}));var Fc=S.Int8Array,Wc=Ya.aTypedArray,zc=Ya.exportTypedArrayMethod,Bc=[].toLocaleString,Uc=!!Fc&&P((function(){Bc.call(new Fc(1))}));zc("toLocaleString",(function(){return Wr(Bc,Uc?Vr(Wc(this)):Wc(this),Vr(arguments))}),P((function(){return[1,2].toLocaleString()!=new Fc([1,2]).toLocaleString()}))||!P((function(){Fc.prototype.toLocaleString.call([1,2])})));var Gc=Ya.exportTypedArrayMethod,Vc=S.Uint8Array,Hc=Vc&&Vc.prototype||{},qc=[].toString,Zc=N([].join);P((function(){qc.call({})}))&&(qc=function(){return Zc(this)});var Yc=Hc.toString!=qc;Gc("toString",qc,Yc),ar({target:"Array",proto:!0},{fill:fu}),ra("fill");var $c,Kc,Qc=String,Xc=function(t){if("Symbol"===be(t))throw TypeError("Cannot convert a Symbol value to a string");return Qc(t)},Jc=function(){var t=Et(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},tf=S.RegExp,ef=P((function(){var t=tf("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),rf=ef||P((function(){return!tf("a","y").sticky})),nf={BROKEN_CARET:ef||P((function(){var t=tf("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:rf,UNSUPPORTED_Y:ef},of=S.RegExp,af=P((function(){var t=of(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),uf=S.RegExp,sf=P((function(){var t=uf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),cf=fe.get,ff=j("native-string-replace",String.prototype.replace),lf=RegExp.prototype.exec,hf=lf,pf=N("".charAt),vf=N("".indexOf),df=N("".replace),yf=N("".slice),gf=(Kc=/b*/g,Ot(lf,$c=/a/,"a"),Ot(lf,Kc,"a"),0!==$c.lastIndex||0!==Kc.lastIndex),mf=nf.BROKEN_CARET,bf=void 0!==/()??/.exec("")[1];(gf||bf||mf||af||sf)&&(hf=function(t){var e,r,n,o,i,a,u,s=this,c=cf(s),f=Xc(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=Ot(hf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=mf&&s.sticky,v=Ot(Jc,s),d=s.source,y=0,g=f;if(p&&(v=df(v,"y",""),-1===vf(v,"g")&&(v+="g"),g=yf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==pf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),bf&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),gf&&(n=s.lastIndex),o=Ot(lf,p?r:s,g),p?o?(o.input=yf(o.input,y),o[0]=yf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:gf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),bf&&o&&o.length>1&&Ot(ff,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=$i(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var xf=hf;ar({target:"RegExp",proto:!0,forced:/./.exec!==xf},{exec:xf});var wf,Ef=it("species"),Af=RegExp.prototype,Of=function(t,e,r,n){var o=it(t),i=!P((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!P((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Ef]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=zr(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=zr(t),s=e.exec;return s===xf||s===Af.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));he(String.prototype,t,s[0]),he(Af,o,s[1])}n&&re(Af[o],"sham",!0)},Sf=N("".charAt),Tf=N("".charCodeAt),kf=N("".slice),If=function(t){return function(e,r){var n,o,i=Xc(F(e)),a=Le(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Tf(i,a))<55296||n>56319||a+1===u||(o=Tf(i,a+1))<56320||o>57343?t?Sf(i,a):n:t?kf(i,a,a+2):o-56320+(n-55296<<10)+65536}},jf={codeAt:If(!1),charAt:If(!0)},Pf=jf.charAt,_f=function(t,e,r){return e+(r?Pf(t,e).length:1)},Mf=Math.floor,Lf=N("".charAt),Rf=N("".replace),Nf=N("".slice),Cf=/\\$([$&\'`]|\\d{1,2}|<[^>]*>)/g,Df=/\\$([$&\'`]|\\d{1,2})/g,Ff=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Df;return void 0!==o&&(o=z(o),s=Cf),Rf(i,s,(function(i,s){var c;switch(Lf(s,0)){case"$":return"$";case"&":return t;case"`":return Nf(e,0,r);case"\'":return Nf(e,a);case"<":c=o[Nf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Mf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Lf(s,1):n[l-1]+Lf(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Wf=TypeError,zf=function(t,e){var r=t.exec;if(lt(r)){var n=Ot(r,t,e);return null!==n&&Et(n),n}if("RegExp"===de(t))return Ot(xf,t,e);throw Wf("RegExp#exec called on incompatible receiver")},Bf=it("replace"),Uf=Math.max,Gf=Math.min,Vf=N([].concat),Hf=N([].push),qf=N("".indexOf),Zf=N("".slice),Yf="$0"==="a".replace(/./,"$0"),$f=!!/./[Bf]&&""===/./[Bf]("a","$0");function Kf(t){this.message=t}Of("replace",(function(t,e,r){var n=$f?"$":"$0";return[function(t,r){var n=F(this),o=C(t)?void 0:Rt(t,Bf);return o?Ot(o,t,n,r):Ot(e,Xc(n),t,r)},function(t,o){var i=Et(this),a=Xc(t);if("string"==typeof o&&-1===qf(o,n)&&-1===qf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=lt(o);s||(o=Xc(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=zf(i,a);if(null===h)break;if(Hf(l,h),!c)break;""===Xc(h[0])&&(i.lastIndex=_f(a,Fe(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=Xc((h=l[y])[0]),m=Uf(Gf(Le(h.index),a.length),0),b=[],x=1;x<h.length;x++)Hf(b,void 0===(p=h[x])?p:String(p));var w=h.groups;if(s){var E=Vf([g],b,m,a);void 0!==w&&Hf(E,w);var A=Xc(Wr(o,void 0,E))}else A=Ff(g,a,m,b,w,o);m>=d&&(v+=Zf(a,d,m)+A,d=m+g.length)}return v+Zf(a,d)}]}),!!P((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Yf||$f),Kf.prototype=new Error,Kf.prototype.name="InvalidCharacterError",ar({global:!0,forced:S.globalThis!==S},{globalThis:S}),wf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:wf.devicePixelRatio;var Qf=TypeError,Xf=Object.getOwnPropertyDescriptor,Jf=ht&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(gi(t)&&!Xf(t,"length").writable)throw Qf("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},tl=TypeError,el=function(t){if(t>9007199254740991)throw tl("Maximum allowed index exceeded");return t},rl=_i("splice"),nl=Math.max,ol=Math.min;ar({target:"Array",proto:!0,forced:!rl},{splice:function(t,e){var r,n,o,i,a,u,s=z(this),c=We(s),f=Ce(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=ol(nl(Le(e),0),c-f)),el(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&ji(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:us(s,u);for(i=c;i>c-n+r;i--)us(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:us(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return Jf(s,c-n+r),o}});var il=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),al=Object.assign,ul=Object.defineProperty,sl=N([].concat),cl=!al||P((function(){if(ht&&1!==al({b:1},al(ul({},"a",{enumerable:!0,get:function(){ul(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=al({},t)[r]||"abcdefghijklmnopqrst"!=Ui(al({},e)).join("")}))?function(t,e){for(var r=z(t),n=arguments.length,o=1,i=Ye.f,a=Ae.f;n>o;)for(var u,s=Te(arguments[o++]),c=i?sl(Ui(s),i(s)):Ui(s),f=c.length,l=0;f>l;)u=c[l++],ht&&!Ot(a,s,u)||(r[u]=s[u]);return r}:al;ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==cl},{assign:cl});var fl=Ai.findIndex,ll=!0;"findIndex"in[]&&Array(1).findIndex((function(){ll=!1})),ar({target:"Array",proto:!0,forced:ll},{findIndex:function(t){return fl(this,t,arguments.length>1?arguments[1]:void 0)}}),ra("findIndex");var hl=jf.charAt,pl=fe.set,vl=fe.getterFor("String Iterator");ba(String,"String",(function(t){pl(this,{type:"String Iterator",string:Xc(t),index:0})}),(function(){var t,e=vl(this),r=e.string,n=e.index;return n>=r.length?xa(void 0,!0):(t=hl(r,n),e.index+=t.length,xa(t,!1))}));var dl=!P((function(){return Object.isExtensible(Object.preventExtensions({}))})),yl=Ze.f,gl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ml={f:function(t){return gl&&"Window"==de(t)?function(t){try{return yl(t)}catch(t){return pu(gl)}}(t):yl(ke(t))}},bl=P((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),xl=Object.isExtensible,wl=P((function(){xl(1)}))||bl?function(t){return!!vt(t)&&((!bl||"ArrayBuffer"!=de(t))&&(!xl||xl(t)))}:xl,El=w((function(t){var e=Gt.f,r=!1,n=q("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=Ze.f,e=N([].splice),o={};o[n]=1,t(o).length&&(Ze.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ar({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:ml.f}))},fastKey:function(t,e){if(!vt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!U(t,n)){if(!wl(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!U(t,n)){if(!wl(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return dl&&r&&wl(t)&&!U(t,n)&&i(t),t}};ie[n]=!0})),Al=(El.enable,El.fastKey,El.getWeakData,El.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=S[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=N(u[t]);he(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!vt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!vt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!vt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(or(t,!lt(a)||!(o||u.forEach&&!P((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),El.enable();else if(or(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=P((function(){l.has(1)})),v=Mo((function(t){new a(t)})),d=!o&&P((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){mr(t,u);var r=os(new a,t,s);return C(e)||ko(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ar({global:!0,constructor:!0,forced:s!=a},c),pr(s,t),o||r.setStrong(s,t,n),s}),Ol=El.getWeakData,Sl=fe.set,Tl=fe.getterFor,kl=Ai.find,Il=Ai.findIndex,jl=N([].splice),Pl=0,_l=function(t){return t.frozen||(t.frozen=new Ml)},Ml=function(){this.entries=[]},Ll=function(t,e){return kl(t.entries,(function(t){return t[0]===e}))};Ml.prototype={get:function(t){var e=Ll(this,t);if(e)return e[1]},has:function(t){return!!Ll(this,t)},set:function(t,e){var r=Ll(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Il(this.entries,(function(e){return e[0]===t}));return~e&&jl(this.entries,e,1),!!~e}};var Rl,Nl={getConstructor:function(t,e,r,n){var o=t((function(t,o){mr(t,i),Sl(t,{type:e,id:Pl++,frozen:void 0}),C(o)||ko(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Tl(e),u=function(t,e,r){var n=a(t),o=Ol(Et(e),!0);return!0===o?_l(n).set(e,r):o[n.id]=r,t};return Ja(i,{delete:function(t){var e=a(this);if(!vt(t))return!1;var r=Ol(t);return!0===r?_l(e).delete(t):r&&U(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!vt(t))return!1;var r=Ol(t);return!0===r?_l(e).has(t):r&&U(r,e.id)}}),Ja(i,r?{get:function(t){var e=a(this);if(vt(t)){var r=Ol(t);return!0===r?_l(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},Cl=fe.enforce,Dl=Object,Fl=Array.isArray,Wl=Dl.isExtensible,zl=Dl.isFrozen,Bl=Dl.isSealed,Ul=Dl.freeze,Gl=Dl.seal,Vl={},Hl={},ql=!S.ActiveXObject&&"ActiveXObject"in S,Zl=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Yl=Al("WeakMap",Zl,Nl),$l=Yl.prototype,Kl=N($l.set);if(te)if(ql){Rl=Nl.getConstructor(Zl,"WeakMap",!0),El.enable();var Ql=N($l.delete),Xl=N($l.has),Jl=N($l.get);Ja($l,{delete:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Ql(this,t)||e.frozen.delete(t)}return Ql(this,t)},has:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Xl(this,t)||e.frozen.has(t)}return Xl(this,t)},get:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Xl(this,t)?Jl(this,t):e.frozen.get(t)}return Jl(this,t)},set:function(t,e){if(vt(t)&&!Wl(t)){var r=Cl(this);r.frozen||(r.frozen=new Rl),Xl(this,t)?Kl(this,t,e):r.frozen.set(t,e)}else Kl(this,t,e);return this}})}else dl&&P((function(){var t=Ul([]);return Kl(new Yl,t,1),!zl(t)}))&&Ja($l,{set:function(t,e){var r;return Fl(t)&&(zl(t)?r=Vl:Bl(t)&&(r=Hl)),Kl(this,t,e),r==Vl&&Ul(t),r==Hl&&Gl(t),this}});var th=it("iterator"),eh=it("toStringTag"),rh=Oa.values,nh=function(t,e){if(t){if(t[th]!==rh)try{re(t,th,rh)}catch(e){t[th]=rh}if(t[eh]||re(t,eh,e),pi[e])for(var r in Oa)if(t[r]!==Oa[r])try{re(t,r,Oa[r])}catch(e){t[r]=Oa[r]}}};for(var oh in pi)nh(S[oh]&&S[oh].prototype,oh);nh(yi,"DOMTokenList");var ih,ah,uh,sh,ch=new WeakMap,fh=function(){function t(){i(this,t),ch.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=ch.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),ch.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=ch.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=ch.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),lh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(fh));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var hh=my.getSystemInfoSync();ih=hh.screenWidth,ah=hh.screenHeight,uh=hh.windowWidth,sh=hh.windowHeight}else{var ph=wf.innerWidth,vh=wf.innerHeight;ih=ph,ah=vh,uh=ph,sh=vh}var dh={width:ih,height:ah,availWidth:uh,availHeight:sh,availLeft:0,availTop:0},yh=dh.availWidth,gh=dh.availHeight,mh={style:[]};function bh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return mh}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return mh}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function xh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:yh+"px",height:gh+"px",margin:"0px",padding:"0px"})}function wh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=yh,t.clientHeight=gh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function Eh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=yh,t.offsetHeight=gh)}function Ah(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=yh,t.scrollHeight=gh)}function Oh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function Sh(){}var Th=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=Sh,t.blur=Sh,t.insertBefore=Sh,t.appendChild=Sh,t.removeChild=Sh,t.remove=Sh,t.innerHTML="",t.tagName=n.toUpperCase(),bh(h(t),o),xh(h(t)),Oh(h(t)),wh(h(t)),Eh(h(t)),Ah(h(t)),t}return u(r)}(lh),kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Th)),Ih={};function jh(){return Ih}var Ph=u((function t(){i(this,t);var e=jh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),bh(r),Oh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),_h={href:"",protocol:"",host:""},Mh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(Th),Lh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(Th),Rh={},Nh={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:_h,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Ph:"video"===t?new kh:new Th(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){Rh[t]||(Rh[t]=[]),Rh[t].push(e)},removeEventListener:function(t,e){var r=Rh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=Rh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new il(t)}};Nh.documentElement=new Lh,Nh.head=new Th("head"),Nh.body=new Mh,Of("match",(function(t,e,r){return[function(e){var r=F(this),n=C(e)?void 0:Rt(e,t);return n?Ot(n,e,r):new RegExp(e)[t](Xc(r))},function(t){var n=Et(this),o=Xc(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return zf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=zf(n,o));){var f=Xc(u[0]);s[c]=f,""===f&&(n.lastIndex=_f(o,Fe(n.lastIndex),a)),c++}return 0===c?null:s}]}));var Ch,Dh,Fh=it("isConcatSpreadable"),Wh=X>=51||!P((function(){var t=[];return t[Fh]=!1,t.concat()[0]!==t})),zh=function(t){if(!vt(t))return!1;var e=t[Fh];return void 0!==e?!!e:gi(t)},Bh=!Wh||!_i("concat");if(ar({target:"Array",proto:!0,arity:1,forced:Bh},{concat:function(t){var e,r,n,o,i,a=z(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(zh(i=-1===e?a:arguments[e]))for(o=We(i),el(s+o),r=0;r<o;r++,s++)r in i&&ji(u,s,i[r]);else el(s+1),ji(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Uh=my.getSystemInfoSync();Ch=Uh.system,Uh.platform,Uh.language}else{var Gh={versions:(Dh=wf.navigator.userAgent,{trident:Dh.indexOf("Trident")>-1,presto:Dh.indexOf("Presto")>-1,webKit:Dh.indexOf("AppleWebKit")>-1,gecko:Dh.indexOf("Gecko")>-1&&-1===Dh.indexOf("KHTML"),mobile:!!Dh.match(/AppleWebKit.*Mobile.*/),ios:!!Dh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Dh.indexOf("Android")>-1||Dh.indexOf("Linux")>-1,iPhone:Dh.indexOf("iPhone")>-1,iPad:Dh.indexOf("iPad")>-1,webApp:-1===Dh.indexOf("Safari"),weixin:Dh.indexOf("MicroMessenger")>-1,qq:" qq"===Dh.match(/\\sQQ/i)}),language:(wf.navigator.browserLanguage||wf.navigator.language).toLowerCase()};Gh.versions.android?"android":Gh.versions.trident?"IE":Gh.versions.presto?"Opera":Gh.versions.webKit?"webKit":Gh.versions.gecko?"Firefox":Gh.versions.mobile?"mobile":Gh.versions.ios?"ios":Gh.versions.iPhone?"iPhone":Gh.versions.iPad?"ipad":Gh.versions.webApp?"webApp":Gh.versions.weixin?"weixin":Gh.versions.qq&&"qq",Ch=wf.navigator.userAgent,Gh.language}Ch.toLowerCase().indexOf("android");is("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Vh=El.fastKey,Hh=fe.set,qh=fe.getterFor;Al("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){mr(t,i),Hh(t,{type:e,index:$i(null),first:void 0,last:void 0,size:0}),ht||(t.size=0),C(o)||ko(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=qh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=Vh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),ht?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=Vh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return Ja(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,ht?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),ht?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=Ur(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),Ja(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),ht&&vr(i,"size",{configurable:!0,get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=qh(e),i=qh(n);ba(t,e,(function(t,e){Hh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?xa("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,xa(void 0,!0))}),r?"entries":"values",!r,!0),yr(e)}});var Zh=N([].join),Yh=Te!=Object||!Oi("join",",");ar({target:"Array",proto:!0,forced:Yh},{join:function(t){return Zh(ke(this),void 0===t?",":t)}});var $h=Ai.map,Kh=_i("map");ar({target:"Array",proto:!0,forced:!Kh},{map:function(t){return $h(this,t,arguments.length>1?arguments[1]:void 0)}});var Qh=P((function(){Ui(1)}));ar({target:"Object",stat:!0,forced:Qh},{keys:function(t){return Ui(z(t))}});var Xh=new Map,Jh=new Map,tp=new Map,ep=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Xh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=tp.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Jh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Jh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Xh.get("requestHeader");r[t]=e,Xh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(fh);s(ep,"UNSEND",void 0),s(ep,"OPENED",void 0),s(ep,"HEADERS_RECEIVED",void 0),s(ep,"LOADING",void 0),s(ep,"DONE",void 0),ep.UNSEND=0,ep.OPENED=1,ep.HEADERS_RECEIVED=2,ep.LOADING=3,ep.DONE=4;var rp="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,np="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),op=(rp||np)&&!1;op||wf.XMLHttpRequest,op||wf.location;function ip(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ap=Ai.filter,up=_i("filter");function sp(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function cp(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function fp(t){return t.filter?[1]:[0]}function lp(t,e){return[e]}ar({target:"Array",proto:!0,forced:!up},{filter:function(t){return ap(this,t,arguments.length>1?arguments[1]:void 0)}});var hp=vp,pp=vp;function vp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=dp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=dp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(Tp(s));for(c.sort(Ep),o=0;o<c.length;o++)r=Ap(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return gp(h,p,r,n,o,c,0),p}function dp(t,e,r,n,o){var i,a;if(o===Wp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=Cp(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=Cp(i,t[i],t[i+1],a);return a&&Pp(a,a.next)&&(Dp(a),a=a.next),a}function yp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Pp(n,n.next)&&0!==jp(n.prev,n,n.next))n=n.next;else{if(Dp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function gp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=Sp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?bp(t,n,o,i):mp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Dp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?gp(t=xp(yp(t),e,r),e,r,n,o,i,2):2===a&&wp(t,e,r,n,o,i):gp(yp(t),e,r,n,o,i,1);break}}}function mp(t){var e=t.prev,r=t,n=t.next;if(jp(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&kp(o,u,i,s,a,c,v.x,v.y)&&jp(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function bp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(jp(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=Sp(p,v,e,r,n),m=Sp(d,y,e,r,n),b=t.prevZ,x=t.nextZ;b&&b.z>=g&&x&&x.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&kp(u,f,s,l,c,h,b.x,b.y)&&jp(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&kp(u,f,s,l,c,h,x.x,x.y)&&jp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=g;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&kp(u,f,s,l,c,h,b.x,b.y)&&jp(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&kp(u,f,s,l,c,h,x.x,x.y)&&jp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function xp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Pp(o,i)&&_p(o,n,n.next,i)&&Rp(o,i)&&Rp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Dp(n),Dp(n.next),n=t=i),n=n.next}while(n!==t);return yp(n)}function wp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ip(a,u)){var s=Np(a,u);return a=yp(a,a.next),s=yp(s,s.next),gp(a,e,r,n,o,i,0),void gp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function Ep(t,e){return t.x-e.x}function Ap(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&kp(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),Rp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&Op(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Np(r,t);return yp(n,n.next),yp(r,r.next)}function Op(t,e){return jp(t.prev,t,e.prev)<0&&jp(e.next,t,t.next)<0}function Sp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Tp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function kp(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ip(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&_p(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Rp(t,e)&&Rp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(jp(t.prev,t,e.prev)||jp(t,e.prev,e))||Pp(t,e)&&jp(t.prev,t,t.next)>0&&jp(e.prev,e,e.next)>0)}function jp(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Pp(t,e){return t.x===e.x&&t.y===e.y}function _p(t,e,r,n){var o=Lp(jp(t,e,r)),i=Lp(jp(t,e,n)),a=Lp(jp(r,n,t)),u=Lp(jp(r,n,e));return o!==i&&a!==u||(!(0!==o||!Mp(t,r,e))||(!(0!==i||!Mp(t,n,e))||(!(0!==a||!Mp(r,t,n))||!(0!==u||!Mp(r,e,n)))))}function Mp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Lp(t){return t>0?1:t<0?-1:0}function Rp(t,e){return jp(t.prev,t,t.next)<0?jp(t,e,t.next)>=0&&jp(t,t.prev,e)>=0:jp(t,e,t.prev)<0||jp(t,t.next,e)<0}function Np(t,e){var r=new Fp(t.i,t.x,t.y),n=new Fp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Cp(t,e,r,n){var o=new Fp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Dp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Fp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}vp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Wp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Wp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},vp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},hp.default=pp;var zp=S,Bp=N(1..valueOf),Up="\\t\\n\\v\\f\\r Â áââââââââââââ¯âã\\u2028\\u2029\\ufeff",Gp=N("".replace),Vp=RegExp("^["+Up+"]+"),Hp=RegExp("(^|[^"+Up+"])["+Up+"]+$"),qp=function(t){return function(e){var r=Xc(F(e));return 1&t&&(r=Gp(r,Vp,"")),2&t&&(r=Gp(r,Hp,"$1")),r}},Zp={start:qp(1),end:qp(2),trim:qp(3)},Yp=Ze.f,$p=je.f,Kp=Gt.f,Qp=Zp.trim,Xp=S.Number,Jp=(zp.Number,Xp.prototype),tv=S.TypeError,ev=N("".slice),rv=N("".charCodeAt),nv=function(t){var e=Ft(t,"number");return"bigint"==typeof e?e:ov(e)},ov=function(t){var e,r,n,o,i,a,u,s,c=Ft(t,"number");if(jt(c))throw tv("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Qp(c),43===(e=rv(c,0))||45===e){if(88===(r=rv(c,2))||120===r)return NaN}else if(48===e){switch(rv(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=ev(c,2)).length,u=0;u<a;u++)if((s=rv(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c},iv=or("Number",!Xp(" 0o1")||!Xp("0b1")||Xp("+0x1")),av=function(t){return kt(Jp,t)&&P((function(){Bp(t)}))},uv=function(t){var e=arguments.length<1?0:Xp(nv(t));return av(this)?os(Object(e),this,uv):e};uv.prototype=Jp,iv&&(Jp.constructor=uv),ar({global:!0,constructor:!0,wrap:!0,forced:iv},{Number:uv});iv&&function(t,e){for(var r,n=ht?Yp(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),o=0;n.length>o;o++)U(e,r=n[o])&&!U(t,r)&&Kp(t,r,$p(e,r))}(zp.Number,Xp);var sv=RangeError,cv=RangeError,fv=String,lv=Math.floor,hv=N((function(t){var e=Xc(F(this)),r="",n=Le(t);if(n<0||n==1/0)throw sv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),pv=N("".slice),vv=N(1..toFixed),dv=function(t,e,r){return 0===e?r:e%2==1?dv(t,e-1,r*t):dv(t*t,e/2,r)},yv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=lv(o/1e7)},gv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=lv(n/e),n=n%e*1e7},mv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=fv(t[e]);r=""===r?n:r+hv("0",7-n.length)+n}return r},bv=P((function(){return"0.000"!==vv(8e-5,3)||"1"!==vv(.9,0)||"1.25"!==vv(1.255,2)||"1000000000000000128"!==vv(0xde0b6b3a7640080,0)}))||!P((function(){vv({})}));function xv(t){return"number"==typeof t}function wv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ar({target:"Number",proto:!0,forced:bv},{toFixed:function(t){var e,r,n,o,i=Bp(this),a=Le(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw cv("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return fv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*dv(2,69,1))-69)<0?i*dv(2,-e,1):i/dv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(yv(u,0,r),n=a;n>=7;)yv(u,1e7,0),n-=7;for(yv(u,dv(10,n,1),0),n=e-1;n>=23;)gv(u,1<<23),n-=23;gv(u,1<<n),yv(u,1,1),gv(u,2),c=mv(u)}else yv(u,0,r),yv(u,1<<-e,0),c=mv(u)+hv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+hv("0",a-o)+c:pv(c,0,o-a)+"."+pv(c,o-a)):s+c}});var Ev,Av=/"/g,Ov=N("".replace);ar({target:"String",proto:!0,forced:(Ev="sub",P((function(){var t=""[Ev](\'"\');return t!==t.toLowerCase()||t.split(\'"\').length>3})))},{sub:function(){return t="sub",e="",r="",n=Xc(F(this)),o="<"+t,""!==e&&(o+=" "+e+\'="\'+Ov(Xc(r),Av,"&quot;")+\'"\'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var Sv=RegExp.prototype,Tv=Zt.PROPER,kv=RegExp.prototype.toString,Iv=P((function(){return"/a/b"!=kv.call({source:"a",flags:"b"})})),jv=Tv&&"toString"!=kv.name;(Iv||jv)&&he(RegExp.prototype,"toString",(function(){var t=Et(this);return"/"+Xc(t.source)+"/"+Xc(function(t){var e=t.flags;return void 0!==e||"flags"in Sv||U(t,"flags")||!kt(Sv,t)?e:Ot(Jc,t)}(t))}),{unsafe:!0});var Pv="undefined"!=typeof Float32Array?Float32Array:Array;function _v(){var t=new Pv(2);return Pv!=Float32Array&&(t[0]=0,t[1]=0),t}function Mv(t,e){var r=new Pv(2);return r[0]=t,r[1]=e,r}function Lv(t,e){return t[0]=e[0],t[1]=e[1],t}function Rv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Nv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Cv(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Dv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Fv,Wv=Nv,zv=(Fv=_v(),_v()),Bv=(_v(),_v()),Uv=_v(),Gv=_v();function Vv(t,e,r,n,o){return Rv(t,r,n),Cv(t,t),[o/Dv(e=Mv(-t[1],t[0]),Mv(-r[1],r[0])),e]}function Hv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function qv(t,e,r){return Wv(t,e,r),Cv(t,t),t}function Zv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Yv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",Mv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=wv([a[0],a[1]]),g=wv([i[0],i[1]]);qv(Bv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),!this.started)if(this.started=!0,h){var b=_v(),x=_v();Rv(b,this.normal,Bv),Rv(x,this.normal,Bv),l.push(x[0],x[1],0),l.push(b[0],b[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Zv(n,o)&&Rv(o,n,Cv(o,Nv(o,n,r))),qv(Uv,o,n);var w=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),E=w[0],A=w[1],O=Dv(Gv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),Hv(zv,Uv),Lv(this.normal,zv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Lv(this.normal,A),s+=2),this.lastFlip=O}else{if(Hv(this.normal,Bv),h){var T=_v(),k=_v();Wv(k,Bv,this.normal),Rv(T,Bv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=wv([n[0],n[1]]),f=wv([r[0],r[1]]);qv(Bv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=wv([o[0],o[1]]);Zv(c,h)&&Rv(h,c,Cv(h,Nv(h,c,f))),qv(Uv,h,c);var p=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),v=p[0],g=p[1];Dv(Gv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Lv(this.normal,g),i+=2,this.lastFlip=-1}else Hv(this.normal,Bv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=wv([n[0],n[1]]),h=wv([r[0],r[1]]);qv(Bv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),!this.started)if(this.started=!0,c){var v=_v(),g=_v();Rv(v,this.normal,Bv),Rv(g,this.normal,Bv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=wv([o[0],o[1]]);Zv(l,m)&&Rv(m,l,Cv(m,Nv(m,l,h))),qv(Uv,m,l);var b=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),x=b[0],w=b[1],E=Dv(Gv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)x>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),Hv(zv,Uv),Lv(this.normal,zv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,x,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Lv(this.normal,w),i+=2),this.lastFlip=E}else{if(Hv(this.normal,Bv),c){var O=_v(),S=_v();Wv(S,Bv,this.normal),Rv(O,Bv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function $v(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Yv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Kv(t){var e=function(t){if(xv(t[0]))return t;if(xv(t[0][0]))throw new Error("å½åæ°æ®ä¸æ¯ææ æ³¨");if(xv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("å½åæ°æ®ä¸æ¯ææ æ³¨")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function Qv(t){var e=t.coordinates,r=hp.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:hp(n,i,o),vertices:n,size:o}}var Xv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=$v(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Jv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Kv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Xv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=Qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},td=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Jv);function ed(t){return rd.apply(this,arguments)}function rd(){return(rd=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!td[n]){t.next=3;break}return t.abrupt("return",td[n](o));case 3:return t.abrupt("return",Promise.reject(new Error(\'Worker with type "\'.concat(n,\'" non-existent.\'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return li(ed),t.WorkerSourceMap=Jv,t.createWorker=li,t.worker=ed,t}({});\n');var PE=IE;function IE(e,t){this.x=e,this.y=t}IE.prototype={clone:function(){return new IE(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},IE.convert=function(e){return e instanceof IE?e:Array.isArray(e)?new IE(e[0],e[1]):e};var LE=OE;function OE(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(RE,this,t)}function RE(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){var n=e.readVarint()+e.pos;for(;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function NE(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}OE.types=["Unknown","Point","LineString","Polygon"],OE.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,r=1,i=0,o=0,a=0,s=[];e.pos<n;){if(i<=0){var u=e.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)o+=e.readSVarint(),a+=e.readSVarint(),1===r&&(t&&s.push(t),t=[]),t.push(new PE(o,a));else{if(7!==r)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&s.push(t),s},OE.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,c=-1/0;e.pos<t;){if(r<=0){var l=e.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)(i+=e.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=e.readSVarint())<u&&(u=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,c]},OE.prototype.toGeoJSON=function(e,t,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*e,s=this.extent*t,u=this.loadGeometry(),c=OE.types[this.type];function l(e){for(var t=0;t<e.length;t++){var n=e[t],r=180-360*(n.y+s)/o;e[t]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];l(u=h);break;case 2:for(r=0;r<u.length;r++)l(u[r]);break;case 3:for(u=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var a=NE(e[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}n&&i.push(n);return i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)l(u[r][i])}1===u.length?u=u[0]:c="Multi"+c;var f={type:"Feature",geometry:{type:c,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var DE=FE;function FE(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(BE,this,t),this.length=this._features.length}function BE(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){var t=null,n=e.readVarint()+e.pos;for(;e.pos<n;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(n))}function zE(e,t,n){if(3===e){var r=new DE(n,n.readVarint()+n.pos);r.length&&(t[r.name]=r)}}FE.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new LE(this._pbf,t,this.extent,this._keys,this._values)};var UE=function(e,t){this.layers=e.readFields(zE,{},t)},jE=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?i-1:0,f=n?-1:1,p=e[t+h];for(h+=f,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+h],h+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+h],h+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=c}return(p?-1:1)*a*Math.pow(2,o-r)},VE=function(e,t,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=l?(s=0,a=l):a+h>=1?(s=(t*u-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[n+p]=255&a,p+=d,a/=256,c-=8);e[n+p-d]|=128*v},GE=HE;
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function HE(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}HE.Varint=0,HE.Fixed64=1,HE.Bytes=2,HE.Fixed32=5;var WE="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function YE(e){return e.type===HE.Bytes?e.readVarint()+e.pos:e.pos+1}function XE(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function ZE(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function qE(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function KE(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function QE(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function $E(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function JE(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function eA(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function tA(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function nA(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function rA(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function iA(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function oA(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function aA(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}HE.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,e(i,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=iA(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=aA(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=iA(this.buf,this.pos)+4294967296*iA(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=iA(this.buf,this.pos)+4294967296*aA(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=jE(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=jE(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,o=n.buf;if(i=o[n.pos++],r=(112&i)>>4,i<128)return XE(e,r,t);if(i=o[n.pos++],r|=(127&i)<<3,i<128)return XE(e,r,t);if(i=o[n.pos++],r|=(127&i)<<10,i<128)return XE(e,r,t);if(i=o[n.pos++],r|=(127&i)<<17,i<128)return XE(e,r,t);if(i=o[n.pos++],r|=(127&i)<<24,i<128)return XE(e,r,t);if(i=o[n.pos++],r|=(1&i)<<31,i<128)return XE(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&WE?function(e,t,n){return WE.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){var r="",i=t;for(;i<n;){var o,a,s,u=e[i],c=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l>n)break;1===l?u<128&&(c=u):2===l?128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)<=127&&(c=null):3===l?(o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&((c=(15&u)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===l&&(o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,l=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),i+=l}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==HE.Bytes)return e.push(this.readVarint(t));var n=YE(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==HE.Bytes)return e.push(this.readSVarint());var t=YE(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==HE.Bytes)return e.push(this.readBoolean());var t=YE(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==HE.Bytes)return e.push(this.readFloat());var t=YE(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==HE.Bytes)return e.push(this.readDouble());var t=YE(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==HE.Bytes)return e.push(this.readFixed32());var t=YE(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==HE.Bytes)return e.push(this.readSFixed32());var t=YE(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==HE.Bytes)return e.push(this.readFixed64());var t=YE(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==HE.Bytes)return e.push(this.readSFixed64());var t=YE(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===HE.Varint)for(;this.buf[this.pos++]>127;);else if(t===HE.Bytes)this.pos=this.readVarint()+this.pos;else if(t===HE.Fixed32)this.pos+=4;else{if(t!==HE.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),oA(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),oA(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),oA(this.buf,-1&e,this.pos),oA(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),oA(this.buf,-1&e,this.pos),oA(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;if(t.buf[t.pos++]|=n|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&ZE(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),VE(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),VE(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&ZE(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,HE.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,qE,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,KE,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,JE,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,QE,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,$E,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,eA,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,tA,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,nA,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,rA,t)},writeBytesField:function(e,t){this.writeTag(e,HE.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,HE.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,HE.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,HE.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,HE.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,HE.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,HE.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,HE.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,HE.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,HE.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var sA=function(){function e(t,n,r,i){b(this,e),E(this,"vectorTile",void 0),E(this,"vectorLayerCache",{}),E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),this.x=n,this.y=r,this.z=i,this.vectorTile=new UE(new GE(t))}return S(e,[{key:"getTileData",value:function(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];var t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;for(var n=[],r=0;r<t.length;r++){var i=t.feature(r).toGeoJSON(this.x,this.y,this.z);n.push(v(v({},i),{},{properties:v({id:i.id},i.properties)}))}return this.vectorLayerCache[e]=n,n}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),uA={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},cA=function(){var e=_(g().mark((function e(t,n,r,i,o){var a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Fb(t,n),e.abrupt("return",new Promise((function(e){if(o)o({x:r.x,y:r.y,z:r.z},(function(t,n){if(t||!n)e(void 0);else{var i=new sA(n,r.x,r.y,r.z);e(i)}}));else{var t=Zd(v(v({},i),{},{url:a}),(function(t,n){if(t||!n)e(void 0);else{var i=new sA(n,r.x,r.y,r.z);e(i)}}));r.xhrCancel=function(){return t.abort()}}})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();var lA=Math.log,hA=Math.LN2;function fA(e,t){for(var n=t[0],r=n.width,i=n.height,o=t.map((function(e){return e.rasterData})),a=r*i,s=[],u=JSON.stringify(e),c=0;c<a;c++){var l=JSON.parse(u),h=pA(l,o,c);if("number"==typeof h)s.push(h);else{var f=dA(l);s.push(f)}}return s}function pA(e,t,n){if(2===e.length&&"band"===e[0]&&"number"==typeof e[1])try{return t[e[1]][n]}catch(e){return console.warn("Raster Data err!"),0}e.map((function(r,i){if(Array.isArray(r)&&r.length>0)switch(r[0]){case"band":try{e[i]=t[r[1]][n]}catch(t){console.warn("Raster Data err!"),e[i]=0}break;default:pA(r,t,n)}}))}function dA(e){var t=function(e){var t=D(e,3),n=t[0],r=t[1],i=void 0===r?-1:r,o=t[2],a=void 0===o?-1:o;return void 0===n?(console.warn("Express err!"),["+",0,0]):[n.replace(/\s+/g,""),i,a]}(e),n=t[0],r=t[1],i=t[2];return Array.isArray(r)&&(r=dA(e[1])),Array.isArray(i)&&(i=dA(e[2])),function(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n;case"^":return Math.pow(t,n);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return-1===n?Math.atan(t):Math.atan2(t,n);case"min":return Math.min(t,n);case"max":return Math.max(t,n);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}(n,r,i)}ar({target:"Math",stat:!0},{log2:function(e){return lA(e)/hA}});var vA,gA={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:function(e,t){for(var n=e[0].rasterData,r=e[1].rasterData,i=e[2].rasterData,o=[],a=D((null==t?void 0:t.countCut)||[2,98],2),s=a[0],u=a[1],c=(null==t?void 0:t.RMinMax)||mA(n,s,u),l=(null==t?void 0:t.GMinMax)||mA(r,s,u),h=(null==t?void 0:t.BMinMax)||mA(i,s,u),f=0;f<n.length;f++)o.push(Math.max(0,n[f]-c[0])),o.push(Math.max(0,r[f]-l[0])),o.push(Math.max(0,i[f]-h[0]));return{rasterData:o,rMinMax:c,gMinMax:l,bMinMax:h}}}};function mA(e,t,n){var r=e.slice().sort((function(e,t){return e-t})),i=r.length;return[r[Math.ceil(i*t/100)],r[Math.ceil(i*n/100)]]}function yA(e,t,n){return _A.apply(this,arguments)}function _A(){return(_A=_(g().mark((function e(t,n,r){var i,o,a,s,u,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return e.next=4,Promise.all(t.map((function(e){var t=e.data,r=e.bands;return n(t,void 0===r?[0]:r)})));case 4:i=e.sent,o=[],i.forEach((function(e){Array.isArray(e)?o.push.apply(o,F(e)):o.push(e)})),a=o[0],s=a.width,u=a.height,e.t0=m(r),e.next="function"===e.t0?11:"object"===e.t0?13:15;break;case 11:return c=r(o),e.abrupt("break",16);case 13:return c=Array.isArray(r)?{rasterData:fA(r,o)}:bA(r,o),e.abrupt("break",16);case 15:c={rasterData:o[0].rasterData};case 16:return e.abrupt("return",v(v({},c),{},{width:s,height:u}));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bA(e,t){var n=gA[e.type];return"function"===n.type?n.method(t,null==e?void 0:e.options):"operation"===n.type?"rgb"===e.type?function(e,t){void 0===e.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!");void 0===e.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!");void 0===e.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var n=fA(e.r||["band",0],t),r=fA(e.g||["band",0],t),i=fA(e.b||["band",0],t);return[n,r,i]}(n.expression,t):{rasterData:fA(n.expression,t)}:void 0}function xA(e,t,n,r){return SA.apply(this,arguments)}function SA(){return(SA=_(g().mark((function e(t,n,r,i){var o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yA(t,n,r);case 2:o=e.sent,i(null,{data:o});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function EA(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}!function(e){!function(t){var n="object"==typeof H?H:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),r=i(e);function i(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===n.Reflect?n.Reflect=e:r=i(n.Reflect,r),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return L(Object.create(null))}:a?function(){return L({__proto__:null})}:function(){return L({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,f=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,p=new(l||"function"!=typeof WeakMap?function(){var e=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+a()}while(u.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function o(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e):o(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function d(e,t,n){var r=p.get(e);if(b(r)){if(!n)return;r=new h,p.set(e,r)}var i=r.get(t);if(b(i)){if(!n)return;i=new h,r.set(t,i)}return i}function v(e,t,n){var r=d(t,n,!1);return!b(r)&&!!r.has(e)}function g(e,t,n){var r=d(t,n,!1);if(!b(r))return r.get(e)}function m(e,t,n,r){d(n,r,!0).set(e,t)}function y(e,t){var n=[],r=d(e,t,!1);if(b(r))return n;for(var o=function(e){var t=k(e,i);if(!T(t))throw new TypeError;var n=t.call(e);if(!S(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=M(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(e){try{P(o)}finally{throw e}}a++}}function _(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function b(e){return void 0===e}function x(e){return null===e}function S(e){return"object"==typeof e?null!==e:"function"==typeof e}function E(e,t){switch(_(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=k(e,r);if(void 0!==i){var o=i.call(e,n);if(S(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(T(n))if(!S(i=n.call(e)))return i;if(T(r=e.valueOf))if(!S(i=r.call(e)))return i}else{var r;if(T(r=e.valueOf))if(!S(i=r.call(e)))return i;var i,o=e.toString;if(T(o))if(!S(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function A(e){var t=E(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function w(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function T(e){return"function"==typeof e}function C(e){return"function"==typeof e}function k(e,t){var n=e[t];if(null!=n){if(!T(n))throw new TypeError;return n}}function M(e){var t=e.next();return!t.done&&t}function P(e){var t=e.return;t&&t.call(e)}function I(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function L(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(b(n)){if(!w(e))throw new TypeError;if(!C(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!b(r)&&!x(r)){if(!C(r))throw new TypeError;t=r}}return t}(e,t)}if(!w(e))throw new TypeError;if(!S(t))throw new TypeError;if(!S(r)&&!b(r)&&!x(r))throw new TypeError;return x(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!b(o)&&!x(o)){if(!S(o))throw new TypeError;r=o}}return r}(e,t,n=A(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!S(n))throw new TypeError;if(!b(r)&&!function(e){switch(_(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;m(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!S(n))throw new TypeError;return b(r)||(r=A(r)),m(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),function e(t,n,r){if(v(t,n,r))return!0;var i=I(n);return!x(i)&&e(t,i,r)}(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),v(e,t,n)})),e("getMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),function e(t,n,r){if(v(t,n,r))return g(t,n,r);var i=I(n);return x(i)?void 0:e(t,i,r)}(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return b(n)||(n=A(n)),g(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return b(t)||(t=A(t)),function e(t,n){var r=y(t,n),i=I(t);if(null===i)return r;var o=e(i,n);if(o.length<=0)return r;if(r.length<=0)return o;for(var a=new f,s=[],u=0,c=r;u<c.length;u++){var l=c[u];a.has(l)||(a.add(l),s.push(l))}for(var h=0,p=o;h<p.length;h++){l=p[h];a.has(l)||(a.add(l),s.push(l))}return s}(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return b(t)||(t=A(t)),y(e,t)})),e("deleteMetadata",(function(e,t,n){if(!S(t))throw new TypeError;b(n)||(n=A(n));var r=d(t,n,!1);if(b(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=p.get(t);return i.delete(n),i.size>0||p.delete(t),!0}))}(r)}()}(vA||(vA={}));var AA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]}));W(AA);AA.NON_CUSTOM_TAG_KEYS,AA.POST_CONSTRUCT,AA.DESIGN_PARAM_TYPES,AA.PARAM_TYPES,AA.TAGGED_PROP,AA.TAGGED,AA.MULTI_INJECT_TAG,AA.INJECT_TAG,AA.OPTIONAL_TAG,AA.UNMANAGED_TAG,AA.NAME_TAG,AA.NAMED_TAG;var wA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=void 0;t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}}));W(wA);wA.TargetTypeEnum,wA.BindingTypeEnum,wA.BindingScopeEnum;var TA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.id=void 0;var n=0;t.id=function(){return n++}}));W(TA);TA.id;var CA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var n=function(){function e(e,t){this.id=TA.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=wA.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===wA.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=n}));W(CA);CA.Binding;var kA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.STACK_OVERFLOW=t.CIRCULAR_DEPENDENCY_IN_FACTORY=t.POST_CONSTRUCT_ERROR=t.MULTIPLE_POST_CONSTRUCT_METHODS=t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=t.ARGUMENTS_LENGTH_MISMATCH=t.INVALID_DECORATOR_OPERATION=t.INVALID_TO_SELF_VALUE=t.INVALID_FUNCTION_BINDING=t.INVALID_MIDDLEWARE_RETURN=t.NO_MORE_SNAPSHOTS_AVAILABLE=t.INVALID_BINDING_TYPE=t.NOT_IMPLEMENTED=t.CIRCULAR_DEPENDENCY=t.UNDEFINED_INJECT_ANNOTATION=t.MISSING_INJECT_ANNOTATION=t.MISSING_INJECTABLE_ANNOTATION=t.NOT_REGISTERED=t.CANNOT_UNBIND=t.AMBIGUOUS_MATCH=t.KEY_NOT_FOUND=t.NULL_ARGUMENT=t.DUPLICATED_METADATA=t.DUPLICATED_INJECTABLE_DECORATOR=void 0,t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]};t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"}));W(kA);kA.STACK_OVERFLOW,kA.CIRCULAR_DEPENDENCY_IN_FACTORY,kA.POST_CONSTRUCT_ERROR,kA.MULTIPLE_POST_CONSTRUCT_METHODS,kA.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK,kA.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE,kA.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE,kA.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT,kA.ARGUMENTS_LENGTH_MISMATCH,kA.INVALID_DECORATOR_OPERATION,kA.INVALID_TO_SELF_VALUE,kA.INVALID_FUNCTION_BINDING,kA.INVALID_MIDDLEWARE_RETURN,kA.NO_MORE_SNAPSHOTS_AVAILABLE,kA.INVALID_BINDING_TYPE,kA.NOT_IMPLEMENTED,kA.CIRCULAR_DEPENDENCY,kA.UNDEFINED_INJECT_ANNOTATION,kA.MISSING_INJECT_ANNOTATION,kA.MISSING_INJECTABLE_ANNOTATION,kA.NOT_REGISTERED,kA.CANNOT_UNBIND,kA.AMBIGUOUS_MATCH,kA.KEY_NOT_FOUND,kA.NULL_ARGUMENT,kA.DUPLICATED_METADATA,kA.DUPLICATED_INJECTABLE_DECORATOR;var MA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataReader=void 0;var n=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(AA.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(AA.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(AA.TAGGED_PROP,e)||[]},e}();t.MetadataReader=n}));W(MA);MA.MetadataReader;var PA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingCount=void 0;t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}}));W(PA);PA.BindingCount;var IA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=void 0,t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===kA.STACK_OVERFLOW}}));W(IA);IA.isStackOverflowExeption;var LA=Y((function(e,t){function n(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function r(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}Object.defineProperty(t,"__esModule",{value:!0}),t.circularDependencyToException=t.listMetadataForTarget=t.listRegisteredBindingsForServiceIdentifier=t.getServiceIdentifierAsString=t.getFunctionName=void 0,t.getServiceIdentifierAsString=n,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var i="",o=n(e,t);return 0!==o.length&&(i="\nRegistered bindings:",o.forEach((function(e){var t="Object";null!==e.implementationType&&(t=r(e.implementationType)),i=i+"\n "+t,e.constraint.metaData&&(i=i+" - "+e.constraint.metaData)}))),i},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(function e(t,n){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===n||e(t.parentRequest,n))}(t,t.serviceIdentifier)){var r=function(e){return function e(t,r){void 0===r&&(r=[]);var i=n(t.serviceIdentifier);return r.push(i),null!==t.parentRequest?e(t.parentRequest,r):r}(e).reverse().join(" --\x3e ")}(t);throw new Error(kA.CIRCULAR_DEPENDENCY+" "+r)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=r}));W(LA);LA.circularDependencyToException,LA.listMetadataForTarget,LA.listRegisteredBindingsForServiceIdentifier,LA.getServiceIdentifierAsString,LA.getFunctionName;var OA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var n=function(){function e(e){this.id=TA.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=n}));W(OA);OA.Context;var RA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===AA.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=n}));W(RA);RA.Metadata;var NA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Plan=void 0;var n=function(e,t){this.parentContext=e,this.rootRequest=t};t.Plan=n}));W(NA);NA.Plan;var DA=Y((function(e,t){function n(e,t,n,r,i){var o={},a="number"==typeof i,s=void 0!==i&&a?i.toString():n;if(a&&void 0!==n)throw new Error(kA.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(o=Reflect.getMetadata(e,t));var u=o[s];if(Array.isArray(u))for(var c=0,l=u;c<l.length;c++){var h=l[c];if(h.key===r.key)throw new Error(kA.DUPLICATED_METADATA+" "+h.key.toString())}else u=[];u.push(r),o[s]=u,Reflect.defineMetadata(e,o,t)}function r(e,t){Reflect.decorate(e,t)}function i(e,t){return function(n,r){t(n,r,e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.tagProperty=t.tagParameter=t.decorate=void 0,t.tagParameter=function(e,t,r,i){n(AA.TAGGED,e,t,i,r)},t.tagProperty=function(e,t,r){n(AA.TAGGED_PROP,e.constructor,t,r)},t.decorate=function(e,t,n){"number"==typeof n?r([i(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):r([e],t)}}));W(DA);DA.tagProperty,DA.tagParameter,DA.decorate;var FA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.inject=t.LazyServiceIdentifer=void 0;var n=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=n,t.inject=function(e){return function(t,n,r){if(void 0===e)throw new Error(kA.UNDEFINED_INJECT_ANNOTATION(t.name));var i=new RA.Metadata(AA.INJECT_TAG,e);"number"==typeof r?DA.tagParameter(t,n,r,i):DA.tagProperty(t,n,i)}}}));W(FA);FA.inject,FA.LazyServiceIdentifer;var BA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.QueryableString=void 0;var n=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=n}));W(BA);BA.QueryableString;var zA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Target=void 0;var n=function(){function e(e,t,n,r){this.id=TA.id(),this.type=e,this.serviceIdentifier=n,this.name=new BA.QueryableString(t||""),this.metadata=new Array;var i=null;"string"==typeof r?i=new RA.Metadata(AA.NAMED_TAG,r):r instanceof RA.Metadata&&(i=r),null!==i&&this.metadata.push(i)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(AA.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(AA.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(AA.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return AA.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(AA.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===AA.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return AA.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(AA.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=n}));W(zA);zA.Target;var UA=Y((function(e,t){var n=H&&H.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};function r(e,t,r,a){var s=e.getConstructorMetadata(r),u=s.compilerGeneratedMetadata;if(void 0===u){var c=kA.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(c)}var l=s.userGeneratedMetadata,h=Object.keys(l),f=0===r.length&&h.length>0,p=h.length>r.length,d=function(e,t,n,r,o){for(var a=[],s=0;s<o;s++){var u=i(s,e,t,n,r);null!==u&&a.push(u)}return a}(a,t,u,l,f||p?h.length:r.length),v=function e(t,r){for(var i=t.getPropertiesMetadata(r),a=[],s=Object.keys(i),u=0,c=s;u<c.length;u++){var l=c[u],h=i[l],f=o(i[l]),p=f.targetName||l,d=f.inject||f.multiInject,v=new zA.Target(wA.TargetTypeEnum.ClassProperty,p,d);v.metadata=h,a.push(v)}var g=Object.getPrototypeOf(r.prototype).constructor;if(g!==Object){var m=e(t,g);a=n(n([],a),m)}return a}(e,r);return n(n([],d),v)}function i(e,t,n,r,i){var a=i[e.toString()]||[],s=o(a),u=!0!==s.unmanaged,c=r[e],l=s.inject||s.multiInject;if((c=l||c)instanceof FA.LazyServiceIdentifer&&(c=c.unwrap()),u){if(!t&&(c===Object||c===Function||void 0===c)){var h=kA.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(h)}var f=new zA.Target(wA.TargetTypeEnum.ConstructorArgument,s.targetName,c);return f.metadata=a,f}return null}function o(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[AA.INJECT_TAG],multiInject:t[AA.MULTI_INJECT_TAG],targetName:t[AA.NAME_TAG],unmanaged:t[AA.UNMANAGED_TAG]}}Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0,Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return LA.getFunctionName}}),t.getDependencies=function(e,t){return r(e,LA.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var i=Object.getPrototypeOf(n.prototype).constructor;if(i!==Object){var o=r(t,LA.getFunctionName(i),i,!0),a=o.map((function(e){return e.metadata.filter((function(e){return e.key===AA.UNMANAGED_TAG}))})),s=[].concat.apply([],a).length,u=o.length-s;return u>0?u:e(t,i)}return 0}}));W(UA);UA.getFunctionName,UA.getBaseClassDependencyCount,UA.getDependencies;var jA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var n=function(){function e(e,t,n,r,i){this.id=TA.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=n}));W(jA);jA.Request;var VA=Y((function(e,t){function n(e){return e._bindingDictionary}function r(e,t,n,r,i,o){var a=e?AA.MULTI_INJECT_TAG:AA.INJECT_TAG,s=new RA.Metadata(a,n),u=new zA.Target(t,r,n,s);if(void 0!==i){var c=new RA.Metadata(i,o);u.metadata.push(c)}return u}function i(e,t,n,r,i){var a=o(n.container,i.serviceIdentifier),s=[];return a.length===PA.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),a=o(n.container,i.serviceIdentifier)),s=t?a:a.filter((function(e){var t=new jA.Request(e.serviceIdentifier,n,r,e,i);return e.constraint(t)})),function(e,t,n,r){switch(t.length){case PA.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var i=LA.getServiceIdentifierAsString(e),a=kA.NOT_REGISTERED;throw a+=LA.listMetadataForTarget(i,n),a+=LA.listRegisteredBindingsForServiceIdentifier(r,i,o),new Error(a);case PA.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case PA.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;i=LA.getServiceIdentifierAsString(e),a=kA.AMBIGUOUS_MATCH+" "+i;throw a+=LA.listRegisteredBindingsForServiceIdentifier(r,i,o),new Error(a)}}(i.serviceIdentifier,s,i,n.container),s}function o(e,t){var r=[],i=n(e);return i.hasKey(t)?r=i.get(t):null!==e.parent&&(r=o(e.parent,t)),r}Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=t.createMockRequest=t.plan=void 0,t.getBindingDictionary=n,t.plan=function(e,t,n,o,a,s,u,c){void 0===c&&(c=!1);var l=new OA.Context(t),h=r(n,o,a,"",s,u);try{return function e(t,n,r,o,a,s){var u,c;if(null===a){u=i(t,n,o,null,s),c=new jA.Request(r,o,null,u,s);var l=new NA.Plan(o,c);o.addPlan(l)}else u=i(t,n,o,a,s),c=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(n){var r=null;if(s.isArray())r=c.addChildRequest(n.serviceIdentifier,n,s);else{if(n.cache)return;r=c}if(n.type===wA.BindingTypeEnum.Instance&&null!==n.implementationType){var i=UA.getDependencies(t,n.implementationType);if(!o.container.options.skipBaseClassChecks){var a=UA.getBaseClassDependencyCount(t,n.implementationType);if(i.length<a){var u=kA.ARGUMENTS_LENGTH_MISMATCH(UA.getFunctionName(n.implementationType));throw new Error(u)}}i.forEach((function(n){e(t,!1,n.serviceIdentifier,o,r,n)}))}}))}(e,c,a,l,null,h),l}catch(e){throw IA.isStackOverflowExeption(e)&&l.plan&&LA.circularDependencyToException(l.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new zA.Target(wA.TargetTypeEnum.Variable,"",t,new RA.Metadata(n,r)),o=new OA.Context(e);return new jA.Request(t,o,null,[],i)}}));W(VA);VA.getBindingDictionary,VA.createMockRequest,VA.plan;var GA=Y((function(e,t){var n=H&&H.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=void 0,t.resolveInstance=function(e,t,r){var i,o,a=null;if(t.length>0){var s=t.filter((function(e){return null!==e.target&&e.target.type===wA.TargetTypeEnum.ConstructorArgument})).map(r);o=s,a=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===wA.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var o=i[n];e[r]=o})),e}(a=new((i=e).bind.apply(i,n([void 0],o))),t,r)}else a=new e;return function(e,t){if(Reflect.hasMetadata(AA.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(AA.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(kA.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,a),a}}));W(GA);GA.resolveInstance;var HA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=void 0;var n=function(e,t,n){try{return n()}catch(n){throw IA.isStackOverflowExeption(n)?new Error(kA.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},r=function(e){return function(t){t.parentContext.setCurrentRequest(t);var i=t.bindings,o=t.childRequests,a=t.target&&t.target.isArray(),s=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(a&&s)return o.map((function(t){return r(e)(t)}));var u=null;if(!t.target.isOptional()||0!==i.length){var c=i[0],l=c.scope===wA.BindingScopeEnum.Singleton,h=c.scope===wA.BindingScopeEnum.Request;if(l&&c.activated)return c.cache;if(h&&null!==e&&e.has(c.id))return e.get(c.id);if(c.type===wA.BindingTypeEnum.ConstantValue)u=c.cache,c.activated=!0;else if(c.type===wA.BindingTypeEnum.Function)u=c.cache,c.activated=!0;else if(c.type===wA.BindingTypeEnum.Constructor)u=c.implementationType;else if(c.type===wA.BindingTypeEnum.DynamicValue&&null!==c.dynamicValue)u=n("toDynamicValue",c.serviceIdentifier,(function(){return c.dynamicValue(t.parentContext)}));else if(c.type===wA.BindingTypeEnum.Factory&&null!==c.factory)u=n("toFactory",c.serviceIdentifier,(function(){return c.factory(t.parentContext)}));else if(c.type===wA.BindingTypeEnum.Provider&&null!==c.provider)u=n("toProvider",c.serviceIdentifier,(function(){return c.provider(t.parentContext)}));else{if(c.type!==wA.BindingTypeEnum.Instance||null===c.implementationType){var f=LA.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(kA.INVALID_BINDING_TYPE+" "+f)}u=GA.resolveInstance(c.implementationType,o,r(e))}return"function"==typeof c.onActivation&&(u=c.onActivation(t.parentContext,u)),l&&(c.cache=u,c.activated=!0),h&&null!==e&&!e.has(c.id)&&e.set(c.id,u),u}}};t.resolve=function(e){return r(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}}));W(HA);HA.resolve;var WA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=void 0;var n=function(e,t){var r=e.parentRequest;return null!==r&&(!!t(r)||n(r,t))};t.traverseAncerstors=n;var r=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new RA.Metadata(e,t),n}};t.taggedConstraint=r;var i=r(AA.NAMED_TAG);t.namedConstraint=i;t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}}));W(WA);WA.typeConstraint,WA.namedConstraint,WA.taggedConstraint,WA.traverseAncerstors;var YA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new XA.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=WA.namedConstraint(e),new XA.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new XA.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=WA.taggedConstraint(e)(t),new XA.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return WA.typeConstraint(e)(t.parentRequest)},new XA.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return WA.namedConstraint(e)(t.parentRequest)},new XA.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return WA.taggedConstraint(e)(t)(n.parentRequest)},new XA.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return WA.traverseAncerstors(t,WA.typeConstraint(e))},new XA.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!WA.traverseAncerstors(t,WA.typeConstraint(e))},new XA.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return WA.traverseAncerstors(t,WA.namedConstraint(e))},new XA.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!WA.traverseAncerstors(t,WA.namedConstraint(e))},new XA.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return WA.traverseAncerstors(n,WA.taggedConstraint(e)(t))},new XA.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!WA.traverseAncerstors(n,WA.taggedConstraint(e)(t))},new XA.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return WA.traverseAncerstors(t,e)},new XA.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!WA.traverseAncerstors(t,e)},new XA.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=n}));W(YA);YA.BindingWhenSyntax;var XA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingOnSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new YA.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=n}));W(XA);XA.BindingOnSyntax;var ZA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenOnSyntax=void 0;var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new YA.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new XA.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=n}));W(ZA);ZA.BindingWhenOnSyntax;var qA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=wA.BindingScopeEnum.Request,new ZA.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=wA.BindingScopeEnum.Singleton,new ZA.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=wA.BindingScopeEnum.Transient,new ZA.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=n}));W(qA);qA.BindingInSyntax;var KA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInWhenOnSyntax=void 0;var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new YA.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new XA.BindingOnSyntax(this._binding),this._bindingInSyntax=new qA.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=n}));W(KA);KA.BindingInWhenOnSyntax;var QA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingToSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=wA.BindingTypeEnum.Instance,this._binding.implementationType=e,new KA.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+kA.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=wA.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=wA.BindingScopeEnum.Singleton,new ZA.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=wA.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new KA.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=wA.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=wA.BindingScopeEnum.Singleton,new ZA.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=wA.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=wA.BindingScopeEnum.Singleton,new ZA.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(kA.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=wA.BindingTypeEnum.Function,this._binding.scope=wA.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=wA.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=wA.BindingScopeEnum.Singleton,new ZA.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=wA.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=wA.BindingScopeEnum.Singleton,new ZA.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=n}));W(QA);QA.BindingToSyntax;var $A=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSnapshot=void 0;var n=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=n}));W($A);$A.ContainerSnapshot;var JA=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Lookup=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(kA.NULL_ARGUMENT);if(null==t)throw new Error(kA.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(kA.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(kA.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(kA.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(kA.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(kA.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=n}));W(JA);JA.Lookup;var ew=Y((function(e,t){var n=H&&H.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},r=H&&H.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=H&&H.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var o=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!=typeof t)throw new Error(""+kA.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=wA.BindingScopeEnum.Transient;else if(t.defaultScope!==wA.BindingScopeEnum.Singleton&&t.defaultScope!==wA.BindingScopeEnum.Transient&&t.defaultScope!==wA.BindingScopeEnum.Request)throw new Error(""+kA.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+kA.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+kA.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=TA.id(),this._bindingDictionary=new JA.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new MA.MetadataReader}return e.merge=function(t,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var a=new e,s=i([t,n],r).map((function(e){return VA.getBindingDictionary(e)})),u=VA.getBindingDictionary(a);function c(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return s.forEach((function(e){c(e,u)})),a},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(this,void 0,void 0,(function(){var t,n,i,o,a;return r(this,(function(r){switch(r.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,i=e,r.label=1;case 1:return n<i.length?(o=i[n],a=t(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=r(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||wA.BindingScopeEnum.Transient,n=new CA.Binding(e,t);return this._bindingDictionary.add(e,n),new QA.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(kA.CANNOT_UNBIND+" "+LA.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new JA.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,AA.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=VA.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push($A.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(kA.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,wA.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,wA.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,AA.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,wA.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,wA.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,AA.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var a=null,s={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(s)))throw new Error(kA.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(s);return a},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=VA.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),HA.resolve(n)}},e}();t.Container=o}));W(ew);ew.Container;var tw=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncContainerModule=t.ContainerModule=void 0;var n=function(e){this.id=TA.id(),this.registry=e};t.ContainerModule=n;var r=function(e){this.id=TA.id(),this.registry=e};t.AsyncContainerModule=r}));W(tw);tw.AsyncContainerModule,tw.ContainerModule;var nw=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=void 0,t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(AA.PARAM_TYPES,e))throw new Error(kA.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(AA.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(AA.PARAM_TYPES,t,e),e}}}));W(nw);nw.injectable;var rw=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=void 0,t.tagged=function(e,t){return function(n,r,i){var o=new RA.Metadata(e,t);"number"==typeof i?DA.tagParameter(n,r,i,o):DA.tagProperty(n,r,o)}}}));W(rw);rw.tagged;var iw=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.named=void 0,t.named=function(e){return function(t,n,r){var i=new RA.Metadata(AA.NAMED_TAG,e);"number"==typeof r?DA.tagParameter(t,n,r,i):DA.tagProperty(t,n,i)}}}));W(iw);iw.named;var ow=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.optional=void 0,t.optional=function(){return function(e,t,n){var r=new RA.Metadata(AA.OPTIONAL_TAG,!0);"number"==typeof n?DA.tagParameter(e,t,n,r):DA.tagProperty(e,t,r)}}}));W(ow);ow.optional;var aw=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=void 0,t.unmanaged=function(){return function(e,t,n){var r=new RA.Metadata(AA.UNMANAGED_TAG,!0);DA.tagParameter(e,t,n,r)}}}));W(aw);aw.unmanaged;var sw=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=void 0,t.multiInject=function(e){return function(t,n,r){var i=new RA.Metadata(AA.MULTI_INJECT_TAG,e);"number"==typeof r?DA.tagParameter(t,n,r,i):DA.tagProperty(t,n,i)}}}));W(sw);sw.multiInject;var uw=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=void 0,t.targetName=function(e){return function(t,n,r){var i=new RA.Metadata(AA.NAME_TAG,e);DA.tagParameter(t,n,r,i)}}}));W(uw);uw.targetName;var cw=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=void 0,t.postConstruct=function(){return function(e,t,n){var r=new RA.Metadata(AA.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(AA.POST_CONSTRUCT,e.constructor))throw new Error(kA.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(AA.POST_CONSTRUCT,r,e.constructor)}}}));W(cw);cw.postConstruct;var lw=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=void 0;t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}}));W(lw);lw.multiBindToService;var hw=Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=t.getServiceIdentifierAsString=t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=t.decorate=t.id=t.MetadataReader=t.postConstruct=t.targetName=t.multiInject=t.unmanaged=t.optional=t.LazyServiceIdentifer=t.inject=t.named=t.tagged=t.injectable=t.ContainerModule=t.AsyncContainerModule=t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=t.Container=t.METADATA_KEY=void 0,t.METADATA_KEY=AA,Object.defineProperty(t,"Container",{enumerable:!0,get:function(){return ew.Container}}),Object.defineProperty(t,"BindingScopeEnum",{enumerable:!0,get:function(){return wA.BindingScopeEnum}}),Object.defineProperty(t,"BindingTypeEnum",{enumerable:!0,get:function(){return wA.BindingTypeEnum}}),Object.defineProperty(t,"TargetTypeEnum",{enumerable:!0,get:function(){return wA.TargetTypeEnum}}),Object.defineProperty(t,"AsyncContainerModule",{enumerable:!0,get:function(){return tw.AsyncContainerModule}}),Object.defineProperty(t,"ContainerModule",{enumerable:!0,get:function(){return tw.ContainerModule}}),Object.defineProperty(t,"injectable",{enumerable:!0,get:function(){return nw.injectable}}),Object.defineProperty(t,"tagged",{enumerable:!0,get:function(){return rw.tagged}}),Object.defineProperty(t,"named",{enumerable:!0,get:function(){return iw.named}}),Object.defineProperty(t,"inject",{enumerable:!0,get:function(){return FA.inject}}),Object.defineProperty(t,"LazyServiceIdentifer",{enumerable:!0,get:function(){return FA.LazyServiceIdentifer}}),Object.defineProperty(t,"optional",{enumerable:!0,get:function(){return ow.optional}}),Object.defineProperty(t,"unmanaged",{enumerable:!0,get:function(){return aw.unmanaged}}),Object.defineProperty(t,"multiInject",{enumerable:!0,get:function(){return sw.multiInject}}),Object.defineProperty(t,"targetName",{enumerable:!0,get:function(){return uw.targetName}}),Object.defineProperty(t,"postConstruct",{enumerable:!0,get:function(){return cw.postConstruct}}),Object.defineProperty(t,"MetadataReader",{enumerable:!0,get:function(){return MA.MetadataReader}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return TA.id}}),Object.defineProperty(t,"decorate",{enumerable:!0,get:function(){return DA.decorate}}),Object.defineProperty(t,"traverseAncerstors",{enumerable:!0,get:function(){return WA.traverseAncerstors}}),Object.defineProperty(t,"taggedConstraint",{enumerable:!0,get:function(){return WA.taggedConstraint}}),Object.defineProperty(t,"namedConstraint",{enumerable:!0,get:function(){return WA.namedConstraint}}),Object.defineProperty(t,"typeConstraint",{enumerable:!0,get:function(){return WA.typeConstraint}}),Object.defineProperty(t,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return LA.getServiceIdentifierAsString}}),Object.defineProperty(t,"multiBindToService",{enumerable:!0,get:function(){return lw.multiBindToService}})}));W(hw);hw.multiBindToService,hw.getServiceIdentifierAsString,hw.typeConstraint,hw.namedConstraint,hw.taggedConstraint,hw.traverseAncerstors;var fw=hw.decorate,pw=(hw.id,hw.MetadataReader,hw.postConstruct),dw=(hw.targetName,hw.multiInject,hw.unmanaged,hw.optional,hw.LazyServiceIdentifer,hw.inject),vw=(hw.named,hw.tagged,hw.injectable),gw=(hw.ContainerModule,hw.AsyncContainerModule,hw.TargetTypeEnum,hw.BindingTypeEnum,hw.BindingScopeEnum,hw.Container),mw=(hw.METADATA_KEY,Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(e,t,r,i){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,t)&&Reflect.defineMetadata(n,r(),this,t),Reflect.hasMetadata(n,this,t)?Reflect.getMetadata(n,this,t):r()},set:function(e){Reflect.defineMetadata(n,e,this,t)}})}t.makePropertyInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.get(n)}),t)}}},t.makePropertyInjectNamedDecorator=function(e,t){return function(n,i){return function(o,a){r(o,a,(function(){return e.getNamed(n,i)}),t)}}},t.makePropertyInjectTaggedDecorator=function(e,t){return function(n,i,o){return function(a,s){r(a,s,(function(){return e.getTagged(n,i,o)}),t)}}},t.makePropertyMultiInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.getAll(n)}),t)}}}})));W(mw);mw.makePropertyInjectDecorator,mw.makePropertyInjectNamedDecorator,mw.makePropertyInjectTaggedDecorator,mw.makePropertyMultiInjectDecorator;var yw=W(Y((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return void 0===t&&(t=!0),{lazyInject:mw.makePropertyInjectDecorator(e,t),lazyInjectNamed:mw.makePropertyInjectNamedDecorator(e,t),lazyInjectTagged:mw.makePropertyInjectTaggedDecorator(e,t),lazyMultiInject:mw.makePropertyMultiInjectDecorator(e,t)}}}))),_w={f:Pe},bw=dt.f,xw=wn.forEach,Sw=Mt("hidden"),Ew=Nt.set,Aw=Nt.getterFor("Symbol"),ww=Object.prototype,Tw=K.Symbol,Cw=Tw&&Tw.prototype,kw=K.TypeError,Mw=K.QObject,Pw=Dn.f,Iw=dt.f,Lw=Ef.f,Ow=On.f,Rw=ae([].push),Nw=ee("symbols"),Dw=ee("op-symbols"),Fw=ee("wks"),Bw=!Mw||!Mw.prototype||!Mw.prototype.findChild,zw=Fe&&te((function(){return 7!=Xa(Iw({},"a",{get:function(){return Iw(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Pw(ww,t);r&&delete ww[t],Iw(e,t,n),r&&e!==ww&&Iw(ww,t,r)}:Iw,Uw=function(e,t){var n=Nw[e]=Xa(Cw);return Ew(n,{type:"Symbol",tag:e,description:t}),Fe||(n.description=t),n},jw=function(e,t,n){e===ww&&jw(Dw,t,n),Xe(e);var r=lt(t);return Xe(n),pe(Nw,r)?(n.enumerable?(pe(e,Sw)&&e[Sw][r]&&(e[Sw][r]=!1),n=Xa(n,{enumerable:Tt(0,!1)})):(pe(e,Sw)||Iw(e,Sw,Tt(1,{})),e[Sw][r]=!0),zw(e,r,n)):Iw(e,r,n)},Vw=function(e,t){Xe(e);var n=Rn(t),r=Ba(n).concat(Yw(n));return xw(r,(function(t){Fe&&!qe(Gw,n,t)||jw(e,t,n[t])})),e},Gw=function(e){var t=lt(e),n=qe(Ow,this,t);return!(this===ww&&pe(Nw,t)&&!pe(Dw,t))&&(!(n||!pe(this,t)||!pe(Nw,t)||pe(this,Sw)&&this[Sw][t])||n)},Hw=function(e,t){var n=Rn(e),r=lt(t);if(n!==ww||!pe(Nw,r)||pe(Dw,r)){var i=Pw(n,r);return!i||!pe(Nw,r)||pe(n,Sw)&&n[Sw][r]||(i.enumerable=!0),i}},Ww=function(e){var t=Lw(Rn(e)),n=[];return xw(t,(function(e){pe(Nw,e)||pe(Pt,e)||Rw(n,e)})),n},Yw=function(e){var t=e===ww,n=Lw(t?Dw:Rn(e)),r=[];return xw(n,(function(e){!pe(Nw,e)||t&&!pe(ww,e)||Rw(r,Nw[e])})),r};we||(Cw=(Tw=function(){if($e(Cw,this))throw kw("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?wr(arguments[0]):void 0,t=me(e),n=function(e){this===ww&&qe(n,Dw,e),pe(this,Sw)&&pe(this[Sw],t)&&(this[Sw][t]=!1),zw(this,t,Tt(1,e))};return Fe&&Bw&&zw(ww,t,{configurable:!0,set:n}),Uw(t,e)}).prototype,Ft(Cw,"toString",(function(){return Aw(this).tag})),Ft(Tw,"withoutSetter",(function(e){return Uw(me(e),e)})),On.f=Gw,dt.f=jw,ja.f=Vw,Dn.f=Hw,Xn.f=Ef.f=Ww,Zn.f=Yw,_w.f=function(e){return Uw(Pe(e),e)},Fe&&(Hr(Cw,"description",{configurable:!0,get:function(){return Aw(this).description}}),Ft(ww,"propertyIsEnumerable",Gw,{unsafe:!0}))),ar({global:!0,constructor:!0,wrap:!0,forced:!we,sham:!we},{Symbol:Tw}),xw(Ba(Fw),(function(e){!function(e){var t=vy.Symbol||(vy.Symbol={});pe(t,e)||bw(t,e,{value:_w.f(e)})}(e)})),ar({target:"Symbol",stat:!0,forced:!we},{useSetter:function(){Bw=!0},useSimple:function(){Bw=!1}}),ar({target:"Object",stat:!0,forced:!we,sham:!Fe},{create:function(e,t){return void 0===t?Xa(e):Vw(Xa(e),t)},defineProperty:jw,defineProperties:Vw,getOwnPropertyDescriptor:Hw}),ar({target:"Object",stat:!0,forced:!we},{getOwnPropertyNames:Ww}),function(){var e=Qe("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=Pe("toPrimitive");t&&!t[r]&&Ft(t,r,(function(e){return qe(n,this)}),{arity:1})}(),Gr(Tw,"Symbol"),Pt[Sw]=!0;var Xw=we&&!!Symbol.for&&!!Symbol.keyFor,Zw=ee("string-to-symbol-registry"),qw=ee("symbol-to-string-registry");ar({target:"Symbol",stat:!0,forced:!Xw},{for:function(e){var t=wr(e);if(pe(Zw,t))return Zw[t];var n=Qe("Symbol")(t);return Zw[t]=n,qw[n]=t,n}});var Kw=ee("symbol-to-string-registry");ar({target:"Symbol",stat:!0,forced:!Xw},{keyFor:function(e){if(!et(e))throw TypeError(nt(e)+" is not a symbol");if(pe(Kw,e))return Kw[e]}});var Qw=ae([].push),$w=function(e){if(De(e))return e;if(ln(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?Qw(n,i):"number"!=typeof i&&"Number"!=Ut(i)&&"String"!=Ut(i)||Qw(n,wr(i))}var o=n.length,a=!0;return function(e,t){if(a)return a=!1,t;if(ln(this))return t;for(var r=0;r<o;r++)if(n[r]===e)return t}}},Jw=String,eT=Qe("JSON","stringify"),tT=ae(/./.exec),nT=ae("".charAt),rT=ae("".charCodeAt),iT=ae("".replace),oT=ae(1..toString),aT=/[\uD800-\uDFFF]/g,sT=/^[\uD800-\uDBFF]$/,uT=/^[\uDC00-\uDFFF]$/,cT=!we||te((function(){var e=Qe("Symbol")();return"[null]"!=eT([e])||"{}"!=eT({a:e})||"{}"!=eT(Object(e))})),lT=te((function(){return'"\\udf06\\ud834"'!==eT("\udf06\ud834")||'"\\udead"'!==eT("\udead")})),hT=function(e,t){var n=ii(arguments),r=$w(t);if(De(r)||void 0!==e&&!et(e))return n[1]=function(e,t){if(De(r)&&(t=qe(r,this,Jw(e),t)),!et(t))return t},ni(eT,null,n)},fT=function(e,t,n){var r=nT(n,t-1),i=nT(n,t+1);return tT(sT,e)&&!tT(uT,i)||tT(uT,e)&&!tT(sT,r)?"\\u"+oT(rT(e,0),16):e};eT&&ar({target:"JSON",stat:!0,arity:3,forced:cT||lT},{stringify:function(e,t,n){var r=ii(arguments),i=ni(cT?hT:eT,null,r);return lT&&"string"==typeof i?iT(i,aT,fT):i}});var pT=!we||te((function(){Zn.f(1)}));ar({target:"Object",stat:!0,forced:pT},{getOwnPropertySymbols:function(e){var t=Zn.f;return t?t(he(e)):[]}});var dT=K.Symbol,vT=dT&&dT.prototype;if(Fe&&De(dT)&&(!("description"in vT)||void 0!==dT().description)){var gT={},mT=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:wr(arguments[0]),t=$e(vT,this)?new dT(e):void 0===e?dT():dT(e);return""===e&&(gT[t]=!0),t};Qn(mT,dT),mT.prototype=vT,vT.constructor=mT;var yT="Symbol(test)"==String(dT("test")),_T=ae(vT.valueOf),bT=ae(vT.toString),xT=/^Symbol\((.*)\)[^)]+$/,ST=ae("".replace),ET=ae("".slice);Hr(vT,"description",{configurable:!0,get:function(){var e=_T(this);if(pe(gT,e))return"";var t=bT(e),n=yT?ET(t,7,-1):ST(t,xT,"$1");return""===n?void 0:n}}),ar({global:!0,constructor:!0,forced:!0},{Symbol:mT})}var AT={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")};kf("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),od);var wT=kT,TT=kT,CT=1e20;function kT(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer,u="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;u?this.canvas=my.createOffscreenCanvas(a,a,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=u?Math.round(a/2*1):Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function MT(e,t,n,r,i,o){for(var a=0;a<t;a++)PT(e,a,t,n,r,i,o);for(var s=0;s<n;s++)PT(e,s*t,1,t,r,i,o)}function PT(e,t,n,r,i,o,a){var s,u,c,l;for(o[0]=0,a[0]=-CT,a[1]=CT,s=0;s<r;s++)i[s]=e[t+s*n];for(s=1,u=0,c=0;s<r;s++){do{l=o[u],c=(i[s]-i[l]+s*s-l*l)/(s-l)/2}while(c<=a[u]&&--u>-1);o[++u]=s,a[u]=c,a[u+1]=CT}for(s=0,u=0;s<r;s++){for(;a[u+1]<s;)u++;l=o[u],e[t+s*n]=i[l]+(s-l)*(s-l)}}kT.prototype._draw=function(e,t){var n,r,i,o,a,s,u,c,l,h=this.ctx.measureText(e),f=h.width,p=2*this.buffer;t&&this.useMetrics?(a=Math.floor(h.actualBoundingBoxAscent),c=this.buffer+Math.ceil(h.actualBoundingBoxAscent),s=this.buffer,u=this.buffer,n=(r=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+p,i=(o=Math.min(this.size-s,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+p,this.ctx.textBaseline="alphabetic"):(n=r=this.size,i=o=this.size,a=19*this.fontSize/24,s=u=0,c=this.middle,this.ctx.textBaseline="middle"),r&&o&&(this.ctx.clearRect(u,s,r,o),this.ctx.fillText(e,this.buffer,c),l=this.ctx.getImageData(u,s,r,o));var d=new Uint8ClampedArray(n*i);return function(e,t,n,r,i,o,a){o.fill(CT,0,t*n),a.fill(0,0,t*n);for(var s=(t-r)/2,u=0;u<i;u++)for(var c=0;c<r;c++){var l=(u+s)*t+c+s,h=e.data[4*(u*r+c)+3]/255;if(1===h)o[l]=0,a[l]=CT;else if(0===h)o[l]=CT,a[l]=0;else{var f=Math.max(0,.5-h),p=Math.max(0,h-.5);o[l]=f*f,a[l]=p*p}}}(l,n,i,r,o,this.gridOuter,this.gridInner),MT(this.gridOuter,n,i,this.f,this.v,this.z),MT(this.gridInner,n,i,this.f,this.v,this.z),function(e,t,n,r,i,o,a){for(var s=0;s<t*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/o+a))}}(d,n,i,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:d,metrics:{width:r,height:o,sdfWidth:n,sdfHeight:i,top:a,left:0,advance:f}}},kT.prototype.draw=function(e){return this._draw(e,!1).data},kT.prototype.drawWithMetrics=function(e){return this._draw(e,!0)},wT.default=TT;var IT;function LT(e,t,n){var r,i=U(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;e[a.id]=v(v({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(e){i.e(e)}finally{i.f()}}function OT(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var RT=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}();function NT(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function DT(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var FT=vw()(IT=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"fontAtlas",void 0),E(I(e),"iconFontMap",void 0),E(I(e),"iconFontGlyphs",{}),E(I(e),"fontOptions",void 0),E(I(e),"key",void 0),E(I(e),"cache",new T_(3)),e}return S(n,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping||{}}},{key:"getCanvasByKey",value:function(e){var t=this.cache.get(e);return t&&t.data}},{key:"getMappingByKey",value:function(e){var t=this.cache.get(e);return t&&t.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:RT,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var t=this;e.forEach((function(e){t.iconFontGlyphs[e.name]=e.unicode}))}},{key:"addIconFont",value:function(e,t){this.iconFontMap.set(e,t)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=v(v({},this.fontOptions),e),this.key=this.getKey();var t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==t.length){var r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(e,t){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(e,"';\n            src: url('").concat(t,"') format('woff2'),\n            url('").concat(t,"') format('woff'),\n            url('").concat(t,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(e),"L7text"),document.fonts.ready.then((function(){n.emit("fontloaded",{fontFamily:e})}))}catch(e){console.warn("å½åç¯å¢ä¸æ¯æ document.fonts !"),console.warn("å½åç¯å¢ä¸æ¯æ iconfont !"),console.warn(e)}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,t,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,c=r.radius,l=r.cutoff,h=r.iconfont,f=n&&n.data;f||((f=Ud.document.createElement("canvas")).width=1024);var p=f.getContext("2d",{willReadFrequently:!0});NT(p,i,a,o);var d=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,u=e.xOffset,c=void 0===u?0:u,l=e.yOffset,h=void 0===l?0:l,f=0,p=c;Array.from(t).forEach((function(e,t){if(!s[e]){var r=n(e,t);p+30>o&&(p=0,f++),s[e]={x:p,y:h+30*f,width:30,height:30,advance:r},p+=30}}));var d=r+2*i;return{mapping:s,xOffset:p,yOffset:h+f*d,canvasHeight:OT(h+(f+1)*d)}}(v({getFontWidth:function(e){return p.measureText(e).width},fontHeight:1*a,buffer:s,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),g=d.mapping,m=d.canvasHeight,y=d.xOffset,_=d.yOffset,b=p.getImageData(0,0,f.width,f.height);if(f.height=m,p.putImageData(b,0,0),NT(p,i,a,o),u){var x,S=new wT(a,s,c,l,i,o),E=p.getImageData(0,0,S.size,S.size),A=U(t);try{for(A.s();!(x=A.n()).done;){var w=x.value;if(h){var T=String.fromCharCode(parseInt(w.replace("&#x","").replace(";",""),16));DT(S.draw(T),E)}else DT(S.draw(w),E);p.putImageData(E,g[w].x,g[w].y)}}catch(e){A.e(e)}finally{A.f()}}else{var C,k=U(t);try{for(k.s();!(C=k.n()).done;){var M=C.value;p.fillText(M,g[M].x,g[M].y+1*a)}}catch(e){k.e(e)}finally{k.f()}}return{xOffset:y,yOffset:_,mapping:g,data:f,width:f.width,height:f.height}}},{key:"getKey",value:function(){var e=this.fontOptions,t=e.fontFamily,n=e.fontWeight;return"".concat(t,"_").concat(n)}},{key:"getNewChars",value:function(e,t){var n=this.cache.get(e);if(!n)return t;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(t).forEach((function(e){o.has(e)||r.push(e)})),r}}]),n}(Q_))||IT,BT=Pe("iterator"),zT=!te((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.size&&!Fe||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[BT]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),UT=/[^\0-\u007E]/,jT=/[.\u3002\uFF0E\uFF61]/g,VT="Overflow: input needs wider integers to process",GT=RangeError,HT=ae(jT.exec),WT=Math.floor,YT=String.fromCharCode,XT=ae("".charCodeAt),ZT=ae([].join),qT=ae([].push),KT=ae("".replace),QT=ae("".split),$T=ae("".toLowerCase),JT=function(e){return e+22+75*(e<26)},eC=function(e,t,n){var r=0;for(e=n?WT(e/700):e>>1,e+=WT(e/t);e>455;)e=WT(e/35),r+=36;return WT(r+36*e/(e+38))},tC=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=XT(e,n++);if(i>=55296&&i<=56319&&n<r){var o=XT(e,n++);56320==(64512&o)?qT(t,((1023&i)<<10)+(1023&o)+65536):(qT(t,i),n--)}else qT(t,i)}return t}(e)).length,o=128,a=0,s=72;for(t=0;t<e.length;t++)(n=e[t])<128&&qT(r,YT(n));var u=r.length,c=u;for(u&&qT(r,"-");c<i;){var l=2147483647;for(t=0;t<e.length;t++)(n=e[t])>=o&&n<l&&(l=n);var h=c+1;if(l-o>WT((2147483647-a)/h))throw GT(VT);for(a+=(l-o)*h,o=l,t=0;t<e.length;t++){if((n=e[t])<o&&++a>2147483647)throw GT(VT);if(n==o){for(var f=a,p=36;;){var d=p<=s?1:p>=s+26?26:p-s;if(f<d)break;var v=f-d,g=36-d;qT(r,YT(JT(d+v%g))),f=WT(v/g),p+=36}qT(r,YT(JT(f))),s=eC(a,h,c==u),a=0,c++}}a++,o++}return ZT(r,"")},nC=Pe("iterator"),rC=Nt.set,iC=Nt.getterFor("URLSearchParams"),oC=Nt.getterFor("URLSearchParamsIterator"),aC=Object.getOwnPropertyDescriptor,sC=function(e){if(!Fe)return K[e];var t=aC(K,e);return t&&t.value},uC=sC("fetch"),cC=sC("Request"),lC=sC("Headers"),hC=cC&&cC.prototype,fC=lC&&lC.prototype,pC=K.RegExp,dC=K.TypeError,vC=K.decodeURIComponent,gC=K.encodeURIComponent,mC=ae("".charAt),yC=ae([].join),_C=ae([].push),bC=ae("".replace),xC=ae([].shift),SC=ae([].splice),EC=ae("".split),AC=ae("".slice),wC=/\+/g,TC=Array(4),CC=function(e){return TC[e-1]||(TC[e-1]=pC("((?:%[\\da-f]{2}){"+e+"})","gi"))},kC=function(e){try{return vC(e)}catch(t){return e}},MC=function(e){var t=bC(e,wC," "),n=4;try{return vC(t)}catch(e){for(;n;)t=bC(t,CC(n--),kC);return t}},PC=/[!'()~]|%20/g,IC={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},LC=function(e){return IC[e]},OC=function(e){return bC(gC(e),PC,LC)},RC=hs((function(e,t){rC(this,{type:"URLSearchParamsIterator",iterator:No(iC(e).entries),kind:t})}),"Iterator",(function(){var e=oC(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),!0),NC=function(e){this.entries=[],this.url=null,void 0!==e&&(ze(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===mC(e,0)?AC(e,1):e:wr(e)))};NC.prototype={type:"URLSearchParams",bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,o,a,s,u=Oo(e);if(u)for(n=(t=No(e,u)).next;!(r=qe(n,t)).done;){if(o=(i=No(Xe(r.value))).next,(a=qe(o,i)).done||(s=qe(o,i)).done||!qe(o,i).done)throw dC("Expected sequence with length 2");_C(this.entries,{key:wr(a.value),value:wr(s.value)})}else for(var c in e)pe(e,c)&&_C(this.entries,{key:c,value:wr(e[c])})},parseQuery:function(e){if(e)for(var t,n,r=EC(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=EC(t,"="),_C(this.entries,{key:MC(xC(n)),value:MC(yC(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],_C(n,OC(e.key)+"="+OC(e.value));return yC(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var DC=function(){Zr(this,FC);var e=arguments.length>0?arguments[0]:void 0,t=rC(this,new NC(e));Fe||(this.length=t.entries.length)},FC=DC.prototype;if($s(FC,{append:function(e,t){ai(arguments.length,2);var n=iC(this);_C(n.entries,{key:wr(e),value:wr(t)}),Fe||this.length++,n.updateURL()},delete:function(e){ai(arguments.length,1);for(var t=iC(this),n=t.entries,r=wr(e),i=0;i<n.length;)n[i].key===r?SC(n,i,1):i++;Fe||(this.length=n.length),t.updateURL()},get:function(e){ai(arguments.length,1);for(var t=iC(this).entries,n=wr(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){ai(arguments.length,1);for(var t=iC(this).entries,n=wr(e),r=[],i=0;i<t.length;i++)t[i].key===n&&_C(r,t[i].value);return r},has:function(e){ai(arguments.length,1);for(var t=iC(this).entries,n=wr(e),r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){ai(arguments.length,1);for(var n,r=iC(this),i=r.entries,o=!1,a=wr(e),s=wr(t),u=0;u<i.length;u++)(n=i[u]).key===a&&(o?SC(i,u--,1):(o=!0,n.value=s));o||_C(i,{key:a,value:s}),Fe||(this.length=i.length),r.updateURL()},sort:function(){var e=iC(this);Al(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=iC(this).entries,r=$t(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new RC(this,"keys")},values:function(){return new RC(this,"values")},entries:function(){return new RC(this,"entries")}},{enumerable:!0}),Ft(FC,nC,FC.entries,{name:"entries"}),Ft(FC,"toString",(function(){return iC(this).serialize()}),{enumerable:!0}),Fe&&Hr(FC,"size",{get:function(){return iC(this).entries.length},configurable:!0,enumerable:!0}),Gr(DC,"URLSearchParams"),ar({global:!0,constructor:!0,forced:!zT},{URLSearchParams:DC}),!zT&&De(lC)){var BC=ae(fC.has),zC=ae(fC.set),UC=function(e){if(ze(e)){var t,n=e.body;if("URLSearchParams"===Ht(n))return t=e.headers?new lC(e.headers):new lC,BC(t,"content-type")||zC(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Xa(e,{body:Tt(0,wr(n)),headers:Tt(0,t)})}return e};if(De(uC)&&ar({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return uC(e,arguments.length>1?UC(arguments[1]):{})}}),De(cC)){var jC=function(e){return Zr(this,hC),new cC(e,arguments.length>1?UC(arguments[1]):{})};hC.constructor=jC,jC.prototype=hC,ar({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:jC})}}var VC={URLSearchParams:DC,getState:iC},GC=Th.codeAt,HC=Nt.set,WC=Nt.getterFor("URL"),YC=VC.URLSearchParams,XC=VC.getState,ZC=K.URL,qC=K.TypeError,KC=K.parseInt,QC=Math.floor,$C=Math.pow,JC=ae("".charAt),ek=ae(/./.exec),tk=ae([].join),nk=ae(1..toString),rk=ae([].pop),ik=ae([].push),ok=ae("".replace),ak=ae([].shift),sk=ae("".split),uk=ae("".slice),ck=ae("".toLowerCase),lk=ae([].unshift),hk=/[a-z]/i,fk=/[\d+-.a-z]/i,pk=/\d/,dk=/^0x/i,vk=/^[0-7]+$/,gk=/^\d+$/,mk=/^[\da-f]+$/i,yk=/[\0\t\n\r #%/:<>?@[\\\]^|]/,_k=/[\0\t\n\r #/:<>?@[\\\]^|]/,bk=/^[\u0000-\u0020]+/,xk=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Sk=/[\t\n\r]/g,Ek=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)lk(t,e%256),e=QC(e/256);return tk(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=nk(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},Ak={},wk=df({},Ak,{" ":1,'"':1,"<":1,">":1,"`":1}),Tk=df({},wk,{"#":1,"?":1,"{":1,"}":1}),Ck=df({},Tk,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),kk=function(e,t){var n=GC(e,0);return n>32&&n<127&&!pe(t,e)?e:encodeURIComponent(e)},Mk={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Pk=function(e,t){var n;return 2==e.length&&ek(hk,JC(e,0))&&(":"==(n=JC(e,1))||!t&&"|"==n)},Ik=function(e){var t;return e.length>1&&Pk(uk(e,0,2))&&(2==e.length||"/"===(t=JC(e,2))||"\\"===t||"?"===t||"#"===t)},Lk=function(e){return"."===e||"%2e"===ck(e)},Ok={},Rk={},Nk={},Dk={},Fk={},Bk={},zk={},Uk={},jk={},Vk={},Gk={},Hk={},Wk={},Yk={},Xk={},Zk={},qk={},Kk={},Qk={},$k={},Jk={},eM=function(e,t,n){var r,i,o,a=wr(e);if(t){if(i=this.parse(a))throw qC(i);this.searchParams=null}else{if(void 0!==n&&(r=new eM(n,!0)),i=this.parse(a,null,r))throw qC(i);(o=XC(new YC)).bindURL(this),this.searchParams=o}};eM.prototype={type:"URL",parse:function(e,t,n){var r,i,o,a,s,u=this,c=t||Ok,l=0,h="",f=!1,p=!1,d=!1;for(e=wr(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=ok(e,bk,""),e=ok(e,xk,"$1")),e=ok(e,Sk,""),r=Lb(e);l<=r.length;){switch(i=r[l],c){case Ok:if(!i||!ek(hk,i)){if(t)return"Invalid scheme";c=Nk;continue}h+=ck(i),c=Rk;break;case Rk:if(i&&(ek(fk,i)||"+"==i||"-"==i||"."==i))h+=ck(i);else{if(":"!=i){if(t)return"Invalid scheme";h="",c=Nk,l=0;continue}if(t&&(u.isSpecial()!=pe(Mk,h)||"file"==h&&(u.includesCredentials()||null!==u.port)||"file"==u.scheme&&!u.host))return;if(u.scheme=h,t)return void(u.isSpecial()&&Mk[u.scheme]==u.port&&(u.port=null));h="","file"==u.scheme?c=Yk:u.isSpecial()&&n&&n.scheme==u.scheme?c=Dk:u.isSpecial()?c=Uk:"/"==r[l+1]?(c=Fk,l++):(u.cannotBeABaseURL=!0,ik(u.path,""),c=Qk)}break;case Nk:if(!n||n.cannotBeABaseURL&&"#"!=i)return"Invalid scheme";if(n.cannotBeABaseURL&&"#"==i){u.scheme=n.scheme,u.path=fu(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,c=Jk;break}c="file"==n.scheme?Yk:Bk;continue;case Dk:if("/"!=i||"/"!=r[l+1]){c=Bk;continue}c=jk,l++;break;case Fk:if("/"==i){c=Vk;break}c=Kk;continue;case Bk:if(u.scheme=n.scheme,null==i)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=fu(n.path),u.query=n.query;else if("/"==i||"\\"==i&&u.isSpecial())c=zk;else if("?"==i)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=fu(n.path),u.query="",c=$k;else{if("#"!=i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=fu(n.path),u.path.length--,c=Kk;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=fu(n.path),u.query=n.query,u.fragment="",c=Jk}break;case zk:if(!u.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,c=Kk;continue}c=Vk}else c=jk;break;case Uk:if(c=jk,"/"!=i||"/"!=JC(h,l+1))continue;l++;break;case jk:if("/"!=i&&"\\"!=i){c=Vk;continue}break;case Vk:if("@"==i){f&&(h="%40"+h),f=!0,o=Lb(h);for(var v=0;v<o.length;v++){var g=o[v];if(":"!=g||d){var m=kk(g,Ck);d?u.password+=m:u.username+=m}else d=!0}h=""}else if(null==i||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(f&&""==h)return"Invalid authority";l-=Lb(h).length+1,h="",c=Gk}else h+=i;break;case Gk:case Hk:if(t&&"file"==u.scheme){c=Zk;continue}if(":"!=i||p){if(null==i||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(u.isSpecial()&&""==h)return"Invalid host";if(t&&""==h&&(u.includesCredentials()||null!==u.port))return;if(a=u.parseHost(h))return a;if(h="",c=qk,t)return;continue}"["==i?p=!0:"]"==i&&(p=!1),h+=i}else{if(""==h)return"Invalid host";if(a=u.parseHost(h))return a;if(h="",c=Wk,t==Hk)return}break;case Wk:if(!ek(pk,i)){if(null==i||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()||t){if(""!=h){var y=KC(h,10);if(y>65535)return"Invalid port";u.port=u.isSpecial()&&y===Mk[u.scheme]?null:y,h=""}if(t)return;c=qk;continue}return"Invalid port"}h+=i;break;case Yk:if(u.scheme="file","/"==i||"\\"==i)c=Xk;else{if(!n||"file"!=n.scheme){c=Kk;continue}if(null==i)u.host=n.host,u.path=fu(n.path),u.query=n.query;else if("?"==i)u.host=n.host,u.path=fu(n.path),u.query="",c=$k;else{if("#"!=i){Ik(tk(fu(r,l),""))||(u.host=n.host,u.path=fu(n.path),u.shortenPath()),c=Kk;continue}u.host=n.host,u.path=fu(n.path),u.query=n.query,u.fragment="",c=Jk}}break;case Xk:if("/"==i||"\\"==i){c=Zk;break}n&&"file"==n.scheme&&!Ik(tk(fu(r,l),""))&&(Pk(n.path[0],!0)?ik(u.path,n.path[0]):u.host=n.host),c=Kk;continue;case Zk:if(null==i||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&Pk(h))c=Kk;else if(""==h){if(u.host="",t)return;c=qk}else{if(a=u.parseHost(h))return a;if("localhost"==u.host&&(u.host=""),t)return;h="",c=qk}continue}h+=i;break;case qk:if(u.isSpecial()){if(c=Kk,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(null!=i&&(c=Kk,"/"!=i))continue}else u.fragment="",c=Jk;else u.query="",c=$k;break;case Kk:if(null==i||"/"==i||"\\"==i&&u.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(s=ck(s=h))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(u.shortenPath(),"/"==i||"\\"==i&&u.isSpecial()||ik(u.path,"")):Lk(h)?"/"==i||"\\"==i&&u.isSpecial()||ik(u.path,""):("file"==u.scheme&&!u.path.length&&Pk(h)&&(u.host&&(u.host=""),h=JC(h,0)+":"),ik(u.path,h)),h="","file"==u.scheme&&(null==i||"?"==i||"#"==i))for(;u.path.length>1&&""===u.path[0];)ak(u.path);"?"==i?(u.query="",c=$k):"#"==i&&(u.fragment="",c=Jk)}else h+=kk(i,Tk);break;case Qk:"?"==i?(u.query="",c=$k):"#"==i?(u.fragment="",c=Jk):null!=i&&(u.path[0]+=kk(i,Ak));break;case $k:t||"#"!=i?null!=i&&("'"==i&&u.isSpecial()?u.query+="%27":u.query+="#"==i?"%23":kk(i,Ak)):(u.fragment="",c=Jk);break;case Jk:null!=i&&(u.fragment+=kk(i,wk))}l++}},parseHost:function(e){var t,n,r;if("["==JC(e,0)){if("]"!=JC(e,e.length-1))return"Invalid host";if(!(t=function(e){var t,n,r,i,o,a,s,u=[0,0,0,0,0,0,0,0],c=0,l=null,h=0,f=function(){return JC(e,h)};if(":"==f()){if(":"!=JC(e,1))return;h+=2,l=++c}for(;f();){if(8==c)return;if(":"!=f()){for(t=n=0;n<4&&ek(mk,f());)t=16*t+KC(f(),16),h++,n++;if("."==f()){if(0==n)return;if(h-=n,c>6)return;for(r=0;f();){if(i=null,r>0){if(!("."==f()&&r<4))return;h++}if(!ek(pk,f()))return;for(;ek(pk,f());){if(o=KC(f(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;h++}u[c]=256*u[c]+i,2!=++r&&4!=r||c++}if(4!=r)return;break}if(":"==f()){if(h++,!f())return}else if(f())return;u[c++]=t}else{if(null!==l)return;h++,l=++c}}if(null!==l)for(a=c-l,c=7;0!=c&&a>0;)s=u[c],u[c--]=u[l+a-1],u[l+--a]=s;else if(8!=c)return;return u}(uk(e,1,-1))))return"Invalid host";this.host=t}else if(this.isSpecial()){if(e=function(e){var t,n,r=[],i=QT(KT($T(e),jT,"."),".");for(t=0;t<i.length;t++)n=i[t],qT(r,HT(UT,n)?"xn--"+tC(n):n);return ZT(r,".")}(e),ek(yk,e))return"Invalid host";if(null===(t=function(e){var t,n,r,i,o,a,s,u=sk(e,".");if(u.length&&""==u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=u[r]))return e;if(o=10,i.length>1&&"0"==JC(i,0)&&(o=ek(dk,i)?16:8,i=uk(i,8==o?1:2)),""===i)a=0;else{if(!ek(10==o?gk:8==o?vk:mk,i))return e;a=KC(i,o)}ik(n,a)}for(r=0;r<t;r++)if(a=n[r],r==t-1){if(a>=$C(256,5-t))return null}else if(a>255)return null;for(s=rk(n),r=0;r<n.length;r++)s+=n[r]*$C(256,3-r);return s}(e)))return"Invalid host";this.host=t}else{if(ek(_k,e))return"Invalid host";for(t="",n=Lb(e),r=0;r<n.length;r++)t+=kk(n[r],Ak);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return pe(Mk,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&Pk(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,u=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=n+(r?":"+r:"")+"@"),c+=Ek(i),null!==o&&(c+=":"+o)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?a[0]:a.length?"/"+tk(a,"/"):"",null!==s&&(c+="?"+s),null!==u&&(c+="#"+u),c},setHref:function(e){var t=this.parse(e);if(t)throw qC(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new nM(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+Ek(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(wr(e)+":",Ok)},getUsername:function(){return this.username},setUsername:function(e){var t=Lb(wr(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=kk(t[n],Ck)}},getPassword:function(){return this.password},setPassword:function(e){var t=Lb(wr(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=kk(t[n],Ck)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?Ek(e):Ek(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Gk)},getHostname:function(){var e=this.host;return null===e?"":Ek(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Hk)},getPort:function(){var e=this.port;return null===e?"":wr(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=wr(e))?this.port=null:this.parse(e,Wk))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+tk(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,qk))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=wr(e))?this.query=null:("?"==JC(e,0)&&(e=uk(e,1)),this.query="",this.parse(e,$k)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=wr(e))?("#"==JC(e,0)&&(e=uk(e,1)),this.fragment="",this.parse(e,Jk)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var tM,nM=function(e){var t=Zr(this,rM),n=ai(arguments.length,1)>1?arguments[1]:void 0,r=HC(t,new eM(e,!1,n));Fe||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},rM=nM.prototype,iM=function(e,t){return{get:function(){return WC(this)[e]()},set:t&&function(e){return WC(this)[t](e)},configurable:!0,enumerable:!0}};if(Fe&&(Hr(rM,"href",iM("serialize","setHref")),Hr(rM,"origin",iM("getOrigin")),Hr(rM,"protocol",iM("getProtocol","setProtocol")),Hr(rM,"username",iM("getUsername","setUsername")),Hr(rM,"password",iM("getPassword","setPassword")),Hr(rM,"host",iM("getHost","setHost")),Hr(rM,"hostname",iM("getHostname","setHostname")),Hr(rM,"port",iM("getPort","setPort")),Hr(rM,"pathname",iM("getPathname","setPathname")),Hr(rM,"search",iM("getSearch","setSearch")),Hr(rM,"searchParams",iM("getSearchParams")),Hr(rM,"hash",iM("getHash","setHash"))),Ft(rM,"toJSON",(function(){return WC(this).serialize()}),{enumerable:!0}),Ft(rM,"toString",(function(){return WC(this).serialize()}),{enumerable:!0}),ZC){var oM=ZC.createObjectURL,aM=ZC.revokeObjectURL;oM&&Ft(nM,"createObjectURL",$t(oM,ZC)),aM&&Ft(nM,"revokeObjectURL",$t(aM,ZC))}Gr(nM,"URL"),ar({global:!0,constructor:!0,forced:!zT,sham:!Fe},{URL:nM});var sM,uM=vw()(tM=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"canvasHeight",128),E(I(e),"texture",void 0),E(I(e),"canvas",void 0),E(I(e),"iconData",void 0),E(I(e),"iconMap",void 0),E(I(e),"ctx",void 0),E(I(e),"loadingImageCount",0),e}return S(r,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Ud.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:(t=_(g().mark((function e(t,n){var r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Image,this.loadingImageCount++,this.hasImage(t)?console.warn("Image Id already exists"):this.iconData.push({id:t,size:64}),this.updateIconMap(),e.next=6,this.loadImage(n);case 6:r=e.sent,(i=this.iconData.find((function(e){return e.id===t})))&&(i.image=r,i.width=r.width,i.height=r.height),this.update();case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"addImageMini",value:function(e,t,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImageMini(t,i).then((function(t){o=t;var n=r.iconData.find((function(t){return t.id===e}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter((function(t){return t.id!==e})),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(t){var n=e.iconMap[t],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,c=void 0===u?64:u,l=Math.max(s,c)/64,h=c/l,f=s/l;o&&e.ctx.drawImage(o,r+(64-f)/2,i+(64-h)/2,f,h)}))}},{key:"updateIconMap",value:function(){var e=function(e,t,n){var r,i=0,o=0,a=0,s=[],u={},c=U(e);try{for(c.s();!(r=c.n()).done;){var l=r.value;if(!u[l.id]){var h=l.size;i+h+t>n&&(LT(u,s,o),i=0,o=a+o+t,a=0,s=[]),s.push({icon:l,xOffset:i}),i=i+h+t,a=Math.max(a,h)}}}catch(e){c.e(e)}finally{c.f()}return s.length>0&&LT(u,s,o),{mapping:u,canvasHeight:OT(a+o+t)}}(this.iconData,3,1024),t=e.mapping,n=e.canvasHeight;this.iconMap=t,this.canvasHeight=n}},{key:"loadImageMini",value:function(e,t){return new Promise((function(n,r){var i=t.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+e))},i.src=e}))}}]),r}(Q_))||tM,cM=vw()(sM=function(){function e(){b(this,e),E(this,"viewport",void 0),E(this,"overridedViewProjectionMatrix",void 0),E(this,"jitteredViewProjectionMatrix",void 0),E(this,"jitteredProjectionMatrix",void 0),E(this,"viewMatrixInverse",void 0),E(this,"cameraPosition",void 0)}return S(e,[{key:"init",value:function(){}},{key:"update",value:function(e){this.viewport=e,this.viewMatrixInverse=eS(),iS(this.viewMatrixInverse,e.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var e=D(this.viewport.getCenter(),2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}},{key:"setViewProjectionMatrix",value:function(e){this.overridedViewProjectionMatrix=e}},{key:"jitterProjectionMatrix",value:function(e,t){var n=hS(eS(),[e,t,0]);this.jitteredProjectionMatrix=oS(eS(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=oS(eS(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||sM,lM=Om.values;ar({target:"Object",stat:!0},{values:function(e){return lM(e)}});var hM,fM,pM,dM=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),vM={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},gM=vw()(hM=function(){function e(){b(this,e),E(this,"container",void 0),E(this,"controlCorners",void 0),E(this,"controlContainer",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"controls",[]),E(this,"unAddControls",[])}return S(e,[{key:"init",value:function(e,t){this.container=e.container,this.scene=t,this.mapsService=t.get(AT.IMapService),this.initControlPos()}},{key:"addControl",value:function(e,t){t.get(AT.IMapService).map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}},{key:"getControlByName",value:function(e){return this.controls.find((function(t){return t.controlOption.name===e}))}},{key:"removeControl",value:function(e){var t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}},{key:"addControls",value:function(){var e=this;this.unAddControls.forEach((function(t){t.addTo(e.scene),e.controls.push(t)})),this.unAddControls=[]}},{key:"destroy",value:function(){var e,t=U(this.controls);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(e){t.e(e)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var e=this.controlCorners={},t="l7-",n=this.controlContainer=Bm("div","l7-control-container",this.container);Object.values(dM).forEach((function(r){var i,o;!function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=r.map((function(e){return t+e})).join(" ");e[r.filter((function(e){return!["row","column"].includes(e)})).join("")]=Bm("div",i,n)}((i=r,o=i.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),[].concat(F(o),[vM[i]])))})),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var e in this.controlCorners)this.controlCorners[e]&&zm(this.controlCorners[e]);this.controlContainer&&zm(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var e=this,t=window.MutationObserver;if(t)for(var n=function(){var n=i[r].match(/^(top|bottom)(left|right)$/);if(n){var o=D(n,3),a=o[1],s=o[2],u=e.controlCorners["".concat(a).concat(s)];new t((function(e){var t=D(e,1)[0].target;u&&(u.style[a]=t.clientHeight+"px")})).observe(e.controlCorners["".concat(s).concat(a)],{childList:!0,attributes:!0})}},r=0,i=Object.keys(this.controlCorners);r<i.length;r++)n()}}]),e}())||hM,mM=vw()(fM=function(){function e(){b(this,e),E(this,"container",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"markers",[]),E(this,"markerLayers",[]),E(this,"unAddMarkers",[]),E(this,"unAddMarkerLayers",[])}return S(e,[{key:"addMarkerLayer",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}},{key:"removeMarkerLayer",value:function(e){e.destroy(),this.markerLayers.indexOf(e);var t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}},{key:"addMarker",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}},{key:"addMarkers",value:function(){var e=this;this.unAddMarkers.forEach((function(t){t.addTo(e.scene),e.markers.push(t)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var e=this;this.unAddMarkerLayers.forEach((function(t){e.markerLayers.push(t),t.addTo(e.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(e){e.remove(),this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(AT.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(e){e.remove()})),this.markers=[],this.markerLayers.forEach((function(e){e.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(e){e.destroy()}}]),e}())||fM,yM=vw()(pM=function(){function e(){b(this,e),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"popups",[]),E(this,"unAddPopups",[])}return S(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(e){null!=e&&e.isOpen()&&e.remove();var t=this.popups.indexOf(e);t>-1&&this.popups.splice(t,1);var n=this.unAddPopups.indexOf(e);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach((function(e){return e.remove()}))}},{key:"addPopup",value:function(e){var t=this;e&&e.getOptions().autoClose&&[].concat(F(this.popups),F(this.unAddPopups)).forEach((function(e){e.getOptions().autoClose&&t.removePopup(e)})),this.isMarkerReady?(e.addTo(this.scene),this.popups.push(e)):this.unAddPopups.push(e),e.on("close",(function(){t.removePopup(e)}))}},{key:"initPopup",value:function(){var e=this;this.unAddPopups.length&&this.unAddPopups.forEach((function(t){e.addPopup(t),e.unAddPopups=[]}))}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(AT.IMapService)}}]),e}())||pM;var _M=function(){this.__data__=[],this.size=0};var bM=function(e,t){return e===t||e!=e&&t!=t};var xM=function(e,t){for(var n=e.length;n--;)if(bM(e[n][0],t))return n;return-1},SM=Array.prototype.splice;var EM=function(e){var t=this.__data__,n=xM(t,e);return!(n<0)&&(n==t.length-1?t.pop():SM.call(t,n,1),--this.size,!0)};var AM=function(e){var t=this.__data__,n=xM(t,e);return n<0?void 0:t[n][1]};var wM=function(e){return xM(this.__data__,e)>-1};var TM=function(e,t){var n=this.__data__,r=xM(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function CM(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}CM.prototype.clear=_M,CM.prototype.delete=EM,CM.prototype.get=AM,CM.prototype.has=wM,CM.prototype.set=TM;var kM=CM;var MM=function(){this.__data__=new kM,this.size=0};var PM=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var IM=function(e){return this.__data__.get(e)};var LM=function(e){return this.__data__.has(e)},OM=Ag($v,"Map"),RM=Ag(Object,"create");var NM=function(){this.__data__=RM?RM(null):{},this.size=0};var DM=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},FM=Object.prototype.hasOwnProperty;var BM=function(e){var t=this.__data__;if(RM){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return FM.call(t,e)?t[e]:void 0},zM=Object.prototype.hasOwnProperty;var UM=function(e){var t=this.__data__;return RM?void 0!==t[e]:zM.call(t,e)};var jM=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=RM&&void 0===t?"__lodash_hash_undefined__":t,this};function VM(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}VM.prototype.clear=NM,VM.prototype.delete=DM,VM.prototype.get=BM,VM.prototype.has=UM,VM.prototype.set=jM;var GM=VM;var HM=function(){this.size=0,this.__data__={hash:new GM,map:new(OM||kM),string:new GM}};var WM=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var YM=function(e,t){var n=e.__data__;return WM(t)?n["string"==typeof t?"string":"hash"]:n.map};var XM=function(e){var t=YM(this,e).delete(e);return this.size-=t?1:0,t};var ZM=function(e){return YM(this,e).get(e)};var qM=function(e){return YM(this,e).has(e)};var KM=function(e,t){var n=YM(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function QM(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}QM.prototype.clear=HM,QM.prototype.delete=XM,QM.prototype.get=ZM,QM.prototype.has=qM,QM.prototype.set=KM;var $M=QM;var JM=function(e,t){var n=this.__data__;if(n instanceof kM){var r=n.__data__;if(!OM||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new $M(r)}return n.set(e,t),this.size=n.size,this};function eP(e){var t=this.__data__=new kM(e);this.size=t.size}eP.prototype.clear=MM,eP.prototype.delete=PM,eP.prototype.get=IM,eP.prototype.has=LM,eP.prototype.set=JM;var tP=eP;var nP=function(e,t,n){"__proto__"==t&&wg?wg(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var rP=function(e,t,n){(void 0!==n&&!bM(e[t],n)||void 0===n&&!(t in e))&&nP(e,t,n)};var iP=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}(),oP=Y((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?$v.Buffer:void 0,o=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=o?o(n):new e.constructor(n);return e.copy(r),r}})),aP=$v.Uint8Array;var sP=function(e){var t=new e.constructor(e.byteLength);return new aP(t).set(new aP(e)),t};var uP=function(e,t){var n=t?sP(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},cP=Object.create,lP=function(){function e(){}return function(t){if(!cg(t))return{};if(cP)return cP(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var hP=function(e,t){return function(n){return e(t(n))}},fP=hP(Object.getPrototypeOf,Object),pP=Object.prototype;var dP=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||pP)};var vP=function(e){return"function"!=typeof e.constructor||dP(e)?{}:lP(fP(e))};var gP=function(e){return _b(e)&&"[object Arguments]"==ug(e)},mP=Object.prototype,yP=mP.hasOwnProperty,_P=mP.propertyIsEnumerable,bP=gP(function(){return arguments}())?gP:function(e){return _b(e)&&yP.call(e,"callee")&&!_P.call(e,"callee")},xP=Array.isArray;var SP=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var EP=function(e){return null!=e&&SP(e.length)&&!lg(e)};var AP=function(e){return _b(e)&&EP(e)};var wP=function(){return!1},TP=Y((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?$v.Buffer:void 0,o=(i?i.isBuffer:void 0)||wP;e.exports=o})),CP=Function.prototype,kP=Object.prototype,MP=CP.toString,PP=kP.hasOwnProperty,IP=MP.call(Object);var LP=function(e){if(!_b(e)||"[object Object]"!=ug(e))return!1;var t=fP(e);if(null===t)return!0;var n=PP.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&MP.call(n)==IP},OP={};OP["[object Float32Array]"]=OP["[object Float64Array]"]=OP["[object Int8Array]"]=OP["[object Int16Array]"]=OP["[object Int32Array]"]=OP["[object Uint8Array]"]=OP["[object Uint8ClampedArray]"]=OP["[object Uint16Array]"]=OP["[object Uint32Array]"]=!0,OP["[object Arguments]"]=OP["[object Array]"]=OP["[object ArrayBuffer]"]=OP["[object Boolean]"]=OP["[object DataView]"]=OP["[object Date]"]=OP["[object Error]"]=OP["[object Function]"]=OP["[object Map]"]=OP["[object Number]"]=OP["[object Object]"]=OP["[object RegExp]"]=OP["[object Set]"]=OP["[object String]"]=OP["[object WeakMap]"]=!1;var RP=function(e){return _b(e)&&SP(e.length)&&!!OP[ug(e)]},NP=Y((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n&&Kv.process,o=function(){try{var e=r&&r.require&&r.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o})),DP=NP&&NP.isTypedArray,FP=DP?Dg(DP):RP;var BP=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},zP=Object.prototype.hasOwnProperty;var UP=function(e,t,n){var r=e[t];zP.call(e,t)&&bM(r,n)&&(void 0!==n||t in e)||nP(e,t,n)};var jP=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],u=r?r(n[s],e[s],s,n,e):void 0;void 0===u&&(u=e[s]),i?nP(n,s,u):UP(n,s,u)}return n};var VP=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},GP=/^(?:0|[1-9]\d*)$/;var HP=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&GP.test(e))&&e>-1&&e%1==0&&e<t},WP=Object.prototype.hasOwnProperty;var YP=function(e,t){var n=xP(e),r=!n&&bP(e),i=!n&&!r&&TP(e),o=!n&&!r&&!i&&FP(e),a=n||r||i||o,s=a?VP(e.length,String):[],u=s.length;for(var c in e)!t&&!WP.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||HP(c,u))||s.push(c);return s};var XP=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},ZP=Object.prototype.hasOwnProperty;var qP=function(e){if(!cg(e))return XP(e);var t=dP(e),n=[];for(var r in e)("constructor"!=r||!t&&ZP.call(e,r))&&n.push(r);return n};var KP=function(e){return EP(e)?YP(e,!0):qP(e)};var QP=function(e){return jP(e,KP(e))};var $P=function(e,t,n,r,i,o,a){var s=BP(e,n),u=BP(t,n),c=a.get(u);if(c)rP(e,n,c);else{var l=o?o(s,u,n+"",e,t,a):void 0,h=void 0===l;if(h){var f=xP(u),p=!f&&TP(u),d=!f&&!p&&FP(u);l=u,f||p||d?xP(s)?l=s:AP(s)?l=Fg(s):p?(h=!1,l=oP(u,!0)):d?(h=!1,l=uP(u,!0)):l=[]:LP(u)||bP(u)?(l=s,bP(s)?l=QP(s):cg(s)&&!lg(s)||(l=vP(u))):h=!1}h&&(a.set(u,l),i(l,u,r,o,a),a.delete(u)),rP(e,n,l)}};var JP=function e(t,n,r,i,o){t!==n&&iP(n,(function(a,s){if(o||(o=new tP),cg(a))$P(t,n,s,r,e,i,o);else{var u=i?i(BP(t,s),a,s+"",t,n,o):void 0;void 0===u&&(u=a),rP(t,s,u)}}),KP)};var eI=function(e,t,n){if(!cg(n))return!1;var r=typeof t;return!!("number"==r?EP(n)&&HP(t,n.length):"string"==r&&t in n)&&bM(n[t],e)};var tI,nI=function(e){return Mg((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&eI(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t}))},rI=nI((function(e,t,n){JP(e,t,n)})),iI=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),oI=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),aI=function(e){return e.AND="and",e.OR="or",e}({}),sI=function(e){return e.INIT="init",e.UPDATE="update",e}({}),uI={MapToken:"æ¨æ­£å¨ä½¿ç¨ Demo æµè¯ Token, çäº§ç¯å¢å¡å¿èªè¡æ³¨å Token ç¡®ä¿æå¡ç¨³å®",SDK:"è¯·ç¡®è®¤å¼å¥äºmapbox-gl apiä¸å¨L7ä¹åå¼å¥"},cI={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,isMini:!1,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},lI={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:aI.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},hI=vw()(tI=function(){function e(){b(this,e),E(this,"sceneConfigCache",{}),E(this,"layerConfigCache",{}),E(this,"layerAttributeConfigCache",{})}return S(e,[{key:"getSceneConfig",value:function(e){return this.sceneConfigCache[e]}},{key:"getSceneWarninfo",value:function(e){return uI[e]}},{key:"setSceneConfig",value:function(e,t){this.sceneConfigCache[e]=v(v({},cI),t)}},{key:"getLayerConfig",value:function(e){return this.layerConfigCache[e]}},{key:"setLayerConfig",value:function(e,t,n){this.layerConfigCache[t]=v({},rI({},this.sceneConfigCache[e],lI,n))}},{key:"getAttributeConfig",value:function(e){return this.layerAttributeConfigCache[e]}},{key:"setAttributeConfig",value:function(e,t){this.layerAttributeConfigCache[e]=v(v({},this.layerAttributeConfigCache[e]),t)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||tI,fI=Math.sign||function(e){var t=+e;return 0==t||t!=t?t:t<0?-1:1},pI=Math.abs,dI=Math.pow,vI=dI(2,-52),gI=dI(2,-23),mI=dI(2,127)*(2-gI),yI=dI(2,-126),_I=Math.fround||function(e){var t,n,r=+e,i=pI(r),o=fI(r);return i<yI?o*function(e){return e+1/vI-1/vI}(i/yI/gI)*yI*gI:(n=(t=(1+gI/vI)*i)-(t-i))>mI||n!=n?o*(1/0):o*n};ar({target:"Math",stat:!0},{fround:_I});var bI=Math.PI/180;function xI(e){var t=e.latitude,n=void 0===t?0:t,r=e.zoom,i=void 0===r?0:r,o=e.scale,a=e.highPrecision,s=void 0!==a&&a,u=e.flipY,c=void 0!==u&&u,l={},h=512*(o=void 0!==o?o:Math.pow(2,i)),f=Math.cos(n*bI),p=h/360,d=p/f,v=h/4003e4/f;if(l.pixelsPerMeter=[v,-v,v],l.metersPerPixel=[1/v,-1/v,1/v],l.pixelsPerDegree=[p,-d,v],l.degreesPerPixel=[1/p,-1/d,1/v],s){var g=bI*Math.tan(n*bI)/f,m=p*g/2,y=h/4003e4*g,_=y/d*v;l.pixelsPerDegree2=[0,-m,y],l.pixelsPerMeter2=[_,0,_],c&&(l.pixelsPerDegree2[1]=-l.pixelsPerDegree2[1],l.pixelsPerMeter2[1]=-l.pixelsPerMeter2[1])}return c&&(l.pixelsPerMeter[1]=-l.pixelsPerMeter[1],l.metersPerPixel[1]=-l.metersPerPixel[1],l.pixelsPerDegree[1]=-l.pixelsPerDegree[1],l.degreesPerPixel[1]=-l.degreesPerPixel[1]),l}var SI,EI,AI,wI,TI,CI,kI,MI,PI,II,LI,OI=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),RI={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},NI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],DI=(SI=vw(),EI=dw(AT.ICameraService),SI((TI=G((wI=function(){function e(){b(this,e),E(this,"needRefresh",!0),V(this,"cameraService",TI,this),E(this,"coordinateSystem",void 0),E(this,"viewportCenter",void 0),E(this,"viewportCenterProjection",void 0),E(this,"pixelsPerDegree",void 0),E(this,"pixelsPerDegree2",void 0),E(this,"pixelsPerMeter",void 0)}return S(e,[{key:"refresh",value:function(e){var t=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=e||this.cameraService.getCenter(),i=xI({latitude:r[1],zoom:t}),o=i.pixelsPerMeter,a=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===OI.LNGLAT||this.coordinateSystem===OI.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===OI.LNGLAT_OFFSET?this.calculateLnglatOffset(r,t):this.coordinateSystem===OI.P20_OFFSET&&this.calculateLnglatOffset(r,t,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(e){this.coordinateSystem=e}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(e,t,n,r){var i=xI({latitude:e[1],zoom:t,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),c=this.cameraService.getProjectionMatrix(),l=oS([],c,u),h=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],Math.pow(2,t));this.viewportCenterProjection=$S([],[h[0],h[1],0,1],l),l=oS([],c,u=this.cameraService.getViewMatrixUncentered()||u),l=oS([],l,NI),this.cameraService.setViewProjectionMatrix(l),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),e}()).prototype,"cameraService",[EI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AI=wI))||AI),FI=vw()(CI=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"renderMap",new Map),E(I(e),"enable",!1),E(I(e),"renderEnable",!1),E(I(e),"cacheLogs",{}),e}return S(n,[{key:"setEnable",value:function(e){this.enable=!!e}},{key:"log",value:function(e,t){var n=this;if(this.enable){var r=e.split("."),i=null;r.forEach((function(e,o){null!==i?(i[e]||(i[e]={}),o!==r.length-1&&(i=i[e])):(n.cacheLogs[e]||(n.cacheLogs[e]={}),o!==r.length-1&&(i=n.cacheLogs[e])),o===r.length-1&&(i[e]=v(v({time:Date.now()},i[e]),t))}))}}},{key:"getLog",value:function(e){var t=this;switch(m(e)){case"string":return this.cacheLogs[e];case"object":return e.map((function(e){return t.cacheLogs[e]})).filter((function(e){return void 0!==e}));case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(e){delete this.cacheLogs[e]}},{key:"generateRenderUid",value:function(){return this.renderEnable?d_():""}},{key:"renderDebug",value:function(e){this.renderEnable=e}},{key:"renderStart",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e)||{};this.renderMap.set(e,v(v({},t),{},{renderUid:e,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e);if(t){var n=t.renderStart,r=Date.now();this.emit("renderEnd",v(v({},t),{},{renderEnd:r,renderDuration:r-n})),this.renderMap.delete(e)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),n}(Q_))||CI,BI=Y((function(e){
/*! Hammer.JS - v2.0.7 - 2016-04-22
   * http://hammerjs.github.io/
   *
   * Copyright (c) 2016 Jorik Tangelder;
   * Licensed under the MIT license */
!function(t,n,r,i){var o,a="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,s="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),u=a||s,c=["","webkit","Moz","MS","ms","o"],l=u?"":n.createElement("div"),h=Math.round,f=Math.abs,p=Date.now;function d(e,t,n){return setTimeout(x(e,n),t)}function v(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(void 0!==e.length)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function m(e,n,r){var i="DEPRECATED METHOD: "+n+"\n"+r+" AT \n";return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=t.console&&(t.console.warn||t.console.log);return o&&o.call(t.console,i,r),e.apply(this,arguments)}}o="function"!=typeof Object.assign?function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var y=m((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&void 0===e[r[i]])&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),_=m((function(e,t){return y(e,t,!0)}),"merge","Use `assign`.");function b(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&o(r,n)}function x(e,t){return function(){return e.apply(t,arguments)}}function S(e,t){return"function"==typeof e?e.apply(t&&t[0]||void 0,t):e}function E(e,t){return void 0===e?t:e}function A(e,t,n){g(k(t),(function(t){e.addEventListener(t,n,!1)}))}function w(e,t,n){g(k(t),(function(t){e.removeEventListener(t,n,!1)}))}function T(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function C(e,t){return e.indexOf(t)>-1}function k(e){return e.trim().split(/\s+/g)}function M(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function P(e){return Array.prototype.slice.call(e,0)}function I(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];M(i,a)<0&&r.push(e[o]),i[o]=a,o++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function L(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((r=(n=c[o])?n+i:t)in e)return r;o++}}var O=1;function R(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}var N="ontouchstart"in t,D=void 0!==L(t,"PointerEvent"),F=N&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B=["x","y"],z=["clientX","clientY"];function U(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){S(e.options.enable,[e])&&n.handler(t)},this.init()}function j(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&t&&r-i==0,a=12&t&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=V(t));i>1&&!n.firstMultiple?n.firstMultiple=V(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,u=t.center=G(r);t.timeStamp=p(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=X(s,u),t.distance=Y(s,u),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=W(t.deltaX,t.deltaY);var c=H(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=f(c.x)>f(c.y)?c.x:c.y,t.scale=a?(l=a.pointers,h=r,Y(h[0],h[1],z)/Y(l[0],l[1],z)):1,t.rotation=a?function(e,t){return X(t[1],t[0],z)+X(e[1],e[0],z)}(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,a=e.lastInterval||t,s=t.timeStamp-a.timeStamp;if(8!=t.eventType&&(s>25||void 0===a.velocity)){var u=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,l=H(s,u,c);r=l.x,i=l.y,n=f(l.x)>f(l.y)?l.x:l.y,o=W(u,c),e.lastInterval=t}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var l,h;var d=e.element;T(t.srcEvent.target,d)&&(d=t.srcEvent.target);t.target=d}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function V(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:h(e.pointers[n].clientX),clientY:h(e.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:t,center:G(t),deltaX:e.deltaX,deltaY:e.deltaY}}function G(e){var t=e.length;if(1===t)return{x:h(e[0].clientX),y:h(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:h(n/t),y:h(r/t)}}function H(e,t,n){return{x:t/e||0,y:n/e||0}}function W(e,t){return e===t?1:f(e)>=f(t)?e<0?2:4:t<0?8:16}function Y(e,t,n){n||(n=B);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function X(e,t,n){n||(n=B);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}U.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(R(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(R(this.element),this.evWin,this.domHandler)}};var Z={mousedown:1,mousemove:2,mouseup:4};function q(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,U.apply(this,arguments)}b(q,U,{handler:function(e){var t=Z[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var K={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Q={2:"touch",3:"pen",4:"mouse",5:"kinect"},$="pointerdown",J="pointermove pointerup pointercancel";function ee(){this.evEl=$,this.evWin=J,U.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}u||!t.MSPointerEvent||t.PointerEvent||($="MSPointerDown",J="MSPointerMove MSPointerUp MSPointerCancel"),b(ee,U,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=K[r],o=Q[e.pointerType]||e.pointerType,a="touch"==o,s=M(t,e.pointerId,"pointerId");1&i&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(s,1))}});var te={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ne(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,U.apply(this,arguments)}function re(e,t){var n=P(e.touches),r=P(e.changedTouches);return 12&t&&(n=I(n.concat(r),"identifier",!0)),[n,r]}b(ne,U,{handler:function(e){var t=te[e.type];if(1===t&&(this.started=!0),this.started){var n=re.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var ie={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function oe(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},U.apply(this,arguments)}function ae(e,t){var n=P(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=P(e.changedTouches),s=[],u=this.target;if(o=n.filter((function(e){return T(e.target,u)})),1===t)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&t&&delete r[a[i].identifier],i++;return s.length?[I(o.concat(s),"identifier",!0),s]:void 0}b(oe,U,{handler:function(e){var t=ie[e.type],n=ae.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});function se(){U.apply(this,arguments);var e=x(this.handler,this);this.touch=new oe(this.manager,e),this.mouse=new q(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function ue(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ce.call(this,t)):12&e&&ce.call(this,t)}function ce(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function le(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}b(se,U,{handler:function(e,t,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)ue.call(this,t,n);else if(i&&le.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var he=u?void 0:L(l.style,"touchAction"),fe=void 0!==he,pe=function(){if(!fe)return!1;var e={};if(u)return e;var n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){e[r]=!n||t.CSS.supports("touch-action",r)})),e}();function de(e,t){this.manager=e,this.set(t)}de.prototype={set:function(e){"compute"==e&&(e=this.compute()),fe&&this.manager.element.style&&pe[e]&&(this.manager.element.style[he]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){S(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(C(e,"none"))return"none";var t=C(e,"pan-x"),n=C(e,"pan-y");if(t&&n)return"none";if(t||n)return t?"pan-x":"pan-y";if(C(e,"manipulation"))return"manipulation";return"auto"}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=C(r,"none")&&!pe.none,o=C(r,"pan-y")&&!pe["pan-y"],a=C(r,"pan-x")&&!pe["pan-x"];if(i){var s=1===e.pointers.length,u=e.distance<2,c=e.deltaTime<250;if(s&&u&&c)return}if(!a||!o)return i||o&&6&n||a&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function ve(e){this.options=o({},this.defaults,e||{}),this.id=O++,this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function ge(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function me(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function ye(e,t){var n=t.manager;return n?n.get(e):e}function _e(){ve.apply(this,arguments)}function be(){_e.apply(this,arguments),this.pX=null,this.pY=null}function xe(){_e.apply(this,arguments)}function Se(){ve.apply(this,arguments),this._timer=null,this._input=null}function Ee(){_e.apply(this,arguments)}function Ae(){_e.apply(this,arguments)}function we(){ve.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Te(e,t){return(t=t||{}).recognizers=E(t.recognizers,Te.defaults.preset),new Ce(e,t)}ve.prototype={defaults:{},set:function(e){return o(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(v(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=ye(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return v(e,"dropRecognizeWith",this)||(e=ye(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(v(e,"requireFailure",this))return this;var t=this.requireFail;return-1===M(t,e=ye(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(v(e,"dropRequireFailure",this))return this;e=ye(e,this);var t=M(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+ge(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+ge(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=o({},e);if(!S(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},b(_e,ve,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:32}}),b(be,_e,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push("pan-y"),24&e&&t.push("pan-x"),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(6&t.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return _e.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=me(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),b(xe,_e,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),b(Se,ve,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=d((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),b(Ee,_e,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),b(Ae,_e,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return be.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=me(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),b(we,ve,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||Y(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=d((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return 32},failTimeout:function(){return this._timer=d((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Te.VERSION="2.0.7",Te.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Ee,{enable:!1}],[xe,{enable:!1},["rotate"]],[Ae,{direction:6}],[be,{direction:6},["swipe"]],[we],[we,{event:"doubletap",taps:2},["tap"]],[Se]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ce(e,t){var n;this.options=o({},Te.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(D?ee:F?oe:N?se:q))(n,j),this.touchAction=new de(this,this.options.touchAction),ke(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function ke(e,t){var n,r=e.element;r.style&&(g(e.options.cssProps,(function(i,o){n=L(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}(Ce.prototype={set:function(e){return o(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof ve)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(v(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(v(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=M(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(void 0!==e&&void 0!==t){var n=this.handlers;return g(k(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(void 0!==e){var n=this.handlers;return g(k(e),(function(e){t?n[e]&&n[e].splice(M(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){if(u)return;var r=n.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](t),i++}},destroy:function(){this.element&&ke(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u)||(o(Te,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Ce,Input:U,TouchAction:de,TouchInput:oe,MouseInput:q,PointerEventInput:ee,TouchMouseInput:se,SingleTouchInput:ne,Recognizer:ve,AttrRecognizer:_e,Tap:we,Pan:be,Swipe:Ae,Pinch:xe,Rotate:Ee,Press:Se,on:A,off:w,each:g,merge:_,extend:y,assign:o,inherit:b,bindFn:x,prefixed:L}),("undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Hammer=Te,e.exports?e.exports=Te:t.Hammer=Te)}("undefined"!=typeof window?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document)})),zI=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),UI={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},jI=(kI=vw(),MI=dw(AT.IMapService),kI((LI=G((II=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"indragging",!1),V(I(e),"mapService",LI,I(e)),E(I(e),"hammertime",void 0),E(I(e),"lastClickTime",0),E(I(e),"lastClickXY",[-1,-1]),E(I(e),"clickTimer",void 0),E(I(e),"$containter",void 0),E(I(e),"onDrag",(function(t){var n=e.interactionEvent(t);n.type=UI[n.type],"dragging"===n.type?e.indragging=!0:e.indragging=!1,e.emit(zI.Drag,n)})),E(I(e),"onHammer",(function(t){t.srcEvent.stopPropagation();var n=e.interactionEvent(t);e.emit(zI.Hover,n)})),E(I(e),"onTouch",(function(t){var n=t.touches[0];e.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),E(I(e),"onHover",(function(t){var n=t.clientX,r=t.clientY,i=t.type,o=e.mapService.getMapContainer();if(o)if(Bd)n=n-o.left-0,r=r-o.top-0;else{var a=o.getBoundingClientRect(),s=a.top;n=n-a.left-o.clientLeft,r=r-s-o.clientTop}var u=e.mapService.containerToLngLat([n,r]);if("click"!==i)"touch"!==i?"click"!==i&&"dblclick"!==i&&e.emit(zI.Hover,{x:n,y:r,lngLat:u,type:i,target:t}):e.isDoubleTap(n,r,u);else{if(!Bd&&"ontouchstart"in document.documentElement==!0)return;e.isDoubleTap(n,r,u)}})),e}return S(n,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(zI.Hover)}},{key:"triggerHover",value:function(e){var t=e.x,n=e.y;this.emit(zI.Hover,{x:t,y:n})}},{key:"triggerSelect",value:function(e){this.emit(zI.Select,{featureId:e})}},{key:"triggerActive",value:function(e){this.emit(zI.Active,{featureId:e})}},{key:"handleMiniEvent",value:function(e){this.onHover({clientX:e.touches[0].pageX,clientY:e.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e)if(Bd)Ud.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=new BI.Manager(e);t.add(new BI.Tap({event:"dblclick",taps:2})),t.add(new BI.Tap({event:"click"})),t.add(new BI.Pan({threshold:0,pointers:0})),t.add(new BI.Press({})),t.on("dblclick click",this.onHammer),t.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("mousemove",this.onHover),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=t}}},{key:"removeEventListenerOnMap",value:function(){if(Bd)Ud.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(e){var t,n,r=e.type;"touch"===e.pointerType?(n=Math.floor(e.pointers[0].clientY),t=Math.floor(e.pointers[0].clientX)):(n=Math.floor(e.srcEvent.y),t=Math.floor(e.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;t-=o.left,n-=a}return{x:t,y:n,lngLat:this.mapService.containerToLngLat([t,n]),type:r,target:e.srcEvent}}},{key:"isDoubleTap",value:function(e,t,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-e)<10&&Math.abs(this.lastClickXY[1]-t)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(zI.Hover,{x:e,y:t,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[e,t],this.clickTimer=setTimeout((function(){o="click",r.emit(zI.Hover,{x:e,y:t,lngLat:n,type:o})}),400))}}]),n}(K_)).prototype,"mapService",[MI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PI=II))||PI),VI=0;function GI(e){if(Bd)return null;var t=e;if("string"==typeof e&&(t=document.getElementById(e)),t){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(VI++),n.classList.add("l7-scene"),t.appendChild(n),n}return null}var HI,WI,YI,XI,ZI,qI,KI,QI,$I,JI,eL,tL,nL,rL,iL,oL,aL,sL,uL,cL,lL,hL,fL=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),pL=(HI=vw(),WI=dw(AT.IMapService),YI=dw(AT.IRendererService),XI=dw(AT.IGlobalConfigService),ZI=dw(AT.IInteractionService),qI=dw(AT.ILayerService),HI(($I=G((QI=function(){function e(){var t=this;b(this,e),E(this,"pickedColors",void 0),E(this,"pickedTileLayers",[]),V(this,"mapService",$I,this),V(this,"rendererService",JI,this),V(this,"configService",eL,this),V(this,"interactionService",tL,this),V(this,"layerService",nL,this),E(this,"pickingFBO",void 0),E(this,"width",0),E(this,"height",0),E(this,"alreadyInPicking",!1),E(this,"pickBufferScale",1),E(this,"pickFromPickingFBO",(function(e,n){var r=n.x,i=n.y,o=n.lngLat,a=n.type,s=n.target,u=!1,c=t.rendererService,l=c.readPixels,h=c.getContainer,f=t.getContainerSize(h()),p=f.width,d=f.height;p*=qm,d*=qm;var g=e.getLayerConfig(),m=g.enableHighlight,y=g.enableSelect,_=r*qm,b=i*qm;if(_>p-1*qm||_<0||b>d-1*qm||b<0)return!1;var x=l({x:Math.floor(_/t.pickBufferScale),y:Math.floor((d-(i+1)*qm)/t.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO});if(t.pickedColors=x,0!==x[0]||0!==x[1]||0!==x[2]){var S=Ov(x),E=e.layerPickService.getFeatureById(S);S!==e.getCurrentPickId()&&"mousemove"===a&&(a="mouseenter");var A={x:r,y:i,type:a,lngLat:o,featureId:S,feature:E,target:s};E&&(u=!0,e.setCurrentPickId(S),t.triggerHoverOnLayer(e,A))}else{var w={x:r,y:i,lngLat:o,type:null!==e.getCurrentPickId()&&"mousemove"===a?"mouseout":"un"+a,featureId:null,target:s,feature:null};t.triggerHoverOnLayer(e,v(v({},w),{},{type:"unpick"})),t.triggerHoverOnLayer(e,w),e.setCurrentPickId(null)}if(m&&e.layerPickService.highlightPickedFeature(x),y&&"click"===a&&(null==x?void 0:x.toString())!==[0,0,0,0].toString()){var T=Ov(x);null===e.getCurrentSelectedId()||T!==e.getCurrentSelectedId()?(e.layerPickService.selectFeature(x),e.setCurrentSelectedId(T)):(e.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),e.setCurrentSelectedId(null))}return u}))}var t,n,r;return S(e,[{key:"init",value:function(e){var t=this.rendererService,n=t.createTexture2D,r=t.createFramebuffer,i=t.getContainer,o=this.getContainerSize(i()),a=o.width,s=o.height;a*=qm,s*=qm,this.pickBufferScale=this.configService.getSceneConfig(e).pickBufferScale||1,this.pickingFBO=r({color:n({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale),wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE})}),this.interactionService.on(zI.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(r=_(g().mark((function e(t,n,r){var i,o,a,s=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels({ispick:!0}),t.hooks.afterPickingEncode.call();var e=s.pickBox(t,n);r(e)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"pickBox",value:function(e,t){var n=this,r=D(t.map((function(e){var t=e<0?0:e;return Math.floor(t*qm/n.pickBufferScale)})),4),i=r[0],o=r[1],a=r[2],s=r[3],u=this.rendererService,c=u.readPixels,l=u.getContainer,h=this.getContainerSize(l()),f=h.width,p=h.height;if(p*=qm,i>((f*=qm)-1)*qm/this.pickBufferScale||a<0||o>(p-1)*qm/this.pickBufferScale||s<0)return[];for(var d=Math.min(f/this.pickBufferScale,a)-i,g=Math.min(p/this.pickBufferScale,s)-o,m=c({x:i,y:Math.floor(p/this.pickBufferScale-(s+1)),width:d,height:g,data:new Uint8Array(d*g*4),framebuffer:this.pickingFBO}),y=[],_={},b=0;b<m.length/4;b+=1){var x=Ov(m.slice(4*b,4*b+4));if(-1!==x&&!_[x]){var S=e.layerPickService.getFeatureById(x);y.push(v(v({},S),{},{pickedFeatureIdx:x})),_[x]=!0}}return y}},{key:"handleCursor",value:function(e,t){var n=e.getLayerConfig(),r=n.cursor,i=void 0===r?"":r;if(n.cursorEnabled){var o="GAODE2.x"===this.mapService.version?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),a=null==o?void 0:o.style.getPropertyValue("cursor");"unmousemove"===t&&""!==a?null==o||o.style.setProperty("cursor",""):"mousemove"===t&&(null==o||o.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(e){return e.getContext?{width:e.width/qm,height:e.height/qm}:e.getBoundingClientRect()}},{key:"pickingAllLayer",value:(n=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layerService.needPick(t.type)&&this.isPickingAllLayer()){e.next=2;break}return e.abrupt("return");case 2:return this.alreadyInPicking=!0,e.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"isPickingAllLayer",value:function(){return!this.alreadyInPicking&&(!this.layerService.alreadyInRendering&&(!this.interactionService.indragging&&!!this.layerService.getShaderPickStat()))}},{key:"resizePickingFBO",value:function(){var e=this.rendererService.getContainer,t=this.getContainerSize(e()),n=t.width,r=t.height;n*=qm,r*=qm,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:(t=_(g().mark((function e(t){var n,r,i,o=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.rendererService,r=n.useFramebuffer,i=n.clear,this.resizePickingFBO(),r(this.pickingFBO,(function(){o.layerService.getRenderList().filter((function(e){return e.needPick(t.type)})).reverse().some((function(e){i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.layerPickService.pickRender(t);var n=o.pickFromPickingFBO(e,t);return o.layerService.pickedLayerId=n?+e.id:-1,n&&!e.getLayerConfig().enablePropagation}))}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(e,t){(function(e){var t,n=!0;if((null==e||null===(t=e.target)||void 0===t?void 0:t.target)instanceof HTMLElement)for(var r,i=null==e||null===(r=e.target)||void 0===r?void 0:r.target;i;){var o,a=Array.from(i.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){n=!1;break}i=null===(o=i)||void 0===o?void 0:o.parentElement}return n})(t)&&(this.handleCursor(e,t.type),e.emit(t.type,t))}}]),e}()).prototype,"mapService",[WI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JI=G(QI.prototype,"rendererService",[YI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eL=G(QI.prototype,"configService",[XI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tL=G(QI.prototype,"interactionService",[ZI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nL=G(QI.prototype,"layerService",[qI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KI=QI))||KI),dL=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];b(this,e),E(this,"autoStart",void 0),E(this,"startTime",0),E(this,"oldTime",0),E(this,"running",!1),E(this,"elapsedTime",0),this.autoStart=t}return S(e,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}(),vL=(rL=vw(),iL=dw(AT.IRendererService),oL=dw(AT.IMapService),aL=dw(AT.IDebugService),rL((cL=G((uL=function(e){A(u,e);var t,n,r,i,o,a,s=O(u);function u(){var e;b(this,u);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E(I(e=s.call.apply(s,[this].concat(n))),"pickedLayerId",-1),E(I(e),"clock",new dL),E(I(e),"alreadyInRendering",!1),E(I(e),"layers",[]),E(I(e),"layerList",[]),E(I(e),"layerRenderID",void 0),E(I(e),"sceneInited",!1),E(I(e),"animateInstanceCount",0),E(I(e),"shaderPicking",!0),E(I(e),"enableRender",!0),V(I(e),"renderService",cL,I(e)),V(I(e),"mapService",lL,I(e)),V(I(e),"debugService",hL,I(e)),E(I(e),"reRender",Mb((function(){e.renderLayers()}),32)),E(I(e),"throttleRenderLayers",Mb((function(){e.renderLayers()}),16)),e}return S(u,[{key:"needPick",value:function(e){return this.layerList.some((function(t){return t.needPick(e)}))}},{key:"add",value:function(e){var t=this;this.layers.push(e),this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"addMask",value:function(e){var t=this;this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"initLayers",value:(a=_(g().mark((function e(){var t=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var e=_(g().mark((function e(n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.startInit){e.next=4;break}return e.next=3,n.init();case 3:t.updateLayerRenderList();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayerByName",value:function(e){return this.layers.find((function(t){return t.name===e}))}},{key:"remove",value:(o=_(g().mark((function e(t,n){var r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?(r=n.layerChildren.indexOf(t))>-1&&n.layerChildren.splice(r,1):(i=this.layers.indexOf(t))>-1&&this.layers.splice(i,1),t.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"removeAllLayers",value:(i=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.destroy(),this.reRender();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setEnableRender",value:function(e){this.enableRender=e}},{key:"renderLayers",value:(r=_(g().mark((function e(){var t,n,r,i,o,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alreadyInRendering&&this.enableRender){e.next=2;break}return e.abrupt("return");case 2:this.updateLayerRenderList(),t=this.debugService.generateRenderUid(),this.debugService.renderStart(t),this.alreadyInRendering=!0,this.clear(),n=U(this.layerList),e.prev=8,n.s();case 10:if((r=n.n()).done){e.next=23;break}if(i=r.value,o=i.getLayerConfig(),a=o.enableMask,i.masks.filter((function(e){return e.inited})).length>0&&a&&this.renderMask(i.masks),!i.getLayerConfig().enableMultiPassRenderer){e.next=19;break}return e.next=17,i.renderMultiPass();case 17:e.next=21;break;case 19:return e.next=21,i.render();case 21:e.next=10;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(8),n.e(e.t0);case 28:return e.prev=28,n.f(),e.finish(28);case 31:this.debugService.renderEnd(t),this.alreadyInRendering=!1;case 33:case"end":return e.stop()}}),e,this,[[8,25,28,31]])}))),function(){return r.apply(this,arguments)})},{key:"renderMask",value:function(e){var t=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var n,r=e.length>1?oI.MULTIPLE:oI.SINGLE,i=U(e);try{for(i.s();!(n=i.n()).done;){n.value.render({isStencil:!0,stencilType:r,stencilIndex:t++})}}catch(e){i.e(e)}finally{i.f()}}},{key:"beforeRenderData",value:(n=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.hooks.beforeRenderData.promise();case 2:e.sent&&this.renderLayers();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"renderTileLayerMask",value:function(e){var t=0,n=e.getLayerConfig().enableMask,r=void 0===n||n,i=e.tileMask?1:0,o=e.masks.filter((function(e){return e.inited})),a=(i+=r?o.length:1)>1?oI.MULTIPLE:oI.SINGLE;if((e.tileMask||o.length&&r)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.length&&r){var s,u=U(o);try{for(u.s();!(s=u.n()).done;){s.value.render({isStencil:!0,stencilType:a,stencilIndex:t++})}}catch(e){u.e(e)}finally{u.f()}}e.tileMask&&e.tileMask.render({isStencil:!0,stencilType:a,stencilIndex:t++,stencilOperation:aI.OR})}},{key:"renderTileLayer",value:(t=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.renderTileLayerMask(t),!t.getLayerConfig().enableMultiPassRenderer){e.next=6;break}return e.next=4,t.renderMultiPass();case 4:e.next=8;break;case 6:return e.next=8,t.render();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var e=this;this.layerList=[],this.layers.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).sort((function(e,t){return e.zIndex-t.zIndex})).forEach((function(t){e.layerList.push(t)}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){e.destroy()})),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var e=Lv(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Ud.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Ud.cancelAnimationFrame(this.layerRenderID)}}]),u}(Q_)).prototype,"renderService",[iL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lL=G(uL.prototype,"mapService",[oL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hL=G(uL.prototype,"debugService",[aL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sL=uL))||sL),gL=tl.left,mL=!Fr&&Ee>79&&Ee<83||!Tn("reduce");ar({target:"Array",proto:!0,forced:mL},{reduce:function(e){var t=arguments.length;return gL(this,e,t,t>1?arguments[1]:void 0)}});var yL,_L,bL,xL,SL,EL,AL=function(e){return null==e},wL=function(){function e(t){var n=this;b(this,e),E(this,"name",void 0),E(this,"type",void 0),E(this,"scale",void 0),E(this,"descriptor",void 0),E(this,"featureBufferLayout",[]),E(this,"needRescale",!1),E(this,"needRemapping",!1),E(this,"needRegenerateVertices",!1),E(this,"featureRange",{startIndex:0,endIndex:1/0}),E(this,"vertexAttribute",void 0),E(this,"defaultCallback",(function(e){var t;return 0===e.length?(null===(t=n.scale)||void 0===t?void 0:t.defaultValues)||[]:e.map((function(e,t){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[t].func)(e)}))})),this.setProps(t)}return S(e,[{key:"setProps",value:function(e){Object.assign(this,e)}},{key:"mapping",value:function(e){var t;if(null!==(t=this.scale)&&void 0!==t&&t.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,F(e));if(!AL(r))return[r]}return this.defaultCallback(e)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),TL=["buffer","update","name"],CL=["buffer","update","name"],kL=(E(yL={},fL.FLOAT,4),E(yL,fL.UNSIGNED_BYTE,1),E(yL,fL.UNSIGNED_SHORT,2),yL),ML=(_L=vw(),bL=dw(AT.IRendererService),_L((EL=G((SL=function(){function e(){b(this,e),E(this,"attributesAndIndices",void 0),V(this,"rendererService",EL,this),E(this,"attributes",[]),E(this,"triangulation",void 0),E(this,"featureLayout",{sizePerElement:0,elements:[]})}return S(e,[{key:"registerStyleAttribute",value:function(e){var t=this.getLayerStyleAttribute(e.name||"");return t?t.setProps(e):(t=new wL(e),this.attributes.push(t)),t}},{key:"unRegisterStyleAttribute",value:function(e){var t=this.attributes.findIndex((function(t){return t.name===e}));t>-1&&this.attributes.splice(t,1)}},{key:"updateScaleAttribute",value:function(e){this.attributes.forEach((function(t){var n,r=t.name,i=null===(n=t.scale)||void 0===n?void 0:n.field;(e[r]||i&&e[i])&&(t.needRescale=!0,t.needRemapping=!0,t.needRegenerateVertices=!0)}))}},{key:"updateStyleAttribute",value:function(e,t,n){var r=this.getLayerStyleAttribute(e);r||(r=this.registerStyleAttribute(v(v({},t),{},{name:e})));var i=t.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(e){return this.attributes.find((function(t){return t.name===e}))}},{key:"getLayerAttributeScale",value:function(e){var t,n=this.getLayerStyleAttribute(e),r=null==n||null===(t=n.scale)||void 0===t?void 0:t.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.attributes.find((function(t){return t.name===e}));if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,c=a.size,l=void 0===c?0:c,h=kL[u.type||fL.FLOAT];if(s){var f=this.featureLayout,p=f.elements,d=f.sizePerElement,v=p.slice(n,r);if(!v.length)return;var g=v[0].offset,m=g*l*h,y=v.map((function(e,n){for(var r=e.featureIdx,i=e.vertices,o=e.normals,a=i.length/d,u=[],c=0;c<a;c++){var l=o?o.slice(3*c,3*c+3):[];u.push.apply(u,F(s(t[r],r,i.slice(c*d,c*d+d),n,l)))}return u})).reduce((function(e,t){return e.push.apply(e,F(t)),e}),[]);o.vertexAttribute.updateBuffer({data:y,offset:m}),null==i||i.emit("legend:".concat(e),{type:e,attr:o})}}}},{key:"createAttributesAndIndices",value:function(e,t,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var i=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),o=0,a=0,s=[],u=3;e.forEach((function(e,t){var c=r.triangulation(e,n),l=c.indices,h=c.vertices,f=c.normals,p=c.size,d=c.indexes,v=c.count;"number"==typeof v&&(a+=v),l.forEach((function(e){s.push(e+o)})),u=p;var g=h.length/p;r.featureLayout.sizePerElement=u,r.featureLayout.elements.push({featureIdx:t,vertices:h,normals:f,offset:o}),o+=g;for(var m=function(n){var r=(null==f?void 0:f.slice(3*n,3*n+3))||[],o=h.slice(n*p,n*p+p),a=0;d&&void 0!==d[n]&&(a=d[n]),i.forEach((function(i,s){var u;i&&i.update&&(u=i.buffer.data).push.apply(u,F(i.update(e,t,o,n,r,a)))}))},y=0;y<g;y++)m(y)}));var c=this.rendererService,l=c.createAttribute,h=c.createBuffer,f=c.createElements,p={};i.forEach((function(e,t){if(e){var n=e.buffer,i=(e.update,e.name,P(e,TL)),o=l(v({buffer:h(n)},i));p[e.name||""]=o,r.attributes[t].vertexAttribute=o}}));var d=f({data:s,type:fL.UNSIGNED_INT,count:s.length});return this.attributesAndIndices={attributes:p,elements:d,count:a},this.attributesAndIndices}},{key:"createAttributes",value:function(e,t){var n=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var r=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),i=0,o=3;e.forEach((function(e,t){var a=n.triangulation(e),s=a.indices,u=a.vertices,c=a.normals,l=a.size,h=a.indexes;s.forEach((function(e){})),o=l;var f=u.length/l;n.featureLayout.sizePerElement=o,n.featureLayout.elements.push({featureIdx:t,vertices:u,normals:c,offset:i}),i+=f;for(var p=function(n){var i=(null==c?void 0:c.slice(3*n,3*n+3))||[],o=u.slice(n*l,n*l+l),a=0;h&&void 0!==h[n]&&(a=h[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,F(r.update(e,t,o,n,i,a)))}))},d=0;d<f;d++)p(d)}));var a=this.rendererService,s=a.createAttribute,u=a.createBuffer,c={};return r.forEach((function(e,t){if(e){var r=e.buffer,i=(e.update,e.name,P(e,CL)),o=s(v({buffer:u(r)},i));c[e.name||""]=o,n.attributes[t].vertexAttribute=o}})),{attributes:c}}},{key:"clearAllAttributes",value:function(){var e;this.attributes.forEach((function(e){e.vertexAttribute&&e.vertexAttribute.destroy()})),null===(e=this.attributesAndIndices)||void 0===e||e.elements.destroy(),this.attributes=[]}}]),e}()).prototype,"rendererService",[bL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xL=SL))||xL);function PL(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function IL(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function LL(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function OL(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function RL(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var NL={exports:{}},DL={exports:{}},FL={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default}(FL,FL.exports);var BL={},zL={exports:{}},UL={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default}(UL,UL.exports);var jL={};Object.defineProperty(jL,"__esModule",{value:!0}),jL.fallback=YL,jL.wrap=XL;var VL,GL=jL.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,HL=jL.hasSetImmediate="function"==typeof setImmediate&&setImmediate,WL=jL.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function YL(e){setTimeout(e,0)}function XL(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e((function(){return t.apply(void 0,n)}))}}VL=GL?queueMicrotask:HL?setImmediate:WL?process.nextTick:YL,jL.default=XL(VL),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,i.isAsync)(e))return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop(),i=e.apply(this,t);return a(i,r)};return(0,n.default)((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return a(r,n);n(null,r)}))};var n=o(UL.exports),r=o(jL),i=BL;function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.then((function(e){s(t,null,e)}),(function(e){s(t,e&&e.message?e:new Error(e))}))}function s(e,t,n){try{e(t,n)}catch(e){(0,r.default)((function(e){throw e}),e)}}e.exports=t.default}(zL,zL.exports),Object.defineProperty(BL,"__esModule",{value:!0}),BL.isAsyncIterable=BL.isAsyncGenerator=BL.isAsync=void 0;var ZL,qL=(ZL=zL.exports)&&ZL.__esModule?ZL:{default:ZL};function KL(e){return"AsyncFunction"===e[Symbol.toStringTag]}BL.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return KL(e)?(0,qL.default)(e):e},BL.isAsync=KL,BL.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},BL.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]};var QL={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t=e.length);if(!t)throw new Error("arity is undefined");return function(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[t-1]?e.apply(this,r):new Promise((function(i,o){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return o(e);i(t.length>1?t:t[0])},e.apply(n,r)}))}},e.exports=t.default}(QL,QL.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(FL.exports),r=o(BL),i=o(QL.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i){var o=(0,n.default)(t)?[]:{};e(t,(function(e,t,n){(0,r.default)(e)((function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[t]=r,n(e)}))}),(function(e){return i(e,o)}))}),3),e.exports=t.default}(DL,DL.exports);var $L={exports:{}},JL={exports:{}},eO={exports:{}},tO={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default}(tO,tO.exports);var nO={exports:{}},rO={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default}(rO,rO.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t=(0,r.default)(e);return t?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(t):function(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function i(){var o=t[++n];return"__proto__"===o?i():n<r?{value:e[o],key:o}:null}}(e)};var n=i(FL.exports),r=i(rO.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(nO,nO.exports);var iO={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default}(iO,iO.exports);var oO={exports:{}},aO={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={},e.exports=t.default}(aO,aO.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){var o=!1,a=!1,s=!1,u=0,c=0;function l(){u>=t||s||o||(s=!0,e.next().then((function(e){var t=e.value,n=e.done;if(!a&&!o){if(s=!1,n)return o=!0,void(u<=0&&i(null));u++,r(t,c,h),c++,l()}})).catch(f))}function h(e,t){if(u-=1,!a)return e?f(e):!1===e?(o=!0,void(a=!0)):t===n.default||o&&u<=0?(o=!0,i(null)):void l()}function f(e){a||(s=!1,o=!0,i(e))}l()};var n=function(e){return e&&e.__esModule?e:{default:e}}(aO.exports);e.exports=t.default}(oO,oO.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(tO.exports),r=u(nO.exports),i=u(iO.exports),o=BL,a=u(oO.exports),s=u(aO.exports);function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,u,c){if(c=(0,n.default)(c),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return c(null);if((0,o.isAsyncGenerator)(t))return(0,a.default)(t,e,u,c);if((0,o.isAsyncIterable)(t))return(0,a.default)(t[Symbol.asyncIterator](),e,u,c);var l=(0,r.default)(t),h=!1,f=!1,p=0,d=!1;function v(e,t){if(!f)if(p-=1,e)h=!0,c(e);else if(!1===e)h=!0,f=!0;else{if(t===s.default||h&&p<=0)return h=!0,c(null);d||g()}}function g(){for(d=!0;p<e&&!h;){var t=l();if(null===t)return h=!0,void(p<=0&&c(null));p+=1,u(t.value,t.key,(0,i.default)(v))}d=!1}g()}},e.exports=t.default}(eO,eO.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(eO.exports),r=o(BL),i=o(QL.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i,o){return(0,n.default)(t)(e,(0,r.default)(i),o)}),4),e.exports=t.default}(JL,JL.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(JL.exports),r=i(QL.exports);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default}($L,$L.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(r.default,e,t)};var n=i(DL.exports),r=i($L.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(NL,NL.exports);var sO=RL(NL.exports),uO=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,sO(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push((function(r){t.apply(void 0,OL([],LL(n.args),!1)),r(null,e)}))},e}(),cO={exports:{}},lO={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=c(FL.exports),r=c(aO.exports),i=c(JL.exports),o=c(tO.exports),a=c(iO.exports),s=c(BL),u=c(QL.exports);function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){n=(0,o.default)(n);var i=0,s=0,u=e.length,c=!1;function l(e,t){!1===e&&(c=!0),!0!==c&&(e?n(e):++s!==u&&t!==r.default||n(null))}for(0===u&&n(null);i<u;i++)t(e[i],i,(0,a.default)(l))}function h(e,t,n){return(0,i.default)(e,1/0,t,n)}t.default=(0,u.default)((function(e,t,r){return((0,n.default)(e)?l:h)(e,(0,s.default)(t),r)}),3),e.exports=t.default}(lO,lO.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,r.default)(n.default,e,t)};var n=i(lO.exports),r=i(DL.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(cO,cO.exports);var hO={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(tO.exports),r=a(iO.exports),i=a(BL),o=a(QL.exports);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)((function(e,t){if(t=(0,n.default)(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var o=0;function a(t){(0,i.default)(e[o++]).apply(void 0,t.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===e.length?t.apply(void 0,[n].concat(r)):void a(r)}a([])})),e.exports=t.default}(hO,hO.exports);var fO=RL(hO.exports),pO=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return sO(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push((function(n){n(t(),e)}))},e}(),dO=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,sO(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return PL(n,void 0,void 0,(function(){return IL(this,(function(n){switch(n.label){case 0:return[4,t.apply(void 0,OL([],LL(this.args),!1))];case 1:return n.sent(),r(null,e),[2]}}))}))}))},e}(),vO=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,sO(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return PL(n,void 0,void 0,(function(){var n;return IL(this,(function(i){switch(i.label){case 0:return[4,t.apply(void 0,OL([],LL(this.args),!1))];case 1:return n=i.sent(),r(n,e),[2]}}))}))}))},e}(),gO=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return fO(this.tasks)},e.prototype.tapPromise=function(e,t){0===this.tasks.length?this.tasks.push((function(e){t().then((function(t){e(null,t)}))})):this.tasks.push((function(e,n){t(e).then((function(e){n(null,e)}))}))},e}();function mO(e){var t=e.target||e.srcElement;t.__resizeRAF__&&cancelAnimationFrame(t.__resizeRAF__),t.__resizeRAF__=requestAnimationFrame((function(){var n=t.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(t){t.call(n,e)}))}))}var yO,_O,bO,xO,SO,EO,AO,wO,TO,CO,kO,MO,PO,IO,LO,OO,RO,NO,DO,FO,BO,zO,UO,jO,VO,GO,HO,WO,YO,XO,ZO,qO,KO,QO,$O,JO=function(e,t){var n,r=this.document,i=r.attachEvent;if("undefined"!=typeof navigator&&(n=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!e.__resizeListeners__)if(e.__resizeListeners__=[],i)e.__resizeTrigger__=e,e.attachEvent("onresize",mO);else{"static"===getComputedStyle(e).position&&(e.style.position="relative");var o=e.__resizeTrigger__=r.createElement("object");o.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),o.setAttribute("class","resize-sensor"),o.setAttribute("tabindex","-1"),o.setAttribute("title",""),o.__resizeElement__=e,o.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",mO)},o.type="text/html",n&&e.appendChild(o),o.data="about:blank",n||e.appendChild(o)}e.__resizeListeners__.push(t)},eR="undefined"==typeof window?JO:JO.bind(window),tR=function(e,t){var n=document.attachEvent,r=e.__resizeListeners__||[];if(t){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}else r=e.__resizeListeners__=[];if(!r.length){if(n)e.detachEvent("onresize",mO);else if(e.__resizeTrigger__){var o=e.__resizeTrigger__.contentDocument,a=o&&o.defaultView;a&&(a.removeEventListener("resize",mO),delete a.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}};eR.unbind=tR;var nR=(yO=vw(),_O=dw(AT.SceneID),bO=dw(AT.IIconService),xO=dw(AT.IFontService),SO=dw(AT.IControlService),EO=dw(AT.IGlobalConfigService),AO=dw(AT.IMapService),wO=dw(AT.ICoordinateSystemService),TO=dw(AT.IRendererService),CO=dw(AT.ILayerService),kO=dw(AT.IDebugService),MO=dw(AT.ICameraService),PO=dw(AT.IInteractionService),IO=dw(AT.IPickingService),LO=dw(AT.IShaderModuleService),OO=dw(AT.IMarkerService),RO=dw(AT.IPopupService),yO((FO=G((DO=function(e){A(i,e);var t,n,r=O(i);function i(){var e;return b(this,i),E(I(e=r.call(this)),"destroyed",!1),E(I(e),"loaded",!1),V(I(e),"id",FO,I(e)),V(I(e),"iconService",BO,I(e)),V(I(e),"fontService",zO,I(e)),V(I(e),"controlService",UO,I(e)),V(I(e),"configService",jO,I(e)),V(I(e),"map",VO,I(e)),V(I(e),"coordinateSystemService",GO,I(e)),V(I(e),"rendererService",HO,I(e)),V(I(e),"layerService",WO,I(e)),V(I(e),"debugService",YO,I(e)),V(I(e),"cameraService",XO,I(e)),V(I(e),"interactionService",ZO,I(e)),V(I(e),"pickingService",qO,I(e)),V(I(e),"shaderModuleService",KO,I(e)),V(I(e),"markerService",QO,I(e)),V(I(e),"popupService",$O,I(e)),E(I(e),"inited",!1),E(I(e),"initPromise",void 0),E(I(e),"rendering",!1),E(I(e),"$container",void 0),E(I(e),"canvas",void 0),E(I(e),"markerContainer",void 0),E(I(e),"hooks",void 0),E(I(e),"handleWindowResized",(function(){e.emit("resize"),e.$container&&(e.initContainer(),Xm(),e.coordinateSystemService.needRefresh=!0,e.render())})),E(I(e),"handleMapCameraChanged",(function(t){e.cameraService.update(t),e.render()})),e.hooks={init:new dO},e}return S(i,[{key:"init",value:function(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return t.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.debugService.log("map.mapInitStart",{type:t.map.version}),e.next=3,new Promise((function(e){t.map.onCameraChanged((function(n){t.cameraService.init(),t.cameraService.update(n),e()})),t.map.init()}));case 3:t.map.onCameraChanged(t.handleMapCameraChanged),t.map.addMarkerContainer(),t.markerService.addMarkers(),t.markerService.addMarkerLayers(),t.popupService.initPopup(),t.interactionService.init(),t.interactionService.on(zI.Drag,t.addSceneEvent.bind(t));case 10:case"end":return e.stop()}}),e)})))),this.hooks.init.tapPromise("initRenderer",_(g().mark((function n(){var r,i;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.map.getOverlayContainer(),t.$container=r||GI(t.configService.getSceneConfig(t.id).id||""),!t.$container){n.next=13;break}return t.canvas=Bm("canvas","",t.$container),t.setCanvas(),n.next=7,t.rendererService.init(t.canvas,t.configService.getSceneConfig(t.id),e.gl);case 7:t.registerContextLost(),t.initContainer(),eR(t.$container,t.handleWindowResized),Ud.matchMedia&&(null===(i=Ud.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===i||i.addListener(t.handleWindowResized)),n.next=14;break;case 13:console.error("å®¹å¨ id ä¸å­å¨");case 14:t.pickingService.init(t.id);case 15:case"end":return n.stop()}}),n)})))),this.render()}},{key:"registerContextLost",value:function(){var e=this,t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",(function(){return e.emit("webglcontextlost")}))}},{key:"initMiniScene",value:function(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return t.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){t.map.onCameraChanged((function(n){t.cameraService.init(),t.cameraService.update(n),"GAODE2.x"!==t.map.version&&e()})),t.map.initMiniMap()}));case 2:t.map.onCameraChanged(t.handleMapCameraChanged),t.interactionService.init(),t.interactionService.on(zI.Drag,t.addSceneEvent.bind(t));case 5:case"end":return e.stop()}}),e)})))),this.hooks.init.tapPromise("initRenderer",_(g().mark((function n(){var r;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.canvas,t.$container=r||null,!t.$container){n.next=7;break}return n.next=5,t.rendererService.init(e.canvas,t.configService.getSceneConfig(t.id),void 0);case 5:n.next=8;break;case 7:console.error("å®¹å¨ id ä¸å­å¨");case 8:t.pickingService.init(t.id);case 9:case"end":return n.stop()}}),n)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(e){this.layerService.sceneService=this,this.layerService.add(e)}},{key:"addMask",value:function(e){this.layerService.sceneService=this,this.layerService.addMask(e)}},{key:"render",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rendering&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.rendering=!0,this.inited){e.next=16;break}return e.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),e.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,e.next=20;break;case 16:return e.next=18,this.layerService.initLayers();case 18:return e.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addFontFace",value:function(e,t){this.fontService.addFontFace(e,t)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:(t=_(g().mark((function e(t){var n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null===(n=this.$container)||void 0===n?void 0:n.getElementsByTagName("canvas")[0],e.next=3,this.render();case 3:return i="jpg"===t?null==r?void 0:r.toDataURL("image/jpeg"):null==r?void 0:r.toDataURL("image/png"),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;null!==e&&(this.markerContainer=Bm("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var e,t,n=this;if(this.inited){var r;if(tR(this.$container,this.handleWindowResized),Ud.matchMedia)null===(r=Ud.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===r||r.removeListener(this.handleWindowResized);this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout((function(){var e;null===(e=n.$container)||void 0===e||e.removeChild(n.canvas),n.canvas=null,n.rendererService.destroy()})),null===(e=this.$container)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$container),this.emit("destroy")}else this.destroyed=!0}},{key:"initContainer",value:function(){var e,t,n=qm,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var e,t,n=qm,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),i}(Q_)).prototype,"id",[_O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BO=G(DO.prototype,"iconService",[bO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zO=G(DO.prototype,"fontService",[xO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UO=G(DO.prototype,"controlService",[SO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jO=G(DO.prototype,"configService",[EO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VO=G(DO.prototype,"map",[AO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GO=G(DO.prototype,"coordinateSystemService",[wO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HO=G(DO.prototype,"rendererService",[TO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WO=G(DO.prototype,"layerService",[CO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YO=G(DO.prototype,"debugService",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XO=G(DO.prototype,"cameraService",[MO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZO=G(DO.prototype,"interactionService",[PO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qO=G(DO.prototype,"pickingService",[IO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KO=G(DO.prototype,"shaderModuleService",[LO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QO=G(DO.prototype,"markerService",[OO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$O=G(DO.prototype,"popupService",[RO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NO=DO))||NO);var rR=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var iR=function(e){return this.__data__.has(e)};function oR(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new $M;++t<n;)this.add(e[t])}oR.prototype.add=oR.prototype.push=rR,oR.prototype.has=iR;var aR=oR;var sR=function(e,t){return!!(null==e?0:e.length)&&Rg(e,t,0)>-1};var uR=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1};var cR=function(e,t){return e.has(t)},lR=Ag($v,"Set");var hR=function(){};var fR=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},pR=lR&&1/fR(new lR([,-0]))[1]==1/0?function(e){return new lR(e)}:hR;var dR=function(e,t,n){var r=-1,i=sR,o=e.length,a=!0,s=[],u=s;if(n)a=!1,i=uR;else if(o>=200){var c=t?null:pR(e);if(c)return fR(c);a=!1,i=cR,u=new aR}else u=t?[]:s;e:for(;++r<o;){var l=e[r],h=t?t(l):l;if(l=n||0!==l?l:0,a&&h==h){for(var f=u.length;f--;)if(u[f]===h)continue e;t&&u.push(h),s.push(l)}else i(u,h,n)||(u!==s&&u.push(h),s.push(l))}return s};var vR=function(e){return e&&e.length?dR(e):[]};var gR=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function mR(e){var t={};return{content:e=e.replace(gR,(function(e,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(function(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}(n)).fill(0)}return t[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:t}}var yR,_R,bR,xR,SR,ER,AR,wR,TR,CR="#define PI 3.14159265359",kR=/precision\s+(high|low|medium)p\s+float/,MR=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,PR=/void\s+main\s*\([^)]*\)\s*\{\n?/,IR=vw()(yR=function(){function e(){b(this,e),E(this,"moduleCache",{}),E(this,"rawContentCache",{})}return S(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:CR,fs:CR}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\nvec2 unpack_float(float packedValue) {\nint packedIntValue = int(packedValue);\nint v0 = packedIntValue / 256;\nreturn vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(vec2 encodedColor) {\nreturn vec4(\nunpack_float(encodedColor[0]) / 255.0,\nunpack_float(encodedColor[1]) / 255.0\n);\n}",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n#define COORDINATE_SYSTEM_LNGLAT 1.0\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n#define COORDINATE_SYSTEM_P20_2 8.0\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\nvec2 project_mercator(vec2 lnglat) {\nfloat x = lnglat.x;\nreturn vec2(\nradians(x) + PI,\nPI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n);\n}\nfloat project_scale(float meters) {\nreturn meters * u_PixelsPerMeter.z;\n}\nvec4 project_offset(vec4 offset) {\nfloat dy = offset.y;\ndy = clamp(dy, -1., 1.);\nvec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\nreturn vec4(offset.xyz * pixels_per_unit, offset.w);\n}\nvec3 project_normal(vec3 normal) {\nvec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\nreturn normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\nvec3 project_offset_normal(vec3 vector) {\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n|| u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn normalize(vector * u_PixelsPerDegree);\n}\nreturn project_normal(vector);\n}\nvec3 reverse_offset_normal(vec3 vector) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\nreturn vector * vec3(1.0, -1.0, 1.0);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn vector;\n}\nreturn vector;\n}\nvec4 project_mvt_offset_position(vec4 position) {\nfloat a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\nfloat b = COORDINATE_SYSTEM_P20_OFFSET;\nfloat c = COORDINATE_SYSTEM_LNGLAT;\nif (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn project_offset(vec4(0.0, 0.0, position.z, position.w));\n}\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\nreturn vec4(\nproject_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\nproject_scale(position.z),\nposition.w\n);\n}\nreturn position;\n}\nvec4 project_position(vec4 position) {\nfloat a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\nfloat b = COORDINATE_SYSTEM_P20_OFFSET;\nfloat c = COORDINATE_SYSTEM_LNGLAT;\nif (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n|| u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nfloat X = position.x - u_ViewportCenter.x;\nfloat Y = position.y - u_ViewportCenter.y;\nreturn project_offset(vec4(X, Y, position.z, position.w));\n}\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\nreturn vec4(\nproject_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\nproject_scale(position.z),\nposition.w\n);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nreturn vec4(\n(project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\nproject_scale(position.z),\nposition.w\n);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn vec4(\nposition.xy, \nproject_scale(position.z), \nposition.w);\n}\nreturn position;\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\nreturn offset * u_FocalDistance;\n}\nfloat project_pixel_allmap(float pixel) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn pixel * pow(2.0, u_Zoom);\n}\nreturn pixel * u_FocalDistance ;\n}\nfloat project_pixel_texture(float pixel) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn pixel * pow(0.5, u_Zoom) * u_FocalDistance ;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(0.5, u_Zoom)* u_FocalDistance ;\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nreturn pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;\n}\nreturn pixel * 2.0 *  u_FocalDistance;;\n}\nfloat project_float_pixel(float pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n}\nreturn pixel * u_FocalDistance;\n}\nfloat project_pixel(float pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n}\nreturn pixel * u_FocalDistance;\n}\nvec2 project_pixel(vec2 pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n}\nreturn pixel * -1. * u_FocalDistance;\n}\nvec3 project_pixel(vec3 pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;\n}\nreturn pixel * -1. * u_FocalDistance;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\nu_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nposition.w *= u_PixelsPerMeter.z;\n}\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(\nposition,\nu_ViewProjectionMatrix,\nu_ViewportCenterProjection\n);\n}\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\nvec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\nif (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\nu_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\npos.w = pos.w / u_PixelsPerMeter.z;\n}\nreturn pos;\n}\nbool isEqual( float a,  float b) {\nreturn  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\nfloat maxs=85.0511287798;\nfloat lat=max(min(maxs,lnglat.y),-maxs);\nfloat scale= 268435456.;\nfloat d=PI/180.;\nfloat x=lnglat.x*d;\nfloat y=lat*d;\ny=log(tan((PI/4.)+(y/2.)));\nfloat a=.5/PI,\nb=.5,\nc=-.5/PI;\nd=.5;\nx=scale*(a*x+b);\ny=scale*(c*y+d);\nreturn vec2(x,y);\n}\nvec2 unProjectFlat(vec2 px){\nfloat a=.5/PI;\nfloat b=.5;\nfloat c=-.5/PI;\nfloat d=.5;\nfloat scale = 268435456.;\nfloat x=(px.x/scale-b)/a;\nfloat y=(px.y/scale-d)/c;\ny=(atan(pow(E,y))-(PI/4.))*2.;\nd=PI/180.;\nfloat lat=y/d;\nfloat lng=x/d;\nreturn vec2(lng,lat);\n}\nfloat pixelDistance(vec2 from, vec2 to) {\nvec2 a1 = ProjectFlat(from);\nvec2 b1 = ProjectFlat(to);\nreturn distance(a1, b1);\n}\nvec2 customProject(vec2 lnglat) {\nfloat t = lnglat.x;\nfloat e = lnglat.y;\nfloat Sm = 180.0 / PI;\nfloat Tm = 6378137.0;\nfloat Rm = PI / 180.0;\nfloat r = 85.0511287798;\ne = max(min(r, e), -r);\nt *= Rm;\ne *= Rm;\ne = log(tan(PI / 4.0 + e / 2.0));\nreturn vec2(t * Tm, e * Tm);\n}\nvec2 unProjCustomCoord(vec2 point) {\nfloat Sm = 57.29577951308232;\nfloat Tm = 6378137.0;\nfloat t = point.x;\nfloat e = point.y;\nreturn vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\nfloat customPixelDistance(vec2 from, vec2 to) {\nvec2 a1 = ProjectFlat(from);\nvec2 b1 = ProjectFlat(to);\nreturn distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\nfloat sdCircle(vec2 p, float r) {\nreturn length(p) - r;\n}\nfloat sdEquilateralTriangle(vec2 p) {\nfloat k = sqrt(3.0);\np.x = abs(p.x) - 1.0;\np.y = p.y + 1.0/k;\nif( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\np.x -= clamp( p.x, -2.0, 0.0 );\nreturn -length(p)*sign(p.y);\n}\nfloat sdBox(vec2 p, vec2 b) {\nvec2 d = abs(p)-b;\nreturn length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\nfloat sdPentagon(vec2 p, float r) {\nvec3 k = vec3(0.809016994,0.587785252,0.726542528);\np.x = abs(p.x);\np -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\np -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\np -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\nreturn length(p)*sign(p.y);\n}\nfloat sdHexagon(vec2 p, float r) {\nvec3 k = vec3(-0.866025404,0.5,0.577350269);\np = abs(p);\np -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\np -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\nreturn length(p)*sign(p.y);\n}\nfloat sdOctogon(vec2 p, float r) {\nvec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\np = abs(p);\np -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\np -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\np -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\nreturn length(p)*sign(p.y);\n}\nfloat sdHexagram(vec2 p, float r) {\nvec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\np = abs(p);\np -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\np -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\np -= vec2(clamp(p.x,r*k.z,r*k.w),r);\nreturn length(p)*sign(p.y);\n}\nfloat sdRhombus(vec2 p, vec2 b) {\nvec2 q = abs(p);\nfloat h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\nfloat d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\nreturn d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\nfloat sdVesica(vec2 p, float r, float d) {\np = abs(p);\nfloat b = sqrt(r*r-d*d);\nreturn ((p.y-b)*d>p.x*b)\n? length(p-vec2(0.0,b))\n: length(p-vec2(-d,0.0))-r;\n}"}),this.registerModule("lighting",{vs:"\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\nstruct DirectionalLight {\nvec3 direction;\nvec3 ambient;\nvec3 diffuse;\nvec3 specular;\n};\nstruct SpotLight {\nvec3 position;\nvec3 direction;\nvec3 ambient;\nvec3 diffuse;\nvec3 specular;\nfloat constant;\nfloat linear;\nfloat quadratic;\nfloat angle;\nfloat blur;\nfloat exponent;\n};\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\nvec3 lightDir = normalize(light.direction);\nfloat diff = max(dot(normal, lightDir), 0.0);\nvec3 halfwayDir = normalize(lightDir + viewDir);\nfloat spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\nvec3 ambient = light.ambient * u_Ambient;\nvec3 diffuse = light.diffuse * diff * u_Diffuse;\nvec3 specular = light.specular * spec * u_Specular;\nreturn ambient + diffuse + specular;\n}\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\nvec3 weight = vec3(0.0);\nfor (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\nif (i >= u_NumOfDirectionalLights) {\nbreak;\n}\nweight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n}\nreturn weight;\n}",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nfloat calc_lighting(vec4 pos) {\nvec3 worldPos = vec3(pos * u_ModelMatrix);\nvec3 worldNormal = a_Normal;\nvec3 viewDir = normalize(u_CameraPosition - worldPos);\nvec3 lightDir = normalize(vec3(1, -10.5, 12));\nvec3 halfDir = normalize(viewDir+lightDir);\nfloat lambert = dot(worldNormal, lightDir);\nfloat specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\nfloat lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\nreturn lightWeight;\n}",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec3 u_CurrentSelectedId : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\nuniform float u_shaderPick;\nuniform float u_EnableSelect: 0.0;\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\nbool isVertexPicked(vec3 vertexColor) {\nreturn\nabs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\nabs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\nabs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\nbool isVertexSelected(vec3 vertexColor) {\nreturn\nabs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&\nabs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&\nabs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;\n}\nvoid setPickingColor(vec3 pickingColor) {\nif(u_shaderPick < 0.5) {\nreturn;\n}\nv_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\nv_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nfloat setPickingSize(float x) {\nreturn u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\nfloat setPickingOrder(float z) {\nbool selected = bool(v_PickingResult.a);\nreturn selected ? z + 1. : 0.;\n}",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_shaderPick;\nuniform float u_activeMix: 0;\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\nvec4 filterHighlightColor(vec4 color, float weight) {\nbool selected = bool(v_PickingResult.a);\nif (selected) {\nvec4 highLightColor = u_HighlightColor * COLOR_SCALE;\nfloat highLightAlpha = highLightColor.a;\nfloat highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\nvec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\nreturn vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n} else {\nreturn color;\n}\n}\nvec4 filterPickingColor(vec4 color) {\nvec3 pickingColor = v_PickingResult.rgb;\nif (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\ndiscard;\n}\nreturn u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\nvec4 filterColor(vec4 color) {\nif(u_shaderPick < 0.5) {\nreturn color;\n} else {\nreturn filterPickingColor(filterHighlightColor(color, 1.0));\n}\n}\nvec4 filterColorAlpha(vec4 color, float alpha) {\nif(u_shaderPick < 0.5) {\nreturn color;\n} else {\nreturn filterPickingColor(filterHighlightColor(color, alpha));\n}\n}"}),this.registerModule("commom_attr_vert",{vs:"#ifdef USE_ATTRIBUTE_OPACITY\nattribute float a_Opacity;\n#endif\n#ifdef USE_ATTRIBUTE_OFFSETS\nattribute vec2 a_Offsets;\n#endif\n#ifdef USE_ATTRIBUTE_STROKE\nattribute vec4 a_Stroke;\n#endif",fs:""}),this.registerModule("opacity_attr_vert",{vs:"float opacity = u_opacity;\n#ifdef USE_ATTRIBUTE_OPACITY\nopacity = a_Opacity;\n#endif",fs:""})}},{key:"registerModule",value:function(e,t){var n=t.vs,r=t.fs,i=t.uniforms,o=t.inject,a=mR(n),s=a.content,u=a.uniforms,c=mR(r),l=c.content,h=c.uniforms;this.rawContentCache[e]={fs:l,inject:o,uniforms:v(v(v({},u),h),i),vs:s}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(e){var t=this,n=this.rawContentCache[e].vs,r=this.rawContentCache[e].fs,i=this.rawContentCache[e].inject,o={};null!=i&&i["vs:#decl"]&&(n=(null==i?void 0:i["vs:#decl"])+n,o=mR(null==i?void 0:i["vs:#decl"]).uniforms),null!=i&&i["vs:#main-start"]&&(n=n.replace(PR,(function(e){return e+(null==i?void 0:i["vs:#main-start"])})));var a=this.processModule(n,[],"vs"),s=a.content,u=a.includeList,c=this.processModule(r,[],"fs"),l=c.content,h=c.includeList,f="",p=vR(u.concat(h).concat(e)).reduce((function(e,n){return v(v({},e),t.rawContentCache[n].uniforms)}),v({},o));return kR.test(l)||(f+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"),f+=l,this.moduleCache[e]={fs:f.trim(),uniforms:p,vs:s.trim()},this.moduleCache[e]}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(MR,(function(e,i){var o=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return t.push(o),r.processModule(a,t,n).content})),includeList:t}}},{key:"injectDefines",value:function(e){return Object.keys(e).reduce((function(t,n){return t+"#define ".concat(n.toUpperCase()," ").concat(e[n],";\n")}),"\n")}}]),e}())||yR,LR=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),OR=vw()(_R=function(){function e(){b(this,e),E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"cameraService",void 0),E(this,"mapService",void 0),E(this,"interactionService",void 0),E(this,"layerService",void 0),E(this,"config",void 0)}return S(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return LR.Normal}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(AT.IRendererService),this.cameraService=e.getContainer().get(AT.ICameraService),this.mapService=e.getContainer().get(AT.IMapService),this.interactionService=e.getContainer().get(AT.IInteractionService),this.layerService=e.getContainer().get(AT.ILayerService),this.shaderModuleService=e.getContainer().get(AT.IShaderModuleService)}},{key:"render",value:function(e){}}]),e}())||_R,RR=vw()(bR=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,t){N(w(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(OR))||bR,NR=(xR=vw(),SR=dw(AT.IPostProcessor),xR((wR=G((AR=function(){function e(){b(this,e),E(this,"passes",[]),V(this,"postProcessor",wR,this),E(this,"layer",void 0),E(this,"renderFlag",void 0),E(this,"width",0),E(this,"height",0)}var t;return S(e,[{key:"setLayer",value:function(e){this.layer=e}},{key:"setRenderFlag",value:function(e){this.renderFlag=e}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(t=_(g().mark((function e(){var t,n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=U(this.passes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.render(this.layer);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:return e.next=19,this.postProcessor.render(this.layer);case 19:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.width===e&&this.height===t||(this.postProcessor.resize(e,t),this.width=e,this.height=t)}},{key:"add",value:function(e,t){e.getType()===LR.PostProcessing?this.postProcessor.add(e,this.layer,t):(e.init(this.layer,t),this.passes.push(e))}},{key:"insert",value:function(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}()).prototype,"postProcessor",[SR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ER=AR))||ER),DR=vw()(TR=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"pickingFBO",void 0),E(I(e),"layer",void 0),E(I(e),"width",0),E(I(e),"height",0),E(I(e),"alreadyInRendering",!1),E(I(e),"pickFromPickingFBO",(function(t){var n=t.x,r=t.y,i=t.lngLat,o=t.type;if(e.layer.isVisible()&&e.layer.needPick(o)){var a,s=e.rendererService,u=s.getViewportSize,c=s.readPixels,l=s.useFramebuffer,h=u(),f=h.width,p=h.height,d=e.layer.getLayerConfig(),g=d.enableHighlight,m=d.enableSelect,y=n*qm,_=r*qm;if(!(y>f||y<0||_>p||_<0))l(e.pickingFBO,(function(){var t;if(0!==(a=c({x:Math.round(y),y:Math.round(p-(r+1)*qm),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==a[1]||0!==a[2]){var s=Ov(a),u=e.layer.getSource().getFeatureById(s),l={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(e.layer.setCurrentPickId(s),e.triggerHoverOnLayer(l))}else{var h={x:n,y:r,lngLat:i,type:null===e.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(v(v({},h),{},{type:"unpick"})),e.triggerHoverOnLayer(h),e.layer.setCurrentPickId(null)}g&&e.highlightPickedFeature(a),m&&"click"===o&&(null===(t=a)||void 0===t?void 0:t.toString())!==[0,0,0,0].toString()&&e.selectFeature(a)}))}})),e}return S(n,[{key:"getType",value:function(){return LR.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(e,t){N(w(n.prototype),"init",this).call(this,e,t),this.layer=e;var r=this.rendererService,i=r.createTexture2D,o=r.createFramebuffer,a=(0,r.getViewportSize)(),s=a.width,u=a.height;this.pickingFBO=o({color:i({width:s,height:u,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE})}),this.interactionService.on(zI.Hover,this.pickFromPickingFBO),this.interactionService.on(zI.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(zI.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var t=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=t.layer.multiPassRenderer.getRenderFlag();t.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),t.layer.multiPassRenderer.setRenderFlag(n),t.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var t=D(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var t=D(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var t=Rv(e.featureId);this.selectFeature(new Uint8Array(t))}},{key:"highlightFeatureHandle",value:function(e){var t=Rv(e.featureId);this.highlightPickedFeature(new Uint8Array(t))}}]),n}(OR))||TR,FR="attribute vec2 a_Position;\nvarying vec2 v_UV;\nvoid main() {\nv_UV = 0.5 * (a_Position + 1.0);\ngl_Position = vec4(a_Position, 0., 1.);\n}";var BR=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o};var zR=function(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:BR(e,t,n)},UR=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var jR=function(e){return UR.test(e)};var VR=function(e){return e.split("")},GR="[\\ud800-\\udfff]",HR="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",WR="\\ud83c[\\udffb-\\udfff]",YR="[^\\ud800-\\udfff]",XR="(?:\\ud83c[\\udde6-\\uddff]){2}",ZR="[\\ud800-\\udbff][\\udc00-\\udfff]",qR="(?:"+HR+"|"+WR+")"+"?",KR="[\\ufe0e\\ufe0f]?"+qR+("(?:\\u200d(?:"+[YR,XR,ZR].join("|")+")[\\ufe0e\\ufe0f]?"+qR+")*"),QR="(?:"+[YR+HR+"?",HR,XR,ZR,GR].join("|")+")",$R=RegExp(WR+"(?="+WR+")|"+QR+KR,"g");var JR=function(e){return e.match($R)||[]};var eN=function(e){return jR(e)?JR(e):VR(e)},tN=Jv?Jv.prototype:void 0,nN=tN?tN.toString:void 0;var rN=function e(t){if("string"==typeof t)return t;if(xP(t))return Pg(t,e)+"";if(bb(t))return nN?nN.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};var iN=function(e){return null==e?"":rN(e)};var oN=function(e){return function(t){t=iN(t);var n=jR(t)?eN(t):void 0,r=n?n[0]:t.charAt(0),i=n?zR(n,1).join(""):t.slice(1);return r[e]()+i}}("toUpperCase");var aN=function(e){return oN(iN(e).toLowerCase())};var sN=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n};var uN=function(e){return function(t){return null==e?void 0:e[t]}}({"Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã":"C","Ã§":"c","Ã":"D","Ã°":"d","Ã":"E","Ã":"E","Ã":"E","Ã":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","Ã":"I","Ã":"I","Ã":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã":"N","Ã±":"n","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã":"U","Ã":"U","Ã":"U","Ã":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã":"Ae","Ã¦":"ae","Ã":"Th","Ã¾":"th","Ã":"ss","Ä":"A","Ä":"A","Ä":"A","Ä":"a","Ä":"a","Ä":"a","Ä":"C","Ä":"C","Ä":"C","Ä":"C","Ä":"c","Ä":"c","Ä":"c","Ä":"c","Ä":"D","Ä":"D","Ä":"d","Ä":"d","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"G","Ä":"G","Ä ":"G","Ä¢":"G","Ä":"g","Ä":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å":"l","Å":"l","Å":"N","Å":"N","Å":"N","Å":"N","Å":"n","Å":"n","Å":"n","Å":"n","Å":"O","Å":"O","Å":"O","Å":"o","Å":"o","Å":"o","Å":"R","Å":"R","Å":"R","Å":"r","Å":"r","Å":"r","Å":"S","Å":"S","Å":"S","Å ":"S","Å":"s","Å":"s","Å":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å":"Oe","Å":"oe","Å":"'n","Å¿":"s"}),cN=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,lN=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var hN=function(e){return(e=iN(e))&&e.replace(cN,uN).replace(lN,"")},fN=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var pN=function(e){return e.match(fN)||[]},dN=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var vN=function(e){return dN.test(e)},gN="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",mN="["+gN+"]",yN="\\d+",_N="[\\u2700-\\u27bf]",bN="[a-z\\xdf-\\xf6\\xf8-\\xff]",xN="[^\\ud800-\\udfff"+gN+yN+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",SN="(?:\\ud83c[\\udde6-\\uddff]){2}",EN="[\\ud800-\\udbff][\\udc00-\\udfff]",AN="[A-Z\\xc0-\\xd6\\xd8-\\xde]",wN="(?:"+bN+"|"+xN+")",TN="(?:"+AN+"|"+xN+")",CN="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",kN="[\\ufe0e\\ufe0f]?"+CN+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",SN,EN].join("|")+")[\\ufe0e\\ufe0f]?"+CN+")*"),MN="(?:"+[_N,SN,EN].join("|")+")"+kN,PN=RegExp([AN+"?"+bN+"+(?:['â](?:d|ll|m|re|s|t|ve))?(?="+[mN,AN,"$"].join("|")+")",TN+"+(?:['â](?:D|LL|M|RE|S|T|VE))?(?="+[mN,AN+wN,"$"].join("|")+")",AN+"?"+wN+"+(?:['â](?:d|ll|m|re|s|t|ve))?",AN+"+(?:['â](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",yN,MN].join("|"),"g");var IN=function(e){return e.match(PN)||[]};var LN=function(e,t,n){return e=iN(e),void 0===(t=n?void 0:t)?vN(e)?IN(e):pN(e):e.match(t)||[]},ON=RegExp("['â]","g");var RN,NN,DN,FN,BN,zN,UN,jN,VN,GN,HN,WN,YN,XN,ZN,qN,KN,QN,$N,JN,eD=function(e){return function(t){return sN(LN(hN(t).replace(ON,"")),e,"")}}((function(e,t,n){return t=t.toLowerCase(),e+(n?aN(t):t)})),tD=(RN=vw(),NN=dw(AT.IShaderModuleService),RN((BN=G((FN=function(){function e(){b(this,e),V(this,"shaderModuleService",BN,this),E(this,"rendererService",void 0),E(this,"config",void 0),E(this,"quad",FR),E(this,"enabled",!0),E(this,"renderToScreen",!1),E(this,"model",void 0),E(this,"name",void 0),E(this,"optionsToUpdate",{})}return S(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getType",value:function(){return LR.PostProcessing}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(AT.IRendererService),this.shaderModuleService=e.getContainer().get(AT.IShaderModuleService);var n=this.rendererService,r=n.createAttribute,i=n.createBuffer,o=n.createModel,a=this.setupShaders(),s=a.vs,u=a.fs,c=a.uniforms;this.model=o({vs:s,fs:u,attributes:{a_Position:r({buffer:i({data:[-4,-4,4,-4,0,4],type:fL.FLOAT}),size:2})},uniforms:v(v({u_Texture:null},c),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(e,t){var n=this,r=e.multiPassRenderer.getPostProcessor(),i=this.rendererService,o=i.useFramebuffer,a=i.getViewportSize,s=i.clear,u=a(),c=u.width,l=u.height;o(this.renderToScreen?null:r.getWriteFBO(),(function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var e=v({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[c,l]},n.convertOptionsToUniforms(n.optionsToUpdate));t&&(e.u_BloomFinal=1,e.u_Texture2=t),n.model.draw({uniforms:e})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"setRenderToScreen",value:function(e){this.renderToScreen=e}},{key:"updateOptions",value:function(e){this.optionsToUpdate=v(v({},this.optionsToUpdate),e)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Object.keys(e).forEach((function(n){AL(e[n])||(t["u_".concat(oN(eD(n)))]=e[n])})),t}}]),e}()).prototype,"shaderModuleService",[NN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DN=FN))||DN),nD=vw()(zN=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:FR,fs:"varying vec2 v_UV;\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\nvec4 color = vec4(0.0);\nvec2 off1 = vec2(1.3846153846) * direction;\nvec2 off2 = vec2(3.2307692308) * direction;\ncolor += texture2D(image, uv) * 0.2270270270;\ncolor += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\ncolor += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\nreturn color;\n}\nfloat luminance(vec4 color) {\nreturn  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\nvoid main() {\nfloat r = sqrt(u_radius);\nvec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\nvec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\nvec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\nvec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\nvec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\nif(u_BloomFinal > 0.0) {\nvec4 baseColor = texture2D(u_Texture2, v_UV);\nfloat baselum = luminance(baseColor);\ngl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\nif(baselum <= 0.2) {\ngl_FragColor = inbloomColor * u_intensity;\n}\n} else {\ngl_FragColor = inbloomColor;\n}\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return AL(e.bloomRadius)||(t.u_radius=e.bloomRadius),AL(e.bloomIntensity)||(t.u_intensity=e.bloomIntensity),AL(e.bloomBaseRadio)||(t.u_baseRadio=e.bloomBaseRadio),t}}]),n}(tD))||zN,rD="varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\nvec4 color = vec4(0.0);\nvec2 off1 = vec2(1.3846153846) * direction;\nvec2 off2 = vec2(3.2307692308) * direction;\ncolor += texture2D(image, uv) * 0.2270270270;\ncolor += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\ncolor += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\nreturn color;\n}\nvoid main() {\ngl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}",iD=vw()(UN=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:FR,fs:rD});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return AL(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}]),n}(tD))||UN,oD=vw()(jN=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:FR,fs:rD});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return AL(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}]),n}(tD))||jN,aD=vw()(VN=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:FR,fs:'varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n#pragma include "common"\nfloat scale = PI / u_Size;\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\nfloat s = sin(u_Angle), c = cos(u_Angle);\nvec2 tex = texCoord * texSize - u_Center * texSize;\nvec2 point = vec2(\nc * tex.x - s * tex.y,\ns * tex.x + c * tex.y\n) * scale;\nreturn (sin(point.x) * sin(point.y)) * 4.0;\n}\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\nvec3 cmy = 1.0 - color.rgb;\nfloat k = min(cmy.x, min(cmy.y, cmy.z));\ncmy = (cmy - k) / (1.0 - k);\ncmy = clamp(\ncmy * 10.0 - 3.0 + vec3(\npattern(u_Angle + 0.26179, texSize, texCoord),\npattern(u_Angle + 1.30899, texSize, texCoord),\npattern(u_Angle, texSize, texCoord)\n),\n0.0,\n1.0\n);\nk = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\nreturn vec4(1.0 - cmy - k, color.a);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var e=this.shaderModuleService.getModule("colorhalftone-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(tD))||VN,sD="varying vec2 v_UV;\nuniform sampler2D u_Texture;\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",uD=vw()(GN=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:FR,fs:sD}),this.shaderModuleService.getModule("copy-pass")}}]),n}(tD))||GN,cD=vw()(HN=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:FR,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\nvec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\ntex.y /= 0.866025404;\ntex.x -= tex.y * 0.5;\nvec2 a;\nif (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\na = vec2(floor(tex.x), floor(tex.y));\n}\nelse a = vec2(ceil(tex.x), ceil(tex.y));\nvec2 b = vec2(ceil(tex.x), floor(tex.y));\nvec2 c = vec2(floor(tex.x), ceil(tex.y));\nvec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\nvec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\nvec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\nvec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\nfloat alen = length(TEX - A);\nfloat blen = length(TEX - B);\nfloat clen = length(TEX - C);\nvec2 choice;\nif (alen < blen) {\nif (alen < clen) choice = a;\nelse choice = c;\n} else {\nif (blen < clen) choice = b;\nelse choice = c;\n}\nchoice.x += choice.y * 0.5;\nchoice.y *= 0.866025404;\nchoice *= u_Scale / texSize;\nreturn texture2D(texture, choice + u_Center);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(tD))||HN,lD=vw()(WN=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:FR,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\nvec2 dx = vec2(1.0 / texSize.x, 0.0);\nvec2 dy = vec2(0.0, 1.0 / texSize.y);\nvec4 color = texture2D(texture, texCoord);\nfloat bigTotal = 0.0;\nfloat smallTotal = 0.0;\nvec3 bigAverage = vec3(0.0);\nvec3 smallAverage = vec3(0.0);\nfor (float x = -2.0; x <= 2.0; x += 1.0) {\nfor (float y = -2.0; y <= 2.0; y += 1.0) {\nvec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\nbigAverage += sample;\nbigTotal += 1.0;\nif (abs(x) + abs(y) < 2.0) {\nsmallAverage += sample;\nsmallTotal += 1.0;\n}\n}\n}\nvec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\nfloat power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\nreturn vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("ink-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(tD))||WN,hD=vw()(YN=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:FR,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\nfloat rand(vec2 co) {\nreturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\nfloat diff = (rand(texCoord) - 0.5) * u_Amount;\ncolor.r += diff;\ncolor.g += diff;\ncolor.b += diff;\nreturn color;\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),n}(tD))||YN,fD=vw()(XN=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:FR,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\nvec4 sepia_filterColor(vec4 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\ncolor.r =\nmin(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\ncolor.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\ncolor.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\nreturn color;\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(tD))||XN,pD=Dn.f,dD=!Fe||te((function(){pD(1)}));ar({target:"Object",stat:!0,forced:dD,sham:!Fe},{getOwnPropertyDescriptor:function(e,t){return pD(Rn(e),t)}});var vD,gD,mD,yD,_D,bD,xD=(ZN=vw(),qN=dw(AT.IRendererService),KN=pw(),ZN((JN=G(($N=function(){function e(){b(this,e),V(this,"rendererService",JN,this),E(this,"passes",[]),E(this,"readFBO",void 0),E(this,"writeFBO",void 0)}var t,n;return S(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var e=this.rendererService,t=e.getViewportSize,n=e.createTexture2D,r=t();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var e=this,t=this.rendererService.useFramebuffer;return new Promise((function(n){t(e.readFBO,_(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e.getCurrentFBOTex());case 1:case"end":return t.stop()}}),t)}))))}))}},{key:"renderBloomPass",value:(n=_(g().mark((function e(t,n){var r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getReadFBOTex();case 2:r=e.sent,i=0;case 4:if(!(i<4)){e.next=11;break}return e.next=7,n.render(t,r);case 7:this.swap(),i++,e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"render",value:(t=_(g().mark((function e(t){var n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.passes.length)){e.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){e.next=9;break}return e.next=7,this.renderBloomPass(t,r);case 7:e.next=12;break;case 9:return e.next=11,r.render(t);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}},{key:"add",value:function(e,t,n){e.init(t,n),this.passes.push(e)}},{key:"insert",value:function(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}},{key:"getPostProcessingPassByName",value:function(e){return this.passes.find((function(t){return t.getName()===e}))}},{key:"init",value:function(){var e=this.rendererService,t=e.createFramebuffer,n=e.createTexture2D;this.readFBO=t({color:n({width:1,height:1,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE})}),this.writeFBO=t({color:n({width:1,height:1,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}},{key:"swap",value:function(){var e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}]),e}()).prototype,"rendererService",[qN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G($N.prototype,"init",[KN],Object.getOwnPropertyDescriptor($N.prototype,"init"),$N.prototype),QN=$N))||QN),SD=vw()(vD=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getType",value:function(){return LR.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,t){N(w(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(e){var t=this.rendererService,n=t.useFramebuffer,r=t.clear,i=e.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()})})),e.multiPassRenderer.setRenderFlag(!0)}))}}]),n}(OR))||vD;function ED(e,t){for(var n=0,r=1/t,i=e;i>0;)n+=r*(i%t),i=Math.floor(i/t),r/=t;return n}var AD=1,wD=(gD=vw(),mD=dw(AT.IShaderModuleService),gD((bD=G((_D=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return V(I(e=t.call.apply(t,[this].concat(i))),"shaderModuleService",bD,I(e)),E(I(e),"haltonSequence",[]),E(I(e),"accumulatingId",0),E(I(e),"frame",0),E(I(e),"timer",void 0),E(I(e),"sampleRenderTarget",void 0),E(I(e),"prevRenderTarget",void 0),E(I(e),"outputRenderTarget",void 0),E(I(e),"copyRenderTarget",void 0),E(I(e),"blendModel",void 0),E(I(e),"outputModel",void 0),E(I(e),"copyModel",void 0),e}return S(n,[{key:"getType",value:function(){return LR.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(e,t){N(w(n.prototype),"init",this).call(this,e,t);var r=this.rendererService,i=r.createFramebuffer,o=r.createTexture2D;this.sampleRenderTarget=i({color:o({width:1,height:1,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE})}),this.prevRenderTarget=i({color:o({width:1,height:1,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE})}),this.outputRenderTarget=i({color:o({width:1,height:1,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE})}),this.copyRenderTarget=i({color:o({width:1,height:1,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([ED(a,2),ED(a,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\nvarying vec2 v_UV;\nvoid main() {\nvec4 texel1 = texture2D(u_Diffuse1, v_UV);\nvec4 texel2 = texture2D(u_Diffuse2, v_UV);\ngl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}"),this.outputModel=this.createTriangleModel("copy-pass",sD,{blend:{enable:!0,func:{srcRGB:fL.ONE,dstRGB:fL.ONE_MINUS_SRC_ALPHA,srcAlpha:fL.ONE,dstAlpha:fL.ONE_MINUS_SRC_ALPHA},equation:{rgb:fL.FUNC_ADD,alpha:fL.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",sD)}},{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var c=e.multiPassRenderer.getPostProcessor().getReadFBO();o(c,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}));this.accumulatingId=AD++,this.timer=Ud.setTimeout((function(){!function n(r){t.accumulatingId&&r===t.accumulatingId&&(t.isFinished()||(t.doRender(e),Ud.requestAnimationFrame((function(){n(r)}))))}(t.accumulatingId)}),50)}},{key:"doRender",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,c=e.getLayerConfig().jitterScale,l=void 0===c?1:c,h=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*h[0]-1)/s*l,(2*h[1]-1)/u*l),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.sampleRenderTarget}),e.render()})),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var f=e.getLayerConfig();o(this.outputRenderTarget,(function(){t.blendModel.draw({uniforms:{u_opacity:f.opacity||1,u_MixRatio:0===t.frame?1:.9,u_Diffuse1:t.sampleRenderTarget,u_Diffuse2:0===t.frame?e.multiPassRenderer.getPostProcessor().getReadFBO():t.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){t.outputModel.draw({uniforms:{u_Texture:t.outputRenderTarget}})})),o(e.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){t.copyModel.draw({uniforms:{u_Texture:t.copyRenderTarget}})})),e.multiPassRenderer.getPostProcessor().render(e));var p=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=p,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Ud.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(e,t,n){this.shaderModuleService.registerModule(e,{vs:FR,fs:t});var r=this.shaderModuleService.getModule(e),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,c=s.createBuffer;return(0,s.createModel)(v({vs:i,fs:o,attributes:{a_Position:u({buffer:c({data:[-4,-4,4,-4,0,4],type:fL.FLOAT}),size:2})},uniforms:v({},a),depth:{enable:!1},count:3},n))}}]),n}(OR)).prototype,"shaderModuleService",[mD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yD=_D))||yD),TD=new gw;TD.bind(AT.IGlobalConfigService).to(hI).inSingletonScope(),fw(vw(),Q_),TD.bind(AT.IEventEmitter).to(Q_);var CD=yw(TD,!1),kD=function(e){var t=CD.lazyInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},MD=0;function PD(){var e=new gw;return e.parent=TD,e.bind(AT.SceneID).toConstantValue("".concat(MD++)),e.bind(AT.IShaderModuleService).to(IR).inSingletonScope(),e.bind(AT.ILayerService).to(vL).inSingletonScope(),e.bind(AT.IDebugService).to(FI).inSingletonScope(),e.bind(AT.ISceneService).to(nR).inSingletonScope(),e.bind(AT.ICameraService).to(cM).inSingletonScope(),e.bind(AT.ICoordinateSystemService).to(DI).inSingletonScope(),e.bind(AT.IInteractionService).to(jI).inSingletonScope(),e.bind(AT.IPickingService).to(pL).inSingletonScope(),e.bind(AT.IControlService).to(gM).inSingletonScope(),e.bind(AT.IMarkerService).to(mM).inSingletonScope(),e.bind(AT.IIconService).to(uM).inSingletonScope(),e.bind(AT.IFontService).to(FT).inSingletonScope(),e.bind(AT.IPopupService).to(yM).inSingletonScope(),e.bind(AT.INormalPass).to(RR).whenTargetNamed("clear"),e.bind(AT.INormalPass).to(DR).whenTargetNamed("pixelPicking"),e.bind(AT.INormalPass).to(SD).whenTargetNamed("render"),e.bind(AT.INormalPass).to(wD).whenTargetNamed("taa"),e.bind(AT.IFactoryNormalPass).toFactory((function(e){return function(t){return e.container.getNamed(AT.INormalPass,t)}})),e.bind(AT.IPostProcessingPass).to(uD).whenTargetNamed("copy"),e.bind(AT.IPostProcessingPass).to(nD).whenTargetNamed("bloom"),e.bind(AT.IPostProcessingPass).to(iD).whenTargetNamed("blurH"),e.bind(AT.IPostProcessingPass).to(oD).whenTargetNamed("blurV"),e.bind(AT.IPostProcessingPass).to(hD).whenTargetNamed("noise"),e.bind(AT.IPostProcessingPass).to(fD).whenTargetNamed("sepia"),e.bind(AT.IPostProcessingPass).to(aD).whenTargetNamed("colorHalftone"),e.bind(AT.IPostProcessingPass).to(cD).whenTargetNamed("hexagonalPixelate"),e.bind(AT.IPostProcessingPass).to(lD).whenTargetNamed("ink"),e.bind(AT.IFactoryPostProcessingPass).toFactory((function(e){return function(t){var n=e.container.getNamed(AT.IPostProcessingPass,t);return n.setName(t),n}})),e}function ID(e){var t=new gw;return t.parent=e,t.bind(AT.IStyleAttributeService).to(ML).inSingletonScope(),t.bind(AT.IMultiPassRenderer).to(NR).inSingletonScope(),t.bind(AT.IPostProcessor).to(xD).inSingletonScope(),t}var LD=function(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e};var OD=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=wb(n))==n?n:0),void 0!==t&&(t=(t=wb(t))==t?t:0),LD(wb(e),t,n)},RD=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function ND(e){return RD.indexOf(e)}function DD(e,t){return 256*(e=OD(Math.floor(e),0,255))+(t=OD(Math.floor(t),0,255))}var FD={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"};const BD={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"};var zD=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),UD=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),jD=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),VD=["mapload","mapchange","mapAfterFrameChange"],GD=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],HD=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),WD=Yu.ArrayBuffer,YD=K.ArrayBuffer;ar({global:!0,constructor:!0,forced:YD!==WD},{ArrayBuffer:WD}),Yr("ArrayBuffer");var XD=function(){var e=_(g().mark((function e(t,n,r,i){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){n({x:t.x,y:t.y,z:t.z},(function(t,n){t||0===n.length?o(t):n&&xA([{data:n,bands:[0]}],r,i,(function(t,n){t?o(t):n&&e(n)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),ZD=function(){var e=_(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n({x:t.x,y:t.y,z:t.z},(function(t,n){!t&&n?n instanceof ArrayBuffer?Jd(n,(function(t,n){t&&r(t),e(n)})):n instanceof HTMLImageElement?e(n):r(t):r(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function qD(e,t){return Array.isArray(e)?"string"==typeof e[0]?e.map((function(e){return Fb(e,t)})):e.map((function(e){return{url:Fb(e.url,t),bands:e.bands||[0]}})):Fb(e,t)}function KD(e,t){e.xhrCancel=function(){t.map((function(e){e.abort()}))}}var QD=function(){var e=_(g().mark((function e(t,n,r,i,o){var a,s,u,c,l,h;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=n.url,!((a="string"==typeof f?[{url:f,bands:[0]}]:"string"==typeof f[0]?f.map((function(e){return{url:e,bands:[0]}})):f).length>1)){e.next=15;break}return e.next=4,$D(a,n);case 4:if(s=e.sent,u=s.rasterFiles,c=s.xhrList,l=s.errList,KD(t,c),!(l.length>0)){e.next=12;break}return r(l,null),e.abrupt("return");case 12:xA(u,i,o,r),e.next=17;break;case 15:h=Zd(n,(function(e,t){if(e)r(e);else if(t){xA([{data:t,bands:a[0].bands}],i,o,r)}})),KD(t,[h]);case 17:case"end":return e.stop()}var f}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();function $D(e,t){return JD.apply(this,arguments)}function JD(){return(JD=_(g().mark((function e(t,n){var r,i,o,a,s,u,c,l,h,f,p;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<t.length)){e.next=20;break}return s=t[a],u=v(v({},n),{},{url:s.url}),c=s.bands,e.next=10,Wd(v(v({},u),{},{type:"arrayBuffer"}));case 10:l=e.sent,h=l.err,f=l.data,p=l.xhr,h&&o.push(h),i.push(p),r.push({data:f,bands:c});case 17:a++,e.next=4;break;case 20:return e.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var eF=function(){var e=_(g().mark((function e(t,n,r,i,o){var a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:qD(t,n)},e.abrupt("return",new Promise((function(e,t){QD(r,a,(function(n,r){n?t(n):r&&e(r)}),i,o)})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),tF=function(){var e=_(g().mark((function e(t,n,r,i){var o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.isArray(t)?t[0]:t,i.wmtsOptions?(s=(null==i?void 0:i.getURLFromTemplate)||Bb,o=s(a,v(v({},n),i.wmtsOptions))):(u=(null==i?void 0:i.getURLFromTemplate)||Fb,o=u(a,n)),e.abrupt("return",new Promise((function(e,t){var n,a=$d({url:o,type:(null==i||null===(n=i.requestParameters)||void 0===n?void 0:n.type)||"arrayBuffer"},(function(n,r){n?t(n):r&&e(r)}),i.transformResponse);r.xhrCancel=function(){return a.abort()}})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),nF=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},rF={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};HD.ARRAYBUFFER,HD.RGB;function iF(e){return!(!Array.isArray(e)||0!==e.length)||!Array.isArray(e)&&"string"!=typeof e}var oF=["extent","min","max","width","height","format","operation"];var aF={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},sF=function(){var e=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=D(t.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3];e({layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(r+o)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var uF=nI((function(e,t,n,r){JP(e,t,n,r)}));var cF=function(e){return"string"==typeof e||!xP(e)&&_b(e)&&"[object String]"==ug(e)};var lF=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},hF=hP(Object.keys,Object),fF=Object.prototype.hasOwnProperty;var pF=function(e){if(!dP(e))return hF(e);var t=[];for(var n in Object(e))fF.call(e,n)&&"constructor"!=n&&t.push(n);return t};var dF=function(e){return EP(e)?YP(e):pF(e)};var vF=function(e,t){return e&&jP(t,dF(t),e)};var gF=function(e,t){return e&&jP(t,KP(t),e)};var mF=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o};var yF=function(){return[]},_F=Object.prototype.propertyIsEnumerable,bF=Object.getOwnPropertySymbols,xF=bF?function(e){return null==e?[]:(e=Object(e),mF(bF(e),(function(t){return _F.call(e,t)})))}:yF;var SF=function(e,t){return jP(e,xF(e),t)};var EF=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},AF=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)EF(t,xF(e)),e=fP(e);return t}:yF;var wF=function(e,t){return jP(e,AF(e),t)};var TF=function(e,t,n){var r=t(e);return xP(e)?r:EF(r,n(e))};var CF=function(e){return TF(e,dF,xF)};var kF=function(e){return TF(e,KP,AF)},MF=Ag($v,"DataView"),PF=Ag($v,"Promise"),IF=Ag($v,"WeakMap"),LF=vg(MF),OF=vg(OM),RF=vg(PF),NF=vg(lR),DF=vg(IF),FF=ug;(MF&&"[object DataView]"!=FF(new MF(new ArrayBuffer(1)))||OM&&"[object Map]"!=FF(new OM)||PF&&"[object Promise]"!=FF(PF.resolve())||lR&&"[object Set]"!=FF(new lR)||IF&&"[object WeakMap]"!=FF(new IF))&&(FF=function(e){var t=ug(e),n="[object Object]"==t?e.constructor:void 0,r=n?vg(n):"";if(r)switch(r){case LF:return"[object DataView]";case OF:return"[object Map]";case RF:return"[object Promise]";case NF:return"[object Set]";case DF:return"[object WeakMap]"}return t});var BF=FF,zF=Object.prototype.hasOwnProperty;var UF=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&zF.call(e,"index")&&(n.index=e.index,n.input=e.input),n};var jF=function(e,t){var n=t?sP(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},VF=/\w*$/;var GF=function(e){var t=new e.constructor(e.source,VF.exec(e));return t.lastIndex=e.lastIndex,t},HF=Jv?Jv.prototype:void 0,WF=HF?HF.valueOf:void 0;var YF=function(e){return WF?Object(WF.call(e)):{}};var XF=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return sP(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return jF(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return uP(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return GF(e);case"[object Set]":return new r;case"[object Symbol]":return YF(e)}};var ZF=function(e){return _b(e)&&"[object Map]"==BF(e)},qF=NP&&NP.isMap,KF=qF?Dg(qF):ZF;var QF=function(e){return _b(e)&&"[object Set]"==BF(e)},$F=NP&&NP.isSet,JF=$F?Dg($F):QF,eB={};eB["[object Arguments]"]=eB["[object Array]"]=eB["[object ArrayBuffer]"]=eB["[object DataView]"]=eB["[object Boolean]"]=eB["[object Date]"]=eB["[object Float32Array]"]=eB["[object Float64Array]"]=eB["[object Int8Array]"]=eB["[object Int16Array]"]=eB["[object Int32Array]"]=eB["[object Map]"]=eB["[object Number]"]=eB["[object Object]"]=eB["[object RegExp]"]=eB["[object Set]"]=eB["[object String]"]=eB["[object Symbol]"]=eB["[object Uint8Array]"]=eB["[object Uint8ClampedArray]"]=eB["[object Uint16Array]"]=eB["[object Uint32Array]"]=!0,eB["[object Error]"]=eB["[object Function]"]=eB["[object WeakMap]"]=!1;var tB=function e(t,n,r,i,o,a){var s,u=1&n,c=2&n,l=4&n;if(r&&(s=o?r(t,i,o,a):r(t)),void 0!==s)return s;if(!cg(t))return t;var h=xP(t);if(h){if(s=UF(t),!u)return Fg(t,s)}else{var f=BF(t),p="[object Function]"==f||"[object GeneratorFunction]"==f;if(TP(t))return oP(t,u);if("[object Object]"==f||"[object Arguments]"==f||p&&!o){if(s=c||p?{}:vP(t),!u)return c?wF(t,gF(s,t)):SF(t,vF(s,t))}else{if(!eB[f])return o?t:{};s=XF(t,f,u)}}a||(a=new tP);var d=a.get(t);if(d)return d;a.set(t,s),JF(t)?t.forEach((function(i){s.add(e(i,n,r,i,t,a))})):KF(t)&&t.forEach((function(i,o){s.set(o,e(i,n,r,o,t,a))}));var v=h?void 0:(l?c?kF:CF:c?KP:dF)(t);return lF(v||t,(function(i,o){v&&(i=t[o=i]),UP(s,o,e(i,n,r,o,t,a))})),s};var nB=function(e){return tB(e,5)},rB=Y((function(e,t){e.exports=function(){function e(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;!function e(n,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,c=i-o+1,l=Math.log(u),h=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*h*(u-h)/u)*(c-u/2<0?-1:1),p=Math.max(o,Math.floor(i-c*h/u+f)),d=Math.min(a,Math.floor(i+(u-c)*h/u+f));e(n,r,i,p,d,s)}var v=r[2*i+s],g=o,m=a;for(t(n,r,o,i),r[2*a+s]>v&&t(n,r,o,a);g<m;){for(t(n,r,g,m),g++,m--;r[2*g+s]<v;)g++;for(;r[2*m+s]>v;)m--}r[2*o+s]===v?t(n,r,o,m):(m++,t(n,r,m,a)),m<=i&&(o=m+1),i<=m&&(a=m-1)}}(n,r,u,o,a,s%2),e(n,r,i,o,u-1,s+1),e(n,r,i,u+1,a,s+1)}}function t(e,t,r,i){n(e,r,i),n(t,2*r,2*i),n(t,2*r+1,2*i+1)}function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}var i=function(e){return e[0]},o=function(e){return e[1]},a=function(t,n,r,a,s){void 0===n&&(n=i),void 0===r&&(r=o),void 0===a&&(a=64),void 0===s&&(s=Float64Array),this.nodeSize=a,this.points=t;for(var u=t.length<65536?Uint16Array:Uint32Array,c=this.ids=new u(t.length),l=this.coords=new s(2*t.length),h=0;h<t.length;h++)c[h]=h,l[2*h]=n(t[h]),l[2*h+1]=r(t[h]);e(c,l,a,0,c.length-1,0)};a.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var s,u,c=[0,e.length-1,0],l=[];c.length;){var h=c.pop(),f=c.pop(),p=c.pop();if(f-p<=a)for(var d=p;d<=f;d++)s=t[2*d],u=t[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(e[d]);else{var v=Math.floor((p+f)/2);s=t[2*v],u=t[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(e[v]);var g=(h+1)%2;(0===h?n<=s:r<=u)&&(c.push(p),c.push(v-1),c.push(g)),(0===h?i>=s:o>=u)&&(c.push(v+1),c.push(f),c.push(g))}}return l}(this.ids,this.coords,e,t,n,r,this.nodeSize)},a.prototype.within=function(e,t,n){return function(e,t,n,i,o,a){for(var s=[0,e.length-1,0],u=[],c=o*o;s.length;){var l=s.pop(),h=s.pop(),f=s.pop();if(h-f<=a)for(var p=f;p<=h;p++)r(t[2*p],t[2*p+1],n,i)<=c&&u.push(e[p]);else{var d=Math.floor((f+h)/2),v=t[2*d],g=t[2*d+1];r(v,g,n,i)<=c&&u.push(e[d]);var m=(l+1)%2;(0===l?n-o<=v:i-o<=g)&&(s.push(f),s.push(d-1),s.push(m)),(0===l?n+o>=v:i+o>=g)&&(s.push(d+1),s.push(h),s.push(m))}}return u}(this.ids,this.coords,e,t,n,this.nodeSize)};var s={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},u=Math.fround||function(e){return function(t){return e[0]=+t,e[0]}}(new Float32Array(1)),c=function(e){this.options=g(Object.create(s),e),this.trees=new Array(this.options.maxZoom+1)};function l(e,t,n,r,i){return{x:u(e),y:u(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function h(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:u(d(r)),y:u(v(i)),zoom:1/0,index:t,parentId:-1}}function f(e){return{type:"Feature",id:e.id,properties:p(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function p(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return g(g({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function d(e){return e/360+.5}function v(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function g(e,t){for(var n in t)e[n]=t[n];return e}function m(e){return e.x}function y(e){return e.y}return c.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,o=t.nodeSize;n&&console.time("total time");var s="prepare "+e.length+" points";n&&console.time(s),this.points=e;for(var u=[],c=0;c<e.length;c++)e[c].geometry&&u.push(h(e[c],c));this.trees[i+1]=new a(u,m,y,o,Float32Array),n&&console.timeEnd(s);for(var l=i;l>=r;l--){var f=+Date.now();u=this._cluster(u,l),this.trees[l]=new a(u,m,y,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",l,u.length,+Date.now()-f)}return n&&console.timeEnd("total time"),this},c.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return a.concat(s)}for(var u=this.trees[this._limitZoom(t)],c=[],l=0,h=u.range(d(n),v(o),d(i),v(r));l<h.length;l+=1){var p=h[l],g=u.points[p];c.push(g.numPoints?f(g):this.points[g.index])}return c},c.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[t];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,c=i.within(o.x,o.y,a);u<c.length;u+=1){var l=c[u],h=i.points[l];h.parentId===e&&s.push(h.numPoints?f(h):this.points[h.index])}if(0===s.length)throw new Error(r);return s},c.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},c.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,c=(n+1+s)/i,l={features:[]};return this._addTileFeatures(r.range((t-s)/i,u,(t+1+s)/i,c),r.points,t,n,i,l),0===t&&this._addTileFeatures(r.range(1-s/i,u,1,c),r.points,i,n,i,l),t===i-1&&this._addTileFeatures(r.range(0,u,s/i,c),r.points,-1,n,i,l),l.features.length?l:null},c.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},c.prototype._appendLeaves=function(e,t,n,r,i){for(var o=0,a=this.getChildren(t);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},c.prototype._addTileFeatures=function(e,t,n,r,i,o){for(var a=0,s=e;a<s.length;a+=1){var u=t[s[a]],c=u.numPoints,l=void 0,h=void 0,f=void 0;if(c)l=p(u),h=u.x,f=u.y;else{var g=this.points[u.index];l=g.properties,h=d(g.geometry.coordinates[0]),f=v(g.geometry.coordinates[1])}var m={type:1,geometry:[[Math.round(this.options.extent*(h*i-n)),Math.round(this.options.extent*(f*i-r))]],tags:l},y=void 0;c?y=u.id:this.options.generateId?y=u.index:this.points[u.index].id&&(y=this.points[u.index].id),void 0!==y&&(m.id=y),o.features.push(m)}},c.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))},c.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,t)),c=0;c<e.length;c++){var h=e[c];if(!(h.zoom<=t)){h.zoom=t;for(var f=this.trees[t+1],p=f.within(h.x,h.y,u),d=h.numPoints||1,v=d,g=0,m=p;g<m.length;g+=1){var y=m[g],_=f.points[y];_.zoom>t&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var b=h.x*d,x=h.y*d,S=a&&d>1?this._map(h,!0):null,E=(c<<5)+(t+1)+this.points.length,A=0,w=p;A<w.length;A+=1){var T=w[A],C=f.points[T];if(!(C.zoom<=t)){C.zoom=t;var k=C.numPoints||1;b+=C.x*k,x+=C.y*k,C.parentId=E,a&&(S||(S=this._map(h,!0)),a(S,this._map(C)))}}h.parentId=E,n.push(l(b/v,x/v,E,v,S))}else if(n.push(h),v>1)for(var M=0,P=p;M<P.length;M+=1){var I=P[M],L=f.points[I];L.zoom<=t||(L.zoom=t,n.push(L))}}}return n},c.prototype._getOriginId=function(e){return e-this.points.length>>5},c.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},c.prototype._map=function(e,t){if(e.numPoints)return t?g({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?g({},r):r},c}()}));function iB(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,o=void 0===i?18:i,a=t.minZoom,s=void 0===a?0:a,u=t.zoom,c=void 0===u?2:u;if(e.pointIndex){var l=e.pointIndex.getClusters(e.extent,Math.floor(c));return e.dataArray=l.map((function(e,t){return v({coordinates:e.geometry.coordinates,_id:t+1},e.properties)})),e}var h=new rB({radius:r,minZoom:s,maxZoom:o}),f={type:"FeatureCollection",features:[]};return f.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:v({},e)}})),h.load(f.features),h}function oB(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}var aB={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return oB(e)/e.length},sum:oB};function sB(e,t){if(Array.isArray(t))return t}var uB=function(e){A(a,e);var t,r,o=O(a);function a(e,t){var n;return b(this,a),E(I(n=o.call(this)),"type","source"),E(I(n),"isTile",!1),E(I(n),"inited",!1),E(I(n),"data",void 0),E(I(n),"center",void 0),E(I(n),"extent",void 0),E(I(n),"hooks",{init:new uO}),E(I(n),"parser",{type:"geojson"}),E(I(n),"transforms",[]),E(I(n),"cluster",!1),E(I(n),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),E(I(n),"tileset",void 0),E(I(n),"invalidExtent",!1),E(I(n),"dataArrayChanged",!1),E(I(n),"originData",void 0),E(I(n),"rawData",void 0),E(I(n),"cfg",{autoRender:!0}),E(I(n),"clusterIndex",void 0),n.originData=e,n.initCfg(t),n.init().then((function(){n.inited=!0,n.emit("update",{type:"inited"})})),n}return S(a,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,o=void 0===r?"sum":r,a=n.field,s=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,s.forEach((function(e){e.id||(e.properties.point_count=1)})),(a||lg(o))&&(s=s.map((function(e){var n=e.id;if(n){var r,i=t.clusterIndex.getLeaves(n,1/0).map((function(e){return e.properties}));if(cF(o)&&a){var s=function(e,t){return e.map((function(e){return 1*e[t]}))}(i,a);r=aB[o](s)}lg(o)&&(r=o(i)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=i("geojson")({type:"FeatureCollection",features:s}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser,n=t.type,r=void 0===n?"geojson":n,i=t.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(t){return t._id===e})):e<this.data.dataArray.length?this.data.dataArray[e]:"null";var o=e<this.originData.features.length?this.originData.features[e]:"null",a=nB(o);if(null!=a&&a.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(t){return t._id===e}));a.properties=s}return a}},{key:"updateFeaturePropertiesById",value:function(e,t){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===e?v(v({},n),t):n})),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(n){return n[e]===t}));return null==n?void 0:n._id}},{key:"setData",value:function(e,t){var n=this;this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then((function(){n.emit("update",{type:"update"})}))}},{key:"reloadAllTile",value:function(){var e;null===(e=this.tileset)||void 0===e||e.reloadAll()}},{key:"reloadTilebyId",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileById(e,t,n)}},{key:"reloadTileByLnglat",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileByLnglat(e,t,n)}},{key:"getTileExtent",value:function(e,t){var n;return null===(n=this.tileset)||void 0===n?void 0:n.getTileExtent(e,t)}},{key:"getTileByZXY",value:function(e,t,n){var r;return null===(r=this.tileset)||void 0===r?void 0:r.getTileByZXY(e,t,n)}},{key:"reloadTileByExtent",value:function(e,t){var n;null===(n=this.tileset)||void 0===n||n.reloadTileByExtent(e,t)}},{key:"destroy",value:function(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(e=this.tileset)||void 0===e||e.destroy()}},{key:"processData",value:(r=_(g().mark((function e(){var t=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){try{t.excuteParser(),t.initCluster(),t.executeTrans(),e({})}catch(e){n(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"initCfg",value:function(e){this.cfg=uF(this.cfg,e,sB);var t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=v(v({},this.clusterOptions),t.clusterOptions)))}},{key:"init",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.inited=!1,e.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson",n=i(t);this.data=n(this.originData,e),this.tileset=this.initTileset(),e.cancelExtent||(this.extent=qy(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var e=this.data.tilesetOptions;if(e)return this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new Nb(v({},e))}},{key:"executeTrans",value:function(){var e=this;this.transforms.forEach((function(t){var r=function(e){return n[e]}(t.type)(e.data,t);Object.assign(e.data,r)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=iB(this.data,e)}}},{key:"caculClusterExtent",value:function(e){var t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=i_(a_(this.extent),e)),t[0].concat(t[1])}}]),a}(Q_);var cB=Math.PI/3,lB=[0,cB,2*cB,3*cB,4*cB,5*cB];function hB(e){return e[0]}function fB(e){return e[1]}o("rasterTile",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(iF(e))throw new Error("tile server url is error");var n=(null==t?void 0:t.dataType)||HD.IMAGE;n===HD.RGB&&(n=HD.ARRAYBUFFER);var r=function(r,i){switch(n){case HD.IMAGE:return tF(e,r,i,t);case HD.CUSTOMIMAGE:case HD.CUSTOMTERRAINRGB:return ZD(i,null==t?void 0:t.getCustomData);case HD.ARRAYBUFFER:return eF(e,r,i,(null==t?void 0:t.format)||nF,null==t?void 0:t.operation);case HD.CUSTOMARRAYBUFFER:case HD.CUSTOMRGB:return XD(i,null==t?void 0:t.getCustomData,(null==t?void 0:t.format)||nF,null==t?void 0:t.operation);default:return tF(e,r,i,t)}},i=v(v(v({},rF),t),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}})),o("mvt",(function(e,t){var n=Array.isArray(e)?e[0]:e,r=v(v(v({},uA),t),{},{getTileData:function(e,r){return cA(n,e,r,null==t?void 0:t.requestParameters,null==t?void 0:t.getCustomData)}});return{data:n,dataArray:[],tilesetOptions:r,isTile:!0}})),o("geojsonvt",(function(e,t){var n=function(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===e||void 0===e.geojsonvtOptions?t:v(v({},t),e.geojsonvtOptions)}(t),r=n.extent||4096,i=function(e,t){return new Ea(e,t)}(e,n);return{data:e,dataArray:[],tilesetOptions:v(v(v({},Ta),t),{},{getTileData:function(e,t){return Pa(t,i,e,r)}}),isTile:!0}})),o("testTile",(function(e,t){return{data:e,dataArray:[],tilesetOptions:v(v(v({},aF),t),{},{getTileData:function(e){return sF(e)}}),isTile:!0}})),o("geojson",(function(e,t){var n=[],r={};return e.features?(e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),hr(e,!0),0===e.features.length?{dataArray:[],featureKeys:r}:(Sr(e,(function(e,r){var i=function(e,t){return void 0===t?null:1*m(e.properties[t])==="number"?1*e.properties[t]:e.properties&&e.properties[t]?function(e){for(var t=e.toString(),n=5381,r=t.length;r;)n=33*n^t.charCodeAt(--r);return n>>>0}(e.properties[t]+"")%1000019:null}(e,null==t?void 0:t.featureId);null===i&&(i=r);var o=i,a=br(e),s=v(v({},e.properties),{},{coordinates:a,_id:o});n.push(s)})),{dataArray:n,featureKeys:r})):(e.features=[],{dataArray:[]})})),o("image",ME),o("csv",(function(e,t){return Er(p(e),t)})),o("json",Er),o("raster",(function(e,t){var n,r,i,o=t.extent,a=t.width,s=t.height,u=t.min,c=t.max,l=t.format,h=t.operation;return void 0===l||EA(e)?(n=Array.from(e),r=a,i=s):n=yA(Array.isArray(e)?e:[e],l,h),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:c,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]}}
/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */)),o("rasterRgb",(function(e,t){var n=t.extent,r=t.min,i=t.max,o=t.width,a=t.height,s=t.format,u=t.operation,c=P(t,oF);return{_id:1,dataArray:[v(v({_id:1,data:void 0===s||EA(e)?Array.from(e):yA(Array.isArray(e)?e:[e],s,u),width:o,height:a},c),{},{min:r,max:i,coordinates:[[n[0],n[1]],[n[2],n[3]]]})]}})),a("cluster",iB),a("filter",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e})),a("join",(function(e,t){var n=t.sourceField,r=t.targetField,i=t.data,o={};return i.forEach((function(e){o[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return v(v({},e),o[t])})),e})),a("map",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e})),a("grid",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=i/(2*Math.PI*6378e3)*(256<<20)/2,a=function(e,t){var n,r,i=1/0,o=-1/0,a=U(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;n=s.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(e){a.e(e)}finally{a.f()}var u=function(e,t){var n=(i=e,i/6378e3*(180/Math.PI)),r=function(e,t){return t/6378e3*(180/Math.PI)/Math.cos(e*Math.PI/180)}(t,e);var i;return{yOffset:n,xOffset:r}}(t,(i+o)/2);if(u.xOffset<=0||u.yOffset<=0)return{gridHash:{},gridOffset:u};var c,l={},h=U(e);try{for(h.s();!(c=h.n()).done;){var f=c.value,p=f.coordinates[1],d=f.coordinates[0];if(Number.isFinite(p)&&Number.isFinite(d)){var v=Math.floor((p+90)/u.yOffset),g=Math.floor((d+180)/u.xOffset),m="".concat(v,"-").concat(g);l[m]=l[m]||{count:0,points:[]},l[m].count+=1,l[m].points.push(f)}}}catch(e){h.e(e)}finally{h.f()}return{gridHash:l,gridOffset:u}}(n,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:function(e,t,n){return Object.keys(e).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),c={};if(n.field&&n.method){var l=U_(e[i].points,n.field);c[n.method]=z_[n.method](l)}return Object.assign(c,{_id:o,coordinates:e_([t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90]),rawData:e[i].points,count:e[i].count}),r.push(c),r}),[])}(a.gridHash,a.gridOffset,t)}})),a("hexagon",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=t.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(e){var t=D(e_(e.coordinates),2),n=t[0],r=t[1];return v(v({},e),{},{coordinates:[n,r]})}));return{dataArray:function(){var e,t,n,r=0,i=0,o=1,a=1,s=hB,u=fB;function c(e){var r,i={},o=[],a=e.length;for(r=0;r<a;++r)if(!isNaN(l=+s.call(null,c=e[r],r,e))&&!isNaN(h=+u.call(null,c,r,e))){var c,l,h,f=Math.round(h/=n),p=Math.round(l=l/t-(1&f)/2),d=h-f;if(3*Math.abs(d)>1){var v=l-p,g=p+(l<p?-1:1)/2,m=f+(h<f?-1:1),y=l-g,_=h-m;v*v+d*d>y*y+_*_&&(p=g+(1&f?1:-1)/2,f=m)}var b=p+"-"+f,x=i[b];x?x.push(c):(o.push(x=i[b]=[c]),x.x=(p+(1&f)/2)*t,x.y=f*n)}return o}function l(e){var t=0,n=0;return lB.map((function(r){var i=Math.sin(r)*e,o=-Math.cos(r)*e,a=i-t,s=o-n;return t=i,n=o,[a,s]}))}return c.hexagon=function(t){return"m"+l(null==t?e:+t).join("l")+"z"},c.centers=function(){for(var s=[],u=Math.round(i/n),c=Math.round(r/t),l=u*n;l<a+e;l+=n,++u)for(var h=c*t+(1&u)*t/2;h<o+t/2;h+=t)s.push([h,l]);return s},c.mesh=function(){var t=l(e).slice(0,4).join("l");return c.centers().map((function(e){return"M"+e+"m"+t})).join("")},c.x=function(e){return arguments.length?(s=e,c):s},c.y=function(e){return arguments.length?(u=e,c):u},c.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(cB),n=1.5*e,c):e},c.size=function(e){return arguments.length?(r=i=0,o=+e[0],a=+e[1],c):[o-r,a-i]},c.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1],c):[[r,i],[o,a]]},c.radius(1)}().radius(s).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]}))(u).map((function(e,n){var r;if(t.field&&a){var i=U_(e,t.field);e[a]=z_[a](i)}return E(r={},t.method,e[a]),E(r,"count",e.length),E(r,"rawData",e),E(r,"coordinates",[e.x,e.y]),E(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"}})),ar({target:"String",proto:!0,forced:Kx("anchor")},{anchor:function(e){return qx(this,"a","name",e)}});var pB=function(e){A(n,e);var t=O(n);function n(e){var r;return b(this,n),E(I(r=t.call(this)),"markerOption",void 0),E(I(r),"defaultMarker",void 0),E(I(r),"popup",void 0),E(I(r),"mapsService",void 0),E(I(r),"sceneSerive",void 0),E(I(r),"lngLat",void 0),E(I(r),"scene",void 0),E(I(r),"added",!1),E(I(r),"eventHandle",(function(e){r.polyfillEvent(e),r.emit(e.type,{target:e,data:r.markerOption.extData,lngLat:r.lngLat})})),E(I(r),"touchStartTime",void 0),r.markerOption=v(v({},r.getDefault()),e),py(["update","onMove","onMapClick"],I(r)),r.init(),r}return S(n,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:ev.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(AT.IMapService),this.sceneSerive=e.get(AT.ISceneService);var t=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&zm(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&zm(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),Ym(t,"".concat(tv[n]))}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var e=this.mapsService.getContainer();return{containerHeight:(null==e?void 0:e.scrollHeight)||0,containerWidth:(null==e?void 0:e.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,c=s.containerWidth,l=s.bounds;if(!l)return;if(Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(a.x>c){var h=this.mapsService.lngLatToContainer([i-360,o]);a.x=h.x}if(a.x<0){var f=this.mapsService.lngLatToContainer([i+360,o]);a.x=f.x}}(a.x>c||a.x<0||a.y>u||a.y<0)&&(t.style.display="none"),t.style.left=a.x+n[0]+"px",t.style.top=a.y-n[1]+"px"}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){this.defaultMarker=!0,t=Bm("div"),this.markerOption.element=t;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),t.appendChild(o)}Um(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=e.markerOption)||void 0===r?void 0:r.style)&&(null===(i=e.markerOption)||void 0===i?void 0:i.style[n]);t&&(t.style[n]=o)})),nv(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("click",this.onMapClick),e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle),e.addEventListener("touchstart",this.eventHandle),e.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("click",this.onMapClick),e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle),e.removeEventListener("touchstart",this.eventHandle),e.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(e){this.mapsService&&"GAODE2.x"===this.mapsService.version&&(fy()||("touchstart"===e.type&&(this.touchStartTime=Date.now()),"touchend"===e.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:e,data:this.markerOption.extData,lngLat:this.lngLat})))}},{key:"addDragHandler",value:function(e){return null}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),n}(Q_),dB=function(e){A(n,e);var t=O(n);function n(e){var r,i;return b(this,n),E(I(i=t.call(this)),"markers",[]),E(I(i),"markerLayerOption",void 0),E(I(i),"clusterIndex",void 0),E(I(i),"points",[]),E(I(i),"clusterMarkers",[]),E(I(i),"mapsService",void 0),E(I(i),"scene",void 0),E(I(i),"zoom",void 0),E(I(i),"bbox",void 0),E(I(i),"inited",void 0),E(I(i),"containerSize",void 0),i.markerLayerOption=rI(i.getDefault(),e),py(["update"],I(i)),i.zoom=(null===(r=i.markerLayerOption.clusterOption)||void 0===r?void 0:r.zoom)||-99,i}return S(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.get(AT.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(this.mapsService){var e=this.mapsService.getContainer();this.containerSize={containerWidth:(null==e?void 0:e.scrollWidth)||0,containerHeight:(null==e?void 0:e.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(e){var t=this.markerLayerOption.cluster;if(e.getMarkerLayerContainerSize=this.getContainerSize.bind(this),t&&(this.addPoint(e,this.markers.length),this.mapsService)){var n=this.mapsService.getZoom(),r=this.mapsService.getBounds();this.bbox=i_(r,.5),this.zoom=Math.floor(n),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"hide",value:function(){this.markers.map((function(e){e.getElement().style.opacity="0"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(e){e.getElement().style.opacity="1"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach((function(t){t.addTo(e.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(e){e.remove()})),this.clusterMarkers.forEach((function(e){e.remove()})),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(e,t){var n=e.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:v(v({},e.getExtData()),{},{marker_id:t})};this.points.push(r),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,t=e.radius,n=e.minZoom,r=void 0===n?0:n,i=e.maxZoom;this.clusterIndex=new rB({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,t){var n=this,r=e[0].concat(e[1]),i=this.clusterIndex.getClusters(r,t);this.clusterMarkers.forEach((function(e){e.remove()})),this.clusterMarkers=[],i.forEach((function(e){var t,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(null!==(t=e.properties)&&void 0!==t&&t.cluster_id){var a,s=n.getLeaves(null===(a=e.properties)||void 0===a?void 0:a.cluster_id);if(e.properties.clusterData=s,i&&o){var u=j_(o,U_(null==s?void 0:s.map((function(e){return E({},i,e.properties[i])})),i)),c="point_"+o;e.properties[c]=u.toFixed(2)}}var l=n.clusterMarker(e);n.clusterMarkers.push(l),l.addTo(n.scene)}))}},{key:"getLeaves",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,t,n):null}},{key:"clusterMarker",value:function(e){var t=this.markerLayerOption.clusterOption.element,n=void 0===t?this.generateElement.bind(this):t;return new pB({element:n(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]})}},{key:"normalMarker",value:function(e){var t=e.properties.marker_id;return this.markers[t]}},{key:"update",value:function(){if(this.mapsService&&0!==this.markers.length){var e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!o_(this.bbox,t))&&(this.bbox=i_(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(e){var t=Bm("div","l7-marker-cluster"),n=Bm("div","",t),r=Bm("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;e.properties.point_count=e.properties.point_count||1;var s=o&&a?e.properties["point_"+a]||e.properties[o]:e.properties.point_count;return r.textContent=s,t}}]),n}(Q_);function vB(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{var t,n=(t=(t=document.getElementsByTagName("script"))[t.length-1]).getAttribute("data-injectcss");if(!(t=t.getAttribute("data-disable-injectsvg"))){var r,i,o,a,s;if(n&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(t){console&&console.log(t)}}r=function(){var t,n=document.createElement("div");n.innerHTML=e._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",n=n,(t=document.body).firstChild?function(e,t){t.parentNode.insertBefore(e,t)}(n,t.firstChild):t.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),r()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=r,a=e.document,s=!1,function e(){try{a.documentElement.doScroll("left")}catch(t){return void setTimeout(e,50)}u()}(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,u())})}function u(){s||(s=!0,o())}}catch(e){}}(window);vB(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 1000;\n  box-sizing: border-box;\n}\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 800;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0 6px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  height: 24px;\n  line-height: 24px;\n  display: flex;\n  align-items: center;\n  padding: 0 16px;\n  font-size: 12px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  height: 14px;\n  width: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  padding: 12px 12px 0 12px;\n  width: 474px;\n  height: 320px;\n  overflow: auto;\n  display: flex;\n  flex-wrap: wrap;\n  box-sizing: border-box;\n  align-items: flex-start;\n}\n.l7-select-control--image .l7-select-control-item {\n  margin-right: 12px;\n  border-radius: 2px;\n  overflow: hidden;\n  border: 1px solid #fff;\n  box-sizing: content-box;\n  width: calc((100% - 36px) / 3);\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  margin-bottom: 12px;\n  position: relative;\n  font-size: 12px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 142px;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control--image .l7-select-control-item:nth-child(3n) {\n  margin-right: 0;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.l7-control-zoom .l7-button-control {\n  box-shadow: 0 0 0;\n  border-radius: 0;\n  font-size: 16px;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:first-child {\n  border-bottom: 1px solid #f0f0f0;\n}\n.l7-control-scale {\n  display: flex;\n  flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: flex;\n  align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: -webkit-flex;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  -webkit-flex-direction: column-reverse;\n  flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  -webkit-flex-direction: column;\n  flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  -webkit-flex-direction: row;\n  flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  -webkit-flex-direction: row-reverse;\n  flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  -webkit-align-self: center;\n  align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  -webkit-align-self: center;\n  align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n");var gB=function(e){A(n,e);var t=O(n);function n(e){var r;return b(this,n),E(I(r=t.call(this)),"controlOption",void 0),E(I(r),"container",void 0),E(I(r),"isShow",void 0),E(I(r),"sceneContainer",void 0),E(I(r),"scene",void 0),E(I(r),"mapsService",void 0),E(I(r),"renderService",void 0),E(I(r),"layerService",void 0),E(I(r),"controlService",void 0),E(I(r),"configService",void 0),n.controlCount++,r.controlOption=v(v({},r.getDefault(e)),e||{}),r}return S(n,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(e){var t=this.getDefault(e);Object.entries(e).forEach((function(n){var r=D(n,2),i=r[0];void 0===r[1]&&(e[i]=t[i])})),"position"in e&&this.setPosition(e.position),"className"in e&&this.setClassName(e.className),"style"in e&&this.setStyle(e.style),this.controlOption=v(v({},this.controlOption),e)}},{key:"addTo",value:function(e){this.mapsService=e.get(AT.IMapService),this.renderService=e.get(AT.IRendererService),this.layerService=e.get(AT.ILayerService),this.controlService=e.get(AT.IControlService),this.configService=e.get(AT.IGlobalConfigService),this.scene=e.get(AT.ISceneService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),Um(this.container,"l7-control");var t=this.controlOption,n=t.className,r=t.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;zm(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Bm("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){jm(this.container,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){Um(this.container,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(e){return{position:dM.TOPRIGHT,name:"".concat(n.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}},{key:"setPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dM.TOPLEFT,t=this.controlService;return t&&t.removeControl(this),this.controlOption.position=e,t&&t.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(e){var t=this.container,n=this.controlOption.className;n&&jm(t,n),e&&Um(t,e)}},{key:"setStyle",value:function(e){var t=this.container;e?t.setAttribute("style",e):t.removeAttribute("style")}},{key:"insertContainer",value:function(){var e=this.controlOption.position,t=this.container;if(e instanceof Element)e.appendChild(t);else{var n=this.controlService.controlCorners[e];["bottomleft","bottomright","righttop","rightbottom"].includes(e)?n.insertBefore(t,n.firstChild):n.appendChild(t)}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),n}(K_);E(gB,"controlCount",0);var mB=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"isDisable",!1),E(I(e),"button",void 0),E(I(e),"buttonText",void 0),E(I(e),"buttonIcon",void 0),e}return S(n,[{key:"setIsDisable",value:function(e){var t,n;(this.isDisable=e,e)?null===(t=this.button)||void 0===t||t.setAttribute("disabled","true"):null===(n=this.button)||void 0===n||n.removeAttribute("disabled")}},{key:"createButton",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Bm("button","l7-button-control ".concat(e))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var e=this.controlOption,t=e.title,n=e.btnText,r=e.btnIcon;return this.setBtnTitle(t),this.setBtnText(n),this.setBtnIcon(r),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(e){var t=e.title,r=e.btnText,i=e.btnIcon;this.checkUpdateOption(e,["title"])&&this.setBtnTitle(t),this.checkUpdateOption(e,["btnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(e,["btnText"])&&this.setBtnText(r),N(w(n.prototype),"setOptions",this).call(this,e)}},{key:"setBtnTitle",value:function(e){var t;null===(t=this.button)||void 0===t||t.setAttribute("title",null!=e?e:"")}},{key:"setBtnIcon",value:function(e){if(this.buttonIcon&&zm(this.buttonIcon),e){var t,n,r,i=null===(t=this.button)||void 0===t?void 0:t.firstChild;if(i)null===(n=this.button)||void 0===n||n.insertBefore(e,i);else null===(r=this.button)||void 0===r||r.appendChild(e);this.buttonIcon=e}}},{key:"setBtnText",value:function(e){if(this.button)if(jm(this.button,"l7-button-control--row"),jm(this.button,"l7-button-control--column"),e){var t,n=this.buttonText;if(!n)n=Bm("div","l7-button-control__text"),null===(t=this.button)||void 0===t||t.appendChild(n),this.buttonText=n;n.innerText=e,Um(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!e&&this.buttonText&&(zm(this.buttonText),this.buttonText=void 0)}}]),n}(gB),yB=function(e){A(n,e);var t=O(n);function n(e,r){var i;return b(this,n),E(I(i=t.call(this)),"popperDOM",void 0),E(I(i),"contentDOM",void 0),E(I(i),"button",void 0),E(I(i),"option",void 0),E(I(i),"isShow",!1),E(I(i),"content",void 0),E(I(i),"timeout",null),E(I(i),"show",(function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),jm(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&n.conflictPopperList.forEach((function(e){e!==I(i)&&e.isShow&&e.hide()})),i.emit("show")),I(i)})),E(I(i),"hide",(function(){return i.isShow?(Um(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide"),I(i)):I(i)})),E(I(i),"setHideTimeout",(function(){i.timeout||(i.timeout=window.setTimeout((function(){i.isShow&&(i.hide(),i.timeout=null)}),300))})),E(I(i),"clearHideTimeout",(function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)})),E(I(i),"onBtnClick",(function(){i.isShow?i.hide():i.show()})),E(I(i),"onBtnMouseLeave",(function(){i.setHideTimeout()})),E(I(i),"onBtnMouseMove",(function(){i.clearHideTimeout(),i.isShow||i.show()})),i.button=e,i.option=r,i.init(),r.unique&&n.conflictPopperList.push(I(i)),i}return S(n,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e){"string"==typeof e?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(ty(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}},{key:"init",value:function(){var e=this.option.trigger;this.popperDOM=this.createPopper(),"click"===e?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),zm(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var e={},t=this.option,n=t.container,r=t.offset,i=void 0===r?[0,0]:r,o=t.placement,a=D(i,2),s=a[0],u=a[1],c=this.button.getBoundingClientRect(),l=Jm(c,n.getBoundingClientRect()),h=l.left,f=l.right,p=l.top,d=l.bottom,v=!1,g=!1;/^(left|right)/.test(o)?(o.includes("left")?e.right="".concat(c.width+f,"px"):o.includes("right")&&(e.left="".concat(c.width+h,"px")),o.includes("start")?e.top="".concat(p,"px"):o.includes("end")?e.bottom="".concat(d,"px"):(e.top="".concat(p+c.height/2,"px"),g=!0,e.transform="translate(".concat(s,"px, calc(").concat(u,"px - 50%))"))):/^(top|bottom)/.test(o)&&(o.includes("top")?e.bottom="".concat(c.height+d,"px"):o.includes("bottom")&&(e.top="".concat(c.height+p,"px")),o.includes("start")?e.left="".concat(h,"px"):o.includes("end")?e.right="".concat(f,"px"):(e.left="".concat(h+c.width/2,"px"),v=!0,e.transform="translate(calc(".concat(s,"px - 50%), ").concat(u,"px)"))),e.transform="translate(calc(".concat(s,"px - ").concat(v?"50%":"0%","), calc(").concat(u,"px - ").concat(g?"50%":"0%",")");var m=o.split("-");m.length&&Um(this.popperDOM,m.map((function(e){return"l7-popper-".concat(e)})).join(" ")),Km(this.popperDOM,$m(e))}},{key:"createPopper",value:function(){var e=this.option,t=e.container,n=e.className,r=void 0===n?"":n,i=e.content,o=Bm("div","l7-popper l7-popper-hide ".concat(r)),a=Bm("div","l7-popper-content"),s=Bm("div","l7-popper-arrow");return o.appendChild(a),o.appendChild(s),t.appendChild(o),this.popperDOM=o,this.contentDOM=a,i&&this.setContent(i),o}}]),n}(Q_);E(yB,"conflictPopperList",[]);var _B={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},bB=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"popper",void 0),e}return S(n,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),N(w(n.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(e){var t,r=N(w(n.prototype),"getDefault",this).call(this,e),i=null!==(t=null==e?void 0:e.position)&&void 0!==t?t:r.position;return v(v({},N(w(n.prototype),"getDefault",this).call(this,e)),{},{popperPlacement:i instanceof Element?"bottom":_B[i],popperTrigger:"click"})}},{key:"onAdd",value:function(){var e=N(w(n.prototype),"onAdd",this).call(this);return this.initPopper(),e}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var e=this,t=this.controlOption,n=t.popperClassName,r=t.popperPlacement,i=t.popperTrigger,o=this.mapsService.getMapContainer();return this.popper=new yB(this.button,{className:n,placement:r,trigger:i,container:o,unique:!0}),this.popper.on("show",(function(){e.emit("popperShow",e)})).on("hide",(function(){e.emit("popperHide",e)})),this.popper}},{key:"setOptions",value:function(e){if(N(w(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["popperPlacement","popperTrigger","popperClassName"])){var t=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(t)}}}]),n}(mB),xB=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(xB||{}),SB=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"selectValue",[]),E(I(e),"optionDOMList",void 0),E(I(e),"createNormalOption",(function(t){var n=e.selectValue.includes(t.value),r=Bm("div","l7-select-control-item ".concat(n?xB.ActiveOptionClassName:""));e.getIsMultiple()&&r.appendChild(e.createCheckbox(n)),t.icon&&r.appendChild(t.icon);var i=Bm("span");return i.innerText=t.text,r.appendChild(i),r})),E(I(e),"onItemClick",(function(t){if(e.getIsMultiple()){var n=e.selectValue.findIndex((function(e){return e===t.value}));n>-1?e.selectValue.splice(n,1):e.selectValue=[].concat(F(e.selectValue),[t.value])}else e.selectValue=[t.value];e.setSelectValue(e.selectValue)})),e}return S(n,[{key:"setOptions",value:function(e){N(w(n.prototype),"setOptions",this).call(this,e);var t=e.options;t&&this.popper.setContent(this.getPopperContent(t))}},{key:"onAdd",value:function(){var e=N(w(n.prototype),"onAdd",this).call(this),t=this.controlOption.defaultValue;return t&&(this.selectValue=this.transSelectValue(t)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),e}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.transSelectValue(e);this.optionDOMList.forEach((function(e){var n=e.getAttribute(xB.OptionValueAttrKey),i=t.getIsMultiple()?e.querySelector("input[type=checkbox]"):void 0;r.includes(n)?(Um(e,xB.ActiveOptionClassName),i&&ey(i,!0)):(jm(e,xB.ActiveOptionClassName),i&&ey(i,!1))})),this.selectValue=r,n&&this.emit("selectChange",this.getIsMultiple()?r:r[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(e){var t=this,n=this.isImageOptions(),r=Bm("div",n?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Um(r,"l7-select-control--multiple");var i=e.map((function(e,r){var i=n?t.createImageOption(e):t.createNormalOption(e);return i.setAttribute(xB.OptionValueAttrKey,e.value),i.setAttribute(xB.OptionIndexAttrKey,window.String(r)),i.addEventListener("click",t.onItemClick.bind(t,e)),i}));return r.append.apply(r,F(i)),this.optionDOMList=i,r}},{key:"createImageOption",value:function(e){var t=this.selectValue.includes(e.value),n=Bm("div","l7-select-control-item ".concat(t?xB.ActiveOptionClassName:"")),r=Bm("img");r.setAttribute("src",e.img),ny(r),n.appendChild(r);var i=Bm("div","l7-select-control-item-row");this.getIsMultiple()&&n.appendChild(this.createCheckbox(t));var o=Bm("span");return o.innerText=e.text,i.appendChild(o),n.appendChild(i),n}},{key:"createCheckbox",value:function(e){var t=Bm("input");return t.setAttribute("type","checkbox"),e&&ey(t,!0),t}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find((function(e){return e.img}))}},{key:"transSelectValue",value:function(e){return Array.isArray(e)?e:[e]}}]),n}(bB),EB=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(e)),t.appendChild(n),t},AB=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"onClick",_(g().mark((function t(){var n;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(n=e.controlOption.onExport)){t.next=5;break}t.next=10;break;case 5:return t.t0=n,t.next=8,e.getImage();case 8:t.t1=t.sent,(0,t.t0)(t.t1);case 10:case"end":return t.stop()}}),t)})))),E(I(e),"mergeImage",_(g().mark((function t(){var n,r,i,o,a,s,u,c,l,h,f,p,d,v=arguments;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=e.controlOption.imageType,o=null!==(n=null===(r=e.mapsService.getContainer())||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},a=o.width,s=void 0===a?0:a,u=o.height,c=void 0===u?0:u,(l=document.createElement("canvas")).width=s,l.height=c,h=l.getContext("2d"),f=v.length,p=new Array(f),d=0;d<f;d++)p[d]=v[d];return t.next=9,Promise.all(p.map((function(e){return new Promise((function(t){var n=new Image;n.onload=function(){t(n)},n.src=e}))})));case 9:return t.sent.forEach((function(e){null==h||h.drawImage(e,0,0,s,c)})),t.abrupt("return",l.toDataURL("image/".concat(i)));case 12:case"end":return t.stop()}}),t)})))),e}return S(r,[{key:"onAdd",value:function(){var e=N(w(r.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}},{key:"getDefault",value:function(e){return v(v({},N(w(r.prototype),"getDefault",this).call(this,e)),{},{title:"å¯¼åºå¾ç",btnIcon:EB("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:(t=_(g().mark((function e(){var t,n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mapsService.exportMap("png");case 2:return t=e.sent,e.next=5,this.scene.exportPng("png");case 5:return n=e.sent,e.abrupt("return",this.mergeImage.apply(this,F([t,n].filter((function(e){return e})))));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(mB),wB=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],TB=function(){if("undefined"==typeof document)return!1;for(var e=wB[0],t={},n=0,r=wB;n<r.length;n++){var i=r[n];if((null==i?void 0:i[1])in document){var o,a=U(i.entries());try{for(a.s();!(o=a.n()).done;){var s=D(o.value,2),u=s[0],c=s[1];t[e[u]]=c}}catch(e){a.e(e)}finally{a.f()}return t}}return!1}(),CB={change:TB.fullscreenchange,error:TB.fullscreenerror},kB={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function e(){kB.off("change",e),n()};kB.on("change",i);var o=e[TB.requestFullscreen](t);o instanceof Promise&&o.then(i).catch(r)}))},exit:function(){return new Promise((function(e,t){if(kB.isFullscreen){var n=function t(){kB.off("change",t),e()};kB.on("change",n);var r=document[TB.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)}else e()}))},toggle:function(e,t){return kB.isFullscreen?kB.exit():kB.request(e,t)},onchange:function(e){kB.on("change",e)},onerror:function(e){kB.on("error",e)},on:function(e,t){var n=CB[e];n&&document.addEventListener(n,t,!1)},off:function(e,t){var n=CB[e];n&&document.removeEventListener(n,t,!1)},raw:TB};Object.defineProperties(kB,{isFullscreen:{get:function(){return Boolean(document[TB.fullscreenElement])}},element:{enumerable:!0,get:function(){var e;return null!==(e=document[TB.fullscreenElement])&&void 0!==e?e:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[TB.fullscreenEnabled])}}}),TB||(kB={isEnabled:!1});var MB=kB,PB=function(e){A(n,e);var t=O(n);function n(e){var r;return b(this,n),E(I(r=t.call(this,e)),"isFullscreen",!1),E(I(r),"mapContainer",void 0),E(I(r),"toggleFullscreen",_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!MB.isEnabled){e.next=3;break}return e.next=3,MB.toggle(r.mapContainer);case 3:case"end":return e.stop()}}),e)})))),E(I(r),"onClick",(function(){r.toggleFullscreen()})),E(I(r),"onFullscreenChange",(function(){r.isFullscreen=!!document.fullscreenElement;var e=r.controlOption,t=e.btnText,n=e.btnIcon,i=e.title,o=e.exitBtnText,a=e.exitBtnIcon,s=e.exitTitle;r.isFullscreen?(r.setBtnTitle(s),r.setBtnText(o),r.setBtnIcon(a)):(r.setBtnTitle(i),r.setBtnText(t),r.setBtnIcon(n)),r.emit("fullscreenChange",r.isFullscreen)})),MB.isEnabled||console.warn("å½åæµè§å¨ç¯å¢ä¸æ¯æå¯¹å°å¾å¨å±å"),r}return S(n,[{key:"setOptions",value:function(e){var t=e.exitBtnText,r=e.exitBtnIcon,i=e.exitTitle;this.isFullscreen&&(this.checkUpdateOption(e,["exitBtnIcon"])&&this.setBtnIcon(r),this.checkUpdateOption(e,["exitBtnText"])&&this.setBtnText(t),this.checkUpdateOption(e,["exitTitle"])&&this.setBtnTitle(i)),N(w(n.prototype),"setOptions",this).call(this,e)}},{key:"onAdd",value:function(){var e=N(w(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),this.mapContainer=Nm(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),e}},{key:"onRemove",value:function(){N(w(n.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(e){return v(v({},N(w(n.prototype),"getDefault",this).call(this,e)),{},{title:"å¨å±",btnIcon:EB("l7-icon-fullscreen"),exitTitle:"éåºå¨å±",exitBtnIcon:EB("l7-icon-exit-fullscreen")})}}]),n}(mB);var IB=function(e){return"number"==typeof e||_b(e)&&"[object Number]"==ug(e)};var LB=function(e){return IB(e)&&e!=+e},OB=function(e){A(n,e);var t=O(n);function n(e){var r;return b(this,n),E(I(r=t.call(this,e)),"getGeoLocation",(function(){return new Promise((function(e,t){window.navigator.geolocation.getCurrentPosition((function(n){var r=n.coords,i=null!=r?r:{},o=i.longitude,a=i.latitude;LB(o)||LB(a)?t():e([o,a])}),(function(e){t(e)}))}))})),E(I(r),"onClick",_(g().mark((function e(){var t,n,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.navigator.geolocation){e.next=2;break}return e.abrupt("return");case 2:return t=r.controlOption.transform,e.next=5,r.getGeoLocation();case 5:if(n=e.sent,i=r.mapsService.getZoom(),e.t0=r.mapsService,e.t1=i>15?i:15,!t){e.next=15;break}return e.next=12,t(n);case 12:e.t2=e.sent,e.next=16;break;case 15:e.t2=n;case 16:e.t3=e.t2,e.t0.setZoomAndCenter.call(e.t0,e.t1,e.t3);case 18:case"end":return e.stop()}}),e)})))),window.navigator.geolocation||console.warn("å½åæµè§å¨ç¯å¢ä¸æ¯æè·åå°çå®ä½"),r}return S(n,[{key:"getDefault",value:function(e){return v(v({},N(w(n.prototype),"getDefault",this).call(this,e)),{},{title:"å®ä½",btnIcon:EB("l7-icon-reposition")})}},{key:"onAdd",value:function(){var e=N(w(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}}]),n}(mB),RB=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"onLayerChange",(function(){var t;null!==(t=e.controlOption.layers)&&void 0!==t&&t.length||(e.selectValue=e.getLayerVisible(),e.setOptions({options:e.getLayerOptions()}))})),E(I(e),"onLayerVisibleChane",(function(){e.setSelectValue(e.getLayerVisible())})),E(I(e),"onSelectChange",(function(){e.layers.forEach((function(t){var n=e.selectValue.includes(t.name),r=t.isVisible();n&&!r&&t.show(),!n&&r&&t.hide()}))})),e}return S(n,[{key:"layers",get:function(){var e=this.layerService,t=this.controlOption.layers;if(Array.isArray(t)&&t.length){var n=[];return t.forEach((function(t){if(t instanceof Object&&n.push(t),"string"==typeof t){var r=e.getLayer(t)||e.getLayerByName(t);r&&n.push(r)}})),n}return e.getLayers()||[]}},{key:"getDefault",value:function(e){return v(v({},N(w(n.prototype),"getDefault",this).call(this,e)),{},{title:"å¾å±æ§å¶",btnIcon:EB("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter((function(e){return e.isVisible()})).map((function(e){return e.name}))}},{key:"getLayerOptions",value:function(){return this.layers.map((function(e){return{text:e.name,value:e.name}}))}},{key:"setOptions",value:function(e){var t=this.checkUpdateOption(e,["layers"]);N(w(n.prototype),"setOptions",this).call(this,e),t&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var e;return null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),N(w(n.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),n}(SB),NB=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getDefault",value:function(){return{position:dM.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var e=Bm("div","l7-control-logo");return this.setLogoContent(e),e}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(e){N(w(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["img","href"])&&(ty(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(e){var t=this.controlOption,n=t.href,r=t.img,i=Bm("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),ny(i),n){var o=Bm("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),e.appendChild(o)}else e.appendChild(i)}}]),n}(gB),DB={normal:{text:"æ å",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"æåé¶",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"å¹»å½±é»",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"èè²é",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"éå£«ç°",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"æ¶é¸¦",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"é©¬å¡é¾",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"æå¤è",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"é±ç±½",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},FB={normal:{text:"æ å",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"äº®",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"æ",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"å«æ",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"æ·å¤",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}},BB=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"onMapThemeChange",(function(){e.mapsService.setMapStyle(e.selectValue[0])})),e}return S(n,[{key:"getDefault",value:function(e){return v(v({},N(w(n.prototype),"getDefault",this).call(this,e)),{},{title:"å°å¾æ ·å¼",btnIcon:EB("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var e="mapbox"===this.mapsService.getType()?FB:DB;return Object.entries(this.mapsService.getMapStyleConfig()).filter((function(e){var t=D(e,2),n=t[0];return"string"==typeof t[1]&&"blank"!==n})).map((function(t){var n,r=D(t,2),i=r[0],o=r[1],a=null!==(n=e[i])&&void 0!==n?n:{},s=a.text;return{text:null!=s?s:i,value:o,img:a.img,key:i}}))}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var e,t=this;if(null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var r,i,o=this.controlOption.defaultValue;this.controlOption.defaultValue=null!==(r=null===(i=this.controlOption.options.find((function(e){return e.key===o})))||void 0===i?void 0:i.value)&&void 0!==r?r:o}else{var a=this.getMapStyle();a?this.controlOption.defaultValue=a:this.mapsService.map.once("styledata",(function(){var e=t.mapsService.getMapStyle();t.controlOption.defaultValue=e,t.setSelectValue(e,!1)}))}return this.on("selectChange",this.onMapThemeChange),N(w(n.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),n}(SB),zB=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"location",[0,0]),E(I(e),"onMouseMove",(function(t){var n=e.location,r=t.lngLat||t.lnglat,i=e.controlOption.transform;r&&(n=[r.lng,r.lat]),e.location=n,i&&(n=i(n)),e.insertLocation2HTML(n),e.emit("locationChange",n)})),e}return S(n,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(e){return v(v({},N(w(n.prototype),"getDefault",this).call(this,e)),{},{position:dM.BOTTOMLEFT,transform:function(e){var t=D(e,2),n=t[0],r=t[1];return[+(+n).toFixed(6),+(+r).toFixed(6)]}})}},{key:"onAdd",value:function(){var e=Bm("div","l7-control-mouse-location");return e.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),e}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(e){this.container.innerText=e.join(", ")}}]),n}(gB),UB=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"mScale",void 0),E(I(e),"iScale",void 0),E(I(e),"update",(function(){var t=e.mapsService,n=e.controlOption.maxWidth,r=t.getSize()[1]/2,i=t.containerToLngLat([0,r]),o=t.containerToLngLat([n,r]),a=r_([i.lng,i.lat],[o.lng,o.lat]);e.updateScales(a)})),e}return S(n,[{key:"getDefault",value:function(e){return v(v({},N(w(n.prototype),"getDefault",this).call(this,e)),{},{name:"scale",position:dM.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var e=Bm("div","l7-control-scale");this.resetScaleLines(e);var t=this.controlOption.updateWhenIdle;return this.mapsService.on(t?"moveend":"mapmove",this.update),this.mapsService.on(t?"zoomend":"zoomchange",this.update),e}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(e){N(w(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"resetScaleLines",value:function(e){ty(e);var t=this.controlOption,n=t.metric,r=t.imperial,i=t.maxWidth;t.lockWidth&&Km(e,"width: ".concat(i,"px")),n&&(this.mScale=Bm("div","l7-control-scale-line",e)),r&&(this.iScale=Bm("div","l7-control-scale-line",e)),this.update()}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),n}(gB),jB=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"disabled",void 0),E(I(e),"zoomInButton",void 0),E(I(e),"zoomOutButton",void 0),E(I(e),"zoomIn",(function(){!e.disabled&&e.mapsService.getZoom()<e.mapsService.getMaxZoom()&&e.mapsService.zoomIn()})),E(I(e),"zoomOut",(function(){!e.disabled&&e.mapsService.getZoom()>e.mapsService.getMinZoom()&&e.mapsService.zoomOut()})),E(I(e),"updateDisabled",(function(){var t=e.mapsService;e.zoomInButton.removeAttribute("disabled"),e.zoomOutButton.removeAttribute("disabled"),(e.disabled||t.getZoom()<=t.getMinZoom())&&e.zoomOutButton.setAttribute("disabled","true"),(e.disabled||t.getZoom()>=t.getMaxZoom())&&e.zoomInButton.setAttribute("disabled","true")})),e}return S(n,[{key:"getDefault",value:function(e){return v(v({},N(w(n.prototype),"getDefault",this).call(this,e)),{},{position:dM.BOTTOMRIGHT,name:"zoom",zoomInText:EB("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:EB("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(e){N(w(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var e=Bm("div","l7-control-zoom");return this.resetButtonGroup(e),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(e){ty(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",e,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(e,t,n,r,i){var o=Bm("button",n,r);return"string"==typeof e?o.innerHTML=e:o.append(e),o.title=t,o.addEventListener("click",i),o}}]),n}(gB),VB=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,GB=/^\w*$/;var HB=function(e,t){if(xP(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!bb(e))||(GB.test(e)||!VB.test(e)||null!=t&&e in Object(t))};function WB(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(WB.Cache||$M),n}WB.Cache=$M;var YB=WB;var XB=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ZB=/\\(\\)?/g,qB=function(e){var t=YB(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(XB,(function(e,n,r,i){t.push(r?i.replace(ZB,"$1"):n||e)})),t}));var KB=function(e,t){return xP(e)?e:HB(e,t)?[e]:qB(iN(e))};var QB=function(e){if("string"==typeof e||bb(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};var $B=function(e,t){for(var n=0,r=(t=KB(t,e)).length;null!=e&&n<r;)e=e[QB(t[n++])];return n&&n==r?e:void 0};var JB=function(e,t,n){var r=null==e?void 0:$B(e,t);return void 0===r?n:r},ez=function(e){A(n,e);var t=O(n);function n(e){var r;b(this,n),E(I(r=t.call(this)),"popupOption",void 0),E(I(r),"mapsService",void 0),E(I(r),"sceneService",void 0),E(I(r),"layerService",void 0),E(I(r),"scene",void 0),E(I(r),"closeButton",void 0),E(I(r),"container",void 0),E(I(r),"content",void 0),E(I(r),"contentTitle",void 0),E(I(r),"contentPanel",void 0),E(I(r),"tip",void 0),E(I(r),"isShow",!0),E(I(r),"onMouseMove",(function(e){var t,n=r.mapsService.getMapContainer(),i=null!==(t=null==n?void 0:n.getBoundingClientRect())&&void 0!==t?t:{},o=i.left,a=void 0===o?0:o,s=i.top,u=void 0===s?0:s;r.setPopupPosition(e.clientX-a,e.clientY-u)})),E(I(r),"updateLngLatPosition",(function(){if(r.mapsService&&!r.popupOption.followCursor){var e=r.lngLat,t=e.lng,n=e.lat,i=r.mapsService.lngLatToContainer([t,n]),o=i.x,a=i.y;r.setPopupPosition(o,a)}})),E(I(r),"onKeyDown",(function(e){27===e.keyCode&&r.remove()})),E(I(r),"onCloseButtonClick",(function(e){e.stopPropagation&&e.stopPropagation(),r.hide()})),E(I(r),"update",(function(){var e=!!r.lngLat,t=r.popupOption,n=t.className,i=t.style,o=t.maxWidth,a=t.anchor,s=t.stopPropagation;if(r.mapsService&&e&&r.content){var u=r.mapsService.getMarkerContainer();if(!r.container&&u&&(r.container=Bm("div","l7-popup ".concat(null!=n?n:""," ").concat(r.isShow?"":"l7-popup-hide"),u),i&&r.container.setAttribute("style",i),r.tip=Bm("div","l7-popup-tip",r.container),r.container.appendChild(r.content),s&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(e){r.container.addEventListener(e,(function(e){e.stopPropagation()}))})),r.container.style.whiteSpace="nowrap"),r.updateLngLatPosition(),Ym(r.container,"".concat(tv[a])),nv(r.container,a,"popup"),o)r.container.getBoundingClientRect().width>parseFloat(o)&&(r.container.style.width=o);else r.container.style.removeProperty("width")}})),r.popupOption=v(v({},r.getDefault(null!=e?e:{})),e);var i=r.popupOption.lngLat;return i&&(r.lngLat=i),r}return S(n,[{key:"lngLat",get:function(){var e;return null!==(e=this.popupOption.lngLat)&&void 0!==e?e:{lng:0,lat:0}},set:function(e){this.popupOption.lngLat=e}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(e){this.mapsService=e.get(AT.IMapService),this.sceneService=e.get(AT.ISceneService),this.layerService=e.get(AT.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=e,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var t=this.popupOption,n=t.html,r=t.text,i=t.title;return n?this.setHTML(n):r&&this.setText(r),i&&this.setTitle(i),this.emit("open"),this}},{key:"remove",value:function(){if(null!=this&&this.isOpen())return this.content&&zm(this.content),this.container&&(zm(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(e){return this.show(),this.popupOption=v(v({},this.popupOption),e),this.checkUpdateOption(e,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(zm(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(e,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(e,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(e,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(e,["html"])&&e.html?this.setHTML(e.html):this.checkUpdateOption(e,["text"])&&e.text&&this.setText(e.text),this.checkUpdateOption(e,["lngLat"])&&e.lngLat&&this.setLnglat(e.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&jm(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&Um(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(e){return this.popupOption.html=e,this.setDOMContent(e)}},{key:"setText",value:function(e){return this.popupOption.text=e,this.setDOMContent(window.document.createTextNode(e))}},{key:"setTitle",value:function(e){this.show(),this.popupOption.title=e,e?(this.contentTitle||(this.contentTitle=Bm("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),ty(this.contentTitle),ry(this.contentTitle,e)):this.contentTitle&&(zm(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var e=this.lngLat,t=e.lng,n=e.lat;return this.popupOption.autoPan&&this.mapsService.panTo([t,n]),this}},{key:"setLngLat",value:function(e){return this.setLnglat(e)}},{key:"setLnglat",value:function(e){var t=this;return this.show(),this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout((function(){t.panToPopup()}),0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(e){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:ev.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(e){return this.show(),this.createContent(),ry(this.contentPanel,e),this.update(),this}},{key:"updateCloseOnClick",value:function(e){var t=this,n=this.mapsService;n&&(null==n||n.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!e&&requestAnimationFrame((function(){null==n||n.on("click",t.onCloseButtonClick)})))}},{key:"updateCloseOnEsc",value:function(e){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!e&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(e){var t,n=null===(t=this.mapsService)||void 0===t?void 0:t.getContainer();n&&(null==n||n.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!e&&(null==n||n.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var e=this;if(this.content&&zm(this.content),this.contentTitle=void 0,this.content=Bm("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var t=EB("l7-icon-guanbi");Um(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",(function(){e.hide()})),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=Bm("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(e,t){if(this.container){var n=this.popupOption.offsets;this.container.style.left=e+n[0]+"px",this.container.style.top=t-n[1]+"px"}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),n}(Q_),tz=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"layerConfigMap",new WeakMap),E(I(e),"displayFeatureInfo",void 0),e}return S(n,[{key:"layerConfigItems",get:function(){var e,t=this.popupOption,n=t.config,r=t.items;return null!==(e=null!=n?n:r)&&void 0!==e?e:[]}},{key:"addTo",value:function(e){return N(w(n.prototype),"addTo",this).call(this,e),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return N(w(n.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(e){return this.unbindLayerEvent(),N(w(n.prototype),"setOptions",this).call(this,e),this.bindLayerEvent(),this}},{key:"getDefault",value:function(e){var t="click"===e.trigger;return v(v({},N(w(n.prototype),"getDefault",this).call(this,e)),{},{trigger:"hover",followCursor:!t,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var e=this,t=this.popupOption.trigger;this.layerConfigItems.forEach((function(n){var r,i=e.getLayerByConfig(n);if(i){var o=v({},n);if("hover"===t){var a=e.onLayerMouseMove.bind(e,i),s=e.onLayerMouseOut.bind(e,i);o.onMouseMove=a,o.onMouseOut=s,null==i||i.on("mousemove",a),null==i||i.on("mouseout",s)}else{var u=e.onLayerClick.bind(e,i);o.onClick=u,null==i||i.on("click",u)}var c=null==i||null===(r=i.getSource)||void 0===r?void 0:r.call(i),l=e.onSourceUpdate.bind(e,i);null==c||c.on("update",l),o.onSourceUpdate=l,e.layerConfigMap.set(i,o)}}))}},{key:"unbindLayerEvent",value:function(){var e=this;this.layerConfigItems.forEach((function(t){var n=e.getLayerByConfig(t),r=n&&e.layerConfigMap.get(n);if(r){var i,o=r.onMouseMove,a=r.onMouseOut,s=r.onClick,u=r.onSourceUpdate;if(o&&n.off("mousemove",o),a&&n.off("mouseout",a),s&&n.off("click",s),u)null==n||null===(i=n.getSource())||void 0===i||i.off("update",u)}}))}},{key:"onLayerMouseMove",value:function(e,t){if(!this.isSameFeature(e,t.featureId)){var n=this.getLayerInfoFrag(e,t),r=n.title,i=n.content;this.setDOMContent(i),this.setTitle(r),this.displayFeatureInfo={layer:e,featureId:t.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(e,t){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(e,t){if(this.isShow&&this.isSameFeature(e,t.featureId))this.hide();else{var n=this.getLayerInfoFrag(e,t),r=n.title,i=n.content;this.setDOMContent(i),this.setLnglat(t.lngLat),this.setTitle(r),this.displayFeatureInfo={layer:e,featureId:t.featureId},this.show()}}},{key:"onSourceUpdate",value:function(e){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(e,t){var n,r=this.layerConfigMap.get(e),i=document.createDocumentFragment();if(r){var o=t.feature;"Feature"===o.type&&"properties"in o&&"geometry"in o&&(o=o.properties);var a=r.title,s=r.fields,u=r.customContent;if(a)ry(n=document.createDocumentFragment(),a instanceof Function?a(o):a);if(u){var c=u instanceof Function?u(o):u;ry(i,c)}else null!=s&&s.length&&(null==s||s.forEach((function(e){var n,r,a="string"==typeof e?{field:e}:e,s=a.field,u=a.formatField,c=a.formatValue,l=a.getValue,h=Bm("div","l7-layer-popup__row"),f=l?l(t.feature):JB(o,s),p=null!==(n=u instanceof Function?u(s,o):u)&&void 0!==n?n:s,d=null!==(r=c instanceof Function?c(f,o):c)&&void 0!==r?r:f,v=Bm("span","l7-layer-popup__key",h);ry(v,p),ry(v,document.createTextNode("ï¼"));var g=Bm("span","l7-layer-popup__value",h);Array.isArray(d)&&d.every((function(e){return!(e instanceof Object)}))&&(d=d.map((function(e){return String(e)})).join(",")),ry(g,d),i.appendChild(h)})))}return{title:n,content:i}}},{key:"getLayerByConfig",value:function(e){var t=e.layer;return t instanceof Object?t:"string"==typeof t?this.layerService.getLayer(t)||this.layerService.getLayerByName(t):void 0}},{key:"isSameFeature",value:function(e,t){var n=this.displayFeatureInfo;return n&&e===n.layer&&t===n.featureId}}]),n}(ez);var nz=function(e){return void 0===e};var rz=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};var iz=function(e,t,n,r,i,o){var a=1&n,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var c=o.get(e),l=o.get(t);if(c&&l)return c==t&&l==e;var h=-1,f=!0,p=2&n?new aR:void 0;for(o.set(e,t),o.set(t,e);++h<s;){var d=e[h],v=t[h];if(r)var g=a?r(v,d,h,t,e,o):r(d,v,h,e,t,o);if(void 0!==g){if(g)continue;f=!1;break}if(p){if(!rz(t,(function(e,t){if(!cR(p,t)&&(d===e||i(d,e,n,r,o)))return p.push(t)}))){f=!1;break}}else if(d!==v&&!i(d,v,n,r,o)){f=!1;break}}return o.delete(e),o.delete(t),f};var oz=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},az=Jv?Jv.prototype:void 0,sz=az?az.valueOf:void 0;var uz=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new aP(e),new aP(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return bM(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=oz;case"[object Set]":var u=1&r;if(s||(s=fR),e.size!=t.size&&!u)return!1;var c=a.get(e);if(c)return c==t;r|=2,a.set(e,t);var l=iz(s(e),s(t),r,i,o,a);return a.delete(e),l;case"[object Symbol]":if(sz)return sz.call(e)==sz.call(t)}return!1},cz=Object.prototype.hasOwnProperty;var lz=function(e,t,n,r,i,o){var a=1&n,s=CF(e),u=s.length;if(u!=CF(t).length&&!a)return!1;for(var c=u;c--;){var l=s[c];if(!(a?l in t:cz.call(t,l)))return!1}var h=o.get(e),f=o.get(t);if(h&&f)return h==t&&f==e;var p=!0;o.set(e,t),o.set(t,e);for(var d=a;++c<u;){var v=e[l=s[c]],g=t[l];if(r)var m=a?r(g,v,l,t,e,o):r(v,g,l,e,t,o);if(!(void 0===m?v===g||i(v,g,n,r,o):m)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var y=e.constructor,_=t.constructor;y==_||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _||(p=!1)}return o.delete(e),o.delete(t),p},hz=Object.prototype.hasOwnProperty;var fz=function(e,t,n,r,i,o){var a=xP(e),s=xP(t),u=a?"[object Array]":BF(e),c=s?"[object Array]":BF(t),l="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),h="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),f=u==c;if(f&&TP(e)){if(!TP(t))return!1;a=!0,l=!1}if(f&&!l)return o||(o=new tP),a||FP(e)?iz(e,t,n,r,i,o):uz(e,t,u,n,r,i,o);if(!(1&n)){var p=l&&hz.call(e,"__wrapped__"),d=h&&hz.call(t,"__wrapped__");if(p||d){var v=p?e.value():e,g=d?t.value():t;return o||(o=new tP),i(v,g,n,r,o)}}return!!f&&(o||(o=new tP),lz(e,t,n,r,i,o))};var pz=function e(t,n,r,i,o){return t===n||(null==t||null==n||!_b(t)&&!_b(n)?t!=t&&n!=n:fz(t,n,r,i,e,o))};var dz,vz,gz,mz,yz=function(e,t){return pz(e,t)},_z=(E(dz={},iI.additive,{enable:!0,func:{srcRGB:fL.ONE,dstRGB:fL.ONE,srcAlpha:1,dstAlpha:1}}),E(dz,iI.none,{enable:!1}),E(dz,iI.normal,{enable:!0,func:{srcRGB:fL.SRC_ALPHA,dstRGB:fL.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),E(dz,iI.subtractive,{enable:!0,func:{srcRGB:fL.ONE,dstRGB:fL.ONE,srcAlpha:fL.ZERO,dstAlpha:fL.ONE_MINUS_SRC_COLOR},equation:{rgb:fL.FUNC_SUBTRACT,alpha:fL.FUNC_SUBTRACT}}),E(dz,iI.max,{enable:!0,func:{srcRGB:fL.ONE,dstRGB:fL.ONE},equation:{rgb:fL.MAX_EXT}}),E(dz,iI.min,{enable:!0,func:{srcRGB:fL.ONE,dstRGB:fL.ONE},equation:{rgb:fL.MIN_EXT}}),dz),bz=(vz=kD(AT.IGlobalConfigService),mz=G((gz=function(){function e(t){b(this,e),V(this,"configService",mz,this),E(this,"config",void 0),this.config=t}return S(e,[{key:"setContainer",value:function(e,t,n,r){e.bind(AT.MapConfig).toConstantValue(v(v({},this.config),{},{id:t,canvas:n,hasBaseMap:r})),e.bind(AT.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}()).prototype,"configService",[vz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gz),xz=Y((function(e,t){e.exports=function(){function e(e){var r=[];return e.AMapUI&&r.push(t(e.AMapUI)),e.Loca&&r.push(n(e.Loca)),Promise.all(r)}function t(e){return new Promise((function(t,n){var i=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(e.plugins[u])&&i.push(e.plugins[u]);if(a.AMapUI===r.failed)n("åæ¬¡è¯·æ± AMapUI å¤±è´¥");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=e.version||o.AMapUI.version,u=o.AMapUI.version;var c=document.body||document.head,l=document.createElement("script");l.type="text/javascript",l.src="https://webapi.amap.com/ui/"+u+"/main.js",l.onerror=function(e){a.AMapUI=r.failed,n("è¯·æ± AMapUI å¤±è´¥")},l.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},c.appendChild(l)}else a.AMapUI===r.loaded?e.version&&e.version!==o.AMapUI.version?n("ä¸åè®¸å¤ä¸ªçæ¬ AMapUI æ··ç¨"):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t():e.version&&e.version!==o.AMapUI.version?n("ä¸åè®¸å¤ä¸ªçæ¬ AMapUI æ··ç¨"):s.AMapUI.push((function(e){e?n(e):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t()}))}))}function n(e){return new Promise((function(t,n){if(a.Loca===r.failed)n("åæ¬¡è¯·æ± Loca å¤±è´¥");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=e.version||o.Loca.version;var i=o.Loca.version,u=o.AMap.version.startsWith("2"),c=i.startsWith("2");if(u&&!c||!u&&c)n("JSAPI ä¸ Loca çæ¬ä¸å¯¹åºï¼ï¼");else{u=o.key,c=document.body||document.head;var l=document.createElement("script");l.type="text/javascript",l.src="https://webapi.amap.com/loca?v="+i+"&key="+u,l.onerror=function(e){a.Loca=r.failed,n("è¯·æ± AMapUI å¤±è´¥")},l.onload=function(){for(a.Loca=r.loaded,t();s.Loca.length;)s.Loca.splice(0,1)[0]()},c.appendChild(l)}}else a.Loca===r.loaded?e.version&&e.version!==o.Loca.version?n("ä¸åè®¸å¤ä¸ªçæ¬ Loca æ··ç¨"):t():e.version&&e.version!==o.Loca.version?n("ä¸åè®¸å¤ä¸ªçæ¬ Loca æ··ç¨"):s.Loca.push((function(e){e?n(e):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[];return{load:function(t){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=t.key,c=t.version,l=t.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("ç¦æ­¢å¤ç§APIå è½½æ¹å¼æ··ç¨"),o.key=s,o.AMap.version=c||o.AMap.version,o.AMap.plugins=l||o.AMap.plugins,a.AMap=r.loading,c=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,e(t).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(l=document.createElement("script")).type="text/javascript",l.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),l.onerror=function(e){a.AMap=r.failed,i(e)},c.appendChild(l)):i("è¯·å¡«åkey")}else if(a.AMap==r.loaded)if(t.key&&t.key!==o.key)i("å¤ä¸ªä¸ä¸è´ç key");else if(t.version&&t.version!==o.AMap.version)i("ä¸åè®¸å¤ä¸ªçæ¬ JSAPI æ··ç¨");else{if(s=[],t.plugins)for(c=0;c<t.plugins.length;c+=1)-1==o.AMap.plugins.indexOf(t.plugins[c])&&s.push(t.plugins[c]);s.length?window.AMap.plugin(s,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}else if(t.key&&t.key!==o.key)i("å¤ä¸ªä¸ä¸è´ç key");else if(t.version&&t.version!==o.AMap.version)i("ä¸åè®¸å¤ä¸ªçæ¬ JSAPI æ··ç¨");else{var h=[];if(t.plugins)for(c=0;c<t.plugins.length;c+=1)-1==o.AMap.plugins.indexOf(t.plugins[c])&&h.push(t.plugins[c]);!function(e){"function"==typeof e&&(a.AMap===r.loaded?e(window.AMap):u.push(e))}((function(){h.length?window.AMap.plugin(h,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}()})),Sz=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({}),Ez=function(){function e(t){b(this,e),E(this,"size",1e4),this.size=t||1e4}return S(e,[{key:"setSize",value:function(e){this.size=e}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(e){return(180+e)/360*this.size}},{key:"mercatorYfromLat",value:function(e){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(e){return e/this.size*360-180}},{key:"latFromMercatorY",value:function(e){var t=180-360*(1-e/this.size);return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}},{key:"project",value:function(e){return[this.mercatorXfromLng(e[0]),this.mercatorYfromLat(e[1])]}},{key:"unproject",value:function(e){return[this.lngFromMercatorX(e[0]),this.latFromMercatorY(e[1])]}}]),e}();function Az(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={top:0,right:0,bottom:0,left:0};if("number"==typeof e)return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(4===e.length)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(2===e.length)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return v(v({},t),e)}function wz(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Tz(e){return(Tz="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cz(e){var t=function(e,t){if("object"!==Tz(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Tz(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Tz(t)?t:String(t)}function kz(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Cz(r.key),r)}}function Mz(e,t,n){return t&&kz(e.prototype,t),n&&kz(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pz(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Iz(e,t){if(t&&("object"===Tz(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Pz(e)}function Lz(e){return(Lz=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oz(e,t){return(Oz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Rz(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Nz(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Rz(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rz(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dz(e,t){var n,r,i,o=$S([],t,e);return n=o,r=o,i=1/o[3],n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,o}function Fz(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var Bz=Math.PI,zz=Bz/4,Uz=Bz/180,jz=180/Bz;function Vz(e){return Math.pow(2,e)}function Gz(e,t){var n=Nz(e,2),r=n[0],i=n[1];Fz(Number.isFinite(r)&&Number.isFinite(t)),Fz(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*Uz;return[(t*=512)*(r*Uz+Bz)/(2*Bz),t*(Bz-Math.log(Math.tan(zz+.5*o)))/(2*Bz)]}function Hz(e,t){var n=Nz(e,2),r=n[0],i=n[1],o=r/(t*=512)*(2*Bz)-Bz,a=2*(Math.atan(Math.exp(Bz-i/t*(2*Bz)))-zz);return[o*jz,a*jz]}function Wz(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.scale,o=e.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:Vz(r),Fz(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,c=Math.cos(t*Uz),l=u/360,h=l/c,f=u/4003e4/c;if(s.pixelsPerMeter=[f,-f,f],s.metersPerPixel=[1/f,-1/f,1/f],s.pixelsPerDegree=[l,-h,f],s.degreesPerPixel=[1/l,-1/h,1/f],a){var p=Uz*Math.tan(t*Uz)/c,d=l*p/2,v=u/4003e4*p,g=v/h*f;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[g,0,g]}return s}function Yz(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.altitude,o=e.center,a=void 0===o?null:o,s=e.flipY,u=void 0!==s&&s,c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return aS(c,c,[0,0,-i]),sS(c,c,[1,1,1/t]),uS(c,c,-n*Uz),lS(c,c,r*Uz),u&&sS(c,c,[1,-1,1]),a&&aS(c,c,RS([],a)),c}function Xz(e){var t=e.width,n=e.height,r=e.pitch,i=function(e){var t=e.width,n=e.height,r=e.altitude,i=void 0===r?1.5:r,o=e.pitch,a=void 0===o?0:o,s=e.nearZMultiplier,u=void 0===s?1:s,c=e.farZMultiplier,l=void 0===c?1:c,h=a*Uz,f=Math.atan(.5/i),p=Math.sin(f)*i/Math.sin(Math.PI/2-h-f),d=Math.cos(Math.PI/2-h)*p+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:u,far:d*l}}({width:t,height:n,altitude:e.altitude,pitch:r,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return vS([],o,a,s,u)}function Zz(e,t){var n=Nz(e,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return Fz(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),Dz(t,[r,i,a,1])}function qz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Nz(e,3),i=r[0],o=r[1],a=r[2];if(Fz(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=Dz(t,[i,o,a,1]);return s}var u=Dz(t,[i,o,0,1]),c=Dz(t,[i,o,1,1]),l=u[2],h=c[2],f=l===h?0:((n||0)-l)/(h-l);return sE([],u,c,f)}var Kz=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Qz(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,o=void 0===i?0:i,a=e.maxZoom,s=void 0===a?24:a,u=e.padding,c=void 0===u?0:u,l=e.offset,h=void 0===l?[0,0]:l,f=Nz(r,2),p=Nz(f[0],2),d=p[0],v=p[1],g=Nz(f[1],2),m=g[0],y=g[1];if(Number.isFinite(c)){c={top:c,bottom:c,left:c,right:c}}else Fz(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var _=new cU({width:t,height:n,longitude:0,latitude:0,zoom:0}),b=_.project([d,y]),x=_.project([m,v]),S=[Math.max(Math.abs(x[0]-b[0]),o),Math.max(Math.abs(x[1]-b[1]),o)],E=[t-c.left-c.right-2*Math.abs(h[0]),n-c.top-c.bottom-2*Math.abs(h[1])];Fz(E[0]>0&&E[1]>0);var A=E[0]/S[0],w=E[1]/S[1],T=(c.right-c.left)/2/A,C=(c.bottom-c.top)/2/w,k=[(x[0]+b[0])/2+T,(x[1]+b[1])/2+C],M=_.unproject(k),P=_.zoom+Math.log2(Math.abs(Math.min(A,w)));return{longitude:M[0],latitude:M[1],zoom:Math.min(P,s)}}var $z,Jz,eU,tU,nU,rU,iU,oU,aU,sU,uU,cU=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,c=n.zoom,l=void 0===c?0:c,h=n.pitch,f=void 0===h?0:h,p=n.bearing,d=void 0===p?0:p,v=n.altitude,g=void 0===v?1.5:v,m=n.nearZMultiplier,y=n.farZMultiplier;wz(this,t),r=r||1,i=i||1;var _=Vz(l);g=Math.max(.75,g);var b=Gz([u,a],_);b[2]=0;var x=Xz({width:r,height:i,pitch:f,bearing:d,altitude:g,nearZMultiplier:m||1/i,farZMultiplier:y||1.01}),S=Yz({height:i,center:b,pitch:f,bearing:d,altitude:g,flipY:!0});return(e=Iz(this,Lz(t).call(this,{width:r,height:i,viewMatrix:S,projectionMatrix:x}))).latitude=a,e.longitude=u,e.zoom=l,e.pitch=f,e.bearing=d,e.altitude=g,e.scale=_,e.center=b,e.pixelsPerMeter=Wz(Pz(Pz(e))).pixelsPerMeter[2],Object.freeze(Pz(Pz(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Oz(e,t)}(t,e),Mz(t,[{key:"projectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Gz(e,t)}},{key:"unprojectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Hz(e,t)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t,n,r=e.lngLat,i=qz(e.pos,this.pixelUnprojectionMatrix),o=rE([],Gz(r,this.scale),((t=[])[0]=-(n=i)[0],t[1]=-n[1],t));return Hz(rE([],this.center,o),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=Qz(Object.assign({width:r,height:i,bounds:e},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new t({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),t}(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,o=void 0===i?Kz:i,a=t.projectionMatrix,s=void 0===a?Kz:a;wz(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];oS(u,u,this.projectionMatrix),oS(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];sS(c,c,[this.width/2,-this.height/2,1]),aS(c,c,[1,-1,0]),oS(c,c,this.viewProjectionMatrix);var l=iS([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=c,this.pixelUnprojectionMatrix=l,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Mz(e,[{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&bS(t.projectionMatrix,this.projectionMatrix)&&bS(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=this.projectPosition(e),o=Zz(i,this.pixelProjectionMatrix),a=Nz(o,2),s=a[0],u=a[1],c=r?u:this.height-u;return 2===e.length?[s,c]:[s,c,o[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=t.targetZ,o=Nz(e,3),a=o[0],s=o[1],u=o[2],c=r?s:this.height-s,l=i&&i*this.pixelsPerMeter,h=qz([a,c,u],this.pixelUnprojectionMatrix,l),f=this.unprojectPosition(h),p=Nz(f,3),d=p[0],v=p[1],g=p[2];return Number.isFinite(u)?[d,v,g]:Number.isFinite(i)?[d,v,i]:[d,v]}},{key:"projectPosition",value:function(e){var t=Nz(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=Nz(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}},{key:"unprojectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}}]),e}()),lU=function(){function e(){b(this,e),E(this,"viewport",void 0)}return S(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth,s=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new cU(v(v({},s),{},{width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),hU={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},fU=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],pU={"GAODE1.x":{contextmenu:"rightclick"},"GAODE2.x":{contextmenu:"rightclick",camerachange:"viewchange"}},dU=0;window.forceWebGL=!0;var vU=!1,gU=[],mU=($z=vw(),Jz=dw(AT.IGlobalConfigService),eU=dw(AT.MapConfig),tU=dw(AT.ICoordinateSystemService),nU=dw(AT.IEventEmitter),$z((oU=G((iU=function(){function e(){var t=this;b(this,e),E(this,"version",Sz["GAODE1.x"]),E(this,"simpleMapCoord",new Ez),E(this,"map",void 0),E(this,"bgColor","rgba(0, 0, 0, 0)"),V(this,"configService",oU,this),V(this,"config",aU,this),V(this,"coordinateSystemService",sU,this),V(this,"eventEmitter",uU,this),E(this,"markerContainer",void 0),E(this,"$mapContainer",void 0),E(this,"viewport",void 0),E(this,"cameraChangedCallback",void 0),E(this,"handleCameraChanged",(function(e){var n=e.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,c=n.aspect,l=n.position,h=t.getCenter(),f=h.lng,p=h.lat;if(t.emit("mapchange"),t.cameraChangedCallback){t.viewport.syncWithMapCamera({aspect:c,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:t.map.getZoom()-1,center:[f,p],offsetOrigin:[l.x,l.y]});var d=t.config.offsetZoom,v=void 0===d?12:d;t.viewport.getZoom()>v?t.coordinateSystemService.setCoordinateSystem(OI.P20_OFFSET):t.coordinateSystemService.setCoordinateSystem(OI.P20),t.cameraChangedCallback(t.viewport)}}))}var t;return S(e,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];this.markerContainer=Bm("div","l7-marker-container",t)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==VD.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(pU[this.version][e]||e,t)}},{key:"off",value:function(e,t){-1!==VD.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(pU[this.version][e]||e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(e){return this.map.setZoom(e+1)}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=Az(e.padding),r=this.lngLatToPixel([t.lng,t.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"setCenter",value:function(e,t){if(null!=t&&t.padding){var n=Az(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds().toBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(e,t)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]))}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e+1,t)}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyleValue(e))}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"getMapStyleConfig",value:function(){return hU}},{key:"getMapStyleValue",value:function(e){return this.getMapStyleConfig()[e]||e}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=new AMap.LngLat(e[0],e[1]),n=this.map.lngLatToContainer(t);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(e){var t=this.map.lngLatToGeodeticCoord(e);return[t.x,-t.y]}},{key:"lngLatToMercator",value:function(e,t){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=eS();return aS(o,o,TS(i[0],i[1],t)),sS(o,o,TS(r[0],r[1],r[2])),uS(o,o,n[0]),cS(o,o,n[1]),lS(o,o,n[2]),o}},{key:"init",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f,p,d,m=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,c=t.token,l=void 0===c?"15cd8a57710d40c9b7c0e3cc120f1200":c,h=t.mapInstance,f=t.plugin,p=void 0===f?[]:f,d=P(t,fU),e.next=3,new Promise((function(e){var t=function(){if(h)m.map=h,m.$mapContainer=m.map.getContainer(),setTimeout((function(){m.map.on("camerachange",m.handleCameraChanged),e()}),30);else{m.$mapContainer=m.creatMapContainer(n);var t=v({mapStyle:m.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);t.zoom&&(t.zoom+=1);var r=new AMap.Map(m.$mapContainer,t);r.on("camerachange",m.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return m.handleAfterMapChange()}))})),m.map=r,setTimeout((function(){e()}),10)}};vU||h?vU&&window.AMap||h?t():gU.push(t):("15cd8a57710d40c9b7c0e3cc120f1200"===l&&console.warn("%c".concat(m.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),vU=!0,p.push("Map3D"),xz.load({key:l,version:"1.4.15",plugins:p}).then((function(){t(),gU.length&&(gU.forEach((function(e){return e()})),gU=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new lU;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(k(AMap.LngLat,F(e)),k(AMap.LngLat,F(t))),r=D(this.lngLatToCoord(e),2),i=r[0],o=r[1],a=D(this.lngLatToCoord(t),2),s=a[0],u=a[1];return Math.sqrt(Math.pow(i-s,2)+Math.pow(o-u,2))/n}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n),this.map.destroy()}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",n.id="l7_amap_div"+dU++,t.appendChild(n),n}}]),e}()).prototype,"configService",[Jz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aU=G(iU.prototype,"config",[eU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sU=G(iU.prototype,"coordinateSystemService",[tU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uU=G(iU.prototype,"eventEmitter",[nU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rU=iU))||rU);if(!window)throw Error("AMap JSAPI can only be used in Browser.");var yU=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(yU||{}),_U={key:"",AMap:{version:"2.0",plugins:[]}},bU={AMap:yU.notload};var xU,SU={load:function(){var e=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(bU.AMap===yU.failed)n("");else if(bU.AMap===yU.notload){var r=t.key,i=t.version,o=t.plugins;if(!r)return void n("è¯·å¡«åkey");window.AMap&&"lbs.amap.com"!==location.host&&n("ç¦æ­¢å¤ç§APIå è½½æ¹å¼æ··ç¨"),_U.key=r,_U.AMap.version=i||_U.AMap.version,_U.AMap.plugins=o||_U.AMap.plugins,bU.AMap=yU.loading;var a=document.body||document.head;window._onAPILoaded=function(t){t?(bU.AMap=yU.failed,n(t)):(bU.AMap=yU.loaded,e(null))};var s=document.createElement("script");s.type="text/javascript",s.async=!1,s.src="https://webapi.amap.com/maps?callback=_onAPILoaded&v="+_U.AMap.version+"&key="+r+"&plugin="+_U.AMap.plugins.join(","),s.onerror=function(e){bU.AMap=yU.failed,n(e)},a.appendChild(s)}else if(bU.AMap===yU.loaded){if(t.key&&t.key!==_U.key)return void n("å¤ä¸ªä¸ä¸è´ç key");if(t.version&&t.version!==_U.AMap.version)return void n("ä¸åè®¸å¤ä¸ªçæ¬ JSAPI æ··ç¨");var u=[];t.plugins&&t.plugins.forEach((function(e){-1===_U.AMap.plugins.indexOf(e)&&u.push(e)})),u.length&&window.AMap.plugin(u,(function(){e(window.AMap)}))}else{if(t.key&&t.key!==_U.key)return void n("å¤ä¸ªä¸ä¸è´ç key");if(t.version&&t.version!==_U.AMap.version)return void n("ä¸åè®¸å¤ä¸ªçæ¬ JSAPI æ··ç¨");var c=[];t.plugins&&t.plugins.forEach((function(e){-1===_U.AMap.plugins.indexOf(e)&&c.push(e)})),"function"!=typeof(l=function(){c.length&&window.AMap.plugin(c,(function(){e(window.AMap)}))})||bU.AMap!==yU.loaded||l(window.AMap)}var l})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),reset:function(){delete window.AMap,_U={key:"",AMap:{version:"1.4.15",plugins:[]}},bU={AMap:yU.notload}}},EU=Math.PI/180,AU=function(){function e(){b(this,e),E(this,"projectionMatrix",eS()),E(this,"viewMatrix",eS()),E(this,"viewProjectionMatrix",eS()),E(this,"ViewProjectionMatrixUncentered",eS()),E(this,"viewUncenteredMatrix",eS()),E(this,"zoom",void 0),E(this,"center",void 0)}return S(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.pitch,i=void 0===r?0:r,o=e.bearing,a=void 0===o?0:o,s=e.center,u=void 0===s?[0,0]:s,c=e.offsetOrigin,l=void 0===c?[0,0]:c,h=e.cameraHeight,f=void 0===h?1:h,p=e.aspect,d=void 0===p?1:p,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,_=e.fov,b=void 0===_?0:_;this.zoom=n,this.center=u;var x=i*EU,S=(360-a)*EU;vS(this.projectionMatrix,b,d,g,y);var E=TS(f*Math.sin(x)*Math.sin(S),-f*Math.sin(x)*Math.cos(S),f*Math.cos(x)),A=TS(-Math.cos(x)*Math.sin(S),Math.cos(x)*Math.cos(S),Math.sin(x));yS(this.viewMatrix,E,TS(0,0,0),A),this.viewUncenteredMatrix=tS(this.viewMatrix),aS(this.viewMatrix,this.viewMatrix,TS(-l[0],l[1],0)),oS(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),oS(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var e=D(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e){var t=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),n=Math.PI/180,r=e[0]*n,i=t*n;i=Math.log(Math.tan(Math.PI/4+i/2));return[r=(256<<20)*(.5/Math.PI*r+.5)-215440491,i=-((256<<20)*(-.5/Math.PI*i+(n=.5))-106744817)]}}]),e}(),wU=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];window.forceWebGL=!0;var TU,CU=!1,kU=[],MU=vw()(xU=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"version",Sz["GAODE1.x"]),E(I(e),"viewport",void 0),E(I(e),"handleCameraChanged",(function(t){var n=t.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,c=n.aspect,l=n.position,h=e.getCenter(),f=h.lng,p=h.lat;if(e.emit("mapchange"),e.cameraChangedCallback){e.viewport.syncWithMapCamera({aspect:c,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:e.map.getZoom()-1,center:[f,p],offsetOrigin:[l.x,l.y]});var d=e.config.offsetZoom,v=void 0===d?12:d;e.viewport.getZoom()>v?e.coordinateSystemService.setCoordinateSystem(OI.P20_OFFSET):e.coordinateSystemService.setCoordinateSystem(OI.P20),e.cameraChangedCallback(e.viewport)}})),e}return S(r,[{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=eS();return aS(o,o,TS(i[0],i[1],t)),sS(o,o,TS(r[0],r[1],r[2])),uS(o,o,n[0]),cS(o,o,n[1]),lS(o,o,n[2]),o}},{key:"init",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f,p,d,m=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,c=t.token,l=void 0===c?"15cd8a57710d40c9b7c0e3cc120f1200":c,h=t.mapInstance,f=t.plugin,p=void 0===f?[]:f,d=P(t,wU),e.next=3,new Promise((function(e){var t=function(){if(h)m.map=h,m.$mapContainer=m.map.getContainer(),setTimeout((function(){m.map.on("camerachange",m.handleCameraChanged),e()}),30);else{m.$mapContainer=m.creatMapContainer(n);var t=v({mapStyle:m.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);t.zoom&&(t.zoom+=1);var r=new AMap.Map(m.$mapContainer,t);r.on("camerachange",m.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return m.handleAfterMapChange()}))})),m.map=r,setTimeout((function(){e()}),10)}};CU||h?CU&&window.AMap||h?t():kU.push(t):("15cd8a57710d40c9b7c0e3cc120f1200"===l&&console.warn(m.configService.getSceneWarninfo("MapToken")),CU=!0,p.push("Map3D"),SU.load({key:l,version:"1.4.15",plugins:p}).then((function(e){t(),kU.length&&(kU.forEach((function(e){return e()})),kU=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new AU;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(k(AMap.LngLat,F(e)),k(AMap.LngLat,F(t))),r=D(this.lngLatToCoord(e),2),i=r[0],o=r[1],a=D(this.lngLatToCoord(t),2),s=a[0],u=a[1];return Math.sqrt(Math.pow(i-s,2)+Math.pow(o-u,2))/n}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}}]),r}(mU))||xU,PU=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getServiceConstructor",value:function(){return MU}}]),n}(bz),IU=function(){function e(){b(this,e),E(this,"projectionMatrix",eS()),E(this,"viewMatrix",eS()),E(this,"viewProjectionMatrix",eS()),E(this,"ViewProjectionMatrixUncentered",eS()),E(this,"viewUncenteredMatrix",eS()),E(this,"zoom",void 0),E(this,"center",void 0)}return S(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.center,i=void 0===r?[0,0]:r,o=e.offsetOrigin,a=void 0===o?[0,0]:o,s=e.cameraPosition,u=void 0===s?[0,0,0]:s,c=e.up,l=void 0===c?[0,1,0]:c,h=e.lookAt,f=void 0===h?[0,0,0]:h,p=e.aspect,d=void 0===p?1:p,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,_=e.fov,b=void 0===_?45:_;this.zoom=n,this.center=i,vS(this.projectionMatrix,b/180*Math.PI,d,g,y);var x=TS.apply(qS,F(u)),S=TS.apply(qS,F(f)),E=TS.apply(qS,F(l));yS(this.viewMatrix,x,S,E),this.viewUncenteredMatrix=tS(this.viewMatrix),aS(this.viewMatrix,this.viewMatrix,TS(-a[0],a[1],0)),oS(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),oS(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var e=D(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1.2}},{key:"projectFlat",value:function(e){var t=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),n=Math.PI/180,r=e[0]*n,i=t*n;i=Math.log(Math.tan(Math.PI/4+i/2));return[r=(256<<20)*(.5/Math.PI*r+.5)-215440491,i=-((256<<20)*(-.5/Math.PI*i+(n=.5))-106744817)]}}]),e}(),LU=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"],OU=[108.92361,34.54083];window.forceWebGL=!0;var RU=vw()(TU=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"version",Sz["GAODE2.x"]),E(I(e),"sceneCenter",void 0),E(I(e),"sceneCenterMercator",void 0),E(I(e),"viewport",void 0),E(I(e),"handleViewChanged",(function(t){var n=e.map.customCoords.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,c=n.up;e.emit("mapchange");var l=e.map.customCoords.getCenter();e.cameraChangedCallback&&(e.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,up:c,near:i,zoom:e.map.getZoom()-1,center:l,offsetOrigin:[s[0],s[1]]}),e.coordinateSystemService.setCoordinateSystem(OI.P20_2),e.cameraChangedCallback(e.viewport))})),e}return S(r,[{key:"setCustomCoordCenter",value:function(e){this.sceneCenter=e,this.sceneCenterMercator=t_.apply(void 0,F(e))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMercator}},{key:"lngLatToCoordByLayer",value:function(e,t){var n=t||this.sceneCenterMercator,r=this._sub(t_(e[0],e[1]),n);return e[2]&&r.push(e[2]),r}},{key:"coordToAMap2RelativeCoordinates",value:function(e,t){var n=this,r=t_(t[0],t[1]);return"number"==typeof e[0]?this.lngLatToCoordByLayer(e,r):e.map((function(e){return Array.isArray(e)&&"number"==typeof e[0]?n.lngLatToCoordByLayer(e,r):e.map((function(e){return n.lngLatToCoordByLayer(e,r)}))}))}},{key:"setCoordCenter",value:function(e){this.map.customCoords.setCenter(e||OU),this.setCustomCoordCenter(e||OU)}},{key:"lngLatToCoord",value:function(e){return this.sceneCenter||(this.map.customCoords.setCenter(e),this.setCustomCoordCenter(e)),this._sub(t_(e[0],e[1]),this.sceneCenterMercator)}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return"number"==typeof e[0]?t.lngLatToCoord(e):e.map((function(e){return t.lngLatToCoord(e)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];t.style.zIndex="auto",this.markerContainer=Bm("div","l7-marker-container2",t)}}}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"lngLatToContainer",value:function(e){var t=this.map.lngLatToContainer(e);return{x:t.getX(),y:t.getY()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lngLatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(e),o=eS();return aS(o,o,TS(i[0],i[1],t)),sS(o,o,TS(r[0],r[1],r[2])),uS(o,o,n[0]),cS(o,o,n[1]),lS(o,o,n[2]),o}},{key:"init",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f,p,d,m,y,_,b,x,S;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,c=t.token,l=void 0===c?"ff533602d57df6f8ab3b0fea226ae52f":c,h=t.mapInstance,f=t.plugin,p=void 0===f?[]:f,t.version,d=P(t,LU),this.viewport=new IU,window.AMap||h){e.next=6;break}return p.push("Map3D"),e.next=6,xz.load({key:l,version:"2.0",plugins:p});case 6:h?(this.map=h,this.$mapContainer=this.map.getContainer(),y=this.map.getCenter(),null===(m=this.map.customCoords)||void 0===m||m.setCenter([y.lng,y.lat]),this.setCustomCoordCenter([y.lng,y.lat]),this.map.on("viewchange",this.handleViewChanged)):(this.$mapContainer=this.creatMapContainer(n),(b=v({mapStyle:this.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d)).zoom&&(b.zoom+=1),"ff533602d57df6f8ab3b0fea226ae52f"===l&&console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),x=new AMap.Map(this.$mapContainer,b),this.map=x,S=x.getCenter(),null===(_=this.map.customCoords)||void 0===_||_.setCenter([S.lng,S.lat]),this.setCustomCoordCenter([S.lng,S.lat]),x.on("viewchange",this.handleViewChanged)),this.initViewPort();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"initViewPort",value:function(){var e,t=null===(e=this.map.customCoords)||void 0===e?void 0:e.getCameraParams(),n=t.fov,r=t.near,i=t.far,o=t.aspect,a=t.position,s=t.lookAt,u=t.up;this.emit("mapchange");var c=this.map.customCoords.getCenter(),l=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:n,cameraPosition:a,lookAt:s,near:r,up:u,zoom:l-1,center:c,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(OI.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(e,t){var n=[0,0];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}}]),r}(mU))||TU,NU=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getServiceConstructor",value:function(){return RU}}]),n}(bz);ar({target:"Math",stat:!0},{sign:fI});var DU,FU=BU;function BU(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}function zU(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function UU(e,t,n){return Math.min(n,Math.max(t,e))}function jU(e,t,n){return e*(1-n)+t*n}function VU(e,t,n,r){var i=new FU(e,t,n,r);return function(e){return i.solve(e)}}BU.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},BU.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},BU.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},BU.prototype.solveCurveX=function(e,t){var n,r,i,o,a;for(void 0===t&&(t=1e-6),i=e,a=0;a<8;a++){if(o=this.sampleCurveX(i)-e,Math.abs(o)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-e)<t)return i;e>o?n=i:r=i,i=.5*(r-n)+n}return i},BU.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var GU=VU(.25,.1,.25,1);function HU(){return!(Bd||!Ud.matchMedia)&&(null==DU&&(DU=Ud.matchMedia("(prefers-reduced-motion: reduce)")),DU.matches)}function WU(e,t){var n,r={},i=U(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in e&&(r[o]=e[o])}}catch(e){i.e(e)}finally{i.f()}return r}var YU=Bd?Date.now.bind(Date):Ud.performance&&Ud.performance.now?Ud.performance.now.bind(Ud.performance):Date.now.bind(Date),XU=Ud.requestAnimationFrame||Ud.mozRequestAnimationFrame||Ud.webkitRequestAnimationFrame||Ud.msRequestAnimationFrame,ZU=Ud.cancelAnimationFrame||Ud.mozCancelAnimationFrame||Ud.webkitCancelAnimationFrame||Ud.msCancelAnimationFrame;function qU(e){var t=XU(e);return{cancel:function(){return ZU(t)}}}var KU=function(){function e(t,n){if(b(this,e),E(this,"lng",void 0),E(this,"lat",void 0),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return S(e,[{key:"wrap",value:function(){return new e(zU(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return 6371008.8*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"===m(t)&&null!==t){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),QU=function(){function e(t,n){b(this,e),E(this,"ne",void 0),E(this,"sw",void 0),t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return S(e,[{key:"setNorthEast",value:function(e){return this.ne=e instanceof KU?new KU(e.lng,e.lat):KU.convert(e),this}},{key:"setSouthWest",value:function(e){return this.sw=e instanceof KU?new KU(e.lng,e.lat):KU.convert(e),this}},{key:"extend",value:function(t){var n,r,i=this.sw,o=this.ne;if(t instanceof KU)n=t,r=t;else{if(!(t instanceof e)){if(Array.isArray(t)){if(4===t.length||t.every(Array.isArray)){var a=t;return this.extend(e.convert(a))}var s=t;return this.extend(KU.convert(s))}return this}if(n=t.sw,r=t.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new KU(n.lng,n.lat),this.ne=new KU(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new KU((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new KU(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new KU(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(e){var t=KU.convert(e),n=t.lng,r=t.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),$U=function(){function e(t,n){b(this,e),E(this,"x",void 0),E(this,"y",void 0),this.x=t,this.y=n}return S(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"add",value:function(e){return this.clone()._add(e)}},{key:"_sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"sub",value:function(e){return this.clone()._sub(e)}},{key:"_multByPoint",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multByPoint",value:function(e){return this.clone()._multByPoint(e)}},{key:"_divByPoint",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divByPoint",value:function(e){return this.clone()._divByPoint(e)}},{key:"_mult",value:function(e){return this.x*=e,this.y*=e,this}},{key:"mult",value:function(e){return this.clone()._mult(e)}},{key:"_div",value:function(e){return this.x/=e,this.y/=e,this}},{key:"div",value:function(e){return this.clone()._div(e)}},{key:"_rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(e){return this.clone()._rotate(e)}},{key:"_rotateAround",value:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(e,t){return this.clone()._rotateAround(e,t)}},{key:"_matMult",value:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this}},{key:"matMult",value:function(e){return this.clone()._matMult(e)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var e=this.y;return this.y=this.x,this.x=-e,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"dist",value:function(e){return Math.sqrt(this.distSqr(e))}},{key:"distSqr",value:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(e){return Math.atan2(this.y-e.y,this.x-e.x)}},{key:"angleWith",value:function(e){return this.angleWithSep(e.x,e.y)}},{key:"angleWithSep",value:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}]),e}();ar({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return qe(URL.prototype.toString,this)}}),ic("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}})),ic("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var JU=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(b(this,e),E(this,"top",void 0),E(this,"bottom",void 0),E(this,"left",void 0),E(this,"right",void 0),isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=r,this.right=i}return S(e,[{key:"interpolate",value:function(e,t,n){return null!=t.top&&null!=e.top&&(this.top=jU(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=jU(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=jU(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=jU(e.right,t.right,n)),this}},{key:"getCenter",value:function(e,t){var n=UU((this.left+e-this.right)/2,0,e),r=UU((this.top+t-this.bottom)/2,0,t);return new $U(n,r)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),ej=2*Math.PI*6371008.8;function tj(e){return ej*Math.cos(e*Math.PI/180)}function nj(e){return(180+e)/360}function rj(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ij(e,t){return e/tj(t)}function oj(e){var t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}var aj=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b(this,e),E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),this.x=+t,this.y=+n,this.z=+r}return S(e,[{key:"toLngLat",value:function(){return new KU(360*this.x-180,oj(this.y))}},{key:"toAltitude",value:function(){return e=this.z,t=this.y,e*tj(oj(t));var e,t}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/ej*(e=oj(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=KU.convert(t);return new e(nj(r.lng),rj(r.lat),ij(n,r.lat))}}]),e}(),sj=function(){function e(t,n,r,i,o){b(this,e),E(this,"tileSize",void 0),E(this,"tileZoom",void 0),E(this,"lngRange",void 0),E(this,"latRange",void 0),E(this,"maxValidLatitude",void 0),E(this,"scale",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"angle",void 0),E(this,"rotationMatrix",void 0),E(this,"pixelsToGLUnits",void 0),E(this,"cameraToCenterDistance",void 0),E(this,"mercatorMatrix",void 0),E(this,"projMatrix",void 0),E(this,"invProjMatrix",void 0),E(this,"alignedProjMatrix",void 0),E(this,"pixelMatrix",void 0),E(this,"pixelMatrixInverse",void 0),E(this,"glCoordMatrix",void 0),E(this,"labelPlaneMatrix",void 0),E(this,"_fov",void 0),E(this,"_pitch",void 0),E(this,"_zoom",void 0),E(this,"_renderWorldCopies",void 0),E(this,"_minZoom",void 0),E(this,"_maxZoom",void 0),E(this,"_minPitch",void 0),E(this,"_maxPitch",void 0),E(this,"_center",void 0),E(this,"zoomFraction",void 0),E(this,"unmodified",void 0),E(this,"edgeInsets",void 0),E(this,"constraining",void 0),E(this,"posMatrixCache",void 0),E(this,"alignedPosMatrixCache",void 0),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new KU(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new JU,this.posMatrixCache={},this.alignedPosMatrixCache={}}return S(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this._pitch=Math.max(this._pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this._pitch=Math.min(this._pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new $U(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(e){var t,n=-zU(e,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(t=new $x(4),$x!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t),function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=r*-s+o*u,e[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(e){var t=UU(e,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==t&&(this.unmodified=!1,this._pitch=t,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this.unmodified=!1,this._fov=e/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this._minZoom),this._maxZoom);this._zoom!==t&&(this.unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this.unmodified=!1,this._center=e,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(e){this.edgeInsets.equals(e)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,e,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(e){return this.edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this.unmodified=!1,this.edgeInsets.interpolate(e,t,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(e){var t=UU(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new $U(nj(e.lng)*this.worldSize,rj(t)*this.worldSize)}},{key:"unproject",value:function(e){return new aj(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(e,t){var n=this.pointCoordinate(t),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(e),o=new aj(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(e){var t=new Float64Array([e.x,e.y,0,1]),n=new Float64Array([e.x,e.y,1,1]);$S(t,t,this.pixelMatrixInverse),$S(n,n,this.pixelMatrixInverse);var r=t[3],i=n[3],o=t[0]/r,a=n[0]/i,s=t[1]/r,u=n[1]/i,c=t[2]/r,l=n[2]/i,h=c===l?0:(0-c)/(l-c);return new aj(jU(o,a,h)/this.worldSize,jU(s,u,h)/this.worldSize)}},{key:"getBounds",value:function(){return(new QU).extend(this.pointLocation(new $U(0,0))).extend(this.pointLocation(new $U(this.width,0))).extend(this.pointLocation(new $U(this.width,this.height))).extend(this.pointLocation(new $U(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new QU([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new $U(0,0)),t=new Float32Array([e.x*this.worldSize,e.y*this.worldSize,0,1]);return $S(t,t,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var e=this._pitch,t=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new $U(0,t))}},{key:"getCameraQueryGeometry",value:function(e){var t=this.getCameraPoint();if(1===e.length)return[e[0],t];var n,r=t.x,i=t.y,o=t.x,a=t.y,s=U(e);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(e){s.e(e)}finally{s.f()}return[new $U(r,i),new $U(o,i),new $U(o,a),new $U(r,a),new $U(r,i)]}},{key:"coordinatePoint",value:function(e){var t=QS(e.x*this.worldSize,e.y*this.worldSize,0,1);return $S(t,t,this.pixelMatrix),new $U(t[0]/t[3],t[1]/t[3])}},{key:"locationPoint",value:function(e){return this.coordinatePoint(this.locationCoordinate(e))}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"locationCoordinate",value:function(e){return aj.fromLngLat(e)}},{key:"coordinateLocation",value:function(e){return e.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var e,t,n,r,i=-90,o=90,a=-180,s=180,u=this.size,c=this.unmodified;if(this.latRange){var l=this.latRange;i=rj(l[1])*this.worldSize,e=(o=rj(l[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var h=this.lngRange;a=nj(h[0])*this.worldSize,t=(s=nj(h[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var f=this.point,p=Math.max(t||0,e||0);if(p)return this.center=this.unproject(new $U(t?(s+a)/2:f.x,e?(o+i)/2:f.y)),Bd?this.zoom=Math.max(this.zoom,Math.max(-1,this.minZoom)):this.zoom+=this.scaleZoom(p),this.unmodified=c,void(this.constraining=!1);if(this.latRange){var d=f.y,v=u.y/2;d-v<i&&(r=i+v),d+v>o&&(r=o-v)}if(this.lngRange){var g=f.x,m=u.x/2;g-m<a&&(n=a+m),g+m>s&&(n=s-m)}void 0===n&&void 0===r||(this.center=this.unproject(new $U(void 0!==n?n:f.x,void 0!==r?r:f.y))),this.unmodified=c,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var e=this._fov/2,t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(e)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(UU(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),c=this.height/50,l=new Float64Array(16);vS(l,this._fov,this.width/this.height,c,u),l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,sS(l,l,[1,-1,1]),aS(l,l,[0,0,-this.cameraToCenterDistance]),uS(l,l,this._pitch),lS(l,l,this.angle),aS(l,l,[-a,-s,0]),this.mercatorMatrix=sS([],l,[this.worldSize,this.worldSize,this.worldSize]),sS(l,l,[1,1,ij(1,this.center.lat)*this.worldSize,1]),this.projMatrix=l,this.invProjMatrix=iS([],this.projMatrix);var h=this.width%2/2,f=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+p*h+d*f,g=s-Math.round(s)+p*f+d*h,m=new Float64Array(l);if(aS(m,m,[v>.5?v-1:v,g>.5?g-1:g,0]),this.alignedProjMatrix=m,sS(l=eS(),l,[this.width/2,-this.height/2,1]),aS(l,l,[1,-1,0]),this.labelPlaneMatrix=l,sS(l=eS(),l,[1,-1,1]),aS(l,l,[-1,-1,0]),sS(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l,this.pixelMatrix=oS(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(l=iS(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),uj=S((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b(this,e),E(this,"type",void 0),rI(this,n),this.type=t})),cj=function(e){A(n,e);var t=O(n);function n(e){var r;b(this,n),E(I(r=t.call(this)),"transform",void 0),E(I(r),"options",void 0),E(I(r),"moving",void 0),E(I(r),"zooming",void 0),E(I(r),"rotating",void 0),E(I(r),"pitching",void 0),E(I(r),"padding",void 0),E(I(r),"bearingSnap",void 0),E(I(r),"easeEndTimeoutID",void 0),E(I(r),"easeStart",void 0),E(I(r),"easeOptions",void 0),E(I(r),"easeId",void 0),E(I(r),"onEaseFrame",void 0),E(I(r),"onEaseEnd",void 0),E(I(r),"easeFrameId",void 0),E(I(r),"pitchEnabled",void 0),E(I(r),"rotateEnabled",void 0),E(I(r),"renderFrameCallback",(function(){var e=Math.min((YU()-r.easeStart)/r.easeOptions.duration,1);r.onEaseFrame(r.easeOptions.easing(e)),e<1?r.easeFrameId=r.requestRenderFrame(r.renderFrameCallback):r.stop()})),r.options=e;var i=e.minZoom,o=e.maxZoom,a=e.minPitch,s=e.maxPitch,u=e.renderWorldCopies;return r.moving=!1,r.zooming=!1,r.bearingSnap=e.bearingSnap,r.pitchEnabled=e.pitchEnabled,r.rotateEnabled=e.rotateEnabled,r.transform=new sj(i,o,a,s,u),r}return S(n,[{key:"requestRenderFrame",value:function(e){return 0}},{key:"cancelRenderFrame",value:function(e){}},{key:"getCenter",value:function(){var e=this.transform.center,t=e.lng,n=e.lat;return new KU(t,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(e,t,n){return this.easeTo(rI({center:e},t),n)}},{key:"panBy",value:function(e,t,n){return e=$U.convert(e).mult(-1),this.panTo(this.transform.center,function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];for(var s in a)void 0!==a[s]&&(e[s]=a[s])}return e}({offset:e},t||{}),n)}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomTo",value:function(e,t,n){return this.easeTo(rI({zoom:e},t),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(e,t,n){return this.easeTo(rI({bearing:e},t),n)}},{key:"resetNorth",value:function(e,t){return this.rotateTo(0,rI({duration:1e3},e),t),this}},{key:"resetNorthPitch",value:function(e,t){return this.easeTo(rI({bearing:0,pitch:0,duration:1e3},e),t),this}},{key:"fitBounds",value:function(e,t,n){return this.fitInternal(this.cameraForBounds(e,t),t,n)}},{key:"cameraForBounds",value:function(e,t){return e=QU.convert(e),this.cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,t)}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(e,t):this}},{key:"jumpTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return void 0!==e.zoom&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=KU.convert(e.center)),void 0!==e.bearing&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),void 0!==e.pitch&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),void 0===e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.emit("movestart",new uj("movestart",t)),this.emit("move",new uj("move",t)),r&&(this.emit("zoomstart",new uj("zoomstart",t)),this.emit("zoom",new uj("zoom",t)),this.emit("zoomend",new uj("zoomend",t))),i&&(this.emit("rotatestart",new uj("rotatestart",t)),this.emit("rotate",new uj("rotate",t)),this.emit("rotateend",new uj("rotateend",t))),o&&(this.emit("pitchstart",new uj("pitchstart",t)),this.emit("pitch",new uj("pitch",t)),this.emit("pitchend",new uj("pitchend",t))),this.emit("moveend",new uj("moveend",t))}},{key:"easeTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(t=rI({offset:[0,0],duration:500,easing:GU},t)).animate||!t.essential&&HU())&&(t.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=t.zoom?+t.zoom:i,c=t.bearing?this.normalizeBearing(t.bearing,o):o,l=t.pitch?+t.pitch:a,h=t.padding?t.padding:r.padding,f=$U.convert(t.offset),p=r.centerPoint.add(f),d=r.pointLocation(p),v=KU.convert(t.center||d);this.normalizeCenter(v);var g,m,y=r.project(d),_=r.project(v).sub(y),b=r.zoomScale(u-i);t.around&&(g=KU.convert(t.around),m=r.locationPoint(g));var x={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==c,this.pitching=this.pitching||l!==a,this.padding=!r.isPaddingEqual(h),this.easeId=t.easeId,this.prepareEase(n,t.noMoveStart,x),clearTimeout(this.easeEndTimeoutID),this.ease((function(t){if(e.zooming&&(r.zoom=jU(i,u,t)),e.rotating&&e.rotateEnabled&&(r.bearing=jU(o,c,t)),e.pitching&&e.pitchEnabled&&(r.pitch=jU(a,l,t)),e.padding&&(r.interpolatePadding(s,h,t),p=r.centerPoint.add(f)),g)r.setLocationAtPoint(g,m);else{var d=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,b):Math.max(.5,b),x=Math.pow(v,1-t),S=r.unproject(y.add(_.mult(t*x)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?S.wrap():S,p)}e.fireMoveEvents(n)}),(function(t){e.afterEase(n,t)}),t),this}},{key:"flyTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!t.essential&&HU()){var r=WU(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),t=rI({offset:[0,0],speed:1.2,curve:1.42,easing:GU},t);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),c=t.zoom?UU(+t.zoom,i.minZoom,i.maxZoom):o,l=t.bearing?this.normalizeBearing(t.bearing,a):a,h=t.pitch?+t.pitch:s,f="padding"in t?t.padding:i.padding,p=i.zoomScale(c-o),d=$U.convert(t.offset),v=i.centerPoint.add(d),g=i.pointLocation(v),m=KU.convert(t.center||g);this.normalizeCenter(m);var y=i.project(g),_=i.project(m).sub(y),b=t.curve,x=Math.max(i.width,i.height),S=x/p,E=_.mag();if("minZoom"in t){var A=UU(Math.min(t.minZoom,o,c),i.minZoom,i.maxZoom),w=x/i.zoomScale(A-o);b=Math.sqrt(w/E*2)}var T=b*b;function C(e){var t=(S*S-x*x+(e?-1:1)*T*T*E*E)/(2*(e?S:x)*T*E);return Math.log(Math.sqrt(t*t+1)-t)}function k(e){return(Math.exp(e)-Math.exp(-e))/2}function M(e){return(Math.exp(e)+Math.exp(-e))/2}function P(e){return k(e)/M(e)}var I=C(0),L=function(e){return M(I)/M(I+b*e)},O=function(e){return x*((M(I)*P(I+b*e)-k(I))/T)/E},R=(C(1)-I)/b;if(Math.abs(E)<1e-6||!isFinite(R)){if(Math.abs(x-S)<1e-6)return this.easeTo(t,n);var N=S<x?-1:1;R=Math.abs(Math.log(S/x))/b,O=function(){return 0},L=function(e){return Math.exp(N*b*e)}}if("duration"in t)t.duration=+t.duration;else{var D="screenSpeed"in t?+t.screenSpeed/b:+t.speed;t.duration=1e3*R/D}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this.zooming=!0,this.rotating=a!==l,this.pitching=h!==s,this.padding=!i.isPaddingEqual(f),this.prepareEase(n,!1),this.ease((function(t){var r=t*R,p=1/L(r);i.zoom=1===t?c:o+i.scaleZoom(p),e.rotating&&(i.bearing=jU(a,l,t)),e.pitching&&(i.pitch=jU(s,h,t)),e.padding&&(i.interpolatePadding(u,f,t),v=i.centerPoint.add(d));var g=1===t?m:i.unproject(y.add(_.mult(O(r))).mult(p));i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,v),e.fireMoveEvents(n)}),(function(){return e.afterEase(n)}),t),this}},{key:"fitScreenCoordinates",value:function(e,t,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation($U.convert(e)),this.transform.pointLocation($U.convert(t)),n,r),r,i)}},{key:"stop",value:function(e,t){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,t)}return this}},{key:"normalizeBearing",value:function(e,t){e=zU(e,-180,180);var n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}},{key:"normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(e){this.emit("move",new uj("move",e)),this.zooming&&this.emit("zoom",new uj("zoom",e)),this.rotating&&this.emit("rotate",new uj("rotate",e)),this.pitching&&this.emit("rotate",new uj("pitch",e))}},{key:"prepareEase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,t||n.moving||this.emit("movestart",new uj("movestart",e)),this.zooming&&!n.zooming&&this.emit("zoomstart",new uj("zoomstart",e)),this.rotating&&!n.rotating&&this.emit("rotatestart",new uj("rotatestart",e)),this.pitching&&!n.pitching&&this.emit("pitchstart",new uj("pitchstart",e))}},{key:"afterEase",value:function(e,t){if(!this.easeId||!t||this.easeId!==t){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new uj("zoomend",e)),r&&this.emit("rotateend",new uj("rotateend",e)),i&&this.emit("pitchend",new uj("pitchend",e)),this.emit("moveend",new uj("moveend",e))}}},{key:"ease",value:function(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this.easeStart=YU(),this.easeOptions=n,this.onEaseFrame=e,this.onEaseEnd=t,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(e,t,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=rI({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=rI(i,r.padding);var a=this.transform,s=a.padding,u=a.project(KU.convert(e)),c=a.project(KU.convert(t)),l=u.rotate(-n*Math.PI/180),h=c.rotate(-n*Math.PI/180),f=new $U(Math.max(l.x,h.x),Math.max(l.y,h.y)),p=new $U(Math.min(l.x,h.x),Math.min(l.y,h.y)),d=f.sub(p),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,g=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(g<0||v<0)){var m=Math.min(a.scaleZoom(a.scale*Math.min(v,g)),r.maxZoom),y=$U.convert(r.offset),_=(r.padding.left-r.padding.right)/2,b=(r.padding.top-r.padding.bottom)/2,x=new $U(y.x+_,y.y+b).mult(a.scale/a.zoomScale(m));return{center:a.unproject(u.add(c).div(2).sub(x)),zoom:m,bearing:n}}}},{key:"fitInternal",value:function(e,t,n){return e?(delete(t=rI(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}}]),n}(Q_);vB(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: -moz-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var lj={create:function(e,t,n){var r=Ud.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r},createNS:function(e,t){return Ud.document.createElementNS(e,t)}},hj=Ud.document&&Ud.document.documentElement.style;function fj(e){if(!hj)return e[0];var t,n=U(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r in hj)return r}}catch(e){n.e(e)}finally{n.f()}return e[0]}var pj,dj=fj(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);lj.disableDrag=function(){hj&&dj&&(pj=hj[dj],hj[dj]="none")},lj.enableDrag=function(){hj&&dj&&(hj[dj]=pj)};var vj=fj(["transform","WebkitTransform"]);lj.setTransform=function(e,t){e.style[vj]=t};var gj=!1;try{var mj=Object.defineProperty({},"passive",{get:function(){gj=!0}});Ud.addEventListener("test",mj,mj),Ud.removeEventListener("test",mj,mj)}catch(e){gj=!1}lj.addEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&gj?e.addEventListener(t,n,r):e.addEventListener(t,n,r.capture)},lj.removeEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&gj?e.removeEventListener(t,n,r):e.removeEventListener(t,n,r.capture)};var yj=function e(t){t.preventDefault(),t.stopPropagation(),Ud.removeEventListener("click",e,!0)};lj.suppressClick=function(){Bd||(Ud.addEventListener("click",yj,!0),setTimeout((function(){Ud.removeEventListener("click",yj,!0)}),0))},lj.mousePos=function(e,t){if(Bd)return new $U(t.clientX-e.left-0,t.clientY-e.top-0);var n=e.getBoundingClientRect();return new $U(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},lj.touchPos=function(e,t){if(Bd){var n,r=[],i=U(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;r.push(new $U(o.clientX-e.left,o.clientY-e.top))}}catch(e){i.e(e)}finally{i.f()}return r}var a,s=e.getBoundingClientRect(),u=[],c=U(t);try{for(c.s();!(a=c.n()).done;){var l=a.value;u.push(new $U(l.clientX-s.left-e.clientLeft,l.clientY-s.top-e.clientTop))}}catch(e){c.e(e)}finally{c.f()}return u},lj.mouseButton=function(e){return Bd&&void 0!==Ud.InstallTrigger&&2===e.button&&e.ctrlKey&&Ud.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},lj.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var _j=function(e){A(n,e);var t=O(n);function n(e,r,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};b(this,n);var s=lj.mousePos(r.getCanvasContainer(),i),u=r.unproject(s);return E(I(o=t.call(this,e,rI({point:s,lngLat:u,originalEvent:i},a))),"type",void 0),E(I(o),"target",void 0),E(I(o),"originalEvent",void 0),E(I(o),"point",void 0),E(I(o),"lngLat",void 0),E(I(o),"defaultPrevented",void 0),o.defaultPrevented=!1,o.target=r,o}return S(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(uj),bj=function(e){A(n,e);var t=O(n);function n(e,r,i){var o;b(this,n);var a="touchend"===e?i.changedTouches:i.touches,s=lj.touchPos(r.getCanvasContainer(),a),u=s.map((function(e){return r.unproject(e)})),c=s.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new $U(0,0)),l=r.unproject(c);return E(I(o=t.call(this,e,{points:s,point:c,lngLats:u,lngLat:l,originalEvent:i})),"type",void 0),E(I(o),"target",void 0),E(I(o),"originalEvent",void 0),E(I(o),"lngLat",void 0),E(I(o),"point",void 0),E(I(o),"points",void 0),E(I(o),"lngLats",void 0),E(I(o),"defaultPrevented",void 0),o.defaultPrevented=!1,o}return S(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(uj),xj=function(e){A(n,e);var t=O(n);function n(e,r,i){var o;return b(this,n),E(I(o=t.call(this,e,{originalEvent:i})),"type",void 0),E(I(o),"originalEvent",void 0),E(I(o),"defaultPrevented",void 0),E(I(o),"target",void 0),o.defaultPrevented=!1,o}return S(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(uj),Sj=function(){function e(t){b(this,e),E(this,"map",void 0),E(this,"delayContextMenu",void 0),E(this,"contextMenuEvent",void 0),this.map=t}return S(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(e){this.map.emit(e.type,new _j(e.type,this.map,e))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new _j("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(e){this.delayContextMenu?this.contextMenuEvent=e:this.map.emit(e.type,new _j(e.type,this.map,e)),this.map.listeners("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),Ej=function(){function e(t,n){b(this,e),E(this,"map",void 0),E(this,"el",void 0),E(this,"container",void 0),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"startPos",void 0),E(this,"lastPos",void 0),E(this,"box",void 0),E(this,"clickTolerance",void 0),this.map=t,this.el=t.getCanvasContainer(),this.container=t.getContainer(),this.clickTolerance=n.clickTolerance||1}return S(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(lj.disableDrag(),this.startPos=this.lastPos=t,this.active=!0)}},{key:"mousemoveWindow",value:function(e,t){if(this.active){var n=t;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=lj.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",e));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);lj.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(e,t){var n=this;if(this.active&&0===e.button){var r=this.startPos,i=t;if(this.reset(),lj.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new uj("boxzoomend",{originalEvent:e})),{cameraAnimation:function(e){return e.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",e)}}},{key:"keydown",value:function(e){this.active&&27===e.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",e))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(lj.remove(this.box),this.box=null),lj.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(e,t){return this.map.emit(e,new uj(e,{originalEvent:t}))}}]),e}(),Aj=function(){function e(){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),this.reset()}return S(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),wj=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"type","renderFrame"),E(I(e),"timeStamp",void 0),e}return S(n)}(uj),Tj={linearity:.3,easing:VU(0,0,.3,1)},Cj=rI({deceleration:2500,maxSpeed:1400},Tj),kj=rI({deceleration:20,maxSpeed:1400},Tj),Mj=rI({deceleration:1e3,maxSpeed:360},Tj),Pj=rI({deceleration:1e3,maxSpeed:90},Tj),Ij=function(){function e(t){b(this,e),E(this,"map",void 0),E(this,"inertiaBuffer",void 0),this.map=t,this.clear()}return S(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(e){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:YU(),settings:e})}},{key:"drainInertiaBuffer",value:function(){for(var e=this.inertiaBuffer,t=YU();e.length>0&&t-e[0].time>160;)e.shift()}},{key:"onMoveEnd",value:function(e){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var t,n={zoom:0,bearing:0,pitch:0,pan:new $U(0,0),pinchAround:void 0,around:void 0},r=U(this.inertiaBuffer);try{for(r.s();!(t=r.n()).done;){var i=t.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(e){r.e(e)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=Oj(n.pan.mag(),o,rI({},Cj,e||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,Lj(a,s)}if(n.zoom){var u=Oj(n.zoom,o,kj);a.zoom=this.map.transform.zoom+u.amount,Lj(a,u)}if(n.bearing){var c=Oj(n.bearing,o,Mj);a.bearing=this.map.transform.bearing+UU(c.amount,-179,179),Lj(a,c)}if(n.pitch){var l=Oj(n.pitch,o,Pj);a.pitch=this.map.transform.pitch+l.amount,Lj(a,l)}if(a.zoom||a.bearing){var h=void 0===n.pinchAround?n.around:n.pinchAround;a.around=h?this.map.unproject(h):this.map.getCenter()}return this.clear(),rI(a,{noMoveStart:!0})}}}]),e}();function Lj(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Oj(e,t,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=UU(e*i/(t/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var Rj={panStep:100,bearingStep:15,pitchStep:10},Nj=function(){function e(){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"panStep",void 0),E(this,"bearingStep",void 0),E(this,"pitchStep",void 0);var t=Rj;this.panStep=t.panStep,this.bearingStep=t.bearingStep,this.pitchStep=t.pitchStep}return S(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Dj,zoom:n?Math.round(u)+n*(e.shiftKey?2:1):u,bearing:s.getBearing()+r*t.bearingStep,pitch:s.getPitch()+i*t.pitchStep,offset:[-o*t.panStep,-a*t.panStep],center:s.getCenter()},{originalEvent:e})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function Dj(e){return e*(2-e)}var Fj,Bj=function(){function e(t,n){b(this,e),E(this,"mousedownPos",void 0),E(this,"clickTolerance",void 0),E(this,"map",void 0),this.map=t,this.clickTolerance=n.clickTolerance}return S(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(e){return this.firePreventable(new xj(e.type,this.map,e))}},{key:"mousedown",value:function(e,t){return this.mousedownPos=t,this.firePreventable(new _j(e.type,this.map,e))}},{key:"mouseup",value:function(e){this.map.emit(e.type,new _j(e.type,this.map,e))}},{key:"click",value:function(e,t){this.mousedownPos&&this.mousedownPos.dist(t)>=this.clickTolerance||this.map.emit(e.type,new _j(e.type,this.map,e))}},{key:"dblclick",value:function(e){return this.firePreventable(new _j(e.type,this.map,e))}},{key:"mouseover",value:function(e){this.map.emit(e.type,new _j(e.type,this.map,e))}},{key:"mouseout",value:function(e){this.map.emit(e.type,new _j(e.type,this.map,e))}},{key:"touchstart",value:function(e){return this.firePreventable(new bj(e.type,this.map,e))}},{key:"touchmove",value:function(e){this.map.emit(e.type,new bj(e.type,this.map,e))}},{key:"touchend",value:function(e){this.map.emit(e.type,new bj(e.type,this.map,e))}},{key:"touchcancel",value:function(e){this.map.emit(e.type,new bj(e.type,this.map,e))}},{key:"firePreventable",value:function(e){if(this.map.emit(e.type,e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),zj=(E(Fj={},0,1),E(Fj,2,2),Fj);var Uj=function(){function e(t){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"lastPoint",void 0),E(this,"eventButton",void 0),E(this,"moved",void 0),E(this,"clickTolerance",void 0),this.reset(),this.clickTolerance=t.clickTolerance||1}return S(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(e,t){if(!this.lastPoint){var n=lj.mouseButton(e);this.correctButton(e,n)&&(this.lastPoint=t,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(e,t){var n=this.lastPoint;if(n)if(e.preventDefault(),function(e,t){var n=zj[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this.eventButton))this.reset();else if(this.moved||!(t.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=t,this.move(n,t)}},{key:"mouseupWindow",value:function(e){this.lastPoint&&(lj.mouseButton(e)===this.eventButton&&(this.moved&&lj.suppressClick(),this.reset()))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(e,t){return!1}},{key:"move",value:function(e,t){}}]),e}(),jj=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"mousedown",value:function(e,t){N(w(n.prototype),"mousedown",this).call(this,e,t),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(e,t){return{around:t,panDelta:t.sub(e)}}},{key:"correctButton",value:function(e,t){return 0===t&&!e.ctrlKey}}]),n}(Uj),Vj=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=-.5*(t.y-e.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),n}(Uj),Gj=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"contextmenu",value:function(e){e.preventDefault()}},{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=.8*(t.x-e.x);if(n)return this.active=!0,{bearingDelta:n}}}]),n}(Uj),Hj=function(){function e(t,n){var r=this;b(this,e),E(this,"map",void 0),E(this,"el",void 0),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"zooming",void 0),E(this,"aroundCenter",void 0),E(this,"around",void 0),E(this,"aroundPoint",void 0),E(this,"type",void 0),E(this,"lastValue",void 0),E(this,"timeout",void 0),E(this,"finishTimeout",void 0),E(this,"lastWheelEvent",void 0),E(this,"lastWheelEventTime",void 0),E(this,"startZoom",void 0),E(this,"targetZoom",void 0),E(this,"delta",void 0),E(this,"easing",void 0),E(this,"prevEase",void 0),E(this,"frameId",void 0),E(this,"handler",void 0),E(this,"defaultZoomRate",void 0),E(this,"wheelZoomRate",void 0),E(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var e=r.map.transform;if(0!==r.delta){var t="wheel"===r.type&&Math.abs(r.delta)>4.000244140625?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*t)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?e.zoomScale(r.targetZoom):e.scale;r.targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=e.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:e.zoom,s=r.startZoom,u=r.easing,c=!1;if("wheel"===r.type&&s&&u){var l=Math.min((YU()-r.lastWheelEventTime)/200,1);o=jU(s,a,u(l)),l<1?r.frameId||(r.frameId=!0):c=!0}else o=a,c=!0;return r.active=!0,c&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:o-e.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=t,this.el=t.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=1/450}return S(e,[{key:"setZoomRate",value:function(e){this.defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this.wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(e){this.isEnabled()||(this.enabled=!0,this.aroundCenter=e&&"center"===e.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(e){if(this.isEnabled()){var t=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=YU(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==t&&t%4.000244140625==0?this.type="wheel":0!==t&&Math.abs(t)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=t,this.timeout=setTimeout(this.onTimeout,40,e)):this.type||(this.type=Math.abs(r*t)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,t+=this.lastValue)),e.shiftKey&&t&&(t/=4),this.type&&(this.lastWheelEvent=e,this.delta-=t,this.active||this.start(e)),e.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(e){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(e)}},{key:"start",value:function(e){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var t=lj.mousePos(this.el,e);this.around=KU.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(t)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(e){var t=GU;if(this.prevEase){var n=this.prevEase,r=(YU()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;t=VU(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:YU(),duration:e,easing:t},t}}]),e}(),Wj=function(){function e(t,n){b(this,e),E(this,"clickZoom",void 0),E(this,"tapZoom",void 0),this.clickZoom=t,this.tapZoom=n}return S(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),Yj=function(){function e(t,n,r){b(this,e),E(this,"inertiaOptions",void 0),E(this,"el",void 0),E(this,"mousePan",void 0),E(this,"touchPan",void 0),this.el=t,this.mousePan=n,this.touchPan=r}return S(e,[{key:"enable",value:function(e){this.inertiaOptions=e||{},this.mousePan.enable(),this.touchPan.enable(),Bd||this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),Bd||this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),Xj=function(){function e(t,n,r){b(this,e),E(this,"mouseRotate",void 0),E(this,"mousePitch",void 0),E(this,"pitchWithRotate",void 0),this.pitchWithRotate=t.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return S(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),Zj=function(){function e(t,n,r,i){b(this,e),E(this,"el",void 0),E(this,"touchZoom",void 0),E(this,"touchRotate",void 0),E(this,"tapDragZoom",void 0),E(this,"rotationDisabled",void 0),E(this,"enabled",void 0),this.el=t,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return S(e,[{key:"enable",value:function(e){this.touchZoom.enable(e),this.rotationDisabled||this.touchRotate.enable(e),this.tapDragZoom.enable(),Bd||this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),Bd||this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function qj(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}var Kj=function(){function e(t){b(this,e),E(this,"numTouches",void 0),E(this,"centroid",void 0),E(this,"startTime",void 0),E(this,"aborted",void 0),E(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}return S(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){var t,n=new $U(0,0),r=U(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n._add(i)}}catch(e){r.e(e)}finally{r.f()}return n.div(e.length)}(t),this.touches=qj(n,t)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var r=qj(n,t);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),e}(),Qj=function(){function e(t){b(this,e),E(this,"singleTap",void 0),E(this,"numTaps",void 0),E(this,"lastTime",void 0),E(this,"lastTap",void 0),E(this,"count",void 0),this.singleTap=new Kj(t),this.numTaps=t.numTaps,this.reset()}return S(e,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),e}(),$j=function(){function e(){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"swipePoint",void 0),E(this,"swipeTouch",void 0),E(this,"tapTime",void 0),E(this,"tap",void 0),this.tap=new Qj({numTouches:1,numTaps:1}),this.reset()}return S(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(e,t,n){this.swipePoint||(this.tapTime&&e.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=t[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(e,t,n))}},{key:"touchmove",value:function(e,t,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=t[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,e.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(e,t,n)&&(this.tapTime=e.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),Jj=function(){function e(){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"zoomIn",void 0),E(this,"zoomOut",void 0),this.zoomIn=new Qj({numTouches:1,numTaps:2}),this.zoomOut=new Qj({numTouches:2,numTaps:1}),this.reset()}return S(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this.zoomIn.touchstart(e,t,n),this.zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.zoomIn.touchmove(e,t,n),this.zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this,i=this.zoomIn.touchend(e,t,n),o=this.zoomOut.touchend(e,t,n);return i?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):o?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(o)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),eV=function(){function e(t){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"touches",void 0),E(this,"minTouches",void 0),E(this,"clickTolerance",void 0),E(this,"sum",void 0),this.minTouches=1,this.clickTolerance=t.clickTolerance||1,this.reset()}return S(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new $U(0,0)}},{key:"touchstart",value:function(e,t,n){return this.calculateTransform(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this.active)return e.preventDefault(),this.calculateTransform(e,t,n)}},{key:"touchend",value:function(e,t,n){this.calculateTransform(e,t,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(e,t,n){n.length>0&&(this.active=!0);var r=qj(n,t),i=new $U(0,0),o=new $U(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],c=this.touches[s];c&&(i._add(u),o._add(u.sub(c)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var l=o.div(a);if(this.sum._add(l),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:l}}}}]),e}(),tV=function(){function e(){b(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"firstTwoTouches",void 0),E(this,"vector",void 0),E(this,"startVector",void 0),E(this,"aroundCenter",void 0),this.reset()}return S(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(e){}},{key:"move",value:function(e,t,n){}},{key:"touchstart",value:function(e,t,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){if(this.firstTwoTouches){e.preventDefault();var r=D(this.firstTwoTouches,2),i=r[0],o=r[1],a=nV(n,t,i),s=nV(n,t,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,e)}}}},{key:"touchend",value:function(e,t,n){if(this.firstTwoTouches){var r=D(this.firstTwoTouches,2),i=r[0],o=r[1],a=nV(n,t,i),s=nV(n,t,o);a&&s||(this.active&&lj.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this.enabled=!0,this.aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function nV(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function rV(e){return Math.abs(e.y)>Math.abs(e.x)}var iV=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"valid",void 0),E(I(e),"firstMove",void 0),E(I(e),"lastPoints",void 0),e}return S(n,[{key:"reset",value:function(){N(w(n.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(e){this.lastPoints=e,rV(e[0].sub(e[1]))&&(this.valid=!1)}},{key:"move",value:function(e,t,n){var r=e[0].sub(this.lastPoints[0]),i=e[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid){this.lastPoints=e,this.active=!0;return{pitchDelta:-.5*((r.y+i.y)/2)}}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this.valid)return this.valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=e.y>0==t.y>0;return rV(e)&&rV(t)&&o}}}]),n}(tV);function oV(e,t){return 180*e.angleWith(t)/Math.PI}var aV=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"minDiameter",void 0),e}return S(n,[{key:"reset",value:function(){N(w(n.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(e){this.startVector=this.vector=e[0].sub(e[1]),this.minDiameter=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.vector;if(this.vector=e[0].sub(e[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:oV(this.vector,n),pinchAround:t}}},{key:"isBelowThreshold",value:function(e){this.minDiameter=Math.min(this.minDiameter,e.mag());var t=25/(Math.PI*this.minDiameter)*360,n=oV(e,this.startVector);return Math.abs(n)<t}}]),n}(tV);function sV(e,t){return Math.log(e/t)/Math.LN2}var uV=function(e){A(n,e);var t=O(n);function n(){var e;b(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return E(I(e=t.call.apply(t,[this].concat(i))),"distance",void 0),E(I(e),"startDistance",void 0),e}return S(n,[{key:"reset",value:function(){N(w(n.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(e){this.startDistance=this.distance=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.distance;if(this.distance=e[0].dist(e[1]),this.active||!(Math.abs(sV(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:sV(this.distance,n),pinchAround:t}}}]),n}(tV),cV=function(e){return e.zoom||e.drag||e.pitch||e.rotate};function lV(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var hV,fV,pV,dV,vV,gV,mV,yV,_V,bV,xV,SV,EV,AV=function(){function e(t,n){var r=this;b(this,e),E(this,"map",void 0),E(this,"el",void 0),E(this,"handlers",void 0),E(this,"eventsInProgress",void 0),E(this,"frameId",void 0),E(this,"inertia",void 0),E(this,"bearingSnap",void 0),E(this,"handlersById",void 0),E(this,"updatingCamera",void 0),E(this,"changes",void 0),E(this,"previousActiveHandlers",void 0),E(this,"bearingChanged",void 0),E(this,"rotateEnabled",void 0),E(this,"pitchEnabled",void 0),E(this,"listeners",void 0),E(this,"handleWindowEvent",(function(e){r.handleEvent(e,"".concat(e.type,"Window"))})),E(this,"handleEvent",(function(e,t){if("blur"!==e.type){r.updatingCamera=!0;var n,i="renderFrame"===e.type?void 0:e,o={needsRenderFrame:!1},a={},s={},u=e.touches?r.getMapTouches(e.touches):void 0,c=u?lj.touchPos(r.el,u):lj.mousePos(r.el,e),l=U(r.handlers);try{for(l.s();!(n=l.n()).done;){var h=n.value,f=h.handlerName,p=h.handler,d=h.allowed;if(p.isEnabled()){var v=void 0;if(r.blockedByActive(s,d,f))p.reset();else{var g=t||e.type;p&&p[g]&&(v=p[g](e,c,u),r.mergeIHandlerResult(o,a,v,f,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||p.isActive())&&(s[f]=p)}}}catch(e){l.e(e)}finally{l.f()}var m={};for(var y in r.previousActiveHandlers)s[y]||(m[y]=i);r.previousActiveHandlers=s,(Object.keys(m).length||lV(o))&&(r.changes.push([o,a,m]),r.triggerRenderFrame()),(Object.keys(s).length||lV(o))&&r.map.stop(!0),r.updatingCamera=!1;var _=o.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=t,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new Ij(t),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;if(this.listeners=[],Bd)Ud.document.addEventListener("touchstart",(function(e){r.handleEvent(e)}),{}),Ud.document.addEventListener("touchmove",(function(e){r.handleEvent(e)}),{}),Ud.document.addEventListener("touchend",(function(e){r.handleEvent(e)}),{}),Ud.document.addEventListener("touchcancel",(function(e){r.handleEvent(e)}),{});else{this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,a=U(this.listeners);try{for(a.s();!(o=a.n()).done;){var s=D(o.value,3),u=s[0],c=s[1],l=s[2];lj.addEventListener(u,c,u===window.document?this.handleWindowEvent:this.handleEvent,l)}}catch(e){a.e(e)}finally{a.f()}}}return S(e,[{key:"destroy",value:function(){var e,t=U(this.listeners);try{for(t.s();!(e=t.n()).done;){var n=D(e.value,3),r=n[0],i=n[1],o=n[2];lj.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(e){t.e(e)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var e,t=U(this.handlers);try{for(t.s();!(e=t.n()).done;){e.value.handler.reset()}}catch(e){t.e(e)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var e,t=U(this.handlers);try{for(t.s();!(e=t.n()).done;){if(e.value.handler.isActive())return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(cV(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(e,t,n,r,i){if(n){rI(e,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var e=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(t){delete e.frameId,e.handleEvent(new wj("renderFrame",{timeStamp:t})),e.applyChanges()})))}},{key:"addDefaultHandlers",value:function(e){var t=this.map,n=t.getCanvasContainer();this.add("mapEvent",new Bj(t,e));var r=t.boxZoom=new Ej(t,e);this.add("boxZoom",r);var i=new Jj,o=new Aj;t.doubleClickZoom=new Wj(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new $j;this.add("tapDragZoom",a);var s=t.touchPitch=new iV;this.add("touchPitch",s);var u=new Vj(e),c=new Gj(e);t.dragRotate=new Xj(e,u,c),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",c,["mouseRotate"]);var l=new jj(e),h=new eV(e);t.dragPan=new Yj(n,l,h),this.add("mousePan",l),this.add("touchPan",h,["touchZoom","touchRotate"]);var f=new aV,p=new uV;t.touchZoomRotate=new Zj(n,p,f,a),this.add("touchRotate",f,["touchPan","touchZoom"]),this.add("touchZoom",p,["touchPan","touchRotate"]);var d=t.scrollZoom=new Hj(t,this);this.add("scrollZoom",d,["mousePan"]);var v=t.keyboard=new Nj;this.add("keyboard",v),this.add("blockableMapEvent",new Sj(t));for(var g=0,m=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<m.length;g++){var y=m[g];e.interactive&&e[y]&&t[y].enable(e[y])}}},{key:"add",value:function(e,t,n){this.handlers.push({handlerName:e,handler:t,allowed:n}),this.handlersById[e]=t}},{key:"blockedByActive",value:function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(e){var t,n=[],r=U(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,o=i.target;(Bd||this.el.contains(o))&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var e,t={},n={},r={},i=U(this.changes);try{for(i.s();!(e=i.n()).done;){var o=D(e.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(t.panDelta=(t.panDelta||new $U(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),rI(n,s),rI(r,u)}}catch(e){i.e(e)}finally{i.f()}this.updateMapTransform(t,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(e,t,n){var r=this.map,i=r.transform;if(!lV(e))return this.fireEvents(t,n);var o=e.panDelta,a=e.zoomDelta,s=e.bearingDelta,u=e.pitchDelta,c=e.pinchAround,l=e.around;void 0!==c&&(l=c),r.stop(!0),l=l||r.transform.centerPoint;var h=i.pointLocation(o?l.sub(o):l);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,l),this.map.update(),e.noInertia||this.inertia.record(e),this.fireEvents(t,n)}},{key:"fireEvents",value:function(e,t){var n=this,r=cV(this.eventsInProgress),i=cV(e),o={};for(var a in e)if(e[a]){var s=e[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=e[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var c in e.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),e)if(e[c]){var l=e[c].originalEvent;this.fireEvent(c,l)}var h,f={};for(var p in this.eventsInProgress)if(this.eventsInProgress[p]){var d=this.eventsInProgress[p],v=d.handlerName,g=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[p],h=t[v]||g,f["".concat(p,"end")]=h)}for(var m in f)f[m]&&this.fireEvent(m,f[m]);var y=cV(this.eventsInProgress);if((r||i)&&!y){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),b=function(e){return 0!==e&&-n.bearingSnap<e&&e<n.bearingSnap};_?(b(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:h})):(this.map.emit("moveend",new uj("moveend",{originalEvent:h})),b(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(e,t){this.map.emit(e,new uj(e,t?{originalEvent:t}:{}))}}]),e}(),wV=null,TV=[],CV=(Ud.performance,function(e){var t=e;if(null!=wV){var n=t-wV;TV.push(n)}wV=t}),kV=function(){function e(){b(this,e),E(this,"queue",void 0),E(this,"id",void 0),E(this,"cleared",void 0),E(this,"currentlyRunning",void 0),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return S(e,[{key:"add",value:function(e){var t=++this.id;return this.queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this.currentlyRunning,r=U(n?this.queue.concat(n):this.queue);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.id===e)return void(i.cancelled=!0)}}catch(e){r.e(e)}finally{r.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.currentlyRunning=this.queue;this.queue=[];var n,r=U(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(e),this.cleared))break}}catch(e){r.e(e)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}(),MV={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},PV=function(e){A(n,e);var t=O(n);function n(e){var r;return b(this,n),E(I(r=t.call(this,rI({},MV,e))),"doubleClickZoom",void 0),E(I(r),"dragRotate",void 0),E(I(r),"dragPan",void 0),E(I(r),"touchZoomRotate",void 0),E(I(r),"scrollZoom",void 0),E(I(r),"keyboard",void 0),E(I(r),"touchPitch",void 0),E(I(r),"boxZoom",void 0),E(I(r),"handlers",void 0),E(I(r),"container",void 0),E(I(r),"canvas",void 0),E(I(r),"canvasContainer",void 0),E(I(r),"renderTaskQueue",new kV),E(I(r),"frame",void 0),E(I(r),"trackResize",!0),E(I(r),"onWindowOnline",(function(){r.update()})),E(I(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),r.initContainer(),r.resize(),r.handlers=new AV(I(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),r}return S(n,[{key:"resize",value:function(e){var t=this.containerDimensions(),n=t[0],r=t[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",e)),this.emit("move",new Event("move",e))),this.emit("resize",new Event("resize",e)),i&&this.emit("moveend",new Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(KU.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation($U.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(QU.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=qU((function(t){CV(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=qU((function(n){CV(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=Bm("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(e=this.container.clientWidth||400,t=this.container.clientHeight||300),[e,t]}},{key:"resizeCanvas",value:function(e,t){var n=qm||1;this.canvas.width=n*e,this.canvas.height=n*t,this.canvas.style.width="".concat(e,"px"),this.canvas.style.height="".concat(t,"px")}}]),n}(cj),IV=function(){function e(t){var n=this;b(this,e),E(this,"map",void 0),E(this,"updateHash",void 0),E(this,"hashName",void 0),E(this,"onHashChange",(function(){var e=n.getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(+e)}))){var t=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(e[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1})),E(this,"getCurrentHash",(function(){var e,t=window.location.hash.replace("#","");return n.hashName?(t.split("&").map((function(e){return e.split("=")})).forEach((function(t){t[0]===n.hashName&&(e=t)})),(e&&e[1]||"").split("/")):t.split("/")})),E(this,"updateHashUnthrottled",(function(){var e=n.getHashString();try{window.history.replaceState(window.history.state,"",e)}catch(e){}})),this.hashName=t&&encodeURIComponent(t),this.updateHash=Mb(this.updateHashUnthrottled,300)}return S(e,[{key:"addTo",value:function(e){return this.map=e,Ud.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return Ud.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(e){var t=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(t.lng*i)/i,a=Math.round(t.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),c="";if(c+=e?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(c+="/".concat(Math.round(10*s)/10)),u&&(c+="/".concat(Math.round(u))),this.hashName){var l=this.hashName,h=!1,f=window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===l?(h=!0,"".concat(t,"=").concat(c)):e})).filter((function(e){return e}));return h||f.push("".concat(l,"=").concat(c)),"#".concat(f.join("&"))}return"#".concat(c)}}]),e}(),LV={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},OV=function(e){A(n,e);var t=O(n);function n(e){var r;if(b(this,n),E(I(r=t.call(this,rI({},LV,e))),"doubleClickZoom",void 0),E(I(r),"dragRotate",void 0),E(I(r),"dragPan",void 0),E(I(r),"touchZoomRotate",void 0),E(I(r),"scrollZoom",void 0),E(I(r),"keyboard",void 0),E(I(r),"touchPitch",void 0),E(I(r),"boxZoom",void 0),E(I(r),"handlers",void 0),E(I(r),"container",void 0),E(I(r),"canvas",void 0),E(I(r),"canvasContainer",void 0),E(I(r),"renderTaskQueue",new kV),E(I(r),"frame",void 0),E(I(r),"trackResize",!0),E(I(r),"hash",void 0),E(I(r),"onWindowOnline",(function(){r.update()})),E(I(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),Bd?r.initMiniContainer():r.initContainer(),r.resize(),r.handlers=new AV(I(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),!Bd){var i="string"==typeof e.hash&&e.hash||void 0;e.hash&&(r.hash=new IV(i).addTo(I(r)))}return r.hash&&r.hash.onHashChange()||(r.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(r.resize(),r.fitBounds(e.bounds,rI({},e.fitBoundsOptions,{duration:0})))),r}return S(n,[{key:"resize",value:function(e){var t=D(this.containerDimensions(),2),n=t[0],r=t[1];if(this.transform.resize(n,r),Bd)return this;var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Ud.Event("movestart",e)),this.emit("move",new Ud.Event("move",e))),this.emit("resize",new Ud.Event("resize",e)),i&&this.emit("moveend",new Ud.Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(KU.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation($U.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(QU.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=qU((function(t){CV(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=qU((function(n){CV(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=Bm("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(Bd?(e=this.container.width/Ud.devicePixelRatio,t=this.container.height/Ud.devicePixelRatio):(e=0===(e=this.container.clientWidth)?400:e,t=0===(t=this.container.clientHeight)?300:t)),[e,t]}}]),n}(cj),RV={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},NV={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},DV=(hV=vw(),fV=dw(AT.MapConfig),pV=dw(AT.IGlobalConfigService),dV=dw(AT.ICoordinateSystemService),vV=dw(AT.IEventEmitter),hV((yV=G((mV=function(){function e(){var t=this;b(this,e),E(this,"version",Sz.DEFUALT),E(this,"map",void 0),E(this,"simpleMapCoord",new Ez),E(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),E(this,"viewport",void 0),V(this,"config",yV,this),V(this,"configService",_V,this),V(this,"coordinateSystemService",bV,this),V(this,"eventEmitter",xV,this),E(this,"markerContainer",void 0),E(this,"cameraChangedCallback",void 0),E(this,"$mapContainer",void 0),E(this,"handleCameraChanged",(function(e){var n=t.map.getCenter(),r=n.lat,i=n.lng;t.emit("mapchange"),t.viewport.syncWithMapCamera({bearing:t.map.getBearing(),center:[i,r],viewportHeight:t.map.transform.height,pitch:t.map.getPitch(),viewportWidth:t.map.transform.width,zoom:t.map.getZoom(),cameraHeight:0}),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport)}))}return S(e,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=Bm("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(e,t){-1!==VD.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(NV[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(NV[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===Sz.SIMPLE)return this.simpleMapCoord.getSize();var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([e,t])}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyleValue(e))}},{key:"meterToCoord",value:function(e,t){return 1}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"getMapStyle",value:function(){try{var e,t=null!==(e=this.map.getStyle().sprite)&&void 0!==e?e:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(t)?null==t?void 0:t.replace(/\/\w+$/,"").replace(/sprites/,"styles"):t}catch(e){return""}}},{key:"getMapStyleConfig",value:function(){return RV}},{key:"getMapStyleValue",value:function(e){var t;return null!==(t=this.getMapStyleConfig()[e])&&void 0!==t?t:e}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatMapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"updateView",value:function(e){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:e.bearing,center:e.center,viewportHeight:e.viewportHeight,pitch:e.pitch,viewportWidth:e.viewportWidth,zoom:e.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var e=this.config.offsetCoordinate,t=void 0===e||e;this.viewport.getZoom()>12&&t?this.coordinateSystemService.setCoordinateSystem(OI.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(OI.LNGLAT)}}]),e}()).prototype,"config",[fV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_V=G(mV.prototype,"configService",[pV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bV=G(mV.prototype,"coordinateSystemService",[dV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xV=G(mV.prototype,"eventEmitter",[vV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gV=mV))||gV),FV=function(){function e(){b(this,e),E(this,"xzReg",.6*-Math.PI),E(this,"yReg",.2*Math.PI),E(this,"earthCameraRadius",200),E(this,"earthCameraZoom",1),E(this,"cameraPosition",AS()),E(this,"viewport",void 0),E(this,"projectionMatrix",eS()),E(this,"modelMatrix",eS()),E(this,"viewMatrix",eS()),E(this,"viewProjectionMatrix",eS()),E(this,"ViewProjectionMatrixUncentered",eS()),E(this,"viewUncenteredMatrix",eS())}return S(e,[{key:"syncWithMapCamera",value:function(e){var t=e.viewportHeight,n=void 0===t?1:t,r=e.viewportWidth,i=(void 0===r?1:r)/n;vS(this.projectionMatrix,20,i,.1,1e4);var o=this.earthCameraRadius*Math.cos(this.xzReg),a=this.earthCameraRadius*Math.sin(this.xzReg),s=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=TS(o,s,a),NS(this.cameraPosition,this.cameraPosition),kS(this.cameraPosition,this.cameraPosition,TS(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),PS(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var u=AS();FS(u,this.cameraPosition,TS(0,1,0));var c=TS(0,1,0);FS(c,u,this.cameraPosition);var l=TS(0,0,0);yS(this.viewMatrix,this.cameraPosition,l,c),this.viewUncenteredMatrix=tS(this.viewMatrix),oS(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),oS(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(e){this.xzReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(e){this.yReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(e){this.earthCameraZoom+=e,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),BV=["id","style","rotation"],zV={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},UV=vw()(SV=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"version",Sz.GLOBEL),E(I(e),"dragging",!1),E(I(e),"viewport",void 0),E(I(e),"cameraChangedCallback",void 0),E(I(e),"handleCameraChanging",void 0),E(I(e),"handleCameraTimer",void 0),E(I(e),"handleCameraChanged",(function(t){e.emit("mapchange");e.handleCameraChanging=!0,e.handleCameraTimer&&clearTimeout(e.handleCameraTimer),e.handleCameraTimer=setTimeout((function(){e.handleCameraChanging=!1}),2e3);t.type&&t.originalEvent&&("wheel"===t.originalEvent.type&&e.viewport.scaleZoom(.01*Math.sign(t.originalEvent.wheelDelta)*-1),Math.abs(t.originalEvent.movementX)>Math.abs(t.originalEvent.movementY)?t.originalEvent.movementX>0?e.viewport.rotateY(.02):t.originalEvent.movementX<0&&e.viewport.rotateY(-.02):t.originalEvent.movementY>0?e.viewport.rotateX(.02):t.originalEvent.movementY<0&&e.viewport.rotateX(-.02));var n=e.config.offsetCoordinate,r=void 0===n||n;e.viewport.syncWithMapCamera({viewportHeight:e.map.transform.height,viewportWidth:e.map.transform.width}),e.viewport.getZoom()>12&&r?e.coordinateSystemService.setCoordinateSystem(OI.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(OI.LNGLAT),e.cameraChangedCallback(e.viewport)})),e}return S(r,[{key:"lngLatToMercator",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(e,t,n,r,i){throw new Error("Method not implemented.")}},{key:"on",value:function(e,t){-1!==VD.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(zV[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(zV[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"earth"}},{key:"init",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=P(t,BV),this.viewport=new FV,this.$mapContainer=this.creatMapContainer(r),this.map=new PV(v({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"rotateY",value:function(e){var t=e||{},n=t.force,r=void 0!==n&&n,i=t.reg,o=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(o),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}]),r}(DV))||SV,jV=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getServiceConstructor",value:function(){return UV}}]),n}(bz),VV=["id","style","rotation","mapInstance","version","mapSize","interactive"],GV=["id","style","rotation","mapInstance","canvas","hasBaseMap"],HV=vw()(EV=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"version",Sz.DEFUALT),E(I(e),"viewport",void 0),E(I(e),"handleMiniCameraChanged",(function(t,n,r,i,o){var a=e.config.offsetCoordinate,s=void 0===a||a;e.viewport.syncWithMapCamera({bearing:i,center:[t,n],viewportHeight:e.map.transform.height,pitch:o,viewportWidth:e.map.transform.width,zoom:r,cameraHeight:0}),e.viewport.getZoom()>12&&s?e.coordinateSystemService.setCoordinateSystem(OI.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(OI.LNGLAT),e.cameraChangedCallback(e.viewport)})),e}return S(i,[{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=aj.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=aj.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=eS();return aS(s,s,TS(o.x-i.x,o.y-i.y,o.z||0-i.z)),sS(s,s,TS(a*r[0],-a*r[1],a*r[2])),uS(s,s,n[0]),cS(s,s,n[1]),lS(s,s,n[2]),s}},{key:"init",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f,p,d,m,y=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=t.mapInstance,c=t.version,l=void 0===c?"DEFAULTMAP":c,h=t.mapSize,f=void 0===h?1e4:h,p=t.interactive,d=void 0===p||p,m=P(t,VV),this.viewport=new lU,this.version=l,this.simpleMapCoord.setSize(f),l===Sz.SIMPLE&&m.center&&(m.center=this.simpleMapCoord.unproject(m.center)),u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new OV(v({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},m))),this.map.on("load",(function(){y.handleCameraChanged()})),d&&this.map.on("move",this.handleCameraChanged),setTimeout((function(){y.handleCameraChanged()}),100),this.handleCameraChanged();case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"initMiniMap",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=this.config).id,n=t.style,r=void 0===n?"light":n,i=t.rotation,o=void 0===i?0:i,t.mapInstance,a=t.canvas,s=void 0===a?null:a,u=t.hasBaseMap,c=void 0!==u&&u,l=P(t,GV),this.viewport=new lU,this.$mapContainer=s,this.map=new OV(v({container:this.$mapContainer,style:this.getMapStyleValue(r),bearing:o,canvas:s},l)),c?(h=this.map.getCenter(),this.handleMiniCameraChanged(h.lng,h.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),Ud.document.addEventListener("mapCameaParams",(function(e){var t=e.e,n=t.longitude,r=t.latitude,i=t.scale,o=t.bearing,a=t.pitch;f.handleMiniCameraChanged(n,r,i-1.25,o,a)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}}]),i}(DV))||EV,WV=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getServiceConstructor",value:function(){return HV}}]),n}(bz);vB(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:-moz-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-moz-box-shadow:0 0 2px rgba(0,0,0,.1);-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;-moz-animation:mapboxgl-spin 2s infinite linear;-o-animation:mapboxgl-spin 2s infinite linear;-ms-animation:mapboxgl-spin 2s infinite linear;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@-moz-keyframes mapboxgl-spin{0%{-moz-transform:rotate(0deg)}to{-moz-transform:rotate(1turn)}}@-o-keyframes mapboxgl-spin{0%{-o-transform:rotate(0deg)}to{-o-transform:rotate(1turn)}}@-ms-keyframes mapboxgl-spin{0%{-ms-transform:rotate(0deg)}to{-ms-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;-moz-animation:mapboxgl-user-location-dot-pulse 2s infinite;-ms-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@-ms-keyframes mapboxgl-user-location-dot-pulse{0%{-ms-transform:scale(1);opacity:1}70%{-ms-transform:scale(3);opacity:0}to{-ms-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{transform:scale(1);opacity:1}70%{transform:scale(3);opacity:0}to{transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}");var YV,XV=function(){function e(){b(this,e),E(this,"viewport",void 0)}return S(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth;this.viewport=new cU({width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),ZV=["id","attributionControl","style","token","rotation","mapInstance"];window.mapboxgl=t;var qV=0,KV="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",QV=vw()(YV=function(e){A(i,e);var n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"version",Sz.MAPBOX),E(I(e),"viewport",void 0),e}return S(i,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=eS();return aS(s,s,TS(o.x-i.x,o.y-i.y,o.z||0-i.z)),sS(s,s,TS(a*r[0],-a*r[1],a*r[2])),uS(s,s,n[0]),cS(s,s,n[1]),lS(s,s,n[2]),s}},{key:"init",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f,p,d=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,s=void 0===a?"light":a,u=t.token,c=void 0===u?KV:u,l=t.rotation,h=void 0===l?0:l,f=t.mapInstance,p=P(t,ZV),this.viewport=new XV,f||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),c!==KV||"blank"===s||window.mapboxgl.accessToken||f||console.warn(this.configService.getSceneWarninfo("MapToken")),f||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=c),f?(this.map=f,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.mapboxgl.Map(v({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:h},p))),this.map.on("load",(function(){d.handleCameraChanged()})),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(e,n){var r=new t.LngLat(e[0],e[1]),i=new t.LngLat(n[0],n[1]),o=r.distanceTo(i),a=t.MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=t.MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),u=a.x,c=a.y,l=s.x,h=s.y;return 4194304*Math.sqrt(Math.pow(u-l,2)+Math.pow(c-h,2))*2/o}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+qV++,t.appendChild(n),n}}]),i}(DV))||YV,$V=function(e){A(n,e);var t=O(n);function n(){return b(this,n),t.apply(this,arguments)}return S(n,[{key:"getServiceConstructor",value:function(){return QV}}]),n}(bz);function JV(e,t){e.length>0&&t.version===Sz.SIMPLE&&e.map((function(e){e.simpleCoordinate||(e.coordinates=function(e,t){if("number"==typeof e[0])return t.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.simpleMapCoord.unproject(e))})),r}(e.coordinates,t),e.simpleCoordinate=!0)}))}function eG(e,t,n,r,i){var o=(null==i?void 0:i.getLayerConfig()).arrow,a=void 0===o?{enable:!1}:o,s=t.map((function(t){var r,i,o,s={id:t._id,coordinates:t.coordinates};if(e.filter((function(e){return void 0!==e.scale})).forEach((function(e){var r=function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}(e,t);e.needRemapping=!1,"color"===e.name&&(r=r.map((function(e){return Lv(e)}))),s[e.name]=Array.isArray(r)&&1===r.length?r[0]:r,"shape"===e.name&&(s.shape=n.getIconFontKey(s[e.name]))})),"line"===s.shape&&a.enable){var u=s.coordinates,c=(r=u[0],i=u[1],o=s_([i[0]-r[0],i[1]-r[1]]),[r[0]+1e-4*o[0],r[1]+1e-4*o[1]]);s.coordinates.splice(1,0,c,c)}return s}));return function(e,t,n){if(e.length>0&&t.version===Sz["GAODE2.x"]){var r=n.coordCenter;e[0].coordinates[0],e.filter((function(e){return!e.originCoordinates})).map((function(e){e.version=Sz["GAODE2.x"],e.originCoordinates=nB(e.coordinates),e.coordinates=t.coordToAMap2RelativeCoordinates(e.coordinates,r)}))}}(s,r,i),JV(s,r),s}function tG(e){return e.map((function(e){return"string"==typeof e&&(e=[e,{}]),e}))}function nG(e,t,n,r){var i=e.multiPassRenderer;return e.getLayerConfig().enableTAA?i.add(r("taa")):i.add(r("render")),tG(t).forEach((function(e){var t=D(e,2),r=t[0],o=t[1];i.add(n(r),o)})),i.add(n("copy")),i}var rG,iG,oG,aG,sG,uG,cG=function(){function e(t){b(this,e),E(this,"layer",void 0),this.layer=t}return S(e,[{key:"pickRender",value:function(e){var t=this.layer.getContainer().get(AT.ILayerService),n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(e);n.hooks.beforePickingEncode.call(),t.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}},{key:"pick",value:function(e,t){var n=this.layer.getContainer().get(AT.IPickingService);return"RasterLayer"===e.type?this.pickRasterLayer(e,t):(this.pickRender(t),n.pickFromPickingFBO(e,t))}},{key:"pickRasterLayer",value:function(e,t,n){var r=this.layer.getContainer(),i=r.get(AT.IPickingService),o=r.get(AT.IMapService),a=this.layer.getSource().extent,s=Zy(t.lngLat,a),u={x:t.x,y:t.y,type:t.type,lngLat:t.lngLat,target:t,rasterValue:null},c=n||e;if(s){var l=this.readRasterValue(e,a,o,t.x,t.y);return u.rasterValue=l,i.triggerHoverOnLayer(c,u),!0}return u.type="mousemove"===t.type?"mouseout":"un"+t.type,i.triggerHoverOnLayer(c,v(v({},u),{},{type:"unpick"})),i.triggerHoverOnLayer(c,u),!1}},{key:"readRasterValue",value:function(e,t,n,r,i){var o=e.getSource().data.dataArray[0],a=D(t,4),s=a[0],u=void 0===s?0:s,c=a[1],l=void 0===c?0:c,h=a[2],f=void 0===h?10:h,p=a[3],d=void 0===p?-10:p,v=n.lngLatToContainer([u,l]),g=n.lngLatToContainer([f,d]),m=g.x-v.x,y=v.y-g.y,_=[(r-v.x)/m,(i-g.y)/y],b=o.width||1,x=o.height||1,S=Math.floor(_[0]*b),E=Math.floor(_[1]*x),A=Math.max(0,E-1)*b+S;return o.data[A]}},{key:"selectFeature",value:function(e){var t=this.layer,n=D(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeSelect.call([r,i,o])}},{key:"highlightPickedFeature",value:function(e){var t=D(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"getFeatureById",value:function(e){return this.layer.getSource().getFeatureById(e)}}]),e}(),lG=function(){function e(t){b(this,e),E(this,"layer",void 0),E(this,"rendererService",void 0),E(this,"colorTexture",void 0),E(this,"key",void 0),this.layer=t;var n=this.layer.getContainer();this.rendererService=n.get(AT.IRendererService)}return S(e,[{key:"getColorTexture",value:function(e,t){var n=this.getTextureKey(e,t);return this.key===n||(this.createColorTexture(e,t),this.key=n),this.colorTexture}},{key:"createColorTexture",value:function(e,t){var n=this.rendererService.createTexture2D,r=this.getColorRampBar(e,t),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1});return this.colorTexture=i,i}},{key:"setColorTexture",value:function(e,t,n){this.key=this.getTextureKey(t,n),this.colorTexture=e}},{key:"destroy",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"getColorRampBar",value:function(e,t){switch(e.type){case"cat":return Fv(e);case"quantize":return Bv(e);case"custom":return zv(e,t);case"linear":return Dv(e,t);default:return Nv(e)}}},{key:"getTextureKey",value:function(e,t){var n;return"".concat(e.colors.join("_"),"_").concat(null==e||null===(n=e.positions)||void 0===n?void 0:n.join("_"),"_").concat(e.type,"_").concat(null==t?void 0:t.join("_"))}}]),e}(),hG=["passes"],fG=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"],pG=0,dG=(rG=kD(AT.IGlobalConfigService),oG=G((iG=function(e){A(c,e);var t,n,r,i,o,a,s,u=O(c);function c(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,c),E(I(e=u.call(this)),"id","".concat(pG++)),E(I(e),"name","".concat(pG)),E(I(e),"parent",void 0),E(I(e),"coordCenter",void 0),E(I(e),"type",void 0),E(I(e),"visible",!0),E(I(e),"zIndex",0),E(I(e),"minZoom",void 0),E(I(e),"maxZoom",void 0),E(I(e),"inited",!1),E(I(e),"layerModelNeedUpdate",!1),E(I(e),"pickedFeatureID",null),E(I(e),"selectedFeatureID",null),E(I(e),"styleNeedUpdate",!1),E(I(e),"rendering",void 0),E(I(e),"forceRender",!1),E(I(e),"clusterZoom",0),E(I(e),"layerType",void 0),E(I(e),"triangulation",void 0),E(I(e),"layerPickService",void 0),E(I(e),"textureService",void 0),E(I(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),E(I(e),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),E(I(e),"hooks",{init:new vO,afterInit:new pO,beforeRender:new pO,beforeRenderData:new gO,afterRender:new uO,beforePickingEncode:new uO,afterPickingEncode:new uO,beforeHighlight:new uO(["pickedColor"]),afterHighlight:new uO,beforeSelect:new uO(["pickedColor"]),afterSelect:new uO,beforeDestroy:new uO,afterDestroy:new uO}),E(I(e),"models",[]),E(I(e),"multiPassRenderer",void 0),E(I(e),"plugins",void 0),E(I(e),"startInit",!1),E(I(e),"sourceOption",void 0),E(I(e),"layerModel",void 0),E(I(e),"shapeOption",void 0),E(I(e),"sceneContainer",void 0),E(I(e),"tileLayer",void 0),E(I(e),"layerChildren",[]),E(I(e),"masks",[]),V(I(e),"configService",oG,I(e)),E(I(e),"shaderModuleService",void 0),E(I(e),"cameraService",void 0),E(I(e),"coordinateService",void 0),E(I(e),"iconService",void 0),E(I(e),"fontService",void 0),E(I(e),"pickingService",void 0),E(I(e),"rendererService",void 0),E(I(e),"layerService",void 0),E(I(e),"debugService",void 0),E(I(e),"interactionService",void 0),E(I(e),"mapService",void 0),E(I(e),"styleAttributeService",void 0),E(I(e),"layerSource",void 0),E(I(e),"postProcessingPassFactory",void 0),E(I(e),"normalPassFactory",void 0),E(I(e),"animateOptions",{enable:!1}),E(I(e),"container",void 0),E(I(e),"encodedData",void 0),E(I(e),"currentPickId",null),E(I(e),"rawConfig",void 0),E(I(e),"needUpdateConfig",void 0),E(I(e),"encodeStyleAttribute",{}),E(I(e),"enableShaderEncodeStyles",[]),E(I(e),"enableDataEncodeStyles",[]),E(I(e),"enablg",[]),E(I(e),"pendingStyleAttributes",[]),E(I(e),"scaleOptions",{}),E(I(e),"animateStartTime",void 0),E(I(e),"animateStatus",!1),E(I(e),"isDestroyed",!1),E(I(e),"encodeDataLength",0),E(I(e),"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig();t&&t.autoFit&&e.fitBounds(t.fitBoundsOptions),e.layerSource.getSourceCfg().autoRender&&e.reRender()})),e.name=t.name||e.id,e.zIndex=t.zIndex||0,e.rawConfig=t,e}return S(c,[{key:"addMask",value:function(e){this.masks.push(e),this.enableMask()}},{key:"removeMask",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(e){this.masks.push(e)}},{key:"removeMaskLayer",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),e.destroy()}},{key:"getAttribute",value:function(e){return this.styleAttributeService.getLayerStyleAttribute(e)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){var t=this;if(Object.keys(e).map((function(n){n in t.rawConfig&&(t.rawConfig[n]=e[n])})),this.startInit){var n=this.container.get(AT.SceneID);this.configService.setLayerConfig(n,this.id,v(v(v({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=v(v({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e,t){this.container=e,this.sceneContainer=t}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:(s=_(g().mark((function e(){var t,n,r,i,o,a,s=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.container.get(AT.SceneID),this.startInit=!0,this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(AT.IIconService),this.fontService=this.container.get(AT.IFontService),this.rendererService=this.container.get(AT.IRendererService),this.layerService=this.container.get(AT.ILayerService),this.debugService=this.container.get(AT.IDebugService),this.interactionService=this.container.get(AT.IInteractionService),this.pickingService=this.container.get(AT.IPickingService),this.mapService=this.container.get(AT.IMapService),n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes,r&&null!=i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){s.renderLayers()})),this.cameraService=this.container.get(AT.ICameraService),this.coordinateService=this.container.get(AT.ICoordinateSystemService),this.shaderModuleService=this.container.get(AT.IShaderModuleService),this.postProcessingPassFactory=this.container.get(AT.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(AT.IFactoryNormalPass),this.styleAttributeService=this.container.get(AT.IStyleAttributeService),r&&(this.multiPassRenderer=this.container.get(AT.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach((function(e){var t=e.attributeName,n=e.attributeField,r=e.attributeValues,i=e.updateOptions;s.styleAttributeService.updateStyleAttribute(t,{scale:v({field:n},s.splitValuesAndCallbackInAttribute(r,s.getLayerConfig()[t]))},i)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(AT.ILayerPlugin),o=U(this.plugins);try{for(o.s();!(a=o.n()).done;)a.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(e){o.e(e)}finally{o.f()}return this.layerPickService=new cG(this),this.textureService=new lG(this),this.log(BD.LayerInitStart),e.next=31,this.hooks.init.promise();case 31:this.log(BD.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"log",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if(!this.tileLayer&&!this.isTileLayer){var r="".concat(this.id,".").concat(n,".").concat(e),i={id:this.id,type:this.type};null===(t=this.debugService)||void 0===t||t.log(r,i)}}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models.map((function(t){t.updateAttributesAndElements(e.attributes,e.elements)})):console.warn("data error")}},{key:"createModelData",value:function(e,t){var n;if(null!==(n=this.layerModel)&&void 0!==n&&n.createModelData)return this.layerModel.createModelData(t);var r=this.calculateEncodeData(e,t),i=this.triangulation;return r&&i?this.styleAttributeService.createAttributesAndIndices(r,i):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(e){this.layerPickService=e}},{key:"calculateEncodeData",value:function(e,t){return this.inited?function(e,t,n,r,i,o){var a=new uB(i,o),s=eG(r.getLayerStyleAttributes()||[],a.data.dataArray,t,n,e);return a.destroy(),s}(this,this.fontService,this.mapService,this.styleAttributeService,e,t):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});var e=this.getLayerConfig().animateOption;null!=e&&e.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"texture",value:function(e,t,n){return this.updateStyleAttribute("texture",e,t,n),this}},{key:"rotate",value:function(e,t,n){return this.updateStyleAttribute("rotate",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){var r=this.updateStyleAttribute("filter",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"shape",value:function(e,t,n){this.shapeOption={field:e,values:t};var r=this.updateStyleAttribute("shape",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return cg(e)?(t.enable=!0,t=v(v({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return"source"===(null==e?void 0:e.type)?(this.setSource(e),this):(this.sourceOption={data:e,options:t},this.clusterZoom=0,this)}},{key:"setData",value:function(e,t){var n=this;return this.inited?(this.log(BD.SourceInitStart,sI.UPDATE),this.layerSource.setData(e,t),this.log(BD.SourceInitEnd,sI.UPDATE)):this.on("inited",(function(){n.log(BD.SourceInitStart,sI.UPDATE),n.getSource()?n.layerSource.setData(e,t):n.source(new uB(e,t)),n.layerSource.once("update",(function(){n.log(BD.SourceInitEnd,sI.UPDATE)}))})),this}},{key:"style",value:function(e){var t=this,n=e.passes,r=P(e,hG);n&&tG(n).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])}));var i=r;return Object.keys(r).forEach((function(e){var t=r[e];!Array.isArray(t)||2!==t.length||IB(t[0])||IB(t[1])||(i[e]={field:t[0],value:t[1]})})),this.encodeStyle(i),this.updateLayerConfig(i),this}},{key:"encodeStyle",value:function(e){var t=this;Object.keys(e).forEach((function(n){[t.enableShaderEncodeStyles].concat(F(t.enableDataEncodeStyles)).includes(n)&&LP(e[n])&&(e[n].field||e[n].value)&&!yz(t.encodeStyleAttribute[n],e[n])?(t.encodeStyleAttribute[n]=e[n],t.updateStyleAttribute(n,e[n].field,e[n].value),t.inited&&(t.dataState.dataMappingNeedUpdate=!0)):t.encodeStyleAttribute[n]&&(delete t.encodeStyleAttribute[n],t.dataState.dataSourceNeedUpdate=!0)}))}},{key:"scale",value:function(e,t){var n=v({},this.scaleOptions);if(cg(e)?this.scaleOptions=v(v({},this.scaleOptions),e):this.scaleOptions[e]=t,this.styleAttributeService&&!yz(n,this.scaleOptions)){var r=cg(e)?e:E({},e,t);this.styleAttributeService.updateScaleAttribute(r)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(e),this)}},{key:"renderMultiPass",value:(a=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){e.next=2;break}return e.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){e.next=7;break}return e.next=5,this.multiPassRenderer.render();case 5:e.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"active",value:function(e){var t={};return t.enableHighlight=!!cg(e)||e,cg(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color),e.mix&&(t.activeMix=e.mix)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if(cg(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:cg(t)?t.color:this.getLayerConfig().highlightColor,activeMix:cg(t)?t.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:cg(t)?t.color:this.getLayerConfig().highlightColor,activeMix:cg(t)?t.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Rv(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!cg(e)||e,cg(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color),e.mix&&(t.selectMix=e.mix)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if(cg(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:cg(t)?t.color:this.getLayerConfig().selectColor,selectMix:cg(t)?t.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:cg(t)?t.color:this.getLayerConfig().selectColor,selectMix:cg(t)?t.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Rv(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,o=t.maxZoom;return!!n&&e>=i&&e<(void 0===o?1/0:o)}},{key:"setMultiPass",value:function(e,t){if(this.updateLayerConfig({enableMultiPassRenderer:e}),t&&this.updateLayerConfig({passes:t}),e){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=nG(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),o=i.width,a=i.height;this.multiPassRenderer.resize(o,a)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(e){return this.getLayerConfig()[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource().extent;return t.some((function(e){return Math.abs(e)===1/0}))||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}},{key:"destroy",value:function(){var e,t,n,r,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.isDestroyed){this.layerChildren.map((function(e){return e.destroy(!1)})),this.layerChildren=[];var o=this.getLayerConfig(),a=o.maskfence;a&&(this.masks.map((function(e){return e.destroy(!1)})),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(e=this.multiPassRenderer)||void 0===e||e.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(t=this.layerModel)||void 0===t||t.clearModels(i),null===(n=this.tileLayer)||void 0===n||n.destroy(),this.models=[],null===(r=this.debugService)||void 0===r||r.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var e;this.models.forEach((function(e){return e.destroy()})),null===(e=this.layerModel)||void 0===e||e.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){var t=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(e){var n=e.type;if(void 0===t.coordCenter){var r,i=t.layerSource.center;t.coordCenter=i,null!==(r=t.mapService)&&void 0!==r&&r.setCoordCenter&&t.mapService.setCoordCenter(i)}if("update"===n){if(t.tileLayer)return void t.tileLayer.reload();t.sourceEvent()}}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e,this.encodeDataLength=e.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegend",value:function(e){var t,n,r,i=this.styleAttributeService.getLayerStyleAttribute(e);return{type:null===(n=((null==i||null===(t=i.scale)||void 0===t?void 0:t.scalers)||[])[0].option)||void 0===n?void 0:n.type,field:null==i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(e)}}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.invertExtent?t.range().map((function(n){return E({value:t.invertExtent(n)},e,n)})):t.ticks?t.ticks().map((function(n){return E({value:n},e,t(n))})):null!=t&&t.domain?t.domain().filter((function(e){return!nz(e)})).map((function(n){return E({value:n},e,t(n))})):[]:[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"boxSelect",value:function(e,t){this.pickingService.boxPickLayer(this,e,t)}},{key:"buildLayerModel",value:(o=_(g().mark((function e(t){var n,r,i,o,a,s,u,c,l,h,f,p,d=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.moduleName,r=t.vertexShader,i=t.fragmentShader,o=t.inject,a=t.triangulation,s=t.segmentNumber,u=P(t,fG),this.shaderModuleService.registerModule(n,{vs:r,fs:i,inject:o}),c=this.shaderModuleService.getModule(n),l=c.vs,h=c.fs,f=c.uniforms,p=this.rendererService.createModel,e.abrupt("return",new Promise((function(e){var t=d.styleAttributeService.createAttributesAndIndices(d.encodedData,a,s),n=t.attributes,r=t.elements,i=t.count,o=v({attributes:n,uniforms:f,fs:h,vs:l,elements:r,blend:_z[iI.normal]},u);i&&(o.count=i),e(p(o))})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"createAttributes",value:function(e){var t=e.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,t).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!o||(a=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:(i=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"rebuildModels",value:(r=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"renderMulPass",value:(n=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)},(null==t?void 0:t.ispick)||!1)})),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(e,t,n,r){var i=this.configService.getAttributeConfig(this.id)||{};return!yz(i[e],{field:t,values:n})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(e)&&this.configService.setAttributeConfig(this.id,E({},e,{field:t,values:n})),this.startInit?this.styleAttributeService.updateStyleAttribute(e,{scale:v({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"processData",value:function(e){return e}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.models.forEach((function(e){return e.destroy()})),this.models=[],e.next=4,this.layerModel.initModels();case 4:this.models=e.sent;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(e,t){return{values:lg(e)?void 0:e||t,callback:lg(e)?e:void 0}}}]),c}(Q_)).prototype,"configService",[rG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iG);function vG(e){return e.maskOperation===aI.OR?{enable:!0,mask:255,func:{cmp:fL.ALWAYS,ref:1,mask:255},opFront:{fail:fL.KEEP,zfail:fL.REPLACE,zpass:fL.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===oI.SINGLE||0===e.stencilIndex?fL.ALWAYS:fL.LESS,ref:e.stencilType===oI.SINGLE?1:0===e.stencilIndex?2:1,mask:255},opFront:{fail:fL.KEEP,zfail:fL.REPLACE,zpass:fL.REPLACE}}}var gG=(aG=kD(AT.IGlobalConfigService),uG=G((sG=function(){function e(t){b(this,e),E(this,"triangulation",void 0),E(this,"createTexture2D",void 0),E(this,"preStyleAttribute",{}),E(this,"encodeStyleAttribute",{}),E(this,"layer",void 0),E(this,"dataTexture",void 0),E(this,"DATA_TEXTURE_WIDTH",void 0),E(this,"rowCount",void 0),E(this,"cacheStyleProperties",void 0),E(this,"cellLength",void 0),E(this,"cellProperties",void 0),E(this,"cellTypeLayout",void 0),E(this,"stylePropertiesExist",void 0),E(this,"dataTextureTest",void 0),V(this,"configService",uG,this),E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"iconService",void 0),E(this,"fontService",void 0),E(this,"styleAttributeService",void 0),E(this,"mapService",void 0),E(this,"cameraService",void 0),E(this,"layerService",void 0),E(this,"pickingService",void 0),this.layer=t,this.rendererService=t.getContainer().get(AT.IRendererService),this.pickingService=t.getContainer().get(AT.IPickingService),this.shaderModuleService=t.getContainer().get(AT.IShaderModuleService),this.styleAttributeService=t.getContainer().get(AT.IStyleAttributeService),this.mapService=t.getContainer().get(AT.IMapService),this.iconService=t.getContainer().get(AT.IIconService),this.fontService=t.getContainer().get(AT.IFontService),this.cameraService=t.getContainer().get(AT.ICameraService),this.layerService=t.getContainer().get(AT.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n}var t,n,r;return S(e,[{key:"getBlend",value:function(){var e=this.layer.getLayerConfig().blend;return _z[iI[void 0===e?"normal":e]]}},{key:"getStencil",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=t.enableMask,s=t.maskOperation,u=void 0===s?aI.AND:s;return"MaskLayer"===this.layer.type?vG({isStencil:!0,stencilType:oI.SINGLE}):e.isStencil?vG(v(v({},e),{},{maskOperation:u})):function(e,t){return{enable:e,mask:255,func:{cmp:fL.EQUAL,ref:t?1:0,mask:1}}}(r||a&&0!==this.layer.masks.length||void 0!==this.layer.tileMask,o)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:(r=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"initModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(e){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var e=this.layer.encodeStyleAttribute,t="",n={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2"};this.layer.enableShaderEncodeStyles.forEach((function(r){e[r]&&(t+="#define USE_ATTRIBUTE_".concat(r.toUpperCase()," 0.0; \n\n")),t+="\n          #ifdef USE_ATTRIBUTE_".concat(r.toUpperCase(),"\n      attribute ").concat(n[r]," a_").concat(r.charAt(0).toUpperCase()+r.slice(1),";\n    #else\n      uniform ").concat(n[r]," u_").concat(r,";\n    #endif\n\n    ")}));var r="";return this.layer.enableShaderEncodeStyles.forEach((function(e){r+="\n\n#ifdef USE_ATTRIBUTE_".concat(e.toUpperCase(),"\n  ").concat(n[e]," ").concat(e,"  = a_").concat(e.charAt(0).toUpperCase()+e.slice(1),";\n#else\n  ").concat(n[e]," ").concat(e," = u_").concat(e,";\n#endif\n\n")})),{"vs:#decl":t,"vs:#main-start":r}}},{key:"getStyleAttribute",value:function(){var e=this,t={},n={opacity:1,stroke:[1,0,0,1],offsets:[0,0]};return this.layer.enableShaderEncodeStyles.forEach((function(r){if(!e.layer.encodeStyleAttribute[r]){var i=e.layer.getLayerConfig()[r],o=void 0===i?n[r]:i;"stroke"===r&&(o=Lv(o)),t["u_"+r]=o}})),t}},{key:"registerStyleAttribute",value:function(){var e=this;Object.keys(this.layer.encodeStyleAttribute).forEach((function(t){var n=function(e){switch(e){case"stroke":return{name:"stroke",type:jD.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:4,update:function(e){var t=e.stroke;return void 0===t?[1,1,1,1]:t}}};case"opacity":return{name:"opacity",type:jD.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.opacity;return[void 0===t?1:t]}}};case"offsets":return{name:"offsets",type:jD.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e){return e.offsets}}};default:return}}(t);n&&e.styleAttributeService.registerStyleAttribute(n)}))}},{key:"updateEncodeAttribute",value:function(e,t){this.encodeStyleAttribute[e]=t}}]),e}()).prototype,"configService",[aG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sG),mG=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),yG=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),_G=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),bG=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),xG=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({}),SG={canvas:function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"updateMode",xG.ALWAYS),E(I(e),"canvas",void 0),E(I(e),"ctx",void 0),E(I(e),"prevSize",void 0),E(I(e),"renderUpdate",(function(){var t=e.layer.getLayerConfig(),n=t.zIndex,r=void 0===n?10:n,i=t.update,o=void 0===i?xG.ALWAYS:i,a=t.animateOption,s=void 0===a?{enable:!1,duration:20}:a;+e.canvas.style.zIndex===r&&(e.canvas.style.zIndex=r+""),e.updateMode!==o&&(e.updateMode=o,e.unBindListener(),e.bindListener()),e.updateMode===xG.ALWAYS&&s.enable&&e.renderCanvas()})),E(I(e),"unBindListener",(function(){e.mapService.off("mapchange",e.renderCanvas),e.mapService.off("zoomstart",e.clearCanvas),e.mapService.off("zoomend",e.renderCanvas),e.mapService.off("movestart",e.clearCanvas),e.mapService.off("moveend",e.renderCanvas)})),E(I(e),"bindListener",(function(){e.updateMode===xG.ALWAYS?e.mapService.on("mapchange",e.renderCanvas):(e.mapService.on("zoomstart",e.clearCanvas),e.mapService.on("zoomend",e.renderCanvas),e.mapService.on("movestart",e.clearCanvas),e.mapService.on("moveend",e.renderCanvas))})),E(I(e),"clearCanvas",(function(){if(e.ctx){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;e.ctx.clearRect(0,0,n,r)}})),E(I(e),"renderCanvas",(function(){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;if(e.prevSize[0]!==n||e.prevSize[1]!==r){e.prevSize=[n,r];var i=D(e.mapService.getSize(),2),o=i[0],a=i[1];e.canvas.width=n,e.canvas.height=r,e.canvas.style.width=o+"px",e.canvas.style.height=a+"px"}var s=e.layer.getLayerConfig().drawingOnCanvas;e.ctx&&s({canvas:e.canvas,ctx:e.ctx,mapService:e.mapService,size:[n,r]})})),e}return S(i,[{key:"clearModels",value:function(){var e;this.canvas&&(null===(e=this.mapService.getContainer())||void 0===e||e.removeChild(this.canvas),this.canvas=null);this.unBindListener()}},{key:"initModels",value:(n=_(g().mark((function e(){var t,n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.update,r=void 0===n?xG.ALWAYS:n,this.updateMode=r,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"initCanvas",value:function(){var e,t=this.layer.getLayerConfig().zIndex,n=D(this.mapService.getSize(),2),r=n[0],i=n[1],o=this.rendererService.getViewportSize(),a=o.width,s=o.height;this.prevSize=[a,s];var u=document.createElement("canvas");this.canvas=u,u.width=a,u.height=s,u.style.pointerEvents="none",u.style.width=r+"px",u.style.height=i+"px",u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.zIndex=t+"",null===(e=this.mapService.getContainer())||void 0===e||e.appendChild(u);var c=u.getContext("2d");this.ctx=c}},{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){}}]),i}(gG)},EG=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","CanvasLayer"),E(I(e),"forceRender",!0),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new SG[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hide",value:function(){return this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"renderModels",value:function(){var e,t=this;return null!=this&&null!==(e=this.layerModel)&&void 0!==e&&e.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach((function(e){e.draw({uniforms:t.layerModel.getUninforms()},!1)})),this}},{key:"getDefaultConfig",value:function(){return{canvas:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"canvas"}}]),r}(dG),AG=function(e,t,n,r,i,o,a,s){for(var u,c,l=i,h=0,f=!!a&&$t(a,s);h<r;)h in n&&(u=f?f(n[h],h,t):n[h],o>0&&ln(u)?(c=cn(u),l=AG(e,t,u,c,l,o-1)-1):(La(l+1),e[l]=u),l++),h++;return l},wG=AG;ar({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=he(this),n=cn(t),r=Sn(t,0);return r.length=wG(r,t,t,n,0,void 0===e?1:an(e)),r}}),es("flat");function TG(e){return e/180*Math.acos(-1)}function CG(e){var t=TG(e[0])+Math.PI/2,n=TG(e[1]),r=100+.4*Math.random(),i=r*Math.cos(n)*Math.cos(t);return[r*Math.cos(n)*Math.sin(t),r*Math.sin(n),i]}function kG(e,t){var n=eS(),r=eS(),i=TS(0,1,0),o=TS(0,0,0);e=void 0!==e?e:1;for(var a=2+(void 0!==(t=t||{}).segments?t.segments:32),s=2*a,u=[],c=[],l=[],h=[],f=[],p=[],d=0;d<=a;d++){for(var v=d/a,g=v*Math.PI,m=0;m<=s;m++){var y=m/s,_=y*Math.PI*2;rS(r),lS(r,r,-g),rS(n),cS(n,n,_),BS(o,i,r),BS(o,o,n),PS(o,o,-e),l.push(o.slice()),h.push.apply(h,F(o.slice())),NS(o,o),f.push.apply(f,F(o.slice())),p.push([y,1-v]),h.push(y,1-v)}if(d>0)for(var b=l.length,x=b-2*(s+1);x+s+2<b;x++)u.push([x,x+1,x+s+1]),c.push(x,x+1,x+s+1),u.push([x+s+1,x+1,x+s+2]),c.push(x+s+1,x+1,x+s+2)}return{cells:u,positions:l,uvs:p,positionsArr:h,indicesArr:c,normalArr:f}}var MG=JS(),PG=(JS(),JS()),IG=JS(),LG=JS();function OG(e,t,n,r,i){return rE(e,n,r),oE(e,e),[i/aE(t=eE(-e[1],e[0]),eE(-n[1],n[0])),t]}function RG(e,t){return nE(e,-t[1],t[0])}function NG(e,t,n){return uE(e,t,n),oE(e,e),e}function DG(e,t){return e[0]===t[0]&&e[1]===t[1]}var FG,BG=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b(this,e),E(this,"complex",void 0),E(this,"join",void 0),E(this,"cap",void 0),E(this,"miterLimit",void 0),E(this,"thickness",void 0),E(this,"normal",void 0),E(this,"lastFlip",-1),E(this,"miter",eE(0,0)),E(this,"started",!1),E(this,"dash",!1),E(this,"totalDistance",0),E(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return S(e,[{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=e[o-1];c.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var l=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(F(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,c,h,p,l,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=e[o-1];c.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var l=t[o-1],h=e[o];h.push(null!==(s=t[o][2])&&void 0!==s?s:0);var f=t[o],p=o<e.length-1?[].concat(F(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,c,h,p,l,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleSegment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,c=e_([r[0],r[1]]),l=e_([n[0],n[1]]);NG(PG,c,l);var h=0;if(this.dash&&(h=this.lineSegmentDistance(c,l),this.totalDistance+=h),this.normal||(this.normal=JS(),RG(this.normal,PG)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(t+0,t+1,t+2),i){var f=e_([i[0],i[1]]);DG(c,f)&&rE(f,c,oE(f,iE(f,c,l))),NG(IG,f,c);var p=D(OG(LG,JS(),PG,IG,this.thickness),2),d=p[0],v=p[1];aE(LG,this.normal);this.extrusions(s,u,r,v,d,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,tE(this.normal,v),o+=2,this.lastFlip=-1}else RG(this.normal,PG),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2;return o}},{key:"segment_gaode2",value:function(e,t,n,r,i,o,a,s){var u=0,c=e.indices,l=e.positions,h=e.normals,f="square"===this.cap,p="bevel"===this.join,d=e_([a[0],a[1]]),v=e_([o[0],o[1]]);NG(PG,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=JS(),RG(this.normal,PG)),!this.started)if(this.started=!0,f){var m=JS(),y=JS();rE(m,this.normal,PG),rE(y,this.normal,PG),h.push(y[0],y[1],0),h.push(m[0],m[1],0),l.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,n,this.normal,this.thickness,this.totalDistance-g);if(c.push(t+0,t+1,t+2),i){DG(r,i)&&rE(i,r,oE(i,iE(i,r,n))),NG(IG,i,r);var _=D(OG(LG,JS(),PG,IG,this.thickness),2),b=_[0],x=_[1],S=aE(LG,this.normal)<0?-1:1,E=p;if(!E&&"miter"===this.join)b>this.miterLimit&&(E=!0);E?(h.push(this.normal[0],this.normal[1],0),h.push(x[0],x[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,F(this.lastFlip!==-S?[t,t+2,t+3]:[t+2,t+1,t+3])),c.push(t+2,t+3,t+4),RG(MG,IG),tE(this.normal,MG),h.push(this.normal[0],this.normal[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,h,r,x,b,this.totalDistance),c.push.apply(c,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),S=-1,tE(this.normal,x),u+=2),this.lastFlip=S}else{if(RG(this.normal,PG),f){var A=JS(),w=JS();uE(w,PG,this.normal),rE(A,PG,this.normal),h.push(w[0],w[1],0),h.push(A[0],A[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,r,this.normal,this.thickness,this.totalDistance);c.push.apply(c,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,c="square"===this.cap,l="bevel"===this.join,h=e_([r[0],r[1]]),f=e_([n[0],n[1]]);NG(PG,h,f);var p=0;if(this.dash&&(p=this.lineSegmentDistance(h,f),this.totalDistance+=p),this.normal||(this.normal=JS(),RG(this.normal,PG)),!this.started)if(this.started=!0,c){var d=JS(),v=JS();rE(d,this.normal,PG),rE(v,this.normal,PG),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(a.push(t+0,t+1,t+2),i){var g=e_([i[0],i[1]]);DG(h,g)&&rE(g,h,oE(g,iE(g,h,f))),NG(IG,g,h);var m=D(OG(LG,JS(),PG,IG,this.thickness),2),y=m[0],_=m[1],b=aE(LG,this.normal)<0?-1:1,x=l;if(!x&&"miter"===this.join)y>this.miterLimit&&(x=!0);x?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,F(this.lastFlip!==-b?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),RG(MG,IG),tE(this.normal,MG),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,_,y,this.totalDistance),a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),b=-1,tE(this.normal,_),o+=2),this.lastFlip=b}else{if(RG(this.normal,PG),c){var S=JS(),E=JS();uE(E,PG,this.normal),rE(S,PG,this.normal),u.push(E[0],E[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,F(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();function zG(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=yx.flatten(e),a=o.vertices,s=o.dimensions,u=[],c=[],l=[],h=0;h<a.length/s;h++)u.push(a[h*s],a[h*s+1],1,-1,-1),l.push(0,0,1);var f=yx(o.vertices,o.holes,o.dimensions);c.push.apply(c,F(f));for(var p=function(){var e=o.vertices.slice(d*s,(d+1)*s),n=o.vertices.slice((d+1)*s,(d+2)*s);0===n.length&&(n=o.vertices.slice(0,s));var r=u.length/5;u.push(e[0],e[1],1,0,0,n[0],n[1],1,.1,0,e[0],e[1],0,0,.8,n[0],n[1],0,.1,.8);var i=UG([n[0],n[1],1],[e[0],e[1],0],[e[0],e[1],1],t);l.push.apply(l,F(i).concat(F(i),F(i),F(i))),c.push.apply(c,F([1,2,0,3,2,1].map((function(e){return e+r}))))},d=0;d<i;d++)p();return{positions:u,index:c,normals:l}}function UG(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=AS(),o=AS(),a=AS();r&&(e=Ky(e),t=Ky(t),n=Ky(n));var s=TS.apply(qS,F(e)),u=TS.apply(qS,F(t)),c=TS.apply(qS,F(n));jS(i,c,u),jS(o,s,u),FS(a,i,o);var l=AS();return NS(l,a),l}var jG=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),VG=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function GG(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);var o=r.map((function(e){return[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0]}));return o}function HG(){return GG(30)}function WG(){return GG(4)}function YG(){return GG(3)}function XG(){return GG(6,1)}function ZG(){return GG(5)}var qG=(E(FG={},VG.CIRCLE,HG),E(FG,VG.HEXAGON,XG),E(FG,VG.TRIANGLE,YG),E(FG,VG.SQUARE,WG),E(FG,VG.PENTAGON,ZG),E(FG,jG.CYLINDER,HG),E(FG,jG.HEXAGONCOLUMN,XG),E(FG,jG.TRIANGLECOLUMN,YG),E(FG,jG.SQUARECOLUMN,WG),E(FG,jG.PENTAGONCOLUMN,ZG),FG),KG={};function QG(e){var t=h_(e.coordinates);return{vertices:[].concat(F(t),F(t),F(t),F(t)),indices:[0,1,2,2,3,0],size:t.length}}function $G(e){var t=CG(h_(e.coordinates));return{vertices:[].concat(F(t),F(t),F(t),F(t)),indices:[0,1,2,2,3,0],size:t.length}}function JG(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(KG&&KG[e])return KG[e];var n=qG[e]?qG[e]():qG.cylinder(),r=zG([n],t);return KG[e]=r,r}(e.shape,!1);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function eH(e){var t=h_(e.coordinates);return{vertices:F(t),indices:[0],size:t.length}}function tH(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new BG({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],c=a[s];i.extrude_gaode2(u,c)}}else{var l=t;l[0]&&!Array.isArray(l[0][0])&&(l=[t]),l.forEach((function(e){i.extrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function nH(e){var t=e.coordinates.flat();return{vertices:[1,0,0].concat(F(t),[1,2,-3],F(t),[1,1,-3],F(t),[0,1,0],F(t),[0,0,0],F(t),[1,0,0],F(t),[1,2,-3],F(t),[1,1,-3],F(t),[0,1,0],F(t),[0,0,0],F(t)),normals:[-1,2,1,2,-1,1,1,-1,1,1,-1,1,-1,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function rH(e){var t=e.coordinates,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=function(e){var t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());var n=0;if(t.length<2)return{results:t,totalDistance:0};var r=[],i=oH(t[0],n);r.push(i);for(var o=1;o<t.length-1;o++){var a=iH(t[o-1],t[o]);n+=a;var s=oH(t[o],n);r.push(s),r.push(s)}var u=iH(t[t.length-2],t[t.length-1]);return n+=u,r.push(oH(t[t.length-1],n)),{results:r,totalDistance:n}}(t),i=r.results,o=r.totalDistance;return i.map((function(e){n.push(e[0],e[1],e[2],e[3],0,o)})),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function iH(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function oH(e,t){return e.length<3&&e.push(0),void 0!==t&&e.push(t),e}function aH(e){var t=e.coordinates,n=yx.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:yx(r,o,i),vertices:r,size:i}}function sH(e){var t=e.coordinates,n=yx.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:yx(r,o,i),vertices:uH(r),size:i+4}}function uH(e){for(var t=[],n=f_(e),r=n.center,i=n.radius,o=0;o<e.length;o+=2){var a=e[o],s=e[o+1];t.push.apply(t,[a,s,0].concat(F(r),[i]))}return t}function cH(e){var t=zG(e.coordinates,!0);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function lH(e){var t=function(e){var t=qG[e]?qG[e]():qG.circle();return-1===["cylinder","triangleColumn","hexagonColumn","squareColumn"].indexOf(e)?(n=[t],r=yx.flatten(n),i=yx(r.vertices,r.holes,r.dimensions),{positions:r.vertices,index:i}):function(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=yx.flatten(e),o=i.vertices,a=i.dimensions,s=[],u=[],c=0;c<o.length/a;c++)2===a?s.push(o[2*c],o[2*c+1],1):s.push(o[3*c],o[3*c+1],1);var l=yx(i.vertices,i.holes,i.dimensions);u.push.apply(u,F(l));for(var h=function(){var e=i.vertices.slice(f*a,(f+1)*a),t=i.vertices.slice((f+1)*a,(f+2)*a);0===t.length&&(t=i.vertices.slice(0,a));var n=s.length/3;s.push(e[0],e[1],1,t[0],t[1],1,e[0],e[1],0,t[0],t[1],0),u.push.apply(u,F([0,2,1,2,3,1].map((function(e){return e+n}))))},f=0;f<r;f++)h();return{positions:s,index:u}}([t]);var n,r,i}(e.shape);return{vertices:t.positions,indices:t.index,size:3}}function hH(e){var t=e.coordinates;return{vertices:[].concat(F(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],F(t[1]),[0,1,0],F(t[0]),[0,0,1],F(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function fH(e,t){for(var n=t||30,r=e.coordinates,i=[],o=[],a=function(e){i.push(e,1,e,r[0][0],r[0][1],r[1][0],r[1][1],e,-1,e,r[0][0],r[0][1],r[1][0],r[1][1]),e!==n-1&&o.push.apply(o,F([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},s=0;s<n;s++)a(s);return{vertices:i,indices:o,size:7}}function pH(e){var t=e.coordinates;2===t.length&&t.push(0);var n=dH(-1,1),r=dH(1,1),i=dH(-1,-1),o=dH(1,-1);return{vertices:[].concat(F(t),F(n),F(t),F(i),F(t),F(o),F(t),F(r)),indices:[0,1,2,3,0,2],size:5}}function dH(e,t){return[(e+1)/2,(t+1)/2]}function vH(){var e=kG(100,{segments:36});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}function gH(){var e=kG(140,{segments:36});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}var mH,yH=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"cityCenter",void 0),E(I(e),"cityMinSize",void 0),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=e.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=e.windowColor,u=void 0===s?"rgb(30,60,89)":s,c=e.time,l=void 0===c?0:c,h=e.sweep,f=void 0===h?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:h;return{u_cityCenter:f.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*f.sweepRadius,u_circleSweep:f.enable?1:0,u_circleSweepColor:Lv(f.sweepColor).slice(0,3),u_circleSweepSpeed:f.sweepSpeed,u_opacity:n,u_baseColor:Lv(i),u_brightColor:Lv(a),u_windowColor:Lv(u),u_time:this.layer.getLayerAnimateTime()||l}}},{key:"calCityGeo",value:function(){var e=D(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+t)/2,(i+n)/2]);var o=this.mapService.lngLatToCoord([r,i]),a=this.mapService.lngLatToCoord([t,n]);this.cityMinSize=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2))/4}else{var s=r-t,u=i-n;this.cityCenter=[(r+t)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.calCityGeo(),this.startModelAnimate(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\nuniform float u_circleSweep;\nuniform vec2 u_cityCenter;\nvarying float v_worldDis;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nv_texCoord = a_Uv;\nif(u_circleSweep > 0.0) {\nvec2 lnglatscale = vec2(0.0);\nif(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\nlnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n}\nv_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\nuniform float u_circleSweep;\nuniform float u_cityMinSize;\nuniform vec3 u_circleSweepColor;\nuniform float u_circleSweepSpeed;\nvarying float v_worldDis;\n#pragma include "picking"\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\nfloat s = step(hot, n);\nvec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\nreturn mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\nreturn fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\nfloat LinearizeDepth()\n{\nfloat z = gl_FragCoord.z * 2.0 - 1.0;\nreturn (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\nvec3 fog(vec3 color, vec3 fogColor, float depth){\nfloat fogFactor=clamp(depth,0.0,1.0);\nvec3 output_color=mix(fogColor,color,fogFactor);\nreturn output_color;\n}\nfloat sdRect(vec2 p, vec2 sz) {\nvec2 d = abs(p) - sz;\nfloat outside = length(max(d, 0.));\nfloat inside = min(max(d.x, d.y), 0.);\nreturn outside + inside;\n}\nvoid main() {\ngl_FragColor = v_Color;\nvec3 baseColor = u_baseColor.xyz;\nvec3 brightColor = u_brightColor.xyz;\nvec3 windowColor = u_windowColor.xyz;\nfloat targetColId = 5.;\nfloat depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\nvec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\nif(v_texCoord.x < 0.) {\nvec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\ngl_FragColor = vec4( foggedColor, v_Color.w);\n}else {\nvec2 st = v_texCoord;\nvec2  UvScale = v_texCoord;\nfloat tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\nfloat tStart = 0.25 * tStep;\nfloat tEnd = 0.75 * tStep;\nfloat u = mod(UvScale.x, tStep);\nfloat v = mod(UvScale.y, tStep);\nfloat ux = floor(UvScale.x/tStep);\nfloat uy = floor(UvScale.y/tStep);\nfloat n = random(vec2(ux,uy));\nfloat lightP = u_time;\nfloat head = 1.0- step(0.005,st.y);\nfloat sU = step(tStart, u) - step(tEnd, u);\nfloat sV = step(tStart, v) - step(tEnd, v);\nvec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\nfloat dist = sdRect(vec2(u,v), windowSize);\nfloat s = sU * sV;\nfloat curColId = floor(UvScale.x / tStep);\nfloat sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\nfloat mLightP = mod(lightP, 2.);\nfloat sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\nif(ux == targetColId){\nn =0.;\n}\nfloat timeP = min(0.75, abs ( sin(u_time/3.0) ) );\nfloat hot = smoothstep(1.0,0.0,timeP);\nvec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\nfloat sFinal = s * sCol * sRow;\ncolor += mix(baseColor, brightColor, sFinal*n);\nif (st.y<0.01){\ncolor = baseColor;\n}\nif(head ==1.0) {\ncolor = brightColor;\n}\ncolor = color * v_Color.rgb;\nvec3 foggedColor = fog(color,fogColor,depth);\ngl_FragColor = vec4(foggedColor,1.0);\n}\nif(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\nfloat r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\ngl_FragColor.rgb += r * r * u_circleSweepColor;\n}\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:cH,depth:{enable:!0},cull:{enable:!0,face:fL.BACK}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(gG),_H=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","CityBuildingLayer"),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layerModel=new yH(this),e.next=3,this.initLayerModels();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(dG),bH=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"radian",0),E(I(e),"planeGeometryTriangulation",(function(){var t=e.layer.getLayerConfig().center,n=void 0===t?[120,30]:t;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat(F(n),[1,1],F(n),[0,1],F(n),[0,0],F(n),[1,0])}})),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.width,r=void 0===n?1:n,i=e.height,o=void 0===i?1:i,a=e.raisingHeight,s=void 0===a?0:a,u=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(u=-1),this.radian=u*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_opacity:t||1,u_texture:this.texture,u_size:[r,o]}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(n=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.drawCanvas,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),n&&this.updateTexture(n),e.next=6,this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform float u_raisingHeight: 0.0;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform vec2 u_size: [1.0, 1.0];\nuniform mat2 u_RotateMatrix;\nattribute vec3 a_Extrude;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nv_Color = a_Color;\nv_uv = a_Uv;\nfloat raiseHeight = u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nraiseHeight = u_raisingHeight * mapboxZoomScale;\n}\nvec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\nvec2 offsetXY = project_pixel(u_RotateMatrix * vec2(extrude.x * u_size.x, 0.0));\nfloat x = project_pos.x + offsetXY.x;\nfloat y = project_pos.y + offsetXY.y;\nfloat z = project_pixel(extrude.y * u_size.y + raiseHeight);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(x, y, z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(x , y, z , 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform sampler2D u_texture;\nuniform float u_opacity;\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:this.planeGeometryTriangulation,primitive:fL.TRIANGLES,depth:{enable:!0}});case 6:return i=e.sent,e.abrupt("return",[i]);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateTexture",value:function(e){var t=this.rendererService.createTexture2D,n=this.layer.getLayerConfig(),r=n.canvasWidth,i=void 0===r?1:r,o=n.canvasHeight,a=void 0===o?1:o,s=document.createElement("canvas");s.width=i,s.height=a,s.getContext("2d")&&(e(s),this.texture=t({data:s,width:s.width,height:s.height,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:jD.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[2],n[3]]}}})}}]),i}(gG),xH=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"terrainImage",void 0),E(I(e),"terrainImageLoaded",!1),E(I(e),"mapTexture",void 0),E(I(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,o=n.height,a=void 0===o?1:o,s=n.widthSegments,u=void 0===s?1:s,c=n.heightSegments,l=void 0===c?1:c,h=n.center,f=void 0===h?[120,30]:h,p=n.terrainTexture,d=(t=e).initPlane.apply(t,[i,a,u,l].concat(F(f))),v=d.indices,g=d.positions;return p&&e.loadTerrainTexture(g,v),{vertices:g,indices:v,size:5}})),e}return S(i,[{key:"initPlane",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=e/2,s=t/2,u=Math.floor(n),c=Math.floor(r),l=u+1,h=c+1,f=e/u,p=t/c,d=[],v=[],g=0;g<h;g++)for(var m=g*p-s,y=0;y<l;y++){var _=y*f-a;if(this.mapService.version===Sz["GAODE2.x"]){var b=this.mapService.lngLatToCoord([_+i,-m+o]),x=D(b,2),S=x[0],E=x[1];v.push(S,E,0)}else v.push(_+i,-m+o,0);v.push(y/u),v.push(1-g/c)}for(var A=0;A<c;A++)for(var w=0;w<u;w++){var T=w+l*A,C=w+l*(A+1),k=w+1+l*(A+1),M=w+1+l*A;d.push(T,C,M),d.push(C,k,M)}return{indices:d,positions:v}}},{key:"getUninforms",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.terrainClipHeight,o=void 0===i?0:i,a=t.terrainTexture;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:a?o:-1,u_texture:this.texture}}},{key:"clearModels",value:function(){var e;this.terrainImage=null,null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(n=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,this.mapTexture=n,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),this.updateTexture(n),e.next=7,this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_terrainClipHeight;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_Color = a_Color;\nv_uv = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nv_clip = 1.0;\nif(a_Position.z < u_terrainClipHeight) {\nv_clip = 0.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n#pragma include "picking"\nvoid main() {\nif(u_mapFlag > 0.0) {\ngl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\ngl_FragColor.a *= u_opacity;\n} else {\ngl_FragColor = vec4(v_Color, u_opacity);\n}\ngl_FragColor.a *= v_clip;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:this.planeGeometryTriangulation,primitive:fL.TRIANGLES,depth:{enable:!0},cull:{enable:!0,face:fL.BACK}});case 7:return i=e.sent,e.abrupt("return",[i]);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createModelData",value:function(e){if(e){var t=this.layer.getLayerConfig(),n=t.widthSegments,r=t.heightSegments,i=t.width,o=t.height,a=e,s=a.widthSegments,u=a.heightSegments,c=a.width,l=a.height;this.layer.style({widthSegments:void 0!==s?s:n,heightSegments:void 0!==u?u:r,width:void 0!==c?c:i,height:void 0!==l?l:o})}var h=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(h,this.planeGeometryTriangulation)}},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:0,height:0})}},{key:"getImageData",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=e.width,i=e.height;return t.width=r,t.height=i,n.drawImage(e,0,0,r,i),n.getImageData(0,0,r,i)}},{key:"translateVertex",value:function(e,t,n,r,i,o){for(var a=n.width,s=n.height,u=this.getImageData(n).data,c=Math.floor(r),l=Math.floor(i),h=c+1,f=l+1,p=a/c,d=s/l,v=0;v<f;v++)for(var g=Math.floor(v*d)*a,m=0;m<h;m++){var y=4*(g+Math.floor(m*p)),_=u[y],b=u[y+1],x=u[y+2];e[5*(v*h+m)+2]=o(_,b,x)}var S=this.layer.getEncodedData(),E=this.styleAttributeService.createAttributesAndIndices(S,(function(){return{vertices:e,indices:t,size:5}}));this.layer.updateModelData(E),this.layerService.throttleRenderLayers()}},{key:"loadTerrainTexture",value:function(e,t){var n=this,r=this.layer.getLayerConfig(),i=r.widthSegments,o=void 0===i?1:i,a=r.heightSegments,s=void 0===a?1:a,u=r.terrainTexture,c=r.rgb2height,l=void 0===c?function(e,t,n){return e+t+n}:c;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(e,t,this.terrainImage,o,s,l):this.terrainImage.onload=function(){n.translateVertex(e,t,n.terrainImage,o,s,l)};else{var h=new Image;this.terrainImage=h,h.crossOrigin="anonymous",h.onload=function(){n.terrainImageLoaded=!0,setTimeout((function(){return n.layer.emit("terrainImageLoaded",null)})),n.translateVertex(e,t,h,o,s,l)},h.src=u}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(gG),SH=function(e){return e.UP="up",e.DOWN="down",e}(SH||{}),EH={plane:xH,sprite:function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"mapTexture",void 0),E(I(e),"positions",void 0),E(I(e),"indices",void 0),E(I(e),"timer",void 0),E(I(e),"spriteTop",void 0),E(I(e),"spriteUpdate",void 0),E(I(e),"spriteAnimate",void 0),E(I(e),"planeGeometryUpdateTriangulation",(function(){for(var t=e.layer.getLayerConfig().spriteBottom,n=void 0===t?-1e5:t,r=e.spriteUpdate,i=n,o=e.spriteTop,a=0;a<e.positions.length;a+=5)e.spriteAnimate===SH.UP?(e.positions[a+2]+=r,e.positions[a+2]>o&&(e.positions[a+2]=i)):(e.positions[a+2]-=r,e.positions[a+2]<i&&(e.positions[a+2]=o));return{vertices:e.positions,indices:e.indices,size:5}})),E(I(e),"updateModel",(function(){var t=e.layer.createAttributes({triangulation:e.planeGeometryUpdateTriangulation});e.layer.models.map((function(e){e.updateAttributes(t)})),e.layerService.throttleRenderLayers(),e.timer=requestAnimationFrame(e.updateModel)})),E(I(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.center,i=void 0===r?[120,30]:r,o=n.spriteCount,a=void 0===o?100:o,s=n.spriteRadius,u=void 0===s?10:s,c=(t=e).initSprite.apply(t,[u,a].concat(F(i))),l=c.indices,h=c.positions;return e.positions=h,e.indices=l,{vertices:h,indices:l,size:5}})),e}return S(i,[{key:"initSprite",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,i=[],o=[],a=this.mapService,s=this.spriteAnimate===SH.UP?-this.spriteTop:this.spriteTop,u=0;u<t;u++){var c=Math.random()*s;o.push.apply(o,F(h(c)))}for(var l=0;l<t;l++)i.push(l);function h(t){var i=e*Math.random(),o=e*Math.random(),s=-e/2+i,u=-e/2+o;if(a.version===Sz["GAODE2.x"]){var c=D(a.lngLatToCoord([s+n,-u+r]),2);return[c[0],c[1],t,0,0]}return[s+n,-u+r,t,0,0]}return{indices:i,positions:o}}},{key:"getUninforms",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.spriteScale,o=void 0===i?1:i;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_texture:this.texture,u_Scale:o}}},{key:"clearModels",value:function(){var e;cancelAnimationFrame(this.timer),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,r=t.spriteTop,i=void 0===r?5e6:r,o=t.spriteUpdate,a=void 0===o?1e4:o,s=t.spriteAnimate,u=void 0===s?SH.DOWN:s,this.mapTexture=n,this.spriteTop=i,this.spriteUpdate=a,this.spriteAnimate="up"===u?SH.UP:SH.DOWN,c=this.rendererService.createTexture2D,this.texture=c({height:0,width:0}),this.updateTexture(n),setTimeout((function(){h.updateModel()}),100),e.next=11,this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Color;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_Scale;\nvarying vec3 v_Color;\nvarying float v_d;\n#pragma include "projection"\nvoid main() {\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nv_d = a_Position.z;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n}\ngl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;\n}',fragmentShader:"uniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\nvarying vec3 v_Color;\nvarying float v_d;\nvoid main() {\nif(v_d < 0.0) {\ndiscard;\n}\nif(u_mapFlag > 0.0) {\ngl_FragColor = texture2D(u_texture, gl_PointCoord);\ngl_FragColor.a *= u_opacity;\n} else {\ngl_FragColor = vec4(v_Color, u_opacity);\n}\n}",triangulation:this.planeGeometryTriangulation,primitive:fL.POINTS,depth:{enable:!1},blend:this.getBlend()});case 11:return l=e.sent,e.abrupt("return",[l]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:0,height:0})}},{key:"registerBuiltinAttributes",value:function(){return""}}]),i}(gG),billboard:bH},AH=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","GeometryLayer"),E(I(e),"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new EH[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{plane:{},sprite:{},billboard:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]),r}(dG),wH='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',TH=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\nuniform vec2 u_sceneCenterMercator;\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\nvoid main() {\r\nv_color = a_Color;\r\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\nvec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\nvec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\nvec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\ngl_Position = u_Mvp * (project_pos);\r\n} else {\r\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\nvec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\ngl_Position = project_common_position_to_clipspace(project_pos);\r\n}\r\nsetPickingColor(a_PickingColor);\r\n}',fragmentShader:wH,triangulation:lH,primitive:fL.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:jD.Attribute,descriptor:{name:"a_Pos",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),i}(gG),CH=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||1,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform vec2 u_sceneCenterMercator;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nvec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\nvec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\nfloat lightWeight = calc_lighting(project_pos);\nv_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\ngl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n} else {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nvec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\nfloat lightWeight = calc_lighting(project_pos);\nv_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\ngl_Position = project_common_position_to_clipspace(project_pos);\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:wH,triangulation:JG,primitive:fL.TRIANGLES,depth:{enable:!0}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:jD.Attribute,descriptor:{name:"a_Pos",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),i}(gG);var kH=vw()(mH=function(e){A(o,e);var t,n,r,i=O(o);function o(){var e;b(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E(I(e=i.call.apply(i,[this].concat(n))),"texture",void 0),E(I(e),"colorTexture",void 0),E(I(e),"heatmapFramerBuffer",void 0),E(I(e),"intensityModel",void 0),E(I(e),"colorModel",void 0),E(I(e),"shapeType",void 0),E(I(e),"preRampColors",void 0),e}return S(o,[{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.useFramebuffer,o=this.layer.getLayerConfig().rampColors;i(this.heatmapFramerBuffer,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()})),yz(this.preRampColors,o)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode(e):this.draw3DHeatMap(e)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(r=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.rendererService,r=n.createFramebuffer,i=n.getViewportSize,o=n.createTexture2D,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=(null==a||null===(t=a.scale)||void 0===t?void 0:t.field)||"heatmap",this.shapeType=s,e.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=e.sent,this.colorModel="heatmap"===s?this.buildHeatmapColor():this.build3dHeatMap(),u=i(),c=u.width,l=u.height,this.heatmapFramerBuffer=r({color:o({width:Math.floor(c/4),height:Math.floor(l/4),wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE,min:fL.LINEAR,mag:fL.LINEAR}),depth:!1}),this.updateColorTexture(),e.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:jD.Attribute,descriptor:{name:"a_Dir",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size;return[void 0===t?1:t]}}})}},{key:"buildHeatMapIntensity",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=pH,e.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#define GAUSS_COEF  0.3989422804014327\n#pragma include "projection"\nvoid main(){\nv_weight = a_Size;\nfloat ZERO = 1.0 / 255.0 / 16.0;\nfloat extrude_x = a_Dir.x * 2.0 -1.0;\nfloat extrude_y = a_Dir.y * 2.0 -1.0;\nvec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\nfloat S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\nv_extrude = extrude_dir * S;\nvec2 offset = project_pixel(v_extrude * u_radius);\nvec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n}\n}',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\nfloat d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\nfloat val = v_weight * u_intensity * GAUSS_COEF * exp(d);\ngl_FragColor = vec4(val, 1., 1., 1.);\n}",triangulation:pH,depth:{enable:!1},cull:{enable:!0,face:Hv(this.mapService.version)}});case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nvoid main() {\nv_texCoord = a_Uv;\ngl_Position = vec4(a_Position.xy, 0, 1.);\n}",fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nuniform vec2 u_ViewportSize;\nfloat getBlurIndusty() {\nfloat vW = 2.0/u_ViewportSize.x;\nfloat vH = 2.0/u_ViewportSize.y;\nvec2 vUv = v_texCoord;\nfloat i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\nfloat i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\nfloat i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\nfloat i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\nfloat i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\nfloat i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\nfloat i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\nfloat i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\nfloat i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\nreturn(\ni11 + \ni12 + \ni13 + \ni21 + \ni21 + \ni22 + \ni23 + \ni31 + \ni32 + \ni33\n)/9.0;\n}\nvoid main(){\nfloat intensity = getBlurIndusty();\nvec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\ngl_FragColor =color;\ngl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}"});var e=this.shaderModuleService.getModule("heatmapColor"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService,o=i.createAttribute,a=i.createElements,s=i.createBuffer;return(0,i.createModel)({vs:t,fs:n,attributes:{a_Position:o({buffer:s({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:fL.FLOAT}),size:3}),a_Uv:o({buffer:s({data:[0,1,1,1,0,0,1,0],type:fL.FLOAT}),size:2})},uniforms:v({},r),depth:{enable:!1},elements:a({data:[0,2,1,2,3,1],type:fL.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.intensity,i=void 0===r?10:r,o=t.radius,a=void 0===o?5:o;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(e=this.intensityModel)||void 0===e||e.draw({uniforms:{u_opacity:n||1,u_radius:a,u_intensity:i},blend:{enable:!0,func:{srcRGB:fL.ONE,srcAlpha:1,dstRGB:fL.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(e){var t,n=this.layer.getLayerConfig().opacity;null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(e)})}},{key:"draw3DHeatMap",value:function(e){var t,n=this.layer.getLayerConfig().opacity,r=eS();iS(r,this.cameraService.getViewProjectionMatrixUncentered()),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:F(r)},blend:{enable:!0,func:{srcRGB:fL.SRC_ALPHA,srcAlpha:1,dstRGB:fL.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(e)})}},{key:"build3dHeatMap",value:function(){var e=(0,this.rendererService.getViewportSize)(),t=function(e,t){for(var n=[],r=[],i=[],o=e+1,a=t+1,s=e/2,u=t/2,c=0;c<a;c++)for(var l=c-u,h=0;h<o;h++){var f=h-s;r.push(f/s,-l/u,0),i.push(h/e),i.push(1-c/t)}for(var p=0;p<t;p++)for(var d=0;d<e;d++){var v=d+o*p,g=d+o*(p+1),m=d+1+o*(p+1),y=d+1+o*p;n.push(v,g,y),n.push(g,m,y)}return{vertices:r,indices:n,uvs:i}}(e.width/4,e.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\nfloat t2 = t * t;\nfloat one_minus_t = 1.0 - t;\nfloat one_minus_t2 = one_minus_t * one_minus_t;\nreturn (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\nreturn toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec2 pos = a_Uv * vec2(2.0) - vec2(1.0);\nvec4 p1 = vec4(pos, 0.0, 1.0);\nvec4 p2 = vec4(pos, 1.0, 1.0);\nvec4 inverseP1 = u_InverseViewProjectionMatrix * p1;\nvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\ninverseP1 = inverseP1 / inverseP1.w;\ninverseP2 = inverseP2 / inverseP2.w;\nfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z);\nvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\nvec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\nfloat fh;\nv_intensity = texture2D(u_texture, v_texCoord).r;\nfh = toBezier(v_intensity, b).y;\ngl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n}',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\nvoid main(){\nfloat intensity = texture2D(u_texture, v_texCoord).r;\nvec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\ngl_FragColor = color;\ngl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}"});var n=this.shaderModuleService.getModule("heatmap3dColor"),r=n.vs,i=n.fs,o=n.uniforms,a=this.rendererService,s=a.createAttribute,u=a.createElements,c=a.createBuffer;return(0,a.createModel)({vs:r,fs:i,attributes:{a_Position:s({buffer:c({data:t.vertices,type:fL.FLOAT}),size:3}),a_Uv:s({buffer:c({data:t.uvs,type:fL.FLOAT}),size:2})},primitive:fL.TRIANGLES,uniforms:v({},o),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:fL.SRC_ALPHA,srcAlpha:1,dstRGB:fL.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:u({data:t.indices,type:fL.UNSIGNED_INT,count:t.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var t=this.layer.getLayerConfig().rampColors,n=Nv(t);this.colorTexture=e({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE,min:fL.NEAREST,mag:fL.NEAREST,flipY:!1}),this.preRampColors=t}}]),o}(gG))||mH,MH={heatmap:kH,heatmap3d:kH,grid:TH,grid3d:CH,hexagon:function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform vec2 u_sceneCenterMercator;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\nvec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\ngl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:wH,triangulation:lH,depth:{enable:!1},primitive:fL.TRIANGLES});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:jD.Attribute,descriptor:{name:"a_Pos",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),i}(gG)},PH=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","HeatMapLayer"),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new MH[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.getModelType();return"heatmap"===n?(this.layerModel&&this.layerModel.render(t),this):(this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach((function(n){return n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)})})),this.hooks.afterRender.call()),this)}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models[0].updateAttributesAndElements(e.attributes,e.elements):console.warn("data error")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),r}(dG),IH={image:function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),e}return S(i,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer.getSource(),n=this.rendererService.createTexture2D,this.texture=n({height:0,width:0}),!Bd){e.next=11;break}r=this.layerService.sceneService.getSceneConfig().canvas,(i=r.createImage()).crossOrigin="anonymous",i.src=t.data.originData,i.onload=function(){s.texture=n({data:i,width:i.width,height:i.height}),s.layerService.reRender()},e.next=15;break;case 11:return e.next=13,t.data.images;case 13:o=e.sent,this.texture=n({data:o[0],width:o[0].width,height:o[0].height,mag:fL.LINEAR,min:fL.LINEAR});case 15:return e.next=17,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ngl_FragColor = color;\ngl_FragColor.a *= u_opacity;\nif(gl_FragColor.a < 0.01)\ndiscard;\n}",triangulation:hH,primitive:fL.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 17:return a=e.sent,e.abrupt("return",[a]);case 19:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(gG)},LH=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","ImageLayer"),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new IH[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),r}(dG),OH={solid:0,dash:1},RH=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:fL.NEAREST,min:fL.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.lineType,u=void 0===s?"solid":s,c=e.dashArray,l=void 0===c?[10,5]:c,h=e.forward,f=void 0===h||h,p=e.lineTexture,d=void 0!==p&&p,v=e.iconStep,g=void 0===v?100:v,m=e.segmentNumber,y=void 0===m?30:m,_=e.thetaOffset,b=void 0===_?.314:_;2===l.length&&l.push(0,0);var x=0,S=[0,0,0,0],E=[0,0,0,0];return r&&i&&(S=Lv(r),E=Lv(i),x=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:b,u_opacity:IB(n)?n:1,u_textureBlend:"normal"===a?0:1,segmentNumber:y,u_line_type:OH[u||"solid"],u_dash_array:l,u_blur:.9,u_lineDir:f?1:-1,u_texture:this.texture,u_line_texture:d?1:0,u_icon_step:g,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:x,u_sourceColor:S,u_targetColor:E}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'uniform float u_opacity;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying float v_distance_ratio;\nuniform float segmentNumber;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\nfloat flag = 0.;\nfloat dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n};\ngl_FragColor.a *=flag;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nuniform float u_thetaOffset: 0.314;\nuniform float u_opacity: 1.0;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = arcThetaOffset;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\nvec2 mid = midPoint(source, target, arcThetaOffset);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\nv_distance_ratio = segmentIndex / segmentNumber;\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\ngl_PointSize = 5.0;\nsetPickingColor(a_PickingColor);\n}',type:"Dash"}:t&&n?{frag:'varying vec4 v_color;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nvarying float v_segmentIndex;\nuniform float u_lineDir: 1.0;\nuniform float u_opacity: 1.0;\nuniform float u_thetaOffset: 0.314;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = arcThetaOffset;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\nvec2 mid = midPoint(source, target, arcThetaOffset);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nfloat d_distance_ratio;\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nfloat d_segmentIndex = a_Position.x + 1.0;\nv_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\nv_color.a *= u_opacity;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"Linear"}:{frag:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\n#pragma include "picking"\nvoid main() {\nfloat animateSpeed = 0.0;\ngl_FragColor = v_color;\ngl_FragColor.a *= u_opacity;\nif(u_animate.x == Animate && u_line_texture != LineTexture) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture) {\nfloat arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\nfloat count = v_lineData.g;\nfloat time = 0.0;\nif(u_animate.x == Animate) {\ntime = u_time / u_animate.y;\n}\nfloat redioCount = arcRadio * count;\nfloat u = fract(redioCount - time);\nfloat v = v_lineData.a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_animate.x == Animate) {\nfloat currentPlane = floor(redioCount - time);\nfloat textureStep = floor(count * u_animate.z);\nfloat a = mod(currentPlane, textureStep);\nif(a < textureStep - 1.0) {\npattern = vec4(0.0);\n}\n}\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= u_opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nuniform float u_lineDir: 1.0;\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\nvarying vec2 v_distance_ratio;\nuniform float u_opacity: 1.0;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = arcThetaOffset;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\nvec2 mid = midPoint(source, target, arcThetaOffset);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nfloat d_distance_ratio;\nif(u_animate.x == Animate) {\nd_distance_ratio = segmentIndex / segmentNumber;\nif(u_lineDir != 1.0) {\nd_distance_ratio = 1.0 - d_distance_ratio;\n}\n}\nv_lineData.b = d_distance_ratio;\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nfloat d_segmentIndex = a_Position.x + 1.0;\nv_lineData.r = d_segmentIndex;\nif(LineTexture == u_line_texture) {\nfloat arcDistrance = length(source - target);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\narcDistrance *= 1000000.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\narcDistrance = project_pixel_allmap(arcDistrance);\n}\nv_iconMapUV = a_iconMapUV;\nfloat pixelLen = project_pixel_texture(u_icon_step);\nfloat texCount = floor(arcDistrance/pixelLen);\nv_lineData.g = texCount;\nfloat lineOffsetWidth = length(offset + offset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nv_lineData.a = lineOffsetWidth/linePixelSize;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:""}}},{key:"buildModels",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+s,vertexShader:a,fragmentShader:o,triangulation:fH,depth:{enable:!1},segmentNumber:r});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:jD.Attribute,descriptor:{name:"a_Instance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(gG),NH='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_opacity;\nvarying vec2 v_iconMapUV;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n#pragma include "picking"\nvoid main() {\nfloat opacity = u_opacity;\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = v_line_data.g;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nif(u_line_type == LineTypeDash) {\nfloat flag = 0.;\nfloat dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\n}\nif(u_animate.x == Animate && u_line_texture != LineTexture) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture && u_line_type != LineTypeDash) {\nfloat arcRadio = v_segmentIndex / (segmentNumber - 1.0);\nfloat count = v_line_data.b;\nfloat time = 0.0;\nif(u_animate.x == Animate) {\ntime = u_time / u_animate.y;\n}\nfloat redioCount = arcRadio * count;\nfloat u = fract(redioCount - time);\nfloat v = v_line_data.a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_animate.x == Animate) {\nfloat currentPlane = floor(redioCount - time);\nfloat textureStep = floor(count * u_animate.z);\nfloat a = mod(currentPlane, textureStep);\nif(a < textureStep - 1.0) {\npattern = vec4(0.0);\n}\n}\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\ndiscard;\n} else {\ngl_FragColor = filterColor(pattern);\n}\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',DH='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat torad(float deg) {\nreturn (deg / 180.0) * acos(-1.0);\n}\nvec3 lglt2xyz(vec2 lnglat) {\nfloat pi = 3.1415926;\nfloat lng = torad(lnglat.x) + pi / 2.0;\nfloat lat = torad(lnglat.y);\nfloat radius = u_globel_radius;\nfloat z = radius * cos(lat) * cos(lng);\nfloat x = radius * cos(lat) * sin(lng);\nfloat y = radius * sin(lat);\nreturn vec3(x, y, z);\n}\nvoid main() {\nv_color = a_Color;\nvec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\nvec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat d_distance_ratio;\nif(u_line_type == LineTypeDash) {\nd_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_animate.x == Animate) {\nd_distance_ratio = segmentIndex / segmentNumber;\n}\nv_line_data.g = d_distance_ratio;\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec3 curr = getPos(source, target, segmentRatio);\nvec3 next = getPos(source, target, nextSegmentRatio);\nvec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\nv_segmentIndex = a_Position.x;\nif(LineTexture == u_line_texture && u_line_type != LineTypeDash) {\nfloat arcDistrance = length(source - target);\nfloat pixelLen =  project_pixel_texture(u_icon_step);\nv_line_data.b = floor(arcDistrance/pixelLen);\nvec2 projectOffset = project_pixel(offset);\nfloat lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nv_line_data.a = lineOffsetWidth/linePixelSize;\nv_iconMapUV = a_iconMapUV;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n}\nif(u_globel > 0.0) {\nvec3 startLngLat = lglt2xyz(a_Instance.rg);\nvec3 endLngLat = lglt2xyz(a_Instance.ba);\nfloat globalRadius = length(startLngLat);\nvec3 lineDir = normalize(endLngLat - startLngLat);\nvec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\nvec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\nfloat lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\nfloat lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\nvec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\ngl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n}\nsetPickingColor(a_PickingColor);\n}',FH='#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\nvarying float v_distance_ratio;\n#pragma include "picking"\nvoid main() {\nfloat animateSpeed = 0.0;\ngl_FragColor = v_Color;\nif(u_animate.x == Animate) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',BH='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat torad(float deg) {\nreturn (deg / 180.0) * acos(-1.0);\n}\nvec3 lglt2xyz(vec2 lnglat) {\nfloat pi = 3.1415926;\nfloat lng = torad(lnglat.x) + pi / 2.0;\nfloat lat = torad(lnglat.y);\nfloat radius = u_globel_radius;\nfloat z = radius * cos(lat) * cos(lng);\nfloat x = radius * cos(lat) * sin(lng);\nfloat y = radius * sin(lat);\nreturn vec3(x, y, z);\n}\nvoid main() {\nv_color = a_Color;\nvec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\nvec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat d_distance_ratio;\nif(u_line_type == LineTypeDash) {\nd_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_animate.x == Animate) {\nv_distance_ratio = segmentIndex / segmentNumber;\n}\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec3 curr = getPos(source, target, segmentRatio);\nvec3 next = getPos(source, target, nextSegmentRatio);\nvec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\nfloat animateSpeed = 0.0;\nv_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\nv_Color.a *= opacity;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n}\nif(u_globel > 0.0) {\nvec3 startLngLat = lglt2xyz(a_Instance.rg);\nvec3 endLngLat = lglt2xyz(a_Instance.ba);\nfloat globalRadius = length(startLngLat);\nvec3 lineDir = normalize(endLngLat - startLngLat);\nvec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\nvec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\nfloat lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\nfloat lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\nvec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\ngl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n}\nsetPickingColor(a_PickingColor);\n}',zH={solid:0,dash:1},UH=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:fL.NEAREST,min:fL.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5]:s,c=e.lineTexture,l=void 0!==c&&c,h=e.iconStep,f=void 0===h?100:h,p=e.segmentNumber,d=void 0===p?30:p,g=e.globalArcHeight,m=void 0===g?10:g;2===u.length&&u.push(0,0);var y=0,_=[0,0,0,0],b=[0,0,0,0];return t&&n&&(_=Lv(t),b=Lv(n),y=1),this.rendererService.getDirty()&&this.texture.bind(),v({u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:100,u_global_height:m,u_textureBlend:"normal"===i?0:1,segmentNumber:d,u_line_type:zH[a]||0,u_dash_array:u,u_texture:this.texture,u_line_texture:l?1:0,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:y,u_sourceColor:_,u_targetColor:b},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:FH,vert:BH,type:"Linear"}:{frag:NH,vert:DH,type:""}}},{key:"buildModels",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:fH,segmentNumber:r});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:jD.Attribute,descriptor:{name:"a_Instance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(gG),jH={solid:0,dash:1},VH=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:fL.NEAREST,min:fL.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.lineType,u=void 0===s?"solid":s,c=e.dashArray,l=void 0===c?[10,5]:c,h=e.lineTexture,f=void 0!==h&&h,p=e.iconStep,d=void 0===p?100:p,v=e.segmentNumber,g=void 0===v?30:v,m=e.globalArcHeight,y=void 0===m?10:m;2===l.length&&l.push(0,0);var _=0,b=[0,0,0,0],x=[0,0,0,0];return r&&i&&(b=Lv(r),x=Lv(i),_=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:100,u_global_height:y,u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:g,u_line_type:jH[u]||0,u_dash_array:l,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_,u_sourceColor:b,u_targetColor:x}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:FH,vert:BH,type:"Linear"}:{frag:NH,vert:DH,type:""}}},{key:"buildModels",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+s,vertexShader:a,fragmentShader:o,triangulation:fH,depth:{enable:!0},segmentNumber:r});case 4:return u=e.sent,e.abrupt("return",[u]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:jD.Attribute,descriptor:{name:"a_Instance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(gG),GH=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.gapWidth,n=void 0===t?2:t,r=e.strokeWidth,i=void 0===r?1:r,o=e.stroke,a=void 0===o?"#000":o,s=e.strokeOpacity,u=void 0===s?1:s;return v({u_gap_width:n,u_stroke_width:i,u_stroke:Lv(a),u_stroke_opacity:u},this.getStyleAttribute())}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec4 a_Instance;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nuniform float u_gap_width: 1.0;\nuniform float u_stroke_width: 1.0;\nuniform float u_stroke_opacity: 1.0;\nvoid main() {\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nvec2 flowlineDir = normalize(target - source);\nvec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\nvec2 position = mix(source, target, a_Position.x);\nfloat lengthCommon = length(target - source);    \nvec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);\nvec2 limitedOffsetDistances = clamp(   \noffsetDistances,\n-lengthCommon*.8, lengthCommon*.8\n);\nfloat startOffsetCommon = project_pixel(offsets[0]);\nfloat endOffsetCommon = project_pixel(offsets[1]);\nfloat endpointOffset = mix(\nclamp(startOffsetCommon, 0.0, lengthCommon*.2),\n-clamp(endOffsetCommon, 0.0, lengthCommon*.2),\na_Position.x\n);\nvec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);\nfloat gapCommon =  project_pixel(u_gap_width);\nvec3 offsetCommon = vec3(\nflowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\nperpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n0.0\n);\nvec4 project_pos = project_position(vec4(position.xy, 0, 1.0));\nvec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\nv_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offsetCommon.xy, 0., 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#extension GL_OES_standard_derivatives : enable\nvarying vec4 v_color;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor = filterColor(gl_FragColor);\n}',inject:this.getInject(),triangulation:nH,primitive:fL.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:jD.Attribute,descriptor:{name:"a_Instance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}})}}]),i}(gG),HH={solid:0,dash:1},WH=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:fL.NEAREST,min:fL.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.lineType,u=void 0===s?"solid":s,c=e.dashArray,l=void 0===c?[10,5]:c,h=e.lineTexture,f=void 0!==h&&h,p=e.iconStep,d=void 0===p?100:p,v=e.segmentNumber,g=void 0===v?30:v;2===l.length&&l.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var m=0,y=[0,0,0,0],_=[0,0,0,0];return r&&i&&(y=Lv(r),_=Lv(i),m=1),{u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:g,u_line_type:HH[u]||0,u_dash_array:l,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:m,u_sourceColor:y,u_targetColor:_}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn index / (segmentNumber - 1.);\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\nvec2 delta = source - target;\nvec2 sin_half_delta = sin(delta / 2.0);\nfloat a =\nsin_half_delta.y * sin_half_delta.y +\ncos(source.y) * cos(target.y) *\nsin_half_delta.x * sin_half_delta.x;\nreturn 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\nvec2 midPoint(vec2 source, vec2 target) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = 0.314;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nreturn mid;\n}\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 mid = midPoint(source, target);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}else {\nif(abs(angularDist - PI) < 0.001) {\nreturn (1.0 - t) * source + t * target;\n}\nfloat a = sin((1.0 - t) * angularDist) / sin(angularDist);\nfloat b = sin(t * angularDist) / sin(angularDist);\nvec2 sin_source = sin(source);\nvec2 cos_source = cos(source);\nvec2 sin_target = sin(target);\nvec2 cos_target = cos(target);\nfloat x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\nfloat y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\nfloat z = a * sin_source.y + b * sin_target.y;\nreturn vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n}\n}\nvoid main() {\nv_color = a_Color;\nvec2 source = radians(a_Instance.rg);\nvec2 target = radians(a_Instance.ba);\nfloat angularDist = getAngularDist(source, target);\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\ntotal_Distance = total_Distance*16.0;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n}\nif(u_animate.x == Animate) {\nv_distance_ratio = segmentIndex / segmentNumber;\n}\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nv_distance_ratio = segmentIndex / segmentNumber;\nvec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\nvec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nv_line_data.g = a_Position.x;\nif(LineTexture == u_line_texture) {\nfloat d_arcDistrance = length(source - target);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nd_arcDistrance = d_arcDistrance * 1000000.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nd_arcDistrance = project_pixel_allmap(d_arcDistrance);\n}\nfloat d_pixelLen = project_pixel(u_icon_step)/8.0;\nv_line_data.b = floor(d_arcDistrance/d_pixelLen);\nfloat lineOffsetWidth = length(offset + offset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nv_line_data.a = lineOffsetWidth/linePixelSize;\nv_iconMapUV = a_iconMapUV;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying vec4 v_line_data;\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\nvoid main() {\nfloat opacity = u_opacity;\nfloat animateSpeed = 0.0;\nfloat d_segmentIndex = v_line_data.g;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_line_type == LineTypeDash) {\nfloat dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n} else {\ndiscard;\n};\n}\nif(u_animate.x == Animate) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \nfloat arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\nfloat count = v_line_data.b;\nfloat u = fract(arcRadio * count - animateSpeed * count);\nif(u_animate.x == Animate) {\nu = gl_FragColor.a/opacity;\n}\nfloat v = v_line_data.a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:fH,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:jD.Attribute,descriptor:{name:"a_Instance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(gG),YH='#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\nvarying vec4 v_texture_data;\nvec2 calculateArrow(vec2 offset) {\nfloat arrowFlag = -1.0;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\narrowFlag = 1.0;\n}\nfloat pi = arrowFlag * 3.1415926/2.;\nif(a_Miter < 0.) {\npi = -pi;\n}\nhighp float angle_sin = sin(pi);\nhighp float angle_cos = cos(pi);\nmat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\nfloat arrowWidth = u_arrowWidth;\nfloat arrowHeight = u_arrowHeight;\nvec2 arrowOffset = vec2(0.0);\nif(a_DistanceAndIndex.y == 0.0) {\noffset = vec2(0.0);\n} else if(a_DistanceAndIndex.y == 1.0) {\narrowOffset = rotation_matrix*(offset * arrowHeight);\noffset += arrowOffset;\noffset = offset * arrowWidth;\n} else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\narrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\noffset += arrowOffset;\n}\nreturn offset;\n}\nvoid main() {\nfloat d_texPixelLen;\nv_iconMapUV = a_iconMapUV;\nd_texPixelLen = project_float_pixel(u_icon_step);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nd_texPixelLen *= 10.0;\n}\nv_color = a_Color;\nv_color.a *= opacity;\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nfloat lineDistance = a_DistanceAndIndex.x;\nfloat currentLinePointRatio = lineDistance / a_Total_Distance;\nif(u_arrow > 0.0) {\noffset = calculateArrow(offset);\nif(a_DistanceAndIndex.y > 4.0) {\noffset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n}\n}\nfloat lineOffsetWidth = length(offset + offset * sign(a_Miter));\nfloat linePixelSize = project_pixel(a_Size.x) * 2.0;\nfloat texV = lineOffsetWidth/linePixelSize;\nv_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat h = float(a_Position.z) * u_vertexScale;\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nlineHeight *= 0.2;\nh *= 0.2;\nif(u_heightfixed < 1.0) {\nlineHeight = project_pixel(a_Size.y);\n}\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nh *= mapboxZoomScale;\nh += u_raisingHeight * mapboxZoomScale;\nif(u_heightfixed > 0.0) {\nlineHeight *= mapboxZoomScale;\n}\n} else {\nh += u_raisingHeight;\nif(u_heightfixed < 1.0) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',XH={solid:0,dash:1},ZH=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"textureEventFlag",!1),E(I(e),"texture",e.createTexture2D({data:[0,0,0,0],mag:fL.NEAREST,min:fL.NEAREST,premultiplyAlpha:!1,width:1,height:1})),E(I(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:fL.NEAREST,min:fL.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5,0,0]:s,c=e.lineTexture,l=void 0!==c&&c,h=e.iconStep,f=void 0===h?100:h,p=e.vertexHeightScale,d=void 0===p?20:p,g=e.borderWidth,m=void 0===g?0:g,y=e.borderColor,_=void 0===y?"#ccc":y,b=e.raisingHeight,x=void 0===b?0:b,S=e.heightfixed,E=void 0!==S&&S,A=e.linearDir,w=void 0===A?yG.VERTICAL:A,T=e.blur,C=void 0===T?[1,1,1]:T,k=e.arrow,M=void 0===k?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:k;2===u.length&&u.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var P=0,I=[0,0,0,0],L=[0,0,0,0];return t&&n&&(I=Lv(t),L=Lv(n),P=1),v({u_textureBlend:i===_G.NORMAL?0:1,u_line_type:XH[a],u_dash_array:u,u_blur:C,u_texture:this.texture,u_line_texture:l?1:0,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:m,u_borderColor:Lv(_),u_linearDir:w===yG.VERTICAL?1:0,u_linearColor:P,u_sourceColor:I,u_targetColor:L,u_heightfixed:Number(E),u_vertexScale:d,u_raisingHeight:Number(x),u_arrow:Number(M.enable),u_arrowHeight:M.arrowHeight||3,u_arrowWidth:M.arrowWidth||2,u_tailWidth:void 0===M.tailWidth?1:M.tailWidth},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,this.layer.triangulation=yE,e.next=5,this.layer.buildLayerModel({moduleName:"line"+s,vertexShader:a,fragmentShader:o,triangulation:yE,inject:this.getInject(),depth:{enable:r}});case 5:return u=e.sent,e.abrupt("return",[u]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'#define LineTypeSolid 0.0\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n#pragma include "picking"\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvoid main() {\ngl_FragColor = v_color;\nfloat dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n} else {\ndiscard;\n};\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_vertexScale: 1.0;\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\nvoid main() {\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\nv_color = vec4(a_Color.xyz, a_Color.w * opacity);\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nv_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));\n} else {\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"Dash"}:t&&n?{frag:'varying vec4 v_color;\nvarying vec4 v_texture_data;\nuniform float u_linearDir: 1.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity: 1.0;\n#pragma include "picking"\nvoid main() {\nfloat linearRadio = v_texture_data.r;\nif(u_linearDir < 1.0) {\nlinearRadio = v_texture_data.a;\n}\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);\ngl_FragColor.a *= v_color.a;\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:YH,type:"Linear"}:{frag:'#extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_textureBlend;\nuniform float u_borderWidth: 0.0;\nuniform vec3 u_blur;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_texture_data;\n#pragma include "picking"\nuniform float u_time;\nuniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ];\nvoid main() {\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = v_texture_data.r;\ngl_FragColor = v_color;\nif(u_animate.x == Animate) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture) {\nfloat aDistance = v_texture_data.g;\nfloat d_texPixelLen = v_texture_data.b;\nfloat u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\nfloat v = v_texture_data.a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor += pattern;\n} else {\npattern.a *= v_color.a;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = pattern;\n}\n} \nfloat v = v_texture_data.a;\nfloat borderWidth = min(0.5, u_borderWidth);\nif(borderWidth > 0.01) {\nfloat borderOuterWidth = borderWidth / 2.0;\nif(v >= 1.0 - borderWidth || v <= borderWidth) {\nif(v > borderWidth) {\nfloat linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\ngl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n} else if(v <= borderWidth) {\nfloat linear = smoothstep(0.0, 1.0, v/borderWidth);\ngl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n}\n}\nif(v < borderOuterWidth) {\ngl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n} else if(v > 1.0 - borderOuterWidth) {\ngl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n}\n}\nfloat blurV = v_texture_data.a;\nif(blurV < 0.5) {\ngl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n} else {\ngl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:YH,type:""}}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:jD.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:jD.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:jD.Attribute,descriptor:{name:"a_Miter",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(gG),qH=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"colorTexture",void 0),E(I(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;e.colorTexture&&e.colorTexture.destroy();var n=Nv(e.layer.getLayerConfig().rampColors);e.colorTexture=t({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE,min:fL.NEAREST,mag:fL.NEAREST,flipY:!1})})),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.vertexHeightScale,i=void 0===r?20:r,o=e.raisingHeight,a=void 0===o?0:o,s=e.heightfixed,u=void 0!==s&&s,c=e.linearDir,l=void 0===c?yG.VERTICAL:c;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:l===yG.VERTICAL?1:0,u_opacity:IB(n)?n:1,u_texture:this.colorTexture,u_heightfixed:Number(u),u_vertexScale:i,u_raisingHeight:Number(a)}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,this.layer.triangulation=tH,e.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:'attribute float a_Miter;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity : 1.0;\nuniform sampler2D u_texture;\nuniform float u_linearDir: 1.0;\nvarying vec4 v_Color;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nfloat lineDistance = a_DistanceAndIndex.x;\nfloat currentLinePointRatio = lineDistance / a_Total_Distance;\nfloat lineOffsetWidth = length(offset + offset * sign(a_Miter));\nfloat linePixelSize = project_pixel(a_Size.x) * 2.0;\nfloat texV = lineOffsetWidth/linePixelSize;\nfloat linearRadio =currentLinePointRatio;\nif(u_linearDir < 1.0) {\nlinearRadio = texV;\n}\nv_Color = texture2D(u_texture, vec2(linearRadio, 0.5));\nv_Color.a *= u_opacity;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat h = float(a_Position.z) * u_vertexScale;\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nlineHeight *= 0.2;\nh *= 0.2;\nif(u_heightfixed < 1.0) {\nlineHeight = project_pixel(a_Size.y);\n}\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nh *= mapboxZoomScale;\nh += u_raisingHeight * mapboxZoomScale;\nif(u_heightfixed > 0.0) {\nlineHeight *= mapboxZoomScale;\n}\n} else {\nh += u_raisingHeight;\nif(u_heightfixed < 1.0) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'varying vec4 v_Color;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_Color;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:tH,depth:{enable:r}});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:jD.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:jD.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:jD.Attribute,descriptor:{name:"a_Miter",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}})}}]),i}(gG),KH='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\nattribute float a_Total_Distance;\nattribute float a_Distance;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity: 1.0;\nuniform float u_vertexScale: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "projection"\nvarying vec4 v_color;\nvarying float v_distanceScale;\nvoid main() {\nv_color = a_Color; \nv_distanceScale = a_Distance / a_Total_Distance;\nv_color = vec4(a_Color.xyz, a_Color.w * u_opacity); \nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat h = float(a_Position.z) * u_vertexScale;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n} else {\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nh *= 2.0/pow(2.0, 20.0 - u_Zoom);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\ngl_PointSize = 10.0;\n}\n}',QH=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.vertexHeightScale,a=void 0===o?20:o,s=0,u=[0,0,0,0],c=[0,0,0,0];return r&&i&&(u=Lv(r),c=Lv(i),s=1),{u_opacity:IB(n)?n:1,u_linearColor:s,u_sourceColor:u,u_targetColor:c,u_vertexScale:a}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:"uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float opacity;\nvoid main() {\ngl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\ngl_FragColor.a *= opacity;\n}",vert:KH,type:"lineSimpleLinear"}:{frag:"varying vec4 v_color;\nvoid main() {\ngl_FragColor = v_color;\n}",vert:KH,type:"lineSimpleNormal"}}},{key:"buildModels",value:(t=_(g().mark((function e(){var t,n,r,i,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,triangulation:rH,primitive:fL.LINES,depth:{enable:!1},pick:!1});case 3:return o=e.sent,e.abrupt("return",[o]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:jD.Attribute,descriptor:{name:"a_Distance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:jD.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}})}}]),i}(gG),$H={arc:RH,arc3d:UH,greatcircle:WH,wall:function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:fL.NEAREST,min:fL.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.heightfixed,u=void 0!==s&&s,c=e.lineTexture,l=void 0!==c&&c,h=e.iconStep,f=void 0===h?100:h,p=e.iconStepCount,d=void 0===p?1:p;this.rendererService.getDirty()&&this.texture.bind();var v=0,g=[0,0,0,0],m=[0,0,0,0];return r&&i&&(g=Lv(r),m=Lv(i),v=1),{u_heightfixed:Number(u),u_opacity:IB(n)?n:1,u_textureBlend:"normal"===a?0:1,u_texture:this.texture,u_line_texture:l?1:0,u_iconStepCount:d,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:g,u_targetColor:m}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\nuniform float u_linearColor: 0;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvarying vec2 v_iconMapUV;\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_dataset;\nvoid main() {\nfloat d_distance_ratio;\nfloat d_texPixelLen;\nv_iconMapUV = a_iconMapUV;\nif(u_heightfixed < 1.0) {\nd_texPixelLen = project_pixel(u_icon_step);\n} else {\nd_texPixelLen = u_icon_step;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nd_texPixelLen *= 10.0;\n}\nif(u_animate.x == Animate || u_linearColor == 1.0) {\nd_distance_ratio = a_Distance / a_Total_Distance;\n}\nfloat miter = (a_Miter + 1.0)/2.0;\nv_dataset[0] = d_distance_ratio;\nv_dataset[1] = a_Distance;\nv_dataset[2] = d_texPixelLen;\nv_dataset[3] = miter;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat originSize = a_Size.x;\nif(u_heightfixed < 1.0) {\noriginSize = project_float_pixel(a_Size.x);\n}\nfloat wallHeight = originSize * miter;\nfloat lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\nv_blur = min(project_float_pixel(2.0) / originSize, 0.05);\nv_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_color;\nvarying vec4 v_dataset;\n#pragma include "picking"\nvoid main() {\nfloat opacity = u_opacity;\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = v_dataset.r;\nfloat v = v_dataset.a;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, v);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_animate.x == Animate) {\nanimateSpeed = u_time / u_animate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\nalpha = (alpha + u_animate.w -1.0) / u_animate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture) {\nfloat aDistance = v_dataset.g;\nfloat d_texPixelLen = v_dataset.b;\nfloat u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\nfloat v = v_dataset.a;\nfloat flag = 0.0;\nif(u > 1.0/u_iconStepCount) {\nflag = 1.0;\n}\nu = fract(u*u_iconStepCount);\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(flag > 0.0) {\npattern = vec4(0.0);\n}\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n}\nif(v < v_blur) {\ngl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n} else if(v > 1.0 - v_blur) {\ngl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:tH,depth:{enable:!1},blend:this.getBlend()});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:jD.Attribute,descriptor:{name:"a_Distance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:jD.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:jD.Attribute,descriptor:{name:"a_Miter",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(gG),line:ZH,simple:QH,linearline:qH,earthArc3d:VH,flowline:GH},JH=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","LineLayer"),E(I(e),"enableShaderEncodeStyles",["opacity","offsets","stroke"]),E(I(e),"arrowInsertCount",0),E(I(e),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new $H[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e;if(this.layerType)return this.layerType;var t=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"line"}},{key:"processData",value:function(e){if("simple"!==this.getModelType())return e;var t=[];return e.map((function(e){if(Array.isArray(e.coordinates)&&Array.isArray(e.coordinates[0])&&Array.isArray(e.coordinates[0][0])){var n=v({},e);e.coordinates.map((function(e){t.push(v(v({},n),{},{coordinates:e}))}))}else t.push(e)})),t}}]),r}(dG);ar({target:"String",proto:!0},{repeat:Oy});var eW=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"raiseCount",0),E(I(e),"raiseRepeat",0),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,o=e.sourceColor,a=e.targetColor,s=e.pickLight,u=void 0!==s&&s,c=e.heightfixed,l=void 0!==c&&c,h=e.opacityLinear,f=void 0===h?{enable:!1,dir:"up"}:h,p=e.lightEnable,d=void 0===p||p,v=0,g=[0,0,0,0],m=[0,0,0,0];if(o&&a&&(g=Lv(o),m=Lv(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(l),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:IB(i)?i:1,u_linearColor:v,u_sourceColor:g,u_targetColor:m,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:"up"===f.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption.repeat,r=void 0===n?1:n,this.raiseRepeat=r,e.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\nuniform float u_heightfixed: 0.0;\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nfloat getYRadian(float x, float z) {\nif(x > 0.0 && z > 0.0) {\nreturn atan(x/z);\n} else if(x > 0.0 && z <= 0.0){\nreturn atan(-z/x) + pi/2.0;\n} else if(x <= 0.0 && z <= 0.0) {\nreturn  pi + atan(x/z);\n} else {\nreturn atan(z/-x) + pi*3.0/2.0;\n}\n}\nfloat getXRadian(float y, float r) {\nreturn atan(y/r);\n}\nvoid main() {\nfloat textureOffset = 0.0;\ntextureOffset = opacityAndOffset.g;\nvec3 size = a_Size * a_Position;\nv_barLinearZ =  a_Position.z;\nvec3 offset = size;\nif(u_heightfixed < 1.0) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\noffset = offset * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\noffset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\noffset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n}\n}\nvec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\nvec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\nfloat lightWeight = 1.0;\nif(u_lightEnable > 0.0) {\nlightWeight = calc_lighting(pos);\n}\nv_lightWeight = lightWeight;\nif(u_linearColor == 1.0) {\nv_color = mix(u_sourceColor, u_targetColor, barLinearZ);\nv_color.rgb *= lightWeight;\n} else {\nv_color = a_Color;\n}\nv_color.a *= u_opacity;\nfloat r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\nfloat xRadian = getXRadian(a_Pos.y, r);\nfloat xcos = cos(xRadian);\nfloat xsin = sin(xRadian);\nmat4 mx = mat4(\n1,0,0,0,  \n0,xcos,-xsin,0,  \n0,xsin,xcos,0,  \n0,0,0,1);\nfloat yRadian = getYRadian(a_Pos.x, a_Pos.z);\nfloat ycos = cos(yRadian);\nfloat ysin = sin(yRadian);\nmat4 my = mat4(\nycos,0,-ysin,0,  \n0,1,0,0,  \nysin,0,ycos,0,  \n0,0,0,1);\ngl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\nuniform float u_pickLight: 0.0;\n#pragma include "picking"\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\nvoid main() {\ngl_FragColor = v_color;\nif(u_opacitylinear > 0.0) {\ngl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n}\nif(u_pickLight > 0.0) {\ngl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:JG,depth:{enable:!0},cull:{enable:!0,face:Hv(this.mapService.version)},blend:this.getBlend()});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:jD.Attribute,descriptor:{name:"a_Pos",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e){var t=h_(e.coordinates);return CG([t[0],t[1]])}}})}}]),i}(gG),tW=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.strokeOpacity,i=void 0===r?1:r,o=e.strokeWidth,a=void 0===o?0:o,s=e.stroke,u=void 0===s?"rgba(0,0,0,0)":s,c=e.blend,l=e.blur;return{u_blur:void 0===l?0:l,u_additive:"additive"===c?1:0,u_opacity:n,u_stroke_opacity:i,u_stroke_width:a,u_stroke_color:Lv(u)}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=$G,e.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\nuniform float u_blur : 0.0;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nfloat shape_type = a_Shape;\nfloat newSize = setPickingSize(a_Size);\nv_color = a_Color;\nv_radius = newSize;\nfloat antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\nv_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\ngl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_additive;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nint shape = int(floor(v_data.w + 0.5));\nvec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius + strokeWidth);\nfloat outer_df;\nfloat inner_df;\nif (shape == 0) {\nouter_df = sdCircle(v_data.xy, 1.0);\ninner_df = sdCircle(v_data.xy, r);\n} else if (shape == 1) {\nouter_df = sdEquilateralTriangle(1.1 * v_data.xy);\ninner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n} else if (shape == 2) {\nouter_df = sdBox(v_data.xy, vec2(1.));\ninner_df = sdBox(v_data.xy, vec2(r));\n} else if (shape == 3) {\nouter_df = sdPentagon(v_data.xy, 0.8);\ninner_df = sdPentagon(v_data.xy, r * 0.8);\n} else if (shape == 4) {\nouter_df = sdHexagon(v_data.xy, 0.8);\ninner_df = sdHexagon(v_data.xy, r * 0.8);\n} else if (shape == 5) {\nouter_df = sdOctogon(v_data.xy, 1.0);\ninner_df = sdOctogon(v_data.xy, r);\n} else if (shape == 6) {\nouter_df = sdHexagram(v_data.xy, 0.52);\ninner_df = sdHexagram(v_data.xy, r * 0.52);\n} else if (shape == 7) {\nouter_df = sdRhombus(v_data.xy, vec2(1.0));\ninner_df = sdRhombus(v_data.xy, vec2(r));\n} else if (shape == 8) {\nouter_df = sdVesica(v_data.xy, 1.1, 0.8);\ninner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n}\nif(outer_df > antialiasblur + 0.018) discard;\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\nfloat color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\nantialiasblur,\n0.0,\ninner_df\n);\nif(strokeWidth < 0.01) {\ngl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n} else {\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);\n}\nif(u_additive > 0.0) {\ngl_FragColor *= opacity_t;\ngl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n} else {\ngl_FragColor.a *= opacity_t;\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:$G,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:jD.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r){var i=D(n,3),o=i[0],a=i[1],s=i[2],u=TS(0,0,1),c=TS(o,0,s),l=o>=0?zS(u,c):2*Math.PI-zS(u,c),h=2*Math.PI-Math.asin(a/100),f=eS();cS(f,f,l),uS(f,f,h);var p=TS(1,1,0);BS(p,p,f),NS(p,p);var d=TS(-1,1,0);BS(d,d,f),NS(d,d);var v=TS(-1,-1,0);BS(v,v,f),NS(v,v);var g=TS(1,-1,0);BS(g,g,f),NS(g,g);var m=[].concat(F(p),F(d),F(v),F(g)),y=r%4*3;return[m[y],m[y+1],m[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:jD.Attribute,descriptor:{name:"a_Shape",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]),i}(gG),nW=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"raiseCount",0),E(I(e),"raiseRepeat",0),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,o=e.sourceColor,a=e.targetColor,s=e.pickLight,u=void 0!==s&&s,c=e.heightfixed,l=void 0!==c&&c,h=e.opacityLinear,f=void 0===h?{enable:!1,dir:"up"}:h,p=e.lightEnable,d=void 0===p||p,v=0,g=[0,0,0,0],m=[0,0,0,0];if(o&&a&&(g=Lv(o),m=Lv(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(l),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:i,u_linearColor:v,u_sourceColor:g,u_targetColor:m,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:"up"===f.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t,n,r,i,o,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0===n||n,i=t.animateOption.repeat,o=void 0===i?1:i,this.raiseRepeat=o,e.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'precision highp float;\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\nuniform float u_heightfixed: 0.0;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nuniform float u_opacitylinear: 0.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear_dir: 1.0;\nuniform float  u_linearColor: 0.0;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nfloat getYRadian(float x, float z) {\nif(x > 0.0 && z > 0.0) {\nreturn atan(x/z);\n} else if(x > 0.0 && z <= 0.0){\nreturn atan(-z/x) + pi/2.0;\n} else if(x <= 0.0 && z <= 0.0) {\nreturn  pi + atan(x/z);\n} else {\nreturn atan(z/-x) + pi*3.0/2.0;\n}\n}\nfloat getXRadian(float y, float r) {\nreturn atan(y/r);\n}\nvoid main() {\nvec3 size = a_Size * a_Position;\nvec3 offset = size;\nif(u_heightfixed < 1.0) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\noffset = offset * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\noffset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\noffset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n}\n}\nvec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\nvec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\nfloat lightWeight = 1.0;\nif(u_lightEnable > 0.0) {\nlightWeight = calc_lighting(pos);\n}\nv_lightWeight = lightWeight;\nv_color = a_Color;\nif(u_linearColor == 1.0) {\nv_color = mix(u_sourceColor, u_targetColor, a_Position.z);\nv_color.a =  v_color.a * u_opacity;\n} else {\nv_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);\n}\nif(u_opacitylinear > 0.0) {\nv_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * pos;\n} else {\ngl_Position = project_common_position_to_clipspace(pos);\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'varying vec4 v_color;\nvarying float v_lightWeight;\nuniform float u_pickLight: 0.0;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\nif(u_pickLight > 0.0) {\ngl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:JG,cull:{enable:!0,face:Hv(this.mapService.version)},depth:{enable:r}});case 4:return a=e.sent,e.abrupt("return",[a]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:jD.Attribute,descriptor:{name:"a_Pos",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e){var t=h_(e.coordinates);return[t[0],t[1],0]}}})}}]),i}(gG),rW='uniform float u_additive;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius);\nfloat outer_df;\nfloat inner_df;\nouter_df = sdCircle(v_data.xy, 1.0);\ninner_df = sdCircle(v_data.xy, r);\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\nfloat color_t = smoothstep(\nantialiasblur,\n0.0,\ninner_df\n);\nfloat PI = 3.14159;\nfloat N_RINGS = 3.0;\nfloat FREQ = 1.0;\ngl_FragColor = v_color;\nfloat d = length(v_data.xy);\nif(d > 0.5) {\ndiscard;\n}\nfloat intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\nif(u_additive > 0.0) {\ngl_FragColor *= intensity;\ngl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n} else {\ngl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',iW='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\nuniform float u_stroke_width: 2;\nuniform vec3 u_blur_height_fixed: [0, 0, 0];\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_stroke = stroke;  \nvec3 extrude = a_Extrude;\nfloat shape_type = a_Shape;\nfloat newSize = setPickingSize(a_Size);\nv_color = vec4(a_Color.xyz, a_Color.w * opacity);\nif(u_size_unit == 1) {\nnewSize = newSize  * u_PixelsPerMeter.z;\n}\nv_radius = newSize;\nfloat antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\nvec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\nvec3 aPosition = a_Position;\noffset = project_pixel(offset);\nv_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\nvec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\nfloat raisingHeight = u_blur_height_fixed.y;\nif(u_blur_height_fixed.z < 1.0) {\nraisingHeight = project_pixel(u_blur_height_fixed.y);\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nraisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position =  u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',oW=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.strokeOpacity,n=void 0===t?1:t,r=e.strokeWidth,i=void 0===r?0:r,o=e.blend,a=e.blur,s=void 0===a?0:a,u=e.raisingHeight,c=void 0===u?0:u,l=e.heightfixed,h=void 0!==l&&l,f=e.unit,p=void 0===f?"pixel":f;return v({u_blur_height_fixed:[s,Number(c),Number(h)],u_additive:"additive"===o?1:0,u_stroke_opacity:n,u_stroke_width:i,u_size_unit:bG[p]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),_E)}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption,r=void 0===n?{enable:!1}:n,i=this.getShaders(r),o=i.frag,a=i.vert,s=i.type,this.layer.triangulation=_E,e.next=5,this.layer.buildLayerModel({moduleName:s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:_E,depth:{enable:!1}});case 5:return u=e.sent,e.abrupt("return",[u]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(e){if(!e.enable)return{frag:'uniform float u_additive;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nint shape = int(floor(v_data.w + 0.5));\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius + u_stroke_width);\nfloat outer_df;\nfloat inner_df;\nif (shape == 0) {\nouter_df = sdCircle(v_data.xy, 1.0);\ninner_df = sdCircle(v_data.xy, r);\n} else if (shape == 1) {\nouter_df = sdEquilateralTriangle(1.1 * v_data.xy);\ninner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n} else if (shape == 2) {\nouter_df = sdBox(v_data.xy, vec2(1.));\ninner_df = sdBox(v_data.xy, vec2(r));\n} else if (shape == 3) {\nouter_df = sdPentagon(v_data.xy, 0.8);\ninner_df = sdPentagon(v_data.xy, r * 0.8);\n} else if (shape == 4) {\nouter_df = sdHexagon(v_data.xy, 0.8);\ninner_df = sdHexagon(v_data.xy, r * 0.8);\n} else if (shape == 5) {\nouter_df = sdOctogon(v_data.xy, 1.0);\ninner_df = sdOctogon(v_data.xy, r);\n} else if (shape == 6) {\nouter_df = sdHexagram(v_data.xy, 0.52);\ninner_df = sdHexagram(v_data.xy, r * 0.52);\n} else if (shape == 7) {\nouter_df = sdRhombus(v_data.xy, vec2(1.0));\ninner_df = sdRhombus(v_data.xy, vec2(r));\n} else if (shape == 8) {\nouter_df = sdVesica(v_data.xy, 1.1, 0.8);\ninner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n}\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\nfloat color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiasblur,\n0.0,\ninner_df\n);\nif(u_stroke_width < 0.01) {\ngl_FragColor = v_color;\n} else {\ngl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n}\nif(u_additive > 0.0) {\ngl_FragColor *= opacity_t;\ngl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n} else {\ngl_FragColor.a *= opacity_t;\ngl_FragColor = filterColor(gl_FragColor);\n}\nif(gl_FragColor.a < 0.01) {\ndiscard;\n} \n}',vert:iW,type:"pointFill"};switch(e.type){case"wave":default:return{frag:rW,vert:iW,type:"pointWave"}}}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:jD.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:jD.Attribute,descriptor:{name:"a_Shape",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.indexOf(r)]}}})}}]),i}(gG),aW=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"meter2coord",1),E(I(e),"texture",void 0),E(I(e),"isMeter",!1),E(I(e),"radian",0),E(I(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void e.layerService.throttleRenderLayers();e.texture=t({data:e.iconService.getCanvas(),mag:fL.LINEAR,min:fL.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,o=e.rotation,a=e.raisingHeight,s=void 0===a?0:a,u=e.heightfixed,c=void 0!==u&&u,l=e.unit,h=void 0===l?"pixel":l;this.rendererService.getDirty()&&this.texture.bind();var f=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(f=-1),this.radian=void 0!==o?f*Math.PI*o/180:f*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_heightfixed:Number(c),u_size_unit:bG[h],u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),QG)}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\nattribute float a_Rotate;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform mat2 u_RotateMatrix;\nuniform int u_size_unit;\nvarying vec2 v_uv;\nvarying vec2 v_Iconuv;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nv_uv = (a_Extrude.xy + 1.0)/2.0;\nv_uv.y = 1.0 - v_uv.y;\nv_Iconuv = a_Uv;\nhighp float angle_sin = sin(a_Rotate);\nhighp float angle_cos = cos(a_Rotate);\nmat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\nfloat newSize = a_Size;\nif(u_size_unit == 1) {\nnewSize = newSize  * u_PixelsPerMeter.z;\n}\nvec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (newSize) + u_offsets);\nvec3 aPosition = a_Position;\noffset = project_pixel(offset);\nvec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\nfloat raisingHeight = u_raisingHeight;\nif(u_heightfixed < 1.0) {\nraisingHeight = project_pixel(u_raisingHeight);\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nraisingHeight = u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv;\nvarying vec2 v_Iconuv;\nvoid main() {\nvec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\ngl_FragColor = texture2D(u_texture, pos);\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:QG,depth:{enable:!1},cull:{enable:!0,face:Hv(this.mapService.version)}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;this.iconService.off("imageUpdate",this.updateTexture),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:jD.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.rotate,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:jD.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(gG),sW=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void setTimeout((function(){e.layerService.throttleRenderLayers()}));e.texture=t({data:e.iconService.getCanvas(),mag:fL.LINEAR,min:fL.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,o=e.raisingHeight,a=void 0===o?0:o,s=e.heightfixed,u=void 0!==s&&s;return this.rendererService.getDirty()&&this.texture.bind(),{u_raisingHeight:Number(a),u_heightfixed:Number(u),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec2 u_offsets;\nuniform float u_opacity : 1;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nv_uv = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nvec2 offset = project_pixel(u_offsets);\nfloat raisingHeight = u_raisingHeight;\nif(u_heightfixed < 1.0) {\nraisingHeight = project_pixel(u_raisingHeight);\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nraisingHeight = u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n#pragma include "picking"\nvoid main(){\nvec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\nvec4 textureColor;\ntextureColor = texture2D(u_texture, pos);\nfloat fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\nif(fragmengTocenter >= 0.5) {\nfloat luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\ntextureColor.a *= luma;\n}\nif(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\ngl_FragColor= textureColor;\n}else {\ngl_FragColor= step(0.01, textureColor.z) * v_color;\n}\ngl_FragColor.a = gl_FragColor.a * u_opacity;\nif (gl_FragColor.a < 0.01) {\ndiscard;\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:eH,depth:{enable:!1},primitive:fL.POINTS});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}})}}]),i}(gG);function uW(e){var t=e.coordinates;return{vertices:F(t),indices:[0],size:t.length}}var cW=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:IB(t)?t:1}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=uW,e.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform float u_opacity : 1;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n#pragma include "projection"\n#pragma include "project"\nvoid main() {\nv_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\ngl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n}',fragmentShader:"varying vec4 v_color;\nvoid main() {\ngl_FragColor = v_color;\n}",triangulation:uW,depth:{enable:!1},primitive:fL.POINTS,pick:!1});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(gG),lW=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.blend,i=e.speed,o=void 0===i?1:i,a=e.unit;return{u_size_unit:bG[void 0===a?"pixel":a],u_speed:o,u_additive:"additive"===r?1:0,u_opacity:n}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),QG)}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nuniform float u_speed: 1.0;\nuniform float u_time;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nfloat newSize = setPickingSize(a_Size);\nfloat time = u_time * u_speed;\nmat2 rotateMatrix = mat2( \ncos(time), sin(time), \n-sin(time), cos(time)\n);\nv_exteude = rotateMatrix * a_Extrude.xy;\nv_color = a_Color;\nfloat blur = 0.0;\nfloat antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\nif(u_size_unit == 1) {\nnewSize = newSize  * u_PixelsPerMeter.z;\n}\nv_radius = newSize;\nvec2 offset = (extrude.xy * (newSize));\nvec3 aPosition = a_Position;\noffset = project_pixel(offset);\nv_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);\nvec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_additive;\nuniform float u_opacity: 1.0;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius);\nfloat outer_df = sdCircle(v_data.xy, 1.0);\nfloat inner_df = sdCircle(v_data.xy, r);\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\ngl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\nif(u_additive > 0.0) {\ngl_FragColor *= opacity_t;\n} else {\ngl_FragColor.a *= opacity_t;\n}\nif(gl_FragColor.a > 0.0) {\ngl_FragColor = filterColor(gl_FragColor);\n}\nvec2 extrude =  v_exteude;\nvec2 dir = normalize(extrude);\nvec2 baseDir = vec2(1.0, 0.0);\nfloat pi = 3.14159265359;\nfloat flag = sign(dir.y);\nfloat rades = dot(dir, baseDir);\nfloat radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\nif(radar_v > 0.99) {\nradar_v = 1.0 - (radar_v - 0.99)/0.01;\n}\ngl_FragColor.a *= radar_v;\n}',triangulation:QG,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:jD.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(gG);function hW(e){var t=e.coordinates;return{vertices:F(t),indices:[0],size:t.length}}var fW=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,o=e.blend,a=e.strokeOpacity,s=void 0===a?1:a,u=e.strokeWidth,c=void 0===u?0:u,l=e.stroke;return{u_additive:"additive"===o?1:0,u_opacity:n,u_offsets:i,u_stroke_opacity:s,u_stroke_width:c,u_stroke_color:Lv(void 0===l?"#fff":l)}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=hW,e.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\nvarying float v_blur;\nvarying float v_innerRadius;\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\nv_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\nv_blur = 1.0 - max(2.0/a_Size, 0.05);\nv_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\nvec2 offset = project_pixel(u_offsets);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\ngl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_additive;\nuniform float u_stroke_opacity : 1;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_innerRadius;\n#pragma include "picking"\nvoid main() {\nvec2 center = vec2(0.5);\nfloat fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\nfloat circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\nif(v_innerRadius < 0.99) {\nfloat blurWidth = (1.0 - v_blur)/2.0;\nvec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\nif(fragmengTocenter > v_innerRadius + blurWidth) {\ngl_FragColor = stroke;\n} else if(fragmengTocenter > v_innerRadius - blurWidth){\nfloat mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\ngl_FragColor = mix(v_color, stroke, mixR);\n} else {\ngl_FragColor = v_color;\n}\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor = filterColor(gl_FragColor);\nif(u_additive > 0.0) {\ngl_FragColor *= circleClipOpacity;\n} else {\ngl_FragColor.a *= circleClipOpacity;\n}\n}',triangulation:hW,depth:{enable:!1},primitive:fL.POINTS});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(gG),pW=function(){function e(t,n,r){b(this,e),E(this,"boxCells",[]),E(this,"xCellCount",void 0),E(this,"yCellCount",void 0),E(this,"boxKeys",void 0),E(this,"bboxes",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"xScale",void 0),E(this,"yScale",void 0),E(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}return S(e,[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(e,t,n,r,i,o,a,s){var u=a.seenUids,c=this.boxCells[i];if(null!==c){var l,h=this.bboxes,f=U(c);try{for(f.s();!(l=f.n()).done;){var p=l.value;if(!u.box[p]){u.box[p]=!0;var d=4*p;if(e<=h[d+2]&&t<=h[d+3]&&n>=h[d+0]&&r>=h[d+1]&&(!s||s(this.boxKeys[p]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}}catch(e){f.e(e)}finally{f.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(e),c=this.convertToYCellCoord(t),l=this.convertToXCellCoord(n),h=this.convertToYCellCoord(r),f=u;f<=l;f++)for(var p=c;p<=h;p++){var d=this.xCellCount*p+f;if(i.call(this,e,t,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}]),e}(),dW=function(){function e(t,n){b(this,e),E(this,"width",void 0),E(this,"height",void 0),E(this,"grid",void 0),E(this,"viewportPadding",100),E(this,"screenRightBoundary",void 0),E(this,"screenBottomBoundary",void 0),E(this,"gridRightBoundary",void 0),E(this,"gridBottomBoundary",void 0),this.width=t,this.height=n,this.viewportPadding=Math.max(t,n),this.grid=new pW(t+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return S(e,[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(e,t,n){var r=QS(t,n,0,1),i=KS();return $S(i,r,nS.apply(ES,F(e))),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}]),e}();function vW(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function gW(e,t,n,r,i){if(i){var o=e[r],a=o.glyph;if(a)for(var s=t[a].advance*o.scale,u=(e[r].x+s)*i,c=n;c<=r;c++)e[c].x-=u}}function mW(e,t,n,r,i,o,a){var s,u=(t-n)*i,c=(-r*a+.5)*o,l=U(e);try{for(l.s();!(s=l.n()).done;){var h=s.value;h.x+=u,h.y+=c}}catch(e){l.e(e)}finally{l.f()}}function yW(e,t,n,r,i,o,a){var s=0,u=-8,c=0,l=e.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,f=l.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e];n&&(l.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),l.length!==f){var n=s-a;c=Math.max(n,c),gW(l,t,f,l.length-1,h)}s=0,u-=r+5}));var p=vW(i),d=p.horizontalAlign,v=p.verticalAlign;mW(l,h,d,v,c,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*c,e.right=e.left+c}function _W(e,t,n,r,i,o,a){var s=0,u=-8,c=0,l=e.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,f=l.length;n.forEach((function(e){var n=t[e];if(n&&(l.push({glyph:e,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),l.length!==f){var i=s-a;c=Math.max(i,c),gW(l,t,f,l.length-1,h)}s=0,u-=r+5}));var p=vW(i),d=p.horizontalAlign,v=p.verticalAlign;mW(l,h,d,v,c,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*c,e.right=e.left+c}var bW='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n#pragma include "picking"\nvoid main() {\nfloat dist = texture2D(u_sdf_map, v_uv).a;\nlowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\nhighp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\nhighp float gamma_scaled = gamma * v_gamma_scale;\nhighp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\ngl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\ngl_FragColor.a *= alpha;\nif (gl_FragColor.a < 0.01) {\ndiscard;\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',xW='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying float v_fontScale;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_uv = a_tex / u_sdf_map_size;\nv_color = vec4(a_Color.xyz, a_Color.w * opacity);\nv_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\nfloat fontScale = a_Size / FONT_SIZE;\nv_fontScale = fontScale;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nhighp float angle_sin = sin(a_Rotate);\nhighp float angle_cos = cos(a_Rotate);\nmat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\nfloat raiseHeight = u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nraiseHeight = u_raisingHeight * mapboxZoomScale;\n}\nvec4 projected_position;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nprojected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n} else {\nprojected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n}\ngl_Position = vec4(\nprojected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\nv_gamma_scale = gl_Position.w;\nsetPickingColor(a_PickingColor);\n}';function SW(e){var t=e.id,n=[],r=[];if(!this.glyphInfoMap||!this.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var i=this.glyphInfoMap[t].centroid,o=2===i.length?[i[0],i[1],0]:i;return this.glyphInfoMap[t].glyphQuads.forEach((function(e,t){n.push.apply(n,F(o).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],F(o),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],F(o),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],F(o),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),r.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:n,indices:r,size:7}}var EW=function(e){A(a,e);var t,n,r,i,o=O(a);function a(){var e;b(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E(I(e=o.call.apply(o,[this].concat(n))),"glyphInfo",void 0),E(I(e),"glyphInfoMap",{}),E(I(e),"rawEncodeData",void 0),E(I(e),"texture",void 0),E(I(e),"currentZoom",-1),E(I(e),"extent",void 0),E(I(e),"textureHeight",0),E(I(e),"textCount",0),E(I(e),"preTextStyle",{}),E(I(e),"mapping",_(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.initGlyph(),e.updateTexture(),t.next=4,e.reBuildModel();case 4:case"end":return t.stop()}}),t)})))),e}return S(a,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.stroke,n=void 0===t?"#fff":t,r=e.strokeWidth,i=void 0===r?0:r,o=e.halo,a=void 0===o?.5:o,s=e.gamma,u=void 0===s?2:s,c=e.raisingHeight,l=void 0===c?0:c,h=this.getFontServiceMapping(),f=this.getFontServiceCanvas();return h&&Object.keys(h).length!==this.textCount&&f&&(this.updateTexture(),this.textCount=Object.keys(h).length),this.preTextStyle=this.getTextStyle(),v({u_raisingHeight:Number(l),u_stroke_width:i,u_stroke_color:Lv(n),u_sdf_map:this.texture,u_halo_blur:a,u_gamma_scale:u,u_sdf_map_size:[(null==f?void 0:f.width)||1,(null==f?void 0:f.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:(i=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),e.abrupt("return",this.buildModels());case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"buildModels",value:(r=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.textAllowOverlap,r=void 0!==n&&n,this.initGlyph(),this.updateTexture(),r||this.filterGlyphs(),e.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:xW,fragmentShader:bW,inject:this.getInject(),triangulation:SW.bind(this),depth:{enable:!1}});case 6:return i=e.sent,e.abrupt("return",[i]);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"needUpdate",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getTextStyle(),n=t.textAllowOverlap,r=void 0!==n&&n,i=t.textAnchor,o=void 0===i?"center":i,a=t.textOffset,s=t.padding,u=t.fontFamily,c=t.fontWeight,yz(s,this.preTextStyle.padding)&&yz(a,this.preTextStyle.textOffset)&&yz(o,this.preTextStyle.textAnchor)&&yz(u,this.preTextStyle.fontFamily)&&yz(c,this.preTextStyle.fontWeight)){e.next=5;break}return e.next=4,this.mapping();case 4:return e.abrupt("return",!0);case 5:if(!r){e.next=7;break}return e.abrupt("return",!1);case 7:if(l=this.mapService.getZoom(),h=this.mapService.getBounds(),f=o_(this.extent,h),!(Math.abs(this.currentZoom-l)>.5)&&f&&r===this.preTextStyle.textAllowOverlap){e.next=14;break}return e.next=13,this.reBuildModel();case 13:return e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:jD.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.rotate,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:jD.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?12:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:jD.Attribute,descriptor:{name:"a_tex",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){return i_(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t,n=e.shape,r=void 0===n?"":n,o=U(r=r.toString());try{for(o.s();!(t=o.n()).done;){var a=t.value;-1===i.indexOf(a)&&i.push(a)}}catch(e){o.e(e)}finally{o.f()}})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n="".concat(n),-1===i.indexOf(n)&&i.push(n)})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!0})}},{key:"getTextStyle",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=e.textAllowOverlap,a=void 0!==o&&o,s=e.padding,u=void 0===s?[0,0]:s,c=e.textAnchor,l=void 0===c?"center":c,h=e.textOffset,f=void 0===h?[0,0]:h,p=e.opacity,d=void 0===p?1:p,v=e.strokeOpacity,g=void 0===v?1:v,m=e.strokeWidth,y=void 0===m?0:m,_=e.stroke;return{fontWeight:n,fontFamily:i,textAllowOverlap:a,padding:u,textAnchor:l,textOffset:f,opacity:d,strokeOpacity:g,strokeWidth:y,stroke:void 0===_?"#000":_}}},{key:"generateGlyphLayout",value:function(e){var t=this,n=this.getFontServiceMapping(),r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=r.textOffset,c=this.rawEncodeData;this.glyphInfo=c.map((function(r){var i=r.shape,a=void 0===i?"":i,c=r.id,l=r.size,h=void 0===l?1:l,f=r.textOffset?r.textOffset:u||[0,0],p=r.textAnchor?r.textAnchor:s||"center",d=function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=e.split("\n"),c=[],l={positionedGlyphs:c,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:e};return s?_W(l,t,u,n,r,i,o):yW(l,t,u,n,r,i,o),!!c.length&&l}(a.toString(),n,h,p,"left",o,f,e),v=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=void 0===i?[]:i,a=[],s=U(o);try{for(s.s();!(t=s.n()).done;){var u=t.value,c=u.metrics,l=4,h=c.advance*u.scale/2,f=r?[u.x+h,u.y]:[0,0],p=r?[0,0]:[u.x+h+n[0],u.y+n[1]],d=(0-l)*u.scale-h+p[0],v=(0-l)*u.scale+p[1],g=d+c.width*u.scale,m=v+c.height*u.scale,y={x:d,y:v},_={x:g,y:v},b={x:d,y:m},x={x:g,y:m};a.push({tl:y,tr:_,bl:b,br:x,tex:c,glyphOffset:f})}}catch(e){s.e(e)}finally{s.f()}return a}(d,f,!1);return r.shaping=d,r.glyphQuads=v,r.centroid=h_(r.coordinates),r.originCentroid="GAODE2.x"===r.version?h_(r.originCoordinates):r.originCentroid=r.centroid,t.glyphInfoMap[c]={shaping:d,glyphQuads:v,centroid:h_(r.coordinates)},r}))}},{key:"getFontServiceMapping",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getMappingByKey("".concat(i,"_").concat(n))}},{key:"getFontServiceCanvas",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getCanvasByKey("".concat(i,"_").concat(n))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[0,0]:n,i=t.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new dW(a,s);this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,o=void 0===i?0:i,a="GAODE2.x"===t.version?t.originCentroid:t.centroid,s=t.size/16,c=e.mapService.lngLatToContainer(a),l=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:c.x,anchorPointY:c.y}).box;return!(!l||!l.length)&&(u.insertCollisionBox(l,o),!0)})).forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig().iconfont,t=void 0!==e&&e;t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}},{key:"updateTexture",value:function(){var e=this.rendererService.createTexture2D,t=this.getFontServiceCanvas();this.textureHeight=t.height,this.texture&&this.texture.destroy(),this.texture=e({data:t,mag:fL.LINEAR,min:fL.LINEAR,width:t.width,height:t.height})}},{key:"reBuildModel",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.filterGlyphs(),e.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:xW,fragmentShader:bW,triangulation:SW.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:t=e.sent,this.layer.models=[t];case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(gG),AW={fillImage:aW,fill:oW,radar:lW,image:sW,normal:cW,simplePoint:fW,extrude:nW,text:EW,earthFill:tW,earthExtrude:eW},wW=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"type","PointLayer"),E(I(e),"enableShaderEncodeStyles",["opacity","offsets","stroke"]),E(I(e),"enableDataEncodeStyles",["textOffset","textAnchor"]),E(I(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),e}return S(i,[{key:"buildModels",value:(n=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new AW[t](this),e.next=5,this.initLayerModels();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"rebuildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,t=e.field,n=e.values,r=this.getLayerConfig().shape2d,i=this.iconService.getIconMap();if(t&&-1!==(null==r?void 0:r.indexOf(t)))return"fill";if("text"===n)return"text";if(n&&n instanceof Array){var o,a=U(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;if("string"==typeof s&&i.hasOwnProperty(s))return"image"}}catch(e){a.e(e)}finally{a.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":"simple"===a?"simplePoint":"radar"===a?"radar":"fillImage"===this.layerType?"fillImage":-1!==(null==n?void 0:n.indexOf(a))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null==r?void 0:r.indexOf(a))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":i.hasOwnProperty(a)?"image":"text"}return this.getModelTypeWillEmptyData()}}]),i}(dG),TW=function(e){A(o,e);var t,n,r,i=O(o);function o(){var e;b(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E(I(e=i.call.apply(i,[this].concat(n))),"texture",void 0),e}return S(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.heightfixed,n=void 0!==t&&t,r=e.raisingHeight,i=void 0===r?0:r,o=e.topsurface,a=void 0===o||o,s=e.sidesurface,u=void 0===s||s,c=e.sourceColor,l=e.targetColor,h=0,f=[1,1,1,1],p=[1,1,1,1];return c&&l&&(f=Lv(c),p=Lv(l),h=1),v({u_topsurface:Number(a),u_sidesurface:Number(u),u_heightfixed:Number(n),u_raisingHeight:Number(i),u_linearColor:h,u_sourceColor:f,u_targetColor:p,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:(r=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadTexture();case 2:return e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=_(g().mark((function e(){var t,n,r,i,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:cH});case 3:return o=e.sent,e.abrupt("return",[o]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.pickLight;return e.mapTexture?{frag:'uniform sampler2D u_texture;\nuniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n#pragma include "picking"\nvoid main() {\nfloat opacity = u_opacity;\nfloat isSide = v_texture_data.x;\nfloat lightWeight = v_texture_data.y;\nfloat topU = v_uvs[0];\nfloat topV = 1.0 - v_uvs[1];\nfloat sidey = v_uvs[2];\nif(isSide < 0.999) {\nif(u_sidesurface < 1.0) {\ndiscard;\n}\nif(u_linearColor == 1.0) {\nvec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\nlinearColor.rgb *= lightWeight;\ngl_FragColor = linearColor;\n} else {\ngl_FragColor = v_Color;\n}\n} else {\nif(u_topsurface < 1.0) {\ndiscard;\n}\ngl_FragColor = texture2D(u_texture, vec2(topU, topV));\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform sampler2D u_texture;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_linearColor: 0.0;\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nfloat lightWeight = calc_lighting(pos);\nvec4 project_pos = project_position(pos);\nv_uvs = a_uvs;\nv_texture_data = vec2(a_Position.z, lightWeight);\nif(u_heightfixed > 0.0) {\nproject_pos.z = a_Position.z * a_Size;\nproject_pos.z += u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nproject_pos.z *= mapboxZoomScale;\nproject_pos.z += u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"polygonExtrudeTexture"}:t?{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n#pragma include "picking"\nvoid main() {\nfloat opacity = u_opacity;\nfloat isSide =  v_texture_data.x;\nfloat sidey = v_uvs[2];\nfloat lightWeight = v_texture_data.y;\nif(isSide < 0.999) {\nif(u_sidesurface < 1.0) {\ndiscard;\n}\nif( u_linearColor == 1.0) {\nvec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\nlinearColor.rgb *= lightWeight;\ngl_FragColor = linearColor;\n} else {\ngl_FragColor = v_Color;\n}\n} else {\nif(u_topsurface < 1.0) {\ndiscard;\n}\ngl_FragColor = v_Color;\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n}',vert:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_heightfixed: 0.0;\nuniform float u_raisingHeight: 0.0;\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\nvarying vec4 v_Color;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nv_uvs = a_uvs;\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nif(u_heightfixed > 0.0) {\nproject_pos.z = a_Position.z * a_Size;\nproject_pos.z += u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nproject_pos.z *= mapboxZoomScale;\nproject_pos.z += u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nv_texture_data = vec2(a_Position.z,lightWeight);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nsetPickingColor(a_PickingColor);\n}',type:"polygonExtrudePickLight"}:{frag:'uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\n#pragma include "picking"\nvoid main() {\nif(u_topsurface < 1.0) {\ndiscard;\n}\ngl_FragColor = v_Color;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0;\nuniform float u_raisingHeight: 0.0;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nfloat isSide = a_Position.z;\nfloat topU = a_uvs[0];\nfloat topV = 1.0 - a_uvs[1];\nfloat sidey = a_uvs[2];\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nfloat lightWeight = calc_lighting(pos);\nvec4 project_pos = project_position(pos);\nif(u_heightfixed > 0.0) {\nproject_pos.z = a_Position.z * a_Size;\nproject_pos.z += u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nproject_pos.z *= mapboxZoomScale;\nproject_pos.z += u_raisingHeight * mapboxZoomScale;\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nif(isSide < 0.999) {\nif(u_linearColor == 1.0) {\nvec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\nlinearColor.rgb *= lightWeight;\nv_Color = linearColor;\n} else {\nv_Color = a_Color;\n}\n} else {\nv_Color = a_Color;\n}\nv_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\nsetPickingColor(a_PickingColor);\n}',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=e,n=this.layer.coordCenter||this.layer.getSource().center,r=t[2]-t[0],i=t[3]-t[1];if("GAODE2.x"===this.mapService.version){var o=D(this.mapService.coordToAMap2RelativeCoordinates([e[0],e[1]],n),2),a=o[0],s=o[1],u=D(this.mapService.coordToAMap2RelativeCoordinates([e[2],e[3]],n),2),c=u[0],l=u[1];r=c-a,i=l-s,t=[a,s,c,l]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:jD.Attribute,descriptor:{name:"a_uvs",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,n,o){var a=o[0],s=o[1];return[(a-t[0])/r,(s-t[1])/i,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:(t=_(g().mark((function e(){var t,n,r,i=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer.getLayerConfig(),n=t.mapTexture,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),!n){e.next=5;break}return e.abrupt("return",new Promise((function(e,t){var o=new Image;o.crossOrigin="anonymous",o.src=n,o.onload=function(){return i.texture=r({data:o,width:o.width,height:o.height,wrapS:fL.CLAMP_TO_EDGE,wrapT:fL.CLAMP_TO_EDGE,min:fL.LINEAR,mag:fL.LINEAR}),e(null)},o.onerror=function(){t(new Error("image load error"))}})));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),o}(gG),CW=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.raisingHeight,n=void 0===t?0:t,r=e.opacityLinear,i=void 0===r?{enable:!1,dir:"in"}:r;return v({u_raisingHeight:Number(n),u_opacitylinear:Number(i.enable),u_dir:"in"===i.dir?1:0},this.getStyleAttribute())}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelParams(),n=t.frag,r=t.vert,i=t.triangulation,o=t.type,a=this.layer.getLayerConfig(),s=a.workerEnabled,u=void 0!==s&&s,c=a.enablePicking,this.layer.triangulation=i,e.next=5,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:i,primitive:fL.TRIANGLES,depth:{enable:!1},workerEnabled:u,workerOptions:{modelType:o,enablePicking:c}});case 5:return l=e.sent,e.abrupt("return",[l]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().opacityLinear;(void 0===e?{enable:!1,dir:"in"}:e).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:jD.Attribute,descriptor:{name:"a_linear",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var e=this.layer.getLayerConfig().opacityLinear;return(void 0===e?{enable:!1}:e).enable?{frag:'#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvarying vec4 v_Color;\nvoid main() {\ngl_FragColor = v_Color;\nif(u_opacitylinear > 0.0) {\ngl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\nvarying vec4 v_Color;\n#pragma include "projection"\n#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvoid main() {\nif(u_opacitylinear > 0.0) {\nv_linear = a_linear;\nv_pos = a_Position.xy;\n}\nv_Color = vec4(a_Color.xyz, a_Color.w * opacity);\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nproject_pos.z += u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nproject_pos.z *= mapboxZoomScale;\nproject_pos.z += u_raisingHeight * mapboxZoomScale;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"polygonLinear",triangulation:sH}:{frag:'varying vec4 v_color;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\nvarying vec4 v_color;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_color = vec4(a_Color.xyz, a_Color.w * opacity);\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nproject_pos.z += u_raisingHeight;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nfloat mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\nproject_pos.z *= mapboxZoomScale;\nproject_pos.z += u_raisingHeight * mapboxZoomScale;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"polygonFill",triangulation:bE}}}]),i}(gG),kW=function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture1",void 0),E(I(e),"texture2",void 0),E(I(e),"texture3",void 0),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.watercolor,i=void 0===r?"#6D99A8":r,o=e.watercolor2,a=void 0===o?"#0F121C":o;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Lv(i),u_watercolor2:Lv(a),u_opacity:IB(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'attribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec2 v_uv;\n#pragma include "projection"\nvoid main() {\nv_uv = a_uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n}',fragmentShader:"uniform float u_time: 0.0;\nuniform float u_opacity: 1.0;\nvarying vec2 v_uv;\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750;\nfloat large_wavesize        = 3.4;\nfloat small_waveheight      = 0.6;\nfloat small_wavesize        = 0.5;\nfloat water_softlight_fact  = 15.;\nfloat water_glossylight_fact= 120.;\nfloat particle_amount       = 70.;\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8)\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\nfloat hash( float n ) {\nreturn fract(sin(n)*43758.5453123);\n}\nfloat noise1( in vec2 x ) {\nvec2 p  = floor(x);\nvec2 f  = smoothstep(0.0, 1.0, fract(x));\nfloat n = p.x + p.y*57.0;\nreturn mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\nmix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\nfloat noise(vec2 p) {\nreturn texture2D(u_texture2,p*vec2(1./256.)).x;\n}\nvec4 highness(vec2 p) {\nvec4 t = texture2D(u_texture1,fract(p));\nfloat clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\nreturn clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\nfloat height_map( vec2 p ) {\nvec4 height=highness(p);\nmat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\nfloat f = 0.6000*noise1( p ); p = m*p*1.1*6.;\nf += 0.2500*noise( p ); p = m*p*1.32;\nf += 0.1666*noise( p ); p = m*p*1.11;\nf += 0.0834*noise( p ); p = m*p*1.12;\nf += 0.0634*noise( p ); p = m*p*1.13;\nf += 0.0444*noise( p ); p = m*p*1.14;\nf += 0.0274*noise( p ); p = m*p*1.15;\nf += 0.0134*noise( p ); p = m*p*1.16;\nf += 0.0104*noise( p ); p = m*p*1.17;\nf += 0.0084*noise( p );\nf = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\nconst float FLAT_LEVEL = 0.92525;\nif (f<FLAT_LEVEL)\nf = f;\nelse\nf = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL;\nreturn clamp(f, 0., 10.);\n}\nvec3 plasma_quintic( float x ) {\nx = clamp( x, 0.0, 1.0);\nvec4 x1 = vec4( 1.0, x, x * x, x * x * x );\nvec4 x2 = x1 * x1.w * x;\nreturn vec3(\ndot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\ndot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\ndot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\nvec4 color(vec2 p){\nvec4 c1 = vec4(1.7,1.6,.9,1);\nvec4 c2 = vec4(.2,.94,.1,1);\nvec4 c3 = vec4(.3,.2,.0,1);\nvec4 c4 = vec4(.99,.99,1.6,1);\nvec4 v = highness(p);\nfloat los = smoothstep(0.1,1.1,v.b);\nfloat his = smoothstep(3.5,6.5,v.b);\nfloat ces = smoothstep(1.,5.,v.a);\nvec4 lo = mix(c1,c2,los);\nvec4 hi = mix(c3,c4,his);\nvec4 ce = mix(lo,hi,ces);\nreturn vec4(plasma_quintic(ces),1).ragb;\n}\nvec3 terrain_map( vec2 p )\n{\nreturn color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5;\n}\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\nfloat water_map( vec2 p, float height ) {\nvec2 p2 = p*large_wavesize;\nvec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\nvec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\nfloat f = 0.6000*noise( p );\nf += 0.2500*noise( p*m );\nf += 0.1666*noise( p*m*m );\nfloat wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\np *= small_wavesize;\nf = 0.;\nfloat amp = 1.0, s = .5;\nfor (int i=0; i<9; i++)\n{ p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\nreturn wave+f*small_waveheight;\n}\nfloat nautic(vec2 p) {\np *= 18.;\nfloat f = 0.;\nfloat amp = 1.0, s = .5;\nfor (int i=0; i<3; i++)\n{ p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\nreturn pow(1.-f, 5.);\n}\nfloat particles(vec2 p) {\np *= 200.;\nfloat f = 0.;\nfloat amp = 1.0, s = 1.5;\nfor (int i=0; i<3; i++)\n{ p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\nreturn pow(f*.35, 7.)*particle_amount;\n}\nfloat test_shadow( vec2 xy, float height) {\nvec3 r0 = vec3(xy, height);\nvec3 rd = normalize( light - r0 );\nfloat hit = 1.0;\nfloat t   = 0.001;\nfor (int j=1; j<25; j++)\n{\nvec3 p = r0 + t*rd;\nfloat h = height_map( p.xy );\nfloat height_diff = p.z - h;\nif (height_diff<0.0)\n{\nreturn 0.0;\n}\nt += 0.01+height_diff*.02;\nhit = min(hit, 2.*height_diff/t);\n}\nreturn hit;\n}\nvec3 CalcTerrain(vec2 uv, float height) {\nvec3 col = terrain_map( uv );\nvec2 iResolution = vec2(512.);\nfloat h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\nfloat h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\nfloat h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\nfloat h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\nvec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\nvec3 r0 = vec3(uv, height);\nvec3 rd = normalize( light - r0 );\nfloat grad = dot(norm, rd);\ncol *= grad+pow(grad, 8.);\nfloat terrainshade = test_shadow( uv, height );\ncol = mix(col*.25, col, terrainshade);\nreturn col;\n}\nvoid main() {\nvec3 watercolor = u_watercolor.rgb;\nvec3 watercolor2 = u_watercolor2.rgb;\nvec2 uv = v_uv;\nfloat WATER_LEVEL = 0.84;\nfloat deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\nfloat height = height_map( uv );\nvec3 col;\nfloat waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\nfloat level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\nif (height > level)\n{\ncol = CalcTerrain(uv, height);\n}\nif (height <= level)\n{\nvec2 dif = vec2(.0, .01);\nvec2 pos = uv*15. + vec2(u_time*.01);\nfloat h1 = water_map(pos-dif,waveheight);\nfloat h2 = water_map(pos+dif,waveheight);\nfloat h3 = water_map(pos-dif.yx,waveheight);\nfloat h4 = water_map(pos+dif.yx,waveheight);\nvec3 normwater = normalize(vec3(h3-h4, h1-h2, .125));\nuv += normwater.xy*.002*(level-height);\ncol = CalcTerrain(uv, height);\nfloat coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\nfloat coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\nfloat intensity = col.r*.2126+col.g*.7152+col.b*.0722;\nwatercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\nvec3 r0 = vec3(uv, WATER_LEVEL);\nvec3 rd = normalize( light - r0 );\nfloat grad     = dot(normwater, rd);\nfloat specular = pow(grad, water_softlight_fact);\nfloat specular2= pow(grad, water_glossylight_fact);\nfloat gradpos  = dot(vec3(0., 0., 1.), rd);\nfloat specular1= smoothstep(0., 1., pow(gradpos, 5.));\nfloat watershade  = test_shadow( uv, level );\nwatercolor *= 2.2+watershade;\nwatercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\nwatercolor /= (1.+specular1*1.25);\nwatercolor += watershade*specular2*water_specularcolor;\nwatercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\ncol = mix(col, watercolor, coastfade);\n}\nfloat opacity = u_opacity;\ngl_FragColor = vec4(col, opacity);  \n}",triangulation:aH,primitive:fL.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t,n;null===(e=this.texture1)||void 0===e||e.destroy(),null===(t=this.texture2)||void 0===t||t.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=D(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3],o=r-t,a=i-n;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:jD.Attribute,descriptor:{name:"a_uv",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,r,i,s){var u=D(e.version===Sz["GAODE2.x"]?e.originCoordinates[0][s]:i,2),c=u[0],l=u[1];return[(c-t)/o,(l-n)/a]}}})}},{key:"loadTexture",value:function(){var e,t,n,r=this,i=this.rendererService.createTexture2D,o={height:0,width:0};function a(e){return i({data:e,width:e.width,height:e.height,wrapS:fL.MIRRORED_REPEAT,wrapT:fL.MIRRORED_REPEAT,min:fL.LINEAR,mag:fL.LINEAR})}this.texture1=i(o),this.texture2=i(o),this.texture3=i(o),e=function(e){r.texture1=a(e[0]),r.texture2=a(e[1]),r.texture3=a(e[2]),r.layerService.reRender()},t=0,n=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){3==++t&&e(n)}}))}}]),i}(gG),MW={fill:CW,line:ZH,extrude:TW,text:EW,point_fill:oW,point_image:sW,point_normal:cW,point_extrude:nW,water:function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.speed,i=void 0===r?.5:r;return{u_texture:this.texture,u_speed:i,u_opacity:IB(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\n#pragma include "projection"\nvoid main() {\nv_uv = a_uv;\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n}',fragmentShader:"uniform sampler2D u_texture;\nuniform float u_time: 0.0;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\nfloat water(vec3 p) {\nfloat t = u_time * u_speed;\np.z += t * 2.; p.x += t * 2.;\nvec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\np.z += t * 3.; p.x += t * 0.52;\nvec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\np.z += t * 4.; p.x += t * 0.8;\nvec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\nc1 += c2 - c3;\nfloat z = (c1.x + c1.y + c1.z) / 3.;\nreturn p.y + z / 4.;\n}\nfloat map(vec3 p) {\nfloat d = 100.0;\nd = water(p);\nreturn d;\n}\nfloat intersect(vec3 ro, vec3 rd) {\nfloat d = 0.0;\nfor (int i = 0; i <= 100; i++) {\nfloat h = map(ro + rd * d);\nif (h < 0.1) return  d;\nd += h;\n}\nreturn 0.0;\n}\nvec3 norm(vec3 p) {\nfloat eps = .1;\nreturn normalize(vec3(\nmap(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\nmap(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\nmap(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n));\n} \nfloat calSpc() {\nvec3 l1 = normalize(vec3(1, 1, 1));\nvec3 ro = vec3(-3, 20, -8);\nvec3 rc = vec3(0, 0, 0);\nvec3 ww = normalize(rc - ro);\nvec3 uu = normalize(cross(vec3(0,1,0), ww));\nvec3 vv = normalize(cross(rc - ro, uu));\nvec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\nfloat d = intersect(ro, rd);\nvec3 p = ro + rd * d;\nvec3 n = norm(p);\nfloat spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\nreturn spc;\n}\nvoid main() {\nfloat opacity = u_opacity;\ngl_FragColor = v_Color;\ngl_FragColor.a *= opacity;\nfloat spc = calSpc();\ngl_FragColor += spc * 0.4;\n}",triangulation:aH,primitive:fL.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=D(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3],o=r-t,a=i-n;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:jD.Attribute,descriptor:{name:"a_uv",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,r,i,s){var u=D(e.version===Sz["GAODE2.x"]?e.originCoordinates[0][s]:i,2),c=u[0],l=u[1];return[(c-t)/o,(l-n)/a]}}})}},{key:"loadTexture",value:function(){var e=this,t=this.layer.getLayerConfig().waterTexture,n=this.rendererService.createTexture2D;this.texture=n({height:0,width:0});var r=new Image;r.crossOrigin="",t?(console.warn("L7 recommendï¼https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=t):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:fL.MIRRORED_REPEAT,wrapT:fL.MIRRORED_REPEAT,min:fL.LINEAR,mag:fL.LINEAR}),e.layerService.reRender()}}}]),i}(gG),ocean:kW},PW=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","PolygonLayer"),E(I(e),"enableShaderEncodeStyles",["opacity"]),E(I(e),"defaultSourceConfig",void 0),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new MW[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"!==n&&n?"extrude"===n?"extrude":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType():"fill"}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),r}(dG),IW='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',LW=function(e){A(o,e);var t,n,r,i=O(o);function o(){var e;b(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E(I(e=i.call.apply(i,[this].concat(n))),"texture",void 0),E(I(e),"colorTexture",void 0),e}return S(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,o=e.clampHigh,a=void 0===o||o,s=e.noDataValue,u=void 0===s?-9999999:s,c=e.domain,l=e.rampColors,h=c||jv(l);return this.colorTexture=this.layer.textureService.getColorTexture(l,h),{u_opacity:n||1,u_texture:this.texture,u_domain:h,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:(r=_(g().mark((function e(t){var n,r,i,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return e.abrupt("return",{data:t.data,width:t.width,height:t.height});case 4:return e.next=6,t.data;case 6:return n=e.sent,r=n.rasterData,i=n.width,o=n.height,e.abrupt("return",{data:Array.from(r),width:i,height:o});case 11:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=5,this.getRasterData(r);case 5:return i=e.sent,o=i.data,a=i.width,s=i.height,this.texture=n({data:o,width:a,height:s,format:fL.LUMINANCE,type:fL.FLOAT}),e.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:IW,fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\nvoid main() {\nfloat value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\nif (value == u_noDataValue || isnan_emu(value))\ndiscard;\nelse if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\ndiscard;\nelse {\nfloat normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\nvec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\ngl_FragColor = color;\ngl_FragColor.a =  gl_FragColor.a * u_opacity ;\nif(gl_FragColor.a < 0.01)\ndiscard;\n}\n}",triangulation:hH,primitive:fL.TRIANGLES,depth:{enable:!1}});case 12:return u=e.sent,e.abrupt("return",[u]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(gG),OW=["data"],RW=["rasterData"],NW={raster:LW,rasterRgb:function(e){A(o,e);var t,n,r,i=O(o);function o(){var e;b(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E(I(e=i.call.apply(i,[this].concat(n))),"texture",void 0),E(I(e),"dataOption",{}),e}return S(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.noDataValue,i=void 0===r?0:r,o=this.dataOption,a=o.rMinMax,s=o.gMinMax,u=o.bMinMax;return{u_opacity:n||1,u_texture:this.texture,u_noDataValue:i,u_rminmax:a,u_gminmax:s,u_bminmax:u}}},{key:"getRasterData",value:(r=_(g().mark((function e(t){var n,r,i,o,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return n=t.data,r=P(t,OW),this.dataOption=r,e.abrupt("return",v({data:n},r));case 4:return e.next=6,t.data;case 6:if(i=e.sent,o=i.rasterData,a=P(i,RW),this.dataOption=a,!Array.isArray(o)){e.next=14;break}return e.abrupt("return",v({data:o},a));case 14:return e.abrupt("return",v({data:Array.from(o)},a));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=5,this.getRasterData(r);case 5:return i=e.sent,o=i.data,a=i.width,s=i.height,this.texture=n({data:o,width:a,height:s,format:fL.RGB,type:fL.FLOAT}),e.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:IW,fragmentShader:"precision mediump float;\nuniform vec2 u_rminmax: vec2(0,255); \nuniform vec2 u_gminmax: vec2(0,255);\nuniform vec2 u_bminmax: vec2(0,255);\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform float u_noDataValue : 0.0;\nvarying vec2 v_texCoord;\nvoid main() {\nvec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;\nif(rgb == vec3(u_noDataValue)) {\ngl_FragColor = vec4(0.0, 0, 0, 0.0);\n} else {\ngl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n}\nif(gl_FragColor.a < 0.01)\ndiscard;\n}",triangulation:hH,primitive:fL.TRIANGLES,depth:{enable:!1}});case 12:return u=e.sent,e.abrupt("return",[u]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(gG),raster3d:LW,rasterTerrainRgb:function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.clampLow,r=void 0===n||n,i=e.clampHigh,o=void 0===i||i,a=e.noDataValue,s=void 0===a?-9999999:a,u=e.domain,c=e.rampColors,l=e.colorTexture,h=e.rScaler,f=void 0===h?6553.6:h,p=e.gScaler,d=void 0===p?25.6:p,v=e.bScaler,g=void 0===v?.1:v,m=e.offset,y=void 0===m?1e4:m,_=u||jv(c),b=l;return l?this.layer.textureService.setColorTexture(l,c,_):b=this.layer.textureService.getColorTexture(c,_),{u_opacity:t||1,u_texture:this.texture,u_domain:_,u_clampLow:r,u_clampHigh:void 0!==o?o:r,u_noDataValue:s,u_unpack:[f,d,g,y],u_colorTexture:b}}},{key:"initModels",value:(n=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,e.next=4,t.data.images;case 4:return r=e.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:fL.LINEAR,mag:fL.LINEAR}),e.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_texCoord;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nuniform vec4 u_unpack;\nfloat getElevation(vec2 coord, float bias) {\nvec4 data = texture2D(u_texture, coord,bias) * 255.0;\ndata.a = -1.0;\nreturn dot(data, u_unpack);\n}\nvec4 getColor(float value) {\nfloat normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\nvec2 coord = vec2(normalisedValue, 0);\nreturn texture2D(u_colorTexture, coord);\n}\nvoid main() {\nfloat value = getElevation(v_texCoord,0.0);\nif (value == u_noDataValue) {\ngl_FragColor = vec4(0.0, 0, 0, 0.0);\n} else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {\ngl_FragColor = vec4(0.0, 0, 0, 0.0);\n} else {\ngl_FragColor = getColor(value);\ngl_FragColor.a =  gl_FragColor.a * u_opacity ;\nif(gl_FragColor.a < 0.01)\ndiscard;\n}\n}",triangulation:hH,primitive:fL.TRIANGLES,depth:{enable:!1}});case 8:return i=e.sent,e.abrupt("return",[i]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(gG)},DW=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","RasterLayer"),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new NW[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.getParserType()){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),r}(dG),FW=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","TileDebugLayer"),E(I(e),"zIndex",1e4),E(I(e),"defaultSourceConfig",{data:[],options:{parser:{type:"testTile"}}}),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),r}(dG),BW=function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:IB(t)?t:1}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-997,e.next=3,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nvarying float v_CamreaDistance;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvarying float v_offset;\nvoid main() {\nfloat EARTH_RADIUS = 100.0;\nv_Color = a_Color;\nv_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\nvVertexNormal = a_Normal;\ngl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}",fragmentShader:"uniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\nvarying float v_offset;\nvarying vec4 v_Color;\nvoid main() {\nfloat intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\nif(intensity > 1.0) intensity = 0.0;\ngl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}",triangulation:vH,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(gG),zW={base:function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"earthTime",3.4),E(I(e),"sunX",1e3),E(I(e),"sunY",1e3),E(I(e),"sunZ",1e3),E(I(e),"sunRadius",Math.sqrt(e.sunX*e.sunX+e.sunY*e.sunY+e.sunZ*e.sunZ)),e}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=e.globalOptions;return null!=t&&t.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(e){this.earthTime=e,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:(n=_(g().mark((function e(){var t,n,r,i,o=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),void 0!==(null==(n=t.globalOptions)?void 0:n.earthTime)&&this.setEarthTime(n.earthTime),r=this.layer.getSource(),i=this.rendererService.createTexture2D,this.texture=i({height:0,width:0}),r.data.images.then((function(e){o.texture=i({data:e[0],width:e[0].width,height:e[0].height}),o.layerService.reRender()})),e.abrupt("return",this.buildModels());case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-998,e.next=3,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform float u_ambientRatio : 0.5;\nuniform float u_diffuseRatio : 0.3;\nuniform float u_specularRatio : 0.2;\nuniform vec3 u_sunLight: [1.0, -10.5, 12.0];\nfloat calc_lighting(vec4 pos) {\nvec3 worldPos = vec3(pos * u_ModelMatrix);\nvec3 worldNormal = a_Normal;\nvec3 viewDir = normalize(u_CameraPosition - worldPos);\nvec3 lightDir = normalize(u_sunLight);\nvec3 halfDir = normalize(viewDir+lightDir);\nfloat lambert = dot(worldNormal, lightDir);\nfloat specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\nfloat lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\nreturn lightWeight;\n}\nvarying float v_lightWeight;\nvoid main() {\nv_texCoord = a_Uv;\nfloat lightWeight = calc_lighting(vec4(a_Position, 1.0));\nv_lightWeight = lightWeight;\ngl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}",fragmentShader:"uniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvarying float v_lightWeight;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ncolor.xyz = color.xyz * v_lightWeight;\ngl_FragColor = color;\n}",triangulation:vH,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(gG),atomSphere:BW,bloomSphere:function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:IB(t)?t:1}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-999,e.next=3,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvoid main() {\nv_Color = a_Color;\nvVertexNormal = a_Normal;\ngl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}",fragmentShader:"uniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvoid main() {\nfloat intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\nif(intensity > 1.0) intensity = 0.0;\ngl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}",triangulation:gH,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jD.Attribute,descriptor:{name:"a_Size",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jD.Attribute,descriptor:{name:"a_Normal",buffer:{usage:fL.STATIC_DRAW,data:[],type:fL.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(gG)},UW=["base","atomSphere","bloomSphere"],jW=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","EarthLayer"),E(I(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new zW[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setEarthTime",value:function(e){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(e):console.warn("è¯·å¨ scene loaded ä¹åæ§è¡è¯¥æ¹æ³ï¼")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"base";return UW.indexOf(n)<0&&(n="base"),n}}]),r}(dG),VW={fill:function(e){A(i,e);var t,n,r=O(i);function i(){return b(this,i),r.apply(this,arguments)}return S(i,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.color,i=void 0===r?"#000":r;return{u_opacity:IB(n)?n:0,u_color:Lv(i)}}},{key:"initModels",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#pragma include "projection"\nvoid main() {\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n}',fragmentShader:"uniform float u_opacity : 1.0;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor = u_color;\ngl_FragColor.a *= u_opacity;\n}",triangulation:aH,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),i}(gG)},GW=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","MaskLayer"),E(I(e),"defaultSourceConfig",void 0),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new VW[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){return"fill"}}]),r}(dG);function HW(e,t,n){var r=WW(e,e.VERTEX_SHADER,t),i=WW(e,e.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=e.createProgram();if(!o)return null;if(e.attachShader(o,r),e.attachShader(o,i),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){var a=e.getProgramInfoLog(o);return console.warn("Failed to link program: "+a),e.deleteProgram(o),e.deleteShader(i),e.deleteShader(r),null}for(var s=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var c=e.getActiveAttrib(o,u);o[c.name]=e.getAttribLocation(o,c.name)}for(var l=e.getProgramParameter(o,e.ACTIVE_UNIFORMS),h=0;h<l;h++){var f=e.getActiveUniform(o,h);o[f.name]=e.getUniformLocation(o,f.name)}return o.vertexShader=r,o.fragmentShader=i,o}function WW(e,t,n){var r=e.createShader(t);if(null==r)return console.warn("unable to create shader"),null;if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(r);return console.warn("Failed to compile shader: "+i),e.deleteShader(r),null}return r}function YW(e,t,n,r,i){var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),o}function XW(e,t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t)}function ZW(e,t){var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),n}function qW(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];r.addColorStop(+a,e[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),t=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function KW(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r,e.FLOAT,!1,0,0)}function QW(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,t),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}var $W,JW,eY,tY,nY,rY,iY,oY,aY=function(){function e(t){b(this,e),E(this,"width",512),E(this,"height",512),E(this,"pixels",void 0),E(this,"fadeOpacity",void 0),E(this,"speedFactor",void 0),E(this,"dropRate",void 0),E(this,"dropRateBump",void 0),E(this,"gl",void 0),E(this,"drawProgram",void 0),E(this,"fullScreenProgram",void 0),E(this,"updateProgram",void 0),E(this,"rampColors",void 0),E(this,"numParticles",65536),E(this,"numParticlesSize",void 0),E(this,"particleStateResolution",void 0),E(this,"quadBuffer",void 0),E(this,"particleIndexBuffer",void 0),E(this,"framebuffer",void 0),E(this,"colorRampTexture",void 0),E(this,"backgroundTexture",void 0),E(this,"screenTexture",void 0),E(this,"particleStateTexture0",void 0),E(this,"particleStateTexture1",void 0),E(this,"windTexture",void 0),E(this,"windData",void 0),this.gl=t.glContext,this.width=t.imageWidth,this.height=t.imageHeight,this.fadeOpacity=t.fadeOpacity,this.speedFactor=t.speedFactor,this.dropRate=t.dropRate,this.dropRateBump=t.dropRateBump,this.rampColors=t.rampColors,this.init()}return S(e,[{key:"init",value:function(){var e=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=HW(e,"\n precision mediump float;\n\n attribute float a_index;\n\n uniform sampler2D u_particles;\n uniform float u_particles_res;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n\n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n\n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // color ramp is encoded in a 16x16 texture\n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=HW(e,"\n     precision mediump float;\n\n     attribute vec2 a_pos;\n\n     varying vec2 v_tex_pos;\n\n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n\n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n\n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=HW(e,"\n precision mediump float;\n\n attribute vec2 a_pos;\n\n varying vec2 v_tex_pos;\n\n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer å§ç»ç¨éºæ»¡å±å¹ç texture\n }","\n precision highp float;\n\n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n\n varying vec2 v_tex_pos;\n\n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n\n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n\n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n\n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n\n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n\n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=ZW(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=e.createFramebuffer(),this.colorRampTexture=YW(this.gl,this.gl.LINEAR,qW(this.rampColors),16,16);var t=new Uint8Array(this.width*this.height*4);this.backgroundTexture=YW(e,e.NEAREST,t,this.width,this.height),this.screenTexture=YW(e,e.NEAREST,t,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=YW(e,e.NEAREST,r,n,n),this.particleStateTexture1=YW(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=ZW(e,o)}},{key:"setWind",value:function(e){this.windData=e,this.windTexture=function(e,t,n){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),r}(this.gl,this.gl.LINEAR,e.image)}},{key:"updateParticelNum",value:function(e){var t=this.gl;if(e!==this.numParticles){this.numParticles=e;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=YW(t,t.NEAREST,r,n,n),this.particleStateTexture1=YW(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=ZW(t,o)}}},{key:"updateWindDir",value:function(e,t,n,r){this.windData.uMin=e,this.windData.uMax=t,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(e){if(this.isColorChanged(e)){this.rampColors=e;var t=this.gl;t.deleteTexture(this.colorRampTexture),this.colorRampTexture=YW(t,t.LINEAR,qW(e),16,16)}}},{key:"isColorChanged",value:function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=Number(r);if(!this.rampColors[i])return!0;if(this.rampColors[i]&&this.rampColors[i]!==e[i])return!0}return!1}},{key:"reSize",value:function(e,t){if(e!==this.width||t!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=e,this.height=t;var r=new Uint8Array(e*t*4);this.backgroundTexture=YW(n,n.NEAREST,r,e,t),this.screenTexture=YW(n,n.NEAREST,r,e,t)}}},{key:"draw",value:function(){var e;if(null!==(e=this.windData)&&void 0!==e&&e.image){var t=this.gl;return XW(t,this.windTexture,0),XW(t,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var e=this.gl;QW(e,this.framebuffer,this.screenTexture),e.viewport(0,0,this.width,this.height),e.disable(e.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.pixels),QW(e,null,null),e.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var t=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=t}},{key:"drawFullTexture",value:function(e,t){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),XW(n,e,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,t),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var e=this.gl,t=this.drawProgram;e.useProgram(t),KW(e,this.particleIndexBuffer,t.a_index,1),XW(e,this.colorRampTexture,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1i(t.u_color_ramp,2),e.uniform1f(t.u_particles_res,this.particleStateResolution),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.drawArrays(e.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var e=this.gl;QW(e,this.framebuffer,this.particleStateTexture1),e.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var t=this.updateProgram;e.useProgram(t),KW(e,this.quadBuffer,t.a_pos,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1f(t.u_rand_seed,Math.random()),e.uniform2f(t.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.uniform1f(t.u_speed_factor,this.speedFactor),e.uniform1f(t.u_drop_rate,this.dropRate),e.uniform1f(t.u_drop_rate_bump,this.dropRateBump),e.drawArrays(e.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,QW(e,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),e}(),sY={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},uY={wind:function(e){A(i,e);var t,n,r=O(i);function i(){var e;b(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return E(I(e=r.call.apply(r,[this].concat(n))),"texture",void 0),E(I(e),"colorModel",void 0),E(I(e),"wind",void 0),E(I(e),"imageCoords",void 0),E(I(e),"sizeScale",.5),E(I(e),"frequency",new dy(7.2)),E(I(e),"cacheZoom",void 0),e}return S(i,[{key:"render",value:function(e){var t=this;this.drawColorMode(e),this.frequency.run((function(){t.drawWind()}))}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(n=_(g().mark((function e(){var t,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m,y,_,b,x,S,E,A,w,T,C,k,M,P=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.layer.getLayerConfig(),o=i.uMin,a=void 0===o?-21.32:o,s=i.uMax,u=void 0===s?26.8:s,c=i.vMin,l=void 0===c?-21.57:c,h=i.vMax,f=void 0===h?21.42:h,p=i.fadeOpacity,d=void 0===p?.996:p,v=i.speedFactor,m=void 0===v?.25:v,y=i.dropRate,_=void 0===y?.003:y,b=i.dropRateBump,x=void 0===b?.01:b,S=i.rampColors,E=void 0===S?sY:S,A=i.sizeScale,w=void 0===A?.5:A,T=this.rendererService.createTexture2D,C=this.layer.getSource(),this.texture=T({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom()),k=this.rendererService.getGLContext(),this.imageCoords=null===(t=C.data)||void 0===t?void 0:t.dataArray[0].coordinates,null===(n=C.data)||void 0===n||null===(r=n.images)||void 0===r||r.then((function(e){var t;P.sizeScale=w*P.getZoomScale();var n=P.getWindSize(),r=n.imageWidth,i=n.imageHeight,o={glContext:k,imageWidth:r,imageHeight:i,fadeOpacity:d,speedFactor:m,dropRate:_,dropRateBump:x,rampColors:E};P.wind=new aY(o),P.wind.setWind({uMin:a,uMax:u,vMin:l,vMax:f,image:e[0]}),null===(t=P.texture)||void 0===t||t.destroy(),P.texture=T({width:r,height:i}),P.layerService.reRender()})),e.next=10,this.layer.buildLayerModel({moduleName:"wind",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ngl_FragColor = color;\ngl_FragColor.a *= u_opacity;\n}",triangulation:hH,primitive:fL.TRIANGLES,depth:{enable:!1}});case 10:return M=e.sent,this.colorModel=M,e.abrupt("return",[M]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getWindSize",value:function(){var e=this.mapService.lngLatToPixel(this.imageCoords[0]),t=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.min(Math.floor((t.x-e.x)*this.sizeScale),2048),imageHeight:Math.min(Math.floor((e.y-t.y)*this.sizeScale),2048)}}},{key:"buildModels",value:(t=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.wind)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:jD.Attribute,descriptor:{name:"a_Uv",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var e=this.layer.getLayerConfig(),t=e.uMin,n=void 0===t?-21.32:t,r=e.uMax,i=void 0===r?26.8:r,o=e.vMin,a=void 0===o?-21.57:o,s=e.vMax,u=void 0===s?21.42:s,c=e.numParticles,l=void 0===c?65535:c,h=e.fadeOpacity,f=void 0===h?.996:h,p=e.speedFactor,d=void 0===p?.25:p,v=e.dropRate,g=void 0===v?.003:v,m=e.dropRateBump,y=void 0===m?.01:m,_=e.rampColors,b=void 0===_?sY:_,x=e.sizeScale,S=void 0===x?.5:x,E=l,A=Math.floor(this.mapService.getZoom());if("number"==typeof S&&S!==this.sizeScale||A!==this.cacheZoom){var w=this.getZoomScale();this.sizeScale=S,E*=w;var T=this.getWindSize(),C=T.imageWidth,k=T.imageHeight;this.wind.reSize(C,k),this.cacheZoom=A}this.wind.updateWindDir(n,i,a,u),this.wind.updateParticelNum(E),this.wind.updateColorRampTexture(b),this.wind.fadeOpacity=f,this.wind.speedFactor=d,this.wind.dropRate=g,this.wind.dropRateBump=y;var M=this.wind.draw(),P=M.d,I=M.w,L=M.h;this.rendererService.setBaseState(),this.texture.update({data:P,width:I,height:L})}}},{key:"drawColorMode",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.layer.getLayerConfig(),r=n.opacity;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:r||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(t)}),this.layer.hooks.afterRender.call()}}]),i}(gG)},cY=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"type","WindLayer"),e}return S(r,[{key:"buildModels",value:(t=_(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new uY[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"renderModels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.layerModel&&this.layerModel.render(e),this}},{key:"getDefaultConfig",value:function(){return{wind:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]),r}(dG),lY=($W=vw(),JW=dw(AT.IMapService),eY=dw(AT.IFontService),$W((rY=G((nY=function(){function e(){b(this,e),V(this,"mapService",rY,this),V(this,"fontService",iY,this)}return S(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("DataMappingPlugin",_(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.log(BD.MappingStart,sI.INIT),n.generateMaping(e,{styleAttributeService:r}),e.log(BD.MappingEnd,sI.INIT);case 3:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var t=_(g().mark((function t(i){var o;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:return e.dataState.dataMappingNeedUpdate=!1,e.log(BD.MappingStart,sI.UPDATE),o=n.generateMaping(e,{styleAttributeService:r}),e.log(BD.MappingEnd,sI.UPDATE),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){var t=e.getSource();if(!e.layerModelNeedUpdate&&t&&t.inited){var i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.data.dataArray;if(!Array.isArray(a)||0!==a.length){var s=i.filter((function(e){return e.needRemapping})),u=a;if(null!=o&&o.needRemapping&&null!=o&&o.scale&&(u=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s.length){var c=n.mapping(e,s,u,e.getEncodedData());e.setEncodedData(c)}}}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=e.getSource().data.dataArray,s=a;null!=o&&o.scale&&(s=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s=e.processData(s);var u=this.mapping(e,i,s,void 0);return e.setEncodedData(u),(0!==a.length||0!==e.encodeDataLength)&&(e.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(e,t,n,r){var i=this,o=e.getLayerConfig().arrow,a=void 0===o?{enable:!1}:o,s=t.filter((function(e){return void 0!==e.scale})).filter((function(e){return"filter"!==e.name})),u=n.map((function(t,n){var o=r?r[n]:{},u=v({id:t._id,coordinates:t.coordinates},o);if(s.forEach((function(e){var n=i.applyAttributeMapping(e,t);"color"!==e.name&&"stroke"!==e.name||(n=n.map((function(e){return Lv(e)}))),u[e.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===e.name&&(u.shape=i.fontService.getIconFontKey(u[e.name]))})),a.enable&&"line"===u.shape){var c=u.coordinates;if(e.arrowInsertCount<e.encodeDataLength){var l=i.getArrowPoints(c[0],c[1]);u.coordinates.splice(1,0,l,l),e.arrowInsertCount++}}return u}));return t.forEach((function(e){e.needRemapping=!1})),this.adjustData2Amap2Coordinates(u,e),this.adjustData2SimpleCoordinates(u),u}},{key:"adjustData2Amap2Coordinates",value:function(e,t){var n=this;if(e.length>0&&this.mapService.version===Sz["GAODE2.x"]){var r=t.coordCenter||t.getSource().center;e.filter((function(e){return!e.originCoordinates})).map((function(e){e.version=Sz["GAODE2.x"],e.originCoordinates=nB(e.coordinates),e.coordinates=n.mapService.coordToAMap2RelativeCoordinates(e.coordinates,r)}))}}},{key:"adjustData2SimpleCoordinates",value:function(e){var t=this;e.length>0&&this.mapService.version===Sz.SIMPLE&&e.map((function(e){e.simpleCoordinate||(e.coordinates=t.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(e){var t=this;if("number"==typeof e[0])return this.mapService.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),r}},{key:"applyAttributeMapping",value:function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}},{key:"getArrowPoints",value:function(e,t){var n=s_([t[0]-e[0],t[1]-e[1]]);return[e[0]+1e-4*n[0],e[1]+1e-4*n[1]]}}]),e}()).prototype,"mapService",[JW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iY=G(nY.prototype,"fontService",[eY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tY=nY))||tY),hY=vw()(oY=function(){function e(){b(this,e),E(this,"mapService",void 0)}return S(e,[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().get(AT.IMapService),e.hooks.init.tapPromise("DataSourcePlugin",_(g().mark((function n(){var r,i,o,a;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.log(BD.SourceInitStart,sI.INIT),(r=e.getSource())||(i=e.sourceOption||e.defaultSourceConfig,o=i.data,a=i.options,r=new uB(o,a),e.setSource(r)),!r.inited){n.next=8;break}t.updateClusterData(e),e.log(BD.SourceInitEnd,sI.INIT),n.next=10;break;case 8:return n.next=10,new Promise((function(n){r.on("update",(function(r){"inited"===r.type&&(t.updateClusterData(e),e.log(BD.SourceInitEnd,sI.INIT)),n(null)}))}));case 10:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("DataSourcePlugin",_(g().mark((function n(){var r,i,o;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.updateClusterData(e),i=e.dataState.dataSourceNeedUpdate,e.dataState.dataSourceNeedUpdate=!1,o=r||i,n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)}))))}},{key:"updateClusterData",value:function(e){if(e.isTileLayer||e.tileLayer||!e.getSource())return!1;var t=e.getSource(),n=t.cluster,r=t.clusterOptions.zoom,i=void 0===r?0:r,o=this.mapService.getZoom()-1,a=e.dataState.dataSourceNeedUpdate;return n&&a&&t.updateClusterData(Math.floor(o)),!!(n&&Math.abs(e.clusterZoom-o)>=1)&&(i!==Math.floor(o)&&t.updateClusterData(Math.floor(o)),e.clusterZoom=o,!0)}}]),e}())||oY;function fY(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function pY(e){return 1===e.length&&(e=function(e){return function(t,n){return fY(e(t),n)}}(e)),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)<0?r=o+1:i=o}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)>0?i=o:r=o+1}return r}}}var dY=pY(fY).right;function vY(e){return null===e?NaN:+e}function gY(e,t){var n,r,i,o=e.length,a=-1;if(null==t){for(;++a<o;)if(null!=(n=e[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=e[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=t(e[a],a,e))&&n>=n)for(r=i=n;++a<o;)null!=(n=t(e[a],a,e))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}var mY=Math.sqrt(50),yY=Math.sqrt(10),_Y=Math.sqrt(2);function bY(e,t,n){var r,i,o,a,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=xY(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(e+s)*a;else for(e=Math.floor(e*a),t=Math.ceil(t*a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(e-s)/a;return r&&o.reverse(),o}function xY(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=mY?10:o>=yY?5:o>=_Y?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=mY?10:o>=yY?5:o>=_Y?2:1)}function SY(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=mY?i*=10:o>=yY?i*=5:o>=_Y&&(i*=2),t<e?-i:i}function EY(e,t,n){if(null==n&&(n=vY),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),a=+n(e[o],o,e);return a+(+n(e[o+1],o+1,e)-a)*(i-o)}}function AY(e){return function(){return e}}function wY(e){return 1==(e=+e)?TY:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):AY(isNaN(t)?n:t)}}function TY(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):AY(isNaN(e)?t:e)}var CY=function e(t){var n=wY(t);function r(e,t){var r=n((e=Ev(e)).r,(t=Ev(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=TY(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);var kY,MY=(kY=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1],a=r>0?e[r-1]:2*i-o,s=r<t-1?e[r+2]:2*o-i;return function(e,t,n,r,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*n+(1+3*e+3*o-3*a)*r+a*i)/6}((n-r/t)*t,a,i,o,s)}},function(e){var t,n,r=e.length,i=new Array(r),o=new Array(r),a=new Array(r);for(t=0;t<r;++t)n=Ev(e[t]),i[t]=n.r||0,o[t]=n.g||0,a[t]=n.b||0;return i=kY(i),o=kY(o),a=kY(a),n.opacity=1,function(e){return n.r=i(e),n.g=o(e),n.b=a(e),n+""}});function PY(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function IY(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=BY(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function LY(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function OY(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function RY(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=BY(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var NY=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,DY=new RegExp(NY.source,"g");function FY(e,t){var n,r,i,o=NY.lastIndex=DY.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=NY.exec(e))&&(r=DY.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:OY(n,r)})),o=DY.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function BY(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?AY(t):("number"===i?OY:"string"===i?(n=_v(t))?(t=n,CY):FY:t instanceof _v?CY:t instanceof Date?LY:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?IY:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?RY:OY:PY))(e,t)}function zY(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function UY(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function jY(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e)}return this}function VY(){}function GY(e,t){var n=new VY;if(e instanceof VY)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,o=e.length;if(null==t)for(;++i<o;)n.set(i,e[i]);else for(;++i<o;)n.set(t(r=e[i],i,e),r)}else if(e)for(var a in e)n.set(a,e[a]);return n}function HY(){}VY.prototype=GY.prototype={constructor:VY,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if("$"===e[0])return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var WY=GY.prototype;HY.prototype=function(e,t){var n=new HY;if(e instanceof HY)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}.prototype={constructor:HY,has:WY.has,add:function(e){return this["$"+(e+="")]=e,this},remove:WY.remove,clear:WY.clear,values:WY.keys,size:WY.size,empty:WY.empty,each:WY.each};var YY=Array.prototype,XY=YY.map,ZY=YY.slice,qY={name:"implicit"};function KY(){var e=GY(),t=[],n=[],r=qY;function i(i){var o=i+"",a=e.get(o);if(!a){if(r!==qY)return r;e.set(o,a=t.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=GY();for(var r,o,a=-1,s=n.length;++a<s;)e.has(o=(r=n[a])+"")||e.set(o,t.push(r));return i},i.range=function(e){return arguments.length?(n=ZY.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return KY(t,n).unknown(r)},UY.apply(i,arguments),i}function QY(e){return+e}var $Y=[0,1];function JY(e){return e}function eX(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function tX(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function nX(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=eX(i,r),o=n(a,o)):(r=eX(r,i),o=n(o,a)),function(e){return o(r(e))}}function rX(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=eX(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=dY(e,t,1,r)-1;return o[n](i[n](t))}}function iX(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function oX(){var e,t,n,r,i,o,a=$Y,s=$Y,u=BY,c=JY;function l(){return r=Math.min(a.length,s.length)>2?rX:nX,i=o=null,h}function h(t){return isNaN(t=+t)?n:(i||(i=r(a.map(e),s,u)))(e(c(t)))}return h.invert=function(n){return c(t((o||(o=r(s,a.map(e),OY)))(n)))},h.domain=function(e){return arguments.length?(a=XY.call(e,QY),c===JY||(c=tX(a)),l()):a.slice()},h.range=function(e){return arguments.length?(s=ZY.call(e),l()):s.slice()},h.rangeRound=function(e){return s=ZY.call(e),u=zY,l()},h.clamp=function(e){return arguments.length?(c=e?tX(a):JY,h):c!==JY},h.interpolate=function(e){return arguments.length?(u=e,l()):u},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,l()}}function aX(e,t){return oX()(e,t)}function sX(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function uX(e){return(e=sX(Math.abs(e)))?e[1]:NaN}var cX,lX=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function hX(e){if(!(t=lX.exec(e)))throw new Error("invalid format: "+e);var t;return new fX({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function fX(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function pX(e,t){var n=sX(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}hX.prototype=fX.prototype,fX.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var dX={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return pX(100*e,t)},r:pX,s:function(e,t){var n=sX(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(cX=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+sX(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function vX(e){return e}var gX,mX,yX,_X=Array.prototype.map,bX=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function xX(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?vX:(t=_X.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?vX:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(_X.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"-":e.minus+"",l=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=hX(e)).fill,n=e.align,h=e.sign,f=e.symbol,p=e.zero,d=e.width,v=e.comma,g=e.precision,m=e.trim,y=e.type;"n"===y?(v=!0,y="g"):dX[y]||(void 0===g&&(g=12),m=!0,y="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var _="$"===f?i:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===f?o:/[%p]/.test(y)?u:"",x=dX[y],S=/[defgprs%]/.test(y);function E(e){var i,o,u,f=_,E=b;if("c"===y)E=x(e)+E,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?l:x(Math.abs(e),g),m&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==h&&(A=!1),f=(A?"("===h?h:c:"-"===h||"("===h?"":h)+f,E=("s"===y?bX[8+cX/3]:"")+E+(A&&"("===h?")":""),S)for(i=-1,o=e.length;++i<o;)if(48>(u=e.charCodeAt(i))||u>57){E=(46===u?a+e.slice(i+1):e.slice(i))+E,e=e.slice(0,i);break}}v&&!p&&(e=r(e,1/0));var w=f.length+e.length+E.length,T=w<d?new Array(d-w+1).join(t):"";switch(v&&p&&(e=r(T+e,T.length?d-E.length:1/0),T=""),n){case"<":e=f+e+E+T;break;case"=":e=f+T+e+E;break;case"^":e=T.slice(0,w=T.length>>1)+f+e+E+T.slice(w);break;default:e=T+f+e+E}return s(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),E.toString=function(){return e+""},E}return{format:h,formatPrefix:function(e,t){var n=h(((e=hX(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(uX(t)/3))),i=Math.pow(10,-r),o=bX[8+r/3];return function(e){return n(i*e)+o}}}}function SX(e,t,n,r){var i,o=SY(e,t,n);switch((r=hX(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(uX(t)/3)))-uX(Math.abs(e)))}(o,a))||(r.precision=i),yX(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,uX(t)-uX(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-uX(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return mX(r)}function EX(e){var t=e.domain;return e.ticks=function(e){var n=t();return bY(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return SX(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=xY(s,u,n))>0?r=xY(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=xY(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,t(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,t(i)),e},e}function AX(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),e[r]=t.floor(o),e[i]=t.ceil(a),e}function wX(e){return Math.log(e)}function TX(e){return Math.exp(e)}function CX(e){return-Math.log(-e)}function kX(e){return-Math.exp(-e)}function MX(e){return isFinite(e)?+("1e"+e):e<0?0:e}function PX(e){return function(t){return-e(-t)}}function IX(e){var t,n,r=e(wX,TX),i=r.domain,o=10;function a(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(o),n=function(e){return 10===e?MX:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(o),i()[0]<0?(t=PX(t),n=PX(n),e(CX,kX)):e(wX,TX),r}return r.base=function(e){return arguments.length?(o=+e,a()):o},r.domain=function(e){return arguments.length?(i(e),a()):i()},r.ticks=function(e){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(f=s,s=u,u=f);var c,l,h,f=t(s),p=t(u),d=null==e?10:+e,v=[];if(!(o%1)&&p-f<d){if(f=Math.round(f)-1,p=Math.round(p)+1,s>0){for(;f<p;++f)for(l=1,c=n(f);l<o;++l)if(!((h=c*l)<s)){if(h>u)break;v.push(h)}}else for(;f<p;++f)for(l=o-1,c=n(f);l>=1;--l)if(!((h=c*l)<s)){if(h>u)break;v.push(h)}}else v=bY(f,p,Math.min(p-f,d)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=mX(i)),e===1/0)return i;null==e&&(e=10);var a=Math.max(1,o*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*o<o-.5&&(r*=o),r<=a?i(e):""}},r.nice=function(){return i(AX(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function LX(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function OX(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function RX(e){return e<0?-e*e:e*e}function NX(e){var t=e(JY,JY),n=1;function r(){return 1===n?e(JY,JY):.5===n?e(OX,RX):e(LX(n),LX(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},EX(t)}gX=xX({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),mX=gX.format,yX=gX.formatPrefix;var DX=new Date,FX=new Date;function BX(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=function(n){return BX((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return DX.setTime(+t),FX.setTime(+r),e(DX),e(FX),Math.floor(n(DX,FX))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var zX=BX((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));zX.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?BX((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):zX:null};var UX=BX((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+1e3*t)}),(function(e,t){return(t-e)/1e3}),(function(e){return e.getUTCSeconds()})),jX=BX((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds())}),(function(e,t){e.setTime(+e+6e4*t)}),(function(e,t){return(t-e)/6e4}),(function(e){return e.getMinutes()})),VX=BX((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds()-6e4*e.getMinutes())}),(function(e,t){e.setTime(+e+36e5*t)}),(function(e,t){return(t-e)/36e5}),(function(e){return e.getHours()})),GX=BX((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5}),(function(e){return e.getDate()-1}));function HX(e){return BX((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5}))}var WX=HX(0),YX=HX(1),XX=(HX(2),HX(3),HX(4)),ZX=(HX(5),HX(6),BX((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),qX=BX((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));qX.every=function(e){return isFinite(e=Math.floor(e))&&e>0?BX((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var KX=BX((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/864e5}),(function(e){return e.getUTCDate()-1}));function QX(e){return BX((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/6048e5}))}var $X=QX(0),JX=QX(1),eZ=(QX(2),QX(3),QX(4)),tZ=(QX(5),QX(6),BX((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));function nZ(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function rZ(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function iZ(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}tZ.every=function(e){return isFinite(e=Math.floor(e))&&e>0?BX((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var oZ,aZ,sZ={"-":"",_:" ",0:"0"},uZ=/^\s*\d+/,cZ=/^%/,lZ=/[\\^$*+?|[\]().{}]/g;function hZ(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function fZ(e){return e.replace(lZ,"\\$&")}function pZ(e){return new RegExp("^(?:"+e.map(fZ).join("|")+")","i")}function dZ(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function vZ(e,t,n){var r=uZ.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function gZ(e,t,n){var r=uZ.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function mZ(e,t,n){var r=uZ.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function yZ(e,t,n){var r=uZ.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function _Z(e,t,n){var r=uZ.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function bZ(e,t,n){var r=uZ.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function xZ(e,t,n){var r=uZ.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function SZ(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function EZ(e,t,n){var r=uZ.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function AZ(e,t,n){var r=uZ.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function wZ(e,t,n){var r=uZ.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function TZ(e,t,n){var r=uZ.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function CZ(e,t,n){var r=uZ.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function kZ(e,t,n){var r=uZ.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function MZ(e,t,n){var r=uZ.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function PZ(e,t,n){var r=uZ.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function IZ(e,t,n){var r=uZ.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function LZ(e,t,n){var r=cZ.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function OZ(e,t,n){var r=uZ.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function RZ(e,t,n){var r=uZ.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function NZ(e,t){return hZ(e.getDate(),t,2)}function DZ(e,t){return hZ(e.getHours(),t,2)}function FZ(e,t){return hZ(e.getHours()%12||12,t,2)}function BZ(e,t){return hZ(1+GX.count(qX(e),e),t,3)}function zZ(e,t){return hZ(e.getMilliseconds(),t,3)}function UZ(e,t){return zZ(e,t)+"000"}function jZ(e,t){return hZ(e.getMonth()+1,t,2)}function VZ(e,t){return hZ(e.getMinutes(),t,2)}function GZ(e,t){return hZ(e.getSeconds(),t,2)}function HZ(e){var t=e.getDay();return 0===t?7:t}function WZ(e,t){return hZ(WX.count(qX(e)-1,e),t,2)}function YZ(e){var t=e.getDay();return t>=4||0===t?XX(e):XX.ceil(e)}function XZ(e,t){return e=YZ(e),hZ(XX.count(qX(e),e)+(4===qX(e).getDay()),t,2)}function ZZ(e){return e.getDay()}function qZ(e,t){return hZ(YX.count(qX(e)-1,e),t,2)}function KZ(e,t){return hZ(e.getFullYear()%100,t,2)}function QZ(e,t){return hZ((e=YZ(e)).getFullYear()%100,t,2)}function $Z(e,t){return hZ(e.getFullYear()%1e4,t,4)}function JZ(e,t){var n=e.getDay();return hZ((e=n>=4||0===n?XX(e):XX.ceil(e)).getFullYear()%1e4,t,4)}function eq(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+hZ(t/60|0,"0",2)+hZ(t%60,"0",2)}function tq(e,t){return hZ(e.getUTCDate(),t,2)}function nq(e,t){return hZ(e.getUTCHours(),t,2)}function rq(e,t){return hZ(e.getUTCHours()%12||12,t,2)}function iq(e,t){return hZ(1+KX.count(tZ(e),e),t,3)}function oq(e,t){return hZ(e.getUTCMilliseconds(),t,3)}function aq(e,t){return oq(e,t)+"000"}function sq(e,t){return hZ(e.getUTCMonth()+1,t,2)}function uq(e,t){return hZ(e.getUTCMinutes(),t,2)}function cq(e,t){return hZ(e.getUTCSeconds(),t,2)}function lq(e){var t=e.getUTCDay();return 0===t?7:t}function hq(e,t){return hZ($X.count(tZ(e)-1,e),t,2)}function fq(e){var t=e.getUTCDay();return t>=4||0===t?eZ(e):eZ.ceil(e)}function pq(e,t){return e=fq(e),hZ(eZ.count(tZ(e),e)+(4===tZ(e).getUTCDay()),t,2)}function dq(e){return e.getUTCDay()}function vq(e,t){return hZ(JX.count(tZ(e)-1,e),t,2)}function gq(e,t){return hZ(e.getUTCFullYear()%100,t,2)}function mq(e,t){return hZ((e=fq(e)).getUTCFullYear()%100,t,2)}function yq(e,t){return hZ(e.getUTCFullYear()%1e4,t,4)}function _q(e,t){var n=e.getUTCDay();return hZ((e=n>=4||0===n?eZ(e):eZ.ceil(e)).getUTCFullYear()%1e4,t,4)}function bq(){return"+0000"}function xq(){return"%"}function Sq(e){return+e}function Eq(e){return Math.floor(+e/1e3)}!function(e){oZ=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,c=pZ(i),l=dZ(i),h=pZ(o),f=dZ(o),p=pZ(a),d=dZ(a),v=pZ(s),g=dZ(s),m=pZ(u),y=dZ(u),_={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:NZ,e:NZ,f:UZ,g:QZ,G:JZ,H:DZ,I:FZ,j:BZ,L:zZ,m:jZ,M:VZ,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:Sq,s:Eq,S:GZ,u:HZ,U:WZ,V:XZ,w:ZZ,W:qZ,x:null,X:null,y:KZ,Y:$Z,Z:eq,"%":xq},b={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:tq,e:tq,f:aq,g:mq,G:_q,H:nq,I:rq,j:iq,L:oq,m:sq,M:uq,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:Sq,s:Eq,S:cq,u:lq,U:hq,V:pq,w:dq,W:vq,x:null,X:null,y:gq,Y:yq,Z:bq,"%":xq},x={a:function(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=f[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return A(e,t,n,r)},d:wZ,e:wZ,f:IZ,g:xZ,G:bZ,H:CZ,I:CZ,j:TZ,L:PZ,m:AZ,M:kZ,p:function(e,t,n){var r=c.exec(t.slice(n));return r?(e.p=l[r[0].toLowerCase()],n+r[0].length):-1},q:EZ,Q:OZ,s:RZ,S:MZ,u:gZ,U:mZ,V:yZ,w:vZ,W:_Z,x:function(e,t,r){return A(e,n,t,r)},X:function(e,t,n){return A(e,r,t,n)},y:xZ,Y:bZ,Z:SZ,"%":LZ};function S(e,t){return function(n){var r,i,o,a=[],s=-1,u=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===e.charCodeAt(s)&&(a.push(e.slice(u,s)),null!=(i=sZ[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(e.slice(u,s)),a.join("")}}function E(e,t){return function(n){var r,i,o=iZ(1900,void 0,1);if(A(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=rZ(iZ(o.y,0,1))).getUTCDay(),r=i>4||0===i?JX.ceil(r):JX(r),r=KX.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=nZ(iZ(o.y,0,1))).getDay(),r=i>4||0===i?YX.ceil(r):YX(r),r=GX.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?rZ(iZ(o.y,0,1)).getUTCDay():nZ(iZ(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,rZ(o)):nZ(o)}}function A(e,t,n,r){for(var i,o,a=0,s=t.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=x[i in sZ?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=S(n,_),_.X=S(r,_),_.c=S(t,_),b.x=S(n,b),b.X=S(r,b),b.c=S(t,b),{format:function(e){var t=S(e+="",_);return t.toString=function(){return e},t},parse:function(e){var t=E(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=S(e+="",b);return t.toString=function(){return e},t},utcParse:function(e){var t=E(e+="",!0);return t.toString=function(){return e},t}}}(e),aZ=oZ.format,oZ.parse,oZ.utcFormat,oZ.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Aq,wq;function Tq(e){return new Date(e)}function Cq(e){return e instanceof Date?+e:+new Date(+e)}function kq(e,t,n,r,i,o,a,s,u){var c=aX(JY,JY),l=c.invert,h=c.domain,f=u(".%L"),p=u(":%S"),d=u("%I:%M"),v=u("%I %p"),g=u("%a %d"),m=u("%b %d"),y=u("%B"),_=u("%Y"),b=[[a,1,1e3],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,6e4],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[t,1,2592e6],[t,3,7776e6],[e,1,31536e6]];function x(s){return(a(s)<s?f:o(s)<s?p:i(s)<s?d:r(s)<s?v:t(s)<s?n(s)<s?g:m:e(s)<s?y:_)(s)}function S(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var o=Math.abs(r-n)/t,a=pY((function(e){return e[2]})).right(b,o);a===b.length?(i=SY(n/31536e6,r/31536e6,t),t=e):a?(i=(a=b[o/b[a-1][2]<b[a][2]/o?a-1:a])[1],t=a[0]):(i=Math.max(SY(n,r,t),1),t=s)}return null==i?t:t.every(i)}return c.invert=function(e){return new Date(l(e))},c.domain=function(e){return arguments.length?h(XY.call(e,Cq)):h().map(Tq)},c.ticks=function(e,t){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=S(e,i,o,t))?n.range(i,o+1):[],a?n.reverse():n},c.tickFormat=function(e,t){return null==t?x:u(t)},c.nice=function(e,t){var n=h();return(e=S(e,n[0],n[n.length-1],t))?h(AX(n,e)):c},c.copy=function(){return iX(c,kq(e,t,n,r,i,o,a,s,u))},c}function Mq(){var e,t,n,r,i,o=0,a=1,s=JY,u=!1;function c(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}return c.domain=function(i){return arguments.length?(e=r(o=+i[0]),t=r(a=+i[1]),n=e===t?0:1/(t-e),c):[o,a]},c.clamp=function(e){return arguments.length?(u=!!e,c):u},c.interpolator=function(e){return arguments.length?(s=e,c):s},c.unknown=function(e){return arguments.length?(i=e,c):i},function(i){return r=i,e=i(o),t=i(a),n=e===t?0:1/(t-e),c}}function Pq(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Iq(){var e,t,n,r,i,o,a,s=0,u=.5,c=1,l=JY,h=!1;function f(e){return isNaN(e=+e)?a:(e=.5+((e=+o(e))-t)*(e<t?r:i),l(h?Math.max(0,Math.min(1,e)):e))}return f.domain=function(a){return arguments.length?(e=o(s=+a[0]),t=o(u=+a[1]),n=o(c=+a[2]),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),f):[s,u,c]},f.clamp=function(e){return arguments.length?(h=!!e,f):h},f.interpolator=function(e){return arguments.length?(l=e,f):l},f.unknown=function(e){return arguments.length?(a=e,f):a},function(a){return o=a,e=a(s),t=a(u),n=a(c),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),f}}var Lq,Oq,Rq=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Nq=(E(Aq={},zD.LINEAR,(function e(){var t=aX(JY,JY);return t.copy=function(){return iX(t,e())},UY.apply(t,arguments),EX(t)})),E(Aq,zD.POWER,(function e(){var t=NX(oX());return t.copy=function(){return iX(t,e()).exponent(t.exponent())},UY.apply(t,arguments),t})),E(Aq,zD.LOG,(function e(){var t=IX(oX()).domain([1,10]);return t.copy=function(){return iX(t,e()).base(t.base())},UY.apply(t,arguments),t})),E(Aq,zD.IDENTITY,(function e(t){var n,r=[];function i(e){return null==e?n:e}return i.invert=i,i.domain=i.range=function(e){return e?(r=e,e):r},i.unknown=function(e){return e?(n=e,e):n},i.copy=function(){return e().unknown(n)},i})),E(Aq,zD.SEQUENTIAL,(function e(){var t=EX(Mq()(JY));return t.copy=function(){return Pq(t,e())},jY.apply(t,arguments)})),E(Aq,zD.TIME,(function(){return UY.apply(kq(qX,ZX,WX,GX,VX,jX,UX,zX,aZ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),E(Aq,zD.QUANTILE,(function e(){var t,n=[],r=[],i=[];function o(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=EY(n,e/t);return a}function a(e){return isNaN(e=+e)?t:r[dY(i,e)]}return a.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},a.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var t,r=0,i=e.length;r<i;++r)null==(t=e[r])||isNaN(t=+t)||n.push(t);return n.sort(fY),o()},a.range=function(e){return arguments.length?(r=ZY.call(e),o()):r.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return i.slice()},a.copy=function(){return e().domain(n).range(r).unknown(t)},UY.apply(a,arguments)})),E(Aq,zD.QUANTIZE,(function e(){var t,n=0,r=1,i=1,o=[.5],a=[0,1];function s(e){return e<=e?a[dY(o,e,0,i)]:t}function u(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?(n=+e[0],r=+e[1],u()):[n,r]},s.range=function(e){return arguments.length?(i=(a=ZY.call(e)).length-1,u()):a.slice()},s.invertExtent=function(e){var t=a.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,o[0]]:t>=i?[o[i-1],r]:[o[t-1],o[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return e().domain([n,r]).range(a).unknown(t)},UY.apply(EX(s),arguments)})),E(Aq,zD.THRESHOLD,(function e(){var t,n=[.5],r=[0,1],i=1;function o(e){return e<=e?r[dY(n,e,0,i)]:t}return o.domain=function(e){return arguments.length?(n=ZY.call(e),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(e){return arguments.length?(r=ZY.call(e),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},o.unknown=function(e){return arguments.length?(t=e,o):t},o.copy=function(){return e().domain(n).range(r).unknown(t)},UY.apply(o,arguments)})),E(Aq,zD.CAT,KY),E(Aq,zD.DIVERGING,(function e(){var t=EX(Iq()(JY));return t.copy=function(){return Pq(t,e())},jY.apply(t,arguments)})),Aq),Dq=vw()(wq=function(){function e(){b(this,e),E(this,"scaleOptions",{})}return S(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("FeatureScalePlugin",_(g().mark((function t(){var i,o,a;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.log(BD.ScaleInitStart,sI.INIT),n.scaleOptions=e.getScaleOptions(),o=r.getLayerStyleAttributes(),a=null===(i=e.getSource())||void 0===i?void 0:i.data.dataArray,!Array.isArray(a)||0!==a.length){t.next=8;break}return t.abrupt("return");case 8:n.caculateScalesForAttributes(o||[],a);case 9:e.log(BD.ScaleInitEnd,sI.INIT);case 10:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var t=_(g().mark((function t(i){var o,a;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:if(e.log(BD.ScaleInitStart,sI.UPDATE),n.scaleOptions=e.getScaleOptions(),o=r.getLayerStyleAttributes(),a=e.getSource().data.dataArray,!Array.isArray(a)||0!==a.length){t.next=8;break}return t.abrupt("return",!0);case 8:return n.caculateScalesForAttributes(o||[],a),e.log(BD.ScaleInitEnd,sI.UPDATE),e.layerModelNeedUpdate=!0,t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!e.layerModelNeedUpdate){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;if((!Array.isArray(i)||0!==i.length)&&t){var o=t.filter((function(e){return e.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(e,t){var n=this;e.forEach((function(e){if(e.scale){var r=e.scale;r.names=n.parseFields(e.scale.field||[]);var i=[];r.names.forEach((function(r){var o;i.push(n.createScale(r,e.name,null===(o=e.scale)||void 0===o?void 0:o.values,t))})),i.some((function(e){return e.type===UD.VARIABLE}))?(r.type=UD.VARIABLE,i.forEach((function(e){var t,n;if(!r.callback&&"text"!==r.values)switch(null===(t=e.option)||void 0===t?void 0:t.type){case zD.LOG:case zD.LINEAR:case zD.POWER:if(r.values&&r.values.length>2){var i=e.scale.ticks(r.values.length);e.scale.domain(i)}r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case zD.QUANTILE:case zD.QUANTIZE:case zD.THRESHOLD:e.scale.range(r.values);break;case zD.IDENTITY:break;case zD.CAT:r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case zD.DIVERGING:case zD.SEQUENTIAL:e.scale.interpolator(MY(r.values))}"text"===r.values&&e.scale.range(null===(n=e.option)||void 0===n?void 0:n.domain)}))):(r.type=UD.CONSTANT,r.defaultValues=i.map((function(e,t){return e.scale(r.names[t])}))),r.scalers=i.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),e.needRescale=!1}}))}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:cF(e)?e.split("*"):[e]}},{key:"createScale",value:function(e,t,n,r){var i,o,a=this.scaleOptions[t]&&(null===(i=this.scaleOptions[t])||void 0===i?void 0:i.field)===e?this.scaleOptions[t]:this.scaleOptions[e],s={field:e,scale:void 0,type:UD.VARIABLE,option:a};if(!r||!r.length)return a&&a.type?s.scale=this.createDefaultScale(a):(s.scale=KY([e]),s.type=UD.CONSTANT),s;var u=null===(o=r.find((function(t){return!AL(t[e])})))||void 0===o?void 0:o[e];if(this.isNumber(e)||AL(u)&&!a)s.scale=KY([e]),s.type=UD.CONSTANT;else{var c=a&&a.type||this.getDefaultType(u);"text"===n&&(c=zD.CAT);var l=this.createScaleConfig(c,e,a,r);s.scale=this.createDefaultScale(l),s.option=l}return s}},{key:"getDefaultType",value:function(e){var t=zD.LINEAR;return"string"==typeof e&&(t=Rq.test(e)?zD.TIME:zD.CAT),t}},{key:"createScaleConfig",value:function(e,t,n,r){var i={type:e},o=(null==r?void 0:r.map((function(e){return e[t]})))||[];if(null!=n&&n.domain)i.domain=null==n?void 0:n.domain;else if(e===zD.CAT||e===zD.IDENTITY)i.domain=vR(o);else if(e===zD.QUANTILE)i.domain=o;else if(e===zD.DIVERGING){var a=gY(o),s=void 0!==(null==n?void 0:n.neutral)?null==n?void 0:n.neutral:(a[0]+a[1])/2;i.domain=[a[0],s,a[1]]}else i.domain=gY(o);return v(v({},i),n)}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=e.unknown,i=e.clamp,o=e.nice,a=Nq[t]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),e}())||wq,Fq=vw()(Lq=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){e.animateStatus&&e.models.forEach((function(t){t.addUniforms(v({},e.layerModel.getAnimateUniforms()))}))}))}}]),e}())||Lq,Bq=vw()(Oq=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerMaskPlugin",(function(){var t,n=e.getLayerConfig(),r=n.maskLayers,i=n.enableMask;!e.tileLayer&&r&&r.length>0&&((t=e.masks).push.apply(t,F(r)),e.updateLayerConfig({mask:i}))}))}}]),e}())||Oq,zq=function(){function e(t){var n=t.rendererService,r=t.layerService,i=t.parent;b(this,e),E(this,"tileResource",new Map),E(this,"rendererService",void 0),E(this,"layerService",void 0),E(this,"parent",void 0),E(this,"layerTiles",[]),this.rendererService=n,this.layerService=r,this.parent=i}var t;return S(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(e){return this.layerTiles.some((function(t){return t.key===e}))}},{key:"addTile",value:function(e){this.layerTiles.push(e)}},{key:"getTile",value:function(e){return this.layerTiles.find((function(t){return t.key===e}))}},{key:"getVisibleTileBylngLat",value:function(e){return this.layerTiles.find((function(t){return t.isLoaded&&t.visible&&t.lnglatInBounds(e)}))}},{key:"removeTile",value:function(e){var t=this.layerTiles.findIndex((function(t){return t.key===e})),n=this.layerTiles.splice(t,1);n[0]&&n[0].destroy()}},{key:"updateTileVisible",value:function(e){var t=this.getTile(e.key);null==t||t.updateVisible(e.isVisible)}},{key:"isParentLoaded",value:function(e){var t=e.parent;if(!t)return!0;var n=this.getTile(null==t?void 0:t.key);return!(null==n||!n.isLoaded)}},{key:"isChildrenLoaded",value:function(e){var t=this,n=null==e?void 0:e.children;return 0===n.length||n.some((function(e){var n=t.getTile(null==e?void 0:e.key);return!1===(null==n?void 0:n.isLoaded)}))}},{key:"render",value:(t=_(g().mark((function e(){var t,n,r=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getRenderLayers(),n=t.map(function(){var e=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.layerService.renderTileLayer(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getRenderLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.visible&&e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,F(e.getLayers()))})),t}},{key:"getLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,F(e.getLayers()))})),t}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach((function(e){return e.destroy()})),this.tileResource.clear()}}]),e}(),Uq=Y((function(e,t){e.exports=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}
/**
     * splaytree v3.1.0
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */var r=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function i(e,t){return e>t?1:e<t?-1:0}function o(e,t,n){for(var i=new r(null,null),o=i,a=i;;){var s=n(e,t.key);if(s<0){if(null===t.left)break;if(n(e,t.left.key)<0){var u=t.left;if(t.left=u.right,u.right=t,null===(t=u).left)break}a.left=t,a=t,t=t.left}else{if(!(s>0))break;if(null===t.right)break;if(n(e,t.right.key)>0&&(u=t.right,t.right=u.left,u.left=t,null===(t=u).right))break;o.right=t,o=t,t=t.right}}return o.right=t.left,a.left=t.right,t.left=i.right,t.right=i.left,t}function a(e,t,n,i){var a=new r(e,t);if(null===n)return a.left=a.right=null,a;var s=i(e,(n=o(e,n,i)).key);return s<0?(a.left=n.left,a.right=n,n.left=null):s>=0&&(a.right=n.right,a.left=n,n.right=null),a}function s(e,t,n){var r=null,i=null;if(t){var a=n((t=o(e,t,n)).key,e);0===a?(r=t.left,i=t.right):a<0?(i=t.right,t.right=null,r=t):(r=t.left,t.left=null,i=t)}return{left:r,right:i}}var u=function(){function e(e){void 0===e&&(e=i),this._root=null,this._size=0,this._comparator=e}return e.prototype.insert=function(e,t){return this._size++,this._root=a(e,t,this._root,this._comparator)},e.prototype.add=function(e,t){var n=new r(e,t);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,a=o(e,this._root,i),s=i(e,a.key);return 0===s?this._root=a:(s<0?(n.left=a.left,n.right=a,a.left=null):s>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},e.prototype._remove=function(e,t,n){var r;return null===t?null:0===n(e,(t=o(e,t,n)).key)?(null===t.left?r=t.right:(r=o(e,t.left,n)).right=t.right,this._size--,r):t},e.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=o(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},e.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},e.prototype.find=function(e){return this._root&&(this._root=o(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},e.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},e.prototype.forEach=function(e,t){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),e.call(t,n),n=n.right):i=!0;return this},e.prototype.range=function(e,t,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,t)>0)break;if(o(a.key,e)>=0&&n.call(r,a))return this;a=a.right}return this},e.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},e.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},e.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},e.prototype.at=function(e){for(var t=this._root,n=!1,r=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},e.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?(n=t,t=t.left):t=t.right}return n},e.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){for(n=e.left;n.right;)n=n.right;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?t=t.left:(n=t,t=t.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return function(e){for(var t=e,n=[],i=!1,o=new r(null,null),a=o;!i;)t?(n.push(t),t=t.left):n.length>0?t=(t=a=a.next=n.pop()).right:i=!0;return a.next=null,o.next}(this._root)},e.prototype.load=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=!1);var i=e.length,o=this._comparator;if(n&&function e(t,n,r,i,o){if(!(r>=i)){for(var a=t[r+i>>1],s=r-1,u=i+1;;){do{s++}while(o(t[s],a)<0);do{u--}while(o(t[u],a)>0);if(s>=u)break;var c=t[s];t[s]=t[u],t[u]=c,c=n[s],n[s]=n[u],n[u]=c}e(t,n,r,u,o),e(t,n,u+1,i,o)}}(e,t,0,i-1,o),null===this._root)this._root=function e(t,n,i,o){var a=o-i;if(a>0){var s=i+Math.floor(a/2),u=t[s],c=n[s],l=new r(u,c);return l.left=e(t,n,i,s),l.right=e(t,n,s+1,o),l}return null}(e,t,0,i),this._size=i;else{var a=function(e,t,n){for(var i=new r(null,null),o=i,a=e,s=t;null!==a&&null!==s;)n(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}(this.toList(),function(e,t){for(var n=new r(null,null),i=n,o=0;o<e.length;o++)i=i.next=new r(e[o],t[o]);return i.next=null,n.next}(e,t),o);i=this._size+i,this._root=function e(t,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),a=e(t,n,o),s=t.head;return s.left=a,t.head=t.head.next,s.right=e(t,o+1,r),s}return null}({head:a},0,i)}return this},e.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return function e(t,n,r,i,o){if(t){i(n+(r?"âââ ":"âââ ")+o(t)+"\n");var a=n+(r?"    ":"â   ");t.left&&e(t.left,a,!1,i,o),t.right&&e(t.right,a,!0,i,o)}}(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},e.prototype.update=function(e,t,n){var r=this._comparator,i=s(e,this._root,r),u=i.left,c=i.right;r(e,t)<0?c=a(t,n,c,r):u=a(t,n,u,r),this._root=function(e,t,n){return null===t?e:(null===e||((t=o(e.key,t,n)).left=e),t)}(u,c,r)},e.prototype.split=function(e){return s(e,this._root,this._comparator)},e}(),c=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},l=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},h=Number.EPSILON;void 0===h&&(h=Math.pow(2,-52));var f=h*h,p=function(e,t){if(-h<e&&e<h&&-h<t&&t<h)return 0;var n=e-t;return n*n<f*e*t?0:e<t?-1:1},d=function(){function t(){e(this,t),this.reset()}return n(t,[{key:"reset",value:function(){this.xRounder=new v,this.yRounder=new v}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),t}(),v=function(){function t(){e(this,t),this.tree=new u,this.round(0)}return n(t,[{key:"round",value:function(e){var t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===p(t.key,n.key))return this.tree.remove(e),n.key;var r=this.tree.next(t);return null!==r&&0===p(t.key,r.key)?(this.tree.remove(e),r.key):e}}]),t}(),g=new d,m=function(e,t){return e.x*t.y-e.y*t.x},y=function(e,t){return e.x*t.x+e.y*t.y},_=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},o=m(r,i);return p(o,0)},b=function(e){return Math.sqrt(y(e,e))},x=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return y(i,r)/b(i)/b(r)},S=function(e,t,n){return 0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},E=function(e,t,n){return 0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},A=function(){function t(n,r){e(this,t),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=r}return n(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:T.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),n(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,n=0,r=t.length;n<r;n++){var i=t[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var n=this.point.events[t];if(void 0===n.segment.consumedBy)for(var r=t+1;r<e;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,n=this.point.events.length;t<n;t++){var r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,n=new Map,r=function(r){var i,o,a,s,u,c=r.otherSE;n.set(r,{sine:(i=t.point,o=e.point,a=c.point,s={x:o.x-i.x,y:o.y-i.y},u={x:a.x-i.x,y:a.y-i.y},m(u,s)/b(u)/b(s)),cosine:x(t.point,e.point,c.point)})};return function(e,t){n.has(e)||r(e),n.has(t)||r(t);var i=n.get(e),o=i.sine,a=i.cosine,s=n.get(t),u=s.sine,c=s.cosine;return o>=0&&u>=0?a<c?1:a>c?-1:0:o<0&&u<0?a<c?-1:a>c?1:0:u<o?-1:u>o?1:0}}}]),t}(),w=0,T=function(){function t(n,r,i,o){e(this,t),this.id=++w,this.leftSE=n,n.segment=this,n.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=n,this.rings=i,this.windings=o}return n(t,null,[{key:"compare",value:function(e,t){var n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,o=t.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var a=e.leftSE.point.y,s=t.leftSE.point.y,u=e.rightSE.point.y,c=t.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;var l=e.comparePoint(t.leftSE.point);if(l<0)return 1;if(l>0)return-1;var h=t.comparePoint(e.rightSE.point);return 0!==h?h:-1}if(n>r){if(a<s&&a<c)return-1;if(a>s&&a>c)return 1;var f=t.comparePoint(e.leftSE.point);if(0!==f)return f;var p=e.comparePoint(t.rightSE.point);return p<0?1:p>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){var d=t.comparePoint(e.rightSE.point);if(0!==d)return d}if(i>o){var v=e.comparePoint(t.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(i!==o){var g=u-a,m=i-n,y=c-s,_=o-r;if(g>m&&y<_)return 1;if(g<m&&y>_)return-1}return i>o?1:i<o||u<c?-1:u>c?1:e.id<t.id?-1:e.id>t.id?1:0}}]),n(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;var i=(e.y-t.y)/r.y,o=t.x+i*r.x;if(e.x===o)return 0;var a=(e.x-t.x)/r.x,s=t.y+a*r.y;return e.y===s?0:e.y<s?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),n=e.bbox(),r=l(t,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,s=e.rightSE.point,u=c(t,a)&&0===this.comparePoint(a),h=c(n,i)&&0===e.comparePoint(i),f=c(t,s)&&0===this.comparePoint(s),p=c(n,o)&&0===e.comparePoint(o);if(h&&u)return p&&!f?o:!p&&f?s:null;if(h)return f&&i.x===s.x&&i.y===s.y?null:i;if(u)return p&&o.x===a.x&&o.y===a.y?null:a;if(p&&f)return null;if(p)return o;if(f)return s;var d=function(e,t,n,r){if(0===t.x)return E(n,r,e.x);if(0===r.x)return E(e,t,n.x);if(0===t.y)return S(n,r,e.y);if(0===r.y)return S(e,t,n.y);var i=m(t,r);if(0==i)return null;var o={x:n.x-e.x,y:n.y-e.y},a=m(o,t)/i,s=m(o,r)/i;return{x:(e.x+s*t.x+(n.x+a*r.x))/2,y:(e.y+s*t.y+(n.y+a*r.y))/2}}(i,this.vector(),a,e.vector());return null===d?null:c(r,d)?g.round(d.x,d.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,i=new A(e,!0),o=new A(e,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var s=new t(i,a,this.rings.slice(),this.windings.slice());return A.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),A.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var a=n;n=r,r=a}for(var s=0,u=r.rings.length;s<u;s++){var c=r.rings[s],l=r.windings[s],h=n.rings.indexOf(c);-1===h?(n.rings.push(c),n.windings.push(l)):n.windings[h]+=l}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var a=this.rings[i],s=this.windings[i],u=t.indexOf(a);-1===u?(t.push(a),n.push(s)):n[u]+=s}for(var c=[],l=[],h=0,f=t.length;h<f;h++)if(0!==n[h]){var p=t[h],d=p.poly;if(-1===l.indexOf(d))if(p.isExterior)c.push(d);else{-1===l.indexOf(d)&&l.push(d);var v=c.indexOf(p.poly);-1!==v&&c.splice(v,1)}}for(var g=0,m=c.length;g<m;g++){var y=c[g].multiPoly;-1===r.indexOf(y)&&r.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(D.type){case"union":var n=0===e.length,r=0===t.length;this._isInResult=n!==r;break;case"intersection":var i,o;e.length<t.length?(i=e.length,o=t.length):(i=t.length,o=e.length),this._isInResult=o===D.numMultiPolys&&i<o;break;case"xor":var a=Math.abs(e.length-t.length);this._isInResult=a%2==1;break;case"difference":var s=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=s(e)!==s(t);break;default:throw new Error("Unrecognized operation type found ".concat(D.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,o,a,s=A.comparePoints(e,n);if(s<0)i=e,o=n,a=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=n,o=e,a=-1}return new t(new A(i,!0),new A(o,!1),[r],[a])}}]),t}(),C=function(){function t(n,r,i){if(e(this,t),!Array.isArray(n)||0===n.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],"number"!=typeof n[0][0]||"number"!=typeof n[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=g.round(n[0][0],n[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var a=o,s=1,u=n.length;s<u;s++){if("number"!=typeof n[s][0]||"number"!=typeof n[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var c=g.round(n[s][0],n[s][1]);c.x===a.x&&c.y===a.y||(this.segments.push(T.fromRing(a,c,this)),c.x<this.bbox.ll.x&&(this.bbox.ll.x=c.x),c.y<this.bbox.ll.y&&(this.bbox.ll.y=c.y),c.x>this.bbox.ur.x&&(this.bbox.ur.x=c.x),c.y>this.bbox.ur.y&&(this.bbox.ur.y=c.y),a=c)}o.x===a.x&&o.y===a.y||this.segments.push(T.fromRing(a,o,this))}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.segments.length;t<n;t++){var r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}]),t}(),k=function(){function t(n,r){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new C(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,o=n.length;i<o;i++){var a=new C(n[i],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=r}return n(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,n=this.interiorRings.length;t<n;t++)for(var r=this.interiorRings[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),t}(),M=function(){function t(n,r){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof n[0][0][0]&&(n=[n])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,o=n.length;i<o;i++){var a=new k(n[i],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=r}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++)for(var r=this.polys[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),t}(),P=function(){function t(n){e(this,t),this.events=n;for(var r=0,i=n.length;r<i;r++)n[r].segment.ringOut=this;this.poly=null}return n(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult()&&!o.ringOut){for(var a=null,s=o.leftSE,u=o.rightSE,c=[s],l=s.point,h=[];a=s,s=u,c.push(s),s.point!==l;)for(;;){var f=s.getAvailableLinkedEvents();if(0===f.length){var p=c[0].point,d=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===f.length){u=f[0].otherSE;break}for(var v=null,g=0,m=h.length;g<m;g++)if(h[g].point===s.point){v=g;break}if(null===v){h.push({index:c.length,point:s.point});var y=s.getLeftmostComparator(a);u=f.sort(y)[0].otherSE;break}var _=h.splice(v)[0],b=c.splice(_.index);b.unshift(b[0].otherSE),n.push(new t(b.reverse()))}n.push(new t(c))}}return n}}]),n(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==_(i,e,o)&&(t.push(i),e=i)}if(1===t.length)return null;var a=t[0],s=t[1];0===_(a,e,s)&&t.shift(),t.push(t[0]);for(var u=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:t.length-1,l=this.isExteriorRing()?t.length:-1,h=[],f=c;f!=l;f+=u)h.push([t[f].x,t[f].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,n=this.events.length;t<n;t++){var r=this.events[t];A.compare(e,r)>0&&(e=r)}for(var i=e.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),t}(),I=function(){function t(n){e(this,t),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,n=this.interiorRings.length;t<n;t++){var r=this.interiorRings[t].getGeom();null!==r&&e.push(r)}return e}}]),t}(),L=function(){function t(n){e(this,t),this.rings=n,this.polys=this._composePolys(n)}return n(t,[{key:"getGeom",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++){var r=this.polys[t].getGeom();null!==r&&e.push(r)}return e}},{key:"_composePolys",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];if(!i.poly)if(i.isExteriorRing())t.push(new I(i));else{var o=i.enclosingRing();o.poly||t.push(new I(o)),o.poly.addInterior(i)}}return t}}]),t}(),O=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.compare;e(this,t),this.queue=n,this.tree=new u(r),this.segments=[]}return n(t,[{key:"process",value:function(e){var t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;var r=e.isLeft?this.tree.insert(t):this.tree.find(t);if(!r)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,a=void 0,s=void 0;void 0===a;)null===(i=this.tree.prev(i))?a=null:void 0===i.key.consumedBy&&(a=i.key);for(;void 0===s;)null===(o=this.tree.next(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);if(e.isLeft){var u=null;if(a){var c=a.getIntersection(t);if(null!==c&&(t.isAnEndpoint(c)||(u=c),!a.isAnEndpoint(c)))for(var l=this._splitSafely(a,c),h=0,f=l.length;h<f;h++)n.push(l[h])}var p=null;if(s){var d=s.getIntersection(t);if(null!==d&&(t.isAnEndpoint(d)||(p=d),!s.isAnEndpoint(d)))for(var v=this._splitSafely(s,d),g=0,m=v.length;g<m;g++)n.push(v[g])}if(null!==u||null!==p){var y=null;y=null===u?p:null===p||A.comparePoints(u,p)<=0?u:p,this.queue.remove(t.rightSE),n.push(t.rightSE);for(var _=t.split(y),b=0,x=_.length;b<x;b++)n.push(_[b])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&s){var S=a.getIntersection(s);if(null!==S){if(!a.isAnEndpoint(S))for(var E=this._splitSafely(a,S),w=0,T=E.length;w<T;w++)n.push(E[w]);if(!s.isAnEndpoint(S))for(var C=this._splitSafely(s,S),k=0,M=C.length;k<M;k++)n.push(C[k])}}this.tree.remove(t)}return n}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var n=e.rightSE;this.queue.remove(n);var r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.insert(e),r}}]),t}(),R="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,N="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,D=new(function(){function t(){e(this,t)}return n(t,[{key:"run",value:function(e,t,n){D.type=e,g.reset();for(var r=[new M(t,!0)],i=0,o=n.length;i<o;i++)r.push(new M(n[i],!1));if(D.numMultiPolys=r.length,"difference"===D.type)for(var a=r[0],s=1;s<r.length;)null!==l(r[s].bbox,a.bbox)?s++:r.splice(s,1);if("intersection"===D.type)for(var c=0,h=r.length;c<h;c++)for(var f=r[c],p=c+1,d=r.length;p<d;p++)if(null===l(f.bbox,r[p].bbox))return[];for(var v=new u(A.compare),m=0,y=r.length;m<y;m++)for(var _=r[m].getSweepEvents(),b=0,x=_.length;b<x;b++)if(v.insert(_[b]),v.size>R)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var S=new O(v),E=v.size,w=v.pop();w;){var T=w.key;if(v.size===E){var C=T.segment;throw new Error("Unable to pop() ".concat(T.isLeft?"left":"right"," SweepEvent ")+"[".concat(T.point.x,", ").concat(T.point.y,"] from segment #").concat(C.id," ")+"[".concat(C.leftSE.point.x,", ").concat(C.leftSE.point.y,"] -> ")+"[".concat(C.rightSE.point.x,", ").concat(C.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(v.size>R)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(S.segments.length>N)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var k=S.process(T),I=0,F=k.length;I<F;I++){var B=k[I];void 0===B.consumedBy&&v.insert(B)}E=v.size,w=v.pop()}g.reset();var z=P.factory(S.segments);return new L(z).getGeom()}}]),t}());return{union:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return D.run("union",e,n)},intersection:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return D.run("intersection",e,n)},xor:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return D.run("xor",e,n)},difference:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return D.run("difference",e,n)}}}()}));function jq(e,t,n){void 0===n&&(n={});var r=xr(e),i=xr(t),o=Uq.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?gr(o[0],n.properties):function(e,t,n){return void 0===n&&(n={}),vr({type:"MultiPolygon",coordinates:e},t,n)}(o,n.properties)}var Vq=function(){function e(){b(this,e)}return S(e,[{key:"getCombineFeature",value:function(e){var t=null,n=e[0];return e.map((function(e){var n=gr(e.coordinates);t=null===t?n:jq(t,n)})),n&&(t.properties=v({},n)),t}}]),e}(),Gq=function(){function e(t){var n=t.layerService,r=t.tileLayerService,i=t.parent;b(this,e),E(this,"layerService",void 0),E(this,"tileLayerService",void 0),E(this,"tileSourceService",void 0),E(this,"parent",void 0),E(this,"tilePickID",new Map),this.layerService=n,this.tileLayerService=r,this.parent=i,this.tileSourceService=new Vq}return S(e,[{key:"pickRender",value:function(e){var t=this.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(t){var n=t.getMainLayer();null==n||n.layerPickService.pickRender(e)}}},{key:"pick",value:function(e,t){var n=this.parent.getContainer().get(AT.IPickingService);if("RasterLayer"===e.type){var r=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(r&&void 0!==r.getMainLayer()){var i=r.getMainLayer();return i.layerPickService.pickRasterLayer(i,t,this.parent)}return!1}return this.pickRender(t),n.pickFromPickingFBO(e,t)}},{key:"selectFeature",value:function(e){var t=D(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set("select",o),this.updateHighLight(n,r,i,"select")}},{key:"highlightPickedFeature",value:function(e){var t=D(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set("active",o),this.updateHighLight(n,r,i,"active")}},{key:"updateHighLight",value:function(e,t,n,r){this.tileLayerService.tiles.map((function(i){var o=i.getMainLayer();switch(r){case"select":null==o||o.hooks.beforeSelect.call([e,t,n]);break;case"active":null==o||o.hooks.beforeHighlight.call([e,t,n])}}))}},{key:"setPickState",value:function(){var e=this.tilePickID.get("select"),t=this.tilePickID.get("active");if(e){var n=D(this.pickId2Color(e),3),r=n[0],i=n[1],o=n[2];this.updateHighLight(r,i,o,"select")}else if(t){var a=D(this.pickId2Color(t),3),s=a[0],u=a[1],c=a[2];this.updateHighLight(s,u,c,"active")}else;}},{key:"color2PickId",value:function(e,t,n){return Ov(new Uint8Array([e,t,n]))}},{key:"pickId2Color",value:function(e){return Rv(e)}},{key:"getFeatureById",value:function(e){var t=this.tileLayerService.getTiles().filter((function(e){return e.visible})),n=[];return t.forEach((function(t){n.push.apply(n,F(t.getFeatureById(e)))})),n}},{key:"pickRasterLayer",value:function(e,t,n){return!1}}]),e}(),Hq=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"];function Wq(e){return"PolygonLayer"===e?PW:"LineLayer"===e?JH:wW}function Yq(e){return-1!==["PolygonLayer","LineLayer"].indexOf(e)}var Xq=function(){function e(t,n){b(this,e),E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),E(this,"key",void 0),E(this,"parent",void 0),E(this,"sourceTile",void 0),E(this,"visible",!0),E(this,"layers",[]),E(this,"isLoaded",!1),E(this,"tileMaskLayers",[]),E(this,"tileMask",void 0),this.parent=n,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}var t,n,r;return S(e,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(e){var t=D(this.sourceTile.bounds,4),n=t[0],r=t[1],i=t[2],o=t[3],a=e.lng,s=e.lat;return a>=n&&a<=i&&s>=r&&s<=o}},{key:"getLayerOptions",value:function(){var e,t=this.parent.getLayerConfig();return v(v({},t),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:Yq(this.parent.type),mask:t.mask||0!==(null===(e=t.maskLayers)||void 0===e?void 0:e.length)&&t.enableMask})}},{key:"getMaskLayer",value:function(){var e=this,t=this.parent.getLayerConfig().maskLayers,n=[];return null==t||t.forEach((function(t){if(!t.tileLayer)return n.push(t),t;var r=t.tileLayer.getTile(e.sourceTile.key),i=null==r?void 0:r.getLayers()[0];i&&n.push(i)})),n}},{key:"addTileMask",value:(r=_(g().mark((function e(){var t,n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new PW({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill"),n=ID(this.parent.sceneContainer),t.setContainer(n,this.parent.sceneContainer),e.next=5,t.init();case 5:return this.tileMask=t,void 0!==(r=this.getMainLayer())&&(r.tileMask=t),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"addMask",value:(n=_(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ID(this.parent.sceneContainer),n.setContainer(r,this.parent.sceneContainer),e.next=4,n.init();case 4:t.addMask(n),this.tileMaskLayers.push(n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"addLayer",value:(t=_(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isTileLayer=!0,n=ID(this.parent.sceneContainer),t.setContainer(n,this.parent.sceneContainer),this.layers.push(t),e.next=6,t.init();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateVisible",value:function(e){this.visible=e,this.updateOptions("visible",e)}},{key:"updateOptions",value:function(e,t){this.layers.forEach((function(n){n.updateLayerConfig(E({},e,t))}))}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(e){return[]}},{key:"getFeatureById",value:function(e){return[]}},{key:"destroy",value:function(){var e;null===(e=this.tileMask)||void 0===e||e.destroy(),this.layers.forEach((function(e){return e.destroy()}))}}]),e}(),Zq=function(e){A(r,e);var t,n=O(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"initTileLayer",value:(t=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSourceOption(),n=t.data.features[0].properties,r=(new JH).source(t.data,t.options).size(1).shape("line").color("red"),i=new wW({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),e.next=6,this.addLayer(r);case 6:return e.next=8,this.addLayer(i);case 8:this.isLoaded=!0;case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:e.transforms}}}}]),r}(Xq),qq=function(e){A(r,e);var t,n=O(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"initTileLayer",value:(t=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new LH(v({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),r}(Xq),Kq=function(e){A(r,e);var t,n=O(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"initTileLayer",value:(t=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new GW(v({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getFeatures",value:function(e){return e?this.sourceTile.data.getTileData(e):[]}},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=t.featureId;return{data:{type:"FeatureCollection",features:this.getFeatures(n)},options:{parser:{type:"geojson",featureId:r},transforms:e.transforms}}}}]),r}(Xq),Qq=["rasterData"],$q=function(e){A(r,e);var t,n=O(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"initTileLayer",value:(t=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new DW(v({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=P(t,Qq);return{data:n,options:{parser:v({type:"rasterRgb",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}}]),r}(Xq),Jq=function(e){A(r,e);var t,n=O(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"initTileLayer",value:(t=_(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new DW(v({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),r}(Xq),eK=["rasterData"],tK={positions:[0,1],colors:["#000","#fff"]},nK=function(e){A(r,e);var t,n=O(r);function r(){var e;b(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return E(I(e=n.call.apply(n,[this].concat(i))),"colorTexture",void 0),e}return S(r,[{key:"initTileLayer",value:(t=_(g().mark((function e(){var t,n,r,i,o,a,s;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=this.getLayerOptions(),o=i.rampColors,a=i.domain,this.colorTexture=this.parent.textureService.getColorTexture(o,a),s=new DW(v(v({},n),{},{colorTexture:this.colorTexture})).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;s[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=9,this.addLayer(s);case 9:this.isLoaded=!0;case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=P(t,eK);return{data:n,options:{parser:v({type:"raster",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}},{key:"styleUpdate",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n,o=i.rampColors,a=void 0===o?tK:o,s=i.domain;this.colorTexture=this.parent.textureService.getColorTexture(a,s||jv(a)),this.layers.forEach((function(t){return t.style({colorTexture:e.colorTexture})}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){return e.destroy()}))}}]),r}(Xq),rK=function(e){A(r,e);var t,n=O(r);function r(){return b(this,r),n.apply(this,arguments)}return S(r,[{key:"initTileLayer",value:(t=_(g().mark((function e(){var t,n,r,i,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=Wq(this.parent.type),i=this.getSourceOption()){e.next=7;break}return this.isLoaded=!0,e.abrupt("return");case 7:return o=new r(v({},n)).source(i.data,i.options),Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=11,this.addLayer(o);case 11:if(!n.tileMask){e.next=14;break}return e.next=14,this.addTileMask();case 14:this.setLayerMinMaxZoom(o),this.isLoaded=!0;case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=void 0===n?"defaultLayer":n,i=t.featureId,o=void 0===i?"id":i;return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:o},transforms:e.transforms}}}},{key:"setLayerMinMaxZoom",value:function(e){"text"===e.getModelType()&&e.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(e){return this.sourceTile.data.getTileData(e)}},{key:"getFeatureById",value:function(e){var t=this.getMainLayer();return t?t.getSource().data.dataArray.filter((function(t){return t._id===e})):[]}}]),r}(Xq);function iK(e){switch(e.type){case"PolygonLayer":case"LineLayer":case"PointLayer":return rK;case"TileDebugLayer":return Zq;case"MaskLayer":return Kq;case"RasterLayer":switch(e.getSource().parser.dataType){case HD.RGB:case HD.CUSTOMRGB:return $q;case HD.ARRAYBUFFER:case HD.CUSTOMARRAYBUFFER:return nK;case HD.TERRAINRGB:case HD.CUSTOMTERRAINRGB:return Jq;default:return qq}default:return rK}}var oK,aK,sK,uK=function(){function e(t){var n=this;b(this,e),E(this,"parent",void 0),E(this,"tileLayerService",void 0),E(this,"mapService",void 0),E(this,"layerService",void 0),E(this,"rendererService",void 0),E(this,"pickingService",void 0),E(this,"tilePickService",void 0),E(this,"tilesetManager",void 0),E(this,"initedTileset",!1),E(this,"lastViewStates",void 0),E(this,"mapchange",(function(){var e,t=n.getCurrentView(),r=t.latLonBounds,i=t.zoom;if("GAODE1.x"===n.mapService.version){var o=n.parent.getLayerConfig().visible;i<2&&o?(n.parent.updateLayerConfig({visible:!1}),n.layerService.reRender()):i>=2&&!o&&(n.parent.updateLayerConfig({visible:!0}),n.layerService.reRender())}n.lastViewStates&&n.lastViewStates.zoom===i&&n.lastViewStates.latLonBounds.toString()===r.toString()||(n.lastViewStates={zoom:i,latLonBounds:r},null===(e=n.tilesetManager)||void 0===e||e.throttleUpdate(i,r))})),E(this,"viewchange",kb(this.mapchange,24)),this.parent=t;var r=this.parent.getContainer();this.rendererService=r.get(AT.IRendererService),this.layerService=r.get(AT.ILayerService),this.mapService=r.get(AT.IMapService),this.pickingService=r.get(AT.IPickingService),this.tileLayerService=new zq({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new Gq({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}var t;return S(e,[{key:"initTileSetManager",value:function(){var e,t=this.parent.getSource();this.tilesetManager=t.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(i,r)}},{key:"getCurrentView",value:function(){var e=this.mapService.getBounds();return{latLonBounds:[e[0][0],e[0][1],e[1][0],e[1][1]],zoom:this.mapService.getZoom()}}},{key:"bindTilesetEvent",value:function(){var e=this;this.tilesetManager.on("tile-loaded",(function(e){})),this.tilesetManager.on("tile-unload",(function(t){e.tileUnLoad(t)})),this.tilesetManager.on("tile-error",(function(t,n){e.tileError(t)})),this.tilesetManager.on("tile-update",(function(){e.tileUpdate()})),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(e){return this.tileLayerService.getTile(e)}},{key:"tileLoaded",value:function(e){}},{key:"tileError",value:function(e){console.warn("error:",e)}},{key:"destroy",value:function(){var e;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(e=this.tilesetManager)||void 0===e||e.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var e;this.tilesetManager.clear();var t=this.getCurrentView(),n=t.latLonBounds,r=t.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(r,n)}},{key:"tileUnLoad",value:function(e){this.tileLayerService.removeTile(e.key)}},{key:"tileUpdate",value:(t=_(g().mark((function e(){var t,n,r=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tilesetManager){e.next=2;break}return e.abrupt("return");case 2:return t=this.parent.getMinZoom(),n=this.parent.getMaxZoom(),e.next=6,Promise.all(this.tilesetManager.tiles.filter((function(e){return e.isLoaded})).filter((function(e){return e.isVisibleChange})).filter((function(e){return e.data})).filter((function(e){return e.z>=t&&e.z<n})).map(function(){var e=_(g().mark((function e(t){var n,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.tileLayerService.hasTile(t.key)){e.next=9;break}return n=iK(r.parent),i=new n(t,r.parent),e.next=5,i.initTileLayer();case 5:r.tilePickService.setPickState(),0!==i.getLayers().length&&(r.tileLayerService.addTile(i),r.tileLayerService.updateTileVisible(t),r.layerService.reRender()),e.next=12;break;case 9:r.tileLayerService.updateTileVisible(t),r.tilePickService.setPickState(),r.layerService.reRender();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setPickState",value:function(e){}},{key:"pickRender",value:function(e){this.tilePickService.pickRender(e)}},{key:"selectFeature",value:function(e){this.tilePickService.selectFeature(e)}},{key:"highlightPickedFeature",value:function(e){this.tilePickService.highlightPickedFeature(e)}},{key:"proxy",value:function(e){var t=this;Hq.forEach((function(n){var r=e[n].bind(e);e[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r.apply(void 0,o),t.getLayers().map((function(e){e[n].apply(e,o)})),"style"===n&&t.getTiles().forEach((function(e){return e.styleUpdate.apply(e,o)})),e}}))}}]),e}(),cK=vw()(oK=function(){function e(){b(this,e)}var t,n,r;return S(e,[{key:"build",value:(r=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.prepareBuildModel(),e.next=3,t.buildModels();case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initLayerModel",value:(n=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"prepareLayerModel",value:(t=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"apply",value:function(e){var t=this;e.hooks.init.tapPromise("LayerModelPlugin",_(g().mark((function n(){return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.getSource().isTile){n.next=4;break}return e.prepareBuildModel(),e.tileLayer=new uK(e),n.abrupt("return");case 4:return e.log(BD.BuildModelStart,sI.INIT),n.next=7,t.initLayerModel(e);case 7:e.log(BD.BuildModelEnd,sI.INIT);case 8:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=_(g().mark((function n(r){return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return",!1);case 2:if(!e.getSource().isTile){n.next=5;break}return e.tileLayer=new uK(e),n.abrupt("return",!1);case 5:return e.log(BD.BuildModelStart,sI.UPDATE),n.next=8,t.prepareLayerModel(e);case 8:return e.log(BD.BuildModelEnd,sI.UPDATE),n.abrupt("return",!0);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}]),e}())||oK,lK=vw()(aK=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&e.fitBounds(r),e.styleNeedUpdate=!1}))}}]),e}())||aK,hK=["type"],fK={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},pK={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},dK={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},vK={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var gK,mK,yK,_K=vw()(sK=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){e.getLayerConfig().enableLighting&&e.models.forEach((function(e){return e.addUniforms(v({},(n={u_DirectionalLights:new Array(3).fill(v({},dK)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(v({},vK)),u_NumOfSpotLights:0},t&&t.length||(t=[pK]),t.forEach((function(e){var t=e.type,r=void 0===t?"directional":t,i=P(e,hK),o=fK[r].lights,a=fK[r].num,s=n[a];n[o][s]=v(v({},n[o][s]),i),n[a]++})),n)));var t,n}))}))}}]),e}())||sK,bK=vw()(gK=function(){function e(){b(this,e),E(this,"enabled",void 0)}return S(e,[{key:"apply",value:function(e,t){var n=this,r=t.rendererService,i=t.postProcessingPassFactory,o=t.normalPassFactory;e.hooks.init.tapPromise("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),r=t.enableMultiPassRenderer,a=t.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=nG(e,s,i,o),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var t=r.getViewportSize(),i=t.width,o=t.height;e.multiPassRenderer.resize(i,o)}}))}}]),e}())||gK,xK=1,SK=2,EK=vw()(mK=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e,t){var n=t.styleAttributeService;e.hooks.init.tapPromise("PixelPickingPlugin",(function(){var t=e.getLayerConfig().enablePicking;n.registerStyleAttribute({name:"pickingColor",type:jD.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:fL.FLOAT},size:3,update:function(e){var n=e.id;return t?Rv(n):[0,0,0]}}})})),e.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&e.models.forEach((function(e){return e.addUniforms({u_PickingStage:xK})}))})),e.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&e.models.forEach((function(e){return e.addUniforms({u_PickingStage:SK})}))})),e.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(t){var n=e.getLayerConfig(),r=n.highlightColor,i=n.activeMix,o=void 0===i?0:i,a="string"==typeof r?Lv(r):r||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:Ov(new Uint8Array(t))}),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:SK,u_PickingColor:t,u_HighlightColor:a.map((function(e){return 255*e})),u_activeMix:o})}))})),e.hooks.beforeSelect.tap("PixelPickingPlugin",(function(t){var n=e.getLayerConfig(),r=n.selectColor,i=n.selectMix,o=void 0===i?0:i,a="string"==typeof r?Lv(r):r||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:Ov(new Uint8Array(t))}),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:SK,u_PickingColor:t,u_HighlightColor:a.map((function(e){return 255*e})),u_activeMix:o,u_CurrentSelectedId:t,u_SelectColor:a.map((function(e){return 255*e})),u_EnableSelect:1})}))}))}}]),e}())||mK,AK=["mvt","geojsonvt","testTile"];var wK,TK,CK,kK,MK,PK,IK,LK,OK,RK,NK,DK,FK,BK=vw()(yK=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("RegisterStyleAttributePlugin",(function(){(function(e){var t=e.getSource();return AK.includes(t.parser.type)})(e)||n.registerBuiltinAttributes(r,e)}))}},{key:"registerBuiltinAttributes",value:function(e,t){"MaskLayer"!==t.type?(this.registerPositionAttribute(e),this.registerColorAttribute(e),this.registerVertexIdAttribute(e)):this.registerPositionAttribute(e)}},{key:"registerPositionAttribute",value:function(e){e.registerStyleAttribute({name:"position",type:jD.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:fL.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerFilterAttribute",value:function(e){e.registerStyleAttribute({name:"filter",type:jD.Attribute,descriptor:{name:"filter",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e){return e.filter?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(e){e.registerStyleAttribute({name:"color",type:jD.Attribute,descriptor:{name:"a_Color",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:4,update:function(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(e){e.registerStyleAttribute({name:"vertexId",type:jD.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:fL.DYNAMIC_DRAW,data:[],type:fL.FLOAT},size:1,update:function(e,t){return[t]}}})}}]),e}())||yK,zK=(wK=vw(),TK=dw(AT.ICameraService),CK=dw(AT.ICoordinateSystemService),kK=dw(AT.IRendererService),MK=dw(AT.IMapService),wK((LK=G((IK=function(){function e(){b(this,e),V(this,"cameraService",LK,this),V(this,"coordinateSystemService",OK,this),V(this,"rendererService",RK,this),V(this,"mapService",NK,this)}return S(e,[{key:"apply",value:function(e){var t=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[0,0];e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var o=e.getLayerConfig().tileOrigin;t.coordinateSystemService.refresh(o),"GAODE2.x"===n&&(t.setLayerCenter(e),r=t.mapService.map.customCoords.getMVPMatrix(),i=t.mapService.getCustomCoordCenter());var a=t.rendererService.getViewportSize(),s=a.width,u=a.height;e.models.forEach((function(n){var o;n.addUniforms((E(o={},FD.ProjectionMatrix,t.cameraService.getProjectionMatrix()),E(o,FD.ViewMatrix,t.cameraService.getViewMatrix()),E(o,FD.ViewProjectionMatrix,t.cameraService.getViewProjectionMatrix()),E(o,FD.Zoom,t.cameraService.getZoom()),E(o,FD.ZoomScale,t.cameraService.getZoomScale()),E(o,FD.FocalDistance,t.cameraService.getFocalDistance()),E(o,FD.CameraPosition,t.cameraService.getCameraPosition()),E(o,RI.CoordinateSystem,t.coordinateSystemService.getCoordinateSystem()),E(o,RI.ViewportCenter,t.coordinateSystemService.getViewportCenter()),E(o,RI.ViewportCenterProjection,t.coordinateSystemService.getViewportCenterProjection()),E(o,RI.PixelsPerDegree,t.coordinateSystemService.getPixelsPerDegree()),E(o,RI.PixelsPerDegree2,t.coordinateSystemService.getPixelsPerDegree2()),E(o,RI.PixelsPerMeter,t.coordinateSystemService.getPixelsPerMeter()),E(o,RI.Mvp,r),E(o,"u_sceneCenterMercator",i),E(o,"u_ViewportSize",[s,u]),E(o,"u_ModelMatrix",t.cameraService.getModelMatrix()),E(o,"u_DevicePixelRatio",Ud.devicePixelRatio),E(o,"u_PickingBuffer",e.getLayerConfig().pickingBuffer||0),E(o,"u_shaderPick",Number(e.getShaderPickStat())),o))}))}))}},{key:"setLayerCenter",value:function(e){void 0===e.coordCenter&&(e.coordCenter=e.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(e.coordCenter)}}]),e}()).prototype,"cameraService",[TK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OK=G(IK.prototype,"coordinateSystemService",[CK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RK=G(IK.prototype,"rendererService",[kK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NK=G(IK.prototype,"mapService",[MK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PK=IK))||PK),UK=vw()(DK=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate().then((function(t){t&&e.renderLayers()}))})),e.hooks.afterRender.tap("UpdateModelPlugin",(function(){e.layerModelNeedUpdate=!1}))}}]),e}())||DK,jK=vw()(FK=function(){function e(){b(this,e)}return S(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){e.layerModelNeedUpdate||e.inited&&n.updateStyleAttribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void r.forEach((function(e){return e.needRegenerateVertices=!1}));r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex,e),t.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(e,t){var n=t.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}}]),e}())||FK;TD.bind(AT.ILayerPlugin).to(hY).inRequestScope(),TD.bind(AT.ILayerPlugin).to(BK).inRequestScope(),TD.bind(AT.ILayerPlugin).to(Dq).inRequestScope(),TD.bind(AT.ILayerPlugin).to(lY).inRequestScope(),TD.bind(AT.ILayerPlugin).to(lK).inRequestScope(),TD.bind(AT.ILayerPlugin).to(Bq).inRequestScope(),TD.bind(AT.ILayerPlugin).to(jK).inRequestScope(),TD.bind(AT.ILayerPlugin).to(UK).inRequestScope(),TD.bind(AT.ILayerPlugin).to(bK).inRequestScope(),TD.bind(AT.ILayerPlugin).to(zK).inRequestScope(),TD.bind(AT.ILayerPlugin).to(Fq).inRequestScope(),TD.bind(AT.ILayerPlugin).to(_K).inRequestScope(),TD.bind(AT.ILayerPlugin).to(EK).inRequestScope(),TD.bind(AT.ILayerPlugin).to(cK).inRequestScope();var VK={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},GK="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",HK={5:GK,"5module":GK+" export import",6:GK+" const class extends export import super"},WK=/^in(stanceof)?$/,YK="ÂªÂµÂºÃ-ÃÃ-Ã¶Ã¸-ËË-ËË -Ë¤Ë¬Ë®Í°-Í´Í¶Í·Íº-Í½Í¿ÎÎ-ÎÎÎ-Î¡Î£-ÏµÏ·-ÒÒ-Ô¯Ô±-ÕÕÕ -Ö×-×ª×¯-×²Ø -ÙÙ®Ù¯Ù±-ÛÛÛ¥Û¦Û®Û¯Ûº-Û¼Û¿ÜÜ-Ü¯Ý-Þ¥Þ±ß-ßªß´ßµßºà -à à à ¤à ¨à¡-à¡à¡ -à¡ªà¢ -à¢´à¢¶-à£à¤-à¤¹à¤½à¥à¥-à¥¡à¥±-à¦à¦-à¦à¦à¦à¦-à¦¨à¦ª-à¦°à¦²à¦¶-à¦¹à¦½à§à§à§à§-à§¡à§°à§±à§¼à¨-à¨à¨à¨à¨-à¨¨à¨ª-à¨°à¨²à¨³à¨µà¨¶à¨¸à¨¹à©-à©à©à©²-à©´àª-àªàª-àªàª-àª¨àªª-àª°àª²àª³àªµ-àª¹àª½à«à« à«¡à«¹à¬-à¬à¬à¬à¬-à¬¨à¬ª-à¬°à¬²à¬³à¬µ-à¬¹à¬½à­à­à­-à­¡à­±à®à®-à®à®-à®à®-à®à®à®à®à®à®à®£à®¤à®¨-à®ªà®®-à®¹à¯à°-à°à°-à°à°-à°¨à°ª-à°¹à°½à±-à±à± à±¡à²à²-à²à²-à²à²-à²¨à²ª-à²³à²µ-à²¹à²½à³à³ à³¡à³±à³²à´-à´à´-à´à´-à´ºà´½àµàµ-àµàµ-àµ¡àµº-àµ¿à¶-à¶à¶-à¶±à¶³-à¶»à¶½à·-à·à¸-à¸°à¸²à¸³à¹-à¹àºàºàºàº-àºàº-àº£àº¥àº§-àº°àº²àº³àº½à»-à»à»à»-à»à¼à½-à½à½-à½¬à¾-à¾á-áªá¿á-áá-áá¡á¥á¦á®-á°áµ-ááá -áááá-áºá¼-áá-áá-ááá-áá -áá-áá-á°á²-áµá¸-á¾áá-áá-áá-áá-áá-áá-áá -áµá¸-á½á-á¬á¯-á¿á-áá -áªá®-á¸á-áá-áá -á±á-áá -á¬á®-á°á-á³ááá  -á¡¸á¢-á¢¨á¢ªá¢°-á£µá¤-á¤á¥-á¥­á¥°-á¥´á¦-á¦«á¦°-á§á¨-á¨á¨ -á©áª§á¬-á¬³á­-á­á®-á® á®®á®¯á®º-á¯¥á°-á°£á±-á±á±-á±½á²-á²á²-á²ºá²½-á²¿á³©-á³¬á³®-á³³á³µá³¶á³ºá´-á¶¿á¸-á¼á¼-á¼á¼ -á½á½-á½á½-á½á½á½á½á½-á½½á¾-á¾´á¾¶-á¾¼á¾¾á¿-á¿á¿-á¿á¿-á¿á¿-á¿á¿ -á¿¬á¿²-á¿´á¿¶-á¿¼â±â¿â-ââââ-âââ-ââ¤â¦â¨âª-â¹â¼-â¿â-âââ -ââ°-â°®â°°-â±â± -â³¤â³«-â³®â³²â³³â´-â´¥â´§â´­â´°-âµ§âµ¯â¶-â¶â¶ -â¶¦â¶¨-â¶®â¶°-â¶¶â¶¸-â¶¾â·-â·â·-â·â·-â·â·-â·ã-ãã¡-ã©ã±-ãµã¸-ã¼ã-ãã-ãã¡-ãºã¼-ã¿ã-ã¯ã±-ãã -ã¿ã°-ã¿ã-ä¶¿ä¸-é¿¼ê-êê-ê½ê-êê-êêªê«ê-ê®ê¿-êê -ê¯ê-êê¢-êê-ê¿ê-êêµ-ê ê -ê ê -ê ê -ê ¢ê¡-ê¡³ê¢-ê¢³ê£²-ê£·ê£»ê£½ê£¾ê¤-ê¤¥ê¤°-ê¥ê¥ -ê¥¼ê¦-ê¦²ê§ê§ -ê§¤ê§¦-ê§¯ê§º-ê§¾ê¨-ê¨¨ê©-ê©ê©-ê©ê© -ê©¶ê©ºê©¾-êª¯êª±êªµêª¶êª¹-êª½ê«ê«ê«-ê«ê« -ê«ªê«²-ê«´ê¬-ê¬ê¬-ê¬ê¬-ê¬ê¬ -ê¬¦ê¬¨-ê¬®ê¬°-ê­ê­-ê­©ê­°-ê¯¢ê°-í£í°-íí-í»ï¤-ï©­ï©°-ï«ï¬-ï¬ï¬-ï¬ï¬ï¬-ï¬¨ï¬ª-ï¬¶ï¬¸-ï¬¼ï¬¾ï­ï­ï­ï­ï­-ï®±ï¯-ï´½ïµ-ï¶ï¶-ï·ï·°-ï·»ï¹°-ï¹´ï¹¶-ï»¼ï¼¡-ï¼ºï½-ï½ï½¦-ï¾¾ï¿-ï¿ï¿-ï¿ï¿-ï¿ï¿-ï¿",XK="ââÂ·Ì-Í¯ÎÒ-ÒÖ-Ö½Ö¿×××××Ø-ØÙ-Ù©Ù°Û-ÛÛ-Û¤Û§Û¨Ûª-Û­Û°-Û¹ÜÜ°-ÝÞ¦-Þ°ß-ßß«-ß³ß½à -à à -à £à ¥-à §à ©-à ­à¡-à¡à£-à£¡à££-à¤à¤º-à¤¼à¤¾-à¥à¥-à¥à¥¢à¥£à¥¦-à¥¯à¦-à¦à¦¼à¦¾-à§à§à§à§-à§à§à§¢à§£à§¦-à§¯à§¾à¨-à¨à¨¼à¨¾-à©à©à©à©-à©à©à©¦-à©±à©µàª-àªàª¼àª¾-à«à«-à«à«-à«à«¢à«£à«¦-à«¯à«º-à«¿à¬-à¬à¬¼à¬¾-à­à­à­à­-à­à­-à­à­¢à­£à­¦-à­¯à®à®¾-à¯à¯-à¯à¯-à¯à¯à¯¦-à¯¯à°-à°à°¾-à±à±-à±à±-à±à±à±à±¢à±£à±¦-à±¯à²-à²à²¼à²¾-à³à³-à³à³-à³à³à³à³¢à³£à³¦-à³¯à´-à´à´»à´¼à´¾-àµàµ-àµàµ-àµàµàµ¢àµ£àµ¦-àµ¯à¶-à¶à·à·-à·à·à·-à·à·¦-à·¯à·²à·³à¸±à¸´-à¸ºà¹-à¹à¹-à¹àº±àº´-àº¼à»-à»à»-à»à¼à¼à¼ -à¼©à¼µà¼·à¼¹à¼¾à¼¿à½±-à¾à¾à¾à¾-à¾à¾-à¾¼à¿á«-á¾á-áá-áá-á á¢-á¤á§-á­á±-á´á-áá-áá-áá©-á±á-áá²-á´ááá²á³á´-ááá -á©á -á á -á á¢©á¤ -á¤«á¤°-á¤»á¥-á¥á§-á§á¨-á¨á©-á©á© -á©¼á©¿-áªáª-áªáª°-áª½áª¿á«á¬-á¬á¬´-á­á­-á­á­«-á­³á®-á®á®¡-á®­á®°-á®¹á¯¦-á¯³á°¤-á°·á±-á±á±-á±á³-á³á³-á³¨á³­á³´á³·-á³¹á·-á·¹á·»-á·¿â¿âââ-ââ¡â¥-â°â³¯-â³±âµ¿â· -â·¿ãª-ã¯ããê -ê©ê¯ê´-ê½êêê°ê±ê ê ê ê £-ê §ê ¬ê¢ê¢ê¢´-ê£ê£-ê£ê£ -ê£±ê£¿-ê¤ê¤¦-ê¤­ê¥-ê¥ê¦-ê¦ê¦³-ê§ê§-ê§ê§¥ê§°-ê§¹ê¨©-ê¨¶ê©ê©ê©ê©-ê©ê©»-ê©½êª°êª²-êª´êª·êª¸êª¾êª¿ê«ê««-ê«¯ê«µê«¶ê¯£-ê¯ªê¯¬ê¯­ê¯°-ê¯¹ï¬ï¸-ï¸ï¸ -ï¸¯ï¸³ï¸´ï¹-ï¹ï¼-ï¼ï¼¿",ZK=new RegExp("["+YK+"]"),qK=new RegExp("["+YK+XK+"]");YK=XK=null;var KK=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],QK=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function $K(e,t){for(var n=65536,r=0;r<t.length;r+=2){if((n+=t[r])>e)return!1;if((n+=t[r+1])>=e)return!0}}function JK(e,t){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&ZK.test(String.fromCharCode(e)):!1!==t&&$K(e,KK)))}function eQ(e,t){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&qK.test(String.fromCharCode(e)):!1!==t&&($K(e,KK)||$K(e,QK)))))}var tQ=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function nQ(e,t){return new tQ(e,{beforeExpr:!0,binop:t})}var rQ={beforeExpr:!0},iQ={startsExpr:!0},oQ={};function aQ(e,t){return void 0===t&&(t={}),t.keyword=e,oQ[e]=new tQ(e,t)}var sQ={num:new tQ("num",iQ),regexp:new tQ("regexp",iQ),string:new tQ("string",iQ),name:new tQ("name",iQ),eof:new tQ("eof"),bracketL:new tQ("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new tQ("]"),braceL:new tQ("{",{beforeExpr:!0,startsExpr:!0}),braceR:new tQ("}"),parenL:new tQ("(",{beforeExpr:!0,startsExpr:!0}),parenR:new tQ(")"),comma:new tQ(",",rQ),semi:new tQ(";",rQ),colon:new tQ(":",rQ),dot:new tQ("."),question:new tQ("?",rQ),questionDot:new tQ("?."),arrow:new tQ("=>",rQ),template:new tQ("template"),invalidTemplate:new tQ("invalidTemplate"),ellipsis:new tQ("...",rQ),backQuote:new tQ("`",iQ),dollarBraceL:new tQ("${",{beforeExpr:!0,startsExpr:!0}),eq:new tQ("=",{beforeExpr:!0,isAssign:!0}),assign:new tQ("_=",{beforeExpr:!0,isAssign:!0}),incDec:new tQ("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new tQ("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:nQ("||",1),logicalAND:nQ("&&",2),bitwiseOR:nQ("|",3),bitwiseXOR:nQ("^",4),bitwiseAND:nQ("&",5),equality:nQ("==/!=/===/!==",6),relational:nQ("</>/<=/>=",7),bitShift:nQ("<</>>/>>>",8),plusMin:new tQ("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:nQ("%",10),star:nQ("*",10),slash:nQ("/",10),starstar:new tQ("**",{beforeExpr:!0}),coalesce:nQ("??",1),_break:aQ("break"),_case:aQ("case",rQ),_catch:aQ("catch"),_continue:aQ("continue"),_debugger:aQ("debugger"),_default:aQ("default",rQ),_do:aQ("do",{isLoop:!0,beforeExpr:!0}),_else:aQ("else",rQ),_finally:aQ("finally"),_for:aQ("for",{isLoop:!0}),_function:aQ("function",iQ),_if:aQ("if"),_return:aQ("return",rQ),_switch:aQ("switch"),_throw:aQ("throw",rQ),_try:aQ("try"),_var:aQ("var"),_const:aQ("const"),_while:aQ("while",{isLoop:!0}),_with:aQ("with"),_new:aQ("new",{beforeExpr:!0,startsExpr:!0}),_this:aQ("this",iQ),_super:aQ("super",iQ),_class:aQ("class",iQ),_extends:aQ("extends",rQ),_export:aQ("export"),_import:aQ("import",iQ),_null:aQ("null",iQ),_true:aQ("true",iQ),_false:aQ("false",iQ),_in:aQ("in",{beforeExpr:!0,binop:7}),_instanceof:aQ("instanceof",{beforeExpr:!0,binop:7}),_typeof:aQ("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:aQ("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:aQ("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},uQ=/\r\n?|\n|\u2028|\u2029/,cQ=new RegExp(uQ.source,"g");function lQ(e,t){return 10===e||13===e||!t&&(8232===e||8233===e)}var hQ=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,fQ=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,pQ=Object.prototype,dQ=pQ.hasOwnProperty,vQ=pQ.toString;function gQ(e,t){return dQ.call(e,t)}var mQ=Array.isArray||function(e){return"[object Array]"===vQ.call(e)};function yQ(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var _Q=function(e,t){this.line=e,this.column=t};_Q.prototype.offset=function(e){return new _Q(this.line,this.column+e)};var bQ=function(e,t,n){this.start=t,this.end=n,null!==e.sourceFile&&(this.source=e.sourceFile)};function xQ(e,t){for(var n=1,r=0;;){cQ.lastIndex=r;var i=cQ.exec(e);if(!(i&&i.index<t))return new _Q(n,t-r);++n,r=i.index+i[0].length}}var SQ={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function EQ(e){var t={};for(var n in SQ)t[n]=e&&gQ(e,n)?e[n]:SQ[n];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),mQ(t.onToken)){var r=t.onToken;t.onToken=function(e){return r.push(e)}}return mQ(t.onComment)&&(t.onComment=function(e,t){return function(n,r,i,o,a,s){var u={type:n?"Block":"Line",value:r,start:i,end:o};e.locations&&(u.loc=new bQ(this,a,s)),e.ranges&&(u.range=[i,o]),t.push(u)}}(t,t.onComment)),t}function AQ(e,t){return 2|(e?4:0)|(t?8:0)}var wQ=function(e,t,n){this.options=e=EQ(e),this.sourceFile=e.sourceFile,this.keywords=yQ(HK[e.ecmaVersion>=6?6:"module"===e.sourceType?"5module":5]);var r="";if(!0!==e.allowReserved){for(var i=e.ecmaVersion;!(r=VK[i]);i--);"module"===e.sourceType&&(r+=" await")}this.reservedWords=yQ(r);var o=(r?r+" ":"")+VK.strict;this.reservedWordsStrict=yQ(o),this.reservedWordsStrictBind=yQ(o+" "+VK.strictBind),this.input=String(t),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(uQ).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=sQ.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},TQ={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};wQ.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)},TQ.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},TQ.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},TQ.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},TQ.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},TQ.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},TQ.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},wQ.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},wQ.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var n=this,r=0;r<e.length;r++)n=e[r](n);return n},wQ.parse=function(e,t){return new this(t,e).parse()},wQ.parseExpressionAt=function(e,t,n){var r=new this(n,e,t);return r.nextToken(),r.parseExpression()},wQ.tokenizer=function(e,t){return new this(t,e)},Object.defineProperties(wQ.prototype,TQ);var CQ=wQ.prototype,kQ=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function MQ(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}CQ.strictDirective=function(e){for(;;){fQ.lastIndex=e,e+=fQ.exec(this.input)[0].length;var t=kQ.exec(this.input.slice(e));if(!t)return!1;if("use strict"===(t[1]||t[2])){fQ.lastIndex=e+t[0].length;var n=fQ.exec(this.input),r=n.index+n[0].length,i=this.input.charAt(r);return";"===i||"}"===i||uQ.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(r+1))}e+=t[0].length,fQ.lastIndex=e,e+=fQ.exec(this.input)[0].length,";"===this.input[e]&&e++}},CQ.eat=function(e){return this.type===e&&(this.next(),!0)},CQ.isContextual=function(e){return this.type===sQ.name&&this.value===e&&!this.containsEsc},CQ.eatContextual=function(e){return!!this.isContextual(e)&&(this.next(),!0)},CQ.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},CQ.canInsertSemicolon=function(){return this.type===sQ.eof||this.type===sQ.braceR||uQ.test(this.input.slice(this.lastTokEnd,this.start))},CQ.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},CQ.semicolon=function(){this.eat(sQ.semi)||this.insertSemicolon()||this.unexpected()},CQ.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},CQ.expect=function(e){this.eat(e)||this.unexpected()},CQ.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},CQ.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var n=t?e.parenthesizedAssign:e.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},CQ.checkExpressionErrors=function(e,t){if(!e)return!1;var n=e.shorthandAssign,r=e.doubleProto;if(!t)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},CQ.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},CQ.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var PQ=wQ.prototype;PQ.parseTopLevel=function(e){var t={};for(e.body||(e.body=[]);this.type!==sQ.eof;){var n=this.parseStatement(null,!0,t);e.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var o=i[r];this.raiseRecoverable(this.undefinedExports[o].start,"Export '"+o+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var IQ={kind:"loop"},LQ={kind:"switch"};PQ.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;fQ.lastIndex=this.pos;var t=fQ.exec(this.input),n=this.pos+t[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(e)return!1;if(123===r)return!0;if(JK(r,!0)){for(var i=n+1;eQ(this.input.charCodeAt(i),!0);)++i;var o=this.input.slice(n,i);if(!WK.test(o))return!0}return!1},PQ.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;fQ.lastIndex=this.pos;var e=fQ.exec(this.input),t=this.pos+e[0].length;return!(uQ.test(this.input.slice(this.pos,t))||"function"!==this.input.slice(t,t+8)||t+8!==this.input.length&&eQ(this.input.charAt(t+8)))},PQ.parseStatement=function(e,t,n){var r,i=this.type,o=this.startNode();switch(this.isLet(e)&&(i=sQ._var,r="let"),i){case sQ._break:case sQ._continue:return this.parseBreakContinueStatement(o,i.keyword);case sQ._debugger:return this.parseDebuggerStatement(o);case sQ._do:return this.parseDoStatement(o);case sQ._for:return this.parseForStatement(o);case sQ._function:return e&&(this.strict||"if"!==e&&"label"!==e)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1,!e);case sQ._class:return e&&this.unexpected(),this.parseClass(o,!0);case sQ._if:return this.parseIfStatement(o);case sQ._return:return this.parseReturnStatement(o);case sQ._switch:return this.parseSwitchStatement(o);case sQ._throw:return this.parseThrowStatement(o);case sQ._try:return this.parseTryStatement(o);case sQ._const:case sQ._var:return r=r||this.value,e&&"var"!==r&&this.unexpected(),this.parseVarStatement(o,r);case sQ._while:return this.parseWhileStatement(o);case sQ._with:return this.parseWithStatement(o);case sQ.braceL:return this.parseBlock(!0,o);case sQ.semi:return this.parseEmptyStatement(o);case sQ._export:case sQ._import:if(this.options.ecmaVersion>10&&i===sQ._import){fQ.lastIndex=this.pos;var a=fQ.exec(this.input),s=this.pos+a[0].length,u=this.input.charCodeAt(s);if(40===u||46===u)return this.parseExpressionStatement(o,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===sQ._import?this.parseImport(o):this.parseExport(o,n);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(o,!0,!e);var c=this.value,l=this.parseExpression();return i===sQ.name&&"Identifier"===l.type&&this.eat(sQ.colon)?this.parseLabeledStatement(o,c,l,e):this.parseExpressionStatement(o,l)}},PQ.parseBreakContinueStatement=function(e,t){var n="break"===t;this.next(),this.eat(sQ.semi)||this.insertSemicolon()?e.label=null:this.type!==sQ.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==e.label||i.name===e.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(e.label&&n)break}}return r===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,n?"BreakStatement":"ContinueStatement")},PQ.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},PQ.parseDoStatement=function(e){return this.next(),this.labels.push(IQ),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(sQ._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(sQ.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},PQ.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(IQ),this.enterScope(0),this.expect(sQ.parenL),this.type===sQ.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var n=this.isLet();if(this.type===sQ._var||this.type===sQ._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===sQ._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===sQ._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,r)):(t>-1&&this.unexpected(t),this.parseFor(e,r))}var o=new MQ,a=this.parseExpression(!0,o);return this.type===sQ._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===sQ._in?t>-1&&this.unexpected(t):e.await=t>-1),this.toAssignable(a,!1,o),this.checkLVal(a),this.parseForIn(e,a)):(this.checkExpressionErrors(o,!0),t>-1&&this.unexpected(t),this.parseFor(e,a))},PQ.parseFunctionStatement=function(e,t,n){return this.next(),this.parseFunction(e,RQ|(n?0:NQ),!1,t)},PQ.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(sQ._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},PQ.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(sQ.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},PQ.parseSwitchStatement=function(e){var t;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(sQ.braceL),this.labels.push(LQ),this.enterScope(0);for(var n=!1;this.type!==sQ.braceR;)if(this.type===sQ._case||this.type===sQ._default){var r=this.type===sQ._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),r?t.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,t.test=null),this.expect(sQ.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},PQ.parseThrowStatement=function(e){return this.next(),uQ.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var OQ=[];PQ.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===sQ._catch){var t=this.startNode();if(this.next(),this.eat(sQ.parenL)){t.param=this.parseBindingAtom();var n="Identifier"===t.param.type;this.enterScope(n?32:0),this.checkLVal(t.param,n?4:2),this.expect(sQ.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0);t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(sQ._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},PQ.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},PQ.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(IQ),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},PQ.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},PQ.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},PQ.parseLabeledStatement=function(e,t,n,r){for(var i=0,o=this.labels;i<o.length;i+=1){o[i].name===t&&this.raise(n.start,"Label '"+t+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===sQ._switch?"switch":null,s=this.labels.length-1;s>=0;s--){var u=this.labels[s];if(u.statementStart!==e.start)break;u.statementStart=this.start,u.kind=a}return this.labels.push({name:t,kind:a,statementStart:this.start}),e.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),e.label=n,this.finishNode(e,"LabeledStatement")},PQ.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},PQ.parseBlock=function(e,t,n){for(void 0===e&&(e=!0),void 0===t&&(t=this.startNode()),t.body=[],this.expect(sQ.braceL),e&&this.enterScope(0);this.type!==sQ.braceR;){var r=this.parseStatement(null);t.body.push(r)}return n&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")},PQ.parseFor=function(e,t){return e.init=t,this.expect(sQ.semi),e.test=this.type===sQ.semi?null:this.parseExpression(),this.expect(sQ.semi),e.update=this.type===sQ.parenR?null:this.parseExpression(),this.expect(sQ.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},PQ.parseForIn=function(e,t){var n=this.type===sQ._in;return this.next(),"VariableDeclaration"===t.type&&null!=t.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==t.kind||"Identifier"!==t.declarations[0].id.type)?this.raise(t.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===t.type&&this.raise(t.start,"Invalid left-hand side in for-loop"),e.left=t,e.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(sQ.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,n?"ForInStatement":"ForOfStatement")},PQ.parseVar=function(e,t,n){for(e.declarations=[],e.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(sQ.eq)?r.init=this.parseMaybeAssign(t):"const"!==n||this.type===sQ._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||t&&(this.type===sQ._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),e.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(sQ.comma))break}return e},PQ.parseVarId=function(e,t){e.id=this.parseBindingAtom(),this.checkLVal(e.id,"var"===t?1:2,!1)};var RQ=1,NQ=2;PQ.parseFunction=function(e,t,n,r){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===sQ.star&&t&NQ&&this.unexpected(),e.generator=this.eat(sQ.star)),this.options.ecmaVersion>=8&&(e.async=!!r),t&RQ&&(e.id=4&t&&this.type!==sQ.name?null:this.parseIdent(),!e.id||t&NQ||this.checkLVal(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?1:2:3));var i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(AQ(e.async,e.generator)),t&RQ||(e.id=this.type===sQ.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,n,!1),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(e,t&RQ?"FunctionDeclaration":"FunctionExpression")},PQ.parseFunctionParams=function(e){this.expect(sQ.parenL),e.params=this.parseBindingList(sQ.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},PQ.parseClass=function(e,t){this.next();var n=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),i=!1;for(r.body=[],this.expect(sQ.braceL);this.type!==sQ.braceR;){var o=this.parseClassElement(null!==e.superClass);o&&(r.body.push(o),"MethodDefinition"===o.type&&"constructor"===o.kind&&(i&&this.raise(o.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=n,this.next(),e.body=this.finishNode(r,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},PQ.parseClassElement=function(e){var t=this;if(this.eat(sQ.semi))return null;var n=this.startNode(),r=function(e,r){void 0===r&&(r=!1);var i=t.start,o=t.startLoc;return!!t.eatContextual(e)&&(!(t.type===sQ.parenL||r&&t.canInsertSemicolon())||(n.key&&t.unexpected(),n.computed=!1,n.key=t.startNodeAt(i,o),n.key.name=e,t.finishNode(n.key,"Identifier"),!1))};n.kind="method",n.static=r("static");var i=this.eat(sQ.star),o=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(o=!0,i=this.options.ecmaVersion>=9&&this.eat(sQ.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key,s=!1;return n.computed||n.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),o&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor",s=e),this.parseClassMethod(n,i,o,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},PQ.parseClassMethod=function(e,t,n,r){return e.value=this.parseMethod(t,n,r),this.finishNode(e,"MethodDefinition")},PQ.parseClassId=function(e,t){this.type===sQ.name?(e.id=this.parseIdent(),t&&this.checkLVal(e.id,2,!1)):(!0===t&&this.unexpected(),e.id=null)},PQ.parseClassSuper=function(e){e.superClass=this.eat(sQ._extends)?this.parseExprSubscripts():null},PQ.parseExport=function(e,t){if(this.next(),this.eat(sQ.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseIdent(!0),this.checkExport(t,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==sQ.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(sQ._default)){var n;if(this.checkExport(t,"default",this.lastTokStart),this.type===sQ._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),e.declaration=this.parseFunction(r,4|RQ,!1,n)}else if(this.type===sQ._class){var i=this.startNode();e.declaration=this.parseClass(i,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==sQ.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var o=0,a=e.specifiers;o<a.length;o+=1){var s=a[o];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},PQ.checkExport=function(e,t,n){e&&(gQ(e,t)&&this.raiseRecoverable(n,"Duplicate export '"+t+"'"),e[t]=!0)},PQ.checkPatternExport=function(e,t){var n=t.type;if("Identifier"===n)this.checkExport(e,t.name,t.start);else if("ObjectPattern"===n)for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.checkPatternExport(e,o)}else if("ArrayPattern"===n)for(var a=0,s=t.elements;a<s.length;a+=1){var u=s[a];u&&this.checkPatternExport(e,u)}else"Property"===n?this.checkPatternExport(e,t.value):"AssignmentPattern"===n?this.checkPatternExport(e,t.left):"RestElement"===n?this.checkPatternExport(e,t.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(e,t.expression)},PQ.checkVariableExport=function(e,t){if(e)for(var n=0,r=t;n<r.length;n+=1){var i=r[n];this.checkPatternExport(e,i.id)}},PQ.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},PQ.parseExportSpecifiers=function(e){var t=[],n=!0;for(this.expect(sQ.braceL);!this.eat(sQ.braceR);){if(n)n=!1;else if(this.expect(sQ.comma),this.afterTrailingComma(sQ.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(e,r.exported.name,r.exported.start),t.push(this.finishNode(r,"ExportSpecifier"))}return t},PQ.parseImport=function(e){return this.next(),this.type===sQ.string?(e.specifiers=OQ,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===sQ.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},PQ.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===sQ.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,2),e.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(sQ.comma))return e}if(this.type===sQ.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,2),e.push(this.finishNode(r,"ImportNamespaceSpecifier")),e}for(this.expect(sQ.braceL);!this.eat(sQ.braceR);){if(t)t=!1;else if(this.expect(sQ.comma),this.afterTrailingComma(sQ.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,2),e.push(this.finishNode(i,"ImportSpecifier"))}return e},PQ.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},PQ.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var DQ=wQ.prototype;DQ.toAssignable=function(e,t,n){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.toAssignable(o,t),"RestElement"!==o.type||"ArrayPattern"!==o.argument.type&&"ObjectPattern"!==o.argument.type||this.raise(o.argument.start,"Unexpected token")}break;case"Property":"init"!==e.kind&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),"AssignmentPattern"===e.argument.type&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==e.operator&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,n);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return e},DQ.toAssignableList=function(e,t){for(var n=e.length,r=0;r<n;r++){var i=e[r];i&&this.toAssignable(i,t)}if(n){var o=e[n-1];6===this.options.ecmaVersion&&t&&o&&"RestElement"===o.type&&"Identifier"!==o.argument.type&&this.unexpected(o.argument.start)}return e},DQ.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},DQ.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==sQ.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},DQ.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case sQ.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(sQ.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case sQ.braceL:return this.parseObj(!0)}return this.parseIdent()},DQ.parseBindingList=function(e,t,n){for(var r=[],i=!0;!this.eat(e);)if(i?i=!1:this.expect(sQ.comma),t&&this.type===sQ.comma)r.push(null);else{if(n&&this.afterTrailingComma(e))break;if(this.type===sQ.ellipsis){var o=this.parseRestBinding();this.parseBindingListItem(o),r.push(o),this.type===sQ.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),r.push(a)}return r},DQ.parseBindingListItem=function(e){return e},DQ.parseMaybeDefault=function(e,t,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(sQ.eq))return n;var r=this.startNodeAt(e,t);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},DQ.checkLVal=function(e,t,n){switch(void 0===t&&(t=0),e.type){case"Identifier":2===t&&"let"===e.name&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(gQ(n,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),n[e.name]=!0),0!==t&&5!==t&&this.declareName(e.name,t,e.start);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":t&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.checkLVal(o,t,n)}break;case"Property":this.checkLVal(e.value,t,n);break;case"ArrayPattern":for(var a=0,s=e.elements;a<s.length;a+=1){var u=s[a];u&&this.checkLVal(u,t,n)}break;case"AssignmentPattern":this.checkLVal(e.left,t,n);break;case"RestElement":this.checkLVal(e.argument,t,n);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,n);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var FQ=wQ.prototype;FQ.checkPropClash=function(e,t,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===e.type||this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var r,i=e.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var o=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===o&&(t.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),t.proto=!0);else{var a=t[r="$"+r];if(a)("init"===o?this.strict&&a.init||a.get||a.set:a.init||a[o])&&this.raiseRecoverable(i.start,"Redefinition of property");else a=t[r]={init:!1,get:!1,set:!1};a[o]=!0}}},FQ.parseExpression=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(e,t);if(this.type===sQ.comma){var o=this.startNodeAt(n,r);for(o.expressions=[i];this.eat(sQ.comma);)o.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(o,"SequenceExpression")}return i},FQ.parseMaybeAssign=function(e,t,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var r=!1,i=-1,o=-1;t?(i=t.parenthesizedAssign,o=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new MQ,r=!0);var a=this.start,s=this.startLoc;this.type!==sQ.parenL&&this.type!==sQ.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(e,t);if(n&&(u=n.call(this,u,a,s)),this.type.isAssign){var c=this.startNodeAt(a,s);return c.operator=this.value,c.left=this.type===sQ.eq?this.toAssignable(u,!1,t):u,r||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=c.left.start&&(t.shorthandAssign=-1),this.checkLVal(u),this.next(),c.right=this.parseMaybeAssign(e),this.finishNode(c,"AssignmentExpression")}return r&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),o>-1&&(t.trailingComma=o),u},FQ.parseMaybeConditional=function(e,t){var n=this.start,r=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(sQ.question)){var o=this.startNodeAt(n,r);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(sQ.colon),o.alternate=this.parseMaybeAssign(e),this.finishNode(o,"ConditionalExpression")}return i},FQ.parseExprOps=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,e)},FQ.parseExprOp=function(e,t,n,r,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==sQ._in)&&o>r){var a=this.type===sQ.logicalOR||this.type===sQ.logicalAND,s=this.type===sQ.coalesce;s&&(o=sQ.logicalAND.binop);var u=this.value;this.next();var c=this.start,l=this.startLoc,h=this.parseExprOp(this.parseMaybeUnary(null,!1),c,l,o,i),f=this.buildBinary(t,n,e,h,u,a||s);return(a&&this.type===sQ.coalesce||s&&(this.type===sQ.logicalOR||this.type===sQ.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(f,t,n,r,i)}return e},FQ.buildBinary=function(e,t,n,r,i,o){var a=this.startNodeAt(e,t);return a.left=n,a.operator=i,a.right=r,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")},FQ.parseMaybeUnary=function(e,t){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),t=!0;else if(this.type.prefix){var o=this.startNode(),a=this.type===sQ.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),a?this.checkLVal(o.argument):this.strict&&"delete"===o.operator&&"Identifier"===o.argument.type?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):t=!0,n=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var s=this.startNodeAt(r,i);s.operator=this.value,s.prefix=!1,s.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(s,"UpdateExpression")}}return!t&&this.eat(sQ.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},FQ.parseExprSubscripts=function(e){var t=this.start,n=this.startLoc,r=this.parseExprAtom(e);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,t,n);return e&&"MemberExpression"===i.type&&(e.parenthesizedAssign>=i.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=i.start&&(e.parenthesizedBind=-1)),i},FQ.parseSubscripts=function(e,t,n,r){for(var i=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start==5&&this.potentialArrowAt===e.start,o=!1;;){var a=this.parseSubscript(e,t,n,r,i,o);if(a.optional&&(o=!0),a===e||"ArrowFunctionExpression"===a.type){if(o){var s=this.startNodeAt(t,n);s.expression=a,a=this.finishNode(s,"ChainExpression")}return a}e=a}},FQ.parseSubscript=function(e,t,n,r,i,o){var a=this.options.ecmaVersion>=11,s=a&&this.eat(sQ.questionDot);r&&s&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(sQ.bracketL);if(u||s&&this.type!==sQ.parenL&&this.type!==sQ.backQuote||this.eat(sQ.dot)){var c=this.startNodeAt(t,n);c.object=e,c.property=u?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),c.computed=!!u,u&&this.expect(sQ.bracketR),a&&(c.optional=s),e=this.finishNode(c,"MemberExpression")}else if(!r&&this.eat(sQ.parenL)){var l=new MQ,h=this.yieldPos,f=this.awaitPos,p=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var d=this.parseExprList(sQ.parenR,this.options.ecmaVersion>=8,!1,l);if(i&&!s&&!this.canInsertSemicolon()&&this.eat(sQ.arrow))return this.checkPatternErrors(l,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=h,this.awaitPos=f,this.awaitIdentPos=p,this.parseArrowExpression(this.startNodeAt(t,n),d,!0);this.checkExpressionErrors(l,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=f||this.awaitPos,this.awaitIdentPos=p||this.awaitIdentPos;var v=this.startNodeAt(t,n);v.callee=e,v.arguments=d,a&&(v.optional=s),e=this.finishNode(v,"CallExpression")}else if(this.type===sQ.backQuote){(s||o)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var g=this.startNodeAt(t,n);g.tag=e,g.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(g,"TaggedTemplateExpression")}return e},FQ.parseExprAtom=function(e){this.type===sQ.slash&&this.readRegexp();var t,n=this.potentialArrowAt===this.start;switch(this.type){case sQ._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),t=this.startNode(),this.next(),this.type!==sQ.parenL||this.allowDirectSuper||this.raise(t.start,"super() call outside constructor of a subclass"),this.type!==sQ.dot&&this.type!==sQ.bracketL&&this.type!==sQ.parenL&&this.unexpected(),this.finishNode(t,"Super");case sQ._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case sQ.name:var r=this.start,i=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(sQ._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(sQ.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===sQ.name&&!o)return a=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(sQ.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[a],!0)}return a;case sQ.regexp:var s=this.value;return(t=this.parseLiteral(s.value)).regex={pattern:s.pattern,flags:s.flags},t;case sQ.num:case sQ.string:return this.parseLiteral(this.value);case sQ._null:case sQ._true:case sQ._false:return(t=this.startNode()).value=this.type===sQ._null?null:this.type===sQ._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case sQ.parenL:var u=this.start,c=this.parseParenAndDistinguishExpression(n);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(c)&&(e.parenthesizedAssign=u),e.parenthesizedBind<0&&(e.parenthesizedBind=u)),c;case sQ.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(sQ.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case sQ.braceL:return this.parseObj(!1,e);case sQ._function:return t=this.startNode(),this.next(),this.parseFunction(t,0);case sQ._class:return this.parseClass(this.startNode(),!1);case sQ._new:return this.parseNew();case sQ.backQuote:return this.parseTemplate();case sQ._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},FQ.parseExprImport=function(){var e=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var t=this.parseIdent(!0);switch(this.type){case sQ.parenL:return this.parseDynamicImport(e);case sQ.dot:return e.meta=t,this.parseImportMeta(e);default:this.unexpected()}},FQ.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),!this.eat(sQ.parenR)){var t=this.start;this.eat(sQ.comma)&&this.eat(sQ.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")},FQ.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),"meta"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")},FQ.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),110===t.raw.charCodeAt(t.raw.length-1)&&(t.bigint=t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")},FQ.parseParenExpression=function(){this.expect(sQ.parenL);var e=this.parseExpression();return this.expect(sQ.parenR),e},FQ.parseParenAndDistinguishExpression=function(e){var t,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o,a=this.start,s=this.startLoc,u=[],c=!0,l=!1,h=new MQ,f=this.yieldPos,p=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==sQ.parenR;){if(c?c=!1:this.expect(sQ.comma),i&&this.afterTrailingComma(sQ.parenR,!0)){l=!0;break}if(this.type===sQ.ellipsis){o=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===sQ.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,h,this.parseParenItem))}var d=this.start,v=this.startLoc;if(this.expect(sQ.parenR),e&&!this.canInsertSemicolon()&&this.eat(sQ.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=f,this.awaitPos=p,this.parseParenArrowList(n,r,u);u.length&&!l||this.unexpected(this.lastTokStart),o&&this.unexpected(o),this.checkExpressionErrors(h,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=p||this.awaitPos,u.length>1?((t=this.startNodeAt(a,s)).expressions=u,this.finishNodeAt(t,"SequenceExpression",d,v)):t=u[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var g=this.startNodeAt(n,r);return g.expression=t,this.finishNode(g,"ParenthesizedExpression")}return t},FQ.parseParenItem=function(e){return e},FQ.parseParenArrowList=function(e,t,n){return this.parseArrowExpression(this.startNodeAt(e,t),n)};var BQ=[];FQ.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(sQ.dot)){e.meta=t;var n=this.containsEsc;return e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(e.start,"'new.target' can only be used in functions"),this.finishNode(e,"MetaProperty")}var r=this.start,i=this.startLoc,o=this.type===sQ._import;return e.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),o&&"ImportExpression"===e.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(sQ.parenL)?e.arguments=this.parseExprList(sQ.parenR,this.options.ecmaVersion>=8,!1):e.arguments=BQ,this.finishNode(e,"NewExpression")},FQ.parseTemplateElement=function(e){var t=e.isTagged,n=this.startNode();return this.type===sQ.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===sQ.backQuote,this.finishNode(n,"TemplateElement")},FQ.parseTemplate=function(e){void 0===e&&(e={});var t=e.isTagged;void 0===t&&(t=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:t});for(n.quasis=[r];!r.tail;)this.type===sQ.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(sQ.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(sQ.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(n,"TemplateLiteral")},FQ.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===sQ.name||this.type===sQ.num||this.type===sQ.string||this.type===sQ.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===sQ.star)&&!uQ.test(this.input.slice(this.lastTokEnd,this.start))},FQ.parseObj=function(e,t){var n=this.startNode(),r=!0,i={};for(n.properties=[],this.next();!this.eat(sQ.braceR);){if(r)r=!1;else if(this.expect(sQ.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(sQ.braceR))break;var o=this.parseProperty(e,t);e||this.checkPropClash(o,i,t),n.properties.push(o)}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")},FQ.parseProperty=function(e,t){var n,r,i,o,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(sQ.ellipsis))return e?(a.argument=this.parseIdent(!1),this.type===sQ.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===sQ.parenL&&t&&(t.parenthesizedAssign<0&&(t.parenthesizedAssign=this.start),t.parenthesizedBind<0&&(t.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,t),this.type===sQ.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(e||t)&&(i=this.start,o=this.startLoc),e||(n=this.eat(sQ.star)));var s=this.containsEsc;return this.parsePropertyName(a),!e&&!s&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(sQ.star),this.parsePropertyName(a,t)):r=!1,this.parsePropertyValue(a,e,n,r,i,o,t,s),this.finishNode(a,"Property")},FQ.parsePropertyValue=function(e,t,n,r,i,o,a,s){if((n||r)&&this.type===sQ.colon&&this.unexpected(),this.eat(sQ.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===sQ.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(n,r);else if(t||s||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type===sQ.comma||this.type===sQ.braceR||this.type===sQ.eq)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(e.key),"await"!==e.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),e.kind="init",t?e.value=this.parseMaybeDefault(i,o,e.key):this.type===sQ.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,o,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var u="get"===e.kind?0:1;if(e.value.params.length!==u){var c=e.value.start;"get"===e.kind?this.raiseRecoverable(c,"getter should have no params"):this.raiseRecoverable(c,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},FQ.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(sQ.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(sQ.bracketR),e.key;e.computed=!1}return e.key=this.type===sQ.num||this.type===sQ.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},FQ.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},FQ.parseMethod=function(e,t,n){var r=this.startNode(),i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=e),this.options.ecmaVersion>=8&&(r.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|AQ(t,r.generator)|(n?128:0)),this.expect(sQ.parenL),r.params=this.parseBindingList(sQ.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(r,"FunctionExpression")},FQ.parseArrowExpression=function(e,t,n){var r=this.yieldPos,i=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(16|AQ(n,!1)),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=o,this.finishNode(e,"ArrowFunctionExpression")},FQ.parseFunctionBody=function(e,t,n){var r=t&&this.type!==sQ.braceL,i=this.strict,o=!1;if(r)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);i&&!a||(o=this.strictDirective(this.end))&&a&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var s=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(e,!i&&!o&&!t&&!n&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLVal(e.id,5),e.body=this.parseBlock(!1,void 0,o&&!i),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=s}this.exitScope()},FQ.isSimpleParamList=function(e){for(var t=0,n=e;t<n.length;t+=1){if("Identifier"!==n[t].type)return!1}return!0},FQ.checkParams=function(e,t){for(var n={},r=0,i=e.params;r<i.length;r+=1){var o=i[r];this.checkLVal(o,1,t?null:n)}},FQ.parseExprList=function(e,t,n,r){for(var i=[],o=!0;!this.eat(e);){if(o)o=!1;else if(this.expect(sQ.comma),t&&this.afterTrailingComma(e))break;var a=void 0;n&&this.type===sQ.comma?a=null:this.type===sQ.ellipsis?(a=this.parseSpread(r),r&&this.type===sQ.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):a=this.parseMaybeAssign(!1,r),i.push(a)}return i},FQ.checkUnreserved=function(e){var t=e.start,n=e.end,r=e.name;(this.inGenerator&&"yield"===r&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(t,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(t,n).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+r+"' is reserved"))},FQ.parseIdent=function(e,t){var n=this.startNode();return this.type===sQ.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!e),this.finishNode(n,"Identifier"),e||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},FQ.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===sQ.semi||this.canInsertSemicolon()||this.type!==sQ.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(sQ.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")},FQ.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!1),this.finishNode(e,"AwaitExpression")};var zQ=wQ.prototype;zQ.raise=function(e,t){var n=xQ(this.input,e);t+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(t);throw r.pos=e,r.loc=n,r.raisedAt=this.pos,r},zQ.raiseRecoverable=zQ.raise,zQ.curPosition=function(){if(this.options.locations)return new _Q(this.curLine,this.pos-this.lineStart)};var UQ=wQ.prototype,jQ=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};UQ.enterScope=function(e){this.scopeStack.push(new jQ(e))},UQ.exitScope=function(){this.scopeStack.pop()},UQ.treatFunctionsAsVarInScope=function(e){return 2&e.flags||!this.inModule&&1&e.flags},UQ.declareName=function(e,t,n){var r=!1;if(2===t){var i=this.currentScope();r=i.lexical.indexOf(e)>-1||i.functions.indexOf(e)>-1||i.var.indexOf(e)>-1,i.lexical.push(e),this.inModule&&1&i.flags&&delete this.undefinedExports[e]}else if(4===t){this.currentScope().lexical.push(e)}else if(3===t){var o=this.currentScope();r=this.treatFunctionsAsVar?o.lexical.indexOf(e)>-1:o.lexical.indexOf(e)>-1||o.var.indexOf(e)>-1,o.functions.push(e)}else for(var a=this.scopeStack.length-1;a>=0;--a){var s=this.scopeStack[a];if(s.lexical.indexOf(e)>-1&&!(32&s.flags&&s.lexical[0]===e)||!this.treatFunctionsAsVarInScope(s)&&s.functions.indexOf(e)>-1){r=!0;break}if(s.var.push(e),this.inModule&&1&s.flags&&delete this.undefinedExports[e],3&s.flags)break}r&&this.raiseRecoverable(n,"Identifier '"+e+"' has already been declared")},UQ.checkLocalExport=function(e){-1===this.scopeStack[0].lexical.indexOf(e.name)&&-1===this.scopeStack[0].var.indexOf(e.name)&&(this.undefinedExports[e.name]=e)},UQ.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},UQ.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags)return t}},UQ.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags&&!(16&t.flags))return t}};var VQ=function(e,t,n){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new bQ(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},GQ=wQ.prototype;function HQ(e,t,n,r){return e.type=t,e.end=n,this.options.locations&&(e.loc.end=r),this.options.ranges&&(e.range[1]=n),e}GQ.startNode=function(){return new VQ(this,this.start,this.startLoc)},GQ.startNodeAt=function(e,t){return new VQ(this,e,t)},GQ.finishNode=function(e,t){return HQ.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},GQ.finishNodeAt=function(e,t,n,r){return HQ.call(this,e,t,n,r)};var WQ=function(e,t,n,r,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!n,this.override=r,this.generator=!!i},YQ={b_stat:new WQ("{",!1),b_expr:new WQ("{",!0),b_tmpl:new WQ("${",!1),p_stat:new WQ("(",!1),p_expr:new WQ("(",!0),q_tmpl:new WQ("`",!0,!0,(function(e){return e.tryReadTemplateToken()})),f_stat:new WQ("function",!1),f_expr:new WQ("function",!0),f_expr_gen:new WQ("function",!0,!1,null,!0),f_gen:new WQ("function",!1,!1,null,!0)},XQ=wQ.prototype;XQ.initialContext=function(){return[YQ.b_stat]},XQ.braceIsBlock=function(e){var t=this.curContext();return t===YQ.f_expr||t===YQ.f_stat||(e!==sQ.colon||t!==YQ.b_stat&&t!==YQ.b_expr?e===sQ._return||e===sQ.name&&this.exprAllowed?uQ.test(this.input.slice(this.lastTokEnd,this.start)):e===sQ._else||e===sQ.semi||e===sQ.eof||e===sQ.parenR||e===sQ.arrow||(e===sQ.braceL?t===YQ.b_stat:e!==sQ._var&&e!==sQ._const&&e!==sQ.name&&!this.exprAllowed):!t.isExpr)},XQ.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if("function"===t.token)return t.generator}return!1},XQ.updateContext=function(e){var t,n=this.type;n.keyword&&e===sQ.dot?this.exprAllowed=!1:(t=n.updateContext)?t.call(this,e):this.exprAllowed=n.beforeExpr},sQ.parenR.updateContext=sQ.braceR.updateContext=function(){if(1!==this.context.length){var e=this.context.pop();e===YQ.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},sQ.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?YQ.b_stat:YQ.b_expr),this.exprAllowed=!0},sQ.dollarBraceL.updateContext=function(){this.context.push(YQ.b_tmpl),this.exprAllowed=!0},sQ.parenL.updateContext=function(e){var t=e===sQ._if||e===sQ._for||e===sQ._with||e===sQ._while;this.context.push(t?YQ.p_stat:YQ.p_expr),this.exprAllowed=!0},sQ.incDec.updateContext=function(){},sQ._function.updateContext=sQ._class.updateContext=function(e){!e.beforeExpr||e===sQ.semi||e===sQ._else||e===sQ._return&&uQ.test(this.input.slice(this.lastTokEnd,this.start))||(e===sQ.colon||e===sQ.braceL)&&this.curContext()===YQ.b_stat?this.context.push(YQ.f_stat):this.context.push(YQ.f_expr),this.exprAllowed=!1},sQ.backQuote.updateContext=function(){this.curContext()===YQ.q_tmpl?this.context.pop():this.context.push(YQ.q_tmpl),this.exprAllowed=!1},sQ.star.updateContext=function(e){if(e===sQ._function){var t=this.context.length-1;this.context[t]===YQ.f_expr?this.context[t]=YQ.f_expr_gen:this.context[t]=YQ.f_gen}this.exprAllowed=!0},sQ.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==sQ.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var ZQ="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",qQ=ZQ+" Extended_Pictographic",KQ={9:ZQ,10:qQ,11:"ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS Extended_Pictographic"},QQ="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",$Q="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",JQ=$Q+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",e$={9:$Q,10:JQ,11:"Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho"},t$={};function n$(e){var t=t$[e]={binary:yQ(KQ[e]+" "+QQ),nonBinary:{General_Category:yQ(QQ),Script:yQ(e$[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}n$(9),n$(10),n$(11);var r$=wQ.prototype,i$=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":""),this.unicodeProperties=t$[e.options.ecmaVersion>=11?11:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function o$(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function a$(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function s$(e){return e>=65&&e<=90||e>=97&&e<=122}function u$(e){return s$(e)||95===e}function c$(e){return u$(e)||l$(e)}function l$(e){return e>=48&&e<=57}function h$(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function f$(e){return e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:e-48}function p$(e){return e>=48&&e<=55}i$.prototype.reset=function(e,t,n){var r=-1!==n.indexOf("u");this.start=0|e,this.source=t+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},i$.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)},i$.prototype.at=function(e,t){void 0===t&&(t=!1);var n=this.source,r=n.length;if(e>=r)return-1;var i=n.charCodeAt(e);if(!t&&!this.switchU||i<=55295||i>=57344||e+1>=r)return i;var o=n.charCodeAt(e+1);return o>=56320&&o<=57343?(i<<10)+o-56613888:i},i$.prototype.nextIndex=function(e,t){void 0===t&&(t=!1);var n=this.source,r=n.length;if(e>=r)return r;var i,o=n.charCodeAt(e);return!t&&!this.switchU||o<=55295||o>=57344||e+1>=r||(i=n.charCodeAt(e+1))<56320||i>57343?e+1:e+2},i$.prototype.current=function(e){return void 0===e&&(e=!1),this.at(this.pos,e)},i$.prototype.lookahead=function(e){return void 0===e&&(e=!1),this.at(this.nextIndex(this.pos,e),e)},i$.prototype.advance=function(e){void 0===e&&(e=!1),this.pos=this.nextIndex(this.pos,e)},i$.prototype.eat=function(e,t){return void 0===t&&(t=!1),this.current(t)===e&&(this.advance(t),!0)},r$.validateRegExpFlags=function(e){for(var t=e.validFlags,n=e.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===t.indexOf(i)&&this.raise(e.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}},r$.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},r$.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,n=e.backReferenceNames;t<n.length;t+=1){var r=n[t];-1===e.groupNames.indexOf(r)&&e.raise("Invalid named capture referenced")}},r$.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},r$.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},r$.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!!(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},r$.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!n,!0}return e.pos=t,!1},r$.regexp_eatQuantifier=function(e,t){return void 0===t&&(t=!1),!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},r$.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},r$.regexp_eatBracedQuantifier=function(e,t){var n=e.pos;if(e.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(e)&&(r=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return-1!==i&&i<r&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=n}return!1},r$.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},r$.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},r$.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1},r$.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},r$.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},r$.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},r$.regexp_eatSyntaxCharacter=function(e){var t=e.current();return!!a$(t)&&(e.lastIntValue=t,e.advance(),!0)},r$.regexp_eatPatternCharacters=function(e){for(var t=e.pos,n=0;-1!==(n=e.current())&&!a$(n);)e.advance();return e.pos!==t},r$.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return!(-1===t||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t)&&(e.advance(),!0)},r$.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e))return-1!==e.groupNames.indexOf(e.lastStringValue)&&e.raise("Duplicate capture group name"),void e.groupNames.push(e.lastStringValue);e.raise("Invalid group")}},r$.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},r$.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=o$(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=o$(e.lastIntValue);return!0}return!1},r$.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,r=e.current(n);return e.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(r=e.lastIntValue),function(e){return JK(e,!0)||36===e||95===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},r$.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,r=e.current(n);return e.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(r=e.lastIntValue),function(e){return eQ(e,!0)||36===e||95===e||8204===e||8205===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},r$.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},r$.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var n=e.lastIntValue;if(e.switchU)return n>e.maxBackReference&&(e.maxBackReference=n),!0;if(n<=e.numCapturingParens)return!0;e.pos=t}return!1},r$.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},r$.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},r$.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},r$.regexp_eatZero=function(e){return 48===e.current()&&!l$(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},r$.regexp_eatControlEscape=function(e){var t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},r$.regexp_eatControlLetter=function(e){var t=e.current();return!!s$(t)&&(e.lastIntValue=t%32,e.advance(),!0)},r$.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){void 0===t&&(t=!1);var n,r=e.pos,i=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var o=e.lastIntValue;if(i&&o>=55296&&o<=56319){var a=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var s=e.lastIntValue;if(s>=56320&&s<=57343)return e.lastIntValue=1024*(o-55296)+(s-56320)+65536,!0}e.pos=a,e.lastIntValue=o}return!0}if(i&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&((n=e.lastIntValue)>=0&&n<=1114111))return!0;i&&e.raise("Invalid unicode escape"),e.pos=r}return!1},r$.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);var t=e.current();return!(99===t||e.switchN&&107===t)&&(e.lastIntValue=t,e.advance(),!0)},r$.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do{e.lastIntValue=10*e.lastIntValue+(t-48),e.advance()}while((t=e.current())>=48&&t<=57);return!0}return!1},r$.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(function(e){return 100===e||68===e||115===e||83===e||119===e||87===e}(t))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(80===t||112===t)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1},r$.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var n=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var r=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,n,r),!0}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i),!0}return!1},r$.regexp_validateUnicodePropertyNameAndValue=function(e,t,n){gQ(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(n)||e.raise("Invalid property value")},r$.regexp_validateUnicodePropertyNameOrValue=function(e,t){e.unicodeProperties.binary.test(t)||e.raise("Invalid property name")},r$.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";u$(t=e.current());)e.lastStringValue+=o$(t),e.advance();return""!==e.lastStringValue},r$.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";c$(t=e.current());)e.lastStringValue+=o$(t),e.advance();return""!==e.lastStringValue},r$.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},r$.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1},r$.regexp_classRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var n=e.lastIntValue;!e.switchU||-1!==t&&-1!==n||e.raise("Invalid character class"),-1!==t&&-1!==n&&t>n&&e.raise("Range out of order in character class")}}},r$.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var n=e.current();(99===n||p$(n))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var r=e.current();return 93!==r&&(e.lastIntValue=r,e.advance(),!0)},r$.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},r$.regexp_eatClassControlLetter=function(e){var t=e.current();return!(!l$(t)&&95!==t)&&(e.lastIntValue=t%32,e.advance(),!0)},r$.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},r$.regexp_eatDecimalDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;l$(n=e.current());)e.lastIntValue=10*e.lastIntValue+(n-48),e.advance();return e.pos!==t},r$.regexp_eatHexDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;h$(n=e.current());)e.lastIntValue=16*e.lastIntValue+f$(n),e.advance();return e.pos!==t},r$.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var n=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*n+e.lastIntValue:e.lastIntValue=8*t+n}else e.lastIntValue=t;return!0}return!1},r$.regexp_eatOctalDigit=function(e){var t=e.current();return p$(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},r$.regexp_eatFixedHexDigits=function(e,t){var n=e.pos;e.lastIntValue=0;for(var r=0;r<t;++r){var i=e.current();if(!h$(i))return e.pos=n,!1;e.lastIntValue=16*e.lastIntValue+f$(i),e.advance()}return!0};var d$=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new bQ(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},v$=wQ.prototype;function g$(e){return"function"!=typeof BigInt?null:BigInt(e.replace(/_/g,""))}function m$(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}v$.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new d$(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},v$.getToken=function(){return this.next(),new d$(this)},"undefined"!=typeof Symbol&&(v$[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===sQ.eof,value:t}}}}),v$.curContext=function(){return this.context[this.context.length-1]},v$.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(sQ.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},v$.readToken=function(e){return JK(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},v$.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);return e<=55295||e>=57344?e:(e<<10)+this.input.charCodeAt(this.pos+1)-56613888},v$.skipBlockComment=function(){var e,t=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations)for(cQ.lastIndex=n;(e=cQ.exec(this.input))&&e.index<this.pos;)++this.curLine,this.lineStart=e.index+e[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,t,this.curPosition())},v$.skipLineComment=function(e){for(var t=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!lQ(r);)r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,n,this.curPosition())},v$.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(e>8&&e<14||e>=5760&&hQ.test(String.fromCharCode(e))))break e;++this.pos}}},v$.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=e,this.value=t,this.updateContext(n)},v$.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(sQ.ellipsis)):(++this.pos,this.finishToken(sQ.dot))},v$.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(sQ.assign,2):this.finishOp(sQ.slash,1)},v$.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),n=1,r=42===e?sQ.star:sQ.modulo;return this.options.ecmaVersion>=7&&42===e&&42===t&&(++n,r=sQ.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(sQ.assign,n+1):this.finishOp(r,n)},v$.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(sQ.assign,3);return this.finishOp(124===e?sQ.logicalOR:sQ.logicalAND,2)}return 61===t?this.finishOp(sQ.assign,2):this.finishOp(124===e?sQ.bitwiseOR:sQ.bitwiseAND,1)},v$.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(sQ.assign,2):this.finishOp(sQ.bitwiseXOR,1)},v$.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!==t||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!uQ.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(sQ.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(sQ.assign,2):this.finishOp(sQ.plusMin,1)},v$.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),n=1;return t===e?(n=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(sQ.assign,n+1):this.finishOp(sQ.bitShift,n)):33!==t||60!==e||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===t&&(n=2),this.finishOp(sQ.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},v$.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(sQ.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(sQ.arrow)):this.finishOp(61===e?sQ.eq:sQ.prefix,1)},v$.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(46===t){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(sQ.questionDot,2)}if(63===t){if(e>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(sQ.assign,3);return this.finishOp(sQ.coalesce,2)}}return this.finishOp(sQ.question,1)},v$.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(sQ.parenL);case 41:return++this.pos,this.finishToken(sQ.parenR);case 59:return++this.pos,this.finishToken(sQ.semi);case 44:return++this.pos,this.finishToken(sQ.comma);case 91:return++this.pos,this.finishToken(sQ.bracketL);case 93:return++this.pos,this.finishToken(sQ.bracketR);case 123:return++this.pos,this.finishToken(sQ.braceL);case 125:return++this.pos,this.finishToken(sQ.braceR);case 58:return++this.pos,this.finishToken(sQ.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(sQ.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(sQ.prefix,1)}this.raise(this.pos,"Unexpected character '"+m$(e)+"'")},v$.finishOp=function(e,t){var n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,n)},v$.readRegexp=function(){for(var e,t,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(uQ.test(r)&&this.raise(n,"Unterminated regular expression"),e)e=!1;else{if("["===r)t=!0;else if("]"===r&&t)t=!1;else if("/"===r&&!t)break;e="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var o=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(o);var s=this.regexpState||(this.regexpState=new i$(this));s.reset(n,i,a),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var u=null;try{u=new RegExp(i,a)}catch(e){}return this.finishToken(sQ.regexp,{pattern:i,flags:a,value:u})},v$.readInt=function(e,t,n){for(var r=this.options.ecmaVersion>=12&&void 0===t,i=n&&48===this.input.charCodeAt(this.pos),o=this.pos,a=0,s=0,u=0,c=null==t?1/0:t;u<c;++u,++this.pos){var l=this.input.charCodeAt(this.pos),h=void 0;if(r&&95===l)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===s&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===u&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),s=l;else{if((h=l>=97?l-97+10:l>=65?l-65+10:l>=48&&l<=57?l-48:1/0)>=e)break;s=l,a=a*e+h}}return r&&95===s&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===o||null!=t&&this.pos-o!==t?null:a},v$.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var n=this.readInt(e);return null==n&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n=g$(this.input.slice(t,this.pos)),++this.pos):JK(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(sQ.num,n)},v$.readNumber=function(e){var t=this.pos;e||null!==this.readInt(10,void 0,!0)||this.raise(t,"Invalid number");var n=this.pos-t>=2&&48===this.input.charCodeAt(t);n&&this.strict&&this.raise(t,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!e&&this.options.ecmaVersion>=11&&110===r){var i=g$(this.input.slice(t,this.pos));return++this.pos,JK(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(sQ.num,i)}n&&/[89]/.test(this.input.slice(t,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(43!==(r=this.input.charCodeAt(++this.pos))&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),JK(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var o=function(e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,""))}(this.input.slice(t,this.pos),n);return this.finishToken(sQ.num,o)},v$.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},v$.readString=function(e){for(var t="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===e)break;92===r?(t+=this.input.slice(n,this.pos),t+=this.readEscapedChar(!1),n=this.pos):(lQ(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(n,this.pos++),this.finishToken(sQ.string,t)};var y$={};v$.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==y$)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},v$.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw y$;this.raise(e,t)},v$.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==sQ.template&&this.type!==sQ.invalidTemplate?(e+=this.input.slice(t,this.pos),this.finishToken(sQ.template,e)):36===n?(this.pos+=2,this.finishToken(sQ.dollarBraceL)):(++this.pos,this.finishToken(sQ.backQuote));if(92===n)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(lQ(n)){switch(e+=this.input.slice(t,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(n)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},v$.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(sQ.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},v$.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return m$(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(e){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(t>=48&&t<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,t=this.input.charCodeAt(this.pos),"0"===r&&56!==t&&57!==t||!this.strict&&!e||this.invalidStringToken(this.pos-1-r.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return lQ(t)?"":String.fromCharCode(t)}},v$.readHexChar=function(e){var t=this.pos,n=this.readInt(16,e);return null===n&&this.invalidStringToken(t,"Bad character escape sequence"),n},v$.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,n=this.pos,r=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(eQ(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,e+=this.input.slice(n,this.pos);var o=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(t?JK:eQ)(a,r)||this.invalidStringToken(o,"Invalid Unicode escape"),e+=m$(a),n=this.pos}t=!1}return e+this.input.slice(n,this.pos)},v$.readWord=function(){var e=this.readWord1(),t=sQ.name;return this.keywords.test(e)&&(t=oQ[e]),this.finishToken(t,e)};function _$(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function b$(e){var t="function"==typeof Map?new Map:void 0;return(b$=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return S$(e,arguments,A$(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),E$(r,e)})(e)}function x$(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function S$(e,t,n){return(S$=x$()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&E$(i,n.prototype),i}).apply(null,arguments)}function E$(e,t){return(E$=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A$(e){return(A$=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}wQ.acorn={Parser:wQ,version:"7.4.1",defaultOptions:SQ,Position:_Q,SourceLocation:bQ,getLineInfo:xQ,Node:VQ,TokenType:tQ,tokTypes:sQ,keywordTypes:oQ,TokContext:WQ,tokContexts:YQ,isIdentifierChar:eQ,isIdentifierStart:JK,Token:d$,isNewLine:lQ,lineBreak:uQ,lineBreakG:cQ,nonASCIIwhitespace:hQ};var w$=function(e){function t(){return e.apply(this,arguments)||this}return _$(t,e),t}(b$(Error)),T$=function(e){function t(){return e.apply(this,arguments)||this}return _$(t,e),t}(b$(SyntaxError)),C$=function(e){function t(){return e.apply(this,arguments)||this}return _$(t,e),t}(b$(ReferenceError)),k$=function(e){function t(){return e.apply(this,arguments)||this}return _$(t,e),t}(b$(TypeError)),M$=function(e){function t(){return e.apply(this,arguments)||this}return _$(t,e),t}(w$),P$=function(e){function t(){return e.apply(this,arguments)||this}return _$(t,e),t}(T$),I$=function(e){function t(){return e.apply(this,arguments)||this}return _$(t,e),t}(C$),L$={UnknownError:[3001,"%0",M$],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",M$],NodeTypeSyntaxError:[1001,"Unknown node type: %0",I$],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",I$],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",I$],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",I$],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",I$],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",I$],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",I$],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",I$],ParamTypeSyntaxError:[1009,"Unknown param type: %0",I$],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",I$],FunctionUndefinedReferenceError:[2001,"%0 is not a function",C$],VariableUndefinedReferenceError:[2002,"%0 is not defined",C$],IsNotConstructor:[2003,"%0 is not a constructor",k$]};function O$(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function R$(e,t,n){return(R$=O$()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&N$(i,n.prototype),i}).apply(null,arguments)}function N$(e,t){return(N$=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D$(e,t){Object.defineProperty(e,"name",{value:t,writable:!1,enumerable:!1,configurable:!0})}var F$=Object.prototype.hasOwnProperty,B$=Symbol("Break"),z$=Symbol("Continue"),U$=Symbol("DefaultCase"),j$=Symbol("EmptyStatementReturn"),V$=Symbol("WithScopeName"),G$=Symbol("SuperScopeName"),H$=Symbol("RootScopeName"),W$=Symbol("GlobalScopeName");function Y$(e){return"function"==typeof e}var X$=function(){function e(e){this.interpreter=e}return e.prototype.generator=function(){var e=this.interpreter;return{getOptions:e.getOptions.bind(e),getCurrentScope:function(){return this.getCurrentScope()}.bind(e),getGlobalScope:function(){return this.getGlobalScope()}.bind(e),getCurrentContext:function(){return this.getCurrentContext()}.bind(e),getExecStartTime:e.getExecStartTime.bind(e)}},e}();function Z$(e,t,n){if(void 0===n&&(n=!0),!(e instanceof X$))throw new Error("Illegal call");if("string"!=typeof t)return t;if(t){var r=e.generator(),i={timeout:r.getOptions().timeout,_initEnv:function(){n||this.setCurrentContext(r.getCurrentContext()),this.execStartTime=r.getExecStartTime(),this.execEndTime=this.execStartTime}},o=n?r.getGlobalScope():r.getCurrentScope();return new rJ(o,i).evaluate(t)}}function q$(e){if(!(e instanceof X$))throw new Error("Illegal call");for(var t=e.generator(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r.pop(),a=new rJ(t.getGlobalScope(),t.getOptions()),s="\n\t\t    (function anonymous("+r.join(",")+"){\n\t\t        "+o+"\n\t\t    });\n\t\t    ";return a.evaluate(s)}Object.defineProperty(Z$,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(q$,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var K$=function(e){this.value=e},Q$=function(e){this.value=e},$$=function(e){this.value=e},J$=function(e,t,n){void 0===t&&(t=null),this.name=n,this.parent=t,this.data=e,this.labelStack=[]};function eJ(){}function tJ(e,t){return void 0===e&&(e=null),new J$(Object.create(null),e,t)}var nJ={NaN:NaN,Infinity:1/0,undefined:void 0,Object:Object,Array:Array,String:String,Boolean:Boolean,Number:Number,Date:Date,RegExp:RegExp,Error:Error,URIError:URIError,TypeError:TypeError,RangeError:RangeError,SyntaxError:SyntaxError,ReferenceError:ReferenceError,Float32Array:Float32Array,Float64Array:Float64Array,Uint32Array:Uint32Array,Math:Math,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,isFinite:isFinite,decodeURI:decodeURI,decodeURIComponent:decodeURIComponent,encodeURI:encodeURI,encodeURIComponent:encodeURIComponent,escape:escape,unescape:unescape,eval:Z$,Function:q$};"undefined"!=typeof JSON&&(nJ.JSON=JSON),"undefined"!=typeof Promise&&(nJ.Promise=Promise),"undefined"!=typeof Set&&(nJ.Set=Set),"undefined"!=typeof Map&&(nJ.Map=Map),"undefined"!=typeof Symbol&&(nJ.Symbol=Symbol),"undefined"!=typeof Proxy&&(nJ.Proxy=Proxy),"undefined"!=typeof WeakMap&&(nJ.WeakMap=WeakMap),"undefined"!=typeof WeakSet&&(nJ.WeakSet=WeakSet),"undefined"!=typeof Reflect&&(nJ.Reflect=Reflect);var rJ=function(){function e(t,n){void 0===t&&(t=e.global),void 0===n&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||e.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:void 0===n.globalContextInFunction?e.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=t||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var t=e.prototype;return t.initEnvironment=function(e){var t;if(e instanceof J$)t=e;else{var n=null,r=this.createSuperScope(e);this.options.rootContext&&(n=new J$(function(e){return Object.create(e)}(this.options.rootContext),r,H$)),t=new J$(e,n||r,W$)}this.globalScope=t,this.currentScope=this.globalScope,this.globalContext=t.data,this.currentContext=t.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var i=this.options._initEnv;i&&i.call(this)},t.getExecStartTime=function(){return this.execStartTime},t.getExecutionTime=function(){return this.execEndTime-this.execStartTime},t.setExecTimeout=function(e){void 0===e&&(e=0),this.options.timeout=e},t.getOptions=function(){return this.options},t.getGlobalScope=function(){return this.globalScope},t.getCurrentScope=function(){return this.currentScope},t.getCurrentContext=function(){return this.currentContext},t.isInterruptThrow=function(e){return e instanceof M$||e instanceof I$||e instanceof P$},t.createSuperScope=function(e){var t=Object.assign({},nJ);return Object.keys(t).forEach((function(n){n in e&&delete t[n]})),new J$(t,null,G$)},t.setCurrentContext=function(e){this.currentContext=e},t.setCurrentScope=function(e){this.currentScope=e},t.evaluate=function(t){var n;if(void 0===t&&(t=""),t)return n=function(e,t){return wQ.parse(e,t)}(t,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||e.ecmaVersion}),this.evaluateNode(n,t)},t.appendCode=function(e){return this.evaluate(e)},t.evaluateNode=function(e,t){var n=this;void 0===t&&(t=""),this.value=void 0,this.source=t,this.sourceList.push(t),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var r=this.getCurrentScope(),i=this.getCurrentContext(),o=r.labelStack.concat([]),a=this.callStack.concat([]);try{var s=this.createClosure(e);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),s()}catch(e){throw e}finally{n.setCurrentScope(r),n.setCurrentContext(i),r.labelStack=o,n.callStack=a,this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},t.createErrorMessage=function(e,t,n){var r=e[1].replace("%0",String(t));return null!==n&&(r+=this.getNodePosition(n||this.lastExecNode)),r},t.createError=function(e,t){return new t(e)},t.createThrowError=function(e,t){return this.createError(e,t)},t.createInternalThrowError=function(e,t,n){return this.createError(this.createErrorMessage(e,t,n),e[2])},t.checkTimeout=function(){if(!this.isRunning)return!1;var e=this.options.timeout||0;return Date.now()-this.execStartTime>e},t.getNodePosition=function(e){if(e){return e.loc?" ["+e.loc.start.line+":"+e.loc.start.column+"]":""}return""},t.createClosure=function(e){var t,n=this;switch(e.type){case"BinaryExpression":t=this.binaryExpressionHandler(e);break;case"LogicalExpression":t=this.logicalExpressionHandler(e);break;case"UnaryExpression":t=this.unaryExpressionHandler(e);break;case"UpdateExpression":t=this.updateExpressionHandler(e);break;case"ObjectExpression":t=this.objectExpressionHandler(e);break;case"ArrayExpression":t=this.arrayExpressionHandler(e);break;case"CallExpression":t=this.callExpressionHandler(e);break;case"NewExpression":t=this.newExpressionHandler(e);break;case"MemberExpression":t=this.memberExpressionHandler(e);break;case"ThisExpression":t=this.thisExpressionHandler(e);break;case"SequenceExpression":t=this.sequenceExpressionHandler(e);break;case"Literal":t=this.literalHandler(e);break;case"Identifier":t=this.identifierHandler(e);break;case"AssignmentExpression":t=this.assignmentExpressionHandler(e);break;case"FunctionDeclaration":t=this.functionDeclarationHandler(e);break;case"VariableDeclaration":t=this.variableDeclarationHandler(e);break;case"BlockStatement":case"Program":t=this.programHandler(e);break;case"ExpressionStatement":t=this.expressionStatementHandler(e);break;case"EmptyStatement":t=this.emptyStatementHandler(e);break;case"ReturnStatement":t=this.returnStatementHandler(e);break;case"FunctionExpression":t=this.functionExpressionHandler(e);break;case"IfStatement":t=this.ifStatementHandler(e);break;case"ConditionalExpression":t=this.conditionalExpressionHandler(e);break;case"ForStatement":t=this.forStatementHandler(e);break;case"WhileStatement":t=this.whileStatementHandler(e);break;case"DoWhileStatement":t=this.doWhileStatementHandler(e);break;case"ForInStatement":t=this.forInStatementHandler(e);break;case"WithStatement":t=this.withStatementHandler(e);break;case"ThrowStatement":t=this.throwStatementHandler(e);break;case"TryStatement":t=this.tryStatementHandler(e);break;case"ContinueStatement":t=this.continueStatementHandler(e);break;case"BreakStatement":t=this.breakStatementHandler(e);break;case"SwitchStatement":t=this.switchStatementHandler(e);break;case"LabeledStatement":t=this.labeledStatementHandler(e);break;case"DebuggerStatement":t=this.debuggerStatementHandler(e);break;default:throw this.createInternalThrowError(L$.NodeTypeSyntaxError,e.type,e)}return function(){var r=n.options.timeout;if(r&&r>0&&n.checkTimeout())throw n.createInternalThrowError(L$.ExecutionTimeOutError,r,null);return n.lastExecNode=e,t.apply(void 0,arguments)}},t.binaryExpressionHandler=function(e){var t=this,n=this.createClosure(e.left),r=this.createClosure(e.right);return function(){var i=n(),o=r();switch(e.operator){case"==":return i==o;case"!=":return i!=o;case"===":return i===o;case"!==":return i!==o;case"<":return i<o;case"<=":return i<=o;case">":return i>o;case">=":return i>=o;case"<<":return i<<o;case">>":return i>>o;case">>>":return i>>>o;case"+":return i+o;case"-":return i-o;case"*":return i*o;case"**":return Math.pow(i,o);case"/":return i/o;case"%":return i%o;case"|":return i|o;case"^":return i^o;case"&":return i&o;case"in":return i in o;case"instanceof":return i instanceof o;default:throw t.createInternalThrowError(L$.BinaryOperatorSyntaxError,e.operator,e)}}},t.logicalExpressionHandler=function(e){var t=this,n=this.createClosure(e.left),r=this.createClosure(e.right);return function(){switch(e.operator){case"||":return n()||r();case"&&":return n()&&r();default:throw t.createInternalThrowError(L$.LogicalOperatorSyntaxError,e.operator,e)}}},t.unaryExpressionHandler=function(e){var t=this;switch(e.operator){case"delete":var n=this.createObjectGetter(e.argument),r=this.createNameGetter(e.argument);return function(){return delete n()[r()]};default:var i;if("typeof"===e.operator&&"Identifier"===e.argument.type){var o=this.createObjectGetter(e.argument),a=this.createNameGetter(e.argument);i=function(){return o()[a()]}}else i=this.createClosure(e.argument);return function(){var n=i();switch(e.operator){case"-":return-n;case"+":return+n;case"!":return!n;case"~":return~n;case"void":return;case"typeof":return typeof n;default:throw t.createInternalThrowError(L$.UnaryOperatorSyntaxError,e.operator,e)}}}},t.updateExpressionHandler=function(e){var t=this,n=this.createObjectGetter(e.argument),r=this.createNameGetter(e.argument);return function(){var i=n(),o=r();switch(t.assertVariable(i,o,e),e.operator){case"++":return e.prefix?++i[o]:i[o]++;case"--":return e.prefix?--i[o]:i[o]--;default:throw t.createInternalThrowError(L$.UpdateOperatorSyntaxError,e.operator,e)}}},t.objectExpressionHandler=function(e){var t=this,n=[];var r=Object.create(null);return e.properties.forEach((function(e){var i=e.kind,o=function(e){return"Identifier"===e.type?e.name:"Literal"===e.type?e.value:this.throwError(L$.ObjectStructureSyntaxError,e.type,e)}(e.key);r[o]&&"init"!==i||(r[o]={}),r[o][i]=t.createClosure(e.value),n.push({key:o,property:e})})),function(){for(var e={},t=n.length,i=0;i<t;i++){var o=n[i],a=o.key,s=r[a],u=s.init?s.init():void 0,c=s.get?s.get():function(){},l=s.set?s.set():function(e){};if("set"in s||"get"in s){var h={configurable:!0,enumerable:!0,get:c,set:l};Object.defineProperty(e,a,h)}else{var f=o.property,p=f.kind;"Identifier"!==f.key.type||"FunctionExpression"!==f.value.type||"init"!==p||f.value.id||D$(u,f.key.name),e[a]=u}}return e}},t.arrayExpressionHandler=function(e){var t=this,n=e.elements.map((function(e){return e?t.createClosure(e):e}));return function(){for(var e=n.length,t=Array(e),r=0;r<e;r++){var i=n[r];i&&(t[r]=i())}return t}},t.safeObjectGet=function(e,t,n){return e[t]},t.createCallFunctionGetter=function(e){var t=this;switch(e.type){case"MemberExpression":var n=this.createClosure(e.object),r=this.createMemberKeyGetter(e),i=this.source;return function(){var o=n(),a=r(),s=t.safeObjectGet(o,a,e);if(!s||!Y$(s)){var u=i.slice(e.start,e.end);throw t.createInternalThrowError(L$.FunctionUndefinedReferenceError,u,e)}return s.__IS_EVAL_FUNC?function(e){return s(new X$(t),e,!0)}:s.__IS_FUNCTION_FUNC?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return s.apply(void 0,[new X$(t)].concat(n))}:s.bind(o)};default:var o=this.createClosure(e);return function(){var n="";"Identifier"===e.type&&(n=e.name);var r=o();if(!r||!Y$(r))throw t.createInternalThrowError(L$.FunctionUndefinedReferenceError,n,e);if("Identifier"===e.type&&r.__IS_EVAL_FUNC&&"eval"===n)return function(e){var i=t.getScopeFromName(n,t.getCurrentScope()),o=i.name===G$||i.name===W$||i.name===H$;return r(new X$(t),e,!o)};if(r.__IS_EVAL_FUNC)return function(e){return r(new X$(t),e,!0)};if(r.__IS_FUNCTION_FUNC)return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.apply(void 0,[new X$(t)].concat(n))};var i=t.options.globalContextInFunction;if("Identifier"===e.type){var a=t.getIdentifierScope(e);a.name===V$&&(i=a.data)}return r.bind(i)}}},t.callExpressionHandler=function(e){var t=this,n=this.createCallFunctionGetter(e.callee),r=e.arguments.map((function(e){return t.createClosure(e)}));return function(){return n().apply(void 0,r.map((function(e){return e()})))}},t.functionExpressionHandler=function(e){var t=this,n=this,r=this.source,i=this.collectDeclVars,o=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var a=e.id?e.id.name:"",s=e.params.length,u=e.params.map((function(e){return t.createParamNameGetter(e)})),c=this.createClosure(e.body),l=this.collectDeclVars,h=this.collectDeclFuncs;return this.collectDeclVars=i,this.collectDeclFuncs=o,function(){var t=n.getCurrentScope(),i=function e(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.callStack.push(""+a);var s=n.getCurrentScope(),f=tJ(t,"FunctionScope("+a+")");n.setCurrentScope(f),n.addDeclarationsToScope(l,h,f),a&&(f.data[a]=e),f.data.arguments=arguments,u.forEach((function(e,t){f.data[e()]=i[t]}));var p=n.getCurrentContext();n.setCurrentContext(this);var d=c();if(n.setCurrentContext(p),n.setCurrentScope(s),n.callStack.pop(),d instanceof K$)return d.value};return D$(i,a),Object.defineProperty(i,"length",{value:s,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(i,"toString",{value:function(){return r.slice(e.start,e.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(i,"valueOf",{value:function(){return r.slice(e.start,e.end)},writable:!0,configurable:!0,enumerable:!1}),i}},t.newExpressionHandler=function(e){var t=this,n=this.source,r=this.createClosure(e.callee),i=e.arguments.map((function(e){return t.createClosure(e)}));return function(){var o=r();if(!Y$(o)||o.__IS_EVAL_FUNC){var a=e.callee,s=n.slice(a.start,a.end);throw t.createInternalThrowError(L$.IsNotConstructor,s,e)}return o.__IS_FUNCTION_FUNC?o.apply(void 0,[new X$(t)].concat(i.map((function(e){return e()})))):R$(o,i.map((function(e){return e()})))}},t.memberExpressionHandler=function(e){var t=this.createClosure(e.object),n=this.createMemberKeyGetter(e);return function(){return t()[n()]}},t.thisExpressionHandler=function(e){var t=this;return function(){return t.getCurrentContext()}},t.sequenceExpressionHandler=function(e){var t=this,n=e.expressions.map((function(e){return t.createClosure(e)}));return function(){for(var e,t=n.length,r=0;r<t;r++){e=(0,n[r])()}return e}},t.literalHandler=function(e){return function(){return e.regex?new RegExp(e.regex.pattern,e.regex.flags):e.value}},t.identifierHandler=function(e){var t=this;return function(){var n=t.getCurrentScope(),r=t.getScopeDataFromName(e.name,n);return t.assertVariable(r,e.name,e),r[e.name]}},t.getIdentifierScope=function(e){var t=this.getCurrentScope();return this.getScopeFromName(e.name,t)},t.assignmentExpressionHandler=function(e){var t=this;"Identifier"!==e.left.type||"FunctionExpression"!==e.right.type||e.right.id||(e.right.id={type:"Identifier",name:e.left.name});var n=this.createObjectGetter(e.left),r=this.createNameGetter(e.left),i=this.createClosure(e.right);return function(){var o=n(),a=r(),s=i();switch("="!==e.operator&&t.assertVariable(o,a,e),e.operator){case"=":return o[a]=s;case"+=":return o[a]+=s;case"-=":return o[a]-=s;case"*=":return o[a]*=s;case"**=":return o[a]=Math.pow(o[a],s);case"/=":return o[a]/=s;case"%=":return o[a]%=s;case"<<=":return o[a]<<=s;case">>=":return o[a]>>=s;case">>>=":return o[a]>>>=s;case"&=":return o[a]&=s;case"^=":return o[a]^=s;case"|=":return o[a]|=s;default:throw t.createInternalThrowError(L$.AssignmentExpressionSyntaxError,e.type,e)}}},t.functionDeclarationHandler=function(e){if(e.id){var t=this.functionExpressionHandler(e);Object.defineProperty(t,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(e.id.name,t)}return function(){return j$}},t.getVariableName=function(e){if("Identifier"===e.type)return e.name;throw this.createInternalThrowError(L$.VariableTypeSyntaxError,e.type,e)},t.variableDeclarationHandler=function(e){for(var t,n=this,r=[],i=0;i<e.declarations.length;i++){var o=e.declarations[i];this.varDeclaration(this.getVariableName(o.id)),o.init&&r.push({type:"AssignmentExpression",operator:"=",left:o.id,right:o.init})}return r.length&&(t=this.createClosure({type:"BlockStatement",body:r})),function(){if(t){var e=n.isVarDeclMode;n.isVarDeclMode=!0,t(),n.isVarDeclMode=e}return j$}},t.assertVariable=function(e,t,n){if(e===this.globalScope.data&&!(t in e))throw this.createInternalThrowError(L$.VariableUndefinedReferenceError,t,n)},t.programHandler=function(e){var t=this,n=e.body.map((function(e){return t.createClosure(e)}));return function(){for(var e=j$,r=0;r<n.length;r++){var i=n[r],o=t.setValue(i());if(o!==j$&&((e=o)instanceof K$||e instanceof Q$||e instanceof $$||e===B$||e===z$))break}return e}},t.expressionStatementHandler=function(e){return this.createClosure(e.expression)},t.emptyStatementHandler=function(e){return function(){return j$}},t.returnStatementHandler=function(e){var t=e.argument?this.createClosure(e.argument):eJ;return function(){return new K$(t())}},t.ifStatementHandler=function(e){var t=this.createClosure(e.test),n=this.createClosure(e.consequent),r=e.alternate?this.createClosure(e.alternate):
/*!important*/
function(){return j$};return function(){return t()?n():r()}},t.conditionalExpressionHandler=function(e){return this.ifStatementHandler(e)},t.forStatementHandler=function(e){var t=this,n=eJ,r=e.test?this.createClosure(e.test):function(){return!0},i=eJ,o=this.createClosure(e.body);return"ForStatement"===e.type&&(n=e.init?this.createClosure(e.init):n,i=e.update?this.createClosure(e.update):eJ),function(a){var s,u=j$,c="DoWhileStatement"===e.type;for(a&&"LabeledStatement"===a.type&&(s=a.label.name),n();c||r();i()){c=!1;var l=t.setValue(o());if(l!==j$&&l!==z$){if(l===B$)break;if((u=l)instanceof $$&&u.value===s)u=j$;else if(u instanceof K$||u instanceof Q$||u instanceof $$)break}}return u}},t.whileStatementHandler=function(e){return this.forStatementHandler(e)},t.doWhileStatementHandler=function(e){return this.forStatementHandler(e)},t.forInStatementHandler=function(e){var t=this,n=e.left,r=this.createClosure(e.right),i=this.createClosure(e.body);return"VariableDeclaration"===e.left.type&&(this.createClosure(e.left)(),n=e.left.declarations[0].id),function(e){var o,a,s=j$;e&&"LabeledStatement"===e.type&&(o=e.label.name);var u=r();for(a in u){t.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:n,right:{type:"Literal",value:a}})();var c=t.setValue(i());if(c!==j$&&c!==z$){if(c===B$)break;if((s=c)instanceof $$&&s.value===o)s=j$;else if(s instanceof K$||s instanceof Q$||s instanceof $$)break}}return s}},t.withStatementHandler=function(e){var t=this,n=this.createClosure(e.object),r=this.createClosure(e.body);return function(){var e=n(),i=t.getCurrentScope(),o=new J$(e,i,V$);t.setCurrentScope(o);var a=t.setValue(r());return t.setCurrentScope(i),a}},t.throwStatementHandler=function(e){var t=this,n=this.createClosure(e.argument);return function(){throw t.setValue(void 0),n()}},t.tryStatementHandler=function(e){var t=this,n=this.createClosure(e.block),r=e.handler?this.catchClauseHandler(e.handler):null,i=e.finalizer?this.createClosure(e.finalizer):null;return function(){var e,o,a=t.getCurrentScope(),s=t.getCurrentContext(),u=a.labelStack.concat([]),c=t.callStack.concat([]),l=j$,h=function(){t.setCurrentScope(a),t.setCurrentContext(s),a.labelStack=u,t.callStack=c};try{(l=t.setValue(n()))instanceof K$&&(e=l)}catch(n){if(h(),t.isInterruptThrow(n))throw n;if(r)try{(l=t.setValue(r(n)))instanceof K$&&(e=l)}catch(e){if(h(),t.isInterruptThrow(e))throw e;o=e}}if(i)try{(l=i())instanceof K$&&(e=l)}catch(e){if(h(),t.isInterruptThrow(e))throw e;o=e}if(o)throw o;return e||l}},t.catchClauseHandler=function(e){var t=this,n=this.createParamNameGetter(e.param),r=this.createClosure(e.body);return function(e){var i,o=t.getCurrentScope().data,a=n(),s=F$.call(o,a),u=o[a];return o[a]=e,i=r(),s?o[a]=u:delete o[a],i}},t.continueStatementHandler=function(e){return function(){return e.label?new $$(e.label.name):z$}},t.breakStatementHandler=function(e){return function(){return e.label?new Q$(e.label.name):B$}},t.switchStatementHandler=function(e){var t=this,n=this.createClosure(e.discriminant),r=e.cases.map((function(e){return t.switchCaseHandler(e)}));return function(){for(var e,i,o,a=n(),s=!1,u=0;u<r.length;u++){var c=r[u](),l=c.testClosure();if(l!==U$){if(s||l===a){if(s=!0,(i=t.setValue(c.bodyClosure()))===j$)continue;if(i===B$)break;if((e=i)instanceof K$||e instanceof Q$||e instanceof $$||e===z$)break}}else o=c}!s&&o&&((i=t.setValue(o.bodyClosure()))===j$||i===B$||i===z$||(e=i));return e}},t.switchCaseHandler=function(e){var t=e.test?this.createClosure(e.test):function(){return U$},n=this.createClosure({type:"BlockStatement",body:e.consequent});return function(){return{testClosure:t,bodyClosure:n}}},t.labeledStatementHandler=function(e){var t=this,n=e.label.name,r=this.createClosure(e.body);return function(){var i,o=t.getCurrentScope();return o.labelStack.push(n),(i=r(e))instanceof Q$&&i.value===n&&(i=j$),o.labelStack.pop(),i}},t.debuggerStatementHandler=function(e){return function(){return j$}},t.createParamNameGetter=function(e){if("Identifier"===e.type)return function(){return e.name};throw this.createInternalThrowError(L$.ParamTypeSyntaxError,e.type,e)},t.createObjectKeyGetter=function(e){var t;return t="Identifier"===e.type?function(){return e.name}:this.createClosure(e),function(){return t()}},t.createMemberKeyGetter=function(e){return e.computed?this.createClosure(e.property):this.createObjectKeyGetter(e.property)},t.createObjectGetter=function(e){var t=this;switch(e.type){case"Identifier":return function(){return t.getScopeDataFromName(e.name,t.getCurrentScope())};case"MemberExpression":return this.createClosure(e.object);default:throw this.createInternalThrowError(L$.AssignmentTypeSyntaxError,e.type,e)}},t.createNameGetter=function(e){switch(e.type){case"Identifier":return function(){return e.name};case"MemberExpression":return this.createMemberKeyGetter(e);default:throw this.createInternalThrowError(L$.AssignmentTypeSyntaxError,e.type,e)}},t.varDeclaration=function(e){this.collectDeclVars[e]=void 0},t.funcDeclaration=function(e,t){this.collectDeclFuncs[e]=t},t.addDeclarationsToScope=function(e,t,n){var r=n.data;for(var i in t){var o=t[i];r[i]=o?o():o}for(var a in e)a in r||(r[a]=void 0)},t.getScopeValue=function(e,t){return this.getScopeFromName(e,t).data[e]},t.getScopeDataFromName=function(e,t){return this.getScopeFromName(e,t).data},t.getScopeFromName=function(e,t){var n=t;do{if(e in n.data)return n}while(n=n.parent);return this.globalScope},t.setValue=function(e){var t=this.callStack.length;return this.isVarDeclMode||t||e===j$||e===B$||e===z$||e instanceof Q$||e instanceof $$||(this.value=e instanceof K$?e.value:e),e},t.getValue=function(){return this.value},e}();rJ.version="0.0.3",rJ.eval=Z$,rJ.Function=q$,rJ.ecmaVersion=5,rJ.globalContextInFunction=void 0,rJ.global=Object.create(null);var iJ,oJ,aJ,sJ,uJ,cJ,lJ,hJ,fJ,pJ,dJ,vJ,gJ,mJ,yJ,_J=function(e,t,n){return function(e,t,n){return new rJ(t,n).evaluate(e)}(e,t,n)},bJ=Y((function(e,t){e.exports=function(e){var t=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},n=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e};function r(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function i(e){var t=new Error("(regl) "+e);throw console.error(t),t}function o(e,t){e||i(t)}function a(e){return e?": "+e:""}function s(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function u(e,t,n){t.indexOf(e)<0&&i("invalid value"+a(n)+". must be one of: "+t)}var c=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function l(e,t){for(e+="";e.length<t;)e=" "+e;return e}function h(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function f(e,t){this.number=e,this.line=t,this.errors=[]}function p(e,t,n){this.file=e,this.line=t,this.message=n}function d(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function v(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function g(e,t){var n=e.split("\n"),i=1,o=0,a={unknown:new h,0:new h};a.unknown.name=a[0].name=t||d(),a.unknown.lines.push(new f(0,""));for(var s=0;s<n.length;++s){var u=n[s],c=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(c)switch(c[1]){case"line":var l=/(\d+)(\s+\d+)?/.exec(c[2]);l&&(i=0|l[1],l[2]&&((o=0|l[2])in a||(a[o]=new h)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(c[2]);p&&(a[o].name=p[1]?r(p[2]):p[2])}a[o].lines.push(new f(i++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function m(e){e._commandRef=d()}function y(e,t){var n=v();i(e+" in command "+(t||d())+("unknown"===n?"":" called from "+n))}function _(e,t,n,r){s(e,t)||y("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e,r||d())}var b={};function x(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:b[e]*t}function S(e){return!(e&e-1||!e)}b[5120]=b[5121]=1,b[5122]=b[5123]=b[36193]=b[33635]=b[32819]=b[32820]=2,b[5124]=b[5125]=b[5126]=b[34042]=4;var E=n(o,{optional:function(e){e()},raise:i,commandRaise:y,command:function(e,t,n){e||y(t,n||d())},parameter:function(e,t,n){e in t||i("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||y("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join(),r||d())},constructor:function(e){Object.keys(e).forEach((function(e){c.indexOf(e)<0&&i('invalid regl constructor argument "'+e+'". must be one of '+c)}))},type:function(e,t,n){s(e,t)||i("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e)},commandType:_,isTypedArray:function(e,n){t(e)||i("invalid parameter type"+a(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||i("invalid parameter type, ("+e+")"+a(t)+". must be a nonnegative integer")},oneOf:u,shaderError:function(e,t,n,r,i){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(t),s=r===e.FRAGMENT_SHADER?"fragment":"vertex";_(n,"string",s+" shader source must be a string",i);var u=g(n,i),c=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new p(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new p("unknown",0,e))}})),t}(a);!function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}(u,c),Object.keys(u).forEach((function(e){var t=u[e];if(t.hasErrors){var n=[""],r=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){i(l(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(n){var r=n.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(o){var a=o[1];switch(r=o[2],a){case"assign":a="="}t=Math.max(e.line.indexOf(a,t),0)}else t=0;i(l("| ",6)),i(l("^^^",t+3)+"\n","font-weight:bold"),i(l("| ",6)),i(r+"\n","font-weight:bold")})),i(l("| ",6)+"\n")}else i(l(e.number,4)+"|  "),i(e.line+"\n","color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(r[0]=n.join("%c"),console.log.apply(console,r))}function i(e,t){n.push(e),r.push(t||"")}})),o.raise("Error compiling "+s+" shader, "+u[0].name)}},linkError:function(e,t,n,r,i){if(!e.getProgramParameter(t,e.LINK_STATUS)){var a=e.getProgramInfoLog(t),s=g(n,i),u='Error linking program with vertex shader, "'+g(r,i)[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+"\n"+a),o.raise(u)}},callSite:v,saveCommandRef:m,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}m(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?u(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):u(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(e,t,n){var r,i=t.width,a=t.height,s=t.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),33071===e.wrapS&&33071===e.wrapT||o(S(i)&&S(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==a&&o(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(o(S(i)&&S(a),"texture must be a square power of 2 to support mipmapping"),o(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&o(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),o(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var c=i>>r,l=a>>r;o(t.mipmask&1<<r,"missing mipmap data");var h=u[r];if(o(h.width===c&&h.height===l,"invalid shape for mip images"),o(h.format===t.format&&h.internalformat===t.internalformat&&h.type===t.type,"incompatible type for mip image"),h.compressed);else if(h.data){var f=Math.ceil(x(h.type,s)*c/h.unpackAlignment)*h.unpackAlignment;o(h.data.byteLength===f*l,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else e.genMipmaps||o(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&o(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var i=e.width,a=e.height,s=e.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(33071===t.wrapS&&33071===t.wrapT,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var c=n[u];o(c.width===i&&c.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(o(!c.compressed,"can not generate mipmap for compressed textures"),o(1===c.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=c.images,h=0;h<16;++h){var f=l[h];if(f){var p=i>>h,d=a>>h;o(c.mipmask&1<<h,"missing mipmap data"),o(f.width===p&&f.height===d,"invalid shape for mip images"),o(f.format===e.format&&f.internalformat===e.internalformat&&f.type===e.type,"incompatible type for mip image"),f.compressed||(f.data?o(f.data.byteLength===p*d*Math.max(x(f.type,s),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}}),A=0;function w(e,t){this.id=A++,this.type=e,this.data=t}function T(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function C(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&n===r&&('"'===n||"'"===n))return['"'+T(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var o=t.split(".");if(1===o.length)return['"'+T(t)+'"'];for(var a=[],s=0;s<o.length;++s)a=a.concat(e(o[s]));return a}(e).join("][")+"]"}var k={DynamicVariable:w,define:function(e,t){return new w(e,C(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof w},unbox:function e(t,n){return"function"==typeof t?new w(0,t):"number"==typeof t||"boolean"==typeof t?new w(5,t):Array.isArray(t)?new w(6,t.map((function(t,r){return e(t,n+"["+r+"]")}))):t instanceof w?t:void E(!1,"invalid option type in uniform "+n)},accessor:C},M={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},P="undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?function(){return+new Date}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function I(e){return"string"==typeof e?e.split():(E(Array.isArray(e),"invalid extension array"),e)}function L(e){return"string"==typeof e?(E("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function O(e){var t,r,i,o,a=e||{},s={},u=[],c=[],l="undefined"==typeof window?1:window.devicePixelRatio,h=!1,f=function(e){e&&E.raise(e)},p=function(){};if("string"==typeof a?(E("undefined"!=typeof document,"selector queries only supported in DOM environments"),t=document.querySelector(a),E(t,"invalid query string for element")):"object"==typeof a?function(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}(a)?t=a:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(a)?i=(o=a).canvas:(E.constructor(a),"gl"in a?o=a.gl:"canvas"in a?i=L(a.canvas):"container"in a&&(r=L(a.container)),"attributes"in a&&(s=a.attributes,E.type(s,"object","invalid context attributes")),"extensions"in a&&(u=I(a.extensions)),"optionalExtensions"in a&&(c=I(a.optionalExtensions)),"onDone"in a&&(E.type(a.onDone,"function","invalid or missing onDone callback"),f=a.onDone),"profile"in a&&(h=!!a.profile),"pixelRatio"in a&&(l=+a.pixelRatio,E(l>0,"invalid pixel ratio"))):E.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?i=t:r=t),!o){if(!i){E("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var d=function(e,t,r){var i,o=document.createElement("canvas");function a(){var t=window.innerWidth,n=window.innerHeight;if(e!==document.body){var i=o.getBoundingClientRect();t=i.right-i.left,n=i.bottom-i.top}o.width=r*t,o.height=r*n}return n(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(o),e===document.body&&(o.style.position="absolute",n(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(r||document.body,0,l);if(!d)return null;i=d.canvas,p=d.onDestroy}void 0===s.premultipliedAlpha&&(s.premultipliedAlpha=!0),o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,s)}return o?{gl:o,canvas:i,container:r,extensions:u,optionalExtensions:c,pixelRatio:l,profile:h,onDone:f,onDestroy:p}:(p(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function R(e,t){var n={};function r(t){E.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=function(t){return e.getExtension(t)?e.getExtension(t):e.getExtension(t.toLowerCase())?e.getExtension(t.toLowerCase()):null}(t)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}function N(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function D(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function F(){var e=N(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[D(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[D(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var B=F();function z(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}B.zero=F();var U=function(e){return Object.keys(e).map((function(t){return e[t]}))},j={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||B.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:V(e,t[0],t[1],t[2],a,0);break;default:!function e(t,n,r,i,o){for(var a=1,s=r+1;s<n.length;++s)a*=n[s];var u=n[r];if(n.length-r==4){var c=n[r+1],l=n[r+2],h=n[r+3];for(s=0;s<u;++s)V(t[s],c,l,h,i,o),o+=a}else for(s=0;s<u;++s)e(t[s],n,r+1,i,o),o+=a}(e,t,0,a,0)}return a}};function V(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],c=0;c<n;++c)for(var l=u[c],h=0;h<r;++h)i[a++]=l[h]}var G={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},H={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},W={dynamic:35048,stream:35040,static:35044},Y=j.flatten,X=j.shape,Z=[];function q(e){return 0|G[Object.prototype.toString.call(e)]}function K(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function Q(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var c=0;c<r;++c)e[s++]=t[i*u+o*c+a]}Z[5120]=1,Z[5122]=2,Z[5124]=4,Z[5121]=1,Z[5123]=2,Z[5125]=4,Z[5126]=4;var $={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},J=new Float32Array(1),ee=new Uint32Array(J.buffer);function te(e){for(var t=B.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{J[0]=e[n];var r=ee[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function ne(e){return Array.isArray(e)||t(e)}var re=function(e){return!(e&e-1||!e)},ie=[9984,9986,9985,9987],oe=[0,6409,6410,6407,6408],ae={};function se(e){return"[object "+e+"]"}ae[6409]=ae[6406]=ae[6402]=1,ae[34041]=ae[6410]=2,ae[6407]=ae[35904]=3,ae[6408]=ae[35906]=4;var ue=se("HTMLCanvasElement"),ce=se("OffscreenCanvas"),le=se("CanvasRenderingContext2D"),he=se("ImageBitmap"),fe=se("HTMLImageElement"),pe=se("HTMLVideoElement"),de=Object.keys(G).concat([ue,ce,le,he,fe,pe]),ve=[];ve[5121]=1,ve[5126]=4,ve[36193]=2,ve[5123]=2,ve[5125]=4;var ge=[];function me(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function ye(e){return!!Array.isArray(e)&&!(0===e.length||!ne(e[0]))}function _e(e){return Object.prototype.toString.call(e)}function be(e){return _e(e)===ue}function xe(e){return _e(e)===ce}function Se(e){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&e&&e.getContext)}function Ee(e){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&e&&"src"in e&&"crossOrigin"in e)}function Ae(e){if(!e)return!1;if(Se(e)||Ee(e))return!0;var t=_e(e);return de.indexOf(t)>=0||me(e)||ye(e)||z(e)}function we(e){return 0|G[Object.prototype.toString.call(e)]}function Te(e,t){return B.allocType(36193===e.type?5126:e.type,t)}function Ce(e,t){36193===e.type?(e.data=te(t),B.freeType(t)):e.data=t}function ke(e,t,n,r,i,o){var a;if(a=void 0!==ge[e]?ge[e]:ae[e]*ve[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function Me(e,r,i,o,a,s,u){var c={"don't care":4352,"dont care":4352,nice:4354,fast:4353},l={repeat:10497,clamp:33071,mirror:33648},h={nearest:9728,linear:9729},f=n({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},h),p={none:0,browser:37444},d={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},v={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},g={};r.ext_srgb&&(v.srgb=35904,v.srgba=35906),r.oes_texture_float&&(d.float32=d.float=5126),r.oes_texture_half_float&&(d.float16=d["half float"]=36193),r.webgl_depth_texture&&(n(v,{depth:6402,"depth stencil":34041}),n(d,{uint16:5123,uint32:5125,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&n(g,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),r.webgl_compressed_texture_atc&&n(g,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&n(g,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=36196);var m=Array.prototype.slice.call(e.getParameter(34467)||new Uint32Array(0));Object.keys(g).forEach((function(e){var t=g[e];m.indexOf(t)>=0&&(v[e]=t)}));var y=Object.keys(v);i.textureFormats=y;var _=[];Object.keys(v).forEach((function(e){var t=v[e];_[t]=e}));var b=[];Object.keys(d).forEach((function(e){var t=d[e];b[t]=e}));var x=[];Object.keys(h).forEach((function(e){x[h[e]]=e}));var S=[];Object.keys(f).forEach((function(e){var t=f[e];S[t]=e}));var A=[];Object.keys(l).forEach((function(e){A[l[e]]=e}));var w=y.reduce((function(e,t){var n=v[t];return 6409===n||6406===n||6409===n||6410===n||6402===n||34041===n||r.ext_srgb&&(35904===n||35906===n)?e[n]=n:32855===n||t.indexOf("rgba")>=0?e[n]=6408:e[n]=6407,e}),{});function T(){this.internalformat=6408,this.format=6408,this.type=5121,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function C(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function k(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(E.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(E.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(E.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(E.parameter(t.colorSpace,p,"invalid colorSpace"),e.colorSpace=p[t.colorSpace]),"type"in t){var n=t.type;E(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),E(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),E(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),E.parameter(n,d,"invalid texture type"),e.type=d[n]}var o=e.width,a=e.height,s=e.channels,u=!1;"shape"in t?(E(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(s=t.shape[2],E(s>0&&s<=4,"invalid number of channels"),u=!0),E(o>=0&&o<=i.maxTextureSize,"invalid width"),E(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,E(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,E(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,E(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,E(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var c=!1;if("format"in t){var l=t.format;E(r.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),E.parameter(l,v,"invalid texture format");var h=e.internalformat=v[l];e.format=w[h],l in d&&("type"in t||(e.type=d[l])),l in g&&(e.compressed=!0),c=!0}!u&&c?e.channels=ae[e.format]:u&&!c?e.channels!==oe[e.format]&&(e.format=e.internalformat=oe[e.channels]):c&&u&&E(e.channels===ae[e.format],"number of channels inconsistent with specified format")}}function M(t){e.pixelStorei(37440,t.flipY),e.pixelStorei(37441,t.premultiplyAlpha),e.pixelStorei(37443,t.colorSpace),e.pixelStorei(3317,t.unpackAlignment)}function P(){T.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(e,n){var r=null;if(Ae(n)?r=n:n&&(E.type(n,"object","invalid pixel data type"),k(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),Ae(n.data)&&(r=n.data)),E(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){E(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;e.width=e.width||o-e.xOffset,e.height=e.height||s-e.yOffset,e.needsCopy=!0,E(e.xOffset>=0&&e.xOffset<o&&e.yOffset>=0&&e.yOffset<s&&e.width>0&&e.width<=o&&e.height>0&&e.height<=s,"copy texture read out of bounds")}else if(r){if(t(r))e.channels=e.channels||4,e.data=r,"type"in n||5121!==e.type||(e.type=we(r));else if(me(r))e.channels=e.channels||4,function(e,t){var n=t.length;switch(e.type){case 5121:case 5123:case 5125:case 5126:var r=B.allocType(e.type,n);r.set(t),e.data=r;break;case 36193:e.data=te(t);break;default:E.raise("unsupported texture type, must specify a typed array")}}(e,r),e.alignment=1,e.needsFree=!0;else if(z(r)){var u=r.data;Array.isArray(u)||5121!==e.type||(e.type=we(u));var c,l,h,f,p,d,v=r.shape,g=r.stride;3===v.length?(h=v[2],d=g[2]):(E(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),c=v[0],l=v[1],f=g[0],p=g[1],e.alignment=1,e.width=c,e.height=l,e.channels=h,e.format=e.internalformat=oe[h],e.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,c=Te(e,a*s*u),l=0,h=0;h<s;++h)for(var f=0;f<a;++f)for(var p=0;p<u;++p)c[l++]=t[n*f+r*h+i*p+o];Ce(e,c)}(e,u,f,p,d,r.offset)}else if(Se(r)||be(r)||xe(r)||function(e){return _e(e)===le}(r))Se(r)||be(r)||xe(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(function(e){return _e(e)===he}(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(function(e){return _e(e)===fe}(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(Ee(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(function(e){return _e(e)===pe}(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(ye(r)){var m=e.width||r[0].length,y=e.height||r.length,_=e.channels;_=ne(r[0][0])?_||r[0][0].length:_||1;for(var b=j.shape(r),x=1,S=0;S<b.length;++S)x*=b[S];var A=Te(e,x);j.flatten(r,b,"",A),Ce(e,A),e.alignment=1,e.width=m,e.height=y,e.channels=_,e.format=e.internalformat=oe[_],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;5126===e.type?E(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):36193===e.type&&E(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function L(t,n,r){var i=t.element,a=t.data,s=t.internalformat,u=t.format,c=t.type,l=t.width,h=t.height;M(t),i?e.texImage2D(n,r,u,u,c,i):t.compressed?e.compressedTexImage2D(n,r,s,l,h,0,a):t.needsCopy?(o(),e.copyTexImage2D(n,r,u,t.xOffset,t.yOffset,l,h,0)):e.texImage2D(n,r,u,l,h,0,u,c,a||null)}function O(t,n,r,i,a){var s=t.element,u=t.data,c=t.internalformat,l=t.format,h=t.type,f=t.width,p=t.height;M(t),s?e.texSubImage2D(n,a,r,i,l,h,s):t.compressed?e.compressedTexSubImage2D(n,a,r,i,c,f,p,u):t.needsCopy?(o(),e.copyTexSubImage2D(n,a,r,i,t.xOffset,t.yOffset,f,p)):e.texSubImage2D(n,a,r,i,f,p,l,h,u)}var R=[];function N(){return R.pop()||new P}function D(e){e.needsFree&&B.freeType(e.data),P.call(e),R.push(e)}function F(){T.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function V(e,t,n){var r=e.images[0]=N();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function G(e,t){var n=null;if(Ae(t))C(n=e.images[0]=N(),e),I(n,t),e.mipmask=1;else if(k(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)C(n=e.images[i]=N(),e),n.width>>=i,n.height>>=i,I(n,r[i]),e.mipmask|=1<<i;else C(n=e.images[0]=N(),e),I(n,t),e.mipmask=1;C(e,e.images[0]),!e.compressed||33776!==e.internalformat&&33777!==e.internalformat&&33778!==e.internalformat&&33779!==e.internalformat||E(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function H(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;L(n[r],t,r)}}var W=[];function Y(){var e=W.pop()||new F;T.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function X(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&D(t[n]),t[n]=null;W.push(e)}function Z(){this.minFilter=9728,this.magFilter=9728,this.wrapS=33071,this.wrapT=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function q(e,t){if("min"in t){var n=t.min;E.parameter(n,f),e.minFilter=f[n],ie.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;E.parameter(r,h),e.magFilter=h[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(E.parameter(s,l),o=a=l[s]):Array.isArray(s)&&(E.parameter(s[0],l),E.parameter(s[1],l),o=l[s[0]],a=l[s[1]])}else{if("wrapS"in t){var u=t.wrapS;E.parameter(u,l),o=l[u]}if("wrapT"in t){var p=t.wrapT;E.parameter(p,l),a=l[p]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var d=t.anisotropic;E("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var v=!1;switch(typeof t.mipmap){case"string":E.parameter(t.mipmap,c,"invalid mipmap hint"),e.mipmapHint=c[t.mipmap],e.genMipmaps=!0,v=!0;break;case"boolean":v=e.genMipmaps=t.mipmap;break;case"object":E(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,v=!0;break;default:E.raise("invalid mipmap type")}v&&!("min"in t)&&(e.minFilter=9984)}}function K(t,n){e.texParameteri(n,10241,t.minFilter),e.texParameteri(n,10240,t.magFilter),e.texParameteri(n,10242,t.wrapS),e.texParameteri(n,10243,t.wrapT),r.ext_texture_filter_anisotropic&&e.texParameteri(n,34046,t.anisotropic),t.genMipmaps&&(e.hint(33170,t.mipmapHint),e.generateMipmap(n))}var Q=0,$={},J=i.maxTextureUnits,ee=Array(J).map((function(){return null}));function se(t){T.call(this),this.mipmask=0,this.internalformat=6408,this.id=Q++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Z,u.profile&&(this.stats={size:0})}function ue(t){e.activeTexture(33984),e.bindTexture(t.target,t.texture)}function ce(){var t=ee[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(3553,null)}function de(t){var n=t.texture;E(n,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(e.activeTexture(33984+r),e.bindTexture(i,null),ee[r]=null),e.deleteTexture(n),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete $[t.id],s.textureCount--}return n(se.prototype,{bind:function(){this.bindCount+=1;var t=this.unit;if(t<0){for(var n=0;n<J;++n){var r=ee[n];if(r){if(r.bindCount>0)continue;r.unit=-1}ee[n]=this,t=n;break}t>=J&&E.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<t+1&&(s.maxTextureUnits=t+1),this.unit=t,e.activeTexture(33984+t),e.bindTexture(this.target,this.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&de(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys($).forEach((function(t){e+=$[t].stats.size})),e}),{create2D:function(t,n){var r=new se(3553);function o(e,t){var n=r.texInfo;Z.call(n);var a=Y();return"number"==typeof e?V(a,0|e,"number"==typeof t?0|t:0|e):e?(E.type(e,"object","invalid arguments to regl.texture"),q(n,e),G(a,e)):V(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,C(r,a),E.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,ue(r),H(a,3553),K(n,3553),ce(),X(a),u.profile&&(r.stats.size=ke(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=_[r.internalformat],o.type=b[r.type],o.mag=x[n.magFilter],o.min=S[n.minFilter],o.wrapS=A[n.wrapS],o.wrapT=A[n.wrapT],o}return $[r.id]=r,s.textureCount++,o(t,n),o.subimage=function(e,t,n,i){E(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,c=N();return C(c,r),c.width=0,c.height=0,I(c,e),c.width=c.width||(r.width>>u)-a,c.height=c.height||(r.height>>u)-s,E(r.type===c.type&&r.format===c.format&&r.internalformat===c.internalformat,"incompatible format for texture.subimage"),E(a>=0&&s>=0&&a+c.width<=r.width&&s+c.height<=r.height,"texture.subimage write out of bounds"),E(r.mipmask&1<<u,"missing mipmap data"),E(c.data||c.element||c.needsCopy,"missing image data"),ue(r),O(c,3553,a,s,u),ce(),D(c),o},o.resize=function(t,n){var i=0|t,a=0|n||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,ue(r);for(var s=0;r.mipmask>>s;++s){var c=i>>s,l=a>>s;if(!c||!l)break;e.texImage2D(3553,s,r.format,c,l,0,r.format,r.type,null)}return ce(),u.profile&&(r.stats.size=ke(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(t,n,r,o,a,c){var l=new se(34067);$[l.id]=l,s.cubeCount++;var h=new Array(6);function f(e,t,n,r,o,a){var s,c=l.texInfo;for(Z.call(c),s=0;s<6;++s)h[s]=Y();if("number"!=typeof e&&e)if("object"==typeof e)if(t)G(h[0],e),G(h[1],t),G(h[2],n),G(h[3],r),G(h[4],o),G(h[5],a);else if(q(c,e),k(l,e),"faces"in e){var p=e.faces;for(E(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),s=0;s<6;++s)E("object"==typeof p[s]&&!!p[s],"invalid input for cube map face"),C(h[s],l),G(h[s],p[s])}else for(s=0;s<6;++s)G(h[s],e);else E.raise("invalid arguments to cube map");else{var d=0|e||1;for(s=0;s<6;++s)V(h[s],d,d)}for(C(l,h[0]),E.optional((function(){i.npotTextureCube||E(re(l.width)&&re(l.height),"your browser does not support non power or two texture dimensions")})),c.genMipmaps?l.mipmask=(h[0].width<<1)-1:l.mipmask=h[0].mipmask,E.textureCube(l,c,h,i),l.internalformat=h[0].internalformat,f.width=h[0].width,f.height=h[0].height,ue(l),s=0;s<6;++s)H(h[s],34069+s);for(K(c,34067),ce(),u.profile&&(l.stats.size=ke(l.internalformat,l.type,f.width,f.height,c.genMipmaps,!0)),f.format=_[l.internalformat],f.type=b[l.type],f.mag=x[c.magFilter],f.min=S[c.minFilter],f.wrapS=A[c.wrapS],f.wrapT=A[c.wrapT],s=0;s<6;++s)X(h[s]);return f}return f(t,n,r,o,a,c),f.subimage=function(e,t,n,r,i){E(!!t,"must specify image data"),E("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=N();return C(u,l),u.width=0,u.height=0,I(u,t),u.width=u.width||(l.width>>s)-o,u.height=u.height||(l.height>>s)-a,E(l.type===u.type&&l.format===u.format&&l.internalformat===u.internalformat,"incompatible format for texture.subimage"),E(o>=0&&a>=0&&o+u.width<=l.width&&a+u.height<=l.height,"texture.subimage write out of bounds"),E(l.mipmask&1<<s,"missing mipmap data"),E(u.data||u.element||u.needsCopy,"missing image data"),ue(l),O(u,34069+e,o,a,s),ce(),D(u),f},f.resize=function(t){var n=0|t;if(n!==l.width){f.width=l.width=n,f.height=l.height=n,ue(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)e.texImage2D(34069+r,i,l.format,n>>i,n>>i,0,l.format,l.type,null);return ce(),u.profile&&(l.stats.size=ke(l.internalformat,l.type,f.width,f.height,!1,!0)),f}},f._reglType="textureCube",f._texture=l,u.profile&&(f.stats=l.stats),f.destroy=function(){l.decRef()},f},clear:function(){for(var t=0;t<J;++t)e.activeTexture(33984+t),e.bindTexture(3553,null),ee[t]=null;U($).forEach(de),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var t=0;t<J;++t){var n=ee[t];n&&(n.bindCount=0,n.unit=-1,ee[t]=null)}U($).forEach((function(t){t.texture=e.createTexture(),e.bindTexture(t.target,t.texture);for(var n=0;n<32;++n)if(0!=(t.mipmask&1<<n))if(3553===t.target)e.texImage2D(3553,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)e.texImage2D(34069+r,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);K(t.texInfo,t.target)}))},refresh:function(){for(var t=0;t<J;++t){var n=ee[t];n&&(n.bindCount=0,n.unit=-1,ee[t]=null),e.activeTexture(33984+t),e.bindTexture(3553,null),e.bindTexture(34067,null)}}}}ge[32854]=2,ge[32855]=2,ge[36194]=2,ge[34041]=4,ge[33776]=.5,ge[33777]=.5,ge[33778]=1,ge[33779]=1,ge[35986]=.5,ge[35987]=1,ge[34798]=1,ge[35840]=.5,ge[35841]=.25,ge[35842]=.5,ge[35843]=.25,ge[36196]=.5;var Pe=[];function Ie(e,t,n){return Pe[e]*t*n}Pe[32854]=2,Pe[32855]=2,Pe[36194]=2,Pe[33189]=2,Pe[36168]=1,Pe[34041]=4,Pe[35907]=4,Pe[34836]=16,Pe[34842]=8,Pe[34843]=6;var Le=[6407,6408],Oe=[];Oe[6408]=4,Oe[6407]=3;var Re=[];Re[5121]=1,Re[5126]=4,Re[36193]=2;var Ne=[32854,32855,36194,35907,34842,34843,34836],De={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},Fe=["attributes","elements","offset","count","primitive","instances"];function Be(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}function ze(e,n,r,i,o,a,s){function u(u){var c;null===n.next?(E(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),c=5121):(E(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),c=n.next.colorAttachments[0].texture._texture.type,E.optional((function(){a.oes_texture_float?(E(5121===c||5126===c,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===c&&E(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):E(5121===c,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var l=0,h=0,f=i.framebufferWidth,p=i.framebufferHeight,d=null;t(u)?d=u:u&&(E.type(u,"object","invalid arguments to regl.read()"),l=0|u.x,h=0|u.y,E(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),E(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(u.width||i.framebufferWidth-l),p=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(5121===c?E(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===c&&E(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),E(f>0&&f+l<=i.framebufferWidth,"invalid width for read pixels"),E(p>0&&p+h<=i.framebufferHeight,"invalid height for read pixels"),r();var v=f*p*4;return d||(5121===c?d=new Uint8Array(v):5126===c&&(d=d||new Float32Array(v))),E.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),E(d.byteLength>=v,"data buffer for regl.read() too small"),e.pixelStorei(3333,4),e.readPixels(l,h,f,p,6408,c,d),d}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}(e):u(e)}}function Ue(e){return Array.prototype.slice.call(e)}function je(e){return Ue(e).join("")}var Ve="xyzw".split(""),Ge="profile",He="framebuffer",We="vert",Ye="frag",Xe="elements",Ze="primitive",qe="count",Ke="offset",Qe="instances",$e="vao",Je=He+"Width",et=He+"Height",tt=["blend.func","blend.equation","stencil.func","stencil.opFront","stencil.opBack","sample.coverage","viewport","scissor.box","polygonOffset.offset"],nt={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},rt=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],it={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ot={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},at={frag:35632,vert:35633},st={cw:2304,ccw:2305};function ut(e){return Array.isArray(e)||t(e)||z(e)}function ct(e){return e.sort((function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1}))}function lt(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function ht(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ft(e){return new lt(!1,!1,!1,e)}function pt(e,t){var n=e.type;if(0===n){var r=e.data.length;return new lt(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new lt(i.thisDep,i.contextDep,i.propDep,t)}if(5===n)return new lt(!1,!1,!1,t);if(6===n){for(var o=!1,a=!1,s=!1,u=0;u<e.data.length;++u){var c=e.data[u];if(1===c.type)s=!0;else if(2===c.type)a=!0;else if(3===c.type)o=!0;else if(0===c.type){o=!0;var l=c.data;l>=1&&(a=!0),l>=2&&(s=!0)}else 4===c.type&&(o=o||c.data.thisDep,a=a||c.data.contextDep,s=s||c.data.propDep)}return new lt(o,a,s,t)}return new lt(3===n,2===n,1===n,t)}var dt=new lt(!1,!1,!1,(function(){}));function vt(t,r,i,o,a,s,u,c,l,h,f,p,d,v,g){var m=h.Record,y={add:32774,subtract:32778,"reverse subtract":32779};i.ext_blend_minmax&&(y.min=32775,y.max=32776);var _=i.angle_instanced_arrays,b=i.webgl_draw_buffers,x=i.oes_vertex_array_object,S={dirty:!0,profile:g.profile},A={},w=[],T={},C={};function M(e){return e.replace(".","_")}function P(e,t,n){var r=M(e);w.push(e),A[r]=S[r]=!!n,T[r]=t}function I(e,t,n){var r=M(e);w.push(e),Array.isArray(n)?(S[r]=n.slice(),A[r]=n.slice()):S[r]=A[r]=n,C[r]=t}P("dither",3024),P("blend.enable",3042),I("blend.color","blendColor",[0,0,0,0]),I("blend.equation","blendEquationSeparate",[32774,32774]),I("blend.func","blendFuncSeparate",[1,0,1,0]),P("depth.enable",2929,!0),I("depth.func","depthFunc",513),I("depth.range","depthRange",[0,1]),I("depth.mask","depthMask",!0),I("colorMask","colorMask",[!0,!0,!0,!0]),P("cull.enable",2884),I("cull.face","cullFace",1029),I("frontFace","frontFace",2305),I("lineWidth","lineWidth",1),P("polygonOffset.enable",32823),I("polygonOffset.offset","polygonOffset",[0,0]),P("sample.alpha",32926),P("sample.enable",32928),I("sample.coverage","sampleCoverage",[1,!1]),P("stencil.enable",2960),I("stencil.mask","stencilMask",-1),I("stencil.func","stencilFunc",[519,0,-1]),I("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),I("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),P("scissor.enable",3089),I("scissor.box","scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),I("viewport","viewport",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var L={gl:t,context:d,strings:r,next:A,current:S,draw:p,elements:s,buffer:a,shader:f,attributes:h.state,vao:h,uniforms:l,framebuffer:c,extensions:i,timer:v,isBufferArgs:ut},O={primTypes:$,compareFuncs:it,blendFuncs:nt,blendEquations:y,stencilOps:ot,glTypes:H,orientationType:st};E.optional((function(){L.isArrayLike=ne})),b&&(O.backBuffer=[1029],O.drawBuffer=N(o.maxDrawbuffers,(function(e){return 0===e?[0]:N(e,(function(e){return 36064+e}))})));var R=0;function D(){var t=function(){var t=0,r=[],i=[];function o(){var e=[],r=[];return n((function(){e.push.apply(e,Ue(arguments))}),{def:function(){var n="v"+t++;return r.push(n),arguments.length>0&&(e.push(n,"="),e.push.apply(e,Ue(arguments)),e.push(";")),n},toString:function(){return je([r.length>0?"var "+r.join(",")+";":"",je(e)])}})}function a(){var e=o(),t=o(),r=e.toString,i=t.toString;function a(n,r){t(n,r,"=",e.def(n,r),";")}return n((function(){e.apply(e,Ue(arguments))}),{def:e.def,entry:e,exit:t,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+i()}})}var s=o(),u={};return{global:s,link:function(e){for(var n=0;n<i.length;++n)if(i[n]===e)return r[n];var o="g"+t++;return r.push(o),i.push(e),o},block:o,proc:function(e,t){var r=[];function i(){var e="a"+r.length;return r.push(e),e}t=t||0;for(var o=0;o<t;++o)i();var s=a(),c=s.toString;return u[e]=n(s,{arg:i,toString:function(){return je(["function(",r.join(),"){",c(),"}"])}})},scope:a,cond:function(){var e=je(arguments),t=a(),r=a(),i=t.toString,o=r.toString;return n(t,{then:function(){return t.apply(t,Ue(arguments)),this},else:function(){return r.apply(r,Ue(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),je(["if(",e,"){",i(),"}",t])}})},compile:function(){var t=['"use strict";',s,"return {"];Object.keys(u).forEach((function(e){t.push('"',e,'":',u[e].toString(),",")})),t.push("}");var n=je(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?e.Function.apply(null,r.concat(n)):Function.apply(null,r.concat(n))).apply(null,i)}}}(),i=t.link,o=t.global;t.id=R++,t.batchId="0";var a=i(L),s=t.shared={props:"a0"};Object.keys(L).forEach((function(e){s[e]=o.def(a,".",e)})),E.optional((function(){t.CHECK=i(E),t.commandStr=E.guessCommand(),t.command=i(t.commandStr),t.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",i(n),",",this.command,");")},O.invalidBlendCombinations=rt}));var u=t.next={},c=t.current={};Object.keys(C).forEach((function(e){Array.isArray(S[e])&&(u[e]=o.def(s.next,".",e),c[e]=o.def(s.current,".",e))}));var l=t.constants={};Object.keys(O).forEach((function(e){l[e]=o.def(JSON.stringify(O[e]))})),t.invoke=function(e,n){switch(n.type){case 0:var r=["this",s.context,s.props,t.batchId];return e.def(i(n.data),".call(",r.slice(0,Math.max(n.data.length+1,4)),")");case 1:return e.def(s.props,n.data);case 2:return e.def(s.context,n.data);case 3:return e.def("this",n.data);case 4:return n.data.append(t,e),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map((function(n){return t.invoke(e,n)}))}},t.attribCache={};var f={};return t.scopeAttrib=function(e){var t=r.id(e);if(t in f)return f[t];var n=h.scope[t];return n||(n=h.scope[t]=new m),f[t]=i(n)},t}function F(e,t,n,u,l){var p=e.static,d=e.dynamic;E.optional((function(){var e=[He,We,Ye,Xe,Ze,Ke,qe,Qe,Ge,$e].concat(w);function t(t){Object.keys(t).forEach((function(t){E.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',l.commandStr)}))}t(p),t(d)}));var v=function(e,t){var n=e.static;if("string"==typeof n[Ye]&&"string"==typeof n[We]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)E("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),g=function(e,t){var n=e.static,r=e.dynamic;if(He in n){var i=n[He];return i?(i=c.getFramebuffer(i),E.command(i,"invalid framebuffer object"),ft((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+Je,n+".width"),t.set(o,"."+et,n+".height"),n}))):ft((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Je,r+".drawingBufferWidth"),t.set(r,"."+et,r+".drawingBufferHeight"),"null"}))}if(He in r){var o=r[He];return pt(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");E.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+Je,a+"?"+a+".width:"+s+".drawingBufferWidth"),t.set(s,"."+et,a+"?"+a+".height:"+s+".drawingBufferHeight"),a}))}return null}(e),b=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];E.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,c=0|o.x,l=0|o.y;return"width"in o?(a=0|o.width,E.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,E.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new lt(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",Je,"-",c));var i=s;return"height"in o||(i=t.def(n,".",et,"-",l)),[c,l,r,i]}))}if(e in i){var h=i[e],f=pt(h,(function(t,n){var r=t.invoke(n,h);E.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Je,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",et,"-",a,")");return E.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(f.thisDep=f.thisDep||t.thisDep,f.contextDep=f.contextDep||t.contextDep,f.propDep=f.propDep||t.propDep),f}return t?new lt(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Je),t.def(n,".",et)]})):null}var a=o("viewport");if(a){var s=a;a=new lt(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,".viewportWidth",n[2]),t.set(r,".viewportHeight",n[3]),n}))}return{viewport:a,scissor_box:o("scissor.box")}}(e,g,l),x=function(e,t){var n=e.static,r=e.dynamic,i={},o=!1,a=function(){if($e in n){var e=n[$e];return null!==e&&null===h.getVAO(e)&&(e=h.createVAO(e)),o=!0,i.vao=e,ft((function(t){var n=h.getVAO(e);return n?t.link(n):"null"}))}if($e in r){o=!0;var t=r[$e];return pt(t,(function(e,n){var r=e.invoke(n,t);return n.def(e.shared.vao+".getVAO("+r+")")}))}return null}(),u=!1,c=function(){if(Xe in n){var e=n[Xe];if(i.elements=e,ut(e)){var c=i.elements=s.create(e,!0);e=s.getElements(c),u=!0}else e&&(e=s.getElements(e),u=!0,E.command(e,"invalid elements",t.commandStr));var l=ft((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return l.value=e,l}if(Xe in r){u=!0;var h=r[Xe];return pt(h,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,o=e.invoke(t,h),a=t.def("null"),s=t.def(r,"(",o,")"),u=e.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return E.optional((function(){e.assert(u.else,"!"+o+"||"+a,"invalid elements")})),t.entry(u),t.exit(e.cond(s).then(i,".destroyStream(",a,");")),e.ELEMENTS=a,a}))}return o?new lt(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")})):null}();function l(e,s){if(e in n){var c=0|n[e];return s?i.offset=c:i.instances=c,E.command(!s||c>=0,"invalid "+e,t.commandStr),ft((function(e,t){return s&&(e.OFFSET=c),c}))}if(e in r){var l=r[e];return pt(l,(function(t,n){var r=t.invoke(n,l);return s&&(t.OFFSET=r,E.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}if(s){if(u)return ft((function(e,t){return e.OFFSET=0,0}));if(o)return new lt(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")}))}else if(o)return new lt(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")}));return null}var f=l(Ke,!0),p=function(){if(Ze in n){var e=n[Ze];return i.primitive=e,E.commandParameter(e,$,"invalid primitve",t.commandStr),ft((function(t,n){return $[e]}))}if(Ze in r){var s=r[Ze];return pt(s,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,s);return E.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys($))})),t.def(n,"[",r,"]")}))}return u?ht(c)?c.value?ft((function(e,t){return t.def(e.ELEMENTS,".primType")})):ft((function(){return 4})):new lt(c.thisDep,c.contextDep,c.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):o?new lt(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:4")})):null}(),d=function(){if(qe in n){var e=0|n[qe];return i.count=e,E.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),ft((function(){return e}))}if(qe in r){var s=r[qe];return pt(s,(function(e,t){var n=e.invoke(t,s);return E.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(u){if(ht(c)){if(c)return f?new lt(f.thisDep,f.contextDep,f.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return E.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):ft((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var l=ft((function(){return-1}));return E.optional((function(){l.MISSING=!0})),l}var h=new lt(c.thisDep||f.thisDep,c.contextDep||f.contextDep,c.propDep||f.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return E.optional((function(){h.DYNAMIC=!0})),h}return o?new lt(a.thisDep,a.contextDep,a.propDep,(function(e,t){return t.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")})):null}(),v=l(Qe,!1);return{elements:c,primitive:p,count:d,instances:v,offset:f,vao:a,vaoActive:o,elementsActive:u,static:i}}(e,l),S=function(e,t){var n=e.static,r=e.dynamic,i={};return w.forEach((function(e){var a=M(e);function s(t,o){if(e in n){var s=t(n[e]);i[a]=ft((function(){return s}))}else if(e in r){var u=r[e];i[a]=pt(u,(function(e,t){return o(e,t,e.invoke(t,u))}))}}switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return s((function(n){return E.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return E.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case"depth.func":return s((function(n){return E.commandParameter(n,it,"invalid "+e,t.commandStr),it[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return E.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(it))})),n.def(i,"[",r,"]")}));case"depth.range":return s((function(e){return E.command(ne(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return E.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case"blend.func":return s((function(e){E.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return E.commandParameter(n,nt,a+".srcRGB",t.commandStr),E.commandParameter(r,nt,a+".srcAlpha",t.commandStr),E.commandParameter(i,nt,a+".dstRGB",t.commandStr),E.commandParameter(o,nt,a+".dstAlpha",t.commandStr),E.command(-1===rt.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[nt[n],nt[i],nt[r],nt[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return E.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(nt))})),s}E.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");E.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),c=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),c,n.def(i,"[",o("dst","Alpha"),"]")]}));case"blend.equation":return s((function(n){return"string"==typeof n?(E.commandParameter(n,y,"invalid "+e,t.commandStr),[y[n],y[n]]):"object"==typeof n?(E.commandParameter(n.rgb,y,e+".rgb",t.commandStr),E.commandParameter(n.alpha,y,e+".alpha",t.commandStr),[y[n.rgb],y[n.alpha]]):void E.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return E.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(y))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case"blend.color":return s((function(e){return E.command(ne(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),N(4,(function(t){return+e[t]}))}),(function(e,t,n){return E.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),N(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case"stencil.mask":return s((function(e){return E.commandType(e,"number",a,t.commandStr),0|e}),(function(e,t,n){return E.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case"stencil.func":return s((function(n){E.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return E.commandParameter(r,it,e+".cmp",t.commandStr),E.commandType(i,"number",e+".ref",t.commandStr),E.commandType(o,"number",e+".mask",t.commandStr),[it[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return E.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",7680),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return s((function(n){E.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return E.commandParameter(r,ot,e+".fail",t.commandStr),E.commandParameter(i,ot,e+".zfail",t.commandStr),E.commandParameter(o,ot,e+".zpass",t.commandStr),["stencil.opBack"===e?1029:1028,ot[r],ot[i],ot[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return E.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(ot))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",7680)}return E.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),["stencil.opBack"===e?1029:1028,o("fail"),o("zfail"),o("zpass")]}));case"polygonOffset.offset":return s((function(e){E.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return E.commandType(n,"number",a+".factor",t.commandStr),E.commandType(r,"number",a+".units",t.commandStr),[n,r]}),(function(t,n,r){return E.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case"cull.face":return s((function(e){var n=0;return"front"===e?n=1028:"back"===e&&(n=1029),E.command(!!n,a,t.commandStr),n}),(function(e,t,n){return E.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',1028,":",1029)}));case"lineWidth":return s((function(e){return E.command("number"==typeof e&&e>=o.lineWidthDims[0]&&e<=o.lineWidthDims[1],"invalid line width, must be a positive number between "+o.lineWidthDims[0]+" and "+o.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return E.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+o.lineWidthDims[0]+"&&"+n+"<="+o.lineWidthDims[1],"invalid line width")})),n}));case"frontFace":return s((function(e){return E.commandParameter(e,st,a,t.commandStr),st[e]}),(function(e,t,n){return E.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:2305')}));case"colorMask":return s((function(e){return E.command(ne(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return E.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),N(4,(function(e){return"!!"+n+"["+e+"]"}))}));case"sample.coverage":return s((function(e){E.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return E.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return E.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),i}(e,l),A=function(e,t,n){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=r.id(i[e]);E.optional((function(){f.shader(at[e],t,E.guessCommand())}));var n=ft((function(){return t}));return n.id=t,n}if(e in o){var a=o[e];return pt(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return E.optional((function(){n(t.shared.shader,".shader(",at[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(Ye),c=a(We),l=null;return ht(u)&&ht(c)?(l=f.program(c.id,u.id,null,n),s=ft((function(e,t){return e.link(l)}))):s=new lt(u&&u.thisDep||c&&c.thisDep,u&&u.contextDep||c&&c.contextDep,u&&u.propDep||c&&c.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",Ye);var i=r+".program("+(c?c.append(e,t):t.def(r,".",We))+","+n;return E.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:c,progVar:s,program:l}}(e,0,v);function T(e){var t=b[e];t&&(S[e]=t)}T("viewport"),T(M("scissor.box"));var C=Object.keys(S).length>0,k={framebuffer:g,draw:x,shader:A,state:S,dirty:C,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(k.profile=function(e){var t,n=e.static,r=e.dynamic;if(Ge in n){var i=!!n[Ge];(t=ft((function(e,t){return i}))).enable=i}else if(Ge in r){var o=r[Ge];t=pt(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),k.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=ft((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=ft((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(E.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=ft((function(e){return e.link(o.color[0])}))):E.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else ne(o)?r=ft((function(t){return t.global.def("[",N(o.length,(function(n){return E.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):E.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=pt(t,(function(e,n){return e.invoke(n,t)}))})),i}(n,l),k.drawVAO=k.scopeVAO=x.vao,!k.drawVAO&&A.program&&!v&&i.angle_instanced_arrays&&x.static.elements){var P=!0,I=A.program.attributes.map((function(e){var n=t.static[e];return P=P&&!!n,n}));if(P&&I.length>0){var L=h.getVAO(h.createVAO({attributes:I,elements:x.static.elements}));k.drawVAO=new lt(null,null,null,(function(e,t){return e.link(L)})),k.useVAO=!0}}return v?k.useVAO=!0:k.attributes=function(e,t){var n=e.static,i=e.dynamic,o={};return Object.keys(n).forEach((function(e){var i=n[e],s=r.id(e),u=new m;if(ut(i))u.state=1,u.buffer=a.getBuffer(a.create(i,34962,!1,!0)),u.type=0;else{var c=a.getBuffer(i);if(c)u.state=1,u.buffer=c,u.type=0;else if(E.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var l=i.constant;u.buffer="null",u.state=2,"number"==typeof l?u.x=l:(E.command(ne(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e,t.commandStr),Ve.forEach((function(e,t){t<l.length&&(u[e]=l[t])})))}else{c=ut(i.buffer)?a.getBuffer(a.create(i.buffer,34962,!1,!0)):a.getBuffer(i.buffer),E.command(!!c,'missing buffer for attribute "'+e+'"',t.commandStr);var h=0|i.offset;E.command(h>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var f=0|i.stride;E.command(f>=0&&f<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var p=0|i.size;E.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var d=!!i.normalized,v=0;"type"in i&&(E.commandParameter(i.type,H,"invalid type for attribute "+e,t.commandStr),v=H[i.type]);var g=0|i.divisor;E.optional((function(){"divisor"in i&&(E.command(0===g||_,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),E.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr));var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){E.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),u.buffer=c,u.state=1,u.size=p,u.normalized=d,u.type=v||c.dtype,u.offset=h,u.stride=f,u.divisor=g}}o[e]=ft((function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(e){r[e]=u[e]})),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];o[e]=pt(t,(function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;E.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var c={isStream:r.def(!1)},l=new m;l.state=1,Object.keys(l).forEach((function(e){c[e]=r.def(""+l[e])}));var h=c.buffer,f=c.type;function p(e){r(c[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",c.isStream,"=true;",h,"=",u,".createStream(",34962,",",i,");",f,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",f,"=",h,".dtype;",'}else if("constant" in ',i,"){",c.state,"=",2,";","if(typeof "+i+'.constant === "number"){',c[Ve[0]],"=",i,".constant;",Ve.slice(1).map((function(e){return c[e]})).join("="),"=0;","}else{",Ve.map((function(e,t){return c[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",34962,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",c.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",c.isStream,"){",u,".destroyStream(",h,");","}"),c}))})),o}(t,l),k.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=ft((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=pt(t,(function(e,n){return e.invoke(n,t)}))})),r}(u),k}function B(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o].append(e,t);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),t(i)}function z(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;b&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,c=e.constants,l=c.drawBuffer,h=c.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",l,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),b&&t(i,".drawBuffersWEBGL(",h,");"),t("}",s,".cur=",u,";"),r||t("}")}function U(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,c=e.cond(s,".dirty");w.forEach((function(t){var r,l,h=M(t);if(!(h in n.state))if(h in a){r=a[h],l=o[h];var f=N(S[h].length,(function(e){return c.def(r,"[",e,"]")}));c(e.cond(f.map((function(e,t){return e+"!=="+l+"["+t+"]"})).join("||")).then(i,".",C[h],"(",f,");",f.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";"))}else{r=c.def(u,".",h);var p=e.cond(r,"!==",s,".",h);c(p),h in T?p(e.cond(r).then(i,".enable(",T[h],");").else(i,".disable(",T[h],");"),s,".",h,"=",r,";"):p(i,".",C[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&c(s,".dirty=false;"),t(c)}function j(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;ct(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var c=u.append(e,t);if(T[i]){var l=T[i];ht(u)?t(s,c?".enable(":".disable(",l,");"):t(e.cond(c).then(s,".enable(",l,");").else(s,".disable(",l,");")),t(a,".",i,"=",c,";")}else if(ne(c)){var h=o[i];t(s,".",C[i],"(",c,");",c.map((function(e,t){return h+"["+t+"]="+e})).join(";"),";")}else t(s,".",C[i],"(",c,");",a,".",i,"=",c,";")}}))}function V(e,t){_&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function G(e,t,n,r,i){var o,a,s,u=e.shared,c=e.stats,l=u.current,h=u.timer,f=n.profile;function p(){return"undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM||"undefined"==typeof performance?"Date.now()":"performance.now()"}function d(e){e(o=t.def(),"=",p(),";"),"string"==typeof i?e(c,".count+=",i,";"):e(c,".count++;"),v&&(r?e(a=t.def(),"=",h,".getNumPendingQueries();"):e(h,".beginQuery(",c,");"))}function g(e){e(c,".cpuTime+=",p(),"-",o,";"),v&&(r?e(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",c,");"):e(h,".endQuery();"))}function m(e){var n=t.def(l,".profile");t(l,".profile=",e,";"),t.exit(l,".profile=",n,";")}if(f){if(ht(f))return void(f.enable?(d(t),g(t.exit),m("true")):m("false"));m(s=f.append(e,t))}else s=t.def(l,".profile");var y=e.block();d(y),t("if(",s,"){",y,"}");var _=e.block();g(_),t.exit("if(",s,"){",_,"}")}function W(e,t,n,r,i){var o=e.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(dt))return;var c=e.scopeAttrib(s);E.optional((function(){e.assert(t,c+".state","missing attribute "+s)})),a={},Object.keys(new m).forEach((function(e){a[e]=t.def(c,".",e)}))}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),c=i.state,l=i.buffer,h=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function p(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",f.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",34962,",",l,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",f.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),_){var c=i.divisor;t("if(",u,".divisor!==",c,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,c],");",u,".divisor=",c,";}")}}function d(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Ve.map((function(e,t){return u+"."+e+"!=="+h[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",h,");",Ve.map((function(e,t){return u+"."+e+"="+h[t]+";"})).join(""),"}")}1===c?p():2===c?d():(t("if(",c,"===",1,"){"),p(),t("}else{"),d(),t("}"))}(e.link(r),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(r.info.type),a)}))}function Y(e,t,n,i,o,a){for(var s,u=e.shared,c=u.gl,l=0;l<i.length;++l){var h,f=i[l],p=f.name,d=f.info.type,v=n.uniforms[p],g=e.link(f)+".location";if(v){if(!o(v))continue;if(ht(v)){var m=v.value;if(E.command(null!=m,'missing uniform "'+p+'"',e.commandStr),35678===d||35680===d){E.command("function"==typeof m&&(35678===d&&("texture2d"===m._reglType||"framebuffer"===m._reglType)||35680===d&&("textureCube"===m._reglType||"framebufferCube"===m._reglType)),"invalid texture for uniform "+p,e.commandStr);var y=e.link(m._texture||m.color[0]._texture);t(c,".uniform1i(",g,",",y+".bind());"),t.exit(y,".unbind();")}else if(35674===d||35675===d||35676===d){E.optional((function(){E.command(ne(m),"invalid matrix for uniform "+p,e.commandStr),E.command(35674===d&&4===m.length||35675===d&&9===m.length||35676===d&&16===m.length,"invalid length for matrix uniform "+p,e.commandStr)}));var _=e.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),b=2;35675===d?b=3:35676===d&&(b=4),t(c,".uniformMatrix",b,"fv(",g,",false,",_,");")}else{switch(d){case 5126:E.commandType(m,"number","uniform "+p,e.commandStr),s="1f";break;case 35664:E.command(ne(m)&&2===m.length,"uniform "+p,e.commandStr),s="2f";break;case 35665:E.command(ne(m)&&3===m.length,"uniform "+p,e.commandStr),s="3f";break;case 35666:E.command(ne(m)&&4===m.length,"uniform "+p,e.commandStr),s="4f";break;case 35670:E.commandType(m,"boolean","uniform "+p,e.commandStr),s="1i";break;case 5124:E.commandType(m,"number","uniform "+p,e.commandStr),s="1i";break;case 35671:case 35667:E.command(ne(m)&&2===m.length,"uniform "+p,e.commandStr),s="2i";break;case 35672:case 35668:E.command(ne(m)&&3===m.length,"uniform "+p,e.commandStr),s="3i";break;case 35673:case 35669:E.command(ne(m)&&4===m.length,"uniform "+p,e.commandStr),s="4i"}t(c,".uniform",s,"(",g,",",ne(m)?Array.prototype.slice.call(m):m,");")}continue}h=v.append(e,t)}else{if(!o(dt))continue;h=t.def(u.uniforms,"[",r.id(p),"]")}35678===d?(E(!Array.isArray(h),"must specify a scalar prop for textures"),t("if(",h,"&&",h,'._reglType==="framebuffer"){',h,"=",h,".color[0];","}")):35680===d&&(E(!Array.isArray(h),"must specify a scalar prop for cube maps"),t("if(",h,"&&",h,'._reglType==="framebufferCube"){',h,"=",h,".color[0];","}")),E.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+p+'".  '+r)}function r(e){E(!Array.isArray(h),"must not specify an array type for uniform"),n("typeof "+h+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){Array.isArray(h)?E(h.length===t,"must have length "+t):n(u.isArrayLike+"("+h+")&&"+h+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){E(!Array.isArray(h),"must not specify a value type"),n("typeof "+h+'==="function"&&'+h+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(d){case 5124:r("number");break;case 35667:i(2);break;case 35668:i(3);break;case 35669:i(4);break;case 5126:r("number");break;case 35664:i(2);break;case 35665:i(3);break;case 35666:i(4);break;case 35670:r("boolean");break;case 35671:i(2);break;case 35672:i(3);break;case 35673:case 35674:i(4);break;case 35675:i(9);break;case 35676:i(16);break;case 35678:o(3553);break;case 35680:o(34067)}}));var x=1;switch(d){case 35678:case 35680:var S=t.def(h,"._texture");t(c,".uniform1i(",g,",",S,".bind());"),t.exit(S,".unbind();");continue;case 5124:case 35670:s="1i";break;case 35667:case 35671:s="2i",x=2;break;case 35668:case 35672:s="3i",x=3;break;case 35669:case 35673:s="4i",x=4;break;case 5126:s="1f";break;case 35664:s="2f",x=2;break;case 35665:s="3f",x=3;break;case 35666:s="4f",x=4;break;case 35674:s="Matrix2fv";break;case 35675:s="Matrix3fv";break;case 35676:s="Matrix4fv"}if("M"===s.charAt(0)){t(c,".uniform",s,"(",g,",");var A=Math.pow(d-35674+2,2),w=e.global.def("new Float32Array(",A,")");Array.isArray(h)?t("false,(",N(A,(function(e){return w+"["+e+"]="+h[e]})),",",w,")"):t("false,(Array.isArray(",h,")||",h," instanceof Float32Array)?",h,":(",N(A,(function(e){return w+"["+e+"]="+h+"["+e+"]"})),",",w,")"),t(");")}else if(x>1){for(var T=[],C=[],k=0;k<x;++k)Array.isArray(h)?C.push(h[k]):C.push(t.def(h+"["+k+"]")),a&&T.push(t.def());a&&t("if(!",e.batchId,"||",T.map((function(e,t){return e+"!=="+C[t]})).join("||"),"){",T.map((function(e,t){return e+"="+C[t]+";"})).join("")),t(c,".uniform",s,"(",g,",",C.join(","),");"),a&&t("}")}else{if(E(!Array.isArray(h),"uniform value must not be an array"),a){var M=t.def();t("if(!",e.batchId,"||",M,"!==",h,"){",M,"=",h,";")}t(c,".uniform",s,"(",g,",",h,");"),a&&t("}")}}}function X(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw,u=function(){var u,c=s.elements,l=t;return c?((c.contextDep&&r.contextDynamic||c.propDep)&&(l=n),u=c.append(e,l),s.elementsActive&&l("if("+u+")"+o+".bindBuffer(34963,"+u+".buffer.buffer);")):(u=l.def(),l(u,"=",a,".",Xe,";","if(",u,"){",o,".bindBuffer(",34963,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",e.shared.elements+".getElements("+i.vao,".currentVAO.elements);",x?"":"if("+u+")"+o+".bindBuffer(34963,"+u+".buffer.buffer);","}")),u}();function c(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var l,h,f=c(Ze),p=c(Ke),d=function(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),E.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",qe),E.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");_&&(l=c(Qe),h=e.instancing);var v=u+".type",g=s.elements&&ht(s.elements)&&!s.vaoActive;function m(){function e(){n(h,".drawElementsInstancedANGLE(",[f,d,v,p+"<<(("+v+"-5121)>>1)",l],");")}function t(){n(h,".drawArraysInstancedANGLE(",[f,p,d,l],");")}u&&"null"!==u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function y(){function e(){n(o+".drawElements("+[f,d,v,p+"<<(("+v+"-5121)>>1)"]+");")}function t(){n(o+".drawArrays("+[f,p,d]+");")}u&&"null"!==u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}_&&("number"!=typeof l||l>=0)?"string"==typeof l?(n("if(",l,">0){"),m(),n("}else if(",l,"<0){"),y(),n("}")):m():y()}function Z(e,t,n,r,i){var o=D(),a=o.proc("body",i);return E.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),_&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function q(e,t,n,r){V(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),W(e,t,n,r.attributes,(function(){return!0}))),Y(e,t,n,r.uniforms,(function(){return!0}),!1),X(e,t,t,n)}function K(e,t,n,r){function i(){return!0}e.batchId="a1",V(e,t),W(e,t,n,r.attributes,i),Y(e,t,n,r.uniforms,i,!1),X(e,t,t,n)}function Q(e,t,n,r){V(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),u=e.scope();function c(e){return e.contextDep&&i||e.propDep}function l(e){return!c(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&B(e,u,n.context),n.needsFramebuffer&&z(e,u,n.framebuffer),j(e,u,n.state,c),n.profile&&c(n.profile)&&G(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?c(n.drawVAO)?u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),W(e,s,n,r.attributes,l),W(e,u,n,r.attributes,c)),Y(e,s,n,r.uniforms,l,!1),Y(e,u,n,r.uniforms,c,!0),X(e,s,u,n);else{var h=e.global.def("{}"),f=n.shader.progVar.append(e,u),p=u.def(f,".id"),d=u.def(h,"[",p,"]");u(e.shared.gl,".useProgram(",f,".program);","if(!",d,"){",d,"=",h,"[",p,"]=",e.link((function(t){return Z(K,e,n,t,2)})),"(",f,");}",d,".call(this,a0[",o,"],",o,");")}}function J(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!ne(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(k.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,c=e.global.def("{}");o.forEach((function(t){var n=r[t];if(k.isDynamic(n)){"function"==typeof n&&(n=r[t]=k.unbox(n));var o=pt(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(c,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new k.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:c,append:function(e,t){o.forEach((function(n){var i=r[n];if(k.isDynamic(i)){var o=e.invoke(t,i);t(c,".",n,"=",o,";")}}))}}),delete t.static[n]}}return{next:A,current:S,procs:function(){var e=D(),t=e.proc("poll"),n=e.proc("refresh"),r=e.block();t(r),n(r);var a,s=e.shared,u=s.gl,c=s.next,l=s.current;r(l,".dirty=false;"),z(e,t),z(e,n,null,!0),_&&(a=e.link(_)),i.oes_vertex_array_object&&n(e.link(i.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<o.maxAttributes;++h){var f=n.def(s.attributes,"[",h,"]"),p=e.cond(f,".buffer");p.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",34962,",",f,".buffer.buffer);",u,".vertexAttribPointer(",h,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),n(p),_&&n(a,".vertexAttribDivisorANGLE(",h,",",f,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(T).forEach((function(i){var o=T[i],a=r.def(c,".",i),s=e.block();s("if(",a,"){",u,".enable(",o,")}else{",u,".disable(",o,")}",l,".",i,"=",a,";"),n(s),t("if(",a,"!==",l,".",i,"){",s,"}")})),Object.keys(C).forEach((function(i){var o,a,s=C[i],h=S[i],f=e.block();if(f(u,".",s,"("),ne(h)){var p=h.length;o=e.global.def(c,".",i),a=e.global.def(l,".",i),f(N(p,(function(e){return o+"["+e+"]"})),");",N(p,(function(e){return a+"["+e+"]="+o+"["+e+"];"})).join("")),t("if(",N(p,(function(e){return o+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",f,"}")}else o=r.def(c,".",i),a=r.def(l,".",i),f(o,");",l,".",i,"=",o,";"),t("if(",o,"!==",a,"){",f,"}");n(f)})),e.compile()}(),compile:function(e,t,i,o,a){var s=D();s.stats=s.link(a),Object.keys(t.static).forEach((function(e){J(s,t,e)})),tt.forEach((function(t){J(s,e,t)}));var u=F(e,t,i,o,s);return function(e,t){var n=e.proc("draw",1);V(e,n),B(e,n,t.context),z(e,n,t.framebuffer),U(e,n,t),j(e,n,t.state),G(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return Z(q,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}(s,u),function(e,t){var n=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(r){var o=t.shader[r];o&&n.set(i.shader,"."+r,o.append(e,n))}B(e,n,t.context),t.framebuffer&&t.framebuffer.append(e,n),ct(Object.keys(t.state)).forEach((function(r){var o=t.state[r].append(e,n);ne(o)?o.forEach((function(t,i){n.set(e.next[r],"["+i+"]",t)})):n.set(i.next,"."+r,o)})),G(e,n,t,!0,!0),[Xe,Ke,qe,Qe,Ze].forEach((function(r){var o=t.draw[r];o&&n.set(i.draw,"."+r,""+o.append(e,n))})),Object.keys(t.uniforms).forEach((function(o){var a=t.uniforms[o].append(e,n);Array.isArray(a)&&(a="["+a.join()+"]"),n.set(i.uniforms,"["+r.id(o)+"]",a)})),Object.keys(t.attributes).forEach((function(r){var i=t.attributes[r].append(e,n),o=e.scopeAttrib(r);Object.keys(new m).forEach((function(e){n.set(o,"."+e,i[e])}))})),t.scopeVAO&&n.set(i.vao,".targetVAO",t.scopeVAO.append(e,n)),a(We),a(Ye),Object.keys(t.state).length>0&&(n(o,".dirty=true;"),n.exit(o,".dirty=true;")),n("a1(",e.shared.context,",a0,",e.batchId,");")}(s,u),function(e,t){var n=e.proc("batch",2);e.batchId="0",V(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(B(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||z(e,n,o)):z(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),U(e,n,t),j(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||G(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)Q(e,n,t,null);else{var c=u.append(e,n);if(n(e.shared.gl,".useProgram(",c,".program);"),t.shader.program)Q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var l=e.global.def("{}"),h=n.def(c,".id"),f=n.def(l,"[",h,"]");n(e.cond(f).then(f,".call(this,a0,a1);").else(f,"=",l,"[",h,"]=",e.link((function(n){return Z(Q,e,t,n,2)})),"(",c,");",f,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}(s,u),n(s.compile(),{destroy:function(){u.shader.program.destroy()}})}}}var gt=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var u=[];function c(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var l=[],h=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),c(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:c,update:function(){var e,n,o=i.length;if(0!==o){h.length=Math.max(h.length,o+1),l.length=Math.max(l.length,o+1),l[0]=0,h[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var c=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(c,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(c,34918),r(c)):i[e++]=c,l[n+1]=a,h[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var f=u[n],p=f.startQueryIndex,d=f.endQueryIndex;f.sum+=l[d]-l[p];var v=h[p],g=h[d];g===v?(f.stats.gpuTime+=f.sum/1e6,s(f)):(f.startQueryIndex=v,f.endQueryIndex=g,u[e++]=f)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}};function mt(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(e){var r=O(e);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=R(i,r);if(!s)return null;var u,c,l=(u={"":0},c=[""],{id:function(e){var t=u[e];return t||(t=u[e]=c.length,c.push(e),t)},str:function(e){return c[e]}}),h={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},f=s.extensions,p=gt(0,f),d=P(),v=i.drawingBufferWidth,g=i.drawingBufferHeight,m={tick:0,time:0,viewportWidth:v,viewportHeight:g,framebufferWidth:v,framebufferHeight:g,drawingBufferWidth:v,drawingBufferHeight:g,pixelRatio:r.pixelRatio},y={elements:null,primitive:4,count:-1,offset:0,instances:-1},_=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(3553,a),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,a,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=B.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),B.freeType(u)}}var c=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var l=e.createTexture(),h=B.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,l),e.texImage2D(34069,0,6408,3,3,0,6408,5121,h),B.freeType(h),e.bindTexture(34067,null),e.deleteTexture(l),c=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:c}}(i,f),b=function(e,n,r,i){var o=0,a={};function s(t){this.id=o++,this.buffer=e.createBuffer(),this.type=t,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function c(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function l(e,n,r,i,o,a){var s,u;if(e.usage=r,Array.isArray(n)){if(e.dtype=i||5126,n.length>0)if(Array.isArray(n[0])){s=X(n);for(var l=1,h=1;h<s.length;++h)l*=s[h];e.dimension=l,c(e,u=Y(n,s,e.dtype),r),a?e.persistentData=u:B.freeType(u)}else if("number"==typeof n[0]){e.dimension=o;var f=B.allocType(e.dtype,n.length);K(f,n),c(e,f,r),a?e.persistentData=f:B.freeType(f)}else t(n[0])?(e.dimension=n[0].length,e.dtype=i||q(n[0])||5126,c(e,u=Y(n,[n.length,n[0].length],e.dtype),r),a?e.persistentData=u:B.freeType(u)):E.raise("invalid buffer data")}else if(t(n))e.dtype=i||q(n),e.dimension=o,c(e,n,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(z(n)){s=n.shape;var p=n.stride,d=n.offset,v=0,g=0,m=0,y=0;1===s.length?(v=s[0],g=1,m=p[0],y=0):2===s.length?(v=s[0],g=s[1],m=p[0],y=p[1]):E.raise("invalid shape"),e.dtype=i||q(n.data)||5126,e.dimension=g;var _=B.allocType(e.dtype,v*g);Q(_,n.data,v,g,m,y,d),c(e,_,r),a?e.persistentData=_:B.freeType(_)}else n instanceof ArrayBuffer?(e.dtype=5121,e.dimension=o,c(e,n,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):E.raise("invalid buffer data")}function h(t){n.bufferCount--,i(t);var r=t.buffer;E(r,"buffer must not be deleted already"),e.deleteBuffer(r),t.buffer=null,delete a[t.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,u,c){n.bufferCount++;var f=new s(o);function p(n){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(n)||t(n)||z(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(E.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(E(null===o||Array.isArray(o)||t(o)||z(o),"invalid data for buffer"),o=n.data),"usage"in n&&(E.parameter(n.usage,W,"invalid buffer usage"),i=W[n.usage]),"type"in n&&(E.parameter(n.type,H,"invalid buffer type"),s=H[n.type]),"dimension"in n&&(E.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(E.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),f.bind(),o?l(f,o,i,s,u,c):(a&&e.bufferData(f.type,a,i),f.dtype=s||5121,f.usage=i,f.dimension=u,f.byteLength=a),r.profile&&(f.stats.size=f.byteLength*Z[f.dtype]),p}function d(t,n){E(n+t.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),e.bufferSubData(f.type,n,t)}return a[f.id]=f,u||p(i),p._reglType="buffer",p._buffer=f,p.subdata=function(e,n){var r,i=0|(n||0);if(f.bind(),t(e)||e instanceof ArrayBuffer)d(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var o=B.allocType(f.dtype,e.length);K(o,e),d(o,i),B.freeType(o)}else if(Array.isArray(e[0])||t(e[0])){r=X(e);var a=Y(e,r,f.dtype);d(a,i),B.freeType(a)}else E.raise("invalid buffer data")}else if(z(e)){r=e.shape;var s=e.stride,u=0,c=0,l=0,h=0;1===r.length?(u=r[0],c=1,l=s[0],h=0):2===r.length?(u=r[0],c=r[1],l=s[0],h=s[1]):E.raise("invalid shape");var v=Array.isArray(e.data)?f.dtype:q(e.data),g=B.allocType(v,u*c);Q(g,e.data,u,c,l,h,e.offset),d(g,i),B.freeType(g)}else E.raise("invalid data for buffer subdata");return p},r.profile&&(p.stats=f.stats),p.destroy=function(){h(f)},p},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),l(n,t,35040,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){U(a).forEach(h),u.forEach(h)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){U(a).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))},_initBuffer:l}}(i,h,r,(function(e){return S.destroyBuffer(e)})),x=function(e,n,r,i){var o={},a=0,s={uint8:5121,uint16:5123};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=5125),u.prototype.bind=function(){this.buffer.bind()};var c=[];function l(i,o,a,s,u,c,l){var h;if(i.buffer.bind(),o){var f=l;l||t(o)&&(!z(o)||t(o.data))||(f=n.oes_element_index_uint?5125:5123),r._initBuffer(i.buffer,o,a,f,3)}else e.bufferData(34963,c,a),i.buffer.dtype=h||5121,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=c;if(h=l,!l){switch(i.buffer.dtype){case 5121:case 5120:h=5121;break;case 5123:case 5122:h=5123;break;case 5125:case 5124:h=5125;break;default:E.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,E(5125!==h||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,5123===h?p>>=1:5125===h&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=4;var v=i.buffer.dimension;1===v&&(d=0),2===v&&(d=1),3===v&&(d=4)}i.primType=d}function h(e){i.elementsCount--,E(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(e,n){var o=r.create(null,34963,!0),a=new u(o._buffer);function c(e){if(e)if("number"==typeof e)o(e),a.primType=4,a.vertCount=0|e,a.type=5121;else{var n=null,r=35044,i=-1,u=-1,h=0,f=0;Array.isArray(e)||t(e)||z(e)?n=e:(E.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,E(Array.isArray(n)||t(n)||z(n),"invalid data for element buffer")),"usage"in e&&(E.parameter(e.usage,W,"invalid element buffer usage"),r=W[e.usage]),"primitive"in e&&(E.parameter(e.primitive,$,"invalid element buffer primitive"),i=$[e.primitive]),"count"in e&&(E("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(E.parameter(e.type,s,"invalid buffer type"),f=s[e.type]),"length"in e?h=0|e.length:(h=u,5123===f||5122===f?h*=2:5125!==f&&5124!==f||(h*=4))),l(a,n,r,i,u,h,f)}else o(),a.primType=4,a.vertCount=0,a.type=5121;return c}return i.elementsCount++,c(e),c._reglType="elements",c._elements=a,c.subdata=function(e,t){return o.subdata(e,t),c},c.destroy=function(){h(a)},c},createStream:function(e){var t=c.pop();return t||(t=new u(r.create(null,34963,!0,!1)._buffer)),l(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){c.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){U(o).forEach(h)}}}(i,f,b,h),S=function(e,n,r,i,o,a,s){for(var u=r.maxAttributes,c=new Array(u),l=0;l<u;++l)c[l]=new Be;var h=0,f={},p={Record:Be,scope:{},state:c,currentVAO:null,targetVAO:null,restore:d()?function(){d()&&U(f).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(e){var r=new g;function s(e){var i;if(Array.isArray(e))i=e,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(E("object"==typeof e,"invalid arguments for create vao"),E("attributes"in e,"must specify attributes for vao"),e.elements){var c=e.elements;r.ownsElements?"function"==typeof c&&"elements"===c._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(c),r.ownsElements=!1):a.getElements(e.elements)?(r.elements=e.elements,r.ownsElements=!1):(r.elements=a.create(e.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=e.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in e&&(r.offset=0|e.offset),"count"in e&&(r.count=0|e.count),"instances"in e&&(r.instances=0|e.instances),"primitive"in e&&(E(e.primitive in $,"bad primitive type: "+e.primitive),r.primitive=$[e.primitive]),E.optional((function(){for(var t=Object.keys(e),n=0;n<t.length;++n)E(Fe.indexOf(t[n])>=0,'invalid option for vao: "'+t[n]+'" valid options are '+Fe)})),E(Array.isArray(i),"attributes must be an array")}E(i.length<u,"too many attributes"),E(i.length>0,"must specify at least one attribute");var l={},h=r.attributes;h.length=i.length;for(var f=0;f<i.length;++f){var p,d=i[f],v=h[f]=new Be,g=d.data||d;Array.isArray(g)||t(g)||z(g)?(r.buffers[f]&&(p=r.buffers[f],t(g)&&p._buffer.byteLength>=g.byteLength?p.subdata(g):(p.destroy(),r.buffers[f]=null)),r.buffers[f]||(p=r.buffers[f]=o.create(d,34962,!1,!0)),v.buffer=o.getBuffer(p),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1,l[f]=1):o.getBuffer(d)?(v.buffer=o.getBuffer(d),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1):o.getBuffer(d.buffer)?(v.buffer=o.getBuffer(d.buffer),v.size=0|(+d.size||v.buffer.dimension),v.normalized=!!d.normalized||!1,"type"in d?(E.parameter(d.type,H,"invalid buffer type"),v.type=H[d.type]):v.type=v.buffer.dtype,v.offset=0|(d.offset||0),v.stride=0|(d.stride||0),v.divisor=0|(d.divisor||0),v.state=1,E(v.size>=1&&v.size<=4,"size must be between 1 and 4"),E(v.offset>=0,"invalid offset"),E(v.stride>=0&&v.stride<=255,"stride must be between 0 and 255"),E(v.divisor>=0,"divisor must be positive"),E(!v.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in d?(E(f>0,"first attribute must not be a constant"),v.x=+d.x||0,v.y=+d.y||0,v.z=+d.z||0,v.w=+d.w||0,v.state=2):E(!1,"invalid attribute spec for location "+f)}for(var m=0;m<r.buffers.length;++m)!l[m]&&r.buffers[m]&&(r.buffers[m].destroy(),r.buffers[m]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(e)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(t){for(var n=0;n<c.length;++n){var r=c[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}},setVAO:d()?function(e){if(e!==p.currentVAO){var t=d();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),p.currentVAO=e}}:function(t){if(t!==p.currentVAO){if(t)t.bindAttrs();else{for(var n=v(),r=0;r<c.length;++r){var i=c[r];i.buffer?(e.enableVertexAttribArray(r),i.buffer.bind(),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?e.bindBuffer(34963,s.elements.buffer.buffer):e.bindBuffer(34963,null)}p.currentVAO=t}},clear:d()?function(){U(f).forEach((function(e){e.destroy()}))}:function(){}};function d(){return n.oes_vertex_array_object}function v(){return n.angle_instanced_arrays}function g(){this.id=++h,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var e=d();this.vao=e?e.createVertexArrayOES():null,f[this.id]=this,this.buffers=[]}return g.prototype.bindAttrs=function(){for(var t=v(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(34962,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&i.divisor&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<u;++o)e.disableVertexAttribArray(o);var s=a.getElements(this.elements);s?e.bindBuffer(34963,s.buffer.buffer):e.bindBuffer(34963,null)},g.prototype.refresh=function(){var e=d();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),p.currentVAO=null,e.bindVertexArrayOES(null))},g.prototype.destroy=function(){if(this.vao){var e=d();this===p.currentVAO&&(p.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),f[this.id]&&(delete f[this.id],i.vaoCount-=1)},p}(i,f,_,h,b,x,y),A=function(e,t,r,i){var o={},a={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function c(n,r,i){var s=35632===n?o:a,u=s[r];if(!u){var c=t.str(r);u=e.createShader(n),e.shaderSource(u,c),e.compileShader(u),E.shaderError(e,u,c,n,i),s[r]=u}return u}var l={},h=[],f=0;function p(e,t){this.id=f++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,r,o){var a,l,h=c(35632,n.fragId),f=c(35633,n.vertId),p=n.program=e.createProgram();if(e.attachShader(p,h),e.attachShader(p,f),o)for(a=0;a<o.length;++a){var d=o[a];e.bindAttribLocation(p,d[0],d[1])}e.linkProgram(p),E.linkError(e,p,t.str(n.fragId),t.str(n.vertId),r);var v=e.getProgramParameter(p,35718);i.profile&&(n.stats.uniformsCount=v);var g=n.uniforms;for(a=0;a<v;++a)if(l=e.getActiveUniform(p,a))if(l.size>1)for(var m=0;m<l.size;++m){var y=l.name.replace("[0]","["+m+"]");u(g,new s(y,t.id(y),e.getUniformLocation(p,y),l))}else u(g,new s(l.name,t.id(l.name),e.getUniformLocation(p,l.name),l));var _=e.getProgramParameter(p,35721);i.profile&&(n.stats.attributesCount=_);var b=n.attributes;for(a=0;a<_;++a)(l=e.getActiveAttrib(p,a))&&u(b,new s(l.name,t.id(l.name),e.getAttribLocation(p,l.name),l))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return h.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return h.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);U(o).forEach(t),o={},U(a).forEach(t),a={},h.forEach((function(t){e.deleteProgram(t.program)})),h.length=0,l={},r.shaderCount=0},program:function(t,i,s,u){E.command(t>=0,"missing vertex shader",s),E.command(i>=0,"missing fragment shader",s);var c=l[i];c||(c=l[i]={});var f=c[t];if(f&&(f.refCount++,!u))return f;var v=new p(i,t);return r.shaderCount++,d(v,s,u),f||(c[t]=v),h.push(v),n(v,{destroy:function(){if(v.refCount--,v.refCount<=0){e.deleteProgram(v.program);var t=h.indexOf(v);h.splice(t,1),r.shaderCount--}c[v.vertId].refCount<=0&&(e.deleteShader(a[v.vertId]),delete a[v.vertId],delete l[v.fragId][v.vertId]),Object.keys(l[v.fragId]).length||(e.deleteShader(o[v.fragId]),delete o[v.fragId],delete l[v.fragId])}})},restore:function(){o={},a={};for(var e=0;e<h.length;++e)d(h[e],null,h[e].attributes.map((function(e){return[e.location,e.name]})))},shader:c,frag:-1,vert:-1}}(i,l,h,r),w=Me(i,f,_,(function(){I.procs.poll()}),m,h,r),T=function(e,t,n,r,i){var o={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(e){var t=o[e];a[t]=e}));var s=0,u={};function c(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function l(t){var n=t.renderbuffer;E(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}return c.prototype.decRef=function(){--this.refCount<=0&&l(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:function(t,s){var l=new c(e.createRenderbuffer());function h(t,r){var s=0,u=0,c=32854;if("object"==typeof t&&t){var f=t;if("shape"in f){var p=f.shape;E(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),s=0|p[0],u=0|p[1]}else"radius"in f&&(s=u=0|f.radius),"width"in f&&(s=0|f.width),"height"in f&&(u=0|f.height);"format"in f&&(E.parameter(f.format,o,"invalid renderbuffer format"),c=o[f.format])}else"number"==typeof t?(s=0|t,u="number"==typeof r?0|r:s):t?E.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(E(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==l.width||u!==l.height||c!==l.format)return h.width=l.width=s,h.height=l.height=u,l.format=c,e.bindRenderbuffer(36161,l.renderbuffer),e.renderbufferStorage(36161,c,s,u),E(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=Ie(l.format,l.width,l.height)),h.format=a[l.format],h}return u[l.id]=l,r.renderbufferCount++,h(t,s),h.resize=function(t,r){var o=0|t,a=0|r||o;return o===l.width&&a===l.height||(E(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=l.width=o,h.height=l.height=a,e.bindRenderbuffer(36161,l.renderbuffer),e.renderbufferStorage(36161,l.format,o,a),E(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=Ie(l.format,l.width,l.height))),h},h._reglType="renderbuffer",h._renderbuffer=l,i.profile&&(h.stats=l.stats),h.destroy=function(){l.decRef()},h},clear:function(){U(u).forEach(l)},restore:function(){U(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)})),e.bindRenderbuffer(36161,null)}}}(i,f,_,h,r),C=function(e,t,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],c=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&c.push("srgba"),t.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&c.push("rgba32f");var l=["uint8"];function h(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function f(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function p(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);E(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;E(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(t,n){n&&(n.texture?e.framebufferTexture2D(36160,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(36160,t,36161,n.renderbuffer._renderbuffer.renderbuffer))}function v(e){var t=3553,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),E.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,E(3553===t)):"textureCube"===o?(n=i,E(t>=34069&&t<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,t=36161):E.raise("invalid regl object for attachment"),new h(t,n,r)}function g(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new h(3553,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new h(36161,null,u)}function m(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}t.oes_texture_half_float&&l.push("half float","float16"),t.oes_texture_float&&l.push("float","float32");var _=0,b={};function x(){this.id=_++,b[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function S(e){e.colorAttachments.forEach(f),f(e.depthAttachment),f(e.stencilAttachment),f(e.depthStencilAttachment)}function A(t){var n=t.framebuffer;E(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete b[t.id]}function w(t){var n;e.bindFramebuffer(36160,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)d(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(36160,36064+n,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),d(36096,t.depthAttachment),d(36128,t.stencilAttachment),d(33306,t.depthStencilAttachment);var o=e.checkFramebufferStatus(36160);e.isContextLost()||36053===o||E.raise("framebuffer configuration not supported, status = "+De[o]),e.bindFramebuffer(36160,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function T(e,i){var o=new x;function h(e,n){var i;E(s.next!==o,"can not update framebuffer which is currently in use");var a=0,f=0,d=!0,y=!0,_=null,b=!0,x="rgba",A="uint8",T=1,C=null,k=null,M=null,P=!1;if("number"==typeof e)a=0|e,f=0|n||a;else if(e){E.type(e,"object","invalid arguments for framebuffer");var I=e;if("shape"in I){var L=I.shape;E(Array.isArray(L)&&L.length>=2,"invalid shape for framebuffer"),a=L[0],f=L[1]}else"radius"in I&&(a=f=I.radius),"width"in I&&(a=I.width),"height"in I&&(f=I.height);("color"in I||"colors"in I)&&(_=I.color||I.colors,Array.isArray(_)&&E(1===_.length||t.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in I&&(T=0|I.colorCount,E(T>0,"invalid color buffer count")),"colorTexture"in I&&(b=!!I.colorTexture,x="rgba4"),"colorType"in I&&(A=I.colorType,b?(E(t.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),E(t.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===A||"float16"===A?(E(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==A&&"float32"!==A||(E(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),E.oneOf(A,l,"invalid color type")),"colorFormat"in I&&(x=I.colorFormat,u.indexOf(x)>=0?b=!0:c.indexOf(x)>=0?b=!1:E.optional((function(){b?E.oneOf(I.colorFormat,u,"invalid color format for texture"):E.oneOf(I.colorFormat,c,"invalid color format for renderbuffer")})))),("depthTexture"in I||"depthStencilTexture"in I)&&(P=!(!I.depthTexture&&!I.depthStencilTexture),E(!P||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in I&&("boolean"==typeof I.depth?d=I.depth:(C=I.depth,y=!1)),"stencil"in I&&("boolean"==typeof I.stencil?y=I.stencil:(k=I.stencil,d=!1)),"depthStencil"in I&&("boolean"==typeof I.depthStencil?d=y=I.depthStencil:(M=I.depthStencil,d=!1,y=!1))}else a=f=1;var O=null,R=null,N=null,D=null;if(Array.isArray(_))O=_.map(v);else if(_)O=[v(_)];else for(O=new Array(T),i=0;i<T;++i)O[i]=g(a,f,b,x,A);E(t.webgl_draw_buffers||O.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),E(O.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||O[0].width,f=f||O[0].height,C?R=v(C):d&&!y&&(R=g(a,f,P,"depth","uint32")),k?N=v(k):y&&!d&&(N=g(a,f,!1,"stencil","uint8")),M?D=v(M):!C&&!k&&y&&d&&(D=g(a,f,P,"depth stencil","depth stencil")),E(!!C+!!k+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(i=0;i<O.length;++i)if(p(O[i],a,f),E(!O[i]||O[i].texture&&Le.indexOf(O[i].texture._texture.format)>=0||O[i].renderbuffer&&Ne.indexOf(O[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),O[i]&&O[i].texture){var B=Oe[O[i].texture._texture.format]*Re[O[i].texture._texture.type];null===F?F=B:E(F===B,"all color attachments much have the same number of bits per pixel.")}return p(R,a,f),E(!R||R.texture&&6402===R.texture._texture.format||R.renderbuffer&&33189===R.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),p(N,a,f),E(!N||N.renderbuffer&&36168===N.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),p(D,a,f),E(!D||D.texture&&34041===D.texture._texture.format||D.renderbuffer&&34041===D.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),S(o),o.width=a,o.height=f,o.colorAttachments=O,o.depthAttachment=R,o.stencilAttachment=N,o.depthStencilAttachment=D,h.color=O.map(m),h.depth=m(R),h.stencil=m(N),h.depthStencil=m(D),h.width=o.width,h.height=o.height,w(o),h}return a.framebufferCount++,h(e,i),n(h,{resize:function(e,t){E(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return h;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=h.width=n,o.height=h.height=r,w(o),h},_reglType:"framebuffer",_framebuffer:o,destroy:function(){A(o),S(o)},use:function(e){s.setFBO({framebuffer:h},e)}})}return n(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof x)return t}return null},create:T,createCube:function(e){var o=Array(6);function a(e){var r;E(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var c,h={color:null},f=0,p=null,d="rgba",v="uint8",g=1;if("number"==typeof e)f=0|e;else if(e){E.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var y=m.shape;E(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),E(y[0]===y[1],"cube framebuffer must be square"),f=y[0]}else"radius"in m&&(f=0|m.radius),"width"in m?(f=0|m.width,"height"in m&&E(m.height===f,"must be square")):"height"in m&&(f=0|m.height);("color"in m||"colors"in m)&&(p=m.color||m.colors,Array.isArray(p)&&E(1===p.length||t.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in m&&(g=0|m.colorCount,E(g>0,"invalid color buffer count")),"colorType"in m&&(E.oneOf(m.colorType,l,"invalid color type"),v=m.colorType),"colorFormat"in m&&(d=m.colorFormat,E.oneOf(m.colorFormat,u,"invalid color format for texture"))),"depth"in m&&(h.depth=m.depth),"stencil"in m&&(h.stencil=m.stencil),"depthStencil"in m&&(h.depthStencil=m.depthStencil)}else f=1;if(p)if(Array.isArray(p))for(c=[],r=0;r<p.length;++r)c[r]=p[r];else c=[p];else{c=Array(g);var _={radius:f,format:d,type:v};for(r=0;r<g;++r)c[r]=i.createCube(_)}for(h.color=Array(c.length),r=0;r<c.length;++r){var b=c[r];E("function"==typeof b&&"textureCube"===b._reglType,"invalid cube map"),f=f||b.width,E(b.width===f&&b.height===f,"invalid cube map shape"),h.color[r]={target:34069,data:c[r]}}for(r=0;r<6;++r){for(var x=0;x<c.length;++x)h.color[x].target=34069+r;r>0&&(h.depth=o[0].depth,h.stencil=o[0].stencil,h.depthStencil=o[0].depthStencil),o[r]?o[r](h):o[r]=T(h)}return n(a,{width:f,height:f,color:c})}return a(e),n(a,{faces:o,resize:function(e){var t,n=0|e;if(E(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){U(b).forEach(A)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,U(b).forEach((function(t){t.framebuffer=e.createFramebuffer(),w(t)}))}})}(i,f,_,w,T,h),I=vt(i,l,f,_,b,x,0,C,{},S,A,y,m,p,r),L=ze(i,C,I.procs.poll,m,o,f,_),N=I.next,D=i.canvas,F=[],j=[],V=[],G=[r.onDestroy],J=null;function ee(){if(0===F.length)return p&&p.update(),void(J=null);J=M.next(ee),he();for(var e=F.length-1;e>=0;--e){var t=F[e];t&&t(m,null,0)}i.flush(),p&&p.update()}function te(){!J&&F.length>0&&(J=M.next(ee))}function ne(){J&&(M.cancel(ee),J=null)}function re(e){e.preventDefault(),a=!0,ne(),j.forEach((function(e){e()}))}function ie(e){i.getError(),a=!1,s.restore(),A.restore(),b.restore(),w.restore(),T.restore(),C.restore(),S.restore(),p&&p.restore(),I.procs.refresh(),te(),V.forEach((function(e){e()}))}var oe="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;function ae(e){function t(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var o=e[i];if(k.isDynamic(o))r[i]=k.unbox(o,i);else{if(t&&Array.isArray(o))for(var a=0;a<o.length;++a)if(k.isDynamic(o[a]))return void(r[i]=k.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}E(!!e,"invalid args to regl({...})"),E.type(e,"object","invalid args to regl({...})");var r=t(e.context||{},!0),i=t(e.uniforms||{},!0),o=t(e.attributes||{},!1),s=t(function(e){var t=n({},e);function r(e){if(e in t){var n=t[e];delete t[e],Object.keys(n).forEach((function(r){t[e+"."+r]=n[r]}))}}return delete t.uniforms,delete t.attributes,delete t.context,delete t.vao,"stencil"in t&&t.stencil.op&&(t.stencil.opBack=t.stencil.opFront=t.stencil.op,delete t.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(t.vao=e.vao),t}(e),!1),u={gpuTime:0,cpuTime:0,count:0},c=I.compile(s,o,i,r,u),l=c.draw,h=c.batch,f=c.scope,p=[];return n((function(e,t){var n;if(a&&E.raise("context lost"),"function"==typeof e)return f.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)f.call(this,null,t,n);else{if(!Array.isArray(e))return f.call(this,e,t,0);for(n=0;n<e.length;++n)f.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return h.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e)}else{if(!Array.isArray(e))return l.call(this,e);if(e.length)return h.call(this,e,e.length)}}),{stats:u,destroy:function(){c.destroy()}})}!oe&&D&&(D.addEventListener("webglcontextlost",re,!1),D.addEventListener("webglcontextrestored",ie,!1));var se=C.setFBO=ae({framebuffer:k.define.call(null,1,"framebuffer")});function ue(e,t){var n=0;I.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),E(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function ce(e){return E.type(e,"function","regl.frame() callback must be a function"),F.push(e),te(),{cancel:function(){var t=mt(F,e);E(t>=0,"cannot cancel a frame twice"),F[t]=function e(){var t=mt(F,e);F[t]=F[F.length-1],F.length-=1,F.length<=0&&ne()}}}}function le(){var e=N.viewport,t=N.scissor_box;e[0]=e[1]=t[0]=t[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function he(){m.tick+=1,m.time=pe(),le(),I.procs.poll()}function fe(){w.refresh(),le(),I.procs.refresh(),p&&p.update()}function pe(){return(P()-d)/1e3}fe();var de=n(ae,{clear:function(e){if(E("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;t<6;++t)se(n({framebuffer:e.framebuffer.faces[t]},e),ue);else se(e,ue);else ue(0,e)},prop:k.define.bind(null,1),context:k.define.bind(null,2),this:k.define.bind(null,3),draw:ae({}),buffer:function(e){return b.create(e,34962,!1,!1)},elements:function(e){return x.create(e,!1)},texture:w.create2D,cube:w.createCube,renderbuffer:T.create,framebuffer:C.create,framebufferCube:C.createCube,vao:S.createVAO,attributes:o,frame:ce,on:function(e,t){var n;switch(E.type(t,"function","listener callback must be a function"),e){case"frame":return ce(t);case"lost":n=j;break;case"restore":n=V;break;case"destroy":n=G;break;default:E.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:_,hasExtension:function(e){return _.extensions.indexOf(e.toLowerCase())>=0},read:L,destroy:function(){F.length=0,ne(),!oe&&D&&(D.removeEventListener("webglcontextlost",re),D.removeEventListener("webglcontextrestored",ie)),A.clear(),C.clear(),T.clear(),S.clear(),w.clear(),x.clear(),b.clear(),p&&p.clear(),G.forEach((function(e){e()}))},_gl:i,_refresh:fe,poll:function(){he(),p&&p.update()},now:pe,stats:h});return r.onDone(null,de),de}}(_J)})),xJ=function(){function e(t,n){b(this,e),E(this,"attribute",void 0),E(this,"buffer",void 0);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return S(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),SJ=(E(iJ={},fL.POINTS,"points"),E(iJ,fL.LINES,"lines"),E(iJ,fL.LINE_LOOP,"line loop"),E(iJ,fL.LINE_STRIP,"line strip"),E(iJ,fL.TRIANGLES,"triangles"),E(iJ,fL.TRIANGLE_FAN,"triangle fan"),E(iJ,fL.TRIANGLE_STRIP,"triangle strip"),iJ),EJ=(E(oJ={},fL.STATIC_DRAW,"static"),E(oJ,fL.DYNAMIC_DRAW,"dynamic"),E(oJ,fL.STREAM_DRAW,"stream"),oJ),AJ=(E(aJ={},fL.BYTE,"int8"),E(aJ,fL.UNSIGNED_INT,"int16"),E(aJ,fL.INT,"int32"),E(aJ,fL.UNSIGNED_BYTE,"uint8"),E(aJ,fL.UNSIGNED_SHORT,"uint16"),E(aJ,fL.UNSIGNED_INT,"uint32"),E(aJ,fL.FLOAT,"float"),aJ),wJ=(E(sJ={},fL.ALPHA,"alpha"),E(sJ,fL.LUMINANCE,"luminance"),E(sJ,fL.LUMINANCE_ALPHA,"luminance alpha"),E(sJ,fL.RGB,"rgb"),E(sJ,fL.RGBA,"rgba"),E(sJ,fL.RGBA4,"rgba4"),E(sJ,fL.RGB5_A1,"rgb5 a1"),E(sJ,fL.RGB565,"rgb565"),E(sJ,fL.DEPTH_COMPONENT,"depth"),E(sJ,fL.DEPTH_STENCIL,"depth stencil"),sJ),TJ=(E(uJ={},fL.DONT_CARE,"dont care"),E(uJ,fL.NICEST,"nice"),E(uJ,fL.FASTEST,"fast"),uJ),CJ=(E(cJ={},fL.NEAREST,"nearest"),E(cJ,fL.LINEAR,"linear"),E(cJ,fL.LINEAR_MIPMAP_LINEAR,"mipmap"),E(cJ,fL.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),E(cJ,fL.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),E(cJ,fL.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),cJ),kJ=(E(lJ={},fL.REPEAT,"repeat"),E(lJ,fL.CLAMP_TO_EDGE,"clamp"),E(lJ,fL.MIRRORED_REPEAT,"mirror"),lJ),MJ=(E(hJ={},fL.NONE,"none"),E(hJ,fL.BROWSER_DEFAULT_WEBGL,"browser"),hJ),PJ=(E(fJ={},fL.NEVER,"never"),E(fJ,fL.ALWAYS,"always"),E(fJ,fL.LESS,"less"),E(fJ,fL.LEQUAL,"lequal"),E(fJ,fL.GREATER,"greater"),E(fJ,fL.GEQUAL,"gequal"),E(fJ,fL.EQUAL,"equal"),E(fJ,fL.NOTEQUAL,"notequal"),fJ),IJ=(E(pJ={},fL.FUNC_ADD,"add"),E(pJ,fL.MIN_EXT,"min"),E(pJ,fL.MAX_EXT,"max"),E(pJ,fL.FUNC_SUBTRACT,"subtract"),E(pJ,fL.FUNC_REVERSE_SUBTRACT,"reverse subtract"),pJ),LJ=(E(dJ={},fL.ZERO,"zero"),E(dJ,fL.ONE,"one"),E(dJ,fL.SRC_COLOR,"src color"),E(dJ,fL.ONE_MINUS_SRC_COLOR,"one minus src color"),E(dJ,fL.SRC_ALPHA,"src alpha"),E(dJ,fL.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),E(dJ,fL.DST_COLOR,"dst color"),E(dJ,fL.ONE_MINUS_DST_COLOR,"one minus dst color"),E(dJ,fL.DST_ALPHA,"dst alpha"),E(dJ,fL.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),E(dJ,fL.CONSTANT_COLOR,"constant color"),E(dJ,fL.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),E(dJ,fL.CONSTANT_ALPHA,"constant alpha"),E(dJ,fL.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),E(dJ,fL.SRC_ALPHA_SATURATE,"src alpha saturate"),dJ),OJ=(E(vJ={},fL.NEVER,"never"),E(vJ,fL.ALWAYS,"always"),E(vJ,fL.LESS,"less"),E(vJ,fL.LEQUAL,"lequal"),E(vJ,fL.GREATER,"greater"),E(vJ,fL.GEQUAL,"gequal"),E(vJ,fL.EQUAL,"equal"),E(vJ,fL.NOTEQUAL,"notequal"),vJ),RJ=(E(gJ={},fL.ZERO,"zero"),E(gJ,fL.KEEP,"keep"),E(gJ,fL.REPLACE,"replace"),E(gJ,fL.INVERT,"invert"),E(gJ,fL.INCR,"increment"),E(gJ,fL.DECR,"decrement"),E(gJ,fL.INCR_WRAP,"increment wrap"),E(gJ,fL.DECR_WRAP,"decrement wrap"),gJ),NJ=(E(mJ={},fL.FRONT,"front"),E(mJ,fL.BACK,"back"),mJ),DJ=function(){function e(t,n){b(this,e),E(this,"buffer",void 0),E(this,"isDestroyed",!1);var r=n.data,i=n.usage,o=n.type;this.buffer=t.buffer({data:r,usage:EJ[i||fL.STATIC_DRAW],type:AJ[o||fL.UNSIGNED_BYTE]})}return S(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),e}(),FJ=function(){function e(t,n){b(this,e),E(this,"elements",void 0);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=t.elements({data:r,usage:EJ[i||fL.STATIC_DRAW],type:AJ[o||fL.UNSIGNED_BYTE],count:a})}return S(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}]),e}(),BJ=function(){function e(t,n){b(this,e),E(this,"framebuffer",void 0);var r=n.width,i=n.height,o=n.color,a=n.colors,s={width:r,height:i};Array.isArray(a)&&(s.colors=a.map((function(e){return e.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=t.framebuffer(s)}return S(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}(),zJ=function(){function e(t,n){b(this,e),E(this,"reGl",void 0),E(this,"destroyed",!1),E(this,"drawCommand",void 0),E(this,"drawParams",void 0),E(this,"options",void 0),E(this,"uniforms",{}),this.reGl=t;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,s=n.primitive,u=n.count,c=n.elements,l=n.depth,h=n.cull,f=n.instances,p={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach((function(e){p[e]=t.prop(e)})));var d={};Object.keys(o).forEach((function(e){d[e]=o[e].get()}));var v={attributes:d,frag:i,uniforms:p,vert:r,colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:SJ[void 0===s?fL.TRIANGLES:s]};f&&(v.instances=f),u?v.count=u:c&&(v.elements=c.get()),this.initDepthDrawParams({depth:l},v),this.initCullDrawParams({cull:h},v),this.drawCommand=t(v),this.drawParams=v}return S(e,[{key:"updateAttributesAndElements",value:function(e,t){var n={};Object.keys(e).forEach((function(t){n[t]=e[t].get()})),this.drawParams.attributes=n,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(e){var t={};Object.keys(e).forEach((function(n){t[n]=e[n].get()})),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(e){this.uniforms=v(v({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=v(v({},this.uniforms),this.extractUniforms(e.uniforms||{})),r={};Object.keys(n).forEach((function(e){var t=m(n[e]);"boolean"===t||"number"===t||Array.isArray(n[e])||n[e].BYTES_PER_ELEMENT?r[e]=n[e]:r[e]=n[e].get()})),r.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),r.stencil=this.getStencilDrawParams(e),r.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(r)}}},{key:"destroy",value:function(){var e,t;null===(e=this.drawParams)||void 0===e||null===(t=e.elements)||void 0===t||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){null==e||e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(e,t){var n=e.depth;n&&(t.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:PJ[n.func||fL.LESS],range:n.range||[0,1]})}},{key:"getBlendDrawParams",value:function(e){var t=e.blend||{},n=t.enable,r=t.func,i=t.equation,o=t.color,a=void 0===o?[0,0,0,0]:o;return{enable:!!n,func:{srcRGB:LJ[r&&r.srcRGB||fL.SRC_ALPHA],srcAlpha:LJ[r&&r.srcAlpha||fL.SRC_ALPHA],dstRGB:LJ[r&&r.dstRGB||fL.ONE_MINUS_SRC_ALPHA],dstAlpha:LJ[r&&r.dstAlpha||fL.ONE_MINUS_SRC_ALPHA]},equation:{rgb:IJ[i&&i.rgb||fL.FUNC_ADD],alpha:IJ[i&&i.alpha||fL.FUNC_ADD]},color:a}}},{key:"getStencilDrawParams",value:function(e){var t=e.stencil||{},n=t.enable,r=t.mask,i=void 0===r?-1:r,o=t.func,a=void 0===o?{cmp:fL.ALWAYS,ref:0,mask:-1}:o,s=t.opFront,u=void 0===s?{fail:fL.KEEP,zfail:fL.KEEP,zpass:fL.KEEP}:s,c=t.opBack,l=void 0===c?{fail:fL.KEEP,zfail:fL.KEEP,zpass:fL.KEEP}:c;return{enable:!!n,mask:i,func:v(v({},a),{},{cmp:OJ[a.cmp]}),opFront:{fail:RJ[u.fail],zfail:RJ[u.zfail],zpass:RJ[u.zpass]},opBack:{fail:RJ[l.fail],zfail:RJ[l.zfail],zpass:RJ[l.zpass]}}}},{key:"getColorMaskDrawParams",value:function(e,t){var n=e.stencil;return null!=n&&n.enable&&n.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}},{key:"initCullDrawParams",value:function(e,t){var n=e.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?fL.BACK:i;t.cull={enable:!!r,face:NJ[o]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||FP(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(LP(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),e}(),UJ=function(){function e(t,n){b(this,e),E(this,"texture",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"isDestroy",!1);var r=n.data,i=n.type,o=void 0===i?fL.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,c=void 0!==u&&u,l=n.format,h=void 0===l?fL.RGBA:l,f=n.mipmap,p=void 0!==f&&f,d=n.wrapS,v=void 0===d?fL.CLAMP_TO_EDGE:d,g=n.wrapT,m=void 0===g?fL.CLAMP_TO_EDGE:g,y=n.aniso,_=void 0===y?0:y,x=n.alignment,S=void 0===x?1:x,A=n.premultiplyAlpha,w=void 0!==A&&A,T=n.mag,C=void 0===T?fL.NEAREST:T,k=n.min,M=void 0===k?fL.NEAREST:k,P=n.colorSpace,I=void 0===P?fL.BROWSER_DEFAULT_WEBGL:P,L=n.x,O=void 0===L?0:L,R=n.y,N=void 0===R?0:R,D=n.copy,F=void 0!==D&&D;this.width=a,this.height=s;var B={width:a,height:s,type:AJ[o],format:wJ[h],wrapS:kJ[v],wrapT:kJ[m],mag:CJ[C],min:CJ[M],alignment:S,flipY:c,colorSpace:MJ[I],premultiplyAlpha:w,aniso:_,x:O,y:N,copy:F};r&&(B.data=r),"number"==typeof p?B.mipmap=TJ[p]:"boolean"==typeof p&&(B.mipmap=p),this.texture=t.texture(B)}return S(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(e)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var e;this.isDestroy||(null===(e=this.texture)||void 0===e||e.destroy());this.isDestroy=!0}}]),e}(),jJ=vw()(yJ=function(){function e(){var t=this;b(this,e),E(this,"extensionObject",void 0),E(this,"gl",void 0),E(this,"$container",void 0),E(this,"canvas",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"isDirty",void 0),E(this,"createModel",(function(e){return new zJ(t.gl,e)})),E(this,"createAttribute",(function(e){return new xJ(t.gl,e)})),E(this,"createBuffer",(function(e){return new DJ(t.gl,e)})),E(this,"createElements",(function(e){return new FJ(t.gl,e)})),E(this,"createTexture2D",(function(e){return new UJ(t.gl,e)})),E(this,"createFramebuffer",(function(e){return new BJ(t.gl,e)})),E(this,"useFramebuffer",(function(e,n){t.gl({framebuffer:e?e.get():null})(n)})),E(this,"clear",(function(e){var n,r=e.color,i=e.depth,o=e.stencil,a=e.framebuffer,s=void 0===a?null:a,u={color:r,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(n=t.gl)||void 0===n||n.clear(u)})),E(this,"viewport",(function(e){var n=e.x,r=e.y,i=e.width,o=e.height;t.gl._gl.viewport(n,r,i,o),t.width=i,t.height=o,t.gl._refresh()})),E(this,"readPixels",(function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)})),E(this,"getViewportSize",(function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}})),E(this,"getContainer",(function(){return Bd?t.canvas:null===(e=t.canvas)||void 0===e?void 0:e.parentElement;var e})),E(this,"getCanvas",(function(){return t.canvas})),E(this,"getGLContext",(function(){return t.gl._gl})),E(this,"destroy",(function(){var e,n,r;t.canvas=null,null===(e=t.gl)||void 0===e||null===(n=e._gl)||void 0===n||null===(r=n.getExtension("WEBGL_lose_context"))||void 0===r||r.loseContext(),t.gl.destroy(),t.gl=null}))}var t;return S(e,[{key:"init",value:(t=_(g().mark((function e(t,n,r){var i=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas=t,!r){e.next=5;break}this.gl=r,e.next=8;break;case 5:return e.next=7,new Promise((function(e,t){bJ({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(n,r){!n&&r||t(n),e(r)}})}));case 7:this.gl=e.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||yJ,VJ=["selectstart","selecting","selectend"],GJ=function(e){A(n,e);var t=O(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b(this,n),E(I(r=t.call(this)),"scene",void 0),E(I(r),"options",void 0),E(I(r),"isEnable",!1),E(I(r),"box",void 0),E(I(r),"startEvent",void 0),E(I(r),"endEvent",void 0),E(I(r),"onDragStart",(function(e){r.box.style.display="block",r.startEvent=r.endEvent=e,r.syncBoxBound(),r.emit("selectstart",r.getLngLatBox(),r.startEvent,r.endEvent)})),E(I(r),"onDragging",(function(e){r.endEvent=e,r.syncBoxBound(),r.emit("selecting",r.getLngLatBox(),r.startEvent,r.endEvent)})),E(I(r),"onDragEnd",(function(e){r.endEvent=e,r.box.style.display="none",r.emit("selectend",r.getLngLatBox(),r.startEvent,r.endEvent)})),r.scene=e,r.options=i,r}return S(n,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var e=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var t=Bm("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var e=this.startEvent,t=e.x,n=e.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(t,i),s=Math.min(n,o),u=Math.abs(t-i),c=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(c,"px")}},{key:"getLngLatBox",value:function(){var e=this.startEvent.lngLat,t=e.lng,n=e.lat,r=this.endEvent.lngLat;return p_([[t,n],[r.lng,r.lat]])}}]),n}(Q_),HJ=function(){function e(t){b(this,e),E(this,"sceneService",void 0),E(this,"mapService",void 0),E(this,"controlService",void 0),E(this,"layerService",void 0),E(this,"debugService",void 0),E(this,"iconService",void 0),E(this,"markerService",void 0),E(this,"popupService",void 0),E(this,"fontService",void 0),E(this,"interactionService",void 0),E(this,"boxSelect",void 0),E(this,"container",void 0);var n=t.id,r=t.map,i=t.canvas,o=t.hasBaseMap,a=PD();this.container=a,r.setContainer(a,n,i,o),a.bind(AT.IRendererService).to(jJ).inSingletonScope(),this.sceneService=a.get(AT.ISceneService),this.mapService=a.get(AT.IMapService),this.iconService=a.get(AT.IIconService),this.fontService=a.get(AT.IFontService),this.controlService=a.get(AT.IControlService),this.layerService=a.get(AT.ILayerService),this.debugService=a.get(AT.IDebugService),this.debugService.setEnable(t.debug),this.markerService=a.get(AT.IMarkerService),this.interactionService=a.get(AT.IInteractionService),this.popupService=a.get(AT.IPopupService),this.boxSelect=new GJ(this,{}),Nd((null==t?void 0:t.isMini)||!1),Bd?this.sceneService.initMiniScene(t):(this.initComponent(n),this.sceneService.init(t),this.initControl())}var t,n,r,i,o;return S(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:(o=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"exportMap",value:(i=_(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"registerRenderService",value:function(e){var t=this;this.sceneService.loaded?new e(this).init():this.on("loaded",(function(){new e(t).init()}))}},{key:"setBgColor",value:function(e){this.mapService.setBgColor(e)}},{key:"addLayer",value:function(e){var t=this,n=ID(this.container);if(e.setContainer(n,this.container),this.sceneService.addLayer(e),e.inited){var r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",(function(){var n=t.initMask(e);t.addMask(n,e.id)}))}},{key:"initMask",value:function(e){var t=e.getLayerConfig(),n=t.mask,r=t.maskfence,i=t.maskColor,o=void 0===i?"#000":i,a=t.maskOpacity,s=void 0===a?0:a;if(n&&r)return(new GW).source(r).shape("fill").style({color:o,opacity:s})}},{key:"addMask",value:function(e,t){if(e){var n=this.getLayer(t);if(n){var r=ID(this.container);e.setContainer(r,this.container),n.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:(r=_(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.remove(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"removeAllLayer",value:(n=_(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.removeAllLayers();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(e){this.layerService.setEnableRender(e)}},{key:"addIconFont",value:function(e,t){this.fontService.addIconFont(e,t)}},{key:"addIconFonts",value:function(e){var t=this;e.forEach((function(e){var n=D(e,2),r=n[0],i=n[1];t.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(e,t){var n=this;this.fontService.once("fontloaded",(function(e){n.emit("fontloaded",e)})),this.fontService.addFontFace(e,t)}},{key:"addImage",value:(t=_(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Bd){e.next=5;break}return e.next=3,this.iconService.addImage(t,n);case 3:e.next=6;break;case 5:this.iconService.addImageMini(t,n,this.sceneService);case 6:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"hasImage",value:function(e){return this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers å·²åºå¼ï¼è¯·ä½¿ç¨ removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"removePopup",value:function(e){this.popupService.removePopup(e)}},{key:"on",value:function(e,t){var n;VJ.includes(e)?null===(n=this.boxSelect)||void 0===n||n.on(e,t):GD.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}},{key:"once",value:function(e,t){var n;VJ.includes(e)?null===(n=this.boxSelect)||void 0===n||n.once(e,t):GD.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}},{key:"emit",value:function(e,t){-1===GD.indexOf(e)?this.mapService.on(e,t):this.sceneService.emit(e,t)}},{key:"off",value:function(e,t){var n;VJ.includes(e)?null===(n=this.boxSelect)||void 0===n||n.off(e,t):GD.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(e){return this.mapService.getCenter(e)}},{key:"setCenter",value:function(e,t){return this.mapService.setCenter(e,t)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e,t){this.mapService.panBy(e,t)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||v(v({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e,t){this.container.bind(AT.IPostProcessingPass).to(e).whenTargetNamed(t)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),t&&this.boxSelect.once("selectend",(function(){e.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(e){this.controlService.init({container:Nm(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new NB({position:n}))}}]),e}();e.$XMLHttpRequest=jd,e.$location=Vd,e.$window=Ud,e.AJAXError=Gd,e.AttributeType=jD,e.BKDRHash=function(e){var t=0;e+="x";for(var n=Math.floor(65745979961613.07),r=0;r<e.length;r++)t>n&&(t=Math.floor(t/137)),t=131*t+e.charCodeAt(r);return t},e.BaseLayer=dG,e.BaseMapService=DV,e.BaseMapWrapper=bz,e.BaseModel=gG,e.BasePostProcessingPass=tD,e.BlendType=iI,e.ButtonControl=mB,e.CameraUniform=FD,e.CanvasLayer=EG,e.CanvasUpdateType=xG,e.CityBuildingLayer=_H,e.Control=gB,e.CoordinateSystem=OI,e.CoordinateUniform=RI,e.DOM=oy,e.Earth=jV,e.EarthLayer=jW,e.ExportImage=AB,e.FrequencyController=dy,e.Fullscreen=PB,e.GaodeMap=NU,e.GaodeMapV1=PU,e.GaodeMapV2=NU,e.GeoLocate=OB,e.GeometryLayer=AH,e.HeatmapLayer=PH,e.IDebugLog=BD,e.ILayerStage=sI,e.ImageLayer=LH,e.InteractionEvent=zI,e.LRUCache=T_,e.LayerPopup=tz,e.LayerSwitch=RB,e.LineLayer=JH,e.LineTriangulation=yE,e.LinearDir=yG,e.LoadTileDataStatus=J_,e.Logo=NB,e.Map=WV,e.MapServiceEvent=VD,e.MapTheme=BB,e.Mapbox=$V,e.Marker=pB,e.MarkerLayer=dB,e.MaskLayer=GW,e.MaskOperation=aI,e.MouseLocation=zB,e.PassType=LR,e.PointFillTriangulation=_E,e.PointLayer=wW,e.PolygonLayer=PW,e.PopperControl=bB,e.Popup=ez,e.PositionType=dM,e.RasterLayer=DW,e.RasterTileType=HD,e.Satistics=V_,e.Scale=UB,e.ScaleTypes=zD,e.Scene=HJ,e.SceneEventList=GD,e.SelectControl=SB,e.SizeUnitType=bG,e.Source=uB,e.SourceTile=pb,e.StencilType=oI,e.StyleScaleType=UD,e.TYPES=AT,e.TextureBlend=_G,e.TileDebugLayer=FW,e.TilesetManager=Nb,e.UpdateTileStrategy=$_,e.Version=Sz,e.Viewport=lU,e.WindLayer=cY,e.WorkerSourceMap=SE,e.Zoom=jB,e.aProjectFlat=e_,e.amap2Project=t_,e.amap2UnProject=n_,e.anchorTranslate=tv,e.anchorType=ev,e.applyAnchorClass=nv,e.bBoxToBounds=a_,e.bindAll=py,e.boundsContains=o_,e.calAngle=function(e,t){return 180*Math.acos(function(e,t){return e[0]*t[0]+e[1]*t[1]}(e,t)/(c_(e)*c_(t)))/Math.PI},e.calDistance=u_,e.calculateCentroid=h_,e.calculatePointsCenterAndRadius=f_,e.container=TD,e.createLayerContainer=ID,e.createSceneContainer=PD,e.decodePickingColor=Ov,e.dispatchMapCameraParams=Rd,e.dispatchMouseDown=pd,e.dispatchMouseMove=dd,e.dispatchMouseUp=vd,e.dispatchPointerDown=Ad,e.dispatchPointerMove=wd,e.dispatchPointerUp=Td,e.dispatchTouchEnd=Od,e.dispatchTouchMove=Ld,e.dispatchTouchStart=Id,e.djb2hash=function(e){for(var t=5381,n=(e=e.toString()).length;n;)t=33*t^e.charCodeAt(--n);return t>>>0},e.encodePickingColor=Rv,e.executeWorkerTask=function(e,t){return kE.apply(this,arguments)},e.expandUrl=Db,e.extent=qy,e.flow=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(e&&!(e.length<2)){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=u_(o,a);n+=s;var u=[o[0]-a[0],o[1]-a[1]],c=l_(0,u);if(i>0){var l=r[i-1].rotation;l-c>360-l+c&&(c+=360)}r.push({start:o,end:a,dis:s,rotation:c,duration:0})}return r.map((function(e){e.duration=t*(e.dis/n)})),r}},e.formatImage=Jd,e.generateCatRamp=Fv,e.generateColorRamp=Nv,e.generateCustomRamp=zv,e.generateLinearRamp=Dv,e.generateQuantizeRamp=Bv,e.getAngle=l_,e.getArrayBuffer=Zd,e.getBBoxFromPoints=p_,e.getCullFace=Hv,e.getDefaultDomain=jv,e.getImage=$d,e.getJSON=Xd,e.getReferrer=uy,e.getTileIndices=hb,e.getTileWarpXY=fb,e.getURLFromTemplate=Fb,e.getWMTSURLFromTemplate=Bb,e.gl=fL,e.guid=d_,e.isAndroid=hy,e.isColor=function(e){return"string"==typeof e&&!!_v(e)},e.isImageBitmap=ay,e.isMini=Bd,e.isMiniAli=Dd,e.isPC=fy,e.isURLTemplate=function(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)},e.isWeChatMiniProgram=Fd,e.isWorker=sy,e.isiOS=ly,e.latitude=$y,e.lazyInject=kD,e.lazyMultiInject=function(e){var t=CD.lazyMultiInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},e.lineAtOffset=w_,e.lineAtOffsetAsyc=function(e,t){return new Promise((function(n){e.inited?n(w_(e,t)):e.once("update",(function(){n(w_(e,t))}))}))},e.lineStyleType=mG,e.lngLatInExtent=Zy,e.lngLatToMeters=Ky,e.lnglatDistance=r_,e.longitude=Qy,e.makeXMLHttpRequestPromise=Wd,e.metersToLngLat=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=e[0],r=e[1],i=n/Xy*180,o=r/Xy*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=t&&(i=Number(i.toFixed(t)),o=Number(o.toFixed(t))),3===e.length?[i,o,e[2]]:[i,o]},e.miniWindow=zd,e.normalize=s_,e.osmLonLat2TileXY=ub,e.osmTileXY2LonLat=cb,e.packCircleVertex=function(e){var t=e.color,n=e.radius,r=e.tileX,i=e.tileY,o=e.shape,a=e.opacity,s=e.stroke,u=e.strokeWidth,c=e.strokeOpacity,l=[],h=[],f=[],p=[DD(t[0],t[1]),DD(t[2],t[3])],d=[DD(s[0],s[1]),DD(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(e){var t=D(e,2),s=t[0],v=t[1];l.push([].concat(p,[8388608*(s+1)+2097152*(v+1)+131072*ND(o)+n,524288*(r+512)+64*(i+512)])),h.push([].concat(d,[u,c])),f.push([a,0,0,0])})),{packedBuffer:l,packedBuffer2:h,packedBuffer3:f}},e.padBounds=i_,e.polygonFillTriangulation=bE,e.postData=function(e,t){return Yd(v(v({},e),{},{method:"POST"}),t)},e.project=function(e){var t=Math.PI/180,n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=Math.sin(r*t);return[6378137*e[0]*t,6378137*Math.log((1+i)/(1-i))/2]},e.rgb2arr=Lv,e.sameOrigin=function(e){var t=Ud.document.createElement("a");return t.href=e,t.protocol===Ud.document.location.protocol&&t.host===Ud.document.location.host},e.setL7WorkerSource=TE,e.setMiniScene=Nd,e.tileToBounds=lb,e.tranfrormCoord=function(e,t){return function e(t,n){if(Array.isArray(t[0]))return t.map((function(t){return e(t,n)}));return n(t)}(e,t)},e.unProjectFlat=function(e){var t=.5/Math.PI,n=-.5/Math.PI,r=.5,i=D(e,2),o=i[0],a=i[1];return o=(o/(256<<20)-.5)/t,a=(a/(256<<20)-r)/n,a=2*(Math.atan(Math.pow(Math.E,a))-Math.PI/4),[o/(r=Math.PI/180),a/r]},e.validateLngLat=Jy,e.version="2.17.7",Object.defineProperty(e,"__esModule",{value:!0})}));
