!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).L7Plot={})}(this,(function(t){"use strict";var e=new Map;var n=new Map;var r=new Map;var i=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},o={}.toString,a=function(t,e){return o.call(t)==="[object "+e+"]"},s=function(t){return a(t,"Function")},u=function(t){return Array.isArray?Array.isArray(t):a(t,"Array")},l=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e};function c(t,e){if(t)if(u(t))for(var n=0,r=t.length;n<r&&!1!==e(t[n],n);n++);else if(l(t))for(var i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))break}var h=function(t){return"object"==typeof t&&null!==t},p=function(t){if(!h(t)||!a(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},f=function(t){return a(t,"String")},d=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return c(t,(function(n,r){s(t)&&"prototype"===r||e.push(n)})),e},v=function(t){return(e=t,function(t){return null==t}(e)?"":e.toString()).toLowerCase();var e};function m(t,e){return t&&e?t.replace(/\\?\{([^{}]+)\}/g,(function(t,n){return"\\"===t.charAt(0)?t.slice(1):void 0===e[n]?"":e[n]})):t}var y=function(t){return a(t,"Boolean")},g=function(t){return void 0===t},_=function(t){if("object"!=typeof t||null===t)return t;var e;if(u(t)){e=[];for(var n=0,r=t.length;n<r;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=_(t[n]):e[n]=t[n]}else for(var i in e={},t)"object"==typeof t[i]&&null!=t[i]?e[i]=_(t[i]):e[i]=t[i];return e};function x(t,e,n,r){for(var i in n=n||0,r=r||5,e)if(e.hasOwnProperty(i)){var o=e[i];null!==o&&p(o)?(p(t[i])||(t[i]={}),n<r?x(t[i],o,n+1,r):t[i]=e[i]):u(o)?(t[i]=[],t[i]=t[i].concat(o)):void 0!==o&&(t[i]=o)}}var b=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)x(t,e[r]);return t},w=function(t,e){if(t===e)return!0;if(!t||!e)return!1;if(f(t)||f(e))return!1;if(i(t)||i(e)){if(t.length!==e.length)return!1;for(var n=!0,r=0;r<t.length&&(n=w(t[r],e[r]));r++);return n}if(h(t)||h(e)){var o=Object.keys(t),a=Object.keys(e);if(o.length!==a.length)return!1;for(n=!0,r=0;r<o.length&&(n=w(t[o[r]],e[o[r]]));r++);return n}return!1},S=Object.prototype.hasOwnProperty,E=function(t,e){if(null===t||!p(t))return{};var n={};return c(e,(function(e){S.call(t,e)&&(n[e]=t[e])})),n},A={},T=function(t){return A[t=t||"g"]?A[t]+=1:A[t]=1,t+A[t]},C=function(t,e){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},C(t,e)};function k(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}C(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var M,I=function(){return I=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},I.apply(this,arguments)};function P(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function L(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function R(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function O(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}"function"==typeof SuppressedError&&SuppressedError,function(t,e){if(!s(t))throw new TypeError("Expected a function");var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=e?e.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=t.apply(this,r);return a.set(o,s),s};n.cache=new Map}((function(t,e){void 0===e&&(e={});var n=e.fontSize,r=e.fontFamily,i=e.fontWeight,o=e.fontStyle,a=e.fontVariant;return M||(M=document.createElement("canvas").getContext("2d")),M.font=[o,a,i,n+"px",r].join(" "),M.measureText(f(t)?t:"").width}),(function(t,e){return void 0===e&&(e={}),function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}([t],d(e)).join("")}));var D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function N(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}var z={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ITEM_TPL=t.CONTAINER_TPL=t.VALUE_CLASS=t.NAME_CLASS=t.LIST_ITEM_CLASS=t.LIST_CLASS=t.TITLE_CLASS=t.CONTAINER_CLASS=void 0,t.CONTAINER_CLASS="l7plot-tooltip",t.TITLE_CLASS="l7plot-tooltip__title",t.LIST_CLASS="l7plot-tooltip__list",t.LIST_ITEM_CLASS="l7plot-tooltip__list-item",t.NAME_CLASS="l7plot-tooltip__name",t.VALUE_CLASS="l7plot-tooltip__value",t.CONTAINER_TPL='<div class="'.concat(t.CONTAINER_CLASS,'">\n  <div class="').concat(t.TITLE_CLASS,'"></div>\n  <ul class="').concat(t.LIST_CLASS,'"></ul>\n</div>'),t.ITEM_TPL='<li class="'.concat(t.LIST_ITEM_CLASS,'" data-index={index}>\n  <span class="').concat(t.NAME_CLASS,'">{name}</span>\n  <span class="').concat(t.VALUE_CLASS,'">{value}</span>\n</li>')}(z);var F={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ITEM_TPL=t.CONTAINER_TPL=t.VALUE_CLASS=t.MARKER_CLASS=t.LIST_ITEM_CLASS=t.LIST_CLASS=t.TITLE_CLASS=t.CONTAINER_CLASS=void 0,t.CONTAINER_CLASS="l7plot-legend l7plot-legend__category",t.TITLE_CLASS="l7plot-legend__title",t.LIST_CLASS="l7plot-legend__category-list",t.LIST_ITEM_CLASS="l7plot-legend__list-item",t.MARKER_CLASS="l7plot-legend__category-marker",t.VALUE_CLASS="l7plot-legend__category-value",t.CONTAINER_TPL='<div class="'.concat(t.CONTAINER_CLASS,'">\n  <div class="').concat(t.TITLE_CLASS,'"></div>\n  <ul class="').concat(t.LIST_CLASS,'"></ul>\n</div>'),t.ITEM_TPL='<li class="'.concat(t.LIST_ITEM_CLASS,'" data-index={index}>\n  <span class="').concat(t.MARKER_CLASS,'" style="background:{color}"></span>\n  <span class="').concat(t.VALUE_CLASS,'">{value}</span>\n</li>')}(F);var B={};function U(t){var e,n,r,i={point:{default:{fill:t.pointFillColor,size:t.pointSize,stroke:t.pointBorderColor,lineWidth:t.pointBorder,fillOpacity:t.pointFillOpacity},active:{fill:t.pointActiveFillColor},selected:{fill:t.pointSelectedFillColor}}};return{mapStyle:t.mapStyle,defaultColor:t.brandColor,subColor:t.subColor,semanticRed:t.paletteSemanticRed,semanticGreen:t.paletteSemanticGreen,fontFamily:t.fontFamily,colors10:t.paletteQualitative10,colors20:t.paletteQualitative20,sequenceColors:t.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:i.point.default},active:{style:i.point.active},selected:{style:i.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:(e={},e[F.CONTAINER_CLASS]={visibility:"visible",zIndex:1,backgroundColor:t.legendContainerFillColor,boxShadow:t.legendContainerShadow,borderRadius:"".concat(t.legendContainerBorderRadius,"px"),color:t.legendTextFillColor,fontFamily:t.fontFamily,padding:"10px",lineHeight:"1",fontSize:"".concat(t.legendTextFontSize,"px")},e[F.TITLE_CLASS]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},e[F.LIST_CLASS]={margin:"0px",padding:"0px"},e[F.LIST_ITEM_CLASS]={marginBottom:"2px"},e[F.MARKER_CLASS]={width:"10px",height:"10px"},e[F.VALUE_CLASS]={paddingLeft:"8px"},e)},continue:{domStyles:(n={},n[B.CONTAINER_CLASS]={visibility:"visible",zIndex:1,backgroundColor:t.legendContainerFillColor,boxShadow:t.legendContainerShadow,borderRadius:"".concat(t.legendContainerBorderRadius,"px"),color:t.legendTextFillColor,fontFamily:t.fontFamily,padding:"10px",lineHeight:1,fontSize:"".concat(t.legendTextFontSize,"px")},n[B.TITLE_CLASS]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},n[B.RIBBON_CLASS]={display:"flex",alignItems:"center"},n[B.GRADIENT_BAR_CLASS]={width:"140px",height:"14px",margin:"0px 5px"},n[B.VALUE_RANGE_CLASS]={padding:"0px"},n)}},tooltip:{domStyles:(r={},r[z.CONTAINER_CLASS]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:t.tooltipContainerFillColor,boxShadow:t.tooltipContainerShadow,borderRadius:"".concat(t.tooltipContainerBorderRadius,"px"),color:t.tooltipTextFillColor,fontSize:"".concat(t.tooltipTextFontSize,"px"),fontFamily:t.fontFamily,lineHeight:t.tooltipTextLineHeight},r[z.TITLE_CLASS]={marginBottom:"4px"},r[z.LIST_CLASS]={margin:"0px",padding:"0px"},r[z.LIST_ITEM_CLASS]={marginBottom:"4px"},r[z.NAME_CLASS]={color:t.tooltipItemNameFillColor},r[z.VALUE_CLASS]={color:t.tooltipItemValueFillColor,marginLeft:"30px"},r)},label:{style:{textAnchor:"center",textOffset:[0,0],fill:t.labelFillColor,fontSize:t.labelFontSize,fontFamily:t.fontFamily,fillColorDark:t.labelFillColorDark,fillColorLight:t.labelFillColorLight}}}}}!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RIBBON_TPL=t.CONTAINER_TPL=t.VALUE_RANGE_CLASS=t.GRADIENT_BAR_CLASS=t.RIBBON_CLASS=t.RIBBON_CONTAINER_CLASS=t.TITLE_CLASS=t.CONTAINER_CLASS=void 0,t.CONTAINER_CLASS="l7plot-legend l7plot-legend__continue",t.TITLE_CLASS="l7plot-legend__title",t.RIBBON_CONTAINER_CLASS="l7plot-legend__ribbon-container",t.RIBBON_CLASS="l7plot-legend__ribbon",t.GRADIENT_BAR_CLASS="l7plot-legend__gradient-bar",t.VALUE_RANGE_CLASS="l7plot-legend__value-range",t.CONTAINER_TPL='<div class="'.concat(t.CONTAINER_CLASS,'">\n  <div class="').concat(t.TITLE_CLASS,'"></div>\n  <div class="').concat(t.RIBBON_CONTAINER_CLASS,'"></div>\n</div>'),t.RIBBON_TPL='<div class="'.concat(t.RIBBON_CLASS,'">\n  <span class="').concat(t.VALUE_RANGE_CLASS,'">{min}</span>\n  <div class="').concat(t.GRADIENT_BAR_CLASS,'" style="background-image: {backgroundImage}"></div>\n  <span class="').concat(t.VALUE_RANGE_CLASS,'">{max}</span>\n</div>')}(B);var j="#000",V="#595959",G="#FFFFFF",H=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],W=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],Z=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],q=function(t){void 0===t&&(t={});var e=t.mapStyle,n=void 0===e?"light":e,r=t.subColor,i=void 0===r?"rgba(0,0,0,0.05)":r,o=t.paletteQualitative10,a=void 0===o?H:o,s=t.paletteQualitative20,u=void 0===s?W:s,l=t.paletteSemanticRed,c=void 0===l?"#F4664A":l,h=t.paletteSemanticGreen,p=void 0===h?"#30BF78":h,f=t.paletteSemanticYellow,d=void 0===f?"#FAAD14":f,v=t.paletteSequence,m=void 0===v?Z:v,y=t.fontFamily,g=void 0===y?'"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,\n    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",\n    "Noto Color Emoji"':y,_=t.brandColor,x=void 0===_?a[0]:_;return{mapStyle:n,brandColor:x,subColor:i,paletteQualitative10:a,paletteQualitative20:u,paletteSemanticRed:c,paletteSemanticGreen:p,paletteSemanticYellow:d,paletteSequence:m,fontFamily:g,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:V,legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:V,tooltipItemNameFillColor:V,tooltipItemValueFillColor:V,tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:V,labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:x,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:G,pointActiveBorderColor:j,pointSelectedBorderColor:j}};q();var X="#000",Y="#FFFFFF",K="#A6A6A6",Q=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],J=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],$=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],tt=function(t){void 0===t&&(t={});var e=t.mapStyle,n=void 0===e?"dark":e,r=t.subColor,i=void 0===r?"rgba(255,255,255,0.05)":r,o=t.paletteQualitative10,a=void 0===o?Q:o,s=t.paletteQualitative20,u=void 0===s?J:s,l=t.paletteSemanticRed,c=void 0===l?"#F4664A":l,h=t.paletteSemanticGreen,p=void 0===h?"#30BF78":h,f=t.paletteSemanticYellow,d=void 0===f?"#FAAD14":f,v=t.paletteSequence,m=void 0===v?$:v,y=t.fontFamily,g=void 0===y?'"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,\n    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",\n    "Noto Color Emoji"':y,_=t.brandColor;return{mapStyle:n,brandColor:void 0===_?a[0]:_,subColor:i,paletteQualitative10:a,paletteQualitative20:u,paletteSemanticRed:c,paletteSemanticGreen:p,paletteSemanticYellow:d,paletteSequence:m,fontFamily:g,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:K,legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:K,tooltipItemNameFillColor:K,tooltipItemValueFillColor:K,tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:K,labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:Q[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:X,pointActiveBorderColor:Y,pointSelectedBorderColor:Y}};function et(t){var e=t.styleSheet,n=void 0===e?{}:e,r=P(t,["styleSheet"]),i=q(n);return b({},U(i),r)}function nt(t){var e=t.styleSheet,n=void 0===e?{}:e,r=P(t,["styleSheet"]),i=tt(n);return b({},U(i),r)}tt();var rt,it,ot,at,st=et({}),ut={default:st,light:st,dark:nt({})};function lt(t){return void 0===t&&(t="default"),function(t,e,n){for(var r=0,i=f(e)?e.split("."):e;t&&r<i.length;)t=t[i[r++]];return void 0===t||r<i.length?n:t}(ut,v(t),ut.default)}t.LineStyleType=void 0,(rt=t.LineStyleType||(t.LineStyleType={}))[rt.solid=0]="solid",rt[rt.dash=1]="dash",t.LayerType=void 0,(it=t.LayerType||(t.LayerType={})).TextLayer="textLayer",it.DotLayer="dotLayer",it.IconLayer="iconLayer",it.DotDensity="dotDensityLayer",it.ColumnLayer="columnLayer",it.HeatmapLayer="heatmapLayer",it.GridLayer="gridLayer",it.HexbinLayer="hexbinLayer",it.LinesLayer="linesLayer",it.PathLayer="pathLayer",it.ArcLayer="arcLayer",it.AreaLayer="areaLayer",it.PrismLayer="prismLayer",t.BaseMapType=void 0,(ot=t.BaseMapType||(t.BaseMapType={})).Map="map",ot.Amap="amap",ot.AmapV1="amapv1",ot.AmapV2="amapv2",ot.Mapbox="mapbox",t.PlotType=void 0,(at=t.PlotType||(t.PlotType={})).Dot="dot",at.DotDensity="dotDensity",at.Heatmap="heatmap",at.Grid="grid",at.Hexbin="hexbin",at.Path="path",at.Flow="flow",at.Area="area",at.Choropleth="choropleth";var ct={},ht={},pt=function(t){return ht[t]},ft=function(t,e){ht[t]=e},dt=function(t,e){ct[t]=e},vt={},mt={};function yt(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function gt(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function _t(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function xt(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":function(t){return t<0?"-"+_t(-t,6):t>9999?"+"+_t(t,6):_t(t,4)}(t.getUTCFullYear())+"-"+_t(t.getUTCMonth()+1,2)+"-"+_t(t.getUTCDate(),2)+(i?"T"+_t(e,2)+":"+_t(n,2)+":"+_t(r,2)+"."+_t(i,3)+"Z":r?"T"+_t(e,2)+":"+_t(n,2)+":"+_t(r,2)+"Z":n||e?"T"+_t(e,2)+":"+_t(n,2)+"Z":"")}var bt=function(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],o=t.length,a=0,s=0,u=o<=0,l=!1;function c(){if(u)return mt;if(l)return l=!1,vt;var e,r,i=a;if(34===t.charCodeAt(i)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?u=!0:10===(r=t.charCodeAt(a++))?l=!0:13===r&&(l=!0,10===t.charCodeAt(a)&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=t.charCodeAt(e=a++)))l=!0;else if(13===r)l=!0,10===t.charCodeAt(a)&&++a;else if(r!==n)continue;return t.slice(i,e)}return u=!0,t.slice(i,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(r=c())!==mt;){for(var h=[];r!==vt&&r!==mt;)h.push(r),r=c();e&&null==(h=e(h,s++))||i.push(h)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?xt(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,o=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=yt(t);return function(r,i){return e(n(r),i,t)}}(t,e):yt(t)}));return o.columns=i||[],o},parseRows:r,format:function(e,n){return null==n&&(n=gt(e)),[n.map(a).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=gt(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}(","),wt=bt.parse;function St(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Et(t,e){if(t){if("string"==typeof t)return St(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?St(t,e):void 0}}function At(t){return function(t){if(Array.isArray(t))return St(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Et(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tt(t){return Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tt(t)}function Ct(t){var e=function(t,e){if("object"!==Tt(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==Tt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Tt(e)?e:String(e)}function kt(t,e,n){return(e=Ct(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function It(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(n),!0).forEach((function(e){kt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Pt=function t(e,n){var r,i=e&&e.type;if("FeatureCollection"===i)for(r=0;r<e.features.length;r++)t(e.features[r],n);else if("GeometryCollection"===i)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],n);else if("Feature"===i)t(e.geometry,n);else if("Polygon"===i)Lt(e.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<e.coordinates.length;r++)Lt(e.coordinates[r],n);return e};function Lt(t,e){if(0!==t.length){Rt(t[0],e);for(var n=1;n<t.length;n++)Rt(t[n],!e)}}function Rt(t,e){for(var n=0,r=0,i=0,o=t.length,a=o-1;i<o;a=i++){var s=(t[i][0]-t[a][0])*(t[a][1]+t[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!e&&t.reverse()}var Ot=6371008.8,Dt={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:Ot,metres:Ot,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:3440.069546436285,radians:1,yards:6967335.223679999};function Nt(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function zt(t,e,n){void 0===n&&(n={});for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return Nt({type:"Polygon",coordinates:t},e,n)}function Ft(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return Nt({type:"LineString",coordinates:t},e,n)}function Bt(t){return t%360*Math.PI/180}function Ut(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function jt(t){return"Feature"===t.type?t.geometry:t}function Vt(t,e,n){if(null!==t)for(var r,i,o,a,s,u,l,c,h=0,p=0,f=t.type,d="FeatureCollection"===f,v="Feature"===f,m=d?t.features.length:1,y=0;y<m;y++){s=(c=!!(l=d?t.features[y].geometry:v?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var g=0;g<s;g++){var _=0,x=0;if(null!==(a=c?l.geometries[g]:l)){u=a.coordinates;var b=a.type;switch(h=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(u,p,y,_,x))return!1;p++,_++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(!1===e(u[r],p,y,_,x))return!1;p++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-h;i++){if(!1===e(u[r][i],p,y,_,x))return!1;p++}"MultiLineString"===b&&_++,"Polygon"===b&&x++}"Polygon"===b&&_++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(x=0,i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-h;o++){if(!1===e(u[r][i][o],p,y,_,x))return!1;p++}x++}_++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===Vt(a.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Gt(t,e){!function(t,e){var n,r,i,o,a,s,u,l,c,h,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,v=f?t.features.length:1;for(n=0;n<v;n++){for(s=f?t.features[n].geometry:d?t.geometry:t,l=f?t.features[n].properties:d?t.properties:{},c=f?t.features[n].bbox:d?t.bbox:void 0,h=f?t.features[n].id:d?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,l,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],p,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,l,c,h))return!1;p++}}(t,(function(t,n,r,i,o){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(Nt(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<t.coordinates.length;u++){var l=t.coordinates[u];if(!1===e(Nt({type:a,coordinates:l},r),n,u))return!1}}))}function Ht(t,e){var n=e.x,r=e.y,i=e.x1,o=e.y1,a=e.coordinates,s=e.geometry,u=[];if(!Array.isArray(t))return{dataArray:[]};if(s)return t.filter((function(t){return t[s]&&t[s].type&&t[s].coordinates&&t[s].coordinates.length>0})).forEach((function(t,e){Gt(Pt(It({},t[s]),!0),(function(n){var r=Ut(n),i=It(It({},t),{},{_id:e,coordinates:r});u.push(i)}))})),{dataArray:u};for(var l=0;l<t.length;l++){var c=t[l],h=[];if(a){var p="Polygon";Array.isArray(a[0])||(p="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(p="LineString"),h=Pt({type:p,coordinates:At(c[a])},!0).coordinates}else if(n&&r&&i&&o){h=[[parseFloat(c[n]),parseFloat(c[r])],[parseFloat(c[i]),parseFloat(c[o])]]}else n&&r&&(h=[parseFloat(c[n]),parseFloat(c[r])]);var f=It(It({},c),{},{_id:l,coordinates:h});u.push(f)}return{dataArray:u}}function Wt(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function Zt(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){Wt(o,r,i,a,s,"next",t)}function s(t){Wt(o,r,i,a,s,"throw",t)}a(void 0)}))}}var qt={exports:{}},Xt={exports:{}};!function(t){function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Xt),function(t){var e=Xt.exports.default;function n(){t.exports=n=function(){return r},t.exports.__esModule=!0,t.exports.default=t.exports;var r={},i=Object.prototype,o=i.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function p(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,o=Object.create(i.prototype),s=new k(r||[]);return a(o,"_invoke",{value:E(t,n,s)}),o}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}r.wrap=p;var d={};function v(){}function m(){}function y(){}var g={};h(g,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(M([])));x&&x!==i&&o.call(x,u)&&(g=x);var b=y.prototype=v.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,n){function r(i,a,s,u){var l=f(t[i],t,a);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==e(h)&&o.call(h,"__await")?n.resolve(h.__await).then((function(t){r("next",t,s,u)}),(function(t){r("throw",t,s,u)})):n.resolve(h).then((function(t){c.value=t,s(c)}),(function(t){return r("throw",t,s,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function(t,e){function o(){return new n((function(n,i){r(t,e,n,i)}))}return i=i?i.then(o,o):o()}})}function E(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=A(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=f(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function A(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(t){if(t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:I}}function I(){return{value:void 0,done:!0}}return m.prototype=y,a(b,"constructor",{value:y,configurable:!0}),a(y,"constructor",{value:m,configurable:!0}),m.displayName=h(y,c,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,h(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},r.awrap=function(t){return{__await:t}},w(S.prototype),h(S.prototype,l,(function(){return this})),r.AsyncIterator=S,r.async=function(t,e,n,i,o){void 0===o&&(o=Promise);var a=new S(p(t,e,n,i),o);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),h(b,c,"Generator"),h(b,u,(function(){return this})),h(b,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},r.values=M,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),C(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;C(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:M(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},r}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}(qt);var Yt=qt.exports(),Kt=Yt;try{regeneratorRuntime=Yt}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=Yt:Function("r","regeneratorRuntime = r")(Yt)}function Qt(t,e,n,r){for(var i,o=r,a=n-e>>1,s=n-e,u=t[e],l=t[e+1],c=t[n],h=t[n+1],p=e+3;p<n;p+=3){var f=Jt(t[p],t[p+1],u,l,c,h);if(f>o)i=p,o=f;else if(f===o){var d=Math.abs(p-a);d<s&&(i=p,s=d)}}o>r&&(i-e>3&&Qt(t,e,i,r),t[i+2]=o,n-i>3&&Qt(t,i,n,r))}function Jt(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((t-n)*a+(e-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=t-n)*a+(s=e-r)*s}function $t(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)te(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)te(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)te(t,e[r][i])}(i),i}function te(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function ee(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)ne(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)ne(i[l],s);else if("LineString"===o)re(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],re(i[l],s,a,!1),t.push($t(u,"LineString",s,e.properties));return}ie(i,s,a,!1)}else if("Polygon"===o)ie(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)ee(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];ie(i[l],c,a,!0),s.push(c)}}t.push($t(u,o,s,e.properties))}}function ne(t,e){e.push(oe(t[0])),e.push(ae(t[1])),e.push(0)}function re(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var u=oe(t[s][0]),l=ae(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=e.length-3;e[2]=1,Qt(e,0,c,n),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function ie(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];re(t[i],o,n,r),e.push(o)}}function oe(t){return t/360+.5}function ae(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function se(t,e,n,r,i,o,a,s){if(r/=e,o>=(n/=e)&&a<r)return t;if(a<n||o>=r)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=n&&d<r)u.push(c);else if(!(d<n||f>=r)){var v=[];if("Point"===p||"MultiPoint"===p)ue(h,v,n,r,i);else if("LineString"===p)le(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===p)he(h,v,n,r,i,!1);else if("Polygon"===p)he(h,v,n,r,i,!0);else if("MultiPolygon"===p)for(var m=0;m<h.length;m++){var y=[];he(h[m],y,n,r,i,!0),y.length&&v.push(y)}if(v.length){if(s.lineMetrics&&"LineString"===p){for(m=0;m<v.length;m++)u.push($t(c.id,p,v[m],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===v.length?(p="LineString",v=v[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===v.length?"Point":"MultiPoint"),u.push($t(c.id,p,v,c.tags))}}}return u.length?u:null}function ue(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function le(t,e,n,r,i,o,a){for(var s,u,l=ce(t),c=0===i?fe:de,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],v=t[p+2],m=t[p+3],y=t[p+4],g=0===i?f:d,_=0===i?m:y,x=!1;a&&(s=Math.sqrt(Math.pow(f-m,2)+Math.pow(d-y,2))),g<n?_>n&&(u=c(l,f,d,m,y,n),a&&(l.start=h+s*u)):g>r?_<r&&(u=c(l,f,d,m,y,r),a&&(l.start=h+s*u)):pe(l,f,d,v),_<n&&g>=n&&(u=c(l,f,d,m,y,n),x=!0),_>r&&g<=r&&(u=c(l,f,d,m,y,r),x=!0),!o&&x&&(a&&(l.end=h+s*u),e.push(l),l=ce(t)),a&&(h+=s)}var b=t.length-3;f=t[b],d=t[b+1],v=t[b+2],(g=0===i?f:d)>=n&&g<=r&&pe(l,f,d,v),b=l.length-3,o&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&pe(l,l[0],l[1],l[2]),l.length&&e.push(l)}function ce(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function he(t,e,n,r,i,o){for(var a=0;a<t.length;a++)le(t[a],e,n,r,i,o,!1)}function pe(t,e,n,r){t.push(e),t.push(n),t.push(r)}function fe(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function de(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function ve(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=me(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(me(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(me(o.geometry[s][l],e));i.push(u)}n.push($t(o.id,a,i,o.tags))}return n}function me(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function ye(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(ge(l[r],l[r+1],e,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(ge(l[r][i],l[r][i+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function ge(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function _e(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,xe(a,t[s],o,i);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function xe(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)be(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)be(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)be(a,l[s],t,n,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function be(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===r||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}(s,o),t.push(s)}}function we(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)ee(n,t.features[r],e,r);else"Feature"===t.type?ee(n,t,e):ee(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(t,e){var n=e.buffer/e.extent,r=t,i=se(t,1,-1-n,n,0,-1,2,e),o=se(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=se(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=ve(i,1).concat(r)),o&&(r=r.concat(ve(o,-1)))),r}(r,e),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Se(t,e,n){return 32*((1<<t)*n+e)+t}function Ee(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ae(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ct(r.key),r)}}function Te(t,e,n){return e&&Ae(t.prototype,e),n&&Ae(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}we.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},we.prototype.splitTile=function(t,e,n,r,i,o,a){for(var s=[t,e,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=Se(e,n,r),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=_e(t,e,n,r,u),this.tileCoords.push({z:e,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){l>1&&console.time("clipping");var v,m,y,g,_,x,b=.5*u.buffer/u.extent,w=.5-b,S=.5+b,E=1+b;v=m=y=g=null,_=se(t,c,n-b,n+S,0,p.minX,p.maxX,u),x=se(t,c,n+w,n+E,0,p.minX,p.maxX,u),t=null,_&&(v=se(_,c,r-b,r+S,1,p.minY,p.maxY,u),m=se(_,c,r+w,r+E,1,p.minY,p.maxY,u),_=null),x&&(y=se(x,c,r-b,r+S,1,p.minY,p.maxY,u),g=se(x,c,r+w,r+E,1,p.minY,p.maxY,u),x=null),l>1&&console.timeEnd("clipping"),s.push(v||[],e+1,2*n,2*r),s.push(m||[],e+1,2*n,2*r+1),s.push(y||[],e+1,2*n+1,2*r),s.push(g||[],e+1,2*n+1,2*r+1)}}},we.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var a=1<<t,s=Se(t,e=(e%a+a)%a,n);if(this.tiles[s])return ye(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,l=t,c=e,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[Se(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?ye(this.tiles[s],i):null):null};var Ce=function(){function t(e,n,r,i){Ee(this,t),kt(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=e}return Te(t,[{key:"getTileData",value:function(t){return t&&this.vectorTile.layers[t]?this.vectorLayerCache[t]?this.vectorLayerCache[t]:this.vectorTile.layers[t].features:[]}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),t}(),ke={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function Me(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],r+=((n=t[a]).x-e.x)*(e.y+n.y);return r}var Ie=["Unknown","Point","LineString","Polygon"];function Pe(t,e,n,r,i){var o,a,s=i.geometry,u=i.type,l=i.tags,c=i.id,h=t*Math.pow(2,r),p=t*e,f=t*n,d=Ie[u];function v(t){for(var e=0;e<t.length;e++){var n=t[e];if(n[3])break;var r=180-360*(n[1]+f)/h,i=360*(n[0]+p)/h-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;t[e]=[i,o,0,1]}}switch(u){case 1:var m=[];for(o=0;o<s.length;o++)m[o]=s[o][0];v(s=m);break;case 2:for(o=0;o<s.length;o++)v(s[o]);break;case 3:for(s=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=Me(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(s),o=0;o<s.length;o++)for(a=0;a<s[o].length;a++)v(s[o][a])}return 1===s.length?s=s[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:s},properties:l,id:c,tileOrigin:[0,0],coord:""}}var Le=function(){var t=Zt(Kt.mark((function t(e,n,r,i){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var o=n.getTile(e.z,e.x,e.y),a=o?o.features.map((function(t){return Pe(i,r.x,r.y,r.z,t)})):[];t(new Ce({layers:{defaultLayer:{features:a}}},e.x,e.y,e.z))})));case 1:case"end":return t.stop()}}),t)})));return function(e,n,r,i){return t.apply(this,arguments)}}();function Re(t,e){return Re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Re(t,e)}function Oe(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Re(t,e)}function De(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ne(t,e){if(e&&("object"===Tt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return De(t)}function ze(t){return ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ze(t)}function Fe(t,e,n){return Fe=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Re(i,n.prototype),i},Fe.apply(null,arguments)}function Be(t){var e="function"==typeof Map?new Map:void 0;return Be=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Fe(t,arguments,ze(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Re(r,t)},Be(t)}var Ue="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function je(t){this.message=t}function Ve(t){for(var e,n,r,i,o="",a=0,s=(t=String(t)).length%3;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(i=t.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");e=n<<16|r<<8|i,o+=Ue.charAt(e>>18&63)+Ue.charAt(e>>12&63)+Ue.charAt(e>>6&63)+Ue.charAt(63&e)}return s?o.slice(0,s-3)+"===".substring(s):o}je.prototype=new Error,je.prototype.name="InvalidCharacterError";var Ge,He=function(){function t(e,n){Ee(this,t),this.buffers=e,this.type=n}return Te(t,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,e,n){throw new Error("not implemented")}}]),t}();Ge="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,n){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window;var We="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:Ge.devicePixelRatio,Ze=Te((function t(e,n){Ee(this,t),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()}));function qe(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Xe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xe(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Xe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ye=new WeakMap,Ke=function(){function t(){Ee(this,t),Ye.set(this,{})}return Te(t,[{key:"addEventListener",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Ye.get(this);r||(r={}),r[t]||(r[t]=[]),r[t].push(e),Ye.set(this,r),n.capture,n.once,n.passive}},{key:"removeEventListener",value:function(t,e){var n=Ye.get(this);if(n){var r=n[t];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===e){r.splice(i,1);break}}}},{key:"dispatchEvent",value:function(t){var e=Ye.get(this)[t.type];if(e){var n,r=qe(e);try{for(r.s();!(n=r.n()).done;){(0,n.value)(t)}}catch(t){r.e(t)}finally{r.f()}}}}]),t}();function Qe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Je=function(t){Oe(n,t);var e=Qe(n);function n(){var t;return Ee(this,n),(t=e.call(this)).childNodes=[],t}return Te(n,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),n}(Ke);function $e(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var tn,en,nn,rn,on=function(t){Oe(n,t);var e=$e(n);function n(){var t;return Ee(this,n),(t=e.call(this)).className="",t.children=[],t}return Te(n,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),n}(Je);if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var an=my.getSystemInfoSync();tn=an.screenWidth,en=an.screenHeight,nn=an.windowWidth,rn=an.windowHeight}else{var sn=Ge.innerWidth,un=Ge.innerHeight;tn=sn,en=un,nn=sn,rn=un}var ln={width:tn,height:en,availWidth:nn,availHeight:rn,availLeft:0,availTop:0},cn=ln.availWidth,hn=ln.availHeight,pn={style:[]};function fn(t,e){var n,r;"parentNode"in t||(n=0===e?function(){return null}:1===e?function(){return pn}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:n}));"parentElement"in t||(r=0===e?function(){return null}:1===e?function(){return pn}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:r}))}function dn(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function vn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}function mn(){}var yn=function(t){Oe(n,t);var e=vn(n);function n(){var t,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return Ee(this,n),(t=e.call(this)).className="",t.children=[],t.focus=mn,t.blur=mn,t.insertBefore=mn,t.appendChild=mn,t.removeChild=mn,t.remove=mn,t.innerHTML="",t.tagName=i.toUpperCase(),fn(De(t),o),(r=De(t)).style=r.style||{},Object.assign(r.style,{top:"0px",left:"0px",width:cn+"px",height:hn+"px",margin:"0px",padding:"0px"}),dn(De(t)),function(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=cn,t.clientHeight=hn),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}(De(t)),function(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=cn,t.offsetHeight=hn)}(De(t)),function(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=cn,t.scrollHeight=hn)}(De(t)),t}return Te(n)}(on);function gn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var _n=function(t){Oe(n,t);var e=gn(n);function n(t){return Ee(this,n),e.call(this,t)}return Te(n,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),n}(yn);function xn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var bn=function(t){Oe(n,t);var e=xn(n);function n(){return Ee(this,n),e.call(this,"video")}return Te(n)}(_n),wn={};function Sn(){return wn}var En=Te((function t(){Ee(this,t);var e=Sn(),n=e.createImage&&e.createImage()||{};return"tagName"in n||(n.tagName="IMG",n.__proto__=t.prototype),fn(n),dn(n),Object.assign(n,{addEventListener:function(t,e){n["on".concat(t)]=e.bind(n)},removeEventListener:function(t){n["on".concat(t)]=null}}),n})),An={href:"",protocol:"",host:""};function Tn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Cn=function(t){Oe(n,t);var e=Tn(n);function n(){return Ee(this,n),e.call(this,"body",0)}return Te(n,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,n){}},{key:"dispatchEvent",value:function(t){}}]),n}(yn),kn=function(t){Oe(n,t);var e=Tn(n);function n(){return Ee(this,n),e.call(this,"html",0)}return Te(n,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),n}(yn),Mn={},In={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:An,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new En:"video"===t?new bn:new yn(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,n){Mn[t]||(Mn[t]=[]),Mn[t].push(e)},removeEventListener:function(t,e){var n=Mn[t];if(n&&n.length>0)for(var r=n.length;r--;r>0)if(n[r]===e){n.splice(r,1);break}},dispatchEvent:function(t){var e=t.type,n=Mn[e];if(n)for(var r=0;r<n.length;r++)n[r](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new Ze(t)}};In.documentElement=new kn,In.head=new yn("head"),In.body=new Cn;var Pn,Ln,Rn,On,Dn=Object,Nn=function(){function t(){Ee(this,t);var e=arguments.length;if(2===e){if("number"==typeof arguments[0]&&"number"==typeof arguments[1])return this._w=arguments[0],this._h=arguments[1],void(this._data=new Uint8ClampedArray(this._w*this._h*4))}else 3===e&&"object"===Tt(arguments[0])&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return Te(t,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),t}();if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var zn=my.getSystemInfoSync();Pn=zn.system,Ln=zn.platform,Rn=zn.language}else{var Fn={versions:(On=Ge.navigator.userAgent,{trident:On.indexOf("Trident")>-1,presto:On.indexOf("Presto")>-1,webKit:On.indexOf("AppleWebKit")>-1,gecko:On.indexOf("Gecko")>-1&&-1===On.indexOf("KHTML"),mobile:!!On.match(/AppleWebKit.*Mobile.*/),ios:!!On.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:On.indexOf("Android")>-1||On.indexOf("Linux")>-1,iPhone:On.indexOf("iPhone")>-1,iPad:On.indexOf("iPad")>-1,webApp:-1===On.indexOf("Safari"),weixin:On.indexOf("MicroMessenger")>-1,qq:" qq"===On.match(/\sQQ/i)}),language:(Ge.navigator.browserLanguage||Ge.navigator.language).toLowerCase()};Fn.versions.android?Ln="android":Fn.versions.trident?Ln="IE":Fn.versions.presto?Ln="Opera":Fn.versions.webKit?Ln="webKit":Fn.versions.gecko?Ln="Firefox":Fn.versions.mobile?Ln="mobile":Fn.versions.ios?Ln="ios":Fn.versions.iPhone?Ln="iPhone":Fn.versions.iPad?Ln="ipad":Fn.versions.webApp?Ln="webApp":Fn.versions.weixin?Ln="weixin":Fn.versions.qq&&(Ln="qq"),Pn=Ge.navigator.userAgent,Rn=Fn.language}var Bn=-1!==Pn.toLowerCase().indexOf("android")?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Un="Mozilla/5.0 (".concat(Bn,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Rn),jn={platform:Ln,language:Rn,appVersion:"5.0 (".concat(Bn,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Un},Vn=0;var Gn=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Ee(this,t),0!=e.indexOf("http://")&&0!=e.indexOf("https://")?this.href=n+e:this.href=e}return Te(t,null,[{key:"createObjectURL",value:function(t){var e=t.buffers[0],n=t.type,r=function(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return Ve(e)}(e);return"data:".concat(n,";base64, ")+r}}]),t}();function Hn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Wn=new Map,Zn=new Map,qn=new Map,Xn=function(t){Oe(n,t);var e=Hn(n);function n(){var t;return Ee(this,n),(t=e.call(this)).onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Wn.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return Te(n,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=qn.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Zn.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\n")}},{key:"getResponseHeader",value:function(t){return Zn.get("responseHeader")[t]}},{key:"open",value:function(t,e,n){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var n=Wn.get("requestHeader");n[t]=e,Wn.set("requestHeader",n)}},{key:"addEventListener",value:function(t,e){var n=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||n,e.call(n,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),n}(Ke);Xn.UNSEND=0,Xn.OPENED=1,Xn.HEADERS_RECEIVED=2,Xn.LOADING=3,Xn.DONE=4;var Yn=!1;var Kn="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Qn="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Jn=(Kn||Qn)&&Yn,$n={atob:function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new je("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i="",o=0,a=0;r=e.charAt(a++);~r&&(n=o%4?64*n+r:r,o++%4)?i+=String.fromCharCode(255&n>>(-2*o&6)):0)r=Ue.indexOf(r);return i},btoa:Ve,devicePixelRatio:We,Blob:He,document:In,Element:on,Event:Ze,EventTarget:Ke,HTMLCanvasElement:Dn,HTMLElement:yn,HTMLMediaElement:_n,HTMLVideoElement:bn,Image:En,ImageData:Nn,navigator:jn,Node:Je,requestAnimationFrame:function(t){var e=Sn();return e.requestAnimationFrame?e.requestAnimationFrame(t):function(t){var e=Date.now(),n=Math.max(Vn+23,e);return setTimeout((function(){t(Vn=n)}),n-e)}(t)},cancelAnimationFrame:function(t){var e=Sn();return e.cancelAnimationFrame?e.cancelAnimationFrame(t):clearTimeout(t)},screen:ln,XMLHttpRequest:Xn,performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,n){return{duration:0}},now:function(){}},URL:Gn,WebGLRenderingContext:{GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},WebGL2RenderingContext:{},addEventListener:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};In.addEventListener(t,e,n)},removeEventListener:function(t,e,n){In.removeEventListener(t,e)},dispatchEvent:function(t){In.dispatchEvent(t)},innerWidth:ln.availWidth,innerHeight:ln.availHeight,setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval},tr=Jn?$n:Ge,er=Jn?Xn:Ge.XMLHttpRequest;function nr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}Jn||Ge.location;var rr=function(t){Oe(n,t);var e=nr(n);function n(t,r,i,o){var a;return Ee(this,n),(a=e.call(this,"AJAXError: ".concat(r," (").concat(t,"): ").concat(i))).status=t,a.statusText=r,a.url=i,a.body=o,a}return Te(n)}(Be(Error));function ir(t,e){var n=new er,r=Array.isArray(t.url)?t.url[0]:t.url;for(var i in n.open(t.method||"GET",r,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)t.headers.hasOwnProperty(i)&&n.setRequestHeader(i,t.headers[i]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===t.type)try{i=JSON.parse(n.response)}catch(t){return e(t)}e(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});e(new rr(n.status,n.statusText,r.toString(),o))}},n.send(t.body),n}function or(t){return new Promise((function(e,n){ir(t,(function(t,r,i,o,a){t?n({err:t,data:null,xhr:a}):e({err:null,data:r,cacheControl:i,expires:o,xhr:a})}))}))}function ar(t,e){return ir(t,e)}var sr=function(t,e){return ar(It(It({},t),{},{type:"arrayBuffer"}),e)},ur="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function lr(t,e){var n=new tr.Image,r=tr.URL||tr.webkitURL;n.crossOrigin="anonymous",n.onload=function(){e(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((function(){n.src=ur}))},n.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?r.createObjectURL(i):ur}function cr(t,e){var n=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(n).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of ".concat(t.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}var hr=function(t,e,n){var r=function(t,r){if(t)e(t);else if(r){var i="function"==typeof createImageBitmap,o=n?n(r):r;i?cr(o,e):lr(o,e)}};return"json"===t.type?function(t,e){return ar(It(It({},t),{},{type:"json"}),e)}(t,r):sr(t,r)},pr=function(t){return t.CENTER="center",t.TOP="top",t["TOP-LEFT"]="top-left",t["TOP-RIGHT"]="top-right",t.BOTTOM="bottom",t["BOTTOM-LEFT"]="bottom-left",t["BOTTOM-RIGHT"]="bottom-right",t.LEFT="left",t.RIGHT="right",t}({}),fr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function dr(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function vr(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function mr(){}var yr=.7,gr=1/yr,_r="\\s*([+-]?\\d+)\\s*",xr="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",br="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",wr=/^#([0-9a-f]{3,8})$/,Sr=new RegExp("^rgb\\("+[_r,_r,_r]+"\\)$"),Er=new RegExp("^rgb\\("+[br,br,br]+"\\)$"),Ar=new RegExp("^rgba\\("+[_r,_r,_r,xr]+"\\)$"),Tr=new RegExp("^rgba\\("+[br,br,br,xr]+"\\)$"),Cr=new RegExp("^hsl\\("+[xr,br,br]+"\\)$"),kr=new RegExp("^hsla\\("+[xr,br,br,xr]+"\\)$"),Mr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ir(){return this.rgb().formatHex()}function Pr(){return this.rgb().formatRgb()}function Lr(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=wr.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Rr(e):3===n?new Nr(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Or(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Or(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Sr.exec(t))?new Nr(e[1],e[2],e[3],1):(e=Er.exec(t))?new Nr(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Ar.exec(t))?Or(e[1],e[2],e[3],e[4]):(e=Tr.exec(t))?Or(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Cr.exec(t))?Ur(e[1],e[2]/100,e[3]/100,1):(e=kr.exec(t))?Ur(e[1],e[2]/100,e[3]/100,e[4]):Mr.hasOwnProperty(t)?Rr(Mr[t]):"transparent"===t?new Nr(NaN,NaN,NaN,0):null}function Rr(t){return new Nr(t>>16&255,t>>8&255,255&t,1)}function Or(t,e,n,r){return r<=0&&(t=e=n=NaN),new Nr(t,e,n,r)}function Dr(t,e,n,r){return 1===arguments.length?((i=t)instanceof mr||(i=Lr(i)),i?new Nr((i=i.rgb()).r,i.g,i.b,i.opacity):new Nr):new Nr(t,e,n,null==r?1:r);var i}function Nr(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function zr(){return"#"+Br(this.r)+Br(this.g)+Br(this.b)}function Fr(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Br(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Ur(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Vr(t,e,n,r)}function jr(t){if(t instanceof Vr)return new Vr(t.h,t.s,t.l,t.opacity);if(t instanceof mr||(t=Lr(t)),!t)return new Vr;if(t instanceof Vr)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new Vr(a,s,u,t.opacity)}function Vr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Gr(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function Hr(t){var e=Lr(t),n=[0,0,0,0];return null!=e&&(n[0]=e.r/255,n[1]=e.g/255,n[2]=e.b/255,n[3]=e.opacity),n}function Wr(t){return(t&&t[0])+256*(t&&t[1])+65536*(t&&t[2])-1}function Zr(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}function qr(t){var e=tr.document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;for(var r=null,i=n.createLinearGradient(0,0,256,1),o=t.positions[0],a=t.positions[t.positions.length-1],s=0;s<t.colors.length;++s){var u=(t.positions[s]-o)/(a-o);i.addColorStop(u,t.colors[s])}if(n.fillStyle=i,n.fillRect(0,0,256,1),Jn)return r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),e=null,n=null,{data:r,width:256,height:1};r=n.getImageData(0,0,256,1).data;for(var l=n.createImageData(256,1),c=0;c<l.data.length;c+=4)l.data[c+0]=r[c+0],l.data[c+1]=r[c+1],l.data[c+2]=r[c+2],l.data[c+3]=r[c+3];return e=null,n=null,l}function Xr(t,e){for(var n=t.createImageData(256,1),r=0;r<n.data.length;r+=4)n.data[r+0]=e[r+0],n.data[r+1]=e[r+1],n.data[r+2]=e[r+2],n.data[r+3]=e[r+3];return n}function Yr(t){return"cat"===t.type?[0,255]:[0,1]}dr(mr,Lr,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Ir,formatHex:Ir,formatHsl:function(){return jr(this).formatHsl()},formatRgb:Pr,toString:Pr}),dr(Nr,Dr,vr(mr,{brighter:function(t){return t=null==t?gr:Math.pow(gr,t),new Nr(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?yr:Math.pow(yr,t),new Nr(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:zr,formatHex:zr,formatRgb:Fr,toString:Fr})),dr(Vr,(function(t,e,n,r){return 1===arguments.length?jr(t):new Vr(t,e,n,null==r?1:r)}),vr(mr,{brighter:function(t){return t=null==t?gr:Math.pow(gr,t),new Vr(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?yr:Math.pow(yr,t),new Vr(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Nr(Gr(t>=240?t-240:t+120,i,r),Gr(t,i,r),Gr(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var Kr=1029,Qr=1028;function Jr(t){switch(t){case"GAODE1.x":case"GAODE2.x":case"GLOBEL":return Kr;default:return Qr}}function $r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(t,e)||Et(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ti={exports:{}};
/**
     * @license
     * Lodash <https://lodash.com/>
     * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
     * Released under MIT license <https://lodash.com/license>
     * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
     * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     */function ei(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function ni(t){return ei(t).split(/\s+/)}function ri(t,e,n){var r=tr.document.createElement(t);return e&&(r.className=e||""),n&&n.appendChild(r),r}function ii(t){var e=t.parentNode;e&&e.removeChild(t)}function oi(t,e){if(void 0!==t.classList)for(var n=ni(e),r=0,i=n.length;r<i;r++)t.classList.add(n[r]);else if(!function(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=ui(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}(t,e)){var o=ui(t);si(t,(o?o+" ":"")+e)}}function ai(t,e){void 0!==t.classList?ni(e).forEach((function(e){t.classList.remove(e)})):si(t,ei((" "+ui(t)+" ").replace(" "+e+" "," ")))}function si(t,e){t instanceof HTMLElement?t.className=e:t.className.baseVal=e}function ui(t){return t instanceof SVGElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}!function(t,e){(function(){var n,r="Expected a function",i="__lodash_hash_undefined__",o="__lodash_placeholder__",a=16,s=32,u=64,l=128,c=256,h=1/0,p=9007199254740991,f=NaN,d=4294967295,v=[["ary",l],["bind",1],["bindKey",2],["curry",8],["curryRight",a],["flip",512],["partial",s],["partialRight",u],["rearg",c]],m="[object Arguments]",y="[object Array]",g="[object Boolean]",_="[object Date]",x="[object Error]",b="[object Function]",w="[object GeneratorFunction]",S="[object Map]",E="[object Number]",A="[object Object]",T="[object Promise]",C="[object RegExp]",k="[object Set]",M="[object String]",I="[object Symbol]",P="[object WeakMap]",L="[object ArrayBuffer]",R="[object DataView]",O="[object Float32Array]",N="[object Float64Array]",z="[object Int8Array]",F="[object Int16Array]",B="[object Int32Array]",U="[object Uint8Array]",j="[object Uint8ClampedArray]",V="[object Uint16Array]",G="[object Uint32Array]",H=/\b__p \+= '';/g,W=/\b(__p \+=) '' \+/g,Z=/(__e\(.*?\)|\b__t\)) \+\n'';/g,q=/&(?:amp|lt|gt|quot|#39);/g,X=/[&<>"']/g,Y=RegExp(q.source),K=RegExp(X.source),Q=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,$=/<%=([\s\S]+?)%>/g,tt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,et=/^\w*$/,nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rt=/[\\^$.*+?()[\]{}|]/g,it=RegExp(rt.source),ot=/^\s+/,at=/\s/,st=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ut=/\{\n\/\* \[wrapped with (.+)\] \*/,lt=/,? & /,ct=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ht=/[()=,{}\[\]\/\s]/,pt=/\\(\\)?/g,ft=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,dt=/\w*$/,vt=/^[-+]0x[0-9a-f]+$/i,mt=/^0b[01]+$/i,yt=/^\[object .+?Constructor\]$/,gt=/^0o[0-7]+$/i,_t=/^(?:0|[1-9]\d*)$/,xt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,bt=/($^)/,wt=/['\n\r\u2028\u2029\\]/g,St="\\ud800-\\udfff",Et="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",At="\\u2700-\\u27bf",Tt="a-z\\xdf-\\xf6\\xf8-\\xff",Ct="A-Z\\xc0-\\xd6\\xd8-\\xde",kt="\\ufe0e\\ufe0f",Mt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",It="['’]",Pt="["+St+"]",Lt="["+Mt+"]",Rt="["+Et+"]",Ot="\\d+",Dt="["+At+"]",Nt="["+Tt+"]",zt="[^"+St+Mt+Ot+At+Tt+Ct+"]",Ft="\\ud83c[\\udffb-\\udfff]",Bt="[^"+St+"]",Ut="(?:\\ud83c[\\udde6-\\uddff]){2}",jt="[\\ud800-\\udbff][\\udc00-\\udfff]",Vt="["+Ct+"]",Gt="\\u200d",Ht="(?:"+Nt+"|"+zt+")",Wt="(?:"+Vt+"|"+zt+")",Zt="(?:['’](?:d|ll|m|re|s|t|ve))?",qt="(?:['’](?:D|LL|M|RE|S|T|VE))?",Xt="(?:"+Rt+"|"+Ft+")"+"?",Yt="["+kt+"]?",Kt=Yt+Xt+("(?:"+Gt+"(?:"+[Bt,Ut,jt].join("|")+")"+Yt+Xt+")*"),Qt="(?:"+[Dt,Ut,jt].join("|")+")"+Kt,Jt="(?:"+[Bt+Rt+"?",Rt,Ut,jt,Pt].join("|")+")",$t=RegExp(It,"g"),te=RegExp(Rt,"g"),ee=RegExp(Ft+"(?="+Ft+")|"+Jt+Kt,"g"),ne=RegExp([Vt+"?"+Nt+"+"+Zt+"(?="+[Lt,Vt,"$"].join("|")+")",Wt+"+"+qt+"(?="+[Lt,Vt+Ht,"$"].join("|")+")",Vt+"?"+Ht+"+"+Zt,Vt+"+"+qt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ot,Qt].join("|"),"g"),re=RegExp("["+Gt+St+Et+kt+"]"),ie=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,oe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ae=-1,se={};se[O]=se[N]=se[z]=se[F]=se[B]=se[U]=se[j]=se[V]=se[G]=!0,se[m]=se[y]=se[L]=se[g]=se[R]=se[_]=se[x]=se[b]=se[S]=se[E]=se[A]=se[C]=se[k]=se[M]=se[P]=!1;var ue={};ue[m]=ue[y]=ue[L]=ue[R]=ue[g]=ue[_]=ue[O]=ue[N]=ue[z]=ue[F]=ue[B]=ue[S]=ue[E]=ue[A]=ue[C]=ue[k]=ue[M]=ue[I]=ue[U]=ue[j]=ue[V]=ue[G]=!0,ue[x]=ue[b]=ue[P]=!1;var le={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ce=parseFloat,he=parseInt,pe="object"==typeof D&&D&&D.Object===Object&&D,fe="object"==typeof self&&self&&self.Object===Object&&self,de=pe||fe||Function("return this")(),ve=e&&!e.nodeType&&e,me=ve&&t&&!t.nodeType&&t,ye=me&&me.exports===ve,ge=ye&&pe.process,_e=function(){try{var t=me&&me.require&&me.require("util").types;return t||ge&&ge.binding&&ge.binding("util")}catch(t){}}(),xe=_e&&_e.isArrayBuffer,be=_e&&_e.isDate,we=_e&&_e.isMap,Se=_e&&_e.isRegExp,Ee=_e&&_e.isSet,Ae=_e&&_e.isTypedArray;function Te(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ce(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r}function ke(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Me(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Ie(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Pe(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function Le(t,e){return!!(null==t?0:t.length)&&Ve(t,e,0)>-1}function Re(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function Oe(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function De(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function Ne(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function ze(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Fe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Be=Ze("length");function Ue(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function je(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}function Ve(t,e,n){return e==e?function(t,e,n){var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):je(t,He,n)}function Ge(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1}function He(t){return t!=t}function We(t,e){var n=null==t?0:t.length;return n?Ye(t,e)/n:f}function Ze(t){return function(e){return null==e?n:e[t]}}function qe(t){return function(e){return null==t?n:t[e]}}function Xe(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)})),n}function Ye(t,e){for(var r,i=-1,o=t.length;++i<o;){var a=e(t[i]);a!==n&&(r=r===n?a:r+a)}return r}function Ke(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Qe(t){return t?t.slice(0,vn(t)+1).replace(ot,""):t}function Je(t){return function(e){return t(e)}}function $e(t,e){return Oe(e,(function(e){return t[e]}))}function tn(t,e){return t.has(e)}function en(t,e){for(var n=-1,r=t.length;++n<r&&Ve(e,t[n],0)>-1;);return n}function nn(t,e){for(var n=t.length;n--&&Ve(e,t[n],0)>-1;);return n}var rn=qe({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),on=qe({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(t){return"\\"+le[t]}function sn(t){return re.test(t)}function un(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function ln(t,e){return function(n){return t(e(n))}}function cn(t,e){for(var n=-1,r=t.length,i=0,a=[];++n<r;){var s=t[n];s!==e&&s!==o||(t[n]=o,a[i++]=n)}return a}function hn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function pn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}function fn(t){return sn(t)?function(t){var e=ee.lastIndex=0;for(;ee.test(t);)++e;return e}(t):Be(t)}function dn(t){return sn(t)?function(t){return t.match(ee)||[]}(t):function(t){return t.split("")}(t)}function vn(t){for(var e=t.length;e--&&at.test(t.charAt(e)););return e}var mn=qe({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var yn=function t(e){var D,at=(e=null==e?de:yn.defaults(de.Object(),e,yn.pick(de,oe))).Array,St=e.Date,Et=e.Error,At=e.Function,Tt=e.Math,Ct=e.Object,kt=e.RegExp,Mt=e.String,It=e.TypeError,Pt=at.prototype,Lt=At.prototype,Rt=Ct.prototype,Ot=e["__core-js_shared__"],Dt=Lt.toString,Nt=Rt.hasOwnProperty,zt=0,Ft=(D=/[^.]+$/.exec(Ot&&Ot.keys&&Ot.keys.IE_PROTO||""))?"Symbol(src)_1."+D:"",Bt=Rt.toString,Ut=Dt.call(Ct),jt=de._,Vt=kt("^"+Dt.call(Nt).replace(rt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gt=ye?e.Buffer:n,Ht=e.Symbol,Wt=e.Uint8Array,Zt=Gt?Gt.allocUnsafe:n,qt=ln(Ct.getPrototypeOf,Ct),Xt=Ct.create,Yt=Rt.propertyIsEnumerable,Kt=Pt.splice,Qt=Ht?Ht.isConcatSpreadable:n,Jt=Ht?Ht.iterator:n,ee=Ht?Ht.toStringTag:n,re=function(){try{var t=po(Ct,"defineProperty");return t({},"",{}),t}catch(t){}}(),le=e.clearTimeout!==de.clearTimeout&&e.clearTimeout,pe=St&&St.now!==de.Date.now&&St.now,fe=e.setTimeout!==de.setTimeout&&e.setTimeout,ve=Tt.ceil,me=Tt.floor,ge=Ct.getOwnPropertySymbols,_e=Gt?Gt.isBuffer:n,Be=e.isFinite,qe=Pt.join,gn=ln(Ct.keys,Ct),_n=Tt.max,xn=Tt.min,bn=St.now,wn=e.parseInt,Sn=Tt.random,En=Pt.reverse,An=po(e,"DataView"),Tn=po(e,"Map"),Cn=po(e,"Promise"),kn=po(e,"Set"),Mn=po(e,"WeakMap"),In=po(Ct,"create"),Pn=Mn&&new Mn,Ln={},Rn=Bo(An),On=Bo(Tn),Dn=Bo(Cn),Nn=Bo(kn),zn=Bo(Mn),Fn=Ht?Ht.prototype:n,Bn=Fn?Fn.valueOf:n,Un=Fn?Fn.toString:n;function jn(t){if(ns(t)&&!Wa(t)&&!(t instanceof Wn)){if(t instanceof Hn)return t;if(Nt.call(t,"__wrapped__"))return Uo(t)}return new Hn(t)}var Vn=function(){function t(){}return function(e){if(!es(e))return{};if(Xt)return Xt(e);t.prototype=e;var r=new t;return t.prototype=n,r}}();function Gn(){}function Hn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=n}function Wn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=d,this.__views__=[]}function Zn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function qn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Yn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Xn;++e<n;)this.add(t[e])}function Kn(t){var e=this.__data__=new qn(t);this.size=e.size}function Qn(t,e){var n=Wa(t),r=!n&&Ha(t),i=!n&&!r&&Ya(t),o=!n&&!r&&!i&&cs(t),a=n||r||i||o,s=a?Ke(t.length,Mt):[],u=s.length;for(var l in t)!e&&!Nt.call(t,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||xo(l,u))||s.push(l);return s}function Jn(t){var e=t.length;return e?t[Yr(0,e-1)]:n}function $n(t,e){return No(Ii(t),ur(e,0,t.length))}function tr(t){return No(Ii(t))}function er(t,e,r){(r!==n&&!ja(t[e],r)||r===n&&!(e in t))&&ar(t,e,r)}function nr(t,e,r){var i=t[e];Nt.call(t,e)&&ja(i,r)&&(r!==n||e in t)||ar(t,e,r)}function rr(t,e){for(var n=t.length;n--;)if(ja(t[n][0],e))return n;return-1}function ir(t,e,n,r){return fr(t,(function(t,i,o){e(r,t,n(t),o)})),r}function or(t,e){return t&&Pi(e,Ls(e),t)}function ar(t,e,n){"__proto__"==e&&re?re(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function sr(t,e){for(var r=-1,i=e.length,o=at(i),a=null==t;++r<i;)o[r]=a?n:Cs(t,e[r]);return o}function ur(t,e,r){return t==t&&(r!==n&&(t=t<=r?t:r),e!==n&&(t=t>=e?t:e)),t}function lr(t,e,r,i,o,a){var s,u=1&e,l=2&e,c=4&e;if(r&&(s=o?r(t,i,o,a):r(t)),s!==n)return s;if(!es(t))return t;var h=Wa(t);if(h){if(s=function(t){var e=t.length,n=new t.constructor(e);e&&"string"==typeof t[0]&&Nt.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!u)return Ii(t,s)}else{var p=mo(t),f=p==b||p==w;if(Ya(t))return Ei(t,u);if(p==A||p==m||f&&!o){if(s=l||f?{}:go(t),!u)return l?function(t,e){return Pi(t,vo(t),e)}(t,function(t,e){return t&&Pi(e,Rs(e),t)}(s,t)):function(t,e){return Pi(t,fo(t),e)}(t,or(s,t))}else{if(!ue[p])return o?t:{};s=function(t,e,n){var r=t.constructor;switch(e){case L:return Ai(t);case g:case _:return new r(+t);case R:return function(t,e){var n=e?Ai(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case O:case N:case z:case F:case B:case U:case j:case V:case G:return Ti(t,n);case S:return new r;case E:case M:return new r(t);case C:return function(t){var e=new t.constructor(t.source,dt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case k:return new r;case I:return i=t,Bn?Ct(Bn.call(i)):{}}var i}(t,p,u)}}a||(a=new Kn);var d=a.get(t);if(d)return d;a.set(t,s),ss(t)?t.forEach((function(n){s.add(lr(n,e,r,n,t,a))})):rs(t)&&t.forEach((function(n,i){s.set(i,lr(n,e,r,i,t,a))}));var v=h?n:(c?l?oo:io:l?Rs:Ls)(t);return ke(v||t,(function(n,i){v&&(n=t[i=n]),nr(s,i,lr(n,e,r,i,t,a))})),s}function cr(t,e,r){var i=r.length;if(null==t)return!i;for(t=Ct(t);i--;){var o=r[i],a=e[o],s=t[o];if(s===n&&!(o in t)||!a(s))return!1}return!0}function hr(t,e,i){if("function"!=typeof t)throw new It(r);return Lo((function(){t.apply(n,i)}),e)}function pr(t,e,n,r){var i=-1,o=Le,a=!0,s=t.length,u=[],l=e.length;if(!s)return u;n&&(e=Oe(e,Je(n))),r?(o=Re,a=!1):e.length>=200&&(o=tn,a=!1,e=new Yn(e));t:for(;++i<s;){var c=t[i],h=null==n?c:n(c);if(c=r||0!==c?c:0,a&&h==h){for(var p=l;p--;)if(e[p]===h)continue t;u.push(c)}else o(e,h,r)||u.push(c)}return u}jn.templateSettings={escape:Q,evaluate:J,interpolate:$,variable:"",imports:{_:jn}},jn.prototype=Gn.prototype,jn.prototype.constructor=jn,Hn.prototype=Vn(Gn.prototype),Hn.prototype.constructor=Hn,Wn.prototype=Vn(Gn.prototype),Wn.prototype.constructor=Wn,Zn.prototype.clear=function(){this.__data__=In?In(null):{},this.size=0},Zn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Zn.prototype.get=function(t){var e=this.__data__;if(In){var r=e[t];return r===i?n:r}return Nt.call(e,t)?e[t]:n},Zn.prototype.has=function(t){var e=this.__data__;return In?e[t]!==n:Nt.call(e,t)},Zn.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=In&&e===n?i:e,this},qn.prototype.clear=function(){this.__data__=[],this.size=0},qn.prototype.delete=function(t){var e=this.__data__,n=rr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Kt.call(e,n,1),--this.size,!0)},qn.prototype.get=function(t){var e=this.__data__,r=rr(e,t);return r<0?n:e[r][1]},qn.prototype.has=function(t){return rr(this.__data__,t)>-1},qn.prototype.set=function(t,e){var n=this.__data__,r=rr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Xn.prototype.clear=function(){this.size=0,this.__data__={hash:new Zn,map:new(Tn||qn),string:new Zn}},Xn.prototype.delete=function(t){var e=co(this,t).delete(t);return this.size-=e?1:0,e},Xn.prototype.get=function(t){return co(this,t).get(t)},Xn.prototype.has=function(t){return co(this,t).has(t)},Xn.prototype.set=function(t,e){var n=co(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Yn.prototype.add=Yn.prototype.push=function(t){return this.__data__.set(t,i),this},Yn.prototype.has=function(t){return this.__data__.has(t)},Kn.prototype.clear=function(){this.__data__=new qn,this.size=0},Kn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Kn.prototype.get=function(t){return this.__data__.get(t)},Kn.prototype.has=function(t){return this.__data__.has(t)},Kn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof qn){var r=n.__data__;if(!Tn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Xn(r)}return n.set(t,e),this.size=n.size,this};var fr=Oi(br),dr=Oi(wr,!0);function vr(t,e){var n=!0;return fr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function mr(t,e,r){for(var i=-1,o=t.length;++i<o;){var a=t[i],s=e(a);if(null!=s&&(u===n?s==s&&!ls(s):r(s,u)))var u=s,l=a}return l}function yr(t,e){var n=[];return fr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function gr(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=_o),i||(i=[]);++o<a;){var s=t[o];e>0&&n(s)?e>1?gr(s,e-1,n,r,i):De(i,s):r||(i[i.length]=s)}return i}var _r=Di(),xr=Di(!0);function br(t,e){return t&&_r(t,e,Ls)}function wr(t,e){return t&&xr(t,e,Ls)}function Sr(t,e){return Pe(e,(function(e){return Ja(t[e])}))}function Er(t,e){for(var r=0,i=(e=xi(e,t)).length;null!=t&&r<i;)t=t[Fo(e[r++])];return r&&r==i?t:n}function Ar(t,e,n){var r=e(t);return Wa(t)?r:De(r,n(t))}function Tr(t){return null==t?t===n?"[object Undefined]":"[object Null]":ee&&ee in Ct(t)?function(t){var e=Nt.call(t,ee),r=t[ee];try{t[ee]=n;var i=!0}catch(t){}var o=Bt.call(t);i&&(e?t[ee]=r:delete t[ee]);return o}(t):function(t){return Bt.call(t)}(t)}function Cr(t,e){return t>e}function kr(t,e){return null!=t&&Nt.call(t,e)}function Mr(t,e){return null!=t&&e in Ct(t)}function Ir(t,e,r){for(var i=r?Re:Le,o=t[0].length,a=t.length,s=a,u=at(a),l=1/0,c=[];s--;){var h=t[s];s&&e&&(h=Oe(h,Je(e))),l=xn(h.length,l),u[s]=!r&&(e||o>=120&&h.length>=120)?new Yn(s&&h):n}h=t[0];var p=-1,f=u[0];t:for(;++p<o&&c.length<l;){var d=h[p],v=e?e(d):d;if(d=r||0!==d?d:0,!(f?tn(f,v):i(c,v,r))){for(s=a;--s;){var m=u[s];if(!(m?tn(m,v):i(t[s],v,r)))continue t}f&&f.push(v),c.push(d)}}return c}function Pr(t,e,r){var i=null==(t=Mo(t,e=xi(e,t)))?t:t[Fo(Qo(e))];return null==i?n:Te(i,t,r)}function Lr(t){return ns(t)&&Tr(t)==m}function Rr(t,e,r,i,o){return t===e||(null==t||null==e||!ns(t)&&!ns(e)?t!=t&&e!=e:function(t,e,r,i,o,a){var s=Wa(t),u=Wa(e),l=s?y:mo(t),c=u?y:mo(e),h=(l=l==m?A:l)==A,p=(c=c==m?A:c)==A,f=l==c;if(f&&Ya(t)){if(!Ya(e))return!1;s=!0,h=!1}if(f&&!h)return a||(a=new Kn),s||cs(t)?no(t,e,r,i,o,a):function(t,e,n,r,i,o,a){switch(n){case R:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case L:return!(t.byteLength!=e.byteLength||!o(new Wt(t),new Wt(e)));case g:case _:case E:return ja(+t,+e);case x:return t.name==e.name&&t.message==e.message;case C:case M:return t==e+"";case S:var s=un;case k:var u=1&r;if(s||(s=hn),t.size!=e.size&&!u)return!1;var l=a.get(t);if(l)return l==e;r|=2,a.set(t,e);var c=no(s(t),s(e),r,i,o,a);return a.delete(t),c;case I:if(Bn)return Bn.call(t)==Bn.call(e)}return!1}(t,e,l,r,i,o,a);if(!(1&r)){var d=h&&Nt.call(t,"__wrapped__"),v=p&&Nt.call(e,"__wrapped__");if(d||v){var b=d?t.value():t,w=v?e.value():e;return a||(a=new Kn),o(b,w,r,i,a)}}if(!f)return!1;return a||(a=new Kn),function(t,e,r,i,o,a){var s=1&r,u=io(t),l=u.length,c=io(e),h=c.length;if(l!=h&&!s)return!1;var p=l;for(;p--;){var f=u[p];if(!(s?f in e:Nt.call(e,f)))return!1}var d=a.get(t),v=a.get(e);if(d&&v)return d==e&&v==t;var m=!0;a.set(t,e),a.set(e,t);var y=s;for(;++p<l;){var g=t[f=u[p]],_=e[f];if(i)var x=s?i(_,g,f,e,t,a):i(g,_,f,t,e,a);if(!(x===n?g===_||o(g,_,r,i,a):x)){m=!1;break}y||(y="constructor"==f)}if(m&&!y){var b=t.constructor,w=e.constructor;b==w||!("constructor"in t)||!("constructor"in e)||"function"==typeof b&&b instanceof b&&"function"==typeof w&&w instanceof w||(m=!1)}return a.delete(t),a.delete(e),m}(t,e,r,i,o,a)}(t,e,r,i,Rr,o))}function Or(t,e,r,i){var o=r.length,a=o,s=!i;if(null==t)return!a;for(t=Ct(t);o--;){var u=r[o];if(s&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<a;){var l=(u=r[o])[0],c=t[l],h=u[1];if(s&&u[2]){if(c===n&&!(l in t))return!1}else{var p=new Kn;if(i)var f=i(c,h,l,t,e,p);if(!(f===n?Rr(h,c,3,i,p):f))return!1}}return!0}function Dr(t){return!(!es(t)||(e=t,Ft&&Ft in e))&&(Ja(t)?Vt:yt).test(Bo(t));var e}function Nr(t){return"function"==typeof t?t:null==t?iu:"object"==typeof t?Wa(t)?Vr(t[0],t[1]):jr(t):fu(t)}function zr(t){if(!Ao(t))return gn(t);var e=[];for(var n in Ct(t))Nt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Fr(t){if(!es(t))return function(t){var e=[];if(null!=t)for(var n in Ct(t))e.push(n);return e}(t);var e=Ao(t),n=[];for(var r in t)("constructor"!=r||!e&&Nt.call(t,r))&&n.push(r);return n}function Br(t,e){return t<e}function Ur(t,e){var n=-1,r=qa(t)?at(t.length):[];return fr(t,(function(t,i,o){r[++n]=e(t,i,o)})),r}function jr(t){var e=ho(t);return 1==e.length&&e[0][2]?Co(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function Vr(t,e){return wo(t)&&To(e)?Co(Fo(t),e):function(r){var i=Cs(r,t);return i===n&&i===e?ks(r,t):Rr(e,i,3)}}function Gr(t,e,r,i,o){t!==e&&_r(e,(function(a,s){if(o||(o=new Kn),es(a))!function(t,e,r,i,o,a,s){var u=Io(t,r),l=Io(e,r),c=s.get(l);if(c)return void er(t,r,c);var h=a?a(u,l,r+"",t,e,s):n,p=h===n;if(p){var f=Wa(l),d=!f&&Ya(l),v=!f&&!d&&cs(l);h=l,f||d||v?Wa(u)?h=u:Xa(u)?h=Ii(u):d?(p=!1,h=Ei(l,!0)):v?(p=!1,h=Ti(l,!0)):h=[]:os(l)||Ha(l)?(h=u,Ha(u)?h=gs(u):es(u)&&!Ja(u)||(h=go(l))):p=!1}p&&(s.set(l,h),o(h,l,i,a,s),s.delete(l));er(t,r,h)}(t,e,s,r,Gr,i,o);else{var u=i?i(Io(t,s),a,s+"",t,e,o):n;u===n&&(u=a),er(t,s,u)}}),Rs)}function Hr(t,e){var r=t.length;if(r)return xo(e+=e<0?r:0,r)?t[e]:n}function Wr(t,e,n){e=e.length?Oe(e,(function(t){return Wa(t)?function(e){return Er(e,1===t.length?t[0]:t)}:t})):[iu];var r=-1;e=Oe(e,Je(lo()));var i=Ur(t,(function(t,n,i){var o=Oe(e,(function(e){return e(t)}));return{criteria:o,index:++r,value:t}}));return function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(i,(function(t,e){return function(t,e,n){var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;for(;++r<a;){var u=Ci(i[r],o[r]);if(u)return r>=s?u:u*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function Zr(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],s=Er(t,a);n(s,a)&&ti(o,xi(a,t),s)}return o}function qr(t,e,n,r){var i=r?Ge:Ve,o=-1,a=e.length,s=t;for(t===e&&(e=Ii(e)),n&&(s=Oe(t,Je(n)));++o<a;)for(var u=0,l=e[o],c=n?n(l):l;(u=i(s,c,u,r))>-1;)s!==t&&Kt.call(s,u,1),Kt.call(t,u,1);return t}function Xr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;xo(i)?Kt.call(t,i,1):pi(t,i)}}return t}function Yr(t,e){return t+me(Sn()*(e-t+1))}function Kr(t,e){var n="";if(!t||e<1||e>p)return n;do{e%2&&(n+=t),(e=me(e/2))&&(t+=t)}while(e);return n}function Qr(t,e){return Ro(ko(t,e,iu),t+"")}function Jr(t){return Jn(js(t))}function $r(t,e){var n=js(t);return No(n,ur(e,0,n.length))}function ti(t,e,r,i){if(!es(t))return t;for(var o=-1,a=(e=xi(e,t)).length,s=a-1,u=t;null!=u&&++o<a;){var l=Fo(e[o]),c=r;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(o!=s){var h=u[l];(c=i?i(h,l,u):n)===n&&(c=es(h)?h:xo(e[o+1])?[]:{})}nr(u,l,c),u=u[l]}return t}var ei=Pn?function(t,e){return Pn.set(t,e),t}:iu,ni=re?function(t,e){return re(t,"toString",{configurable:!0,enumerable:!1,value:eu(e),writable:!0})}:iu;function ri(t){return No(js(t))}function ii(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=at(i);++r<i;)o[r]=t[r+e];return o}function oi(t,e){var n;return fr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function ai(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!ls(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return si(t,e,iu,n)}function si(t,e,r,i){var o=0,a=null==t?0:t.length;if(0===a)return 0;for(var s=(e=r(e))!=e,u=null===e,l=ls(e),c=e===n;o<a;){var h=me((o+a)/2),p=r(t[h]),f=p!==n,d=null===p,v=p==p,m=ls(p);if(s)var y=i||v;else y=c?v&&(i||f):u?v&&f&&(i||!d):l?v&&f&&!d&&(i||!m):!d&&!m&&(i?p<=e:p<e);y?o=h+1:a=h}return xn(a,4294967294)}function ui(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],s=e?e(a):a;if(!n||!ja(s,u)){var u=s;o[i++]=0===a?0:a}}return o}function li(t){return"number"==typeof t?t:ls(t)?f:+t}function ci(t){if("string"==typeof t)return t;if(Wa(t))return Oe(t,ci)+"";if(ls(t))return Un?Un.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function hi(t,e,n){var r=-1,i=Le,o=t.length,a=!0,s=[],u=s;if(n)a=!1,i=Re;else if(o>=200){var l=e?null:Ki(t);if(l)return hn(l);a=!1,i=tn,u=new Yn}else u=e?[]:s;t:for(;++r<o;){var c=t[r],h=e?e(c):c;if(c=n||0!==c?c:0,a&&h==h){for(var p=u.length;p--;)if(u[p]===h)continue t;e&&u.push(h),s.push(c)}else i(u,h,n)||(u!==s&&u.push(h),s.push(c))}return s}function pi(t,e){return null==(t=Mo(t,e=xi(e,t)))||delete t[Fo(Qo(e))]}function fi(t,e,n,r){return ti(t,e,n(Er(t,e)),r)}function di(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?ii(t,r?0:o,r?o+1:i):ii(t,r?o+1:0,r?i:o)}function vi(t,e){var n=t;return n instanceof Wn&&(n=n.value()),Ne(e,(function(t,e){return e.func.apply(e.thisArg,De([t],e.args))}),n)}function mi(t,e,n){var r=t.length;if(r<2)return r?hi(t[0]):[];for(var i=-1,o=at(r);++i<r;)for(var a=t[i],s=-1;++s<r;)s!=i&&(o[i]=pr(o[i]||a,t[s],e,n));return hi(gr(o,1),e,n)}function yi(t,e,r){for(var i=-1,o=t.length,a=e.length,s={};++i<o;){var u=i<a?e[i]:n;r(s,t[i],u)}return s}function gi(t){return Xa(t)?t:[]}function _i(t){return"function"==typeof t?t:iu}function xi(t,e){return Wa(t)?t:wo(t,e)?[t]:zo(_s(t))}var bi=Qr;function wi(t,e,r){var i=t.length;return r=r===n?i:r,!e&&r>=i?t:ii(t,e,r)}var Si=le||function(t){return de.clearTimeout(t)};function Ei(t,e){if(e)return t.slice();var n=t.length,r=Zt?Zt(n):new t.constructor(n);return t.copy(r),r}function Ai(t){var e=new t.constructor(t.byteLength);return new Wt(e).set(new Wt(t)),e}function Ti(t,e){var n=e?Ai(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Ci(t,e){if(t!==e){var r=t!==n,i=null===t,o=t==t,a=ls(t),s=e!==n,u=null===e,l=e==e,c=ls(e);if(!u&&!c&&!a&&t>e||a&&s&&l&&!u&&!c||i&&s&&l||!r&&l||!o)return 1;if(!i&&!a&&!c&&t<e||c&&r&&o&&!i&&!a||u&&r&&o||!s&&o||!l)return-1}return 0}function ki(t,e,n,r){for(var i=-1,o=t.length,a=n.length,s=-1,u=e.length,l=_n(o-a,0),c=at(u+l),h=!r;++s<u;)c[s]=e[s];for(;++i<a;)(h||i<o)&&(c[n[i]]=t[i]);for(;l--;)c[s++]=t[i++];return c}function Mi(t,e,n,r){for(var i=-1,o=t.length,a=-1,s=n.length,u=-1,l=e.length,c=_n(o-s,0),h=at(c+l),p=!r;++i<c;)h[i]=t[i];for(var f=i;++u<l;)h[f+u]=e[u];for(;++a<s;)(p||i<o)&&(h[f+n[a]]=t[i++]);return h}function Ii(t,e){var n=-1,r=t.length;for(e||(e=at(r));++n<r;)e[n]=t[n];return e}function Pi(t,e,r,i){var o=!r;r||(r={});for(var a=-1,s=e.length;++a<s;){var u=e[a],l=i?i(r[u],t[u],u,r,t):n;l===n&&(l=t[u]),o?ar(r,u,l):nr(r,u,l)}return r}function Li(t,e){return function(n,r){var i=Wa(n)?Ce:ir,o=e?e():{};return i(n,t,lo(r,2),o)}}function Ri(t){return Qr((function(e,r){var i=-1,o=r.length,a=o>1?r[o-1]:n,s=o>2?r[2]:n;for(a=t.length>3&&"function"==typeof a?(o--,a):n,s&&bo(r[0],r[1],s)&&(a=o<3?n:a,o=1),e=Ct(e);++i<o;){var u=r[i];u&&t(e,u,i,a)}return e}))}function Oi(t,e){return function(n,r){if(null==n)return n;if(!qa(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Ct(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function Di(t){return function(e,n,r){for(var i=-1,o=Ct(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}function Ni(t){return function(e){var r=sn(e=_s(e))?dn(e):n,i=r?r[0]:e.charAt(0),o=r?wi(r,1).join(""):e.slice(1);return i[t]()+o}}function zi(t){return function(e){return Ne(Js(Hs(e).replace($t,"")),t,"")}}function Fi(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Vn(t.prototype),r=t.apply(n,e);return es(r)?r:n}}function Bi(t){return function(e,r,i){var o=Ct(e);if(!qa(e)){var a=lo(r,3);e=Ls(e),r=function(t){return a(o[t],t,o)}}var s=t(e,r,i);return s>-1?o[a?e[s]:s]:n}}function Ui(t){return ro((function(e){var i=e.length,o=i,a=Hn.prototype.thru;for(t&&e.reverse();o--;){var s=e[o];if("function"!=typeof s)throw new It(r);if(a&&!u&&"wrapper"==so(s))var u=new Hn([],!0)}for(o=u?o:i;++o<i;){var l=so(s=e[o]),c="wrapper"==l?ao(s):n;u=c&&So(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?u[so(c[0])].apply(u,c[3]):1==s.length&&So(s)?u[l]():u.thru(s)}return function(){var t=arguments,n=t[0];if(u&&1==t.length&&Wa(n))return u.plant(n).value();for(var r=0,o=i?e[r].apply(this,t):n;++r<i;)o=e[r].call(this,o);return o}}))}function ji(t,e,r,i,o,a,s,u,c,h){var p=e&l,f=1&e,d=2&e,v=24&e,m=512&e,y=d?n:Fi(t);return function l(){for(var g=arguments.length,_=at(g),x=g;x--;)_[x]=arguments[x];if(v)var b=uo(l),w=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(_,b);if(i&&(_=ki(_,i,o,v)),a&&(_=Mi(_,a,s,v)),g-=w,v&&g<h){var S=cn(_,b);return Xi(t,e,ji,l.placeholder,r,_,S,u,c,h-g)}var E=f?r:this,A=d?E[t]:t;return g=_.length,u?_=function(t,e){var r=t.length,i=xn(e.length,r),o=Ii(t);for(;i--;){var a=e[i];t[i]=xo(a,r)?o[a]:n}return t}(_,u):m&&g>1&&_.reverse(),p&&c<g&&(_.length=c),this&&this!==de&&this instanceof l&&(A=y||Fi(A)),A.apply(E,_)}}function Vi(t,e){return function(n,r){return function(t,e,n,r){return br(t,(function(t,i,o){e(r,n(t),i,o)})),r}(n,t,e(r),{})}}function Gi(t,e){return function(r,i){var o;if(r===n&&i===n)return e;if(r!==n&&(o=r),i!==n){if(o===n)return i;"string"==typeof r||"string"==typeof i?(r=ci(r),i=ci(i)):(r=li(r),i=li(i)),o=t(r,i)}return o}}function Hi(t){return ro((function(e){return e=Oe(e,Je(lo())),Qr((function(n){var r=this;return t(e,(function(t){return Te(t,r,n)}))}))}))}function Wi(t,e){var r=(e=e===n?" ":ci(e)).length;if(r<2)return r?Kr(e,t):e;var i=Kr(e,ve(t/fn(e)));return sn(e)?wi(dn(i),0,t).join(""):i.slice(0,t)}function Zi(t){return function(e,r,i){return i&&"number"!=typeof i&&bo(e,r,i)&&(r=i=n),e=ds(e),r===n?(r=e,e=0):r=ds(r),function(t,e,n,r){for(var i=-1,o=_n(ve((e-t)/(n||1)),0),a=at(o);o--;)a[r?o:++i]=t,t+=n;return a}(e,r,i=i===n?e<r?1:-1:ds(i),t)}}function qi(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=ys(e),n=ys(n)),t(e,n)}}function Xi(t,e,r,i,o,a,l,c,h,p){var f=8&e;e|=f?s:u,4&(e&=~(f?u:s))||(e&=-4);var d=[t,e,o,f?a:n,f?l:n,f?n:a,f?n:l,c,h,p],v=r.apply(n,d);return So(t)&&Po(v,d),v.placeholder=i,Oo(v,t,e)}function Yi(t){var e=Tt[t];return function(t,n){if(t=ys(t),(n=null==n?0:xn(vs(n),292))&&Be(t)){var r=(_s(t)+"e").split("e");return+((r=(_s(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Ki=kn&&1/hn(new kn([,-0]))[1]==h?function(t){return new kn(t)}:lu;function Qi(t){return function(e){var n=mo(e);return n==S?un(e):n==k?pn(e):function(t,e){return Oe(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ji(t,e,i,h,p,f,d,v){var m=2&e;if(!m&&"function"!=typeof t)throw new It(r);var y=h?h.length:0;if(y||(e&=-97,h=p=n),d=d===n?d:_n(vs(d),0),v=v===n?v:vs(v),y-=p?p.length:0,e&u){var g=h,_=p;h=p=n}var x=m?n:ao(t),b=[t,e,i,h,p,g,_,f,d,v];if(x&&function(t,e){var n=t[1],r=e[1],i=n|r,a=i<131,s=r==l&&8==n||r==l&&n==c&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!a&&!s)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var u=e[3];if(u){var h=t[3];t[3]=h?ki(h,u,e[4]):u,t[4]=h?cn(t[3],o):e[4]}(u=e[5])&&(h=t[5],t[5]=h?Mi(h,u,e[6]):u,t[6]=h?cn(t[5],o):e[6]);(u=e[7])&&(t[7]=u);r&l&&(t[8]=null==t[8]?e[8]:xn(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=i}(b,x),t=b[0],e=b[1],i=b[2],h=b[3],p=b[4],!(v=b[9]=b[9]===n?m?0:t.length:_n(b[9]-y,0))&&24&e&&(e&=-25),e&&1!=e)w=8==e||e==a?function(t,e,r){var i=Fi(t);return function o(){for(var a=arguments.length,s=at(a),u=a,l=uo(o);u--;)s[u]=arguments[u];var c=a<3&&s[0]!==l&&s[a-1]!==l?[]:cn(s,l);return(a-=c.length)<r?Xi(t,e,ji,o.placeholder,n,s,c,n,n,r-a):Te(this&&this!==de&&this instanceof o?i:t,this,s)}}(t,e,v):e!=s&&33!=e||p.length?ji.apply(n,b):function(t,e,n,r){var i=1&e,o=Fi(t);return function e(){for(var a=-1,s=arguments.length,u=-1,l=r.length,c=at(l+s),h=this&&this!==de&&this instanceof e?o:t;++u<l;)c[u]=r[u];for(;s--;)c[u++]=arguments[++a];return Te(h,i?n:this,c)}}(t,e,i,h);else var w=function(t,e,n){var r=1&e,i=Fi(t);return function e(){return(this&&this!==de&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,i);return Oo((x?ei:Po)(w,b),t,e)}function $i(t,e,r,i){return t===n||ja(t,Rt[r])&&!Nt.call(i,r)?e:t}function to(t,e,r,i,o,a){return es(t)&&es(e)&&(a.set(e,t),Gr(t,e,n,to,a),a.delete(e)),t}function eo(t){return os(t)?n:t}function no(t,e,r,i,o,a){var s=1&r,u=t.length,l=e.length;if(u!=l&&!(s&&l>u))return!1;var c=a.get(t),h=a.get(e);if(c&&h)return c==e&&h==t;var p=-1,f=!0,d=2&r?new Yn:n;for(a.set(t,e),a.set(e,t);++p<u;){var v=t[p],m=e[p];if(i)var y=s?i(m,v,p,e,t,a):i(v,m,p,t,e,a);if(y!==n){if(y)continue;f=!1;break}if(d){if(!Fe(e,(function(t,e){if(!tn(d,e)&&(v===t||o(v,t,r,i,a)))return d.push(e)}))){f=!1;break}}else if(v!==m&&!o(v,m,r,i,a)){f=!1;break}}return a.delete(t),a.delete(e),f}function ro(t){return Ro(ko(t,n,Zo),t+"")}function io(t){return Ar(t,Ls,fo)}function oo(t){return Ar(t,Rs,vo)}var ao=Pn?function(t){return Pn.get(t)}:lu;function so(t){for(var e=t.name+"",n=Ln[e],r=Nt.call(Ln,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function uo(t){return(Nt.call(jn,"placeholder")?jn:t).placeholder}function lo(){var t=jn.iteratee||ou;return t=t===ou?Nr:t,arguments.length?t(arguments[0],arguments[1]):t}function co(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function ho(t){for(var e=Ls(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,To(i)]}return e}function po(t,e){var r=function(t,e){return null==t?n:t[e]}(t,e);return Dr(r)?r:n}var fo=ge?function(t){return null==t?[]:(t=Ct(t),Pe(ge(t),(function(e){return Yt.call(t,e)})))}:mu,vo=ge?function(t){for(var e=[];t;)De(e,fo(t)),t=qt(t);return e}:mu,mo=Tr;function yo(t,e,n){for(var r=-1,i=(e=xi(e,t)).length,o=!1;++r<i;){var a=Fo(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&ts(i)&&xo(a,i)&&(Wa(t)||Ha(t))}function go(t){return"function"!=typeof t.constructor||Ao(t)?{}:Vn(qt(t))}function _o(t){return Wa(t)||Ha(t)||!!(Qt&&t&&t[Qt])}function xo(t,e){var n=typeof t;return!!(e=null==e?p:e)&&("number"==n||"symbol"!=n&&_t.test(t))&&t>-1&&t%1==0&&t<e}function bo(t,e,n){if(!es(n))return!1;var r=typeof e;return!!("number"==r?qa(n)&&xo(e,n.length):"string"==r&&e in n)&&ja(n[e],t)}function wo(t,e){if(Wa(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ls(t))||(et.test(t)||!tt.test(t)||null!=e&&t in Ct(e))}function So(t){var e=so(t),n=jn[e];if("function"!=typeof n||!(e in Wn.prototype))return!1;if(t===n)return!0;var r=ao(n);return!!r&&t===r[0]}(An&&mo(new An(new ArrayBuffer(1)))!=R||Tn&&mo(new Tn)!=S||Cn&&mo(Cn.resolve())!=T||kn&&mo(new kn)!=k||Mn&&mo(new Mn)!=P)&&(mo=function(t){var e=Tr(t),r=e==A?t.constructor:n,i=r?Bo(r):"";if(i)switch(i){case Rn:return R;case On:return S;case Dn:return T;case Nn:return k;case zn:return P}return e});var Eo=Ot?Ja:yu;function Ao(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Rt)}function To(t){return t==t&&!es(t)}function Co(t,e){return function(r){return null!=r&&(r[t]===e&&(e!==n||t in Ct(r)))}}function ko(t,e,r){return e=_n(e===n?t.length-1:e,0),function(){for(var n=arguments,i=-1,o=_n(n.length-e,0),a=at(o);++i<o;)a[i]=n[e+i];i=-1;for(var s=at(e+1);++i<e;)s[i]=n[i];return s[e]=r(a),Te(t,this,s)}}function Mo(t,e){return e.length<2?t:Er(t,ii(e,0,-1))}function Io(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Po=Do(ei),Lo=fe||function(t,e){return de.setTimeout(t,e)},Ro=Do(ni);function Oo(t,e,n){var r=e+"";return Ro(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(st,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return ke(v,(function(n){var r="_."+n[0];e&n[1]&&!Le(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(ut);return e?e[1].split(lt):[]}(r),n)))}function Do(t){var e=0,r=0;return function(){var i=bn(),o=16-(i-r);if(r=i,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(n,arguments)}}function No(t,e){var r=-1,i=t.length,o=i-1;for(e=e===n?i:e;++r<e;){var a=Yr(r,o),s=t[a];t[a]=t[r],t[r]=s}return t.length=e,t}var zo=function(t){var e=Da(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(nt,(function(t,n,r,i){e.push(r?i.replace(pt,"$1"):n||t)})),e}));function Fo(t){if("string"==typeof t||ls(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Bo(t){if(null!=t){try{return Dt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Uo(t){if(t instanceof Wn)return t.clone();var e=new Hn(t.__wrapped__,t.__chain__);return e.__actions__=Ii(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var jo=Qr((function(t,e){return Xa(t)?pr(t,gr(e,1,Xa,!0)):[]})),Vo=Qr((function(t,e){var r=Qo(e);return Xa(r)&&(r=n),Xa(t)?pr(t,gr(e,1,Xa,!0),lo(r,2)):[]})),Go=Qr((function(t,e){var r=Qo(e);return Xa(r)&&(r=n),Xa(t)?pr(t,gr(e,1,Xa,!0),n,r):[]}));function Ho(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:vs(n);return i<0&&(i=_n(r+i,0)),je(t,lo(e,3),i)}function Wo(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var o=i-1;return r!==n&&(o=vs(r),o=r<0?_n(i+o,0):xn(o,i-1)),je(t,lo(e,3),o,!0)}function Zo(t){return(null==t?0:t.length)?gr(t,1):[]}function qo(t){return t&&t.length?t[0]:n}var Xo=Qr((function(t){var e=Oe(t,gi);return e.length&&e[0]===t[0]?Ir(e):[]})),Yo=Qr((function(t){var e=Qo(t),r=Oe(t,gi);return e===Qo(r)?e=n:r.pop(),r.length&&r[0]===t[0]?Ir(r,lo(e,2)):[]})),Ko=Qr((function(t){var e=Qo(t),r=Oe(t,gi);return(e="function"==typeof e?e:n)&&r.pop(),r.length&&r[0]===t[0]?Ir(r,n,e):[]}));function Qo(t){var e=null==t?0:t.length;return e?t[e-1]:n}var Jo=Qr($o);function $o(t,e){return t&&t.length&&e&&e.length?qr(t,e):t}var ta=ro((function(t,e){var n=null==t?0:t.length,r=sr(t,e);return Xr(t,Oe(e,(function(t){return xo(t,n)?+t:t})).sort(Ci)),r}));function ea(t){return null==t?t:En.call(t)}var na=Qr((function(t){return hi(gr(t,1,Xa,!0))})),ra=Qr((function(t){var e=Qo(t);return Xa(e)&&(e=n),hi(gr(t,1,Xa,!0),lo(e,2))})),ia=Qr((function(t){var e=Qo(t);return e="function"==typeof e?e:n,hi(gr(t,1,Xa,!0),n,e)}));function oa(t){if(!t||!t.length)return[];var e=0;return t=Pe(t,(function(t){if(Xa(t))return e=_n(t.length,e),!0})),Ke(e,(function(e){return Oe(t,Ze(e))}))}function aa(t,e){if(!t||!t.length)return[];var r=oa(t);return null==e?r:Oe(r,(function(t){return Te(e,n,t)}))}var sa=Qr((function(t,e){return Xa(t)?pr(t,e):[]})),ua=Qr((function(t){return mi(Pe(t,Xa))})),la=Qr((function(t){var e=Qo(t);return Xa(e)&&(e=n),mi(Pe(t,Xa),lo(e,2))})),ca=Qr((function(t){var e=Qo(t);return e="function"==typeof e?e:n,mi(Pe(t,Xa),n,e)})),ha=Qr(oa);var pa=Qr((function(t){var e=t.length,r=e>1?t[e-1]:n;return r="function"==typeof r?(t.pop(),r):n,aa(t,r)}));function fa(t){var e=jn(t);return e.__chain__=!0,e}function da(t,e){return e(t)}var va=ro((function(t){var e=t.length,r=e?t[0]:0,i=this.__wrapped__,o=function(e){return sr(e,t)};return!(e>1||this.__actions__.length)&&i instanceof Wn&&xo(r)?((i=i.slice(r,+r+(e?1:0))).__actions__.push({func:da,args:[o],thisArg:n}),new Hn(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(n),t}))):this.thru(o)}));var ma=Li((function(t,e,n){Nt.call(t,n)?++t[n]:ar(t,n,1)}));var ya=Bi(Ho),ga=Bi(Wo);function _a(t,e){return(Wa(t)?ke:fr)(t,lo(e,3))}function xa(t,e){return(Wa(t)?Me:dr)(t,lo(e,3))}var ba=Li((function(t,e,n){Nt.call(t,n)?t[n].push(e):ar(t,n,[e])}));var wa=Qr((function(t,e,n){var r=-1,i="function"==typeof e,o=qa(t)?at(t.length):[];return fr(t,(function(t){o[++r]=i?Te(e,t,n):Pr(t,e,n)})),o})),Sa=Li((function(t,e,n){ar(t,n,e)}));function Ea(t,e){return(Wa(t)?Oe:Ur)(t,lo(e,3))}var Aa=Li((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var Ta=Qr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&bo(t,e[0],e[1])?e=[]:n>2&&bo(e[0],e[1],e[2])&&(e=[e[0]]),Wr(t,gr(e,1),[])})),Ca=pe||function(){return de.Date.now()};function ka(t,e,r){return e=r?n:e,e=t&&null==e?t.length:e,Ji(t,l,n,n,n,n,e)}function Ma(t,e){var i;if("function"!=typeof e)throw new It(r);return t=vs(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=n),i}}var Ia=Qr((function(t,e,n){var r=1;if(n.length){var i=cn(n,uo(Ia));r|=s}return Ji(t,r,e,n,i)})),Pa=Qr((function(t,e,n){var r=3;if(n.length){var i=cn(n,uo(Pa));r|=s}return Ji(e,r,t,n,i)}));function La(t,e,i){var o,a,s,u,l,c,h=0,p=!1,f=!1,d=!0;if("function"!=typeof t)throw new It(r);function v(e){var r=o,i=a;return o=a=n,h=e,u=t.apply(i,r)}function m(t){var r=t-c;return c===n||r>=e||r<0||f&&t-h>=s}function y(){var t=Ca();if(m(t))return g(t);l=Lo(y,function(t){var n=e-(t-c);return f?xn(n,s-(t-h)):n}(t))}function g(t){return l=n,d&&o?v(t):(o=a=n,u)}function _(){var t=Ca(),r=m(t);if(o=arguments,a=this,c=t,r){if(l===n)return function(t){return h=t,l=Lo(y,e),p?v(t):u}(c);if(f)return Si(l),l=Lo(y,e),v(c)}return l===n&&(l=Lo(y,e)),u}return e=ys(e)||0,es(i)&&(p=!!i.leading,s=(f="maxWait"in i)?_n(ys(i.maxWait)||0,e):s,d="trailing"in i?!!i.trailing:d),_.cancel=function(){l!==n&&Si(l),h=0,o=c=a=l=n},_.flush=function(){return l===n?u:g(Ca())},_}var Ra=Qr((function(t,e){return hr(t,1,e)})),Oa=Qr((function(t,e,n){return hr(t,ys(e)||0,n)}));function Da(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new It(r);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Da.Cache||Xn),n}function Na(t){if("function"!=typeof t)throw new It(r);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Da.Cache=Xn;var za=bi((function(t,e){var n=(e=1==e.length&&Wa(e[0])?Oe(e[0],Je(lo())):Oe(gr(e,1),Je(lo()))).length;return Qr((function(r){for(var i=-1,o=xn(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return Te(t,this,r)}))})),Fa=Qr((function(t,e){var r=cn(e,uo(Fa));return Ji(t,s,n,e,r)})),Ba=Qr((function(t,e){var r=cn(e,uo(Ba));return Ji(t,u,n,e,r)})),Ua=ro((function(t,e){return Ji(t,c,n,n,n,e)}));function ja(t,e){return t===e||t!=t&&e!=e}var Va=qi(Cr),Ga=qi((function(t,e){return t>=e})),Ha=Lr(function(){return arguments}())?Lr:function(t){return ns(t)&&Nt.call(t,"callee")&&!Yt.call(t,"callee")},Wa=at.isArray,Za=xe?Je(xe):function(t){return ns(t)&&Tr(t)==L};function qa(t){return null!=t&&ts(t.length)&&!Ja(t)}function Xa(t){return ns(t)&&qa(t)}var Ya=_e||yu,Ka=be?Je(be):function(t){return ns(t)&&Tr(t)==_};function Qa(t){if(!ns(t))return!1;var e=Tr(t);return e==x||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!os(t)}function Ja(t){if(!es(t))return!1;var e=Tr(t);return e==b||e==w||"[object AsyncFunction]"==e||"[object Proxy]"==e}function $a(t){return"number"==typeof t&&t==vs(t)}function ts(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=p}function es(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ns(t){return null!=t&&"object"==typeof t}var rs=we?Je(we):function(t){return ns(t)&&mo(t)==S};function is(t){return"number"==typeof t||ns(t)&&Tr(t)==E}function os(t){if(!ns(t)||Tr(t)!=A)return!1;var e=qt(t);if(null===e)return!0;var n=Nt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Dt.call(n)==Ut}var as=Se?Je(Se):function(t){return ns(t)&&Tr(t)==C};var ss=Ee?Je(Ee):function(t){return ns(t)&&mo(t)==k};function us(t){return"string"==typeof t||!Wa(t)&&ns(t)&&Tr(t)==M}function ls(t){return"symbol"==typeof t||ns(t)&&Tr(t)==I}var cs=Ae?Je(Ae):function(t){return ns(t)&&ts(t.length)&&!!se[Tr(t)]};var hs=qi(Br),ps=qi((function(t,e){return t<=e}));function fs(t){if(!t)return[];if(qa(t))return us(t)?dn(t):Ii(t);if(Jt&&t[Jt])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Jt]());var e=mo(t);return(e==S?un:e==k?hn:js)(t)}function ds(t){return t?(t=ys(t))===h||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function vs(t){var e=ds(t),n=e%1;return e==e?n?e-n:e:0}function ms(t){return t?ur(vs(t),0,d):0}function ys(t){if("number"==typeof t)return t;if(ls(t))return f;if(es(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=es(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Qe(t);var n=mt.test(t);return n||gt.test(t)?he(t.slice(2),n?2:8):vt.test(t)?f:+t}function gs(t){return Pi(t,Rs(t))}function _s(t){return null==t?"":ci(t)}var xs=Ri((function(t,e){if(Ao(e)||qa(e))Pi(e,Ls(e),t);else for(var n in e)Nt.call(e,n)&&nr(t,n,e[n])})),bs=Ri((function(t,e){Pi(e,Rs(e),t)})),ws=Ri((function(t,e,n,r){Pi(e,Rs(e),t,r)})),Ss=Ri((function(t,e,n,r){Pi(e,Ls(e),t,r)})),Es=ro(sr);var As=Qr((function(t,e){t=Ct(t);var r=-1,i=e.length,o=i>2?e[2]:n;for(o&&bo(e[0],e[1],o)&&(i=1);++r<i;)for(var a=e[r],s=Rs(a),u=-1,l=s.length;++u<l;){var c=s[u],h=t[c];(h===n||ja(h,Rt[c])&&!Nt.call(t,c))&&(t[c]=a[c])}return t})),Ts=Qr((function(t){return t.push(n,to),Te(Ds,n,t)}));function Cs(t,e,r){var i=null==t?n:Er(t,e);return i===n?r:i}function ks(t,e){return null!=t&&yo(t,e,Mr)}var Ms=Vi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),t[e]=n}),eu(iu)),Is=Vi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),Nt.call(t,e)?t[e].push(n):t[e]=[n]}),lo),Ps=Qr(Pr);function Ls(t){return qa(t)?Qn(t):zr(t)}function Rs(t){return qa(t)?Qn(t,!0):Fr(t)}var Os=Ri((function(t,e,n){Gr(t,e,n)})),Ds=Ri((function(t,e,n,r){Gr(t,e,n,r)})),Ns=ro((function(t,e){var n={};if(null==t)return n;var r=!1;e=Oe(e,(function(e){return e=xi(e,t),r||(r=e.length>1),e})),Pi(t,oo(t),n),r&&(n=lr(n,7,eo));for(var i=e.length;i--;)pi(n,e[i]);return n}));var zs=ro((function(t,e){return null==t?{}:function(t,e){return Zr(t,e,(function(e,n){return ks(t,n)}))}(t,e)}));function Fs(t,e){if(null==t)return{};var n=Oe(oo(t),(function(t){return[t]}));return e=lo(e),Zr(t,n,(function(t,n){return e(t,n[0])}))}var Bs=Qi(Ls),Us=Qi(Rs);function js(t){return null==t?[]:$e(t,Ls(t))}var Vs=zi((function(t,e,n){return e=e.toLowerCase(),t+(n?Gs(e):e)}));function Gs(t){return Qs(_s(t).toLowerCase())}function Hs(t){return(t=_s(t))&&t.replace(xt,rn).replace(te,"")}var Ws=zi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),Zs=zi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),qs=Ni("toLowerCase");var Xs=zi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var Ys=zi((function(t,e,n){return t+(n?" ":"")+Qs(e)}));var Ks=zi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Qs=Ni("toUpperCase");function Js(t,e,r){return t=_s(t),(e=r?n:e)===n?function(t){return ie.test(t)}(t)?function(t){return t.match(ne)||[]}(t):function(t){return t.match(ct)||[]}(t):t.match(e)||[]}var $s=Qr((function(t,e){try{return Te(t,n,e)}catch(t){return Qa(t)?t:new Et(t)}})),tu=ro((function(t,e){return ke(e,(function(e){e=Fo(e),ar(t,e,Ia(t[e],t))})),t}));function eu(t){return function(){return t}}var nu=Ui(),ru=Ui(!0);function iu(t){return t}function ou(t){return Nr("function"==typeof t?t:lr(t,1))}var au=Qr((function(t,e){return function(n){return Pr(n,t,e)}})),su=Qr((function(t,e){return function(n){return Pr(t,n,e)}}));function uu(t,e,n){var r=Ls(e),i=Sr(e,r);null!=n||es(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=Sr(e,Ls(e)));var o=!(es(n)&&"chain"in n&&!n.chain),a=Ja(t);return ke(i,(function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__);return(n.__actions__=Ii(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,De([this.value()],arguments))})})),t}function lu(){}var cu=Hi(Oe),hu=Hi(Ie),pu=Hi(Fe);function fu(t){return wo(t)?Ze(Fo(t)):function(t){return function(e){return Er(e,t)}}(t)}var du=Zi(),vu=Zi(!0);function mu(){return[]}function yu(){return!1}var gu=Gi((function(t,e){return t+e}),0),_u=Yi("ceil"),xu=Gi((function(t,e){return t/e}),1),bu=Yi("floor");var wu,Su=Gi((function(t,e){return t*e}),1),Eu=Yi("round"),Au=Gi((function(t,e){return t-e}),0);return jn.after=function(t,e){if("function"!=typeof e)throw new It(r);return t=vs(t),function(){if(--t<1)return e.apply(this,arguments)}},jn.ary=ka,jn.assign=xs,jn.assignIn=bs,jn.assignInWith=ws,jn.assignWith=Ss,jn.at=Es,jn.before=Ma,jn.bind=Ia,jn.bindAll=tu,jn.bindKey=Pa,jn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Wa(t)?t:[t]},jn.chain=fa,jn.chunk=function(t,e,r){e=(r?bo(t,e,r):e===n)?1:_n(vs(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var o=0,a=0,s=at(ve(i/e));o<i;)s[a++]=ii(t,o,o+=e);return s},jn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i},jn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=at(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return De(Wa(n)?Ii(n):[n],gr(e,1))},jn.cond=function(t){var e=null==t?0:t.length,n=lo();return t=e?Oe(t,(function(t){if("function"!=typeof t[1])throw new It(r);return[n(t[0]),t[1]]})):[],Qr((function(n){for(var r=-1;++r<e;){var i=t[r];if(Te(i[0],this,n))return Te(i[1],this,n)}}))},jn.conforms=function(t){return function(t){var e=Ls(t);return function(n){return cr(n,t,e)}}(lr(t,1))},jn.constant=eu,jn.countBy=ma,jn.create=function(t,e){var n=Vn(t);return null==e?n:or(n,e)},jn.curry=function t(e,r,i){var o=Ji(e,8,n,n,n,n,n,r=i?n:r);return o.placeholder=t.placeholder,o},jn.curryRight=function t(e,r,i){var o=Ji(e,a,n,n,n,n,n,r=i?n:r);return o.placeholder=t.placeholder,o},jn.debounce=La,jn.defaults=As,jn.defaultsDeep=Ts,jn.defer=Ra,jn.delay=Oa,jn.difference=jo,jn.differenceBy=Vo,jn.differenceWith=Go,jn.drop=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=r||e===n?1:vs(e))<0?0:e,i):[]},jn.dropRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,0,(e=i-(e=r||e===n?1:vs(e)))<0?0:e):[]},jn.dropRightWhile=function(t,e){return t&&t.length?di(t,lo(e,3),!0,!0):[]},jn.dropWhile=function(t,e){return t&&t.length?di(t,lo(e,3),!0):[]},jn.fill=function(t,e,r,i){var o=null==t?0:t.length;return o?(r&&"number"!=typeof r&&bo(t,e,r)&&(r=0,i=o),function(t,e,r,i){var o=t.length;for((r=vs(r))<0&&(r=-r>o?0:o+r),(i=i===n||i>o?o:vs(i))<0&&(i+=o),i=r>i?0:ms(i);r<i;)t[r++]=e;return t}(t,e,r,i)):[]},jn.filter=function(t,e){return(Wa(t)?Pe:yr)(t,lo(e,3))},jn.flatMap=function(t,e){return gr(Ea(t,e),1)},jn.flatMapDeep=function(t,e){return gr(Ea(t,e),h)},jn.flatMapDepth=function(t,e,r){return r=r===n?1:vs(r),gr(Ea(t,e),r)},jn.flatten=Zo,jn.flattenDeep=function(t){return(null==t?0:t.length)?gr(t,h):[]},jn.flattenDepth=function(t,e){return(null==t?0:t.length)?gr(t,e=e===n?1:vs(e)):[]},jn.flip=function(t){return Ji(t,512)},jn.flow=nu,jn.flowRight=ru,jn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},jn.functions=function(t){return null==t?[]:Sr(t,Ls(t))},jn.functionsIn=function(t){return null==t?[]:Sr(t,Rs(t))},jn.groupBy=ba,jn.initial=function(t){return(null==t?0:t.length)?ii(t,0,-1):[]},jn.intersection=Xo,jn.intersectionBy=Yo,jn.intersectionWith=Ko,jn.invert=Ms,jn.invertBy=Is,jn.invokeMap=wa,jn.iteratee=ou,jn.keyBy=Sa,jn.keys=Ls,jn.keysIn=Rs,jn.map=Ea,jn.mapKeys=function(t,e){var n={};return e=lo(e,3),br(t,(function(t,r,i){ar(n,e(t,r,i),t)})),n},jn.mapValues=function(t,e){var n={};return e=lo(e,3),br(t,(function(t,r,i){ar(n,r,e(t,r,i))})),n},jn.matches=function(t){return jr(lr(t,1))},jn.matchesProperty=function(t,e){return Vr(t,lr(e,1))},jn.memoize=Da,jn.merge=Os,jn.mergeWith=Ds,jn.method=au,jn.methodOf=su,jn.mixin=uu,jn.negate=Na,jn.nthArg=function(t){return t=vs(t),Qr((function(e){return Hr(e,t)}))},jn.omit=Ns,jn.omitBy=function(t,e){return Fs(t,Na(lo(e)))},jn.once=function(t){return Ma(2,t)},jn.orderBy=function(t,e,r,i){return null==t?[]:(Wa(e)||(e=null==e?[]:[e]),Wa(r=i?n:r)||(r=null==r?[]:[r]),Wr(t,e,r))},jn.over=cu,jn.overArgs=za,jn.overEvery=hu,jn.overSome=pu,jn.partial=Fa,jn.partialRight=Ba,jn.partition=Aa,jn.pick=zs,jn.pickBy=Fs,jn.property=fu,jn.propertyOf=function(t){return function(e){return null==t?n:Er(t,e)}},jn.pull=Jo,jn.pullAll=$o,jn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?qr(t,e,lo(n,2)):t},jn.pullAllWith=function(t,e,r){return t&&t.length&&e&&e.length?qr(t,e,n,r):t},jn.pullAt=ta,jn.range=du,jn.rangeRight=vu,jn.rearg=Ua,jn.reject=function(t,e){return(Wa(t)?Pe:yr)(t,Na(lo(e,3)))},jn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=lo(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return Xr(t,i),n},jn.rest=function(t,e){if("function"!=typeof t)throw new It(r);return Qr(t,e=e===n?e:vs(e))},jn.reverse=ea,jn.sampleSize=function(t,e,r){return e=(r?bo(t,e,r):e===n)?1:vs(e),(Wa(t)?$n:$r)(t,e)},jn.set=function(t,e,n){return null==t?t:ti(t,e,n)},jn.setWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:ti(t,e,r,i)},jn.shuffle=function(t){return(Wa(t)?tr:ri)(t)},jn.slice=function(t,e,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&bo(t,e,r)?(e=0,r=i):(e=null==e?0:vs(e),r=r===n?i:vs(r)),ii(t,e,r)):[]},jn.sortBy=Ta,jn.sortedUniq=function(t){return t&&t.length?ui(t):[]},jn.sortedUniqBy=function(t,e){return t&&t.length?ui(t,lo(e,2)):[]},jn.split=function(t,e,r){return r&&"number"!=typeof r&&bo(t,e,r)&&(e=r=n),(r=r===n?d:r>>>0)?(t=_s(t))&&("string"==typeof e||null!=e&&!as(e))&&!(e=ci(e))&&sn(t)?wi(dn(t),0,r):t.split(e,r):[]},jn.spread=function(t,e){if("function"!=typeof t)throw new It(r);return e=null==e?0:_n(vs(e),0),Qr((function(n){var r=n[e],i=wi(n,0,e);return r&&De(i,r),Te(t,this,i)}))},jn.tail=function(t){var e=null==t?0:t.length;return e?ii(t,1,e):[]},jn.take=function(t,e,r){return t&&t.length?ii(t,0,(e=r||e===n?1:vs(e))<0?0:e):[]},jn.takeRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=i-(e=r||e===n?1:vs(e)))<0?0:e,i):[]},jn.takeRightWhile=function(t,e){return t&&t.length?di(t,lo(e,3),!1,!0):[]},jn.takeWhile=function(t,e){return t&&t.length?di(t,lo(e,3)):[]},jn.tap=function(t,e){return e(t),t},jn.throttle=function(t,e,n){var i=!0,o=!0;if("function"!=typeof t)throw new It(r);return es(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),La(t,e,{leading:i,maxWait:e,trailing:o})},jn.thru=da,jn.toArray=fs,jn.toPairs=Bs,jn.toPairsIn=Us,jn.toPath=function(t){return Wa(t)?Oe(t,Fo):ls(t)?[t]:Ii(zo(_s(t)))},jn.toPlainObject=gs,jn.transform=function(t,e,n){var r=Wa(t),i=r||Ya(t)||cs(t);if(e=lo(e,4),null==n){var o=t&&t.constructor;n=i?r?new o:[]:es(t)&&Ja(o)?Vn(qt(t)):{}}return(i?ke:br)(t,(function(t,r,i){return e(n,t,r,i)})),n},jn.unary=function(t){return ka(t,1)},jn.union=na,jn.unionBy=ra,jn.unionWith=ia,jn.uniq=function(t){return t&&t.length?hi(t):[]},jn.uniqBy=function(t,e){return t&&t.length?hi(t,lo(e,2)):[]},jn.uniqWith=function(t,e){return e="function"==typeof e?e:n,t&&t.length?hi(t,n,e):[]},jn.unset=function(t,e){return null==t||pi(t,e)},jn.unzip=oa,jn.unzipWith=aa,jn.update=function(t,e,n){return null==t?t:fi(t,e,_i(n))},jn.updateWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:fi(t,e,_i(r),i)},jn.values=js,jn.valuesIn=function(t){return null==t?[]:$e(t,Rs(t))},jn.without=sa,jn.words=Js,jn.wrap=function(t,e){return Fa(_i(e),t)},jn.xor=ua,jn.xorBy=la,jn.xorWith=ca,jn.zip=ha,jn.zipObject=function(t,e){return yi(t||[],e||[],nr)},jn.zipObjectDeep=function(t,e){return yi(t||[],e||[],ti)},jn.zipWith=pa,jn.entries=Bs,jn.entriesIn=Us,jn.extend=bs,jn.extendWith=ws,uu(jn,jn),jn.add=gu,jn.attempt=$s,jn.camelCase=Vs,jn.capitalize=Gs,jn.ceil=_u,jn.clamp=function(t,e,r){return r===n&&(r=e,e=n),r!==n&&(r=(r=ys(r))==r?r:0),e!==n&&(e=(e=ys(e))==e?e:0),ur(ys(t),e,r)},jn.clone=function(t){return lr(t,4)},jn.cloneDeep=function(t){return lr(t,5)},jn.cloneDeepWith=function(t,e){return lr(t,5,e="function"==typeof e?e:n)},jn.cloneWith=function(t,e){return lr(t,4,e="function"==typeof e?e:n)},jn.conformsTo=function(t,e){return null==e||cr(t,e,Ls(e))},jn.deburr=Hs,jn.defaultTo=function(t,e){return null==t||t!=t?e:t},jn.divide=xu,jn.endsWith=function(t,e,r){t=_s(t),e=ci(e);var i=t.length,o=r=r===n?i:ur(vs(r),0,i);return(r-=e.length)>=0&&t.slice(r,o)==e},jn.eq=ja,jn.escape=function(t){return(t=_s(t))&&K.test(t)?t.replace(X,on):t},jn.escapeRegExp=function(t){return(t=_s(t))&&it.test(t)?t.replace(rt,"\\$&"):t},jn.every=function(t,e,r){var i=Wa(t)?Ie:vr;return r&&bo(t,e,r)&&(e=n),i(t,lo(e,3))},jn.find=ya,jn.findIndex=Ho,jn.findKey=function(t,e){return Ue(t,lo(e,3),br)},jn.findLast=ga,jn.findLastIndex=Wo,jn.findLastKey=function(t,e){return Ue(t,lo(e,3),wr)},jn.floor=bu,jn.forEach=_a,jn.forEachRight=xa,jn.forIn=function(t,e){return null==t?t:_r(t,lo(e,3),Rs)},jn.forInRight=function(t,e){return null==t?t:xr(t,lo(e,3),Rs)},jn.forOwn=function(t,e){return t&&br(t,lo(e,3))},jn.forOwnRight=function(t,e){return t&&wr(t,lo(e,3))},jn.get=Cs,jn.gt=Va,jn.gte=Ga,jn.has=function(t,e){return null!=t&&yo(t,e,kr)},jn.hasIn=ks,jn.head=qo,jn.identity=iu,jn.includes=function(t,e,n,r){t=qa(t)?t:js(t),n=n&&!r?vs(n):0;var i=t.length;return n<0&&(n=_n(i+n,0)),us(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Ve(t,e,n)>-1},jn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:vs(n);return i<0&&(i=_n(r+i,0)),Ve(t,e,i)},jn.inRange=function(t,e,r){return e=ds(e),r===n?(r=e,e=0):r=ds(r),function(t,e,n){return t>=xn(e,n)&&t<_n(e,n)}(t=ys(t),e,r)},jn.invoke=Ps,jn.isArguments=Ha,jn.isArray=Wa,jn.isArrayBuffer=Za,jn.isArrayLike=qa,jn.isArrayLikeObject=Xa,jn.isBoolean=function(t){return!0===t||!1===t||ns(t)&&Tr(t)==g},jn.isBuffer=Ya,jn.isDate=Ka,jn.isElement=function(t){return ns(t)&&1===t.nodeType&&!os(t)},jn.isEmpty=function(t){if(null==t)return!0;if(qa(t)&&(Wa(t)||"string"==typeof t||"function"==typeof t.splice||Ya(t)||cs(t)||Ha(t)))return!t.length;var e=mo(t);if(e==S||e==k)return!t.size;if(Ao(t))return!zr(t).length;for(var n in t)if(Nt.call(t,n))return!1;return!0},jn.isEqual=function(t,e){return Rr(t,e)},jn.isEqualWith=function(t,e,r){var i=(r="function"==typeof r?r:n)?r(t,e):n;return i===n?Rr(t,e,n,r):!!i},jn.isError=Qa,jn.isFinite=function(t){return"number"==typeof t&&Be(t)},jn.isFunction=Ja,jn.isInteger=$a,jn.isLength=ts,jn.isMap=rs,jn.isMatch=function(t,e){return t===e||Or(t,e,ho(e))},jn.isMatchWith=function(t,e,r){return r="function"==typeof r?r:n,Or(t,e,ho(e),r)},jn.isNaN=function(t){return is(t)&&t!=+t},jn.isNative=function(t){if(Eo(t))throw new Et("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Dr(t)},jn.isNil=function(t){return null==t},jn.isNull=function(t){return null===t},jn.isNumber=is,jn.isObject=es,jn.isObjectLike=ns,jn.isPlainObject=os,jn.isRegExp=as,jn.isSafeInteger=function(t){return $a(t)&&t>=-9007199254740991&&t<=p},jn.isSet=ss,jn.isString=us,jn.isSymbol=ls,jn.isTypedArray=cs,jn.isUndefined=function(t){return t===n},jn.isWeakMap=function(t){return ns(t)&&mo(t)==P},jn.isWeakSet=function(t){return ns(t)&&"[object WeakSet]"==Tr(t)},jn.join=function(t,e){return null==t?"":qe.call(t,e)},jn.kebabCase=Ws,jn.last=Qo,jn.lastIndexOf=function(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var o=i;return r!==n&&(o=(o=vs(r))<0?_n(i+o,0):xn(o,i-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,o):je(t,He,o,!0)},jn.lowerCase=Zs,jn.lowerFirst=qs,jn.lt=hs,jn.lte=ps,jn.max=function(t){return t&&t.length?mr(t,iu,Cr):n},jn.maxBy=function(t,e){return t&&t.length?mr(t,lo(e,2),Cr):n},jn.mean=function(t){return We(t,iu)},jn.meanBy=function(t,e){return We(t,lo(e,2))},jn.min=function(t){return t&&t.length?mr(t,iu,Br):n},jn.minBy=function(t,e){return t&&t.length?mr(t,lo(e,2),Br):n},jn.stubArray=mu,jn.stubFalse=yu,jn.stubObject=function(){return{}},jn.stubString=function(){return""},jn.stubTrue=function(){return!0},jn.multiply=Su,jn.nth=function(t,e){return t&&t.length?Hr(t,vs(e)):n},jn.noConflict=function(){return de._===this&&(de._=jt),this},jn.noop=lu,jn.now=Ca,jn.pad=function(t,e,n){t=_s(t);var r=(e=vs(e))?fn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Wi(me(i),n)+t+Wi(ve(i),n)},jn.padEnd=function(t,e,n){t=_s(t);var r=(e=vs(e))?fn(t):0;return e&&r<e?t+Wi(e-r,n):t},jn.padStart=function(t,e,n){t=_s(t);var r=(e=vs(e))?fn(t):0;return e&&r<e?Wi(e-r,n)+t:t},jn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),wn(_s(t).replace(ot,""),e||0)},jn.random=function(t,e,r){if(r&&"boolean"!=typeof r&&bo(t,e,r)&&(e=r=n),r===n&&("boolean"==typeof e?(r=e,e=n):"boolean"==typeof t&&(r=t,t=n)),t===n&&e===n?(t=0,e=1):(t=ds(t),e===n?(e=t,t=0):e=ds(e)),t>e){var i=t;t=e,e=i}if(r||t%1||e%1){var o=Sn();return xn(t+o*(e-t+ce("1e-"+((o+"").length-1))),e)}return Yr(t,e)},jn.reduce=function(t,e,n){var r=Wa(t)?Ne:Xe,i=arguments.length<3;return r(t,lo(e,4),n,i,fr)},jn.reduceRight=function(t,e,n){var r=Wa(t)?ze:Xe,i=arguments.length<3;return r(t,lo(e,4),n,i,dr)},jn.repeat=function(t,e,r){return e=(r?bo(t,e,r):e===n)?1:vs(e),Kr(_s(t),e)},jn.replace=function(){var t=arguments,e=_s(t[0]);return t.length<3?e:e.replace(t[1],t[2])},jn.result=function(t,e,r){var i=-1,o=(e=xi(e,t)).length;for(o||(o=1,t=n);++i<o;){var a=null==t?n:t[Fo(e[i])];a===n&&(i=o,a=r),t=Ja(a)?a.call(t):a}return t},jn.round=Eu,jn.runInContext=t,jn.sample=function(t){return(Wa(t)?Jn:Jr)(t)},jn.size=function(t){if(null==t)return 0;if(qa(t))return us(t)?fn(t):t.length;var e=mo(t);return e==S||e==k?t.size:zr(t).length},jn.snakeCase=Xs,jn.some=function(t,e,r){var i=Wa(t)?Fe:oi;return r&&bo(t,e,r)&&(e=n),i(t,lo(e,3))},jn.sortedIndex=function(t,e){return ai(t,e)},jn.sortedIndexBy=function(t,e,n){return si(t,e,lo(n,2))},jn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=ai(t,e);if(r<n&&ja(t[r],e))return r}return-1},jn.sortedLastIndex=function(t,e){return ai(t,e,!0)},jn.sortedLastIndexBy=function(t,e,n){return si(t,e,lo(n,2),!0)},jn.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=ai(t,e,!0)-1;if(ja(t[n],e))return n}return-1},jn.startCase=Ys,jn.startsWith=function(t,e,n){return t=_s(t),n=null==n?0:ur(vs(n),0,t.length),e=ci(e),t.slice(n,n+e.length)==e},jn.subtract=Au,jn.sum=function(t){return t&&t.length?Ye(t,iu):0},jn.sumBy=function(t,e){return t&&t.length?Ye(t,lo(e,2)):0},jn.template=function(t,e,r){var i=jn.templateSettings;r&&bo(t,e,r)&&(e=n),t=_s(t),e=ws({},e,i,$i);var o,a,s=ws({},e.imports,i.imports,$i),u=Ls(s),l=$e(s,u),c=0,h=e.interpolate||bt,p="__p += '",f=kt((e.escape||bt).source+"|"+h.source+"|"+(h===$?ft:bt).source+"|"+(e.evaluate||bt).source+"|$","g"),d="//# sourceURL="+(Nt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ae+"]")+"\n";t.replace(f,(function(e,n,r,i,s,u){return r||(r=i),p+=t.slice(c,u).replace(wt,an),n&&(o=!0,p+="' +\n__e("+n+") +\n'"),s&&(a=!0,p+="';\n"+s+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=u+e.length,e})),p+="';\n";var v=Nt.call(e,"variable")&&e.variable;if(v){if(ht.test(v))throw new Et("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(a?p.replace(H,""):p).replace(W,"$1").replace(Z,"$1;"),p="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var m=$s((function(){return At(u,d+"return "+p).apply(n,l)}));if(m.source=p,Qa(m))throw m;return m},jn.times=function(t,e){if((t=vs(t))<1||t>p)return[];var n=d,r=xn(t,d);e=lo(e),t-=d;for(var i=Ke(r,e);++n<t;)e(n);return i},jn.toFinite=ds,jn.toInteger=vs,jn.toLength=ms,jn.toLower=function(t){return _s(t).toLowerCase()},jn.toNumber=ys,jn.toSafeInteger=function(t){return t?ur(vs(t),-9007199254740991,p):0===t?t:0},jn.toString=_s,jn.toUpper=function(t){return _s(t).toUpperCase()},jn.trim=function(t,e,r){if((t=_s(t))&&(r||e===n))return Qe(t);if(!t||!(e=ci(e)))return t;var i=dn(t),o=dn(e);return wi(i,en(i,o),nn(i,o)+1).join("")},jn.trimEnd=function(t,e,r){if((t=_s(t))&&(r||e===n))return t.slice(0,vn(t)+1);if(!t||!(e=ci(e)))return t;var i=dn(t);return wi(i,0,nn(i,dn(e))+1).join("")},jn.trimStart=function(t,e,r){if((t=_s(t))&&(r||e===n))return t.replace(ot,"");if(!t||!(e=ci(e)))return t;var i=dn(t);return wi(i,en(i,dn(e))).join("")},jn.truncate=function(t,e){var r=30,i="...";if(es(e)){var o="separator"in e?e.separator:o;r="length"in e?vs(e.length):r,i="omission"in e?ci(e.omission):i}var a=(t=_s(t)).length;if(sn(t)){var s=dn(t);a=s.length}if(r>=a)return t;var u=r-fn(i);if(u<1)return i;var l=s?wi(s,0,u).join(""):t.slice(0,u);if(o===n)return l+i;if(s&&(u+=l.length-u),as(o)){if(t.slice(u).search(o)){var c,h=l;for(o.global||(o=kt(o.source,_s(dt.exec(o))+"g")),o.lastIndex=0;c=o.exec(h);)var p=c.index;l=l.slice(0,p===n?u:p)}}else if(t.indexOf(ci(o),u)!=u){var f=l.lastIndexOf(o);f>-1&&(l=l.slice(0,f))}return l+i},jn.unescape=function(t){return(t=_s(t))&&Y.test(t)?t.replace(q,mn):t},jn.uniqueId=function(t){var e=++zt;return _s(t)+e},jn.upperCase=Ks,jn.upperFirst=Qs,jn.each=_a,jn.eachRight=xa,jn.first=qo,uu(jn,(wu={},br(jn,(function(t,e){Nt.call(jn.prototype,e)||(wu[e]=t)})),wu),{chain:!1}),jn.VERSION="4.17.21",ke(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){jn[t].placeholder=jn})),ke(["drop","take"],(function(t,e){Wn.prototype[t]=function(r){r=r===n?1:_n(vs(r),0);var i=this.__filtered__&&!e?new Wn(this):this.clone();return i.__filtered__?i.__takeCount__=xn(r,i.__takeCount__):i.__views__.push({size:xn(r,d),type:t+(i.__dir__<0?"Right":"")}),i},Wn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),ke(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Wn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:lo(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),ke(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Wn.prototype[t]=function(){return this[n](1).value()[0]}})),ke(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Wn.prototype[t]=function(){return this.__filtered__?new Wn(this):this[n](1)}})),Wn.prototype.compact=function(){return this.filter(iu)},Wn.prototype.find=function(t){return this.filter(t).head()},Wn.prototype.findLast=function(t){return this.reverse().find(t)},Wn.prototype.invokeMap=Qr((function(t,e){return"function"==typeof t?new Wn(this):this.map((function(n){return Pr(n,t,e)}))})),Wn.prototype.reject=function(t){return this.filter(Na(lo(t)))},Wn.prototype.slice=function(t,e){t=vs(t);var r=this;return r.__filtered__&&(t>0||e<0)?new Wn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==n&&(r=(e=vs(e))<0?r.dropRight(-e):r.take(e-t)),r)},Wn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Wn.prototype.toArray=function(){return this.take(d)},br(Wn.prototype,(function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),o=jn[i?"take"+("last"==e?"Right":""):e],a=i||/^find/.test(e);o&&(jn.prototype[e]=function(){var e=this.__wrapped__,s=i?[1]:arguments,u=e instanceof Wn,l=s[0],c=u||Wa(e),h=function(t){var e=o.apply(jn,De([t],s));return i&&p?e[0]:e};c&&r&&"function"==typeof l&&1!=l.length&&(u=c=!1);var p=this.__chain__,f=!!this.__actions__.length,d=a&&!p,v=u&&!f;if(!a&&c){e=v?e:new Wn(this);var m=t.apply(e,s);return m.__actions__.push({func:da,args:[h],thisArg:n}),new Hn(m,p)}return d&&v?t.apply(this,s):(m=this.thru(h),d?i?m.value()[0]:m.value():m)})})),ke(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Pt[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);jn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Wa(i)?i:[],t)}return this[n]((function(n){return e.apply(Wa(n)?n:[],t)}))}})),br(Wn.prototype,(function(t,e){var n=jn[e];if(n){var r=n.name+"";Nt.call(Ln,r)||(Ln[r]=[]),Ln[r].push({name:e,func:n})}})),Ln[ji(n,2).name]=[{name:"wrapper",func:n}],Wn.prototype.clone=function(){var t=new Wn(this.__wrapped__);return t.__actions__=Ii(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ii(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ii(this.__views__),t},Wn.prototype.reverse=function(){if(this.__filtered__){var t=new Wn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Wn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Wa(t),r=e<0,i=n?t.length:0,o=function(t,e,n){var r=-1,i=n.length;for(;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=xn(e,t+a);break;case"takeRight":t=_n(t,e-a)}}return{start:t,end:e}}(0,i,this.__views__),a=o.start,s=o.end,u=s-a,l=r?s:a-1,c=this.__iteratees__,h=c.length,p=0,f=xn(u,this.__takeCount__);if(!n||!r&&i==u&&f==u)return vi(t,this.__actions__);var d=[];t:for(;u--&&p<f;){for(var v=-1,m=t[l+=e];++v<h;){var y=c[v],g=y.iteratee,_=y.type,x=g(m);if(2==_)m=x;else if(!x){if(1==_)continue t;break t}}d[p++]=m}return d},jn.prototype.at=va,jn.prototype.chain=function(){return fa(this)},jn.prototype.commit=function(){return new Hn(this.value(),this.__chain__)},jn.prototype.next=function(){this.__values__===n&&(this.__values__=fs(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?n:this.__values__[this.__index__++]}},jn.prototype.plant=function(t){for(var e,r=this;r instanceof Gn;){var i=Uo(r);i.__index__=0,i.__values__=n,e?o.__wrapped__=i:e=i;var o=i;r=r.__wrapped__}return o.__wrapped__=t,e},jn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Wn){var e=t;return this.__actions__.length&&(e=new Wn(this)),(e=e.reverse()).__actions__.push({func:da,args:[ea],thisArg:n}),new Hn(e,this.__chain__)}return this.thru(ea)},jn.prototype.toJSON=jn.prototype.valueOf=jn.prototype.value=function(){return vi(this.__wrapped__,this.__actions__)},jn.prototype.first=jn.prototype.head,Jt&&(jn.prototype[Jt]=function(){return this}),jn}();me?((me.exports=yn)._=yn,ve._=yn):de._=yn}).call(D)}(ti,ti.exports);var li=function(t){var e,n,r=null==tr||null===(e=tr.document)||void 0===e||null===(n=e.documentElement)||void 0===n?void 0:n.style;if(!r)return t[0];for(var i in t)if(t[i]&&t[i]in r)return t[i];return t[0]}(["transform","WebkitTransform"]);var ci,hi=function(){var t,e=tr.document.querySelector('meta[name="viewport"]');if(!e)return 1;var n=(null===(t=e.content)||void 0===t?void 0:t.split(",")).find((function(t){return"initial-scale"===$r(t.split("="),1)[0]}));return n?1*n.split("=")[1]:1}()<1?1:tr.devicePixelRatio;function pi(t,e){t.setAttribute("style","".concat(t.style.cssText).concat(e))}function fi(t){t.innerHTML=""}var di=null===(ci=navigator)||void 0===ci?void 0:ci.userAgent;function vi(t){var e=[1/0,1/0,-1/0,-1/0];return Vt(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function mi(t){return"number"==typeof t}di.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),di.indexOf("Android")>-1||di.indexOf("Adr"),vi.default=vi;var yi=2*Math.PI*6378137/2;function gi(t){var e=[1/0,1/0,-1/0,-1/0];return t.forEach((function(t){var n=t.coordinates;_i(e,n)})),e}function _i(t,e){return Array.isArray(e[0])?e.forEach((function(e){_i(t,e)})):(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])),t}function xi(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1};t=function(t,e){if(!1===e)return t;var n=function(t){if(null==t)throw new Error("lng is required");(t>180||t<-180)&&((t%=360)>180&&(t=-360+t),t<-180&&(t=360+t),0===t&&(t=0));return t}(t[0]),r=function(t){if(null==t)throw new Error("lat is required");(t>90||t<-90)&&((t%=180)>90&&(t=-180+t),t<-90&&(t=180+t),0===t&&(t=0));return t}(t[1]);r>85&&(r=85);r<-85&&(r=-85);return 3===t.length?[n,r,t[2]]:[n,r]}(t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]);var n=t[0],r=t[1],i=n*yi/180,o=Math.log(Math.tan((90+r)*Math.PI/360))/(Math.PI/180);return o=o*yi/180,e.enable&&(i=Number(i.toFixed(e.decimal)),o=Number(o.toFixed(e.decimal))),3===t.length?[i,o,t[2]]:[i,o]}function bi(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return o=r*(.5/Math.PI*o+.5),a=r*(-.5/Math.PI*a+(i=.5)),[Math.floor(o),Math.floor(a)]}function wi(t,e){var n=85.0511287798,r=Math.PI/180,i=6378137;return e=Math.max(Math.min(n,e),-n),e*=r,[(t*=r)*i,(e=Math.log(Math.tan(Math.PI/4+e/2)))*i]}function Si(t,e,n){var r=Bt(e[1]-t[1]),i=Bt(e[0]-t[0]),o=Bt(t[1]),a=Bt(e[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return function(t,e){void 0===e&&(e="kilometers");var n=Dt[e];if(!n)throw new Error(e+" units is invalid");return t*n}(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function Ei(t,e){var n=Math.abs(t[1][1]-t[0][1])*e,r=Math.abs(t[1][0]-t[0][0])*e;return[[t[0][0]-r,t[0][1]-n],[t[1][0]+r,t[1][1]+n]]}function Ai(t,e){return t[0][0]<=e[0][0]&&t[0][1]<=e[0][1]&&t[1][0]>=e[1][0]&&t[1][1]>=e[1][1]}function Ti(t){return[[t[0],t[1]],[t[2],t[3]]]}function Ci(t){var e,n,r=(e=t,n=[0,0],Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)));return[t[0]/r,t[1]/r]}function ki(t){if(mi(t[0]))return t;if(mi(t[0][0]))throw new Error("当前数据不支持标注");if(mi(t[0][0][0])){var e=0,n=0,r=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],n+=t[1],r++}))})),[e/r,n/r,0]}throw new Error("当前数据不支持标注")}var Mi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;Ee(this,t),this.limit=e,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return Te(t,[{key:"clear",value:function(){var t=this;this.order.forEach((function(e){t.delete(e)})),this.cache={},this.order=[]}},{key:"get",value:function(t){var e=this.cache[t];return e&&(this.deleteOrder(t),this.appendOrder(t)),e}},{key:"set",value:function(t,e){this.cache[t]?(this.delete(t),this.cache[t]=e,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=e,this.appendOrder(t))}},{key:"delete",value:function(t){var e=this.cache[t];e&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(e,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var e=this.order.findIndex((function(e){return e===t}));e>=0&&this.order.splice(e,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,e){return null}}]),t}();function Ii(t){if(0===t.length)return 0;for(var e=1*t[0],n=1;n<t.length;n++)e+=1*t[n];return e}var Pi={min:function(t){if(0===t.length)throw new Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return 1*e},max:function(t){if(0===t.length)throw new Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return 1*e},mean:function(t){if(0===t.length)throw new Error("mean requires at least one data point");return Ii(t)/t.length},sum:Ii,mode:function(t){if(0===t.length)throw new Error("mean requires at least one data point");if(t.length<3)return t[0];t.sort();for(var e=t[0],n=NaN,r=0,i=1,o=1;o<t.length+1;o++)t[o]!==e?(i>r&&(r=i,n=e),i=1,e=t[o]):i++;return 1*n}};function Li(t,e){return t.map((function(t){return t[e]}))}function Ri(t,e){void 0===e&&(e={});var n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),o=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r];return zt([[a,[i,r],[i,o],[n,o],a]],e.properties,{bbox:t,id:e.id})}var Oi={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||t,a),u=n?n+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},s.prototype.emit=function(t,e,r,i,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var u,l,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,i),!0;case 5:return c.fn.call(c.context,e,r,i,o),!0;case 6:return c.fn.call(c.context,e,r,i,o,a),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var p,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,r);break;case 4:c[l].fn.call(c[l].context,e,r,i);break;default:if(!u)for(p=1,u=new Array(h-1);p<h;p++)u[p-1]=arguments[p];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,i){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==e||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s}(Oi);var Di,Ni=Oi.exports,zi=function(t){return t.Realtime="realtime",t.Overlap="overlap",t.Replace="replace",t}({}),Fi=function(t){return t.Loading="Loading",t.Loaded="Loaded",t.Failure="Failure",t.Cancelled="Cancelled",t}({}),Bi=2;function Ui(t){for(;t;){if(t.isLoaded)return t.properties.state|=Bi,!0;t=t.parent}return!1}function ji(t){t.children.forEach((function(t){t.isLoaded?t.properties.state|=Bi:ji(t)}))}var Vi=[-1/0,-1/0,1/0,1/0],Gi=(kt(Di={},zi.Realtime,(function(t){t.forEach((function(t){t.isCurrent&&(t.isVisible=t.isLoaded)}))})),kt(Di,zi.Overlap,(function(t){t.forEach((function(t){t.properties.state=0})),t.forEach((function(t){t.isCurrent&&!Ui(t)&&ji(t)})),t.forEach((function(t){t.isVisible=Boolean(t.properties.state&Bi)}))})),kt(Di,zi.Replace,(function(t){t.forEach((function(t){t.properties.state=0})),t.forEach((function(t){t.isCurrent&&Ui(t)}));var e=t.slice().sort((function(t,e){return t.z-e.z}));e.forEach((function(t){t.isVisible=Boolean(t.properties.state&Bi),t.children.length&&(t.isVisible||1&t.properties.state)?t.children.forEach((function(t){t.properties.state=1})):t.isCurrent&&ji(t)}))})),Di),Hi=function(){};function Wi(t,e,n){return[Math.floor((t+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}function Zi(t,e,n){var r=t/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*e/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var qi=function(t,e,n){var r=$r(Zi(t,e,n),2),i=r[0],o=r[1],a=$r(Zi(t+1,e+1,n),2),s=a[0];return[i,a[1],s,o]};var Xi=function(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Math.pow(2,n),o=t;return r&&(o<0?o+=i:o>i-1&&(o%=i)),{warpX:o,warpY:e}};function Yi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Ki=function(t){Oe(r,t);var e,n=Yi(r);function r(t){var e;Ee(this,r),kt(De(e=n.call(this)),"tileSize",256),kt(De(e),"isVisible",!1),kt(De(e),"isCurrent",!1),kt(De(e),"isVisibleChange",!1),kt(De(e),"loadedLayers",0),kt(De(e),"isLayerLoaded",!1),kt(De(e),"isLoad",!1),kt(De(e),"isChildLoad",!1),kt(De(e),"parent",null),kt(De(e),"children",[]),kt(De(e),"data",null),kt(De(e),"properties",{}),kt(De(e),"loadDataId",0);var i=t.x,o=t.y,a=t.z,s=t.tileSize,u=t.warp,l=void 0===u||u;return e.x=i,e.y=o,e.z=a,e.warp=l||!0,e.tileSize=s,e}return Te(r,[{key:"isLoading",get:function(){return this.loadStatus===Fi.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Fi.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Fi.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Fi.Cancelled}},{key:"isDone",get:function(){return[Fi.Loaded,Fi.Cancelled,Fi.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return qi(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=$r(this.bounds,4),e=t[0],n=t[1],r=[(t[2]-e)/2,(t[3]-n)/2];return Ri(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:r,meta:"\n      ".concat(this.key,"\n      ")}})}},{key:"key",get:function(){return"".concat(this.x,"_").concat(this.y,"_").concat(this.z)}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:(e=Zt(Kt.mark((function t(e){var n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,y,g;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getData,r=e.onLoad,i=e.onError,this.loadDataId++,o=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Fi.Loading,a=null,t.prev=7,u=this.x,l=this.y,c=this.z,h=this.bounds,p=this.tileSize,f=this.warp,d=Xi(u,l,c,f),v=d.warpX,m=d.warpY,y=this.abortController.signal,g={x:v,y:m,z:c,bounds:h,tileSize:p,signal:y,warp:f},t.next=14,n(g,this);case 14:a=t.sent,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),s=t.t0;case 20:if(o===this.loadDataId){t.next=22;break}return t.abrupt("return");case 22:if(!this.isCancelled||a){t.next=24;break}return t.abrupt("return");case 24:if(!s&&a){t.next=28;break}return this.loadStatus=Fi.Failure,i(s,this),t.abrupt("return");case 28:this.loadStatus=Fi.Loaded,this.data=a,r(this);case 31:case"end":return t.stop()}}),t,this,[[7,17]])}))),function(t){return e.apply(this,arguments)})},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Fi.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(Oi.exports.EventEmitter);function Qi(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Ji(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ji(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Ji(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function $i(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var to=function(t){return t.TilesLoadStart="tiles-load-start",t.TileLoaded="tile-loaded",t.TileError="tile-error",t.TileUnload="tile-unload",t.TileUpdate="tile-update",t.TilesLoadFinished="tiles-load-finished",t}({}),eo=function(t){Oe(n,t);var e=$i(n);function n(t){var r;return Ee(this,n),kt(De(r=e.call(this)),"currentTiles",[]),kt(De(r),"cacheTiles",new Map),kt(De(r),"throttleUpdate",ti.exports.throttle((function(t,e){r.update(t,e)}),16)),kt(De(r),"onTileLoad",(function(t){r.emit(to.TileLoaded,t),r.updateTileVisible(),r.loadFinished()})),kt(De(r),"onTileError",(function(t,e){r.emit(to.TileError,{error:t,tile:e}),r.updateTileVisible(),r.loadFinished()})),kt(De(r),"onTileUnload",(function(t){r.emit(to.TileUnload,t),r.loadFinished()})),r.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:Vi,getTileData:Hi,warp:!0,updateStrategy:zi.Overlap},r.updateOptions(t),r}return Te(n,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(t){return t.isDone}))}},{key:"tiles",get:function(){var t=Array.from(this.cacheTiles.values()).sort((function(t,e){return t.z-e.z}));return t}},{key:"updateOptions",value:function(t){var e=void 0===t.minZoom?this.options.minZoom:Math.ceil(t.minZoom),n=void 0===t.maxZoom?this.options.maxZoom:Math.floor(t.maxZoom);this.options=It(It(It({},this.options),t),{},{minZoom:e,maxZoom:n})}},{key:"update",value:function(t,e){var n=this,r=Math.max(0,Math.ceil(t));if(!this.lastViewStates||this.lastViewStates.zoom!==r||!function(t,e){return Ai(Ti(t),Ti(e))}(this.lastViewStates.latLonBoundsBuffer,e)){var i=function(t,e){var n=Ei(Ti(t),e),r=85.0511287798065;return[Math.max(n[0][0],-900),Math.max(n[0][1],-r),Math.min(n[1][0],900),Math.min(n[1][1],r)]}(e,.2);this.lastViewStates={zoom:r,latLonBounds:e,latLonBoundsBuffer:i},this.currentZoom=r;var o=!1,a=this.getTileIndices(r,i).filter((function(t){return n.options.warp||t.x>=0&&t.x<Math.pow(2,r)}));this.emit(to.TilesLoadStart),this.currentTiles=a.map((function(t){var e,r,i=t.x,a=t.y,s=t.z,u=n.getTile(i,a,s);return u?(((null===(e=u)||void 0===e?void 0:e.isFailure)||(null===(r=u)||void 0===r?void 0:r.isCancelled))&&u.loadData({getData:n.options.getTileData,onLoad:n.onTileLoad,onError:n.onTileError}),u):(u=n.createTile(i,a,s),o=!0,u)})),o&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t,e=Qi(this.cacheTiles);try{for(e.s();!(t=e.n()).done;){var n=$r(t.value,2),r=n[0],i=n[1];if(!this.currentTiles.includes(i))return this.cacheTiles.delete(r),void this.onTileUnload(i);this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(t){e.e(t)}finally{e.f()}}},{key:"reloadTileById",value:function(t,e,n){var r=this.cacheTiles.get("".concat(e,",").concat(n,",").concat(t));r&&(this.onTileUnload(r),r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(t,e,n){var r=this.getTileByLngLat(t,e,n);r&&this.reloadTileById(r.z,r.x,r.y)}},{key:"reloadTileByExtent",value:function(t,e){var n=this;this.getTileIndices(e,t).forEach((function(t){n.reloadTileById(t.z,t.x,t.y)}))}},{key:"pruneRequests",value:function(){var t,e=[],n=Qi(this.cacheTiles.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.isLoading&&(r.isCurrent||r.isVisible||e.push(r))}}catch(t){n.e(t)}finally{n.f()}for(;e.length>0;){e.shift().abortLoad()}}},{key:"getTileByLngLat",value:function(t,e,n){var r=this.options.zoomOffset,i=Math.ceil(n)+r,o=Wi(t,e,i);return this.tiles.filter((function(t){return t.key==="".concat(o[0],"_").concat(o[1],"_").concat(i)}))[0]}},{key:"getTileExtent",value:function(t,e){return this.getTileIndices(e,t)}},{key:"getTileByZXY",value:function(t,e,n){return this.tiles.filter((function(r){return r.key==="".concat(e,"_").concat(n,"_").concat(t)}))[0]}},{key:"clear",value:function(){var t,e=Qi(this.cacheTiles.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.isLoading?n.abortLoad():this.onTileUnload(n)}}catch(t){e.e(t)}finally{e.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t,e=this.options.updateStrategy,n=new Map,r=Qi(this.cacheTiles.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(t){r.e(t)}finally{r.f()}var o,a=Qi(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(t){a.e(t)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof e?e(u):Gi[e](u);var l=!1;Array.from(this.cacheTiles.values()).forEach((function(t){t.isVisible!==n.get(t.key)?(t.isVisibleChange=!0,l=!0):t.isVisibleChange=!1})),l&&this.emit(to.TileUpdate)}},{key:"getTileIndices",value:function(t,e){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset,a=function(t){var e=t.zoom,n=t.latLonBounds,r=t.maxZoom,i=void 0===r?1/0:r,o=t.minZoom,a=void 0===o?0:o,s=t.zoomOffset,u=void 0===s?0:s,l=t.extent,c=void 0===l?Vi:l,h=Math.ceil(e)+u;if(Number.isFinite(a)&&h<a)return[];Number.isFinite(i)&&h>i&&(h=i);for(var p=$r(n,4),f=p[0],d=p[1],v=p[2],m=p[3],y=[Math.max(f,c[0]),Math.max(d,c[1]),Math.min(v,c[2]),Math.min(m,c[3])],g=[],_=$r(Wi(y[0],y[1],h),2),x=_[0],b=_[1],w=$r(Wi(y[2],y[3],h),2),S=w[0],E=w[1],A=x;A<=S;A++)for(var T=E;T<=b;T++)g.push({x:A,y:T,z:h});var C=(S+x)/2,k=(b+E)/2,M=function(t,e){return Math.abs(t-C)+Math.abs(e-k)};return g.sort((function(t,e){return M(t.x,t.y)-M(e.x,e.y)})),g}({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:t,latLonBounds:e,extent:i});return a}},{key:"getTileId",value:function(t,e,n){return"".concat(t,",").concat(e,",").concat(n)}},{key:"loadFinished",value:function(){var t=!this.currentTiles.some((function(t){return!t.isDone}));return t&&this.emit(to.TilesLoadFinished),t}},{key:"getTile",value:function(t,e,n){var r=this.getTileId(t,e,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(t,e,n){var r=this.getTileId(t,e,n),i=new Ki({x:t,y:e,z:n,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var t=5*this.currentTiles.length;if(this.cacheTiles.size>t){var e,n=Qi(this.cacheTiles);try{for(n.s();!(e=n.n()).done;){var r=$r(e.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=t)break}}catch(t){n.e(t)}finally{n.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var t,e=Qi(this.cacheTiles.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.parent=null,n.children.length=0}}catch(t){e.e(t)}finally{e.f()}var r,i=Qi(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(t){i.e(t)}finally{i.f()}}},{key:"getNearestAncestor",value:function(t,e,n){for(;n>this.options.minZoom;){t=Math.floor(t/2),e=Math.floor(e/2),n-=1;var r=this.getTile(t,e,n);if(r)return r}return null}}]),n}(Ni);function no(t,e){if(!t||!t.length)throw new Error("url is not allowed to be empty");var n=e.x,r=e.y,i=e.z,o=function(t){var e=[],n=/\{([a-z])-([a-z])\}/.exec(t);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)e.push(t.replace(n[0],String.fromCharCode(r)));return e}if(n=/\{(\d+)-(\d+)\}/.exec(t)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)e.push(t.replace(n[0],s.toString()));return e}return e.push(t),e}(t);return o[Math.abs(n+r)%o.length].replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,qi(n,r,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}function ro(t,e){var n=e.x,r=e.y,i=e.z,o=e.layer,a=e.version,s=void 0===a?"1.0.0":a,u=e.style,l=void 0===u?"default":u,c=e.format,h=e.service,p=void 0===h?"WMTS":h,f=e.tileMatrixset;return"".concat(t,"&SERVICE=").concat(p,"&REQUEST=GetTile&VERSION=").concat(s,"&LAYER=").concat(o,"&STYLE=").concat(l,"&TILEMATRIXSET=").concat(f,"&FORMAT=").concat(c,"&TILECOL=").concat(n,"&TILEROW=").concat(r,"&TILEMATRIX=").concat(i)}function io(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}var oo=new Map;function ao(t){io(t.source&&!t.url||!t.source&&t.url);var e=oo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return so((e=t,"try {\n  importScripts('"+e+"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}"));var e}(t.url),oo.set(t.url,e)),t.source&&(e=so(t.source),oo.set(t.source,e))),io(e),e}function so(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function uo(t,e,n){void 0===e&&(e=!0);var r=n||new Set;if(t){if(lo(t))r.add(t);else if(lo(t.buffer))r.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var i in t)uo(t[i],e,r)}else;return void 0===n?Array.from(r):[]}function lo(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var co=function(){};!function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,n=t.source,r=t.url;io(n||r),this.name=e,this.source=n,this.url=r,this.onMessage=co,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=co,this.onError=co,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||uo(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=ao({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e}}();var ho=new Map,po=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(fo(e)){var n=e.data,r=n.type,i=n.payload;t(r,i)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ho.get(t);e||(e=function(e){if(fo(e)){var n=e.data,r=n.type,i=n.payload;t(r,i)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ho.get(t);ho.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var n={source:"Worker thread",type:t,payload:e},r=uo(e);self.postMessage(n,r)}},t}();function fo(t){var e=t.type,n=t.data;return"message"===e&&n&&"string"==typeof n.source&&"Main thread"===n.source}var vo,mo,yo=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,n){t._settlers.push({resolve:e,reject:n})}))},t}(),go=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},_o=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},xo=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}},bo=0;function wo(t,e){return void 0===e&&(e={}),new Promise((function(n,r){var i=bo++,o=function(t,e){if(e.id===i)switch(t){case"done":po.removeEventListener(o),n(e.result);break;case"error":po.removeEventListener(o),r(e.error)}};po.addEventListener(o);var a={id:i,input:t,options:e};po.postMessage("process",a)}))}function So(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function Eo(t,e,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}function Ao(t){return t.filter?[1]:[0]}function To(t,e){return[e]}var Co={exports:{}};function ko(t,e,n){n=n||2;var r,i,o,a,s,u,l,c=e&&e.length,h=c?e[0]*n:t.length,p=Mo(t,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Mo(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(Uo(a));for(s.sort(No),i=0;i<s.length;i++)n=zo(s[i],n);return n}(t,e,p,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var d=n;d<h;d+=n)(s=t[d])<r&&(r=s),(u=t[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-r,a-i))?32767/l:0}return Po(p,f,n,r,i,l,0),f}function Mo(t,e,n,r,i){var o,a;if(i===$o(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Ko(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Ko(o,t[o],t[o+1],a);return a&&Ho(a,a.next)&&(Qo(a),a=a.next),a}function Io(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Ho(r,r.next)&&0!==Go(r.prev,r,r.next))r=r.next;else{if(Qo(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Po(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{0===i.z&&(i.z=Bo(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,r,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Ro(t,r,i,o):Lo(t))e.push(s.i/n|0),e.push(t.i/n|0),e.push(u.i/n|0),Qo(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?Po(t=Oo(Io(t),e,n),e,n,r,i,o,2):2===a&&Do(t,e,n,r,i,o):Po(Io(t),e,n,r,i,o,1);break}}}function Lo(t){var e=t.prev,n=t,r=t.next;if(Go(e,n,r)>=0)return!1;for(var i=e.x,o=n.x,a=r.x,s=e.y,u=n.y,l=r.y,c=i<o?i<a?i:a:o<a?o:a,h=s<u?s<l?s:l:u<l?u:l,p=i>o?i>a?i:a:o>a?o:a,f=s>u?s>l?s:l:u>l?u:l,d=r.next;d!==e;){if(d.x>=c&&d.x<=p&&d.y>=h&&d.y<=f&&jo(i,s,o,u,a,l,d.x,d.y)&&Go(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function Ro(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Go(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,l=a.x,c=i.y,h=o.y,p=a.y,f=s<u?s<l?s:l:u<l?u:l,d=c<h?c<p?c:p:h<p?h:p,v=s>u?s>l?s:l:u>l?u:l,m=c>h?c>p?c:p:h>p?h:p,y=Bo(f,d,e,n,r),g=Bo(v,m,e,n,r),_=t.prevZ,x=t.nextZ;_&&_.z>=y&&x&&x.z<=g;){if(_.x>=f&&_.x<=v&&_.y>=d&&_.y<=m&&_!==i&&_!==a&&jo(s,c,u,h,l,p,_.x,_.y)&&Go(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,x.x>=f&&x.x<=v&&x.y>=d&&x.y<=m&&x!==i&&x!==a&&jo(s,c,u,h,l,p,x.x,x.y)&&Go(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;_&&_.z>=y;){if(_.x>=f&&_.x<=v&&_.y>=d&&_.y<=m&&_!==i&&_!==a&&jo(s,c,u,h,l,p,_.x,_.y)&&Go(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=g;){if(x.x>=f&&x.x<=v&&x.y>=d&&x.y<=m&&x!==i&&x!==a&&jo(s,c,u,h,l,p,x.x,x.y)&&Go(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Oo(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Ho(i,o)&&Wo(i,r,r.next,o)&&Xo(i,o)&&Xo(o,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(o.i/n|0),Qo(r),Qo(r.next),r=t=o),r=r.next}while(r!==t);return Io(r)}function Do(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Vo(a,s)){var u=Yo(a,s);return a=Io(a,a.next),u=Io(u,u.next),Po(a,e,n,r,i,o,0),void Po(u,e,n,r,i,o,0)}s=s.next}a=a.next}while(a!==t)}function No(t,e){return t.x-e.x}function zo(t,e){var n=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==e);if(!n)return null;var u,l=n,c=n.x,h=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&jo(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),Xo(r,t)&&(u<p||u===p&&(r.x>n.x||r.x===n.x&&Fo(n,r)))&&(n=r,p=u)),r=r.next}while(r!==l);return n}(t,e);if(!n)return e;var r=Yo(n,t);return Io(r,r.next),Io(n,n.next)}function Fo(t,e){return Go(t.prev,t,e.prev)<0&&Go(e.next,t,t.next)<0}function Bo(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Uo(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function jo(t,e,n,r,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(r-s)>=(n-a)*(e-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function Vo(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Wo(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Xo(t,e)&&Xo(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Go(t.prev,t,e.prev)||Go(t,e.prev,e))||Ho(t,e)&&Go(t.prev,t,t.next)>0&&Go(e.prev,e,e.next)>0)}function Go(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ho(t,e){return t.x===e.x&&t.y===e.y}function Wo(t,e,n,r){var i=qo(Go(t,e,n)),o=qo(Go(t,e,r)),a=qo(Go(n,r,t)),s=qo(Go(n,r,e));return i!==o&&a!==s||(!(0!==i||!Zo(t,n,e))||(!(0!==o||!Zo(t,r,e))||(!(0!==a||!Zo(n,t,r))||!(0!==s||!Zo(n,e,r)))))}function Zo(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function qo(t){return t>0?1:t<0?-1:0}function Xo(t,e){return Go(t.prev,t,t.next)<0?Go(t,e,t.next)>=0&&Go(t,t.prev,e)>=0:Go(t,e,t.prev)<0||Go(t,t.next,e)<0}function Yo(t,e){var n=new Jo(t.i,t.x,t.y),r=new Jo(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ko(t,e,n,r){var i=new Jo(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Qo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Jo(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $o(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}Co.exports=ko,Co.exports.default=ko,ko.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs($o(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,c=s<u-1?e[s+1]*n:t.length;a-=Math.abs($o(t,l,c,n))}var h=0;for(s=0;s<r.length;s+=3){var p=r[s]*n,f=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},ko.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var ta=Co.exports,ea=1e-6,na="undefined"!=typeof Float32Array?Float32Array:Array,ra=Math.random;function ia(){var t=new na(16);return na!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function oa(t){var e=new na(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function aa(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v){var m=new na(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=u,m[9]=l,m[10]=c,m[11]=h,m[12]=p,m[13]=f,m[14]=d,m[15]=v,m}function sa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ua(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],v=e[13],m=e[14],y=e[15],g=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,w=r*l-o*s,S=i*l-o*u,E=c*v-h*d,A=c*m-p*d,T=c*y-f*d,C=h*m-p*v,k=h*y-f*v,M=p*y-f*m,I=g*M-_*k+x*C+b*T-w*A+S*E;return I?(I=1/I,t[0]=(s*M-u*k+l*C)*I,t[1]=(i*k-r*M-o*C)*I,t[2]=(v*S-m*w+y*b)*I,t[3]=(p*w-h*S-f*b)*I,t[4]=(u*T-a*M-l*A)*I,t[5]=(n*M-i*T+o*A)*I,t[6]=(m*x-d*S-y*_)*I,t[7]=(c*S-p*x+f*_)*I,t[8]=(a*k-s*T+l*E)*I,t[9]=(r*T-n*k-o*E)*I,t[10]=(d*w-v*x+y*g)*I,t[11]=(h*x-c*w-f*g)*I,t[12]=(s*A-a*C-u*E)*I,t[13]=(n*C-r*A+i*E)*I,t[14]=(v*_-d*b-m*g)*I,t[15]=(c*b-h*_+p*g)*I,t):null}function la(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],v=e[12],m=e[13],y=e[14],g=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*h+w*v,t[1]=_*i+x*u+b*p+w*m,t[2]=_*o+x*l+b*f+w*y,t[3]=_*a+x*c+b*d+w*g,_=n[4],x=n[5],b=n[6],w=n[7],t[4]=_*r+x*s+b*h+w*v,t[5]=_*i+x*u+b*p+w*m,t[6]=_*o+x*l+b*f+w*y,t[7]=_*a+x*c+b*d+w*g,_=n[8],x=n[9],b=n[10],w=n[11],t[8]=_*r+x*s+b*h+w*v,t[9]=_*i+x*u+b*p+w*m,t[10]=_*o+x*l+b*f+w*y,t[11]=_*a+x*c+b*d+w*g,_=n[12],x=n[13],b=n[14],w=n[15],t[12]=_*r+x*s+b*h+w*v,t[13]=_*i+x*u+b*p+w*m,t[14]=_*o+x*l+b*f+w*y,t[15]=_*a+x*c+b*d+w*g,t}function ca(t,e,n){var r,i,o,a,s,u,l,c,h,p,f,d,v=n[0],m=n[1],y=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*y+e[12],t[13]=e[1]*v+e[5]*m+e[9]*y+e[13],t[14]=e[2]*v+e[6]*m+e[10]*y+e[14],t[15]=e[3]*v+e[7]*m+e[11]*y+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=r*v+s*m+h*y+e[12],t[13]=i*v+u*m+p*y+e[13],t[14]=o*v+l*m+f*y+e[14],t[15]=a*v+c*m+d*y+e[15]),t}function ha(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function pa(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=u*i+p*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=p*i-u*r,t}function fa(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*r,t[1]=a*i-c*r,t[2]=s*i-h*r,t[3]=u*i-p*r,t[8]=o*r+l*i,t[9]=a*r+c*i,t[10]=s*r+h*i,t[11]=u*r+p*i,t}function da(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=u*i+p*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=p*i-u*r,t}function va(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function ma(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,l=o+o,c=r*s,h=r*u,p=r*l,f=i*u,d=i*l,v=o*l,m=a*s,y=a*u,g=a*l;return t[0]=1-(f+v),t[1]=h+g,t[2]=p-y,t[3]=0,t[4]=h-g,t[5]=1-(c+v),t[6]=d+m,t[7]=0,t[8]=p+y,t[9]=d-m,t[10]=1-(c+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ya(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],l=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,l,c),t}function ga(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var _a=ga;function xa(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t}var ba=xa;function wa(t,e,n,r){var i,o,a,s,u,l,c,h,p,f,d=e[0],v=e[1],m=e[2],y=r[0],g=r[1],_=r[2],x=n[0],b=n[1],w=n[2];return Math.abs(d-x)<ea&&Math.abs(v-b)<ea&&Math.abs(m-w)<ea?sa(t):(c=d-x,h=v-b,p=m-w,i=g*(p*=f=1/Math.hypot(c,h,p))-_*(h*=f),o=_*(c*=f)-y*p,a=y*h-g*c,(f=Math.hypot(i,o,a))?(i*=f=1/f,o*=f,a*=f):(i=0,o=0,a=0),s=h*a-p*o,u=p*i-c*a,l=c*o-h*i,(f=Math.hypot(s,u,l))?(s*=f=1/f,u*=f,l*=f):(s=0,u=0,l=0),t[0]=i,t[1]=s,t[2]=c,t[3]=0,t[4]=o,t[5]=u,t[6]=h,t[7]=0,t[8]=a,t[9]=l,t[10]=p,t[11]=0,t[12]=-(i*d+o*v+a*m),t[13]=-(s*d+u*v+l*m),t[14]=-(c*d+h*v+p*m),t[15]=1,t)}function Sa(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Ea(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],d=t[12],v=t[13],m=t[14],y=t[15],g=e[0],_=e[1],x=e[2],b=e[3],w=e[4],S=e[5],E=e[6],A=e[7],T=e[8],C=e[9],k=e[10],M=e[11],I=e[12],P=e[13],L=e[14],R=e[15];return Math.abs(n-g)<=ea*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-_)<=ea*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-x)<=ea*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=ea*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-w)<=ea*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-S)<=ea*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(u-E)<=ea*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(l-A)<=ea*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(c-T)<=ea*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-C)<=ea*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-k)<=ea*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(f-M)<=ea*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(d-I)<=ea*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(v-P)<=ea*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(m-L)<=ea*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(y-R)<=ea*Math.max(1,Math.abs(y),Math.abs(R))}var Aa=la,Ta=Sa,Ca=Object.freeze({__proto__:null,create:ia,clone:oa,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:aa,set:function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=c,t[10]=h,t[11]=p,t[12]=f,t[13]=d,t[14]=v,t[15]=m,t},identity:sa,transpose:function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},invert:ua,adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],v=e[13],m=e[14],y=e[15];return t[0]=s*(p*y-f*m)-h*(u*y-l*m)+v*(u*f-l*p),t[1]=-(r*(p*y-f*m)-h*(i*y-o*m)+v*(i*f-o*p)),t[2]=r*(u*y-l*m)-s*(i*y-o*m)+v*(i*l-o*u),t[3]=-(r*(u*f-l*p)-s*(i*f-o*p)+h*(i*l-o*u)),t[4]=-(a*(p*y-f*m)-c*(u*y-l*m)+d*(u*f-l*p)),t[5]=n*(p*y-f*m)-c*(i*y-o*m)+d*(i*f-o*p),t[6]=-(n*(u*y-l*m)-a*(i*y-o*m)+d*(i*l-o*u)),t[7]=n*(u*f-l*p)-a*(i*f-o*p)+c*(i*l-o*u),t[8]=a*(h*y-f*v)-c*(s*y-l*v)+d*(s*f-l*h),t[9]=-(n*(h*y-f*v)-c*(r*y-o*v)+d*(r*f-o*h)),t[10]=n*(s*y-l*v)-a*(r*y-o*v)+d*(r*l-o*s),t[11]=-(n*(s*f-l*h)-a*(r*f-o*h)+c*(r*l-o*s)),t[12]=-(a*(h*m-p*v)-c*(s*m-u*v)+d*(s*p-u*h)),t[13]=n*(h*m-p*v)-c*(r*m-i*v)+d*(r*p-i*h),t[14]=-(n*(s*m-u*v)-a*(r*m-i*v)+d*(r*u-i*s)),t[15]=n*(s*p-u*h)-a*(r*p-i*h)+c*(r*u-i*s),t},determinant:function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],f=t[12],d=t[13],v=t[14],m=t[15];return(e*a-n*o)*(h*m-p*v)-(e*s-r*o)*(c*m-p*d)+(e*u-i*o)*(c*v-h*d)+(n*s-r*a)*(l*m-p*f)-(n*u-i*a)*(l*v-h*f)+(r*u-i*s)*(l*d-c*f)},multiply:la,translate:ca,scale:ha,rotate:function(t,e,n,r){var i,o,a,s,u,l,c,h,p,f,d,v,m,y,g,_,x,b,w,S,E,A,T,C,k=r[0],M=r[1],I=r[2],P=Math.hypot(k,M,I);return P<ea?null:(k*=P=1/P,M*=P,I*=P,i=Math.sin(n),a=1-(o=Math.cos(n)),s=e[0],u=e[1],l=e[2],c=e[3],h=e[4],p=e[5],f=e[6],d=e[7],v=e[8],m=e[9],y=e[10],g=e[11],_=k*k*a+o,x=M*k*a+I*i,b=I*k*a-M*i,w=k*M*a-I*i,S=M*M*a+o,E=I*M*a+k*i,A=k*I*a+M*i,T=M*I*a-k*i,C=I*I*a+o,t[0]=s*_+h*x+v*b,t[1]=u*_+p*x+m*b,t[2]=l*_+f*x+y*b,t[3]=c*_+d*x+g*b,t[4]=s*w+h*S+v*E,t[5]=u*w+p*S+m*E,t[6]=l*w+f*S+y*E,t[7]=c*w+d*S+g*E,t[8]=s*A+h*T+v*C,t[9]=u*A+p*T+m*C,t[10]=l*A+f*T+y*C,t[11]=c*A+d*T+g*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},rotateX:pa,rotateY:fa,rotateZ:da,fromTranslation:va,fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,e,n){var r,i,o,a=n[0],s=n[1],u=n[2],l=Math.hypot(a,s,u);return l<ea?null:(a*=l=1/l,s*=l,u*=l,r=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=a*a*o+i,t[1]=s*a*o+u*r,t[2]=u*a*o-s*r,t[3]=0,t[4]=a*s*o-u*r,t[5]=s*s*o+i,t[6]=u*s*o+a*r,t[7]=0,t[8]=a*u*o+s*r,t[9]=s*u*o-a*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:ma,fromQuat2:function(t,e){var n=new na(3),r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=r*r+i*i+o*o+a*a;return h>0?(n[0]=2*(s*a+c*r+u*o-l*i)/h,n[1]=2*(u*a+c*i+l*r-s*o)/h,n[2]=2*(l*a+c*o+s*i-u*r)/h):(n[0]=2*(s*a+c*r+u*o-l*i),n[1]=2*(u*a+c*i+l*r-s*o),n[2]=2*(l*a+c*o+s*i-u*r)),ma(t,e,n),t},getTranslation:function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},getScaling:ya,getRotation:function(t,e){var n=new na(3);ya(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],a=e[0]*r,s=e[1]*i,u=e[2]*o,l=e[4]*r,c=e[5]*i,h=e[6]*o,p=e[8]*r,f=e[9]*i,d=e[10]*o,v=a+c+d,m=0;return v>0?(m=2*Math.sqrt(v+1),t[3]=.25*m,t[0]=(h-f)/m,t[1]=(p-u)/m,t[2]=(s-l)/m):a>c&&a>d?(m=2*Math.sqrt(1+a-c-d),t[3]=(h-f)/m,t[0]=.25*m,t[1]=(s+l)/m,t[2]=(p+u)/m):c>d?(m=2*Math.sqrt(1+c-a-d),t[3]=(p-u)/m,t[0]=(s+l)/m,t[1]=.25*m,t[2]=(h+f)/m):(m=2*Math.sqrt(1+d-a-c),t[3]=(s-l)/m,t[0]=(p+u)/m,t[1]=(h+f)/m,t[2]=.25*m),t},fromRotationTranslationScale:function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,l=o+o,c=a+a,h=i*u,p=i*l,f=i*c,d=o*l,v=o*c,m=a*c,y=s*u,g=s*l,_=s*c,x=r[0],b=r[1],w=r[2];return t[0]=(1-(d+m))*x,t[1]=(p+_)*x,t[2]=(f-g)*x,t[3]=0,t[4]=(p-_)*b,t[5]=(1-(h+m))*b,t[6]=(v+y)*b,t[7]=0,t[8]=(f+g)*w,t[9]=(v-y)*w,t[10]=(1-(h+d))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},fromRotationTranslationScaleOrigin:function(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,c=a+a,h=s+s,p=o*l,f=o*c,d=o*h,v=a*c,m=a*h,y=s*h,g=u*l,_=u*c,x=u*h,b=r[0],w=r[1],S=r[2],E=i[0],A=i[1],T=i[2],C=(1-(v+y))*b,k=(f+x)*b,M=(d-_)*b,I=(f-x)*w,P=(1-(p+y))*w,L=(m+g)*w,R=(d+_)*S,O=(m-g)*S,D=(1-(p+v))*S;return t[0]=C,t[1]=k,t[2]=M,t[3]=0,t[4]=I,t[5]=P,t[6]=L,t[7]=0,t[8]=R,t[9]=O,t[10]=D,t[11]=0,t[12]=n[0]+E-(C*E+I*A+R*T),t[13]=n[1]+A-(k*E+P*A+O*T),t[14]=n[2]+T-(M*E+L*A+D*T),t[15]=1,t},fromQuat:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,p=i*a,f=i*s,d=i*u,v=o*a,m=o*s,y=o*u;return t[0]=1-h-d,t[1]=c+y,t[2]=p-m,t[3]=0,t[4]=c-y,t[5]=1-l-d,t[6]=f+v,t[7]=0,t[8]=p+m,t[9]=f-v,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t},perspectiveNO:ga,perspective:_a,perspectiveZO:function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t},perspectiveFromFieldOfView:function(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t},orthoNO:xa,ortho:ba,orthoZO:function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*l,t[15]=1,t},lookAt:wa,targetTo:function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=o-n[1],p=a-n[2],f=c*c+h*h+p*p;f>0&&(c*=f=1/Math.sqrt(f),h*=f,p*=f);var d=u*p-l*h,v=l*c-s*p,m=s*h-u*c;return(f=d*d+v*v+m*m)>0&&(d*=f=1/Math.sqrt(f),v*=f,m*=f),t[0]=d,t[1]=v,t[2]=m,t[3]=0,t[4]=h*m-p*v,t[5]=p*d-c*m,t[6]=c*v-h*d,t[7]=0,t[8]=c,t[9]=h,t[10]=p,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},subtract:Sa,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},multiplyScalarAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},equals:Ea,mul:Aa,sub:Ta});function ka(){var t=new na(3);return na!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ma(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Ia(t,e,n){var r=new na(3);return r[0]=t,r[1]=e,r[2]=n,r}function Pa(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function La(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Ra(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Oa(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function Da(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function Na(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function za(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Fa(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function Ba(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ua(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function ja(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function Va(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),l=u&&Ba(t,e)/u;return Math.acos(Math.min(Math.max(l,-1),1))}var Ga,Ha=Pa,Wa=La,Za=Ra,qa=Oa,Xa=Da,Ya=Ma,Ka=Na,Qa=(Ga=ka(),function(t,e,n,r,i,o){var a,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)Ga[0]=t[a],Ga[1]=t[a+1],Ga[2]=t[a+2],i(Ga,Ga,o),t[a]=Ga[0],t[a+1]=Ga[1],t[a+2]=Ga[2];return t}),Ja=Object.freeze({__proto__:null,create:ka,clone:function(t){var e=new na(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},length:Ma,fromValues:Ia,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},subtract:Pa,multiply:La,divide:Ra,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},scaleAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},distance:Oa,squaredDistance:Da,squaredLength:Na,negate:za,inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},normalize:Fa,dot:Ba,cross:Ua,lerp:function(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t},hermite:function(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*l+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*l+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*l+i[2]*c,t},bezier:function(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,p=u*o;return t[0]=e[0]*l+n[0]*c+r[0]*h+i[0]*p,t[1]=e[1]*l+n[1]*c+r[1]*h+i[1]*p,t[2]=e[2]*l+n[2]*c+r[2]*h+i[2]*p,t},random:function(t,e){e=e||1;var n=2*ra()*Math.PI,r=2*ra()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t},transformMat4:ja,transformMat3:function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},transformQuat:function(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],l=e[2],c=i*l-o*u,h=o*s-r*l,p=r*u-i*s,f=i*p-o*h,d=o*c-r*p,v=r*h-i*c,m=2*a;return c*=m,h*=m,p*=m,f*=2,d*=2,v*=2,t[0]=s+c+f,t[1]=u+h+d,t[2]=l+p+v,t},rotateX:function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},rotateY:function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},rotateZ:function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},angle:Va,zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},equals:function(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(n-o)<=ea*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=ea*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=ea*Math.max(1,Math.abs(i),Math.abs(s))},sub:Ha,mul:Wa,div:Za,dist:qa,sqrDist:Xa,len:Ya,sqrLen:Ka,forEach:Qa});function $a(){var t=new na(4);return na!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ts(t,e,n,r){var i=new na(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function es(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function ns(){var t=new na(2);return na!=Float32Array&&(t[0]=0,t[1]=0),t}function rs(t,e){var n=new na(2);return n[0]=t,n[1]=e,n}function is(t,e){return t[0]=e[0],t[1]=e[1],t}function os(t,e,n){return t[0]=e,t[1]=n,t}function as(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function ss(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function us(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function ls(t,e){return t[0]*e[0]+t[1]*e[1]}!function(){var t=$a()}();var cs=ss;!function(){var t=ns()}();var hs=ns();ns();var ps=ns(),fs=ns(),ds=ns();function vs(t,e,n,r,i){return as(t,n,r),us(t,t),[i/ls(e=rs(-t[1],t[0]),rs(-n[1],n[0])),e]}function ms(t,e){return os(t,-e[1],e[0])}function ys(t,e,n){return cs(t,e,n),us(t,t),t}function gs(t,e){return t[0]===e[0]&&t[1]===e[1]}var _s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ee(this,t),kt(this,"lastFlip",-1),kt(this,"miter",rs(0,0)),kt(this,"started",!1),kt(this,"dash",!1),kt(this,"totalDistance",0),kt(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Te(t,[{key:"extrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=t[o-1];l.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var c=e[o-1],h=t[o];h.push(null!==(s=e[o][2])&&void 0!==s?s:0);var p=e[o],f=o<t.length-1?[].concat(At(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null;i+=this.segment_gaode2(n,i,l,h,f,c,p,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=t[o-1];l.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var c=e[o-1],h=t[o];h.push(null!==(s=e[o][2])&&void 0!==s?s:0);var p=e[o],f=o<t.length-1?[].concat(At(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null;i+=this.simpleSegment(n,i,l,h,f,c,p,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.segment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.simpleSegment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,n,r,i,o,a,s){var u=0,l=t.indices,c=t.positions,h=t.normals,p="square"===this.cap,f="bevel"===this.join,d=bi([a[0],a[1]]),v=bi([o[0],o[1]]);ys(ps,r,n);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,v),this.totalDistance+=m),this.normal||(this.normal=ns(),ms(this.normal,ps)),!this.started)if(this.started=!0,p){var y=ns(),g=ns();as(y,this.normal,ps),as(g,this.normal,ps),h.push(g[0],g[1],0),h.push(y[0],y[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-m);if(l.push(e+0,e+1,e+2),i){gs(r,i)&&as(i,r,us(i,ss(i,r,n))),ys(fs,i,r);var _=$r(vs(ds,ns(),ps,fs,this.thickness),2),x=_[0],b=_[1],w=ls(ds,this.normal)<0?-1:1,S=f;if(!S&&"miter"===this.join)x>this.miterLimit&&(S=!0);S?(h.push(this.normal[0],this.normal[1],0),h.push(b[0],b[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,At(this.lastFlip!==-w?[e,e+2,e+3]:[e+2,e+1,e+3])),l.push(e+2,e+3,e+4),ms(hs,fs),is(this.normal,hs),h.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,h,r,b,x,this.totalDistance),l.push.apply(l,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),w=-1,is(this.normal,b),u+=2),this.lastFlip=w}else{if(ms(this.normal,ps),p){var E=ns(),A=ns();cs(A,ps,this.normal),as(E,ps,this.normal),h.push(A[0],A[1],0),h.push(E[0],E[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),u+=2}return u}},{key:"simpleSegment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,l=bi([r[0],r[1]]),c=bi([n[0],n[1]]);ys(ps,l,c);var h=0;if(this.dash&&(h=this.lineSegmentDistance(l,c),this.totalDistance+=h),this.normal||(this.normal=ns(),ms(this.normal,ps)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(e+0,e+1,e+2),i){var p=bi([i[0],i[1]]);gs(l,p)&&as(p,l,us(p,ss(p,l,c))),ys(fs,p,l);var f=$r(vs(ds,ns(),ps,fs,this.thickness),2),d=f[0],v=f[1];ls(ds,this.normal);this.extrusions(s,u,r,v,d,this.totalDistance),a.push.apply(a,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,is(this.normal,v),o+=2,this.lastFlip=-1}else ms(this.normal,ps),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2;return o}},{key:"segment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,l="square"===this.cap,c="bevel"===this.join,h=bi([r[0],r[1]]),p=bi([n[0],n[1]]);ys(ps,h,p);var f=0;if(this.dash&&(f=this.lineSegmentDistance(h,p),this.totalDistance+=f),this.normal||(this.normal=ns(),ms(this.normal,ps)),!this.started)if(this.started=!0,l){var d=ns(),v=ns();as(d,this.normal,ps),as(v,this.normal,ps),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-f,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-f,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-f);if(a.push(e+0,e+1,e+2),i){var m=bi([i[0],i[1]]);gs(h,m)&&as(m,h,us(m,ss(m,h,p))),ys(fs,m,h);var y=$r(vs(ds,ns(),ps,fs,this.thickness),2),g=y[0],_=y[1],x=ls(ds,this.normal)<0?-1:1,b=c;if(!b&&"miter"===this.join)g>this.miterLimit&&(b=!0);b?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,At(this.lastFlip!==-x?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),ms(hs,fs),is(this.normal,hs),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,_,g,this.totalDistance),a.push.apply(a,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),x=-1,is(this.normal,_),o+=2),this.lastFlip=x}else{if(ms(this.normal,ps),l){var w=ns(),S=ns();cs(S,ps,this.normal),as(w,ps,this.normal),u.push(S[0],S[1],0),u.push(w[0],w[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2}return o}},{key:"extrusions",value:function(t,e,n,r,i,o){e.push(r[0],r[1],0),e.push(r[0],r[1],0),t.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}}]),t}();function xs(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new _s({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=e;c[0]&&!Array.isArray(c[0][0])&&(c=[e]),c.forEach((function(t){i.extrude(t)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function bs(t){var e=ki(t.coordinates);return{vertices:[].concat(At(e),At(e),At(e),At(e)),indices:[0,1,2,2,3,0],size:e.length}}function ws(t){var e=t.coordinates,n=ta.flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:ta(r,o,i),vertices:r,size:i}}var Ss=function(){var t=Zt(Kt.mark((function t(e){var n,r,i,o,a,s,u,l,c;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o=e.iconMap,a={a_Color:So,a_Position:Eo,filter:Ao,a_vertexId:To,a_PickingColor:function(t){var e=t.id;return i?Zr(e):[0,0,0]},a_DistanceAndIndex:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]},a_Total_Distance:function(t,e,n){return[n[5]]},a_Size:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]},a_Normal:function(t,e,n,r,i){return i},a_Miter:function(t,e,n){return[n[4]]},a_iconMapUV:function(t){var e=t.texture,n=o[e]||{x:0,y:0};return[n.x,n.y]}},s={sizePerElement:0,elements:[]},u=0,l=[],c=3,r.forEach((function(t,e){var r=xs(t),i=r.indices,o=r.vertices,h=r.normals,p=r.size,f=r.indexes;i.forEach((function(t){l.push(t+u)})),c=p;var d=o.length/p;s.sizePerElement=c,s.elements.push({featureIdx:e,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*p,r*p+p),u=0;f&&void 0!==f[r]&&(u=f[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,At(a[n.name](t,e,s,r,i,u)))}))},m=0;m<d;m++)v(m)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:l});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Es=function(){var t=Zt(Kt.mark((function t(e){var n,r,i,o,a,s,u,l,c;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o=e.shape2d,a={a_Color:So,a_Position:Eo,filter:Ao,a_vertexId:To,a_PickingColor:function(t){var e=t.id;return i?Zr(e):[0,0,0]},a_Shape:function(t){var e=t.shape,n=void 0===e?2:e;return[o.indexOf(n)]},a_Extrude:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]},a_Size:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}},s={sizePerElement:0,elements:[]},u=0,l=[],c=3,r.forEach((function(t,e){var r=bs(t),i=r.indices,o=r.vertices,h=r.normals,p=r.size,f=r.indexes;i.forEach((function(t){l.push(t+u)})),c=p;var d=o.length/p;s.sizePerElement=c,s.elements.push({featureIdx:e,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*p,r*p+p),u=0;f&&void 0!==f[r]&&(u=f[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,At(a[n.name](t,e,s,r,i,u)))}))},m=0;m<d;m++)v(m)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:l});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),As=function(){var t=Zt(Kt.mark((function t(e){var n,r,i,o,a,s,u,l;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o={a_Color:So,a_Position:Eo,filter:Ao,a_vertexId:To,a_PickingColor:function(t){var e=t.id;return i?Zr(e):[0,0,0]}},a={sizePerElement:0,elements:[]},s=0,u=[],l=3,r.forEach((function(t,e){var r=ws(t),i=r.indices,c=r.vertices,h=r.normals,p=r.size,f=r.indexes;i.forEach((function(t){u.push(t+s)})),l=p;var d=c.length/p;a.sizePerElement=l,a.elements.push({featureIdx:e,vertices:c,normals:h,offset:s}),s+=d;for(var v=function(r){var i=(null==h?void 0:h.slice(3*r,3*r+3))||[],a=c.slice(r*p,r*p+p),s=0;f&&void 0!==f[r]&&(s=f[r]),n.forEach((function(n){var u;n&&o[n.name]&&(u=n.buffer.data).push.apply(u,At(o[n.name](t,e,a,r,i,s)))}))},m=0;m<d;m++)v(m)})),t.abrupt("return",{descriptors:n,featureLayout:a,indices:u});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ts=It({},{pointFill:Es,line:Ss,polygonFill:As});function Cs(){return Cs=Zt(Kt.mark((function t(e){var n,r;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,r=e.data,!Ts[n]){t.next=3;break}return t.abrupt("return",Ts[n](r));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)}))),Cs.apply(this,arguments)}!function(t,e){var n=this;if("undefined"!=typeof self){var r={process:wo};po.onmessage=function(i,o){return go(n,void 0,void 0,(function(){var n,a,s,u,l,c,h,p,f,d;return _o(this,(function(v){switch(v.label){case 0:switch(v.trys.push([0,19,,20]),i){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(o.input,o.options||{},r)];case 2:return n=v.sent(),po.postMessage("done",{result:n}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");vo=new yo,mo=o.options||{},a=e(vo,mo,r),v.label=4;case 4:v.trys.push([4,9,10,15]),s=xo(a),v.label=5;case 5:return[4,s.next()];case 6:if((u=v.sent()).done)return[3,8];l=u.value,po.postMessage("output-batch",{result:l}),v.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return c=v.sent(),f={error:c},[3,15];case 10:return v.trys.push([10,,13,14]),u&&!u.done&&(d=s.return)?[4,d.call(s)]:[3,12];case 11:v.sent(),v.label=12;case 12:return[3,14];case 13:if(f)throw f.error;return[7];case 14:return[7];case 15:return po.postMessage("done",{}),[3,18];case 16:return vo.push(o.input),[3,18];case 17:return vo.close(),[3,18];case 18:return[3,20];case 19:return h=v.sent(),p=h instanceof Error?h.message:"",po.postMessage("error",{error:p}),[3,20];case 20:return[2]}}))}))}}}((function(t){return Cs.apply(this,arguments)}));var ks=new Map;function Ms(t,e){var n=e.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(e){t instanceof HTMLImageElement||function(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}(t)?e([t]):function(t,e){var n=t,r=[];if("string"==typeof n)hr({url:n},(function(t,n){n&&(r.push(n),e(r))}));else{var i=n.length,o=0;n.forEach((function(t){hr({url:t},(function(t,n){o++,n&&r.push(n),o===i&&e(r)}))}))}}(t,(function(t){e(t)}))}));return{originData:t,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]}}(function(t,e){ks.set(t,e)})("l7-worker",'var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),u=new T(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var h={};function p(){}function v(){}function d(){}var y={};c(y,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(k([])));m&&m!==e&&n.call(m,a)&&(y=m);var b=d.prototype=p.prototype=Object.create(y);function x(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var r;o(this,"_invoke",{value:function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=l(t[o],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=A(a,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function A(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a \'"+r+"\' method")),h;var o=l(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,h;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=d,o(b,"constructor",{value:d,configurable:!0}),o(d,"constructor",{value:v,configurable:!0}),v.displayName=c(d,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},x(w.prototype),c(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(b),c(b,s,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return(e=b(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],s=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);s=!0);}catch(t){c=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function b(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function w(t,e){return t(e={exports:{}},e.exports),e.exports}var E,A,O=function(t){return t&&t.Math==Math&&t},S=O("object"==typeof globalThis&&globalThis)||O("object"==typeof window&&window)||O("object"==typeof self&&self)||O("object"==typeof x&&x)||function(){return this}()||x||Function("return this")(),T=Object.defineProperty,k=function(t,e){try{T(S,t,{value:e,configurable:!0,writable:!0})}catch(r){S[t]=e}return e},I=S["__core-js_shared__"]||k("__core-js_shared__",{}),j=w((function(t){(t.exports=function(t,e){return I[t]||(I[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"})})),P=function(t){try{return!!t()}catch(t){return!0}},_=!P((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),M=Function.prototype,L=M.call,R=_&&M.bind.bind(L,L),N=_?R:function(t){return function(){return L.apply(t,arguments)}},C=function(t){return null==t},D=TypeError,F=function(t){if(C(t))throw D("Can\'t call method on "+t);return t},W=Object,z=function(t){return W(F(t))},B=N({}.hasOwnProperty),U=Object.hasOwn||function(t,e){return B(z(t),e)},G=0,V=Math.random(),H=N(1..toString),q=function(t){return"Symbol("+(void 0===t?"":t)+")_"+H(++G+V,36)},Z="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Y=S.process,$=S.Deno,K=Y&&Y.versions||$&&$.version,Q=K&&K.v8;Q&&(A=(E=Q.split("."))[0]>0&&E[0]<4?1:+(E[0]+E[1])),!A&&Z&&(!(E=Z.match(/Edge\\/(\\d+)/))||E[1]>=74)&&(E=Z.match(/Chrome\\/(\\d+)/))&&(A=+E[1]);var X=A,J=S.String,tt=!!Object.getOwnPropertySymbols&&!P((function(){var t=Symbol();return!J(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&X&&X<41})),et=tt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,rt=S.Symbol,nt=j("wks"),ot=et?rt.for||rt:rt&&rt.withoutSetter||q,it=function(t){return U(nt,t)||(nt[t]=tt&&U(rt,t)?rt[t]:ot("Symbol."+t)),nt[t]},at={};at[it("toStringTag")]="z";var ut="[object z]"===String(at),st="object"==typeof document&&document.all,ct={all:st,IS_HTMLDDA:void 0===st&&void 0!==st},ft=ct.all,lt=ct.IS_HTMLDDA?function(t){return"function"==typeof t||t===ft}:function(t){return"function"==typeof t},ht=!P((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),pt=ct.all,vt=ct.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:lt(t)||t===pt}:function(t){return"object"==typeof t?null!==t:lt(t)},dt=S.document,yt=vt(dt)&&vt(dt.createElement),gt=function(t){return yt?dt.createElement(t):{}},mt=!ht&&!P((function(){return 7!=Object.defineProperty(gt("div"),"a",{get:function(){return 7}}).a})),bt=ht&&P((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),xt=String,wt=TypeError,Et=function(t){if(vt(t))return t;throw wt(xt(t)+" is not an object")},At=Function.prototype.call,Ot=_?At.bind(At):function(){return At.apply(At,arguments)},St=function(t){return lt(t)?t:void 0},Tt=function(t,e){return arguments.length<2?St(S[t]):S[t]&&S[t][e]},kt=N({}.isPrototypeOf),It=Object,jt=et?function(t){return"symbol"==typeof t}:function(t){var e=Tt("Symbol");return lt(e)&&kt(e.prototype,It(t))},Pt=String,_t=function(t){try{return Pt(t)}catch(t){return"Object"}},Mt=TypeError,Lt=function(t){if(lt(t))return t;throw Mt(_t(t)+" is not a function")},Rt=function(t,e){var r=t[e];return C(r)?void 0:Lt(r)},Nt=TypeError,Ct=TypeError,Dt=it("toPrimitive"),Ft=function(t,e){if(!vt(t)||jt(t))return t;var r,n=Rt(t,Dt);if(n){if(void 0===e&&(e="default"),r=Ot(n,t,e),!vt(r)||jt(r))return r;throw Ct("Can\'t convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&lt(r=t.toString)&&!vt(n=Ot(r,t)))return n;if(lt(r=t.valueOf)&&!vt(n=Ot(r,t)))return n;if("string"!==e&&lt(r=t.toString)&&!vt(n=Ot(r,t)))return n;throw Nt("Can\'t convert object to primitive value")}(t,e)},Wt=function(t){var e=Ft(t,"string");return jt(e)?e:e+""},zt=TypeError,Bt=Object.defineProperty,Ut=Object.getOwnPropertyDescriptor,Gt={f:ht?bt?function(t,e,r){if(Et(t),e=Wt(e),Et(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Ut(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Bt(t,e,r)}:Bt:function(t,e,r){if(Et(t),e=Wt(e),Et(r),mt)try{return Bt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw zt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Vt=Function.prototype,Ht=ht&&Object.getOwnPropertyDescriptor,qt=U(Vt,"name"),Zt={EXISTS:qt,PROPER:qt&&"something"===function(){}.name,CONFIGURABLE:qt&&(!ht||ht&&Ht(Vt,"name").configurable)},Yt=N(Function.toString);lt(I.inspectSource)||(I.inspectSource=function(t){return Yt(t)});var $t,Kt,Qt,Xt=I.inspectSource,Jt=S.WeakMap,te=lt(Jt)&&/native code/.test(String(Jt)),ee=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},re=ht?function(t,e,r){return Gt.f(t,e,ee(1,r))}:function(t,e,r){return t[e]=r,t},ne=j("keys"),oe=function(t){return ne[t]||(ne[t]=q(t))},ie={},ae=S.TypeError,ue=S.WeakMap;if(te||I.state){var se=I.state||(I.state=new ue);se.get=se.get,se.has=se.has,se.set=se.set,$t=function(t,e){if(se.has(t))throw ae("Object already initialized");return e.facade=t,se.set(t,e),e},Kt=function(t){return se.get(t)||{}},Qt=function(t){return se.has(t)}}else{var ce=oe("state");ie[ce]=!0,$t=function(t,e){if(U(t,ce))throw ae("Object already initialized");return e.facade=t,re(t,ce,e),e},Kt=function(t){return U(t,ce)?t[ce]:{}},Qt=function(t){return U(t,ce)}}var fe={set:$t,get:Kt,has:Qt,enforce:function(t){return Qt(t)?Kt(t):$t(t,{})},getterFor:function(t){return function(e){var r;if(!vt(e)||(r=Kt(e)).type!==t)throw ae("Incompatible receiver, "+t+" required");return r}}},le=w((function(t){var e=Zt.CONFIGURABLE,r=fe.enforce,n=fe.get,o=String,i=Object.defineProperty,a=N("".slice),u=N("".replace),s=N([].join),c=ht&&!P((function(){return 8!==i((function(){}),"length",{value:8}).length})),f=String(String).split("String"),l=t.exports=function(t,n,l){"Symbol("===a(o(n),0,7)&&(n="["+u(o(n),/^Symbol\\(([^)]*)\\)/,"$1")+"]"),l&&l.getter&&(n="get "+n),l&&l.setter&&(n="set "+n),(!U(t,"name")||e&&t.name!==n)&&(ht?i(t,"name",{value:n,configurable:!0}):t.name=n),c&&l&&U(l,"arity")&&t.length!==l.arity&&i(t,"length",{value:l.arity});try{l&&U(l,"constructor")&&l.constructor?ht&&i(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var h=r(t);return U(h,"source")||(h.source=s(f,"string"==typeof n?n:"")),t};Function.prototype.toString=l((function(){return lt(this)&&n(this).source||Xt(this)}),"toString")})),he=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(lt(r)&&le(r,i,n),n.global)o?t[e]=r:k(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Gt.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},pe=N({}.toString),ve=N("".slice),de=function(t){return ve(pe(t),8,-1)},ye=it("toStringTag"),ge=Object,me="Arguments"==de(function(){return arguments}()),be=ut?de:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ge(t),ye))?r:me?de(e):"Object"==(n=de(e))&&lt(e.callee)?"Arguments":n},xe=ut?{}.toString:function(){return"[object "+be(this)+"]"};ut||he(Object.prototype,"toString",xe,{unsafe:!0});var we={}.propertyIsEnumerable,Ee=Object.getOwnPropertyDescriptor,Ae={f:Ee&&!we.call({1:2},1)?function(t){var e=Ee(this,t);return!!e&&e.enumerable}:we},Oe=Object,Se=N("".split),Te=P((function(){return!Oe("z").propertyIsEnumerable(0)}))?function(t){return"String"==de(t)?Se(t,""):Oe(t)}:Oe,ke=function(t){return Te(F(t))},Ie=Object.getOwnPropertyDescriptor,je={f:ht?Ie:function(t,e){if(t=ke(t),e=Wt(e),mt)try{return Ie(t,e)}catch(t){}if(U(t,e))return ee(!Ot(Ae.f,t,e),t[e])}},Pe=Math.ceil,_e=Math.floor,Me=Math.trunc||function(t){var e=+t;return(e>0?_e:Pe)(e)},Le=function(t){var e=+t;return e!=e||0===e?0:Me(e)},Re=Math.max,Ne=Math.min,Ce=function(t,e){var r=Le(t);return r<0?Re(r+e,0):Ne(r,e)},De=Math.min,Fe=function(t){return t>0?De(Le(t),9007199254740991):0},We=function(t){return Fe(t.length)},ze=function(t){return function(e,r,n){var o,i=ke(e),a=We(i),u=Ce(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},Be={includes:ze(!0),indexOf:ze(!1)},Ue=Be.indexOf,Ge=N([].push),Ve=function(t,e){var r,n=ke(t),o=0,i=[];for(r in n)!U(ie,r)&&U(n,r)&&Ge(i,r);for(;e.length>o;)U(n,r=e[o++])&&(~Ue(i,r)||Ge(i,r));return i},He=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qe=He.concat("length","prototype"),Ze={f:Object.getOwnPropertyNames||function(t){return Ve(t,qe)}},Ye={f:Object.getOwnPropertySymbols},$e=N([].concat),Ke=Tt("Reflect","ownKeys")||function(t){var e=Ze.f(Et(t)),r=Ye.f;return r?$e(e,r(t)):e},Qe=function(t,e,r){for(var n=Ke(e),o=Gt.f,i=je.f,a=0;a<n.length;a++){var u=n[a];U(t,u)||r&&U(r,u)||o(t,u,i(e,u))}},Xe=/#|\\.prototype\\./,Je=function(t,e){var r=er[tr(t)];return r==nr||r!=rr&&(lt(e)?P(e):!!e)},tr=Je.normalize=function(t){return String(t).replace(Xe,".").toLowerCase()},er=Je.data={},rr=Je.NATIVE="N",nr=Je.POLYFILL="P",or=Je,ir=je.f,ar=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?S:c?S[u]||k(u,{}):(S[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=ir(r,n))&&a.value:r[n],!or(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qe(i,o)}(t.sham||o&&o.sham)&&re(i,"sham",!0),he(r,n,i,t)}},ur="undefined"!=typeof process&&"process"==de(process),sr=String,cr=TypeError,fr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=function(t,e,r){try{return N(Lt(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(t){}}(Object.prototype,"__proto__","set"))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return Et(r),function(t){if("object"==typeof t||lt(t))return t;throw cr("Can\'t set "+sr(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),lr=Gt.f,hr=it("toStringTag"),pr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!U(t,hr)&&lr(t,hr,{configurable:!0,value:e})},vr=function(t,e,r){return r.get&&le(r.get,e,{getter:!0}),r.set&&le(r.set,e,{setter:!0}),Gt.f(t,e,r)},dr=it("species"),yr=function(t){var e=Tt(t);ht&&e&&!e[dr]&&vr(e,dr,{configurable:!0,get:function(){return this}})},gr=TypeError,mr=function(t,e){if(kt(e,t))return t;throw gr("Incorrect invocation")},br=function(){},xr=[],wr=Tt("Reflect","construct"),Er=/^\\s*(?:class|function)\\b/,Ar=N(Er.exec),Or=!Er.exec(br),Sr=function(t){if(!lt(t))return!1;try{return wr(br,xr,t),!0}catch(t){return!1}},Tr=function(t){if(!lt(t))return!1;switch(be(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Or||!!Ar(Er,Xt(t))}catch(t){return!0}};Tr.sham=!0;var kr,Ir,jr,Pr,_r=!wr||P((function(){var t;return Sr(Sr.call)||!Sr(Object)||!Sr((function(){t=!0}))||t}))?Tr:Sr,Mr=TypeError,Lr=function(t){if(_r(t))return t;throw Mr(_t(t)+" is not a constructor")},Rr=it("species"),Nr=function(t,e){var r,n=Et(t).constructor;return void 0===n||C(r=Et(n)[Rr])?e:Lr(r)},Cr=Function.prototype,Dr=Cr.apply,Fr=Cr.call,Wr="object"==typeof Reflect&&Reflect.apply||(_?Fr.bind(Dr):function(){return Fr.apply(Dr,arguments)}),zr=function(t){if("Function"===de(t))return N(t)},Br=zr(zr.bind),Ur=function(t,e){return Lt(t),void 0===e?t:_?Br(t,e):function(){return t.apply(e,arguments)}},Gr=Tt("document","documentElement"),Vr=N([].slice),Hr=TypeError,qr=function(t,e){if(t<e)throw Hr("Not enough arguments");return t},Zr=/(?:ipad|iphone|ipod).*applewebkit/i.test(Z),Yr=S.setImmediate,$r=S.clearImmediate,Kr=S.process,Qr=S.Dispatch,Xr=S.Function,Jr=S.MessageChannel,tn=S.String,en=0,rn={};P((function(){kr=S.location}));var nn=function(t){if(U(rn,t)){var e=rn[t];delete rn[t],e()}},on=function(t){return function(){nn(t)}},an=function(t){nn(t.data)},un=function(t){S.postMessage(tn(t),kr.protocol+"//"+kr.host)};Yr&&$r||(Yr=function(t){qr(arguments.length,1);var e=lt(t)?t:Xr(t),r=Vr(arguments,1);return rn[++en]=function(){Wr(e,void 0,r)},Ir(en),en},$r=function(t){delete rn[t]},ur?Ir=function(t){Kr.nextTick(on(t))}:Qr&&Qr.now?Ir=function(t){Qr.now(on(t))}:Jr&&!Zr?(Pr=(jr=new Jr).port2,jr.port1.onmessage=an,Ir=Ur(Pr.postMessage,Pr)):S.addEventListener&&lt(S.postMessage)&&!S.importScripts&&kr&&"file:"!==kr.protocol&&!P(un)?(Ir=un,S.addEventListener("message",an,!1)):Ir="onreadystatechange"in gt("script")?function(t){Gr.appendChild(gt("script")).onreadystatechange=function(){Gr.removeChild(this),nn(t)}}:function(t){setTimeout(on(t),0)});var sn={set:Yr,clear:$r},cn=function(){this.head=null,this.tail=null};cn.prototype={add:function(t){var e={item:t,next:null},r=this.tail;r?r.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var fn,ln,hn,pn,vn,dn=cn,yn=/ipad|iphone|ipod/i.test(Z)&&"undefined"!=typeof Pebble,gn=/web0s(?!.*chrome)/i.test(Z),mn=je.f,bn=sn.set,xn=S.MutationObserver||S.WebKitMutationObserver,wn=S.document,En=S.process,An=S.Promise,On=mn(S,"queueMicrotask"),Sn=On&&On.value;if(!Sn){var Tn=new dn,kn=function(){var t,e;for(ur&&(t=En.domain)&&t.exit();e=Tn.get();)try{e()}catch(t){throw Tn.head&&fn(),t}t&&t.enter()};Zr||ur||gn||!xn||!wn?!yn&&An&&An.resolve?((pn=An.resolve(void 0)).constructor=An,vn=Ur(pn.then,pn),fn=function(){vn(kn)}):ur?fn=function(){En.nextTick(kn)}:(bn=Ur(bn,S),fn=function(){bn(kn)}):(ln=!0,hn=wn.createTextNode(""),new xn(kn).observe(hn,{characterData:!0}),fn=function(){hn.data=ln=!ln}),Sn=function(t){Tn.head||fn(),Tn.add(t)}}var In,jn,Pn,_n=Sn,Mn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Ln=S.Promise,Rn="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Nn=!Rn&&!ur&&"object"==typeof window&&"object"==typeof document,Cn=(Ln&&Ln.prototype,it("species")),Dn=!1,Fn=lt(S.PromiseRejectionEvent),Wn={CONSTRUCTOR:or("Promise",(function(){var t=Xt(Ln),e=t!==String(Ln);if(!e&&66===X)return!0;if(!X||X<51||!/native code/.test(t)){var r=new Ln((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Dn=r.then((function(){}))instanceof n))return!0}return!e&&(Nn||Rn)&&!Fn})),REJECTION_EVENT:Fn,SUBCLASSING:Dn},zn=TypeError,Bn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw zn("Bad Promise constructor");e=t,r=n})),this.resolve=Lt(e),this.reject=Lt(r)},Un={f:function(t){return new Bn(t)}},Gn=sn.set,Vn=Wn.CONSTRUCTOR,Hn=Wn.REJECTION_EVENT,qn=Wn.SUBCLASSING,Zn=fe.getterFor("Promise"),Yn=fe.set,$n=Ln&&Ln.prototype,Kn=Ln,Qn=$n,Xn=S.TypeError,Jn=S.document,to=S.process,eo=Un.f,ro=eo,no=!!(Jn&&Jn.createEvent&&S.dispatchEvent),oo=function(t){var e;return!(!vt(t)||!lt(e=t.then))&&e},io=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&fo(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Xn("Promise-chain cycle")):(n=oo(r))?Ot(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},ao=function(t,e){t.notified||(t.notified=!0,_n((function(){for(var r,n=t.reactions;r=n.get();)io(r,t);t.notified=!1,e&&!t.rejection&&so(t)})))},uo=function(t,e,r){var n,o;no?((n=Jn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),S.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=S["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){try{1==arguments.length?console.error(t):console.error(t,e)}catch(t){}}("Unhandled promise rejection",r)},so=function(t){Ot(Gn,S,(function(){var e,r=t.facade,n=t.value;if(co(t)&&(e=Mn((function(){ur?to.emit("unhandledRejection",n,r):uo("unhandledrejection",r,n)})),t.rejection=ur||co(t)?2:1,e.error))throw e.value}))},co=function(t){return 1!==t.rejection&&!t.parent},fo=function(t){Ot(Gn,S,(function(){var e=t.facade;ur?to.emit("rejectionHandled",e):uo("rejectionhandled",e,t.value)}))},lo=function(t,e,r){return function(n){t(e,n,r)}},ho=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,ao(t,!0))},po=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Xn("Promise can\'t be resolved itself");var n=oo(e);n?_n((function(){var r={done:!1};try{Ot(n,e,lo(po,r,t),lo(ho,r,t))}catch(e){ho(r,e,t)}})):(t.value=e,t.state=1,ao(t,!1))}catch(e){ho({done:!1},e,t)}}};if(Vn&&(Qn=(Kn=function(t){mr(this,Qn),Lt(t),Ot(In,this);var e=Zn(this);try{t(lo(po,e),lo(ho,e))}catch(t){ho(e,t)}}).prototype,(In=function(t){Yn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new dn,rejection:!1,state:0,value:void 0})}).prototype=he(Qn,"then",(function(t,e){var r=Zn(this),n=eo(Nr(this,Kn));return r.parent=!0,n.ok=!lt(t)||t,n.fail=lt(e)&&e,n.domain=ur?to.domain:void 0,0==r.state?r.reactions.add(n):_n((function(){io(n,r)})),n.promise})),jn=function(){var t=new In,e=Zn(t);this.promise=t,this.resolve=lo(po,e),this.reject=lo(ho,e)},Un.f=eo=function(t){return t===Kn||void 0===t?new jn(t):ro(t)},lt(Ln)&&$n!==Object.prototype)){Pn=$n.then,qn||he($n,"then",(function(t,e){var r=this;return new Kn((function(t,e){Ot(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete $n.constructor}catch(t){}fr&&fr($n,Qn)}ar({global:!0,constructor:!0,wrap:!0,forced:Vn},{Promise:Kn}),pr(Kn,"Promise",!1),yr("Promise");var vo={},yo=it("iterator"),go=Array.prototype,mo=function(t){return void 0!==t&&(vo.Array===t||go[yo]===t)},bo=it("iterator"),xo=function(t){if(!C(t))return Rt(t,bo)||Rt(t,"@@iterator")||vo[be(t)]},wo=TypeError,Eo=function(t,e){var r=arguments.length<2?xo(t):e;if(Lt(r))return Et(Ot(r,t));throw wo(_t(t)+" is not iterable")},Ao=function(t,e,r){var n,o;Et(t);try{if(!(n=Rt(t,"return"))){if("throw"===e)throw r;return r}n=Ot(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return Et(n),r},Oo=TypeError,So=function(t,e){this.stopped=t,this.result=e},To=So.prototype,ko=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=Ur(e,f),y=function(t){return n&&Ao(n,"normal",t),new So(!0,t)},g=function(t){return l?(Et(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Oo(_t(t)+" is not iterable");if(mo(o)){for(i=0,a=We(t);a>i;i++)if((u=g(t[i]))&&kt(To,u))return u;return new So(!1)}n=Eo(t,o)}for(s=h?t.next:n.next;!(c=Ot(s,n)).done;){try{u=g(c.value)}catch(t){Ao(n,"throw",t)}if("object"==typeof u&&u&&kt(To,u))return u}return new So(!1)},Io=it("iterator"),jo=!1;try{var Po=0,_o={next:function(){return{done:!!Po++}},return:function(){jo=!0}};_o[Io]=function(){return this},Array.from(_o,(function(){throw 2}))}catch(t){}var Mo=function(t,e){if(!e&&!jo)return!1;var r=!1;try{var n={};n[Io]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Lo=Wn.CONSTRUCTOR||!Mo((function(t){Ln.all(t).then(void 0,(function(){}))}));ar({target:"Promise",stat:!0,forced:Lo},{all:function(t){var e=this,r=Un.f(e),n=r.resolve,o=r.reject,i=Mn((function(){var r=Lt(e.resolve),i=[],a=0,u=1;ko(t,(function(t){var s=a++,c=!1;u++,Ot(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Ro=Wn.CONSTRUCTOR,No=Ln&&Ln.prototype;if(ar({target:"Promise",proto:!0,forced:Ro,real:!0},{catch:function(t){return this.then(void 0,t)}}),lt(Ln)){var Co=Tt("Promise").prototype.catch;No.catch!==Co&&he(No,"catch",Co,{unsafe:!0})}ar({target:"Promise",stat:!0,forced:Lo},{race:function(t){var e=this,r=Un.f(e),n=r.reject,o=Mn((function(){var o=Lt(e.resolve);ko(t,(function(t){Ot(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ar({target:"Promise",stat:!0,forced:Wn.CONSTRUCTOR},{reject:function(t){var e=Un.f(this);return Ot(e.reject,void 0,t),e.promise}});var Do=Wn.CONSTRUCTOR;Tt("Promise");function Fo(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ar({target:"Promise",stat:!0,forced:Do},{resolve:function(t){return function(t,e){if(Et(t),vt(e)&&e.constructor===t)return e;var r=Un.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Wo="undefined"!=typeof window&&void 0!==window.orientation,zo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Fo(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Fo(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),Bo=new Map;function Uo(t){Fo(t.source&&!t.url||!t.source&&t.url);var e=Bo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Go((e=t,"try {\\n  importScripts(\'"+e+"\');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),Bo.set(t.url,e)),t.source&&(e=Go(t.source),Bo.set(t.source,e))),Fo(e),e}function Go(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Vo(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Vo(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var qo=function(){},Zo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Fo(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=qo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=qo,this.onError=qo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Vo(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Uo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Yo=self&&self.__assign||function(){return(Yo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},$o=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},Ko=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Qo=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Yo(Yo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),$o(this,void 0,void 0,(function(){var n,o=this;return Ko(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return $o(this,void 0,void 0,(function(){var t,e,r;return Ko(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new zo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Zo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Wo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Xo=self&&self.__assign||function(){return(Xo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Jo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ti={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ei=(function(){function t(t){this.workerPools=new Map,this.props=Xo({},ti),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return Zo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Jo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Xo(Xo({},this.props),t);try{for(var n=Jo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Qo({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ri=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ni(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ei.get(t);e||(e=function(e){if(ni(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ei.get(t);ei.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Vo(e);self.postMessage(r,n)}},t}();function ni(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var oi,ii,ai=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ui=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},si=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ci=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},fi=0;function li(t,e){var r=this;if("undefined"!=typeof self){var n={process:hi};ri.onmessage=function(o,i){return ui(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return si(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ri.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");oi=new ai,ii=i.options||{},a=e(oi,ii,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=ci(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ri.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ri.postMessage("done",{}),[3,18];case 16:return oi.push(i.input),[3,18];case 17:return oi.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ri.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function hi(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=fi++,i=function(t,e){if(e.id===o)switch(t){case"done":ri.removeEventListener(i),r(e.result);break;case"error":ri.removeEventListener(i),n(e.error)}};ri.addEventListener(i);var a={id:o,input:t,options:e};ri.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var pi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},vi=gt("span").classList,di=vi&&vi.constructor&&vi.constructor.prototype,yi=di===Object.prototype?void 0:di,gi=Array.isArray||function(t){return"Array"==de(t)},mi=it("species"),bi=Array,xi=function(t,e){return new(function(t){var e;return gi(t)&&(e=t.constructor,(_r(e)&&(e===bi||gi(e.prototype))||vt(e)&&null===(e=e[mi]))&&(e=void 0)),void 0===e?bi:e}(t))(0===e?0:e)},wi=N([].push),Ei=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=z(s),d=Te(v),y=Ur(c,f),g=We(d),m=0,b=l||xi,x=e?b(s,g):r||a?b(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)x[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:wi(x,h)}else switch(t){case 4:return!1;case 7:wi(x,h)}return i?-1:n||o?o:x}},Ai={forEach:Ei(0),map:Ei(1),filter:Ei(2),some:Ei(3),every:Ei(4),find:Ei(5),findIndex:Ei(6),filterReject:Ei(7)},Oi=function(t,e){var r=[][t];return!!r&&P((function(){r.call(null,e||function(){return 1},1)}))},Si=Ai.forEach,Ti=Oi("forEach")?[].forEach:function(t){return Si(this,t,arguments.length>1?arguments[1]:void 0)},ki=function(t){if(t&&t.forEach!==Ti)try{re(t,"forEach",Ti)}catch(e){t.forEach=Ti}};for(var Ii in pi)pi[Ii]&&ki(S[Ii]&&S[Ii].prototype);ki(yi);var ji=function(t,e,r){var n=Wt(e);n in t?Gt.f(t,n,ee(0,r)):t[n]=r},Pi=it("species"),_i=function(t){return X>=51||!P((function(){var e=[];return(e.constructor={})[Pi]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Mi=_i("slice"),Li=it("species"),Ri=Array,Ni=Math.max;ar({target:"Array",proto:!0,forced:!Mi},{slice:function(t,e){var r,n,o,i=ke(this),a=We(i),u=Ce(t,a),s=Ce(void 0===e?a:e,a);if(gi(i)&&(r=i.constructor,(_r(r)&&(r===Ri||gi(r.prototype))||vt(r)&&null===(r=r[Li]))&&(r=void 0),r===Ri||void 0===r))return Vr(i,u,s);for(n=new(void 0===r?Ri:r)(Ni(s-u,0)),o=0;u<s;u++,o++)u in i&&ji(n,o,i[u]);return n.length=o,n}});var Ci=Zt.EXISTS,Di=Function.prototype,Fi=N(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=N(Wi.exec);ht&&!Ci&&vr(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi,Ui=Object.keys||function(t){return Ve(t,He)},Gi={f:ht&&!bt?Object.defineProperties:function(t,e){Et(t);for(var r,n=ke(e),o=Ui(e),i=o.length,a=0;i>a;)Gt.f(t,r=o[a++],n[r]);return t}},Vi=oe("IE_PROTO"),Hi=function(){},qi=function(t){return"<script>"+t+"<\\/script>"},Zi=function(t){t.write(qi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Yi=function(){try{Bi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Yi="undefined"!=typeof document?document.domain&&Bi?Zi(Bi):((e=gt("iframe")).style.display="none",Gr.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(qi("document.F=Object")),t.close(),t.F):Zi(Bi);for(var r=He.length;r--;)delete Yi.prototype[He[r]];return Yi()};ie[Vi]=!0;var $i=Object.create||function(t,e){var r;return null!==t?(Hi.prototype=Et(t),r=new Hi,Hi.prototype=null,r[Vi]=t):r=Yi(),void 0===e?r:Gi.f(r,e)},Ki=Gt.f,Qi=it("unscopables"),Xi=Array.prototype;null==Xi[Qi]&&Ki(Xi,Qi,{configurable:!0,value:$i(null)});var Ji,ta,ea,ra=function(t){Xi[Qi][t]=!0},na=!P((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),oa=oe("IE_PROTO"),ia=Object,aa=ia.prototype,ua=na?ia.getPrototypeOf:function(t){var e=z(t);if(U(e,oa))return e[oa];var r=e.constructor;return lt(r)&&e instanceof r?r.prototype:e instanceof ia?aa:null},sa=it("iterator"),ca=!1;[].keys&&("next"in(ea=[].keys())?(ta=ua(ua(ea)))!==Object.prototype&&(Ji=ta):ca=!0),(!vt(Ji)||P((function(){var t={};return Ji[sa].call(t)!==t})))&&(Ji={}),lt(Ji[sa])||he(Ji,sa,(function(){return this}));var fa={IteratorPrototype:Ji,BUGGY_SAFARI_ITERATORS:ca},la=fa.IteratorPrototype,ha=function(){return this},pa=Zt.PROPER,va=Zt.CONFIGURABLE,da=fa.IteratorPrototype,ya=fa.BUGGY_SAFARI_ITERATORS,ga=it("iterator"),ma=function(){return this},ba=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=$i(la,{next:ee(+!n,r)}),pr(t,o,!1),vo[o]=ha}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ya&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[ga]||p["@@iterator"]||o&&p[o],d=!ya&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ua(y.call(new t)))!==Object.prototype&&u.next&&(ua(u)!==da&&(fr?fr(u,da):lt(u[ga])||he(u,ga,ma)),pr(u,l,!0)),pa&&"values"==o&&v&&"values"!==v.name&&(va?re(p,"name","values"):(h=!0,d=function(){return Ot(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ya||h||!(c in p))&&he(p,c,s[c]);else ar({target:e,proto:!0,forced:ya||h},s);return p[ga]!==d&&he(p,ga,d,{name:o}),vo[e]=d,s},xa=function(t,e){return{value:t,done:e}},wa=Gt.f,Ea=fe.set,Aa=fe.getterFor("Array Iterator"),Oa=ba(Array,"Array",(function(t,e){Ea(this,{type:"Array Iterator",target:ke(t),index:0,kind:e})}),(function(){var t=Aa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,xa(void 0,!0)):xa("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),Sa=vo.Arguments=vo.Array;if(ra("keys"),ra("values"),ra("entries"),ht&&"values"!==Sa.name)try{wa(Sa,"name",{value:"values"})}catch(t){}var Ta,ka,Ia,ja="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Pa=fe.enforce,_a=fe.get,Ma=S.Int8Array,La=Ma&&Ma.prototype,Ra=S.Uint8ClampedArray,Na=Ra&&Ra.prototype,Ca=Ma&&ua(Ma),Da=La&&ua(La),Fa=Object.prototype,Wa=S.TypeError,za=it("toStringTag"),Ba=q("TYPED_ARRAY_TAG"),Ua=ja&&!!fr&&"Opera"!==be(S.opera),Ga=!1,Va={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ha={BigInt64Array:8,BigUint64Array:8},qa=function(t){var e=ua(t);if(vt(e)){var r=_a(e);return r&&U(r,"TypedArrayConstructor")?r.TypedArrayConstructor:qa(e)}},Za=function(t){if(!vt(t))return!1;var e=be(t);return U(Va,e)||U(Ha,e)};for(Ta in Va)(Ia=(ka=S[Ta])&&ka.prototype)?Pa(Ia).TypedArrayConstructor=ka:Ua=!1;for(Ta in Ha)(Ia=(ka=S[Ta])&&ka.prototype)&&(Pa(Ia).TypedArrayConstructor=ka);if((!Ua||!lt(Ca)||Ca===Function.prototype)&&(Ca=function(){throw Wa("Incorrect invocation")},Ua))for(Ta in Va)S[Ta]&&fr(S[Ta],Ca);if((!Ua||!Da||Da===Fa)&&(Da=Ca.prototype,Ua))for(Ta in Va)S[Ta]&&fr(S[Ta].prototype,Da);if(Ua&&ua(Na)!==Da&&fr(Na,Da),ht&&!U(Da,za))for(Ta in Ga=!0,vr(Da,za,{configurable:!0,get:function(){return vt(this)?this[Ba]:void 0}}),Va)S[Ta]&&re(S[Ta],Ba,Ta);var Ya={NATIVE_ARRAY_BUFFER_VIEWS:Ua,TYPED_ARRAY_TAG:Ga&&Ba,aTypedArray:function(t){if(Za(t))return t;throw Wa("Target is not a typed array")},aTypedArrayConstructor:function(t){if(lt(t)&&(!fr||kt(Ca,t)))return t;throw Wa(_t(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(ht){if(r)for(var o in Va){var i=S[o];if(i&&U(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}Da[t]&&!r||he(Da,t,r?e:Ua&&La[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(ht){if(fr){if(r)for(n in Va)if((o=S[n])&&U(o,t))try{delete o[t]}catch(t){}if(Ca[t]&&!r)return;try{return he(Ca,t,r?e:Ua&&Ca[t]||e)}catch(t){}}for(n in Va)!(o=S[n])||o[t]&&!r||he(o,t,e)}},getTypedArrayConstructor:qa,isView:function(t){if(!vt(t))return!1;var e=be(t);return"DataView"===e||U(Va,e)||U(Ha,e)},isTypedArray:Za,TypedArray:Ca,TypedArrayPrototype:Da},$a=Ya.NATIVE_ARRAY_BUFFER_VIEWS,Ka=S.ArrayBuffer,Qa=S.Int8Array,Xa=!$a||!P((function(){Qa(1)}))||!P((function(){new Qa(-1)}))||!Mo((function(t){new Qa,new Qa(null),new Qa(1.5),new Qa(t)}),!0)||P((function(){return 1!==new Qa(new Ka(2),1,void 0).length})),Ja=function(t,e,r){for(var n in e)he(t,n,e[n],r);return t},tu=RangeError,eu=function(t){if(void 0===t)return 0;var e=Le(t),r=Fe(e);if(e!==r)throw tu("Wrong length or index");return r},ru=Array,nu=Math.abs,ou=Math.pow,iu=Math.floor,au=Math.log,uu=Math.LN2,su=function(t,e,r){var n,o,i,a=ru(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?ou(2,-24)-ou(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=nu(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=iu(au(t)/uu),t*(i=ou(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*ou(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*ou(2,e),n+=c):(o=t*ou(2,c-1)*ou(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},cu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=ou(2,e),f-=a}return(c?-1:1)*r*ou(2,f-e)},fu=function(t){for(var e=z(this),r=We(e),n=arguments.length,o=Ce(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ce(i,r);a>o;)e[o++]=t;return e},lu=Array,hu=Math.max,pu=function(t,e,r){for(var n=We(t),o=Ce(e,n),i=Ce(void 0===r?n:r,n),a=lu(hu(i-o,0)),u=0;o<i;o++,u++)ji(a,u,t[o]);return a.length=u,a},vu=Ze.f,du=Zt.PROPER,yu=Zt.CONFIGURABLE,gu=fe.getterFor("ArrayBuffer"),mu=fe.getterFor("DataView"),bu=fe.set,xu=S.ArrayBuffer,wu=xu,Eu=wu&&wu.prototype,Au=S.DataView,Ou=Au&&Au.prototype,Su=Object.prototype,Tu=S.Array,ku=S.RangeError,Iu=N(fu),ju=N([].reverse),Pu=su,_u=cu,Mu=function(t){return[255&t]},Lu=function(t){return[255&t,t>>8&255]},Ru=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Nu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Cu=function(t){return Pu(t,23,4)},Du=function(t){return Pu(t,52,8)},Fu=function(t,e,r){vr(t.prototype,e,{configurable:!0,get:function(){return r(this)[e]}})},Wu=function(t,e,r,n){var o=eu(r),i=mu(t);if(o+e>i.byteLength)throw ku("Wrong index");var a=i.bytes,u=o+i.byteOffset,s=pu(a,u,u+e);return n?s:ju(s)},zu=function(t,e,r,n,o,i){var a=eu(r),u=mu(t);if(a+e>u.byteLength)throw ku("Wrong index");for(var s=u.bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(ja){var Bu=du&&"ArrayBuffer"!==xu.name;if(P((function(){xu(1)}))&&P((function(){new xu(-1)}))&&!P((function(){return new xu,new xu(1.5),new xu(NaN),1!=xu.length||Bu&&!yu})))Bu&&yu&&re(xu,"name","ArrayBuffer");else{(wu=function(t){return mr(this,Eu),new xu(eu(t))}).prototype=Eu;for(var Uu,Gu=vu(xu),Vu=0;Gu.length>Vu;)(Uu=Gu[Vu++])in wu||re(wu,Uu,xu[Uu]);Eu.constructor=wu}fr&&ua(Ou)!==Su&&fr(Ou,Su);var Hu=new Au(new wu(2)),qu=N(Ou.setInt8);Hu.setInt8(0,2147483648),Hu.setInt8(1,2147483649),!Hu.getInt8(0)&&Hu.getInt8(1)||Ja(Ou,{setInt8:function(t,e){qu(this,t,e<<24>>24)},setUint8:function(t,e){qu(this,t,e<<24>>24)}},{unsafe:!0})}else Eu=(wu=function(t){mr(this,Eu);var e=eu(t);bu(this,{type:"ArrayBuffer",bytes:Iu(Tu(e),0),byteLength:e}),ht||(this.byteLength=e,this.detached=!1)}).prototype,Ou=(Au=function(t,e,r){mr(this,Ou),mr(t,Eu);var n=gu(t),o=n.byteLength,i=Le(e);if(i<0||i>o)throw ku("Wrong offset");if(i+(r=void 0===r?o-i:Fe(r))>o)throw ku("Wrong length");bu(this,{type:"DataView",buffer:t,byteLength:r,byteOffset:i,bytes:n.bytes}),ht||(this.buffer=t,this.byteLength=r,this.byteOffset=i)}).prototype,ht&&(Fu(wu,"byteLength",gu),Fu(Au,"buffer",mu),Fu(Au,"byteLength",mu),Fu(Au,"byteOffset",mu)),Ja(Ou,{getInt8:function(t){return Wu(this,1,t)[0]<<24>>24},getUint8:function(t){return Wu(this,1,t)[0]},getInt16:function(t){var e=Wu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Wu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Nu(Wu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Nu(Wu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return _u(Wu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return _u(Wu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){zu(this,1,t,Mu,e)},setUint8:function(t,e){zu(this,1,t,Mu,e)},setInt16:function(t,e){zu(this,2,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){zu(this,2,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){zu(this,4,t,Ru,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){zu(this,4,t,Ru,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){zu(this,4,t,Cu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){zu(this,8,t,Du,e,arguments.length>2?arguments[2]:void 0)}});pr(wu,"ArrayBuffer"),pr(Au,"DataView");var Zu={ArrayBuffer:wu,DataView:Au},Yu=Math.floor,$u=Number.isInteger||function(t){return!vt(t)&&isFinite(t)&&Yu(t)===t},Ku=RangeError,Qu=RangeError,Xu=function(t,e){var r=function(t){var e=Le(t);if(e<0)throw Ku("The argument can\'t be less than 0");return e}(t);if(r%e)throw Qu("Wrong offset");return r},Ju=function(t){var e=be(t);return"BigInt64Array"==e||"BigUint64Array"==e},ts=TypeError,es=function(t){var e=Ft(t,"number");if("number"==typeof e)throw ts("Can\'t convert number to bigint");return BigInt(e)},rs=Ya.aTypedArrayConstructor,ns=function(t){var e,r,n,o,i,a,u,s,c=Lr(this),f=z(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!mo(v))for(s=(u=Eo(f,v)).next,f=[];!(a=Ot(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=Ur(h,arguments[2])),r=We(f),n=new(rs(c))(r),o=Ju(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?es(i):+i;return n},os=function(t,e,r){var n,o;return fr&&lt(n=e.constructor)&&n!==r&&vt(o=n.prototype)&&o!==r.prototype&&fr(t,o),t},is=w((function(t){var e=Ze.f,r=Ai.forEach,n=fe.get,o=fe.set,i=fe.enforce,a=Gt.f,u=je.f,s=Math.round,c=S.RangeError,f=Zu.ArrayBuffer,l=f.prototype,h=Zu.DataView,p=Ya.NATIVE_ARRAY_BUFFER_VIEWS,v=Ya.TYPED_ARRAY_TAG,d=Ya.TypedArray,y=Ya.TypedArrayPrototype,g=Ya.aTypedArrayConstructor,m=Ya.isTypedArray,b=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},x=function(t,e){vr(t,e,{configurable:!0,get:function(){return n(this)[e]}})},w=function(t){var e;return kt(l,t)||"ArrayBuffer"==(e=be(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!jt(e)&&e in t&&$u(+e)&&e>=0},A=function(t,e){return e=Wt(e),E(t,e)?ee(2,t[e]):u(t,e)},O=function(t,e,r){return e=Wt(e),!(E(t,e)&&vt(r)&&U(r,"value"))||U(r,"get")||U(r,"set")||r.configurable||U(r,"writable")&&!r.writable||U(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};ht?(p||(je.f=A,Gt.f=O,x(y,"buffer"),x(y,"byteOffset"),x(y,"byteLength"),x(y,"length")),ar({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:O}),t.exports=function(t,u,l){var g=t.match(/\\d+/)[0]/8,x=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,O=S[x],T=O,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?Xa&&(T=u((function(t,e,r,n){return mr(t,k),os(vt(e)?w(e)?void 0!==n?new O(e,Xu(r,g),n):void 0!==r?new O(e,Xu(r,g)):new O(e):m(e)?b(T,e):Ot(ns,T,e):new O(eu(e)),t,T)})),fr&&fr(T,d),r(e(O),(function(t){t in T||re(T,t,O[t])})),T.prototype=k):(T=u((function(t,e,r,n){mr(t,k);var i,a,u,s=0,l=0;if(vt(e)){if(!w(e))return m(e)?b(T,e):Ot(ns,T,e);i=e,l=Xu(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Fe(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=eu(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),fr&&fr(T,d),k=T.prototype=$i(y)),k.constructor!==T&&re(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&re(k,v,x);var P=T!=O;I[x]=T,ar({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||re(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||re(k,"BYTES_PER_ELEMENT",g),yr(x)}):t.exports=function(){}}));is("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var as=TypeError,us=function(t,e){if(!delete t[e])throw as("Cannot delete property "+_t(e)+" of "+_t(t))},ss=Math.min,cs=N([].copyWithin||function(t,e){var r=z(this),n=We(r),o=Ce(t,n),i=Ce(e,n),a=arguments.length>2?arguments[2]:void 0,u=ss((void 0===a?n:Ce(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:us(r,o),o+=s,i+=s;return r}),fs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("copyWithin",(function(t,e){return cs(fs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ls=Ai.every,hs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("every",(function(t){return ls(hs(this),t,arguments.length>1?arguments[1]:void 0)}));var ps=Ya.aTypedArray,vs=Ya.exportTypedArrayMethod,ds=N("".slice);vs("fill",(function(t){var e=arguments.length;ps(this);var r="Big"===ds(be(this),0,3)?es(t):+t;return Ot(fu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),P((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var ys=Ya.aTypedArrayConstructor,gs=Ya.getTypedArrayConstructor,ms=function(t){return ys(Nr(t,gs(t)))},bs=function(t,e){return function(t,e){for(var r=0,n=We(e),o=new t(n);n>r;)o[r]=e[r++];return o}(ms(t),e)},xs=Ai.filter,ws=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("filter",(function(t){var e=xs(ws(this),t,arguments.length>1?arguments[1]:void 0);return bs(this,e)}));var Es=Ai.find,As=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("find",(function(t){return Es(As(this),t,arguments.length>1?arguments[1]:void 0)}));var Os=Ai.findIndex,Ss=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("findIndex",(function(t){return Os(Ss(this),t,arguments.length>1?arguments[1]:void 0)}));var Ts=Ai.forEach,ks=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("forEach",(function(t){Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Be.includes,js=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("includes",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Be.indexOf,_s=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("indexOf",(function(t){return Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=it("iterator"),Ls=S.Uint8Array,Rs=N(Oa.values),Ns=N(Oa.keys),Cs=N(Oa.entries),Ds=Ya.aTypedArray,Fs=Ya.exportTypedArrayMethod,Ws=Ls&&Ls.prototype,zs=!P((function(){Ws[Ms].call([1])})),Bs=!!Ws&&Ws.values&&Ws[Ms]===Ws.values&&"values"===Ws.values.name,Us=function(){return Rs(Ds(this))};Fs("entries",(function(){return Cs(Ds(this))}),zs),Fs("keys",(function(){return Ns(Ds(this))}),zs),Fs("values",Us,zs||!Bs,{name:"values"}),Fs(Ms,Us,zs||!Bs,{name:"values"});var Gs=Ya.aTypedArray,Vs=Ya.exportTypedArrayMethod,Hs=N([].join);Vs("join",(function(t){return Hs(Gs(this),t)}));var qs=Math.min,Zs=[].lastIndexOf,Ys=!!Zs&&1/[1].lastIndexOf(1,-0)<0,$s=Oi("lastIndexOf"),Ks=Ys||!$s?function(t){if(Ys)return Wr(Zs,this,arguments)||0;var e=ke(this),r=We(e),n=r-1;for(arguments.length>1&&(n=qs(n,Le(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Zs,Qs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Wr(Ks,Qs(this),e>1?[t,arguments[1]]:[t])}));var Xs=Ai.map,Js=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("map",(function(t){return Xs(Js(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(ms(t))(e)}))}));var tc=TypeError,ec=function(t){return function(e,r,n,o){Lt(r);var i=z(e),a=Te(i),u=We(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw tc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},rc={left:ec(!1),right:ec(!0)},nc=rc.left,oc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return nc(oc(this),t,e,e>1?arguments[1]:void 0)}));var ic=rc.right,ac=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return ic(ac(this),t,e,e>1?arguments[1]:void 0)}));var uc=Ya.aTypedArray,sc=Ya.exportTypedArrayMethod,cc=Math.floor;sc("reverse",(function(){for(var t,e=uc(this).length,r=cc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var fc=S.RangeError,lc=S.Int8Array,hc=lc&&lc.prototype,pc=hc&&hc.set,vc=Ya.aTypedArray,dc=Ya.exportTypedArrayMethod,yc=!P((function(){var t=new Uint8ClampedArray(2);return Ot(pc,t,{length:1,0:3},1),3!==t[1]})),gc=yc&&Ya.NATIVE_ARRAY_BUFFER_VIEWS&&P((function(){var t=new lc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));dc("set",(function(t){vc(this);var e=Xu(arguments.length>1?arguments[1]:void 0,1),r=z(t);if(yc)return Ot(pc,this,r,e);var n=this.length,o=We(r),i=0;if(o+e>n)throw fc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!yc||gc);var mc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Vr(mc(this),t,e),n=ms(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),P((function(){new Int8Array(1).slice()})));var bc=Ai.some,xc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("some",(function(t){return bc(xc(this),t,arguments.length>1?arguments[1]:void 0)}));var wc=Math.floor,Ec=function(t,e){var r=t.length,n=wc(r/2);return r<8?Ac(t,e):Oc(t,Ec(pu(t,0,n),e),Ec(pu(t,n),e),e)},Ac=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Oc=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},Sc=Ec,Tc=Z.match(/firefox\\/(\\d+)/i),kc=!!Tc&&+Tc[1],Ic=/MSIE|Trident/.test(Z),jc=Z.match(/AppleWebKit\\/(\\d+)\\./),Pc=!!jc&&+jc[1],_c=Ya.aTypedArray,Mc=Ya.exportTypedArrayMethod,Lc=S.Uint16Array,Rc=Lc&&zr(Lc.prototype.sort),Nc=!(!Rc||P((function(){Rc(new Lc(2),null)}))&&P((function(){Rc(new Lc(2),{})}))),Cc=!!Rc&&!P((function(){if(X)return X<74;if(kc)return kc<67;if(Ic)return!0;if(Pc)return Pc<602;var t,e,r=new Lc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Rc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Mc("sort",(function(t){return void 0!==t&&Lt(t),Cc?Rc(this,t):Sc(_c(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!Cc||Nc);var Dc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("subarray",(function(t,e){var r=Dc(this),n=r.length,o=Ce(t,n);return new(ms(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Fe((void 0===e?n:Ce(e,n))-o))}));var Fc=S.Int8Array,Wc=Ya.aTypedArray,zc=Ya.exportTypedArrayMethod,Bc=[].toLocaleString,Uc=!!Fc&&P((function(){Bc.call(new Fc(1))}));zc("toLocaleString",(function(){return Wr(Bc,Uc?Vr(Wc(this)):Wc(this),Vr(arguments))}),P((function(){return[1,2].toLocaleString()!=new Fc([1,2]).toLocaleString()}))||!P((function(){Fc.prototype.toLocaleString.call([1,2])})));var Gc=Ya.exportTypedArrayMethod,Vc=S.Uint8Array,Hc=Vc&&Vc.prototype||{},qc=[].toString,Zc=N([].join);P((function(){qc.call({})}))&&(qc=function(){return Zc(this)});var Yc=Hc.toString!=qc;Gc("toString",qc,Yc),ar({target:"Array",proto:!0},{fill:fu}),ra("fill");var $c,Kc,Qc=String,Xc=function(t){if("Symbol"===be(t))throw TypeError("Cannot convert a Symbol value to a string");return Qc(t)},Jc=function(){var t=Et(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},tf=S.RegExp,ef=P((function(){var t=tf("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),rf=ef||P((function(){return!tf("a","y").sticky})),nf={BROKEN_CARET:ef||P((function(){var t=tf("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:rf,UNSUPPORTED_Y:ef},of=S.RegExp,af=P((function(){var t=of(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),uf=S.RegExp,sf=P((function(){var t=uf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),cf=fe.get,ff=j("native-string-replace",String.prototype.replace),lf=RegExp.prototype.exec,hf=lf,pf=N("".charAt),vf=N("".indexOf),df=N("".replace),yf=N("".slice),gf=(Kc=/b*/g,Ot(lf,$c=/a/,"a"),Ot(lf,Kc,"a"),0!==$c.lastIndex||0!==Kc.lastIndex),mf=nf.BROKEN_CARET,bf=void 0!==/()??/.exec("")[1];(gf||bf||mf||af||sf)&&(hf=function(t){var e,r,n,o,i,a,u,s=this,c=cf(s),f=Xc(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=Ot(hf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=mf&&s.sticky,v=Ot(Jc,s),d=s.source,y=0,g=f;if(p&&(v=df(v,"y",""),-1===vf(v,"g")&&(v+="g"),g=yf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==pf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),bf&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),gf&&(n=s.lastIndex),o=Ot(lf,p?r:s,g),p?o?(o.input=yf(o.input,y),o[0]=yf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:gf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),bf&&o&&o.length>1&&Ot(ff,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=$i(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var xf=hf;ar({target:"RegExp",proto:!0,forced:/./.exec!==xf},{exec:xf});var wf,Ef=it("species"),Af=RegExp.prototype,Of=function(t,e,r,n){var o=it(t),i=!P((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!P((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Ef]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=zr(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=zr(t),s=e.exec;return s===xf||s===Af.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));he(String.prototype,t,s[0]),he(Af,o,s[1])}n&&re(Af[o],"sham",!0)},Sf=N("".charAt),Tf=N("".charCodeAt),kf=N("".slice),If=function(t){return function(e,r){var n,o,i=Xc(F(e)),a=Le(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Tf(i,a))<55296||n>56319||a+1===u||(o=Tf(i,a+1))<56320||o>57343?t?Sf(i,a):n:t?kf(i,a,a+2):o-56320+(n-55296<<10)+65536}},jf={codeAt:If(!1),charAt:If(!0)},Pf=jf.charAt,_f=function(t,e,r){return e+(r?Pf(t,e).length:1)},Mf=Math.floor,Lf=N("".charAt),Rf=N("".replace),Nf=N("".slice),Cf=/\\$([$&\'`]|\\d{1,2}|<[^>]*>)/g,Df=/\\$([$&\'`]|\\d{1,2})/g,Ff=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Df;return void 0!==o&&(o=z(o),s=Cf),Rf(i,s,(function(i,s){var c;switch(Lf(s,0)){case"$":return"$";case"&":return t;case"`":return Nf(e,0,r);case"\'":return Nf(e,a);case"<":c=o[Nf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Mf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Lf(s,1):n[l-1]+Lf(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Wf=TypeError,zf=function(t,e){var r=t.exec;if(lt(r)){var n=Ot(r,t,e);return null!==n&&Et(n),n}if("RegExp"===de(t))return Ot(xf,t,e);throw Wf("RegExp#exec called on incompatible receiver")},Bf=it("replace"),Uf=Math.max,Gf=Math.min,Vf=N([].concat),Hf=N([].push),qf=N("".indexOf),Zf=N("".slice),Yf="$0"==="a".replace(/./,"$0"),$f=!!/./[Bf]&&""===/./[Bf]("a","$0");function Kf(t){this.message=t}Of("replace",(function(t,e,r){var n=$f?"$":"$0";return[function(t,r){var n=F(this),o=C(t)?void 0:Rt(t,Bf);return o?Ot(o,t,n,r):Ot(e,Xc(n),t,r)},function(t,o){var i=Et(this),a=Xc(t);if("string"==typeof o&&-1===qf(o,n)&&-1===qf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=lt(o);s||(o=Xc(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=zf(i,a);if(null===h)break;if(Hf(l,h),!c)break;""===Xc(h[0])&&(i.lastIndex=_f(a,Fe(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=Xc((h=l[y])[0]),m=Uf(Gf(Le(h.index),a.length),0),b=[],x=1;x<h.length;x++)Hf(b,void 0===(p=h[x])?p:String(p));var w=h.groups;if(s){var E=Vf([g],b,m,a);void 0!==w&&Hf(E,w);var A=Xc(Wr(o,void 0,E))}else A=Ff(g,a,m,b,w,o);m>=d&&(v+=Zf(a,d,m)+A,d=m+g.length)}return v+Zf(a,d)}]}),!!P((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Yf||$f),Kf.prototype=new Error,Kf.prototype.name="InvalidCharacterError",ar({global:!0,forced:S.globalThis!==S},{globalThis:S}),wf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:wf.devicePixelRatio;var Qf=TypeError,Xf=Object.getOwnPropertyDescriptor,Jf=ht&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(gi(t)&&!Xf(t,"length").writable)throw Qf("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},tl=TypeError,el=function(t){if(t>9007199254740991)throw tl("Maximum allowed index exceeded");return t},rl=_i("splice"),nl=Math.max,ol=Math.min;ar({target:"Array",proto:!0,forced:!rl},{splice:function(t,e){var r,n,o,i,a,u,s=z(this),c=We(s),f=Ce(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=ol(nl(Le(e),0),c-f)),el(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&ji(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:us(s,u);for(i=c;i>c-n+r;i--)us(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:us(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return Jf(s,c-n+r),o}});var il=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),al=Object.assign,ul=Object.defineProperty,sl=N([].concat),cl=!al||P((function(){if(ht&&1!==al({b:1},al(ul({},"a",{enumerable:!0,get:function(){ul(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=al({},t)[r]||"abcdefghijklmnopqrst"!=Ui(al({},e)).join("")}))?function(t,e){for(var r=z(t),n=arguments.length,o=1,i=Ye.f,a=Ae.f;n>o;)for(var u,s=Te(arguments[o++]),c=i?sl(Ui(s),i(s)):Ui(s),f=c.length,l=0;f>l;)u=c[l++],ht&&!Ot(a,s,u)||(r[u]=s[u]);return r}:al;ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==cl},{assign:cl});var fl=Ai.findIndex,ll=!0;"findIndex"in[]&&Array(1).findIndex((function(){ll=!1})),ar({target:"Array",proto:!0,forced:ll},{findIndex:function(t){return fl(this,t,arguments.length>1?arguments[1]:void 0)}}),ra("findIndex");var hl=jf.charAt,pl=fe.set,vl=fe.getterFor("String Iterator");ba(String,"String",(function(t){pl(this,{type:"String Iterator",string:Xc(t),index:0})}),(function(){var t,e=vl(this),r=e.string,n=e.index;return n>=r.length?xa(void 0,!0):(t=hl(r,n),e.index+=t.length,xa(t,!1))}));var dl=!P((function(){return Object.isExtensible(Object.preventExtensions({}))})),yl=Ze.f,gl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ml={f:function(t){return gl&&"Window"==de(t)?function(t){try{return yl(t)}catch(t){return pu(gl)}}(t):yl(ke(t))}},bl=P((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),xl=Object.isExtensible,wl=P((function(){xl(1)}))||bl?function(t){return!!vt(t)&&((!bl||"ArrayBuffer"!=de(t))&&(!xl||xl(t)))}:xl,El=w((function(t){var e=Gt.f,r=!1,n=q("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=Ze.f,e=N([].splice),o={};o[n]=1,t(o).length&&(Ze.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ar({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:ml.f}))},fastKey:function(t,e){if(!vt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!U(t,n)){if(!wl(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!U(t,n)){if(!wl(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return dl&&r&&wl(t)&&!U(t,n)&&i(t),t}};ie[n]=!0})),Al=(El.enable,El.fastKey,El.getWeakData,El.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=S[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=N(u[t]);he(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!vt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!vt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!vt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(or(t,!lt(a)||!(o||u.forEach&&!P((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),El.enable();else if(or(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=P((function(){l.has(1)})),v=Mo((function(t){new a(t)})),d=!o&&P((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){mr(t,u);var r=os(new a,t,s);return C(e)||ko(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ar({global:!0,constructor:!0,forced:s!=a},c),pr(s,t),o||r.setStrong(s,t,n),s}),Ol=El.getWeakData,Sl=fe.set,Tl=fe.getterFor,kl=Ai.find,Il=Ai.findIndex,jl=N([].splice),Pl=0,_l=function(t){return t.frozen||(t.frozen=new Ml)},Ml=function(){this.entries=[]},Ll=function(t,e){return kl(t.entries,(function(t){return t[0]===e}))};Ml.prototype={get:function(t){var e=Ll(this,t);if(e)return e[1]},has:function(t){return!!Ll(this,t)},set:function(t,e){var r=Ll(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Il(this.entries,(function(e){return e[0]===t}));return~e&&jl(this.entries,e,1),!!~e}};var Rl,Nl={getConstructor:function(t,e,r,n){var o=t((function(t,o){mr(t,i),Sl(t,{type:e,id:Pl++,frozen:void 0}),C(o)||ko(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Tl(e),u=function(t,e,r){var n=a(t),o=Ol(Et(e),!0);return!0===o?_l(n).set(e,r):o[n.id]=r,t};return Ja(i,{delete:function(t){var e=a(this);if(!vt(t))return!1;var r=Ol(t);return!0===r?_l(e).delete(t):r&&U(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!vt(t))return!1;var r=Ol(t);return!0===r?_l(e).has(t):r&&U(r,e.id)}}),Ja(i,r?{get:function(t){var e=a(this);if(vt(t)){var r=Ol(t);return!0===r?_l(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},Cl=fe.enforce,Dl=Object,Fl=Array.isArray,Wl=Dl.isExtensible,zl=Dl.isFrozen,Bl=Dl.isSealed,Ul=Dl.freeze,Gl=Dl.seal,Vl={},Hl={},ql=!S.ActiveXObject&&"ActiveXObject"in S,Zl=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Yl=Al("WeakMap",Zl,Nl),$l=Yl.prototype,Kl=N($l.set);if(te)if(ql){Rl=Nl.getConstructor(Zl,"WeakMap",!0),El.enable();var Ql=N($l.delete),Xl=N($l.has),Jl=N($l.get);Ja($l,{delete:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Ql(this,t)||e.frozen.delete(t)}return Ql(this,t)},has:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Xl(this,t)||e.frozen.has(t)}return Xl(this,t)},get:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Xl(this,t)?Jl(this,t):e.frozen.get(t)}return Jl(this,t)},set:function(t,e){if(vt(t)&&!Wl(t)){var r=Cl(this);r.frozen||(r.frozen=new Rl),Xl(this,t)?Kl(this,t,e):r.frozen.set(t,e)}else Kl(this,t,e);return this}})}else dl&&P((function(){var t=Ul([]);return Kl(new Yl,t,1),!zl(t)}))&&Ja($l,{set:function(t,e){var r;return Fl(t)&&(zl(t)?r=Vl:Bl(t)&&(r=Hl)),Kl(this,t,e),r==Vl&&Ul(t),r==Hl&&Gl(t),this}});var th=it("iterator"),eh=it("toStringTag"),rh=Oa.values,nh=function(t,e){if(t){if(t[th]!==rh)try{re(t,th,rh)}catch(e){t[th]=rh}if(t[eh]||re(t,eh,e),pi[e])for(var r in Oa)if(t[r]!==Oa[r])try{re(t,r,Oa[r])}catch(e){t[r]=Oa[r]}}};for(var oh in pi)nh(S[oh]&&S[oh].prototype,oh);nh(yi,"DOMTokenList");var ih,ah,uh,sh,ch=new WeakMap,fh=function(){function t(){i(this,t),ch.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=ch.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),ch.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=ch.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=ch.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),lh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(fh));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var hh=my.getSystemInfoSync();ih=hh.screenWidth,ah=hh.screenHeight,uh=hh.windowWidth,sh=hh.windowHeight}else{var ph=wf.innerWidth,vh=wf.innerHeight;ih=ph,ah=vh,uh=ph,sh=vh}var dh={width:ih,height:ah,availWidth:uh,availHeight:sh,availLeft:0,availTop:0},yh=dh.availWidth,gh=dh.availHeight,mh={style:[]};function bh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return mh}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return mh}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function xh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:yh+"px",height:gh+"px",margin:"0px",padding:"0px"})}function wh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=yh,t.clientHeight=gh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function Eh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=yh,t.offsetHeight=gh)}function Ah(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=yh,t.scrollHeight=gh)}function Oh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function Sh(){}var Th=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=Sh,t.blur=Sh,t.insertBefore=Sh,t.appendChild=Sh,t.removeChild=Sh,t.remove=Sh,t.innerHTML="",t.tagName=n.toUpperCase(),bh(h(t),o),xh(h(t)),Oh(h(t)),wh(h(t)),Eh(h(t)),Ah(h(t)),t}return u(r)}(lh),kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Th)),Ih={};function jh(){return Ih}var Ph=u((function t(){i(this,t);var e=jh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),bh(r),Oh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),_h={href:"",protocol:"",host:""},Mh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(Th),Lh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(Th),Rh={},Nh={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:_h,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Ph:"video"===t?new kh:new Th(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){Rh[t]||(Rh[t]=[]),Rh[t].push(e)},removeEventListener:function(t,e){var r=Rh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=Rh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new il(t)}};Nh.documentElement=new Lh,Nh.head=new Th("head"),Nh.body=new Mh,Of("match",(function(t,e,r){return[function(e){var r=F(this),n=C(e)?void 0:Rt(e,t);return n?Ot(n,e,r):new RegExp(e)[t](Xc(r))},function(t){var n=Et(this),o=Xc(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return zf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=zf(n,o));){var f=Xc(u[0]);s[c]=f,""===f&&(n.lastIndex=_f(o,Fe(n.lastIndex),a)),c++}return 0===c?null:s}]}));var Ch,Dh,Fh=it("isConcatSpreadable"),Wh=X>=51||!P((function(){var t=[];return t[Fh]=!1,t.concat()[0]!==t})),zh=function(t){if(!vt(t))return!1;var e=t[Fh];return void 0!==e?!!e:gi(t)},Bh=!Wh||!_i("concat");if(ar({target:"Array",proto:!0,arity:1,forced:Bh},{concat:function(t){var e,r,n,o,i,a=z(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(zh(i=-1===e?a:arguments[e]))for(o=We(i),el(s+o),r=0;r<o;r++,s++)r in i&&ji(u,s,i[r]);else el(s+1),ji(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Uh=my.getSystemInfoSync();Ch=Uh.system,Uh.platform,Uh.language}else{var Gh={versions:(Dh=wf.navigator.userAgent,{trident:Dh.indexOf("Trident")>-1,presto:Dh.indexOf("Presto")>-1,webKit:Dh.indexOf("AppleWebKit")>-1,gecko:Dh.indexOf("Gecko")>-1&&-1===Dh.indexOf("KHTML"),mobile:!!Dh.match(/AppleWebKit.*Mobile.*/),ios:!!Dh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Dh.indexOf("Android")>-1||Dh.indexOf("Linux")>-1,iPhone:Dh.indexOf("iPhone")>-1,iPad:Dh.indexOf("iPad")>-1,webApp:-1===Dh.indexOf("Safari"),weixin:Dh.indexOf("MicroMessenger")>-1,qq:" qq"===Dh.match(/\\sQQ/i)}),language:(wf.navigator.browserLanguage||wf.navigator.language).toLowerCase()};Gh.versions.android?"android":Gh.versions.trident?"IE":Gh.versions.presto?"Opera":Gh.versions.webKit?"webKit":Gh.versions.gecko?"Firefox":Gh.versions.mobile?"mobile":Gh.versions.ios?"ios":Gh.versions.iPhone?"iPhone":Gh.versions.iPad?"ipad":Gh.versions.webApp?"webApp":Gh.versions.weixin?"weixin":Gh.versions.qq&&"qq",Ch=wf.navigator.userAgent,Gh.language}Ch.toLowerCase().indexOf("android");is("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Vh=El.fastKey,Hh=fe.set,qh=fe.getterFor;Al("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){mr(t,i),Hh(t,{type:e,index:$i(null),first:void 0,last:void 0,size:0}),ht||(t.size=0),C(o)||ko(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=qh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=Vh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),ht?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=Vh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return Ja(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,ht?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),ht?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=Ur(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),Ja(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),ht&&vr(i,"size",{configurable:!0,get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=qh(e),i=qh(n);ba(t,e,(function(t,e){Hh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?xa("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,xa(void 0,!0))}),r?"entries":"values",!r,!0),yr(e)}});var Zh=N([].join),Yh=Te!=Object||!Oi("join",",");ar({target:"Array",proto:!0,forced:Yh},{join:function(t){return Zh(ke(this),void 0===t?",":t)}});var $h=Ai.map,Kh=_i("map");ar({target:"Array",proto:!0,forced:!Kh},{map:function(t){return $h(this,t,arguments.length>1?arguments[1]:void 0)}});var Qh=P((function(){Ui(1)}));ar({target:"Object",stat:!0,forced:Qh},{keys:function(t){return Ui(z(t))}});var Xh=new Map,Jh=new Map,tp=new Map,ep=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Xh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=tp.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Jh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Jh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Xh.get("requestHeader");r[t]=e,Xh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(fh);s(ep,"UNSEND",void 0),s(ep,"OPENED",void 0),s(ep,"HEADERS_RECEIVED",void 0),s(ep,"LOADING",void 0),s(ep,"DONE",void 0),ep.UNSEND=0,ep.OPENED=1,ep.HEADERS_RECEIVED=2,ep.LOADING=3,ep.DONE=4;var rp="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,np="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),op=(rp||np)&&!1;op||wf.XMLHttpRequest,op||wf.location;function ip(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ap=Ai.filter,up=_i("filter");function sp(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function cp(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function fp(t){return t.filter?[1]:[0]}function lp(t,e){return[e]}ar({target:"Array",proto:!0,forced:!up},{filter:function(t){return ap(this,t,arguments.length>1?arguments[1]:void 0)}});var hp=vp,pp=vp;function vp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=dp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=dp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(Tp(s));for(c.sort(Ep),o=0;o<c.length;o++)r=Ap(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return gp(h,p,r,n,o,c,0),p}function dp(t,e,r,n,o){var i,a;if(o===Wp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=Cp(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=Cp(i,t[i],t[i+1],a);return a&&Pp(a,a.next)&&(Dp(a),a=a.next),a}function yp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Pp(n,n.next)&&0!==jp(n.prev,n,n.next))n=n.next;else{if(Dp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function gp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=Sp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?bp(t,n,o,i):mp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Dp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?gp(t=xp(yp(t),e,r),e,r,n,o,i,2):2===a&&wp(t,e,r,n,o,i):gp(yp(t),e,r,n,o,i,1);break}}}function mp(t){var e=t.prev,r=t,n=t.next;if(jp(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&kp(o,u,i,s,a,c,v.x,v.y)&&jp(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function bp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(jp(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=Sp(p,v,e,r,n),m=Sp(d,y,e,r,n),b=t.prevZ,x=t.nextZ;b&&b.z>=g&&x&&x.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&kp(u,f,s,l,c,h,b.x,b.y)&&jp(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&kp(u,f,s,l,c,h,x.x,x.y)&&jp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=g;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&kp(u,f,s,l,c,h,b.x,b.y)&&jp(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&kp(u,f,s,l,c,h,x.x,x.y)&&jp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function xp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Pp(o,i)&&_p(o,n,n.next,i)&&Rp(o,i)&&Rp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Dp(n),Dp(n.next),n=t=i),n=n.next}while(n!==t);return yp(n)}function wp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ip(a,u)){var s=Np(a,u);return a=yp(a,a.next),s=yp(s,s.next),gp(a,e,r,n,o,i,0),void gp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function Ep(t,e){return t.x-e.x}function Ap(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&kp(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),Rp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&Op(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Np(r,t);return yp(n,n.next),yp(r,r.next)}function Op(t,e){return jp(t.prev,t,e.prev)<0&&jp(e.next,t,t.next)<0}function Sp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Tp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function kp(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ip(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&_p(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Rp(t,e)&&Rp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(jp(t.prev,t,e.prev)||jp(t,e.prev,e))||Pp(t,e)&&jp(t.prev,t,t.next)>0&&jp(e.prev,e,e.next)>0)}function jp(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Pp(t,e){return t.x===e.x&&t.y===e.y}function _p(t,e,r,n){var o=Lp(jp(t,e,r)),i=Lp(jp(t,e,n)),a=Lp(jp(r,n,t)),u=Lp(jp(r,n,e));return o!==i&&a!==u||(!(0!==o||!Mp(t,r,e))||(!(0!==i||!Mp(t,n,e))||(!(0!==a||!Mp(r,t,n))||!(0!==u||!Mp(r,e,n)))))}function Mp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Lp(t){return t>0?1:t<0?-1:0}function Rp(t,e){return jp(t.prev,t,t.next)<0?jp(t,e,t.next)>=0&&jp(t,t.prev,e)>=0:jp(t,e,t.prev)<0||jp(t,t.next,e)<0}function Np(t,e){var r=new Fp(t.i,t.x,t.y),n=new Fp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Cp(t,e,r,n){var o=new Fp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Dp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Fp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}vp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Wp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Wp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},vp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},hp.default=pp;var zp=S,Bp=N(1..valueOf),Up="\\t\\n\\v\\f\\r                　\\u2028\\u2029\\ufeff",Gp=N("".replace),Vp=RegExp("^["+Up+"]+"),Hp=RegExp("(^|[^"+Up+"])["+Up+"]+$"),qp=function(t){return function(e){var r=Xc(F(e));return 1&t&&(r=Gp(r,Vp,"")),2&t&&(r=Gp(r,Hp,"$1")),r}},Zp={start:qp(1),end:qp(2),trim:qp(3)},Yp=Ze.f,$p=je.f,Kp=Gt.f,Qp=Zp.trim,Xp=S.Number,Jp=(zp.Number,Xp.prototype),tv=S.TypeError,ev=N("".slice),rv=N("".charCodeAt),nv=function(t){var e=Ft(t,"number");return"bigint"==typeof e?e:ov(e)},ov=function(t){var e,r,n,o,i,a,u,s,c=Ft(t,"number");if(jt(c))throw tv("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Qp(c),43===(e=rv(c,0))||45===e){if(88===(r=rv(c,2))||120===r)return NaN}else if(48===e){switch(rv(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=ev(c,2)).length,u=0;u<a;u++)if((s=rv(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c},iv=or("Number",!Xp(" 0o1")||!Xp("0b1")||Xp("+0x1")),av=function(t){return kt(Jp,t)&&P((function(){Bp(t)}))},uv=function(t){var e=arguments.length<1?0:Xp(nv(t));return av(this)?os(Object(e),this,uv):e};uv.prototype=Jp,iv&&(Jp.constructor=uv),ar({global:!0,constructor:!0,wrap:!0,forced:iv},{Number:uv});iv&&function(t,e){for(var r,n=ht?Yp(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),o=0;n.length>o;o++)U(e,r=n[o])&&!U(t,r)&&Kp(t,r,$p(e,r))}(zp.Number,Xp);var sv=RangeError,cv=RangeError,fv=String,lv=Math.floor,hv=N((function(t){var e=Xc(F(this)),r="",n=Le(t);if(n<0||n==1/0)throw sv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),pv=N("".slice),vv=N(1..toFixed),dv=function(t,e,r){return 0===e?r:e%2==1?dv(t,e-1,r*t):dv(t*t,e/2,r)},yv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=lv(o/1e7)},gv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=lv(n/e),n=n%e*1e7},mv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=fv(t[e]);r=""===r?n:r+hv("0",7-n.length)+n}return r},bv=P((function(){return"0.000"!==vv(8e-5,3)||"1"!==vv(.9,0)||"1.25"!==vv(1.255,2)||"1000000000000000128"!==vv(0xde0b6b3a7640080,0)}))||!P((function(){vv({})}));function xv(t){return"number"==typeof t}function wv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ar({target:"Number",proto:!0,forced:bv},{toFixed:function(t){var e,r,n,o,i=Bp(this),a=Le(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw cv("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return fv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*dv(2,69,1))-69)<0?i*dv(2,-e,1):i/dv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(yv(u,0,r),n=a;n>=7;)yv(u,1e7,0),n-=7;for(yv(u,dv(10,n,1),0),n=e-1;n>=23;)gv(u,1<<23),n-=23;gv(u,1<<n),yv(u,1,1),gv(u,2),c=mv(u)}else yv(u,0,r),yv(u,1<<-e,0),c=mv(u)+hv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+hv("0",a-o)+c:pv(c,0,o-a)+"."+pv(c,o-a)):s+c}});var Ev,Av=/"/g,Ov=N("".replace);ar({target:"String",proto:!0,forced:(Ev="sub",P((function(){var t=""[Ev](\'"\');return t!==t.toLowerCase()||t.split(\'"\').length>3})))},{sub:function(){return t="sub",e="",r="",n=Xc(F(this)),o="<"+t,""!==e&&(o+=" "+e+\'="\'+Ov(Xc(r),Av,"&quot;")+\'"\'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var Sv=RegExp.prototype,Tv=Zt.PROPER,kv=RegExp.prototype.toString,Iv=P((function(){return"/a/b"!=kv.call({source:"a",flags:"b"})})),jv=Tv&&"toString"!=kv.name;(Iv||jv)&&he(RegExp.prototype,"toString",(function(){var t=Et(this);return"/"+Xc(t.source)+"/"+Xc(function(t){var e=t.flags;return void 0!==e||"flags"in Sv||U(t,"flags")||!kt(Sv,t)?e:Ot(Jc,t)}(t))}),{unsafe:!0});var Pv="undefined"!=typeof Float32Array?Float32Array:Array;function _v(){var t=new Pv(2);return Pv!=Float32Array&&(t[0]=0,t[1]=0),t}function Mv(t,e){var r=new Pv(2);return r[0]=t,r[1]=e,r}function Lv(t,e){return t[0]=e[0],t[1]=e[1],t}function Rv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Nv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Cv(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Dv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Fv,Wv=Nv,zv=(Fv=_v(),_v()),Bv=(_v(),_v()),Uv=_v(),Gv=_v();function Vv(t,e,r,n,o){return Rv(t,r,n),Cv(t,t),[o/Dv(e=Mv(-t[1],t[0]),Mv(-r[1],r[0])),e]}function Hv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function qv(t,e,r){return Wv(t,e,r),Cv(t,t),t}function Zv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Yv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",Mv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=wv([a[0],a[1]]),g=wv([i[0],i[1]]);qv(Bv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),!this.started)if(this.started=!0,h){var b=_v(),x=_v();Rv(b,this.normal,Bv),Rv(x,this.normal,Bv),l.push(x[0],x[1],0),l.push(b[0],b[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Zv(n,o)&&Rv(o,n,Cv(o,Nv(o,n,r))),qv(Uv,o,n);var w=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),E=w[0],A=w[1],O=Dv(Gv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),Hv(zv,Uv),Lv(this.normal,zv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Lv(this.normal,A),s+=2),this.lastFlip=O}else{if(Hv(this.normal,Bv),h){var T=_v(),k=_v();Wv(k,Bv,this.normal),Rv(T,Bv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=wv([n[0],n[1]]),f=wv([r[0],r[1]]);qv(Bv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=wv([o[0],o[1]]);Zv(c,h)&&Rv(h,c,Cv(h,Nv(h,c,f))),qv(Uv,h,c);var p=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),v=p[0],g=p[1];Dv(Gv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Lv(this.normal,g),i+=2,this.lastFlip=-1}else Hv(this.normal,Bv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=wv([n[0],n[1]]),h=wv([r[0],r[1]]);qv(Bv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),!this.started)if(this.started=!0,c){var v=_v(),g=_v();Rv(v,this.normal,Bv),Rv(g,this.normal,Bv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=wv([o[0],o[1]]);Zv(l,m)&&Rv(m,l,Cv(m,Nv(m,l,h))),qv(Uv,m,l);var b=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),x=b[0],w=b[1],E=Dv(Gv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)x>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),Hv(zv,Uv),Lv(this.normal,zv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,x,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Lv(this.normal,w),i+=2),this.lastFlip=E}else{if(Hv(this.normal,Bv),c){var O=_v(),S=_v();Wv(S,Bv,this.normal),Rv(O,Bv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function $v(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Yv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Kv(t){var e=function(t){if(xv(t[0]))return t;if(xv(t[0][0]))throw new Error("当前数据不支持标注");if(xv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("当前数据不支持标注")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function Qv(t){var e=t.coordinates,r=hp.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:hp(n,i,o),vertices:n,size:o}}var Xv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=$v(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Jv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Kv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Xv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=Qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},td=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Jv);function ed(t){return rd.apply(this,arguments)}function rd(){return(rd=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!td[n]){t.next=3;break}return t.abrupt("return",td[n](o));case 3:return t.abrupt("return",Promise.reject(new Error(\'Worker with type "\'.concat(n,\'" non-existent.\'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return li(ed),t.WorkerSourceMap=Jv,t.createWorker=li,t.worker=ed,t}({});\n');var Is=Ps;function Ps(t,e){this.x=t,this.y=e}Ps.prototype={clone:function(){return new Ps(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ps.convert=function(t){return t instanceof Ps?t:Array.isArray(t)?new Ps(t[0],t[1]):t};var Ls=Is,Rs=Os;function Os(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(Ds,this,e)}function Ds(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){var n=t.readVarint()+t.pos;for(;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function Ns(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],r+=((n=t[a]).x-e.x)*(e.y+n.y);return r}Os.types=["Unknown","Point","LineString","Polygon"],Os.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,i=0,o=0,a=0,s=[];t.pos<n;){if(i<=0){var u=t.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)o+=t.readSVarint(),a+=t.readSVarint(),1===r&&(e&&s.push(e),e=[]),e.push(new Ls(o,a));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&s.push(e),s},Os.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(r<=0){var c=t.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},Os.prototype.toGeoJSON=function(t,e,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=Os.types[this.type];function c(t){for(var e=0;e<t.length;e++){var n=t[e],r=180-360*(n.y+s)/o;t[e]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];c(u=h);break;case 2:for(r=0;r<u.length;r++)c(u[r]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=Ns(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}n&&i.push(n);return i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)c(u[r][i])}1===u.length?u=u[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p};var zs=Rs,Fs=Bs;function Bs(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Us,this,e),this.length=this._features.length}function Us(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){var e=null,n=t.readVarint()+t.pos;for(;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}Bs.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new zs(this._pbf,e,this.extent,this._keys,this._values)};var js=Fs,Vs=function(t,e){this.layers=t.readFields(Gs,{},e)};function Gs(t,e,n){if(3===t){var r=new js(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}var Hs=Vs,Ws={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,p=n?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},write:function(t,e,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+f]=255&a,f+=d,a/=256,l-=8);t[n+f-d]|=128*v}},Zs=Xs,qs=Ws;function Xs(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Xs.Varint=0,Xs.Fixed64=1,Xs.Bytes=2,Xs.Fixed32=5;var Ys=4294967296,Ks=1/Ys,Qs="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Js(t){return t.type===Xs.Bytes?t.readVarint()+t.pos:t.pos+1}function $s(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function tu(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function eu(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function nu(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function ru(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function iu(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function ou(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function au(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function su(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function uu(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function lu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function cu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function hu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function pu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Xs.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=cu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=pu(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=cu(this.buf,this.pos)+cu(this.buf,this.pos+4)*Ys;return this.pos+=8,t},readSFixed64:function(){var t=cu(this.buf,this.pos)+pu(this.buf,this.pos+4)*Ys;return this.pos+=8,t},readFloat:function(){var t=qs.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=qs.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(i=o[n.pos++],r=(112&i)>>4,i<128)return $s(t,r,e);if(i=o[n.pos++],r|=(127&i)<<3,i<128)return $s(t,r,e);if(i=o[n.pos++],r|=(127&i)<<10,i<128)return $s(t,r,e);if(i=o[n.pos++],r|=(127&i)<<17,i<128)return $s(t,r,e);if(i=o[n.pos++],r|=(127&i)<<24,i<128)return $s(t,r,e);if(i=o[n.pos++],r|=(1&i)<<31,i<128)return $s(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Qs?function(t,e,n){return Qs.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){var r="",i=e;for(;i<n;){var o,a,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Xs.Bytes)return t.push(this.readVarint(e));var n=Js(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Xs.Bytes)return t.push(this.readSVarint());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Xs.Bytes)return t.push(this.readBoolean());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Xs.Bytes)return t.push(this.readFloat());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Xs.Bytes)return t.push(this.readDouble());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Xs.Bytes)return t.push(this.readFixed32());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Xs.Bytes)return t.push(this.readSFixed32());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Xs.Bytes)return t.push(this.readFixed64());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Xs.Bytes)return t.push(this.readSFixed64());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Xs.Varint)for(;this.buf[this.pos++]>127;);else if(e===Xs.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Xs.Fixed32)this.pos+=4;else{if(e!==Xs.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),hu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),hu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),hu(this.buf,-1&t,this.pos),hu(this.buf,Math.floor(t*Ks),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),hu(this.buf,-1&t,this.pos),hu(this.buf,Math.floor(t*Ks),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;if(e.buf[e.pos++]|=n|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&tu(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),qs.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),qs.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&tu(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Xs.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,eu,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,nu,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,ou,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,ru,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,iu,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,au,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,su,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,uu,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,lu,e)},writeBytesField:function(t,e){this.writeTag(t,Xs.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Xs.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Xs.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Xs.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Xs.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Xs.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Xs.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Xs.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Xs.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Xs.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var fu=function(){function t(e,n,r,i){Ee(this,t),kt(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=new Hs(new Zs(e))}return Te(t,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var e=this.vectorTile.layers[t];if(Array.isArray(e.features))return this.vectorLayerCache[t]=e.features,e.features;for(var n=[],r=0;r<e.length;r++){var i=e.feature(r).toGeoJSON(this.x,this.y,this.z);n.push(It(It({},i),{},{properties:It({id:i.id},i.properties)}))}return this.vectorLayerCache[t]=n,n}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),t}(),du={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},vu=function(){var t=Zt(Kt.mark((function t(e,n,r,i,o){var a;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=no(e,n),t.abrupt("return",new Promise((function(t){if(o)o({x:r.x,y:r.y,z:r.z},(function(e,n){if(e||!n)t(void 0);else{var i=new fu(n,r.x,r.y,r.z);t(i)}}));else{var e=sr(It(It({},i),{},{url:a}),(function(e,n){if(e||!n)t(void 0);else{var i=new fu(n,r.x,r.y,r.z);t(i)}}));r.xhrCancel=function(){return e.abort()}}})));case 2:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}();function mu(t,e){for(var n=e[0],r=n.width,i=n.height,o=e.map((function(t){return t.rasterData})),a=r*i,s=[],u=JSON.stringify(t),l=0;l<a;l++){var c=JSON.parse(u),h=yu(c,o,l);if("number"==typeof h)s.push(h);else{var p=gu(c);s.push(p)}}return s}function yu(t,e,n){if(2===t.length&&"band"===t[0]&&"number"==typeof t[1])try{return e[t[1]][n]}catch(t){return console.warn("Raster Data err!"),0}t.map((function(r,i){if(Array.isArray(r)&&r.length>0)if("band"===r[0])try{t[i]=e[r[1]][n]}catch(e){console.warn("Raster Data err!"),t[i]=0}else yu(r,e,n)}))}function gu(t){var e=function(t){var e=$r(t,3),n=e[0],r=e[1],i=void 0===r?-1:r,o=e[2],a=void 0===o?-1:o;return void 0===n?(console.warn("Express err!"),["+",0,0]):[n.replace(/\s+/g,""),i,a]}(t),n=e[0],r=e[1],i=e[2];return Array.isArray(r)&&(r=gu(t[1])),Array.isArray(i)&&(i=gu(t[2])),function(t,e,n){switch(t){case"+":return e+n;case"-":return e-n;case"*":return e*n;case"/":return e/n;case"%":return e%n;case"^":return Math.pow(e,n);case"abs":return Math.abs(e);case"floor":return Math.floor(e);case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"sin":return Math.sin(e);case"cos":return Math.cos(e);case"atan":return-1===n?Math.atan(e):Math.atan2(e,n);case"min":return Math.min(e,n);case"max":return Math.max(e,n);case"log10":return Math.log(e);case"log2":return Math.log2(e);default:return console.warn("Calculate symbol err! Return default 0"),0}}(n,r,i)}var _u,xu={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:function(t,e){for(var n=t[0].rasterData,r=t[1].rasterData,i=t[2].rasterData,o=[],a=$r((null==e?void 0:e.countCut)||[2,98],2),s=a[0],u=a[1],l=(null==e?void 0:e.RMinMax)||bu(n,s,u),c=(null==e?void 0:e.GMinMax)||bu(r,s,u),h=(null==e?void 0:e.BMinMax)||bu(i,s,u),p=0;p<n.length;p++)o.push(Math.max(0,n[p]-l[0])),o.push(Math.max(0,r[p]-c[0])),o.push(Math.max(0,i[p]-h[0]));return{rasterData:o,rMinMax:l,gMinMax:c,bMinMax:h}}}};function bu(t,e,n){var r=t.slice().sort((function(t,e){return t-e})),i=r.length;return[r[Math.ceil(i*e/100)],r[Math.ceil(i*n/100)]]}function wu(t,e,n){return Su.apply(this,arguments)}function Su(){return Su=Zt(Kt.mark((function t(e,n,r){var i,o,a,s,u,l;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.length){t.next=2;break}return t.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return t.next=4,Promise.all(e.map((function(t){var e=t.data,r=t.bands;return n(e,void 0===r?[0]:r)})));case 4:i=t.sent,o=[],i.forEach((function(t){Array.isArray(t)?o.push.apply(o,At(t)):o.push(t)})),a=o[0],s=a.width,u=a.height,t.t0=Tt(r),t.next="function"===t.t0?11:"object"===t.t0?13:15;break;case 11:return l=r(o),t.abrupt("break",16);case 13:return l=Array.isArray(r)?{rasterData:mu(r,o)}:Eu(r,o),t.abrupt("break",16);case 15:l={rasterData:o[0].rasterData};case 16:return t.abrupt("return",It(It({},l),{},{width:s,height:u}));case 17:case"end":return t.stop()}}),t)}))),Su.apply(this,arguments)}function Eu(t,e){var n=xu[t.type];return"function"===n.type?n.method(e,null==t?void 0:t.options):"operation"===n.type?"rgb"===t.type?function(t,e){void 0===t.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!");void 0===t.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!");void 0===t.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var n=mu(t.r||["band",0],e),r=mu(t.g||["band",0],e),i=mu(t.b||["band",0],e);return[n,r,i]}(n.expression,e):{rasterData:mu(n.expression,e)}:void 0}function Au(t,e,n,r){return Tu.apply(this,arguments)}function Tu(){return(Tu=Zt(Kt.mark((function t(e,n,r,i){var o;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,wu(e,n,r);case 2:o=t.sent,i(null,{data:o});case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Cu(t){return!!Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}!function(t){!function(e){var n="object"==typeof D?D:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),r=i(t);function i(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===n.Reflect?n.Reflect=t:r=i(n.Reflect,r),function(t){var e=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return rt(Object.create(null))}:a?function(){return rt({__proto__:null})}:function(){return rt({})},has:s?function(t,n){return e.call(t,n)}:function(t,e){return e in t},get:s?function(t,n){return e.call(t,n)?t[n]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),c="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=c||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?tt():Map,p=c||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?et():Set,f=new(c||"function"!=typeof WeakMap?nt():WeakMap);function d(t,e,n,r){if(D(n)){if(!H(t))throw new TypeError;if(!Z(e))throw new TypeError;return E(t,e)}if(!H(t))throw new TypeError;if(!F(e))throw new TypeError;if(!F(r)&&!D(r)&&!N(r))throw new TypeError;return N(r)&&(r=void 0),A(t,e,n=G(n),r)}function v(t,e){function n(n,r){if(!F(n))throw new TypeError;if(!D(r)&&!q(r))throw new TypeError;P(t,e,n,r)}return n}function m(t,e,n,r){if(!F(n))throw new TypeError;return D(r)||(r=G(r)),P(t,e,n,r)}function y(t,e,n){if(!F(e))throw new TypeError;return D(n)||(n=G(n)),C(t,e,n)}function g(t,e,n){if(!F(e))throw new TypeError;return D(n)||(n=G(n)),k(t,e,n)}function _(t,e,n){if(!F(e))throw new TypeError;return D(n)||(n=G(n)),M(t,e,n)}function x(t,e,n){if(!F(e))throw new TypeError;return D(n)||(n=G(n)),I(t,e,n)}function b(t,e){if(!F(t))throw new TypeError;return D(e)||(e=G(e)),L(t,e)}function w(t,e){if(!F(t))throw new TypeError;return D(e)||(e=G(e)),R(t,e)}function S(t,e,n){if(!F(e))throw new TypeError;D(n)||(n=G(n));var r=T(e,n,!1);if(D(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=f.get(e);return i.delete(n),i.size>0||f.delete(e),!0}function E(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!D(r)&&!N(r)){if(!Z(r))throw new TypeError;e=r}}return e}function A(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=(0,t[i])(e,n,r);if(!D(o)&&!N(o)){if(!F(o))throw new TypeError;r=o}}return r}function T(t,e,n){var r=f.get(t);if(D(r)){if(!n)return;r=new h,f.set(t,r)}var i=r.get(e);if(D(i)){if(!n)return;i=new h,r.set(e,i)}return i}function C(t,e,n){if(k(t,e,n))return!0;var r=$(e);return!N(r)&&C(t,r,n)}function k(t,e,n){var r=T(e,n,!1);return!D(r)&&j(r.has(t))}function M(t,e,n){if(k(t,e,n))return I(t,e,n);var r=$(e);return N(r)?void 0:M(t,r,n)}function I(t,e,n){var r=T(e,n,!1);if(!D(r))return r.get(t)}function P(t,e,n,r){T(n,r,!0).set(t,e)}function L(t,e){var n=R(t,e),r=$(t);if(null===r)return n;var i=L(r,e);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new p,a=[],s=0,u=n;s<u.length;s++){var l=u[s];o.has(l)||(o.add(l),a.push(l))}for(var c=0,h=i;c<h.length;c++){l=h[c];o.has(l)||(o.add(l),a.push(l))}return a}function R(t,e){var n=[],r=T(t,e,!1);if(D(r))return n;for(var i=Y(r.keys()),o=0;;){var a=Q(i);if(!a)return n.length=o,n;var s=K(a);try{n[o]=s}catch(t){try{J(i)}finally{throw t}}o++}}function O(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function D(t){return void 0===t}function N(t){return null===t}function z(t){return"symbol"==typeof t}function F(t){return"object"==typeof t?null!==t:"function"==typeof t}function B(t,e){switch(O(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",i=X(t,r);if(void 0!==i){var o=i.call(t,n);if(F(o))throw new TypeError;return o}return U(t,"default"===n?"number":n)}function U(t,e){if("string"===e){var n=t.toString;if(W(n))if(!F(i=n.call(t)))return i;if(W(r=t.valueOf))if(!F(i=r.call(t)))return i}else{var r;if(W(r=t.valueOf))if(!F(i=r.call(t)))return i;var i,o=t.toString;if(W(o))if(!F(i=o.call(t)))return i}throw new TypeError}function j(t){return!!t}function V(t){return""+t}function G(t){var e=B(t,3);return z(e)?e:V(e)}function H(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function W(t){return"function"==typeof t}function Z(t){return"function"==typeof t}function q(t){switch(O(t)){case 3:case 4:return!0;default:return!1}}function X(t,e){var n=t[e];if(null!=n){if(!W(n))throw new TypeError;return n}}function Y(t){var e=X(t,i);if(!W(e))throw new TypeError;var n=e.call(t);if(!F(n))throw new TypeError;return n}function K(t){return t.value}function Q(t){var e=t.next();return!e.done&&e}function J(t){var e=t.return;e&&e.call(t)}function $(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l)return e;if(e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i||i===t?e:i}function tt(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[i]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,o)},e.prototype.entries=function(){return new n(this._keys,this._values,a)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[i]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function o(t,e){return e}function a(t,e){return[t,e]}}function et(){return function(){function t(){this._map=new h}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[i]=function(){return this.keys()},t}()}function nt(){var t=16,n=u.create(),r=i();return function(){function t(){this._key=i()}return t.prototype.has=function(t){var e=o(t,!1);return void 0!==e&&u.has(e,this._key)},t.prototype.get=function(t){var e=o(t,!1);return void 0!==e?u.get(e,this._key):void 0},t.prototype.set=function(t,e){return o(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=o(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=i()},t}();function i(){var t;do{t="@@WeakMap@@"+l()}while(u.has(n,t));return n[t]=!0,t}function o(t,n){if(!e.call(t,r)){if(!n)return;Object.defineProperty(t,r,{value:u.create()})}return t[r]}function a(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function s(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):a(new Uint8Array(t),t):a(new Array(t),t)}function l(){var e=s(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<t;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}function rt(t){return t.__=void 0,delete t.__,t}t("decorate",d),t("metadata",v),t("defineMetadata",m),t("hasMetadata",y),t("hasOwnMetadata",g),t("getMetadata",_),t("getOwnMetadata",x),t("getMetadataKeys",b),t("getOwnMetadataKeys",w),t("deleteMetadata",S)}(r)}()}(_u||(_u={}));var ku={},Mu={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]}(Mu);var Iu={},Pu={},Lu={};Object.defineProperty(Lu,"__esModule",{value:!0}),Lu.TargetTypeEnum=Lu.BindingTypeEnum=Lu.BindingScopeEnum=void 0;Lu.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Lu.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Lu.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};var Ru={};Object.defineProperty(Ru,"__esModule",{value:!0}),Ru.id=void 0;var Ou=0;Ru.id=function(){return Ou++},Object.defineProperty(Pu,"__esModule",{value:!0}),Pu.Binding=void 0;var Du=Lu,Nu=Ru,zu=function(){function t(t,e){this.id=Nu.id(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=Du.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=e.scope===Du.BindingScopeEnum.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();Pu.Binding=zu;var Fu={};Object.defineProperty(Fu,"__esModule",{value:!0}),Fu.STACK_OVERFLOW=Fu.CIRCULAR_DEPENDENCY_IN_FACTORY=Fu.POST_CONSTRUCT_ERROR=Fu.MULTIPLE_POST_CONSTRUCT_METHODS=Fu.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Fu.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Fu.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Fu.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Fu.ARGUMENTS_LENGTH_MISMATCH=Fu.INVALID_DECORATOR_OPERATION=Fu.INVALID_TO_SELF_VALUE=Fu.INVALID_FUNCTION_BINDING=Fu.INVALID_MIDDLEWARE_RETURN=Fu.NO_MORE_SNAPSHOTS_AVAILABLE=Fu.INVALID_BINDING_TYPE=Fu.NOT_IMPLEMENTED=Fu.CIRCULAR_DEPENDENCY=Fu.UNDEFINED_INJECT_ANNOTATION=Fu.MISSING_INJECT_ANNOTATION=Fu.MISSING_INJECTABLE_ANNOTATION=Fu.NOT_REGISTERED=Fu.CANNOT_UNBIND=Fu.AMBIGUOUS_MATCH=Fu.KEY_NOT_FOUND=Fu.NULL_ARGUMENT=Fu.DUPLICATED_METADATA=Fu.DUPLICATED_INJECTABLE_DECORATOR=void 0,Fu.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",Fu.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",Fu.NULL_ARGUMENT="NULL argument",Fu.KEY_NOT_FOUND="Key Not Found",Fu.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",Fu.CANNOT_UNBIND="Could not unbind serviceIdentifier:",Fu.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",Fu.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",Fu.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";Fu.UNDEFINED_INJECT_ANNOTATION=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},Fu.CIRCULAR_DEPENDENCY="Circular dependency found:",Fu.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",Fu.INVALID_BINDING_TYPE="Invalid binding type:",Fu.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",Fu.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",Fu.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",Fu.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",Fu.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";Fu.ARGUMENTS_LENGTH_MISMATCH=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},Fu.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",Fu.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",Fu.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",Fu.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",Fu.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";Fu.POST_CONSTRUCT_ERROR=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]};Fu.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."},Fu.STACK_OVERFLOW="Maximum call stack size exceeded";var Bu={};Object.defineProperty(Bu,"__esModule",{value:!0}),Bu.MetadataReader=void 0;var Uu=Mu,ju=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{compilerGeneratedMetadata:Reflect.getMetadata(Uu.PARAM_TYPES,t),userGeneratedMetadata:Reflect.getMetadata(Uu.TAGGED,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Reflect.getMetadata(Uu.TAGGED_PROP,t)||[]},t}();Bu.MetadataReader=ju;var Vu={},Gu={};Object.defineProperty(Gu,"__esModule",{value:!0}),Gu.BindingCount=void 0;Gu.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};var Hu={};Object.defineProperty(Hu,"__esModule",{value:!0}),Hu.isStackOverflowExeption=void 0;var Wu=Fu;Hu.isStackOverflowExeption=function(t){return t instanceof RangeError||t.message===Wu.STACK_OVERFLOW};var Zu={};Object.defineProperty(Zu,"__esModule",{value:!0}),Zu.circularDependencyToException=Zu.listMetadataForTarget=Zu.listRegisteredBindingsForServiceIdentifier=Zu.getServiceIdentifierAsString=Zu.getFunctionName=void 0;var qu=Fu;function Xu(t){return"function"==typeof t?t.name:"symbol"==typeof t?t.toString():t}function Yu(t,e){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===e||Yu(t.parentRequest,e))}function Ku(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}Zu.getServiceIdentifierAsString=Xu,Zu.listRegisteredBindingsForServiceIdentifier=function(t,e,n){var r="",i=n(t,e);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(t){var e="Object";null!==t.implementationType&&(e=Ku(t.implementationType)),r=r+"\n "+e,t.constraint.metaData&&(r=r+" - "+t.constraint.metaData)}))),r},Zu.circularDependencyToException=function t(e){e.childRequests.forEach((function(e){if(Yu(e,e.serviceIdentifier)){var n=function(t){var e=function t(e,n){void 0===n&&(n=[]);var r=Xu(e.serviceIdentifier);return n.push(r),null!==e.parentRequest?t(e.parentRequest,n):n}(t);return e.reverse().join(" --\x3e ")}(e);throw new Error(qu.CIRCULAR_DEPENDENCY+" "+n)}t(e)}))},Zu.listMetadataForTarget=function(t,e){if(e.isTagged()||e.isNamed()){var n="",r=e.getNamedTag(),i=e.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(t){n+=t.toString()+"\n"}))," "+t+"\n "+t+" - "+n}return" "+t},Zu.getFunctionName=Ku;var Qu={};Object.defineProperty(Qu,"__esModule",{value:!0}),Qu.Context=void 0;var Ju=Ru,$u=function(){function t(t){this.id=Ju.id(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();Qu.Context=$u;var tl={};Object.defineProperty(tl,"__esModule",{value:!0}),tl.Metadata=void 0;var el=Mu,nl=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===el.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();tl.Metadata=nl;var rl={};Object.defineProperty(rl,"__esModule",{value:!0}),rl.Plan=void 0;var il=function(t,e){this.parentContext=t,this.rootRequest=e};rl.Plan=il;var ol={},al={},sl={};Object.defineProperty(sl,"__esModule",{value:!0}),sl.tagProperty=sl.tagParameter=sl.decorate=void 0;var ul=Fu,ll=Mu;function cl(t,e,n,r,i){var o={},a="number"==typeof i,s=void 0!==i&&a?i.toString():n;if(a&&void 0!==n)throw new Error(ul.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(o=Reflect.getMetadata(t,e));var u=o[s];if(Array.isArray(u))for(var l=0,c=u;l<c.length;l++){var h=c[l];if(h.key===r.key)throw new Error(ul.DUPLICATED_METADATA+" "+h.key.toString())}else u=[];u.push(r),o[s]=u,Reflect.defineMetadata(t,o,e)}function hl(t,e){Reflect.decorate(t,e)}function pl(t,e){return function(n,r){e(n,r,t)}}sl.tagParameter=function(t,e,n,r){cl(ll.TAGGED,t,e,r,n)},sl.tagProperty=function(t,e,n){cl(ll.TAGGED_PROP,t.constructor,e,n)},sl.decorate=function(t,e,n){"number"==typeof n?hl([pl(n,t)],e):"string"==typeof n?Reflect.decorate([t],e,n):hl([t],e)},Object.defineProperty(al,"__esModule",{value:!0}),al.inject=al.LazyServiceIdentifer=void 0;var fl=Fu,dl=Mu,vl=tl,ml=sl,yl=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();al.LazyServiceIdentifer=yl,al.inject=function(t){return function(e,n,r){if(void 0===t)throw new Error(fl.UNDEFINED_INJECT_ANNOTATION(e.name));var i=new vl.Metadata(dl.INJECT_TAG,t);"number"==typeof r?ml.tagParameter(e,n,r,i):ml.tagProperty(e,n,i)}};var gl={},_l={};Object.defineProperty(_l,"__esModule",{value:!0}),_l.QueryableString=void 0;var xl=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e,n=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();_l.QueryableString=xl,Object.defineProperty(gl,"__esModule",{value:!0}),gl.Target=void 0;var bl=Mu,wl=Ru,Sl=tl,El=_l,Al=function(){function t(t,e,n,r){this.id=wl.id(),this.type=t,this.serviceIdentifier=n,this.name=new El.QueryableString(e||""),this.metadata=new Array;var i=null;"string"==typeof r?i=new Sl.Metadata(bl.NAMED_TAG,r):r instanceof Sl.Metadata&&(i=r),null!==i&&this.metadata.push(i)}return t.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++){if(n[e].key===t)return!0}return!1},t.prototype.isArray=function(){return this.hasTag(bl.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(bl.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(bl.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some((function(t){return bl.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))}))},t.prototype.isOptional=function(){return this.matchesTag(bl.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(t){return t.key===bl.NAMED_TAG}))[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(t){return bl.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))})):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(bl.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(n){for(var r=0,i=e.metadata;r<i.length;r++){var o=i[r];if(o.key===t&&o.value===n)return!0}return!1}},t}();gl.Target=Al,function(t){var e=D&&D.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0;var n=al,r=Fu,i=Lu,o=Mu,a=Zu;Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return a.getFunctionName}});var s=gl;function u(t,n,i,o){var a=t.getConstructorMetadata(i),s=a.compilerGeneratedMetadata;if(void 0===s){var u=r.MISSING_INJECTABLE_ANNOTATION+" "+n+".";throw new Error(u)}var h=a.userGeneratedMetadata,p=Object.keys(h),f=0===i.length&&p.length>0,d=p.length>i.length,v=function(t,e,n,r,i){for(var o=[],a=0;a<i;a++){var s=l(a,t,e,n,r);null!==s&&o.push(s)}return o}(o,n,s,h,f||d?p.length:i.length),m=c(t,i);return e(e([],v),m)}function l(t,e,o,a,u){var l=u[t.toString()]||[],c=h(l),p=!0!==c.unmanaged,f=a[t],d=c.inject||c.multiInject;if((f=d||f)instanceof n.LazyServiceIdentifer&&(f=f.unwrap()),p){if(!e&&(f===Object||f===Function||void 0===f)){var v=r.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+o+".";throw new Error(v)}var m=new s.Target(i.TargetTypeEnum.ConstructorArgument,c.targetName,f);return m.metadata=l,m}return null}function c(t,n){for(var r=t.getPropertiesMetadata(n),o=[],a=0,u=Object.keys(r);a<u.length;a++){var l=u[a],p=r[l],f=h(r[l]),d=f.targetName||l,v=f.inject||f.multiInject,m=new s.Target(i.TargetTypeEnum.ClassProperty,d,v);m.metadata=p,o.push(m)}var y=Object.getPrototypeOf(n.prototype).constructor;if(y!==Object){var g=c(t,y);o=e(e([],o),g)}return o}function h(t){var e={};return t.forEach((function(t){e[t.key.toString()]=t.value})),{inject:e[o.INJECT_TAG],multiInject:e[o.MULTI_INJECT_TAG],targetName:e[o.NAME_TAG],unmanaged:e[o.UNMANAGED_TAG]}}t.getDependencies=function(t,e){return u(t,a.getFunctionName(e),e,!1)},t.getBaseClassDependencyCount=function t(e,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=u(e,a.getFunctionName(r),r,!0),s=i.map((function(t){return t.metadata.filter((function(t){return t.key===o.UNMANAGED_TAG}))})),l=[].concat.apply([],s).length,c=i.length-l;return c>0?c:t(e,r)}return 0}}(ol);var Tl={};Object.defineProperty(Tl,"__esModule",{value:!0}),Tl.Request=void 0;var Cl=Ru,kl=function(){function t(t,e,n,r,i){this.id=Cl.id(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,r){var i=new t(e,this.parentContext,this,n,r);return this.childRequests.push(i),i},t}();Tl.Request=kl,Object.defineProperty(Vu,"__esModule",{value:!0}),Vu.getBindingDictionary=Vu.createMockRequest=Vu.plan=void 0;var Ml=Gu,Il=Fu,Pl=Lu,Ll=Mu,Rl=Hu,Ol=Zu,Dl=Qu,Nl=tl,zl=rl,Fl=ol,Bl=Tl,Ul=gl;function jl(t){return t._bindingDictionary}function Vl(t,e,n,r,i){var o=Hl(n.container,i.serviceIdentifier),a=[];return o.length===Ml.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&t.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),o=Hl(n.container,i.serviceIdentifier)),a=e?o:o.filter((function(t){var e=new Bl.Request(t.serviceIdentifier,n,r,t,i);return t.constraint(e)})),function(t,e,n,r){switch(e.length){case Ml.BindingCount.NoBindingsAvailable:if(n.isOptional())return e;var i=Ol.getServiceIdentifierAsString(t),o=Il.NOT_REGISTERED;throw o+=Ol.listMetadataForTarget(i,n),o+=Ol.listRegisteredBindingsForServiceIdentifier(r,i,Hl),new Error(o);case Ml.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return e;case Ml.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return e;i=Ol.getServiceIdentifierAsString(t),o=Il.AMBIGUOUS_MATCH+" "+i;throw o+=Ol.listRegisteredBindingsForServiceIdentifier(r,i,Hl),new Error(o)}}(i.serviceIdentifier,a,i,n.container),a}function Gl(t,e,n,r,i,o){var a,s;if(null===i){a=Vl(t,e,r,null,o),s=new Bl.Request(n,r,null,a,o);var u=new zl.Plan(r,s);r.addPlan(u)}else a=Vl(t,e,r,i,o),s=i.addChildRequest(o.serviceIdentifier,a,o);a.forEach((function(e){var n=null;if(o.isArray())n=s.addChildRequest(e.serviceIdentifier,e,o);else{if(e.cache)return;n=s}if(e.type===Pl.BindingTypeEnum.Instance&&null!==e.implementationType){var i=Fl.getDependencies(t,e.implementationType);if(!r.container.options.skipBaseClassChecks){var a=Fl.getBaseClassDependencyCount(t,e.implementationType);if(i.length<a){var u=Il.ARGUMENTS_LENGTH_MISMATCH(Fl.getFunctionName(e.implementationType));throw new Error(u)}}i.forEach((function(e){Gl(t,!1,e.serviceIdentifier,r,n,e)}))}}))}function Hl(t,e){var n=[],r=jl(t);return r.hasKey(e)?n=r.get(e):null!==t.parent&&(n=Hl(t.parent,e)),n}Vu.getBindingDictionary=jl,Vu.plan=function(t,e,n,r,i,o,a,s){void 0===s&&(s=!1);var u=new Dl.Context(e),l=function(t,e,n,r,i,o){var a=t?Ll.MULTI_INJECT_TAG:Ll.INJECT_TAG,s=new Nl.Metadata(a,n),u=new Ul.Target(e,r,n,s);if(void 0!==i){var l=new Nl.Metadata(i,o);u.metadata.push(l)}return u}(n,r,i,"",o,a);try{return Gl(t,s,i,u,null,l),u}catch(t){throw Rl.isStackOverflowExeption(t)&&u.plan&&Ol.circularDependencyToException(u.plan.rootRequest),t}},Vu.createMockRequest=function(t,e,n,r){var i=new Ul.Target(Pl.TargetTypeEnum.Variable,"",e,new Nl.Metadata(n,r)),o=new Dl.Context(t);return new Bl.Request(e,o,null,[],i)};var Wl={},Zl={},ql=D&&D.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(Zl,"__esModule",{value:!0}),Zl.resolveInstance=void 0;var Xl=Fu,Yl=Lu,Kl=Mu;Zl.resolveInstance=function(t,e,n){var r,i,o=null;if(e.length>0){var a=e.filter((function(t){return null!==t.target&&t.target.type===Yl.TargetTypeEnum.ConstructorArgument})).map(n);i=a,o=function(t,e,n){var r=e.filter((function(t){return null!==t.target&&t.target.type===Yl.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(e,n){var r;r=e.target.name.value();var o=i[n];t[r]=o})),t}(o=new((r=t).bind.apply(r,ql([void 0],i))),e,n)}else o=new t;return function(t,e){if(Reflect.hasMetadata(Kl.POST_CONSTRUCT,t)){var n=Reflect.getMetadata(Kl.POST_CONSTRUCT,t);try{e[n.value]()}catch(e){throw new Error(Xl.POST_CONSTRUCT_ERROR(t.name,e.message))}}}(t,o),o},Object.defineProperty(Wl,"__esModule",{value:!0}),Wl.resolve=void 0;var Ql=Fu,Jl=Lu,$l=Hu,tc=Zu,ec=Zl,nc=function(t,e,n){try{return n()}catch(n){throw $l.isStackOverflowExeption(n)?new Error(Ql.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString())):n}},rc=function(t){return function(e){e.parentContext.setCurrentRequest(e);var n=e.bindings,r=e.childRequests,i=e.target&&e.target.isArray(),o=!(e.parentRequest&&e.parentRequest.target&&e.target&&e.parentRequest.target.matchesArray(e.target.serviceIdentifier));if(i&&o)return r.map((function(e){return rc(t)(e)}));var a=null;if(!e.target.isOptional()||0!==n.length){var s=n[0],u=s.scope===Jl.BindingScopeEnum.Singleton,l=s.scope===Jl.BindingScopeEnum.Request;if(u&&s.activated)return s.cache;if(l&&null!==t&&t.has(s.id))return t.get(s.id);if(s.type===Jl.BindingTypeEnum.ConstantValue)a=s.cache,s.activated=!0;else if(s.type===Jl.BindingTypeEnum.Function)a=s.cache,s.activated=!0;else if(s.type===Jl.BindingTypeEnum.Constructor)a=s.implementationType;else if(s.type===Jl.BindingTypeEnum.DynamicValue&&null!==s.dynamicValue)a=nc("toDynamicValue",s.serviceIdentifier,(function(){return s.dynamicValue(e.parentContext)}));else if(s.type===Jl.BindingTypeEnum.Factory&&null!==s.factory)a=nc("toFactory",s.serviceIdentifier,(function(){return s.factory(e.parentContext)}));else if(s.type===Jl.BindingTypeEnum.Provider&&null!==s.provider)a=nc("toProvider",s.serviceIdentifier,(function(){return s.provider(e.parentContext)}));else{if(s.type!==Jl.BindingTypeEnum.Instance||null===s.implementationType){var c=tc.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(Ql.INVALID_BINDING_TYPE+" "+c)}a=ec.resolveInstance(s.implementationType,r,rc(t))}return"function"==typeof s.onActivation&&(a=s.onActivation(e.parentContext,a)),u&&(s.cache=a,s.activated=!0),l&&null!==t&&!t.has(s.id)&&t.set(s.id,a),a}}};Wl.resolve=function(t){return rc(t.plan.rootRequest.requestScope)(t.plan.rootRequest)};var ic={},oc={},ac={},sc={},uc={},lc={},cc={};Object.defineProperty(cc,"__esModule",{value:!0}),cc.typeConstraint=cc.namedConstraint=cc.taggedConstraint=cc.traverseAncerstors=void 0;var hc=Mu,pc=tl,fc=function(t,e){var n=t.parentRequest;return null!==n&&(!!e(n)||fc(n,e))};cc.traverseAncerstors=fc;var dc=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new pc.Metadata(t,e),n}};cc.taggedConstraint=dc;var vc=dc(hc.NAMED_TAG);cc.namedConstraint=vc;cc.typeConstraint=function(t){return function(e){var n=null;if(null!==e){if(n=e.bindings[0],"string"==typeof t)return n.serviceIdentifier===t;var r=e.bindings[0].implementationType;return t===r}return!1}},Object.defineProperty(lc,"__esModule",{value:!0}),lc.BindingWhenSyntax=void 0;var mc=uc,yc=cc,gc=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new mc.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=yc.namedConstraint(t),new mc.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new mc.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=yc.taggedConstraint(t)(e),new mc.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return yc.typeConstraint(t)(e.parentRequest)},new mc.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return yc.namedConstraint(t)(e.parentRequest)},new mc.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){return yc.taggedConstraint(t)(e)(n.parentRequest)},new mc.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return yc.traverseAncerstors(e,yc.typeConstraint(t))},new mc.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!yc.traverseAncerstors(e,yc.typeConstraint(t))},new mc.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return yc.traverseAncerstors(e,yc.namedConstraint(t))},new mc.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!yc.traverseAncerstors(e,yc.namedConstraint(t))},new mc.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return yc.traverseAncerstors(n,yc.taggedConstraint(t)(e))},new mc.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return!yc.traverseAncerstors(n,yc.taggedConstraint(t)(e))},new mc.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return yc.traverseAncerstors(e,t)},new mc.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!yc.traverseAncerstors(e,t)},new mc.BindingOnSyntax(this._binding)},t}();lc.BindingWhenSyntax=gc,Object.defineProperty(uc,"__esModule",{value:!0}),uc.BindingOnSyntax=void 0;var _c=lc,xc=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new _c.BindingWhenSyntax(this._binding)},t}();uc.BindingOnSyntax=xc,Object.defineProperty(sc,"__esModule",{value:!0}),sc.BindingWhenOnSyntax=void 0;var bc=uc,wc=lc,Sc=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new wc.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new bc.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();sc.BindingWhenOnSyntax=Sc,Object.defineProperty(ac,"__esModule",{value:!0}),ac.BindingInSyntax=void 0;var Ec=Lu,Ac=sc,Tc=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=Ec.BindingScopeEnum.Request,new Ac.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=Ec.BindingScopeEnum.Singleton,new Ac.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=Ec.BindingScopeEnum.Transient,new Ac.BindingWhenOnSyntax(this._binding)},t}();ac.BindingInSyntax=Tc,Object.defineProperty(oc,"__esModule",{value:!0}),oc.BindingInWhenOnSyntax=void 0;var Cc=ac,kc=uc,Mc=lc,Ic=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new Mc.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new kc.BindingOnSyntax(this._binding),this._bindingInSyntax=new Cc.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();oc.BindingInWhenOnSyntax=Ic,Object.defineProperty(ic,"__esModule",{value:!0}),ic.BindingToSyntax=void 0;var Pc=Fu,Lc=Lu,Rc=oc,Oc=sc,Dc=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=Lc.BindingTypeEnum.Instance,this._binding.implementationType=t,new Rc.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+Pc.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=Lc.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Lc.BindingScopeEnum.Singleton,new Oc.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=Lc.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new Rc.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=Lc.BindingTypeEnum.Constructor,this._binding.implementationType=t,this._binding.scope=Lc.BindingScopeEnum.Singleton,new Oc.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=Lc.BindingTypeEnum.Factory,this._binding.factory=t,this._binding.scope=Lc.BindingScopeEnum.Singleton,new Oc.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!=typeof t)throw new Error(Pc.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=Lc.BindingTypeEnum.Function,this._binding.scope=Lc.BindingScopeEnum.Singleton,e},t.prototype.toAutoFactory=function(t){return this._binding.type=Lc.BindingTypeEnum.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},this._binding.scope=Lc.BindingScopeEnum.Singleton,new Oc.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=Lc.BindingTypeEnum.Provider,this._binding.provider=t,this._binding.scope=Lc.BindingScopeEnum.Singleton,new Oc.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue((function(e){return e.container.get(t)}))},t}();ic.BindingToSyntax=Dc;var Nc={};Object.defineProperty(Nc,"__esModule",{value:!0}),Nc.ContainerSnapshot=void 0;var zc=function(){function t(){}return t.of=function(e,n){var r=new t;return r.bindings=e,r.middleware=n,r},t}();Nc.ContainerSnapshot=zc;var Fc={};Object.defineProperty(Fc,"__esModule",{value:!0}),Fc.Lookup=void 0;var Bc=Fu,Uc=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null==t)throw new Error(Bc.NULL_ARGUMENT);if(null==e)throw new Error(Bc.NULL_ARGUMENT);var n=this._map.get(t);void 0!==n?(n.push(e),this._map.set(t,n)):this._map.set(t,[e])},t.prototype.get=function(t){if(null==t)throw new Error(Bc.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw new Error(Bc.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null==t)throw new Error(Bc.NULL_ARGUMENT);if(!this._map.delete(t))throw new Error(Bc.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach((function(n,r){var i=n.filter((function(e){return!t(e)}));i.length>0?e._map.set(r,i):e._map.delete(r)}))},t.prototype.hasKey=function(t){if(null==t)throw new Error(Bc.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach((function(t,n){t.forEach((function(t){return e.add(n,t.clone())}))})),e},t.prototype.traverse=function(t){this._map.forEach((function(e,n){t(n,e)}))},t}();Fc.Lookup=Uc;var jc=D&&D.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Vc=D&&D.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Gc=D&&D.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(Iu,"__esModule",{value:!0}),Iu.Container=void 0;var Hc=Pu,Wc=Fu,Zc=Lu,qc=Mu,Xc=Bu,Yc=Vu,Kc=Wl,Qc=ic,Jc=Ru,$c=Zu,th=Nc,eh=Fc,nh=function(){function t(t){this._appliedMiddleware=[];var e=t||{};if("object"!=typeof e)throw new Error(""+Wc.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=Zc.BindingScopeEnum.Transient;else if(e.defaultScope!==Zc.BindingScopeEnum.Singleton&&e.defaultScope!==Zc.BindingScopeEnum.Transient&&e.defaultScope!==Zc.BindingScopeEnum.Request)throw new Error(""+Wc.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!=typeof e.autoBindInjectable)throw new Error(""+Wc.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!=typeof e.skipBaseClassChecks)throw new Error(""+Wc.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.id=Jc.id(),this._bindingDictionary=new eh.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Xc.MetadataReader}return t.merge=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new t,a=Gc([e,n],r).map((function(t){return Yc.getBindingDictionary(t)})),s=Yc.getBindingDictionary(o);return a.forEach((function(t){var e;e=s,t.traverse((function(t,n){n.forEach((function(t){e.add(t.serviceIdentifier,t.clone())}))}))})),o},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=t;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return jc(this,void 0,void 0,(function(){var e,n,r,i,o;return Vc(this,(function(a){switch(a.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,r=t,a.label=1;case 1:return n<r.length?(i=r[n],o=e(i.id),[4,i.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e){var n,r=(n=e.id,function(t){return t.moduleId===n});t._bindingDictionary.removeByCondition(r)}))},t.prototype.bind=function(t){var e=this.options.defaultScope||Zc.BindingScopeEnum.Transient,n=new Hc.Binding(t,e);return this._bindingDictionary.add(t,n),new Qc.BindingToSyntax(n)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(Wc.CANNOT_UNBIND+" "+$c.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new eh.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,qc.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,n){var r=!1;if(this._bindingDictionary.hasKey(t)){var i=this._bindingDictionary.get(t),o=Yc.createMockRequest(this,t,e,n);r=i.some((function(t){return t.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,e,n)),r},t.prototype.snapshot=function(){this._snapshots.push(th.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw new Error(Wc.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var n=new t(e||this.options);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce((function(t,e){return e(t)}),n)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,Zc.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,n){return this._get(!1,!1,Zc.TargetTypeEnum.Variable,t,e,n)},t.prototype.getNamed=function(t,e){return this.getTagged(t,qc.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,Zc.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,n){return this._get(!1,!0,Zc.TargetTypeEnum.Variable,t,e,n)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,qc.NAMED_TAG,e)},t.prototype.resolve=function(t){var e=this.createChild();return e.bind(t).toSelf(),this._appliedMiddleware.forEach((function(t){e.applyMiddleware(t)})),e.get(t)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e},n=function(n){return function(r){var i=t.rebind.bind(t)(r);return e(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=t.bind.bind(t)(n);return e(r,i),r}),isboundFunction:function(e){return t.isBound.bind(t)(e)},rebindFunction:n(r),unbindFunction:function(e){t.unbind.bind(t)(e)}};var i}},t.prototype._get=function(t,e,n,r,i,o){var a=null,s={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(s)))throw new Error(Wc.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(s);return a},t.prototype._planAndResolve=function(){var t=this;return function(e){var n=Yc.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return n=e.contextInterceptor(n),Kc.resolve(n)}},t}();Iu.Container=nh;var rh={};Object.defineProperty(rh,"__esModule",{value:!0}),rh.AsyncContainerModule=rh.ContainerModule=void 0;var ih=Ru,oh=function(t){this.id=ih.id(),this.registry=t};rh.ContainerModule=oh;var ah=function(t){this.id=ih.id(),this.registry=t};rh.AsyncContainerModule=ah;var sh={};Object.defineProperty(sh,"__esModule",{value:!0}),sh.injectable=void 0;var uh=Fu,lh=Mu;sh.injectable=function(){return function(t){if(Reflect.hasOwnMetadata(lh.PARAM_TYPES,t))throw new Error(uh.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(lh.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(lh.PARAM_TYPES,e,t),t}};var ch={};Object.defineProperty(ch,"__esModule",{value:!0}),ch.tagged=void 0;var hh=tl,ph=sl;ch.tagged=function(t,e){return function(n,r,i){var o=new hh.Metadata(t,e);"number"==typeof i?ph.tagParameter(n,r,i,o):ph.tagProperty(n,r,o)}};var fh={};Object.defineProperty(fh,"__esModule",{value:!0}),fh.named=void 0;var dh=Mu,vh=tl,mh=sl;fh.named=function(t){return function(e,n,r){var i=new vh.Metadata(dh.NAMED_TAG,t);"number"==typeof r?mh.tagParameter(e,n,r,i):mh.tagProperty(e,n,i)}};var yh={};Object.defineProperty(yh,"__esModule",{value:!0}),yh.optional=void 0;var gh=Mu,_h=tl,xh=sl;yh.optional=function(){return function(t,e,n){var r=new _h.Metadata(gh.OPTIONAL_TAG,!0);"number"==typeof n?xh.tagParameter(t,e,n,r):xh.tagProperty(t,e,r)}};var bh={};Object.defineProperty(bh,"__esModule",{value:!0}),bh.unmanaged=void 0;var wh=Mu,Sh=tl,Eh=sl;bh.unmanaged=function(){return function(t,e,n){var r=new Sh.Metadata(wh.UNMANAGED_TAG,!0);Eh.tagParameter(t,e,n,r)}};var Ah={};Object.defineProperty(Ah,"__esModule",{value:!0}),Ah.multiInject=void 0;var Th=Mu,Ch=tl,kh=sl;Ah.multiInject=function(t){return function(e,n,r){var i=new Ch.Metadata(Th.MULTI_INJECT_TAG,t);"number"==typeof r?kh.tagParameter(e,n,r,i):kh.tagProperty(e,n,i)}};var Mh={};Object.defineProperty(Mh,"__esModule",{value:!0}),Mh.targetName=void 0;var Ih=Mu,Ph=tl,Lh=sl;Mh.targetName=function(t){return function(e,n,r){var i=new Ph.Metadata(Ih.NAME_TAG,t);Lh.tagParameter(e,n,r,i)}};var Rh={};Object.defineProperty(Rh,"__esModule",{value:!0}),Rh.postConstruct=void 0;var Oh=Fu,Dh=Mu,Nh=tl;Rh.postConstruct=function(){return function(t,e,n){var r=new Nh.Metadata(Dh.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(Dh.POST_CONSTRUCT,t.constructor))throw new Error(Oh.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(Dh.POST_CONSTRUCT,r,t.constructor)}};var zh={};Object.defineProperty(zh,"__esModule",{value:!0}),zh.multiBindToService=void 0;zh.multiBindToService=function(t){return function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return t.bind(n).toService(e)}))}}},function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=t.getServiceIdentifierAsString=t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=t.decorate=t.id=t.MetadataReader=t.postConstruct=t.targetName=t.multiInject=t.unmanaged=t.optional=t.LazyServiceIdentifer=t.inject=t.named=t.tagged=t.injectable=t.ContainerModule=t.AsyncContainerModule=t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=t.Container=t.METADATA_KEY=void 0;var e=Mu;t.METADATA_KEY=e;var n=Iu;Object.defineProperty(t,"Container",{enumerable:!0,get:function(){return n.Container}});var r=Lu;Object.defineProperty(t,"BindingScopeEnum",{enumerable:!0,get:function(){return r.BindingScopeEnum}}),Object.defineProperty(t,"BindingTypeEnum",{enumerable:!0,get:function(){return r.BindingTypeEnum}}),Object.defineProperty(t,"TargetTypeEnum",{enumerable:!0,get:function(){return r.TargetTypeEnum}});var i=rh;Object.defineProperty(t,"AsyncContainerModule",{enumerable:!0,get:function(){return i.AsyncContainerModule}}),Object.defineProperty(t,"ContainerModule",{enumerable:!0,get:function(){return i.ContainerModule}});var o=sh;Object.defineProperty(t,"injectable",{enumerable:!0,get:function(){return o.injectable}});var a=ch;Object.defineProperty(t,"tagged",{enumerable:!0,get:function(){return a.tagged}});var s=fh;Object.defineProperty(t,"named",{enumerable:!0,get:function(){return s.named}});var u=al;Object.defineProperty(t,"inject",{enumerable:!0,get:function(){return u.inject}}),Object.defineProperty(t,"LazyServiceIdentifer",{enumerable:!0,get:function(){return u.LazyServiceIdentifer}});var l=yh;Object.defineProperty(t,"optional",{enumerable:!0,get:function(){return l.optional}});var c=bh;Object.defineProperty(t,"unmanaged",{enumerable:!0,get:function(){return c.unmanaged}});var h=Ah;Object.defineProperty(t,"multiInject",{enumerable:!0,get:function(){return h.multiInject}});var p=Mh;Object.defineProperty(t,"targetName",{enumerable:!0,get:function(){return p.targetName}});var f=Rh;Object.defineProperty(t,"postConstruct",{enumerable:!0,get:function(){return f.postConstruct}});var d=Bu;Object.defineProperty(t,"MetadataReader",{enumerable:!0,get:function(){return d.MetadataReader}});var v=Ru;Object.defineProperty(t,"id",{enumerable:!0,get:function(){return v.id}});var m=sl;Object.defineProperty(t,"decorate",{enumerable:!0,get:function(){return m.decorate}});var y=cc;Object.defineProperty(t,"traverseAncerstors",{enumerable:!0,get:function(){return y.traverseAncerstors}}),Object.defineProperty(t,"taggedConstraint",{enumerable:!0,get:function(){return y.taggedConstraint}}),Object.defineProperty(t,"namedConstraint",{enumerable:!0,get:function(){return y.namedConstraint}}),Object.defineProperty(t,"typeConstraint",{enumerable:!0,get:function(){return y.typeConstraint}});var g=Zu;Object.defineProperty(t,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return g.getServiceIdentifierAsString}});var _=zh;Object.defineProperty(t,"multiBindToService",{enumerable:!0,get:function(){return _.multiBindToService}})}(ku);var Fh={},Bh={};Object.defineProperty(Bh,"__esModule",{value:!0});var Uh=Symbol.for("INJECTION");function jh(t,e,n,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return r&&!Reflect.hasMetadata(Uh,this,e)&&Reflect.defineMetadata(Uh,n(),this,e),Reflect.hasMetadata(Uh,this,e)?Reflect.getMetadata(Uh,this,e):n()},set:function(t){Reflect.defineMetadata(Uh,t,this,e)}})}Bh.makePropertyInjectDecorator=function(t,e){return function(n){return function(r,i){jh(r,i,(function(){return t.get(n)}),e)}}},Bh.makePropertyInjectNamedDecorator=function(t,e){return function(n,r){return function(i,o){jh(i,o,(function(){return t.getNamed(n,r)}),e)}}},Bh.makePropertyInjectTaggedDecorator=function(t,e){return function(n,r,i){return function(o,a){jh(o,a,(function(){return t.getTagged(n,r,i)}),e)}}},Bh.makePropertyMultiInjectDecorator=function(t,e){return function(n){return function(r,i){jh(r,i,(function(){return t.getAll(n)}),e)}}},Object.defineProperty(Fh,"__esModule",{value:!0});var Vh=Bh;var Gh=Fh.default=function(t,e){return void 0===e&&(e=!0),{lazyInject:Vh.makePropertyInjectDecorator(t,e),lazyInjectNamed:Vh.makePropertyInjectNamedDecorator(t,e),lazyInjectTagged:Vh.makePropertyInjectTaggedDecorator(t,e),lazyMultiInject:Vh.makePropertyMultiInjectDecorator(t,e)}},Hh={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Wh={exports:{}};Wh.exports=qh,Wh.exports.default=qh;var Zh=1e20;function qh(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer,u="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;u?this.canvas=my.createOffscreenCanvas(a,a,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=u?Math.round(a/2*1):Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Xh(t,e,n,r,i,o){for(var a=0;a<e;a++)Yh(t,a,e,n,r,i,o);for(var s=0;s<n;s++)Yh(t,s*e,1,e,r,i,o)}function Yh(t,e,n,r,i,o,a){var s,u,l,c;for(o[0]=0,a[0]=-Zh,a[1]=Zh,s=0;s<r;s++)i[s]=t[e+s*n];for(s=1,u=0,l=0;s<r;s++){do{c=o[u],l=(i[s]-i[c]+s*s-c*c)/(s-c)/2}while(l<=a[u]&&--u>-1);o[++u]=s,a[u]=l,a[u+1]=Zh}for(s=0,u=0;s<r;s++){for(;a[u+1]<s;)u++;c=o[u],t[e+s*n]=i[c]+(s-c)*(s-c)}}qh.prototype._draw=function(t,e){var n,r,i,o,a,s,u,l,c,h=this.ctx.measureText(t),p=h.width,f=2*this.buffer;e&&this.useMetrics?(a=Math.floor(h.actualBoundingBoxAscent),l=this.buffer+Math.ceil(h.actualBoundingBoxAscent),s=this.buffer,u=this.buffer,n=(r=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+f,i=(o=Math.min(this.size-s,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+f,this.ctx.textBaseline="alphabetic"):(n=r=this.size,i=o=this.size,a=19*this.fontSize/24,s=u=0,l=this.middle,this.ctx.textBaseline="middle"),r&&o&&(this.ctx.clearRect(u,s,r,o),this.ctx.fillText(t,this.buffer,l),c=this.ctx.getImageData(u,s,r,o));var d=new Uint8ClampedArray(n*i);return function(t,e,n,r,i,o,a){o.fill(Zh,0,e*n),a.fill(0,0,e*n);for(var s=(e-r)/2,u=0;u<i;u++)for(var l=0;l<r;l++){var c=(u+s)*e+l+s,h=t.data[4*(u*r+l)+3]/255;if(1===h)o[c]=0,a[c]=Zh;else if(0===h)o[c]=Zh,a[c]=0;else{var p=Math.max(0,.5-h),f=Math.max(0,h-.5);o[c]=p*p,a[c]=f*f}}}(c,n,i,r,o,this.gridOuter,this.gridInner),Xh(this.gridOuter,n,i,this.f,this.v,this.z),Xh(this.gridInner,n,i,this.f,this.v,this.z),function(t,e,n,r,i,o,a){for(var s=0;s<e*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);t[s]=Math.round(255-255*(u/o+a))}}(d,n,i,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:d,metrics:{width:r,height:o,sdfWidth:n,sdfHeight:i,top:a,left:0,advance:p}}},qh.prototype.draw=function(t){return this._draw(t,!1).data},qh.prototype.drawWithMetrics=function(t){return this._draw(t,!0)};var Kh=Wh.exports;function Qh(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Jh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Jh(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Jh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var $h;function tp(t,e,n){var r,i=Qh(e);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;t[a.id]=It(It({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(t){i.e(t)}finally{i.f()}}function ep(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function np(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return rp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rp(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function rp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ip(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var op=function(){for(var t=[],e=32;e<128;e++)t.push(String.fromCharCode(e));return t}();function ap(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="black",t.textBaseline="middle"}function sp(t,e){for(var n=0;n<t.length;n++)e.data[4*n+3]=t[n]}var up,lp=ku.injectable()($h=function(t){Oe(n,t);var e=ip(n);function n(){var t;Ee(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return kt(De(t=e.call.apply(e,[this].concat(i))),"fontAtlas",void 0),kt(De(t),"iconFontMap",void 0),kt(De(t),"iconFontGlyphs",{}),kt(De(t),"fontOptions",void 0),kt(De(t),"key",void 0),kt(De(t),"cache",new Mi(3)),t}return Te(n,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping||{}}},{key:"getCanvasByKey",value:function(t){var e=this.cache.get(t);return e&&e.data}},{key:"getMappingByKey",value:function(t){var e=this.cache.get(t);return e&&e.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:op,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var e=this;t.forEach((function(t){e.iconFontGlyphs[t.name]=t.unicode}))}},{key:"addIconFont",value:function(t,e){this.iconFontMap.set(t,e)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=It(It({},this.fontOptions),t),this.key=this.getKey();var e=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==e.length){var r=this.generateFontAtlas(this.key,e,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(t,e){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(t,"';\n            src: url('").concat(e,"') format('woff2'),\n            url('").concat(e,"') format('woff'),\n            url('").concat(e,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then((function(){n.emit("fontloaded",{fontFamily:t})}))}catch(t){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(t)}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,e,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,l=r.radius,c=r.cutoff,h=r.iconfont,p=n&&n.data;p||((p=tr.document.createElement("canvas")).width=1024);var f=p.getContext("2d",{willReadFrequently:!0});ap(f,i,a,o);var d=function(t){var e=t.characterSet,n=t.getFontWidth,r=t.fontHeight,i=t.buffer,o=t.maxCanvasWidth,a=t.mapping,s=void 0===a?{}:a,u=t.xOffset,l=void 0===u?0:u,c=t.yOffset,h=void 0===c?0:c,p=0,f=l;Array.from(e).forEach((function(t,e){if(!s[t]){var r=n(t,e);f+30>o&&(f=0,p++),s[t]={x:f,y:h+30*p,width:30,height:30,advance:r},f+=30}}));var d=r+2*i;return{mapping:s,xOffset:f,yOffset:h+p*d,canvasHeight:ep(h+(p+1)*d)}}(It({getFontWidth:function(t){return f.measureText(t).width},fontHeight:1*a,buffer:s,characterSet:e,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),v=d.mapping,m=d.canvasHeight,y=d.xOffset,g=d.yOffset,_=f.getImageData(0,0,p.width,p.height);if(p.height=m,f.putImageData(_,0,0),ap(f,i,a,o),u){var x,b=new Kh(a,s,l,c,i,o),w=f.getImageData(0,0,b.size,b.size),S=np(e);try{for(S.s();!(x=S.n()).done;){var E=x.value;if(h){var A=String.fromCharCode(parseInt(E.replace("&#x","").replace(";",""),16));sp(b.draw(A),w)}else sp(b.draw(E),w);f.putImageData(w,v[E].x,v[E].y)}}catch(t){S.e(t)}finally{S.f()}}else{var T,C=np(e);try{for(C.s();!(T=C.n()).done;){var k=T.value;f.fillText(k,v[k].x,v[k].y+1*a)}}catch(t){C.e(t)}finally{C.f()}}return{xOffset:y,yOffset:g,mapping:v,data:p,width:p.width,height:p.height}}},{key:"getKey",value:function(){var t=this.fontOptions,e=t.fontFamily,n=t.fontWeight;return"".concat(e,"_").concat(n)}},{key:"getNewChars",value:function(t,e){var n=this.cache.get(t);if(!n)return e;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(e).forEach((function(t){o.has(t)||r.push(t)})),r}}]),n}(Oi.exports.EventEmitter))||$h;function cp(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var hp,pp,fp,dp=ku.injectable()(up=function(t){Oe(r,t);var e,n=cp(r);function r(){var t;Ee(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return kt(De(t=n.call.apply(n,[this].concat(i))),"canvasHeight",128),kt(De(t),"texture",void 0),kt(De(t),"canvas",void 0),kt(De(t),"iconData",void 0),kt(De(t),"iconMap",void 0),kt(De(t),"ctx",void 0),kt(De(t),"loadingImageCount",0),t}return Te(r,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=tr.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:(e=Zt(Kt.mark((function t(e,n){var r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Image,this.loadingImageCount++,this.hasImage(e)?console.warn("Image Id already exists"):this.iconData.push({id:e,size:64}),this.updateIconMap(),t.next=6,this.loadImage(n);case 6:r=t.sent,(i=this.iconData.find((function(t){return t.id===e})))&&(i.image=r,i.width=r.width,i.height=r.height),this.update();case 10:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"addImageMini",value:function(t,e,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:64}),this.updateIconMap(),this.loadImageMini(e,i).then((function(e){o=e;var n=r.iconData.find((function(e){return e.id===t}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter((function(e){return e.id!==t})),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise((function(e,n){if(t instanceof HTMLImageElement)e(t);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e(r)},r.onerror=function(){n(new Error("Could not load image at "+t))},r.src=t instanceof File?URL.createObjectURL(t):t}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(e){var n=t.iconMap[e],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,l=void 0===u?64:u,c=Math.max(s,l)/64,h=l/c,p=s/c;o&&t.ctx.drawImage(o,r+(64-p)/2,i+(64-h)/2,p,h)}))}},{key:"updateIconMap",value:function(){var t=function(t,e,n){var r,i=0,o=0,a=0,s=[],u={},l=Qh(t);try{for(l.s();!(r=l.n()).done;){var c=r.value;if(!u[c.id]){var h=c.size;i+h+e>n&&(tp(u,s,o),i=0,o=a+o+e,a=0,s=[]),s.push({icon:c,xOffset:i}),i=i+h+e,a=Math.max(a,h)}}}catch(t){l.e(t)}finally{l.f()}return s.length>0&&tp(u,s,o),{mapping:u,canvasHeight:ep(a+o+e)}}(this.iconData,3,1024),e=t.mapping,n=t.canvasHeight;this.iconMap=e,this.canvasHeight=n}},{key:"loadImageMini",value:function(t,e){return new Promise((function(n,r){var i=e.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+t))},i.src=t}))}}]),r}(Oi.exports.EventEmitter))||up,vp=ku.injectable()(hp=function(){function t(){Ee(this,t),kt(this,"viewport",void 0),kt(this,"overridedViewProjectionMatrix",void 0),kt(this,"jitteredViewProjectionMatrix",void 0),kt(this,"jitteredProjectionMatrix",void 0),kt(this,"viewMatrixInverse",void 0),kt(this,"cameraPosition",void 0)}return Te(t,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=ia(),ua(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=$r(this.viewport.getCenter(),2);return[t[0],t[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,e){var n=va(ia(),[t,e,0]);this.jitteredProjectionMatrix=la(ia(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=la(ia(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),t}())||hp;function mp(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return yp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yp(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function yp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(t){t.TOPRIGHT="topright",t.TOPLEFT="topleft",t.BOTTOMRIGHT="bottomright",t.BOTTOMLEFT="bottomleft",t.TOPCENTER="topcenter",t.BOTTOMCENTER="bottomcenter",t.LEFTCENTER="leftcenter",t.RIGHTCENTER="rightcenter",t.LEFTTOP="lefttop",t.RIGHTTOP="righttop",t.LEFTBOTTOM="leftbottom",t.RIGHTBOTTOM="rightbottom"}(pp||(pp={}));var gp,_p,xp,bp,wp,Sp,Ep={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Ap=ku.injectable()(fp=function(){function t(){Ee(this,t),kt(this,"container",void 0),kt(this,"controlCorners",void 0),kt(this,"controlContainer",void 0),kt(this,"scene",void 0),kt(this,"mapsService",void 0),kt(this,"controls",[]),kt(this,"unAddControls",[])}return Te(t,[{key:"init",value:function(t,e){this.container=t.container,this.scene=e,this.mapsService=e.get(Hh.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,e){e.get(Hh.IMapService).map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find((function(e){return e.controlOption.name===t}))}},{key:"removeControl",value:function(t){var e=this.controls.indexOf(t);return e>-1&&this.controls.splice(e,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach((function(e){e.addTo(t.scene),t.controls.push(e)})),this.unAddControls=[]}},{key:"destroy",value:function(){var t,e=mp(this.controls);try{for(e.s();!(t=e.n()).done;){t.value.remove()}}catch(t){e.e(t)}finally{e.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},e=this.controlContainer=ri("div","l7-control-container",this.container);Object.values(pp).forEach((function(n){var r,i;!function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=n.map((function(t){return"l7-"+t})).join(" ");t[n.filter((function(t){return!["row","column"].includes(t)})).join("")]=ri("div",r,e)}((r=n,i=r.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),[].concat(At(i),[Ep[r]])))})),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&ii(this.controlCorners[t]);this.controlContainer&&ii(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var t=this,e=window.MutationObserver;if(e)for(var n=function(){var n=i[r].match(/^(top|bottom)(left|right)$/);if(n){var o=$r(n,3),a=o[1],s=o[2],u=t.controlCorners["".concat(a).concat(s)],l=new e((function(t){var e=$r(t,1)[0].target;u&&(u.style[a]=e.clientHeight+"px")}));l.observe(t.controlCorners["".concat(s).concat(a)],{childList:!0,attributes:!0})}},r=0,i=Object.keys(this.controlCorners);r<i.length;r++)n()}}]),t}())||fp,Tp=ku.injectable()(gp=function(){function t(){Ee(this,t),kt(this,"container",void 0),kt(this,"scene",void 0),kt(this,"mapsService",void 0),kt(this,"markers",[]),kt(this,"markerLayers",[]),kt(this,"unAddMarkers",[]),kt(this,"unAddMarkerLayers",[])}return Te(t,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var e=this.markerLayers.indexOf(t);e>-1&&this.markerLayers.splice(e,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach((function(e){e.addTo(t.scene),t.markers.push(e)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach((function(e){t.markerLayers.push(e),e.addTo(t.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Hh.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(t){t.remove()})),this.markers=[],this.markerLayers.forEach((function(t){t.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),t}())||gp,Cp=ku.injectable()(_p=function(){function t(){Ee(this,t),kt(this,"scene",void 0),kt(this,"mapsService",void 0),kt(this,"popups",[]),kt(this,"unAddPopups",[])}return Te(t,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){null!=t&&t.isOpen()&&t.remove();var e=this.popups.indexOf(t);e>-1&&this.popups.splice(e,1);var n=this.unAddPopups.indexOf(t);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach((function(t){return t.remove()}))}},{key:"addPopup",value:function(t){var e=this;t&&t.getOptions().autoClose&&[].concat(At(this.popups),At(this.unAddPopups)).forEach((function(t){t.getOptions().autoClose&&e.removePopup(t)})),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",(function(){e.removePopup(t)}))}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach((function(e){t.addPopup(e),t.unAddPopups=[]}))}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Hh.IMapService)}}]),t}())||_p;!function(t){t.normal="normal",t.additive="additive",t.subtractive="subtractive",t.min="min",t.max="max",t.none="none"}(xp||(xp={})),function(t){t.MULTIPLE="MULTIPLE",t.SINGLE="SINGLE"}(bp||(bp={})),function(t){t.AND="and",t.OR="or"}(wp||(wp={})),function(t){t.INIT="init",t.UPDATE="update"}(Sp||(Sp={}));var kp,Mp={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},Ip={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,isMini:!1,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Pp={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:wp.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Lp=ku.injectable()(kp=function(){function t(){Ee(this,t),kt(this,"sceneConfigCache",{}),kt(this,"layerConfigCache",{}),kt(this,"layerAttributeConfigCache",{})}return Te(t,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return Mp[t]}},{key:"setSceneConfig",value:function(t,e){this.sceneConfigCache[t]=It(It({},Ip),e)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,e,n){this.layerConfigCache[e]=It({},ti.exports.merge({},this.sceneConfigCache[t],Pp,n))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,e){this.layerAttributeConfigCache[t]=It(It({},this.layerAttributeConfigCache[t]),e)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),t}())||kp;function Rp(t,e,n,r){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Op(t,e,n,r,i){var o={};return Object.keys(r).forEach((function(t){o[t]=r[t]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(t,e,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}var Dp,Np=Math.PI/180,zp=4003e4;function Fp(t){var e=t.latitude,n=void 0===e?0:e,r=t.zoom,i=void 0===r?0:r,o=t.scale,a=t.highPrecision,s=void 0!==a&&a,u=t.flipY,l=void 0!==u&&u,c={},h=512*(o=void 0!==o?o:Math.pow(2,i)),p=Math.cos(n*Np),f=h/360,d=f/p,v=h/zp/p;if(c.pixelsPerMeter=[v,-v,v],c.metersPerPixel=[1/v,-1/v,1/v],c.pixelsPerDegree=[f,-d,v],c.degreesPerPixel=[1/f,-1/d,1/v],s){var m=Np*Math.tan(n*Np)/p,y=f*m/2,g=h/zp*m,_=g/d*v;c.pixelsPerDegree2=[0,-y,g],c.pixelsPerMeter2=[_,0,_],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}!function(t){t[t.LNGLAT=1]="LNGLAT",t[t.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",t[t.VECTOR_TILE=3]="VECTOR_TILE",t[t.IDENTITY=4]="IDENTITY",t[t.P20=5]="P20",t[t.P20_OFFSET=6]="P20_OFFSET",t[t.METER_OFFSET=7]="METER_OFFSET",t[t.P20_2=8]="P20_2"}(Dp||(Dp={}));var Bp,Up,jp,Vp,Gp,Hp,Wp="u_CoordinateSystem",Zp="u_ViewportCenter",qp="u_ViewportCenterProjection",Xp="u_PixelsPerDegree",Yp="u_PixelsPerDegree2",Kp="u_PixelsPerMeter",Qp="u_Mvp",Jp=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],$p=(Bp=ku.injectable(),Up=ku.inject(Hh.ICameraService),Bp((Vp=function(){function t(){Ee(this,t),kt(this,"needRefresh",!0),Rp(this,"cameraService",Gp,this),kt(this,"coordinateSystem",void 0),kt(this,"viewportCenter",void 0),kt(this,"viewportCenterProjection",void 0),kt(this,"pixelsPerDegree",void 0),kt(this,"pixelsPerDegree2",void 0),kt(this,"pixelsPerMeter",void 0)}return Te(t,[{key:"refresh",value:function(t){var e=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=t||this.cameraService.getCenter(),i=Fp({latitude:r[1],zoom:e}),o=i.pixelsPerMeter,a=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Dp.LNGLAT||this.coordinateSystem===Dp.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Dp.LNGLAT_OFFSET?this.calculateLnglatOffset(r,e):this.coordinateSystem===Dp.P20_OFFSET&&this.calculateLnglatOffset(r,e,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,e,n,r){var i=Fp({latitude:t[1],zoom:e,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),c=la([],l,u),h=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,e));this.viewportCenterProjection=es([],[h[0],h[1],0,1],c),c=la([],l,u=this.cameraService.getViewMatrixUncentered()||u),c=la([],c,Jp),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),t}(),Gp=Op(Vp.prototype,"cameraService",[Up],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jp=Vp))||jp);function tf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var ef=ku.injectable()(Hp=function(t){Oe(n,t);var e=tf(n);function n(){var t;Ee(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return kt(De(t=e.call.apply(e,[this].concat(i))),"renderMap",new Map),kt(De(t),"enable",!1),kt(De(t),"renderEnable",!1),kt(De(t),"cacheLogs",{}),t}return Te(n,[{key:"setEnable",value:function(t){this.enable=!!t}},{key:"log",value:function(t,e){var n=this;if(this.enable){var r=t.split("."),i=null;r.forEach((function(t,o){null!==i?(i[t]||(i[t]={}),o!==r.length-1&&(i=i[t])):(n.cacheLogs[t]||(n.cacheLogs[t]={}),o!==r.length-1&&(i=n.cacheLogs[t])),o===r.length-1&&(i[t]=It(It({time:Date.now()},i[t]),e))}))}}},{key:"getLog",value:function(t){var e=this;switch(Tt(t)){case"string":return this.cacheLogs[t];case"object":return t.map((function(t){return e.cacheLogs[t]})).filter((function(t){return void 0!==t}));case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(t){delete this.cacheLogs[t]}},{key:"generateRenderUid",value:function(){return this.renderEnable?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})):""}},{key:"renderDebug",value:function(t){this.renderEnable=t}},{key:"renderStart",value:function(t){if(this.renderEnable&&this.enable){var e=this.renderMap.get(t)||{};this.renderMap.set(t,It(It({},e),{},{renderUid:t,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(t){if(this.renderEnable&&this.enable){var e=this.renderMap.get(t);if(e){var n=e.renderStart,r=Date.now();this.emit("renderEnd",It(It({},e),{},{renderEnd:r,renderDuration:r-n})),this.renderMap.delete(t)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),n}(Oi.exports.EventEmitter))||Hp,nf={exports:{}};
/*! Hammer.JS - v2.0.7 - 2016-04-22
     * http://hammerjs.github.io/
     *
     * Copyright (c) 2016 Jorik Tangelder;
     * Licensed under the MIT license */
!function(t){!function(e,n,r,i){var o,a="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,s="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),u=a||s,l=["","webkit","Moz","MS","ms","o"],c=u?"":n.createElement("div"),h="function",p=Math.round,f=Math.abs,d=Date.now;function v(t,e,n){return setTimeout(w(t,n),e)}function m(t,e,n){return!!Array.isArray(t)&&(y(t,n[e],n),!0)}function y(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==i)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function g(t,n,r){var i="DEPRECATED METHOD: "+n+"\n"+r+" AT \n";return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=e.console&&(e.console.warn||e.console.log);return o&&o.call(e.console,i,r),t.apply(this,arguments)}}o="function"!=typeof Object.assign?function(t){if(t===i||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==i&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])}return e}:Object.assign;var _=g((function(t,e,n){for(var r=Object.keys(e),o=0;o<r.length;)(!n||n&&t[r[o]]===i)&&(t[r[o]]=e[r[o]]),o++;return t}),"extend","Use `assign`."),x=g((function(t,e){return _(t,e,!0)}),"merge","Use `assign`.");function b(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&o(r,n)}function w(t,e){return function(){return t.apply(e,arguments)}}function S(t,e){return typeof t==h?t.apply(e&&e[0]||i,e):t}function E(t,e){return t===i?e:t}function A(t,e,n){y(M(e),(function(e){t.addEventListener(e,n,!1)}))}function T(t,e,n){y(M(e),(function(e){t.removeEventListener(e,n,!1)}))}function C(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function k(t,e){return t.indexOf(e)>-1}function M(t){return t.trim().split(/\s+/g)}function I(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function P(t){return Array.prototype.slice.call(t,0)}function L(t,e,n){for(var r=[],i=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];I(i,a)<0&&r.push(t[o]),i[o]=a,o++}return n&&(r=e?r.sort((function(t,n){return t[e]>n[e]})):r.sort()),r}function R(t,e){for(var n,r,o=e[0].toUpperCase()+e.slice(1),a=0;a<l.length;){if((r=(n=l[a])?n+o:e)in t)return r;a++}return i}var O=1;function D(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}var N="ontouchstart"in e,z=R(e,"PointerEvent")!==i,F=N&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B="touch",U="mouse",j=25,V=1,G=4,H=8,W=1,Z=2,q=4,X=8,Y=16,K=Z|q,Q=X|Y,J=K|Q,$=["x","y"],tt=["clientX","clientY"];function et(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){S(t.options.enable,[t])&&n.handler(e)},this.init()}function nt(t,e,n){var r=n.pointers.length,o=n.changedPointers.length,a=e&V&&r-o==0,s=e&(G|H)&&r-o==0;n.isFirst=!!a,n.isFinal=!!s,a&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,r=e.pointers,o=r.length;n.firstInput||(n.firstInput=rt(e));o>1&&!n.firstMultiple?n.firstMultiple=rt(e):1===o&&(n.firstMultiple=!1);var a=n.firstInput,s=n.firstMultiple,u=s?s.center:a.center,l=e.center=it(r);e.timeStamp=d(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=ut(u,l),e.distance=st(u,l),function(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},o=t.prevInput||{};e.eventType!==V&&o.eventType!==G||(i=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y});e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}(n,e),e.offsetDirection=at(e.deltaX,e.deltaY);var c=ot(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=f(c.x)>f(c.y)?c.x:c.y,e.scale=s?(h=s.pointers,p=r,st(p[0],p[1],tt)/st(h[0],h[1],tt)):1,e.rotation=s?function(t,e){return ut(e[1],e[0],tt)+ut(t[1],t[0],tt)}(s.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,r,o,a,s=t.lastInterval||e,u=e.timeStamp-s.timeStamp;if(e.eventType!=H&&(u>j||s.velocity===i)){var l=e.deltaX-s.deltaX,c=e.deltaY-s.deltaY,h=ot(u,l,c);r=h.x,o=h.y,n=f(h.x)>f(h.y)?h.x:h.y,a=at(l,c),t.lastInterval=e}else n=s.velocity,r=s.velocityX,o=s.velocityY,a=s.direction;e.velocity=n,e.velocityX=r,e.velocityY=o,e.direction=a}(n,e);var h,p;var v=t.element;C(e.srcEvent.target,v)&&(v=e.srcEvent.target);e.target=v}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function rt(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:p(t.pointers[n].clientX),clientY:p(t.pointers[n].clientY)},n++;return{timeStamp:d(),pointers:e,center:it(e),deltaX:t.deltaX,deltaY:t.deltaY}}function it(t){var e=t.length;if(1===e)return{x:p(t[0].clientX),y:p(t[0].clientY)};for(var n=0,r=0,i=0;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:p(n/e),y:p(r/e)}}function ot(t,e,n){return{x:e/t||0,y:n/t||0}}function at(t,e){return t===e?W:f(t)>=f(e)?t<0?Z:q:e<0?X:Y}function st(t,e,n){n||(n=$);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function ut(t,e,n){n||(n=$);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}et.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(D(this.element),this.evWin,this.domHandler)}};var lt={mousedown:V,mousemove:2,mouseup:G},ct="mousedown",ht="mousemove mouseup";function pt(){this.evEl=ct,this.evWin=ht,this.pressed=!1,et.apply(this,arguments)}b(pt,et,{handler:function(t){var e=lt[t.type];e&V&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=G),this.pressed&&(e&G&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:U,srcEvent:t}))}});var ft={pointerdown:V,pointermove:2,pointerup:G,pointercancel:H,pointerout:H},dt={2:B,3:"pen",4:U,5:"kinect"},vt="pointerdown",mt="pointermove pointerup pointercancel";function yt(){this.evEl=vt,this.evWin=mt,et.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}u||!e.MSPointerEvent||e.PointerEvent||(vt="MSPointerDown",mt="MSPointerMove MSPointerUp MSPointerCancel"),b(yt,et,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=ft[r],o=dt[t.pointerType]||t.pointerType,a=o==B,s=I(e,t.pointerId,"pointerId");i&V&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):i&(G|H)&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(s,1))}});var gt={touchstart:V,touchmove:2,touchend:G,touchcancel:H};function _t(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,et.apply(this,arguments)}function xt(t,e){var n=P(t.touches),r=P(t.changedTouches);return e&(G|H)&&(n=L(n.concat(r),"identifier",!0)),[n,r]}b(_t,et,{handler:function(t){var e=gt[t.type];if(e===V&&(this.started=!0),this.started){var n=xt.call(this,t,e);e&(G|H)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:B,srcEvent:t})}}});var bt={touchstart:V,touchmove:2,touchend:G,touchcancel:H},wt="touchstart touchmove touchend touchcancel";function St(){this.evTarget=wt,this.targetIds={},et.apply(this,arguments)}function Et(t,e){var n=P(t.touches),r=this.targetIds;if(e&(2|V)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=P(t.changedTouches),s=[],u=this.target;if(o=n.filter((function(t){return C(t.target,u)})),e===V)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),e&(G|H)&&delete r[a[i].identifier],i++;return s.length?[L(o.concat(s),"identifier",!0),s]:void 0}b(St,et,{handler:function(t){var e=bt[t.type],n=Et.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:B,srcEvent:t})}});var At=2500;function Tt(){et.apply(this,arguments);var t=w(this.handler,this);this.touch=new St(this.manager,t),this.mouse=new pt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function Ct(t,e){t&V?(this.primaryTouch=e.changedPointers[0].identifier,kt.call(this,e)):t&(G|H)&&kt.call(this,e)}function kt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)}),At)}}function Mt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(e-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}b(Tt,et,{handler:function(t,e,n){var r=n.pointerType==B,i=n.pointerType==U;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)Ct.call(this,e,n);else if(i&&Mt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var It=u?i:R(c.style,"touchAction"),Pt=It!==i,Lt="compute",Rt="auto",Ot="manipulation",Dt="none",Nt="pan-x",zt="pan-y",Ft=function(){if(!Pt)return!1;var t={};if(u)return t;var n=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){t[r]=!n||e.CSS.supports("touch-action",r)})),t}();function Bt(t,e){this.manager=t,this.set(e)}Bt.prototype={set:function(t){t==Lt&&(t=this.compute()),Pt&&this.manager.element.style&&Ft[t]&&(this.manager.element.style[It]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return y(this.manager.recognizers,(function(e){S(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(k(t,Dt))return Dt;var e=k(t,Nt),n=k(t,zt);if(e&&n)return Dt;if(e||n)return e?Nt:zt;if(k(t,Ot))return Ot;return Rt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,i=k(r,Dt)&&!Ft[Dt],o=k(r,zt)&&!Ft[zt],a=k(r,Nt)&&!Ft[Nt];if(i){var s=1===t.pointers.length,u=t.distance<2,l=t.deltaTime<250;if(s&&u&&l)return}if(!a||!o)return i||o&&n&K||a&&n&Q?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Ut=1,jt=32;function Vt(t){this.options=o({},this.defaults,t||{}),this.id=O++,this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=Ut,this.simultaneous={},this.requireFail=[]}function Gt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function Ht(t){return t==Y?"down":t==X?"up":t==Z?"left":t==q?"right":""}function Wt(t,e){var n=e.manager;return n?n.get(t):t}function Zt(){Vt.apply(this,arguments)}function qt(){Zt.apply(this,arguments),this.pX=null,this.pY=null}function Xt(){Zt.apply(this,arguments)}function Yt(){Vt.apply(this,arguments),this._timer=null,this._input=null}function Kt(){Zt.apply(this,arguments)}function Qt(){Zt.apply(this,arguments)}function Jt(){Vt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function $t(t,e){return(e=e||{}).recognizers=E(e.recognizers,$t.defaults.preset),new te(t,e)}Vt.prototype={defaults:{},set:function(t){return o(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(m(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Wt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return m(t,"dropRecognizeWith",this)||(t=Wt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(m(t,"requireFailure",this))return this;var e=this.requireFail;return-1===I(e,t=Wt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(m(t,"dropRequireFailure",this))return this;t=Wt(t,this);var e=I(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<8&&r(e.options.event+Gt(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=8&&r(e.options.event+Gt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=jt},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(jt|Ut)))return!1;t++}return!0},recognize:function(t){var e=o({},t);if(!S(this.options.enable,[this,e]))return this.reset(),void(this.state=jt);56&this.state&&(this.state=Ut),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},b(Zt,Vt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=6&e,i=this.attrTest(t);return r&&(n&H||!i)?16|e:r||i?n&G?8|e:2&e?4|e:2:jt}}),b(qt,Zt,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var t=this.options.direction,e=[];return t&K&&e.push(zt),t&Q&&e.push(Nt),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,o=t.deltaX,a=t.deltaY;return i&e.direction||(e.direction&K?(i=0===o?W:o<0?Z:q,n=o!=this.pX,r=Math.abs(t.deltaX)):(i=0===a?W:a<0?X:Y,n=a!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return Zt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Ht(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),b(Xt,Zt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Dt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),b(Yt,Vt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Rt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||t.eventType&(G|H)&&!i)this.reset();else if(t.eventType&V)this.reset(),this._timer=v((function(){this.state=8,this.tryEmit()}),e.time,this);else if(t.eventType&G)return 8;return jt},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&t.eventType&G?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),b(Kt,Zt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Dt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),b(Qt,Zt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:K|Q,pointers:1},getTouchAction:function(){return qt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(K|Q)?e=t.overallVelocity:n&K?e=t.overallVelocityX:n&Q&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&f(e)>this.options.velocity&&t.eventType&G},emit:function(t){var e=Ht(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),b(Jt,Vt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ot]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),t.eventType&V&&0===this.count)return this.failTimeout();if(r&&i&&n){if(t.eventType!=G)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||st(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=v((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return jt},failTimeout:function(){return this._timer=v((function(){this.state=jt}),this.options.interval,this),jt},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),$t.VERSION="2.0.7",$t.defaults={domEvents:!1,touchAction:Lt,enable:!0,inputTarget:null,inputClass:null,preset:[[Kt,{enable:!1}],[Xt,{enable:!1},["rotate"]],[Qt,{direction:K}],[qt,{direction:K},["swipe"]],[Jt],[Jt,{event:"doubletap",taps:2},["tap"]],[Yt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function te(t,e){var n;this.options=o({},$t.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||(z?yt:F?St:N?Tt:pt))(n,nt),this.touchAction=new Bt(this,this.options.touchAction),ee(this,!0),y(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function ee(t,e){var n,r=t.element;r.style&&(y(t.options.cssProps,(function(i,o){n=R(r.style,o),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}(te.prototype={set:function(t){return o(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var r=this.recognizers,i=e.curRecognizer;(!i||i&&8&i.state)&&(i=e.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===e.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&14&n.state&&(i=e.curRecognizer=n),o++}},get:function(t){if(t instanceof Vt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(m(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(m(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=I(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==i&&e!==i){var n=this.handlers;return y(M(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==i){var n=this.handlers;return y(M(t),(function(t){e?n[t]&&n[t].splice(I(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){if(u)return;var r=n.createEvent("Event");r.initEvent(t,!0,!0),r.gesture=e,e.target.dispatchEvent(r)}(t,e);var r=this.handlers[t]&&this.handlers[t].slice();if(r&&r.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](e),i++}},destroy:function(){this.element&&ee(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u)||(o($t,{INPUT_START:V,INPUT_MOVE:2,INPUT_END:G,INPUT_CANCEL:H,STATE_POSSIBLE:Ut,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:jt,DIRECTION_NONE:W,DIRECTION_LEFT:Z,DIRECTION_RIGHT:q,DIRECTION_UP:X,DIRECTION_DOWN:Y,DIRECTION_HORIZONTAL:K,DIRECTION_VERTICAL:Q,DIRECTION_ALL:J,Manager:te,Input:et,TouchAction:Bt,TouchInput:St,MouseInput:pt,PointerEventInput:yt,TouchMouseInput:Tt,SingleTouchInput:_t,Recognizer:Vt,AttrRecognizer:Zt,Tap:Jt,Pan:qt,Swipe:Qt,Pinch:Xt,Rotate:Kt,Press:Yt,on:A,off:T,each:y,merge:x,extend:_,assign:o,inherit:b,bindFn:w,prefixed:R}),("undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Hammer=$t,"function"==typeof i&&i.amd?i((function(){return $t})):t.exports?t.exports=$t:e.Hammer=$t)}("undefined"!=typeof window?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document)}(nf);var rf,of,af,sf,uf,lf,cf=nf.exports;function hf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}!function(t){t.Hover="hover",t.Click="click",t.Select="select",t.Active="active",t.Drag="drag"}(rf||(rf={}));var pf,ff,df,vf,mf,yf,gf,_f,xf,bf,wf,Sf,Ef,Af,Tf={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Cf=(of=ku.injectable(),af=ku.inject(Hh.IMapService),of((uf=function(t){Oe(n,t);var e=hf(n);function n(){var t;Ee(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return kt(De(t=e.call.apply(e,[this].concat(i))),"indragging",!1),Rp(De(t),"mapService",lf,De(t)),kt(De(t),"hammertime",void 0),kt(De(t),"lastClickTime",0),kt(De(t),"lastClickXY",[-1,-1]),kt(De(t),"clickTimer",void 0),kt(De(t),"$containter",void 0),kt(De(t),"onDrag",(function(e){var n=t.interactionEvent(e);n.type=Tf[n.type],"dragging"===n.type?t.indragging=!0:t.indragging=!1,t.emit(rf.Drag,n)})),kt(De(t),"onHammer",(function(e){e.srcEvent.stopPropagation();var n=t.interactionEvent(e);t.emit(rf.Hover,n)})),kt(De(t),"onTouch",(function(e){var n=e.touches[0];t.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),kt(De(t),"onHover",(function(e){var n=e.clientX,r=e.clientY,i=e.type,o=t.mapService.getMapContainer();if(o)if(Jn)n=n-o.left-0,r=r-o.top-0;else{var a=o.getBoundingClientRect(),s=a.top;n=n-a.left-o.clientLeft,r=r-s-o.clientTop}var u=t.mapService.containerToLngLat([n,r]);if("click"!==i)"touch"!==i?"click"!==i&&"dblclick"!==i&&t.emit(rf.Hover,{x:n,y:r,lngLat:u,type:i,target:e}):t.isDoubleTap(n,r,u);else{if(!Jn&&"ontouchstart"in document.documentElement==!0)return;t.isDoubleTap(n,r,u)}})),t}return Te(n,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(rf.Hover)}},{key:"triggerHover",value:function(t){var e=t.x,n=t.y;this.emit(rf.Hover,{x:e,y:n})}},{key:"triggerSelect",value:function(t){this.emit(rf.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(rf.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t)if(Jn)tr.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=new cf.Manager(t);e.add(new cf.Tap({event:"dblclick",taps:2})),e.add(new cf.Tap({event:"click"})),e.add(new cf.Pan({threshold:0,pointers:0})),e.add(new cf.Press({})),e.on("dblclick click",this.onHammer),e.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=e}}},{key:"removeEventListenerOnMap",value:function(){if(Jn)tr.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(t){var e,n,r=t.type;"touch"===t.pointerType?(n=Math.floor(t.pointers[0].clientY),e=Math.floor(t.pointers[0].clientX)):(n=Math.floor(t.srcEvent.y),e=Math.floor(t.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;e-=o.left,n-=a}return{x:e,y:n,lngLat:this.mapService.containerToLngLat([e,n]),type:r,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,e,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-e)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(rf.Hover,{x:t,y:e,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[t,e],this.clickTimer=setTimeout((function(){o="click",r.emit(rf.Hover,{x:t,y:e,lngLat:n,type:o})}),400))}}]),n}(Ni),lf=Op(uf.prototype,"mapService",[af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sf=uf))||sf),kf=0;function Mf(t){if(Jn)return null;var e=t;if("string"==typeof t&&(e=document.getElementById(t)),e){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(kf++),n.classList.add("l7-scene"),e.appendChild(n),n}return null}!function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.CULL_FACE=2884]="CULL_FACE",t[t.BLEND=3042]="BLEND",t[t.DITHER=3024]="DITHER",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.TEXTURE1=33985]="TEXTURE1",t[t.TEXTURE2=33986]="TEXTURE2",t[t.TEXTURE3=33987]="TEXTURE3",t[t.TEXTURE4=33988]="TEXTURE4",t[t.TEXTURE5=33989]="TEXTURE5",t[t.TEXTURE6=33990]="TEXTURE6",t[t.TEXTURE7=33991]="TEXTURE7",t[t.TEXTURE8=33992]="TEXTURE8",t[t.TEXTURE9=33993]="TEXTURE9",t[t.TEXTURE10=33994]="TEXTURE10",t[t.TEXTURE11=33995]="TEXTURE11",t[t.TEXTURE12=33996]="TEXTURE12",t[t.TEXTURE13=33997]="TEXTURE13",t[t.TEXTURE14=33998]="TEXTURE14",t[t.TEXTURE15=33999]="TEXTURE15",t[t.TEXTURE16=34e3]="TEXTURE16",t[t.TEXTURE17=34001]="TEXTURE17",t[t.TEXTURE18=34002]="TEXTURE18",t[t.TEXTURE19=34003]="TEXTURE19",t[t.TEXTURE20=34004]="TEXTURE20",t[t.TEXTURE21=34005]="TEXTURE21",t[t.TEXTURE22=34006]="TEXTURE22",t[t.TEXTURE23=34007]="TEXTURE23",t[t.TEXTURE24=34008]="TEXTURE24",t[t.TEXTURE25=34009]="TEXTURE25",t[t.TEXTURE26=34010]="TEXTURE26",t[t.TEXTURE27=34011]="TEXTURE27",t[t.TEXTURE28=34012]="TEXTURE28",t[t.TEXTURE29=34013]="TEXTURE29",t[t.TEXTURE30=34014]="TEXTURE30",t[t.TEXTURE31=34015]="TEXTURE31",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"}(pf||(pf={}));var If,Pf,Lf,Rf,Of,Df,Nf,zf,Ff,Bf=(ff=ku.injectable(),df=ku.inject(Hh.IMapService),vf=ku.inject(Hh.IRendererService),mf=ku.inject(Hh.IGlobalConfigService),yf=ku.inject(Hh.IInteractionService),gf=ku.inject(Hh.ILayerService),ff((xf=function(){function t(){var e=this;Ee(this,t),kt(this,"pickedColors",void 0),kt(this,"pickedTileLayers",[]),Rp(this,"mapService",bf,this),Rp(this,"rendererService",wf,this),Rp(this,"configService",Sf,this),Rp(this,"interactionService",Ef,this),Rp(this,"layerService",Af,this),kt(this,"pickingFBO",void 0),kt(this,"width",0),kt(this,"height",0),kt(this,"alreadyInPicking",!1),kt(this,"pickBufferScale",1),kt(this,"pickFromPickingFBO",(function(t,n){var r=n.x,i=n.y,o=n.lngLat,a=n.type,s=n.target,u=!1,l=e.rendererService,c=l.readPixels,h=l.getContainer,p=e.getContainerSize(h()),f=p.width,d=p.height;f*=hi,d*=hi;var v=t.getLayerConfig(),m=v.enableHighlight,y=v.enableSelect,g=r*hi,_=i*hi;if(g>f-1*hi||g<0||_>d-1*hi||_<0)return!1;var x=c({x:Math.floor(g/e.pickBufferScale),y:Math.floor((d-(i+1)*hi)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO});if(e.pickedColors=x,0!==x[0]||0!==x[1]||0!==x[2]){var b=Wr(x),w=t.layerPickService.getFeatureById(b);b!==t.getCurrentPickId()&&"mousemove"===a&&(a="mouseenter");var S={x:r,y:i,type:a,lngLat:o,featureId:b,feature:w,target:s};w&&(u=!0,t.setCurrentPickId(b),e.triggerHoverOnLayer(t,S))}else{var E={x:r,y:i,lngLat:o,type:null!==t.getCurrentPickId()&&"mousemove"===a?"mouseout":"un"+a,featureId:null,target:s,feature:null};e.triggerHoverOnLayer(t,It(It({},E),{},{type:"unpick"})),e.triggerHoverOnLayer(t,E),t.setCurrentPickId(null)}if(m&&t.layerPickService.highlightPickedFeature(x),y&&"click"===a&&(null==x?void 0:x.toString())!==[0,0,0,0].toString()){var A=Wr(x);null===t.getCurrentSelectedId()||A!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(x),t.setCurrentSelectedId(A)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return u}))}var e,n,r;return Te(t,[{key:"init",value:function(t){var e=this.rendererService,n=e.createTexture2D,r=e.createFramebuffer,i=e.getContainer,o=this.getContainerSize(i()),a=o.width,s=o.height;a*=hi,s*=hi,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=r({color:n({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale),wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE})}),this.interactionService.on(rf.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(r=Zt(Kt.mark((function t(e,n,r){var i,o,a,s=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.hooks.beforePickingEncode.call(),e.renderModels({ispick:!0}),e.hooks.afterPickingEncode.call();var t=s.pickBox(e,n);r(t)}));case 3:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return r.apply(this,arguments)})},{key:"pickBox",value:function(t,e){var n=this,r=$r(e.map((function(t){var e=t<0?0:t;return Math.floor(e*hi/n.pickBufferScale)})),4),i=r[0],o=r[1],a=r[2],s=r[3],u=this.rendererService,l=u.readPixels,c=u.getContainer,h=this.getContainerSize(c()),p=h.width,f=h.height;if(f*=hi,i>((p*=hi)-1)*hi/this.pickBufferScale||a<0||o>(f-1)*hi/this.pickBufferScale||s<0)return[];for(var d=Math.min(p/this.pickBufferScale,a)-i,v=Math.min(f/this.pickBufferScale,s)-o,m=l({x:i,y:Math.floor(f/this.pickBufferScale-(s+1)),width:d,height:v,data:new Uint8Array(d*v*4),framebuffer:this.pickingFBO}),y=[],g={},_=0;_<m.length/4;_+=1){var x=Wr(m.slice(4*_,4*_+4));if(-1!==x&&!g[x]){var b=t.layerPickService.getFeatureById(x);y.push(It(It({},b),{},{pickedFeatureIdx:x})),g[x]=!0}}return y}},{key:"handleCursor",value:function(t,e){var n=t.getLayerConfig(),r=n.cursor,i=void 0===r?"":r;if(n.cursorEnabled){var o="GAODE2.x"===this.mapService.version?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),a=null==o?void 0:o.style.getPropertyValue("cursor");"unmousemove"===e&&""!==a?null==o||o.style.setProperty("cursor",""):"mousemove"===e&&(null==o||o.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/hi,height:t.height/hi}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:(n=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.layerService.needPick(e.type)&&this.isPickingAllLayer()){t.next=2;break}return t.abrupt("return");case 2:return this.alreadyInPicking=!0,t.next=5,this.pickingLayers(e);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"isPickingAllLayer",value:function(){return!this.alreadyInPicking&&(!this.layerService.alreadyInRendering&&(!this.interactionService.indragging&&!!this.layerService.getShaderPickStat()))}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,e=this.getContainerSize(t()),n=e.width,r=e.height;n*=hi,r*=hi,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:(e=Zt(Kt.mark((function t(e){var n,r,i,o=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.rendererService,r=n.useFramebuffer,i=n.clear,this.resizePickingFBO(),r(this.pickingFBO,(function(){o.layerService.getRenderList().filter((function(t){return t.needPick(e.type)})).reverse().some((function(t){i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.layerPickService.pickRender(e);var n=o.pickFromPickingFBO(t,e);return o.layerService.pickedLayerId=n?+t.id:-1,n&&!t.getLayerConfig().enablePropagation}))}));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(t,e){(function(t){var e,n=!0;if((null==t||null===(e=t.target)||void 0===e?void 0:e.target)instanceof HTMLElement)for(var r,i=null==t||null===(r=t.target)||void 0===r?void 0:r.target;i;){var o,a=Array.from(i.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){n=!1;break}i=null===(o=i)||void 0===o?void 0:o.parentElement}return n})(e)&&(this.handleCursor(t,e.type),t.emit(e.type,e))}}]),t}(),bf=Op(xf.prototype,"mapService",[df],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wf=Op(xf.prototype,"rendererService",[vf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sf=Op(xf.prototype,"configService",[mf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ef=Op(xf.prototype,"interactionService",[yf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Af=Op(xf.prototype,"layerService",[gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_f=xf))||_f),Uf=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Ee(this,t),kt(this,"autoStart",void 0),kt(this,"startTime",0),kt(this,"oldTime",0),kt(this,"running",!1),kt(this,"elapsedTime",0),this.autoStart=e}return Te(t,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}]),t}();function jf(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Vf(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vf(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Vf(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Gf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Hf=(If=ku.injectable(),Pf=ku.inject(Hh.IRendererService),Lf=ku.inject(Hh.IMapService),Rf=ku.inject(Hh.IDebugService),If((Df=function(t){Oe(u,t);var e,n,r,i,o,a,s=Gf(u);function u(){var t;Ee(this,u);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return kt(De(t=s.call.apply(s,[this].concat(n))),"pickedLayerId",-1),kt(De(t),"clock",new Uf),kt(De(t),"alreadyInRendering",!1),kt(De(t),"layers",[]),kt(De(t),"layerList",[]),kt(De(t),"layerRenderID",void 0),kt(De(t),"sceneInited",!1),kt(De(t),"animateInstanceCount",0),kt(De(t),"shaderPicking",!0),kt(De(t),"enableRender",!0),Rp(De(t),"renderService",Nf,De(t)),Rp(De(t),"mapService",zf,De(t)),Rp(De(t),"debugService",Ff,De(t)),kt(De(t),"reRender",ti.exports.throttle((function(){t.renderLayers()}),32)),kt(De(t),"throttleRenderLayers",ti.exports.throttle((function(){t.renderLayers()}),16)),t}return Te(u,[{key:"needPick",value:function(t){return this.layerList.some((function(e){return e.needPick(t)}))}},{key:"add",value:function(t){var e=this;this.layers.push(t),this.sceneInited&&t.init().then((function(){e.renderLayers()}))}},{key:"addMask",value:function(t){var e=this;this.sceneInited&&t.init().then((function(){e.renderLayers()}))}},{key:"initLayers",value:(a=Zt(Kt.mark((function t(){var e=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var t=Zt(Kt.mark((function t(n){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.startInit){t.next=4;break}return t.next=3,n.init();case 3:e.updateLayerRenderList();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find((function(e){return e.id===t}))}},{key:"getLayerByName",value:function(t){return this.layers.find((function(e){return e.name===t}))}},{key:"remove",value:(o=Zt(Kt.mark((function t(e,n){var r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n?(r=n.layerChildren.indexOf(e))>-1&&n.layerChildren.splice(r,1):(i=this.layers.indexOf(e))>-1&&this.layers.splice(i,1),e.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"removeAllLayers",value:(i=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.destroy(),this.reRender();case 2:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:(r=Zt(Kt.mark((function t(){var e,n,r,i,o,a;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.alreadyInRendering&&this.enableRender){t.next=2;break}return t.abrupt("return");case 2:this.updateLayerRenderList(),e=this.debugService.generateRenderUid(),this.debugService.renderStart(e),this.alreadyInRendering=!0,this.clear(),n=jf(this.layerList),t.prev=8,n.s();case 10:if((r=n.n()).done){t.next=23;break}if(i=r.value,o=i.getLayerConfig(),a=o.enableMask,i.masks.filter((function(t){return t.inited})).length>0&&a&&this.renderMask(i.masks),!i.getLayerConfig().enableMultiPassRenderer){t.next=19;break}return t.next=17,i.renderMultiPass();case 17:t.next=21;break;case 19:return t.next=21,i.render();case 21:t.next=10;break;case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(8),n.e(t.t0);case 28:return t.prev=28,n.f(),t.finish(28);case 31:this.debugService.renderEnd(e),this.alreadyInRendering=!1;case 33:case"end":return t.stop()}}),t,this,[[8,25,28,31]])}))),function(){return r.apply(this,arguments)})},{key:"renderMask",value:function(t){var e=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var n,r=t.length>1?bp.MULTIPLE:bp.SINGLE,i=jf(t);try{for(i.s();!(n=i.n()).done;){n.value.render({isStencil:!0,stencilType:r,stencilIndex:e++})}}catch(t){i.e(t)}finally{i.f()}}},{key:"beforeRenderData",value:(n=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.hooks.beforeRenderData.promise();case 2:t.sent&&this.renderLayers();case 4:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"renderTileLayerMask",value:function(t){var e=0,n=t.getLayerConfig().enableMask,r=void 0===n||n,i=t.tileMask?1:0,o=t.masks.filter((function(t){return t.inited})),a=(i+=r?o.length:1)>1?bp.MULTIPLE:bp.SINGLE;if((t.tileMask||o.length&&r)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.length&&r){var s,u=jf(o);try{for(u.s();!(s=u.n()).done;){s.value.render({isStencil:!0,stencilType:a,stencilIndex:e++})}}catch(t){u.e(t)}finally{u.f()}}t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:a,stencilIndex:e++,stencilOperation:wp.OR})}},{key:"renderTileLayer",value:(e=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.renderTileLayerMask(e),!e.getLayerConfig().enableMultiPassRenderer){t.next=6;break}return t.next=4,e.renderMultiPass();case 4:t.next=8;break;case 6:return t.next=8,e.render();case 8:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter((function(t){return t.inited})).filter((function(t){return t.isVisible()})).sort((function(t,e){return t.zIndex-e.zIndex})).forEach((function(e){t.layerList.push(e)}))}},{key:"destroy",value:function(){this.layers.forEach((function(t){t.destroy()})),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=Hr(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=tr.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){tr.cancelAnimationFrame(this.layerRenderID)}}]),u}(Oi.exports.EventEmitter),Nf=Op(Df.prototype,"renderService",[Pf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zf=Op(Df.prototype,"mapService",[Lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ff=Op(Df.prototype,"debugService",[Rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Of=Df))||Of);function Wf(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var Zf,qf,Xf,Yf,Kf,Qf,Jf=function(){function t(e){var n=this;Ee(this,t),kt(this,"name",void 0),kt(this,"type",void 0),kt(this,"scale",void 0),kt(this,"descriptor",void 0),kt(this,"featureBufferLayout",[]),kt(this,"needRescale",!1),kt(this,"needRemapping",!1),kt(this,"needRegenerateVertices",!1),kt(this,"featureRange",{startIndex:0,endIndex:1/0}),kt(this,"vertexAttribute",void 0),kt(this,"defaultCallback",(function(t){var e;return 0===t.length?(null===(e=n.scale)||void 0===e?void 0:e.defaultValues)||[]:t.map((function(t,e){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[e].func)(t)}))})),this.setProps(e)}return Te(t,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var e;if(null!==(e=this.scale)&&void 0!==e&&e.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,At(t));if(!ti.exports.isNil(r))return[r]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),t}(),$f=["buffer","update","name"],td=["buffer","update","name"],ed=(kt(Zf={},pf.FLOAT,4),kt(Zf,pf.UNSIGNED_BYTE,1),kt(Zf,pf.UNSIGNED_SHORT,2),Zf),nd=(qf=ku.injectable(),Xf=ku.inject(Hh.IRendererService),qf((Kf=function(){function t(){Ee(this,t),kt(this,"attributesAndIndices",void 0),Rp(this,"rendererService",Qf,this),kt(this,"attributes",[]),kt(this,"triangulation",void 0),kt(this,"featureLayout",{sizePerElement:0,elements:[]})}return Te(t,[{key:"registerStyleAttribute",value:function(t){var e=this.getLayerStyleAttribute(t.name||"");return e?e.setProps(t):(e=new Jf(t),this.attributes.push(e)),e}},{key:"unRegisterStyleAttribute",value:function(t){var e=this.attributes.findIndex((function(e){return e.name===t}));e>-1&&this.attributes.splice(e,1)}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach((function(e){var n,r=e.name,i=null===(n=e.scale)||void 0===n?void 0:n.field;(t[r]||i&&t[i])&&(e.needRescale=!0,e.needRemapping=!0,e.needRegenerateVertices=!0)}))}},{key:"updateStyleAttribute",value:function(t,e,n){var r=this.getLayerStyleAttribute(t);r||(r=this.registerStyleAttribute(It(It({},e),{},{name:t})));var i=e.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find((function(e){return e.name===t}))}},{key:"getLayerAttributeScale",value:function(t){var e,n=this.getLayerStyleAttribute(t),r=null==n||null===(e=n.scale)||void 0===e?void 0:e.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.attributes.find((function(e){return e.name===t}));if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,l=a.size,c=void 0===l?0:l,h=ed[u.type||pf.FLOAT];if(s){var p=this.featureLayout,f=p.elements,d=p.sizePerElement,v=f.slice(n,r);if(!v.length)return;var m=v[0].offset*c*h,y=v.map((function(t,n){for(var r=t.featureIdx,i=t.vertices,o=t.normals,a=i.length/d,u=[],l=0;l<a;l++){var c=o?o.slice(3*l,3*l+3):[];u.push.apply(u,At(s(e[r],r,i.slice(l*d,l*d+d),n,c)))}return u})).reduce((function(t,e){return t.push.apply(t,At(e)),t}),[]);o.vertexAttribute.updateBuffer({data:y,offset:m}),null==i||i.emit("legend:".concat(t),{type:t,attr:o})}}}},{key:"createAttributesAndIndices",value:function(t,e,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var i=this.attributes.map((function(t){return t.resetDescriptor(),t.descriptor})),o=0,a=0,s=[],u=3;t.forEach((function(t,e){var l=r.triangulation(t,n),c=l.indices,h=l.vertices,p=l.normals,f=l.size,d=l.indexes,v=l.count;"number"==typeof v&&(a+=v),c.forEach((function(t){s.push(t+o)})),u=f;var m=h.length/f;r.featureLayout.sizePerElement=u,r.featureLayout.elements.push({featureIdx:e,vertices:h,normals:p,offset:o}),o+=m;for(var y=function(n){var r=(null==p?void 0:p.slice(3*n,3*n+3))||[],o=h.slice(n*f,n*f+f),a=0;d&&void 0!==d[n]&&(a=d[n]),i.forEach((function(i,s){var u;i&&i.update&&(u=i.buffer.data).push.apply(u,At(i.update(t,e,o,n,r,a)))}))},g=0;g<m;g++)y(g)}));var l=this.rendererService,c=l.createAttribute,h=l.createBuffer,p=l.createElements,f={};i.forEach((function(t,e){if(t){var n=t.buffer;t.update,t.name;var i=Wf(t,$f),o=c(It({buffer:h(n)},i));f[t.name||""]=o,r.attributes[e].vertexAttribute=o}}));var d=p({data:s,type:pf.UNSIGNED_INT,count:s.length});return this.attributesAndIndices={attributes:f,elements:d,count:a},this.attributesAndIndices}},{key:"createAttributes",value:function(t,e){var n=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var r=this.attributes.map((function(t){return t.resetDescriptor(),t.descriptor})),i=0,o=3;t.forEach((function(t,e){var a=n.triangulation(t),s=a.indices,u=a.vertices,l=a.normals,c=a.size,h=a.indexes;s.forEach((function(t){})),o=c;var p=u.length/c;n.featureLayout.sizePerElement=o,n.featureLayout.elements.push({featureIdx:e,vertices:u,normals:l,offset:i}),i+=p;for(var f=function(n){var i=(null==l?void 0:l.slice(3*n,3*n+3))||[],o=u.slice(n*c,n*c+c),a=0;h&&void 0!==h[n]&&(a=h[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,At(r.update(t,e,o,n,i,a)))}))},d=0;d<p;d++)f(d)}));var a=this.rendererService,s=a.createAttribute,u=a.createBuffer,l={};return r.forEach((function(t,e){if(t){var r=t.buffer;t.update,t.name;var i=Wf(t,td),o=s(It({buffer:u(r)},i));l[t.name||""]=o,n.attributes[e].vertexAttribute=o}})),{attributes:l}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach((function(t){t.vertexAttribute&&t.vertexAttribute.destroy()})),null===(t=this.attributesAndIndices)||void 0===t||t.elements.destroy(),this.attributes=[]}}]),t}(),Qf=Op(Kf.prototype,"rendererService",[Xf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yf=Kf))||Yf);function rd(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function id(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function od(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function ad(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function sd(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ud={exports:{}},ld={exports:{}},cd={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t&&"number"==typeof t.length&&t.length>=0&&t.length%1==0},t.exports=e.default}(cd,cd.exports);var hd={},pd={exports:{}},fd={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e.pop();return t.call(this,e,r)}},t.exports=e.default}(fd,fd.exports);var dd={};Object.defineProperty(dd,"__esModule",{value:!0}),dd.fallback=_d,dd.wrap=xd;var vd,md=dd.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,yd=dd.hasSetImmediate="function"==typeof setImmediate&&setImmediate,gd=dd.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function _d(t){setTimeout(t,0)}function xd(t){return function(e){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return t((function(){return e.apply(void 0,n)}))}}vd=md?queueMicrotask:yd?setImmediate:gd?process.nextTick:_d,dd.default=xd(vd),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if((0,i.isAsync)(t))return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e.pop();return a(t.apply(this,e),r)};return(0,n.default)((function(e,n){var r;try{r=t.apply(this,e)}catch(t){return n(t)}if(r&&"function"==typeof r.then)return a(r,n);n(null,r)}))};var n=o(fd.exports),r=o(dd),i=hd;function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e){return t.then((function(t){s(e,null,t)}),(function(t){s(e,t&&t.message?t:new Error(t))}))}function s(t,e,n){try{t(e,n)}catch(t){(0,r.default)((function(t){throw t}),t)}}t.exports=e.default}(pd,pd.exports),Object.defineProperty(hd,"__esModule",{value:!0}),hd.isAsyncIterable=hd.isAsyncGenerator=hd.isAsync=void 0;var bd,wd=(bd=pd.exports)&&bd.__esModule?bd:{default:bd};function Sd(t){return"AsyncFunction"===t[Symbol.toStringTag]}hd.default=function(t){if("function"!=typeof t)throw new Error("expected a function");return Sd(t)?(0,wd.default)(t):t},hd.isAsync=Sd,hd.isAsyncGenerator=function(t){return"AsyncGenerator"===t[Symbol.toStringTag]},hd.isAsyncIterable=function(t){return"function"==typeof t[Symbol.asyncIterator]};var Ed={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){void 0===e&&(e=t.length);if(!e)throw new Error("arity is undefined");return function(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[e-1]?t.apply(this,r):new Promise((function(i,o){r[e-1]=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(t)return o(t);i(e.length>1?e:e[0])},t.apply(n,r)}))}},t.exports=e.default}(Ed,Ed.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=o(cd.exports),r=o(hd),i=o(Ed.exports);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)((function(t,e,i){var o=(0,n.default)(e)?[]:{};t(e,(function(t,e,n){(0,r.default)(t)((function(t){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[e]=r,n(t)}))}),(function(t){return i(t,o)}))}),3),t.exports=e.default}(ld,ld.exports);var Ad={exports:{}},Td={exports:{}},Cd={exports:{}},kd={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(null!==t){var r=t;t=null,r.apply(this,e)}}return Object.assign(e,t),e},t.exports=e.default}(kd,kd.exports);var Md={exports:{}},Id={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},t.exports=e.default}(Id,Id.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if((0,n.default)(t))return function(t){var e=-1,n=t.length;return function(){return++e<n?{value:t[e],key:e}:null}}(t);var e=(0,r.default)(t);return e?function(t){var e=-1;return function(){var n=t.next();return n.done?null:(e++,{value:n.value,key:e})}}(e):function(t){var e=t?Object.keys(t):[],n=-1,r=e.length;return function i(){var o=e[++n];return"__proto__"===o?i():n<r?{value:t[o],key:o}:null}}(t)};var n=i(cd.exports),r=i(Id.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(Md,Md.exports);var Pd={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(null===t)throw new Error("Callback was already called.");var r=t;t=null,r.apply(this,e)}},t.exports=e.default}(Pd,Pd.exports);var Ld={exports:{}},Rd={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.default={},t.exports=e.default}(Rd,Rd.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,r,i){var o=!1,a=!1,s=!1,u=0,l=0;function c(){u>=e||s||o||(s=!0,t.next().then((function(t){var e=t.value,n=t.done;if(!a&&!o){if(s=!1,n)return o=!0,void(u<=0&&i(null));u++,r(e,l,h),l++,c()}})).catch(p))}function h(t,e){if(u-=1,!a)return t?p(t):!1===t?(o=!0,void(a=!0)):e===n.default||o&&u<=0?(o=!0,i(null)):void c()}function p(t){a||(s=!1,o=!0,i(t))}c()};var n=function(t){return t&&t.__esModule?t:{default:t}}(Rd.exports);t.exports=e.default}(Ld,Ld.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=u(kd.exports),r=u(Md.exports),i=u(Pd.exports),o=hd,a=u(Ld.exports),s=u(Rd.exports);function u(t){return t&&t.__esModule?t:{default:t}}e.default=function(t){return function(e,u,l){if(l=(0,n.default)(l),t<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!e)return l(null);if((0,o.isAsyncGenerator)(e))return(0,a.default)(e,t,u,l);if((0,o.isAsyncIterable)(e))return(0,a.default)(e[Symbol.asyncIterator](),t,u,l);var c=(0,r.default)(e),h=!1,p=!1,f=0,d=!1;function v(t,e){if(!p)if(f-=1,t)h=!0,l(t);else if(!1===t)h=!0,p=!0;else{if(e===s.default||h&&f<=0)return h=!0,l(null);d||m()}}function m(){for(d=!0;f<t&&!h;){var e=c();if(null===e)return h=!0,void(f<=0&&l(null));f+=1,u(e.value,e.key,(0,i.default)(v))}d=!1}m()}},t.exports=e.default}(Cd,Cd.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=o(Cd.exports),r=o(hd),i=o(Ed.exports);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)((function(t,e,i,o){return(0,n.default)(e)(t,(0,r.default)(i),o)}),4),t.exports=e.default}(Td,Td.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=i(Td.exports),r=i(Ed.exports);function i(t){return t&&t.__esModule?t:{default:t}}e.default=(0,r.default)((function(t,e,r){return(0,n.default)(t,1,e,r)}),3),t.exports=e.default}(Ad,Ad.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,n.default)(r.default,t,e)};var n=i(ld.exports),r=i(Ad.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(ud,ud.exports);var Od=sd(ud.exports),Dd=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,Od(this.tasks)},t.prototype.tap=function(t,e){var n=this;this.tasks.push((function(r){e.apply(void 0,ad([],od(n.args),!1)),r(null,t)}))},t}(),Nd={exports:{}},zd={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=l(cd.exports),r=l(Rd.exports),i=l(Td.exports),o=l(kd.exports),a=l(Pd.exports),s=l(hd),u=l(Ed.exports);function l(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n){n=(0,o.default)(n);var i=0,s=0,u=t.length,l=!1;function c(t,e){!1===t&&(l=!0),!0!==l&&(t?n(t):++s!==u&&e!==r.default||n(null))}for(0===u&&n(null);i<u;i++)e(t[i],i,(0,a.default)(c))}function h(t,e,n){return(0,i.default)(t,1/0,e,n)}e.default=(0,u.default)((function(t,e,r){return((0,n.default)(t)?c:h)(t,(0,s.default)(e),r)}),3),t.exports=e.default}(zd,zd.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,r.default)(n.default,t,e)};var n=i(zd.exports),r=i(ld.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(Nd,Nd.exports);var Fd={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=a(kd.exports),r=a(Pd.exports),i=a(hd),o=a(Ed.exports);function a(t){return t&&t.__esModule?t:{default:t}}e.default=(0,o.default)((function(t,e){if(e=(0,n.default)(e),!Array.isArray(t))return e(new Error("First argument to waterfall must be an array of functions"));if(!t.length)return e();var o=0;function a(e){(0,i.default)(t[o++]).apply(void 0,e.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===t.length?e.apply(void 0,[n].concat(r)):void a(r)}a([])})),t.exports=e.default}(Fd,Fd.exports);var Bd=sd(Fd.exports),Ud=function(){function t(){this.tasks=[]}return t.prototype.call=function(){return Od(this.tasks)},t.prototype.tap=function(t,e){this.tasks.push((function(n){n(e(),t)}))},t}(),jd=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,Od(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push((function(r){return rd(n,void 0,void 0,(function(){return id(this,(function(n){switch(n.label){case 0:return[4,e.apply(void 0,ad([],od(this.args),!1))];case 1:return n.sent(),r(null,t),[2]}}))}))}))},t}(),Vd=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,Od(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push((function(r){return rd(n,void 0,void 0,(function(){var n;return id(this,(function(i){switch(i.label){case 0:return[4,e.apply(void 0,ad([],od(this.args),!1))];case 1:return n=i.sent(),r(n,t),[2]}}))}))}))},t}(),Gd=function(){function t(){this.tasks=[]}return t.prototype.promise=function(){return Bd(this.tasks)},t.prototype.tapPromise=function(t,e){0===this.tasks.length?this.tasks.push((function(t){e().then((function(e){t(null,e)}))})):this.tasks.push((function(t,n){e(t).then((function(t){n(null,t)}))}))},t}(),Hd={exports:{}};function Wd(t){var e=t.target||t.srcElement;e.__resizeRAF__&&cancelAnimationFrame(e.__resizeRAF__),e.__resizeRAF__=requestAnimationFrame((function(){var n=e.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(e){e.call(n,t)}))}))}var Zd=function(t,e){var n,r=this.document,i=r.attachEvent;if("undefined"!=typeof navigator&&(n=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!t.__resizeListeners__)if(t.__resizeListeners__=[],i)t.__resizeTrigger__=t,t.attachEvent("onresize",Wd);else{"static"===getComputedStyle(t).position&&(t.style.position="relative");var o=t.__resizeTrigger__=r.createElement("object");o.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),o.setAttribute("class","resize-sensor"),o.setAttribute("tabindex","-1"),o.setAttribute("title",""),o.__resizeElement__=t,o.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",Wd)},o.type="text/html",n&&t.appendChild(o),o.data="about:blank",n||t.appendChild(o)}t.__resizeListeners__.push(e)};Hd.exports="undefined"==typeof window?Zd:Zd.bind(window);var qd,Xd,Yd,Kd,Qd,Jd,$d,tv,ev,nv,rv,iv,ov,av,sv,uv,lv,cv,hv,pv,fv,dv,vv,mv,yv,gv,_v,xv,bv,wv,Sv,Ev,Av,Tv,Cv,kv=Hd.exports.unbind=function(t,e){var n=document.attachEvent,r=t.__resizeListeners__||[];if(e){var i=r.indexOf(e);-1!==i&&r.splice(i,1)}else r=t.__resizeListeners__=[];if(!r.length){if(n)t.detachEvent("onresize",Wd);else if(t.__resizeTrigger__){var o=t.__resizeTrigger__.contentDocument,a=o&&o.defaultView;a&&(a.removeEventListener("resize",Wd),delete a.__resizeTrigger__),t.__resizeTrigger__=!t.removeChild(t.__resizeTrigger__)}delete t.__resizeListeners__}},Mv=Hd.exports;function Iv(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Pv=(qd=ku.injectable(),Xd=ku.inject(Hh.SceneID),Yd=ku.inject(Hh.IIconService),Kd=ku.inject(Hh.IFontService),Qd=ku.inject(Hh.IControlService),Jd=ku.inject(Hh.IGlobalConfigService),$d=ku.inject(Hh.IMapService),tv=ku.inject(Hh.ICoordinateSystemService),ev=ku.inject(Hh.IRendererService),nv=ku.inject(Hh.ILayerService),rv=ku.inject(Hh.IDebugService),iv=ku.inject(Hh.ICameraService),ov=ku.inject(Hh.IInteractionService),av=ku.inject(Hh.IPickingService),sv=ku.inject(Hh.IShaderModuleService),uv=ku.inject(Hh.IMarkerService),lv=ku.inject(Hh.IPopupService),qd((hv=function(t){Oe(i,t);var e,n,r=Iv(i);function i(){var t;return Ee(this,i),kt(De(t=r.call(this)),"destroyed",!1),kt(De(t),"loaded",!1),Rp(De(t),"id",pv,De(t)),Rp(De(t),"iconService",fv,De(t)),Rp(De(t),"fontService",dv,De(t)),Rp(De(t),"controlService",vv,De(t)),Rp(De(t),"configService",mv,De(t)),Rp(De(t),"map",yv,De(t)),Rp(De(t),"coordinateSystemService",gv,De(t)),Rp(De(t),"rendererService",_v,De(t)),Rp(De(t),"layerService",xv,De(t)),Rp(De(t),"debugService",bv,De(t)),Rp(De(t),"cameraService",wv,De(t)),Rp(De(t),"interactionService",Sv,De(t)),Rp(De(t),"pickingService",Ev,De(t)),Rp(De(t),"shaderModuleService",Av,De(t)),Rp(De(t),"markerService",Tv,De(t)),Rp(De(t),"popupService",Cv,De(t)),kt(De(t),"inited",!1),kt(De(t),"initPromise",void 0),kt(De(t),"rendering",!1),kt(De(t),"$container",void 0),kt(De(t),"canvas",void 0),kt(De(t),"markerContainer",void 0),kt(De(t),"hooks",void 0),kt(De(t),"handleWindowResized",(function(){t.emit("resize"),t.$container&&(t.initContainer(),function(){if("function"==typeof Event)tr.dispatchEvent(new Event("resize"));else{var t=tr.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,tr,0),tr.dispatchEvent(t)}}(),t.coordinateSystemService.needRefresh=!0,t.render())})),kt(De(t),"handleMapCameraChanged",(function(e){t.cameraService.update(e),t.render()})),t.hooks={init:new jd},t}return Te(i,[{key:"init",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return e.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.debugService.log("map.mapInitStart",{type:e.map.version}),t.next=3,new Promise((function(t){e.map.onCameraChanged((function(n){e.cameraService.init(),e.cameraService.update(n),t()})),e.map.init()}));case 3:e.map.onCameraChanged(e.handleMapCameraChanged),e.map.addMarkerContainer(),e.markerService.addMarkers(),e.markerService.addMarkerLayers(),e.popupService.initPopup(),e.interactionService.init(),e.interactionService.on(rf.Drag,e.addSceneEvent.bind(e));case 10:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",Zt(Kt.mark((function n(){var r,i;return Kt.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.map.getOverlayContainer(),e.$container=r||Mf(e.configService.getSceneConfig(e.id).id||""),!e.$container){n.next=13;break}return e.canvas=ri("canvas","",e.$container),e.setCanvas(),n.next=7,e.rendererService.init(e.canvas,e.configService.getSceneConfig(e.id),t.gl);case 7:e.registerContextLost(),e.initContainer(),Mv(e.$container,e.handleWindowResized),tr.matchMedia&&(null===(i=tr.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===i||i.addListener(e.handleWindowResized)),n.next=14;break;case 13:console.error("容器 id 不存在");case 14:e.pickingService.init(e.id);case 15:case"end":return n.stop()}}),n)})))),this.render()}},{key:"registerContextLost",value:function(){var t=this,e=this.rendererService.getCanvas();e&&e.addEventListener("webglcontextlost",(function(){return t.emit("webglcontextlost")}))}},{key:"initMiniScene",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return e.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){e.map.onCameraChanged((function(n){e.cameraService.init(),e.cameraService.update(n),"GAODE2.x"!==e.map.version&&t()})),e.map.initMiniMap()}));case 2:e.map.onCameraChanged(e.handleMapCameraChanged),e.interactionService.init(),e.interactionService.on(rf.Drag,e.addSceneEvent.bind(e));case 5:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",Zt(Kt.mark((function n(){var r;return Kt.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.canvas,e.$container=r||null,!e.$container){n.next=7;break}return n.next=5,e.rendererService.init(t.canvas,e.configService.getSceneConfig(e.id),void 0);case 5:n.next=8;break;case 7:console.error("容器 id 不存在");case 8:e.pickingService.init(e.id);case 9:case"end":return n.stop()}}),n)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.rendering&&!this.destroyed){t.next=2;break}return t.abrupt("return");case 2:if(this.rendering=!0,this.inited){t.next=16;break}return t.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),t.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,t.next=20;break;case 16:return t.next=18,this.layerService.initLayers();case 18:return t.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"addFontFace",value:function(t,e){this.fontService.addFontFace(t,e)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:(e=Zt(Kt.mark((function t(e){var n,r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=null===(n=this.$container)||void 0===n?void 0:n.getElementsByTagName("canvas")[0],t.next=3,this.render();case 3:return i="jpg"===e?null==r?void 0:r.toDataURL("image/jpeg"):null==r?void 0:r.toDataURL("image/png"),t.abrupt("return",i);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;null!==t&&(this.markerContainer=ri("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t,e,n=this;if(this.inited){var r;if(kv(this.$container,this.handleWindowResized),tr.matchMedia)null===(r=tr.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===r||r.removeListener(this.handleWindowResized);this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout((function(){var t;null===(t=n.$container)||void 0===t||t.removeChild(n.canvas),n.canvas=null,n.rendererService.destroy()})),null===(t=this.$container)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$container),this.emit("destroy")}else this.destroyed=!0}},{key:"initContainer",value:function(){var t,e,n=hi,r=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var t,e,n=hi,r=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),i}(Oi.exports.EventEmitter),pv=Op(hv.prototype,"id",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fv=Op(hv.prototype,"iconService",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dv=Op(hv.prototype,"fontService",[Kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vv=Op(hv.prototype,"controlService",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mv=Op(hv.prototype,"configService",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yv=Op(hv.prototype,"map",[$d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gv=Op(hv.prototype,"coordinateSystemService",[tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_v=Op(hv.prototype,"rendererService",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xv=Op(hv.prototype,"layerService",[nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bv=Op(hv.prototype,"debugService",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wv=Op(hv.prototype,"cameraService",[iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sv=Op(hv.prototype,"interactionService",[ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ev=Op(hv.prototype,"pickingService",[av],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Av=Op(hv.prototype,"shaderModuleService",[sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=Op(hv.prototype,"markerService",[uv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cv=Op(hv.prototype,"popupService",[lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cv=hv))||cv);var Lv,Rv=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Ov(t){var e={};return{content:t=t.replace(Rv,(function(t,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(t,e){return t.push(Number(e.trim())),t}),[]):new Array(function(t){var e=0;switch(t){case"vec2":case"ivec2":e=2;break;case"vec3":case"ivec3":e=3;break;case"vec4":case"ivec4":case"mat2":e=4;break;case"mat3":e=9;break;case"mat4":e=16}return e}(n)).fill(0)}return e[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:e}}var Dv,Nv,zv="#define PI 3.14159265359",Fv=/precision\s+(high|low|medium)p\s+float/,Bv=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,Uv=/void\s+main\s*\([^)]*\)\s*\{\n?/,jv=ku.injectable()(Lv=function(){function t(){Ee(this,t),kt(this,"moduleCache",{}),kt(this,"rawContentCache",{})}return Te(t,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:zv,fs:zv}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n\n#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0           // amap\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0\n\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\n\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\n\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\n\n// uniform mat4 u_Mvp;\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01\n// reverse Y\nvec3 reverse_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\n    return vector * vec3(1.0, -1.0, 1.0);\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return vector;\n  }\n  return vector;\n}\n\nvec4 project_mvt_offset_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return project_offset(vec4(0.0, 0.0, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  return position;\n}\n\nvec4 project_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(vec4(X, Y, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return vec4(\n      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // return vec4(\n    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), \n    //   project_scale(position.z), \n    //   position.w);\n\n     return vec4(\n      position.xy, \n      project_scale(position.z), \n      position.w);\n  }\n  return position;\n\n  // TODO: 瓦片坐标系 & 常规世界坐标系\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\nfloat project_pixel_allmap(float pixel) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    return pixel * pow(2.0, u_Zoom);\n  }\n  return pixel * u_FocalDistance ;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;\n  }\n\n  // amap2 zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n\n  // amap zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;\n  }\n  \n  // amap zoom < 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * 2.0 *  u_FocalDistance;;\n}\n\n// 在不论什么底图下需要统一处理的时候使用\nfloat project_float_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // mapbox P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\n\nfloat project_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\nvec2 project_pixel(vec2 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\nvec3 project_pixel(vec3 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n     pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\n\nbool isEqual( float a,  float b) {\n    return  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {\n//   vec3 lightDir = normalize(light.position - fragPos);\n//   // diffuse shading\n//   float diff = max(dot(normal, lightDir), 0.0);\n//   // specular shading\n//   vec3 reflectDir = reflect(-lightDir, normal);\n//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);\n//   // attenuation\n//   float distance = length(light.position - fragPos);\n//   float attenuation = 1.0 / (light.constant + light.linear * distance +\n//           light.quadratic * (distance * distance));\n\n//   vec3 ambient = light.ambient * u_Ambient;\n//   vec3 diffuse = light.diffuse * diff * u_Diffuse;\n//   vec3 specular = light.specular * spec * u_Specular;\n\n//   float spotEffect = dot(normalize(light.direction), -lightDir);\n//   float spotCosCutoff = cos(light.angle / 180.0 * PI);\n//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);\n//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);\n//   if (spotEffect > spotCosCutoff) {\n//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);\n//   } else {\n//     spotEffect = 0.0;\n//   }\n\n//   return ambient + attenuation * (spotEffect * diffuse + specular);\n// }\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {\n  //   if (i >= u_NumOfSpotLights) {\n  //     break;\n  //   }\n  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);\n  // }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\n\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec3 u_CurrentSelectedId : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\nuniform float u_shaderPick;\nuniform float u_EnableSelect: 0.0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\n\n// 判断当前点是否已经被 select 选中\nbool isVertexSelected(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {\n  //   // 选中态\n  //   v_PickingResult.a = SELECT;\n  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {\n  //   // 高亮态\n  //   v_PickingResult.a = HIGHLIGHT;\n  // } else {\n  //   v_PickingResult.a = NORMAL;\n  // }\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_shaderPick;\n\nuniform float u_activeMix: 0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  // float selected = v_PickingResult.a;\n  bool selected = bool(v_PickingResult.a);\n\n  // if (selected == SELECT) {\n  if (selected) {\n  //   // 点击选中状态\n  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;\n  //   return selectColor;\n  // } else if (selected == HIGHLIGHT) {\n  //   // hover 高亮状态\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n"}),this.registerModule("commom_attr_vert",{vs:"#ifdef USE_ATTRIBUTE_OPACITY\n  attribute float a_Opacity;\n#endif\n\n#ifdef USE_ATTRIBUTE_OFFSETS\n  attribute vec2 a_Offsets;\n#endif\n\n#ifdef USE_ATTRIBUTE_STROKE\n  attribute vec4 a_Stroke;\n#endif",fs:""}),this.registerModule("opacity_attr_vert",{vs:"float opacity = u_opacity;\n\n#ifdef USE_ATTRIBUTE_OPACITY\n    opacity = a_Opacity;\n#endif",fs:""})}},{key:"registerModule",value:function(t,e){var n=e.vs,r=e.fs,i=e.uniforms,o=e.inject,a=Ov(n),s=a.content,u=a.uniforms,l=Ov(r),c=l.content,h=l.uniforms;this.rawContentCache[t]={fs:c,inject:o,uniforms:It(It(It({},u),h),i),vs:s}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var e=this,n=this.rawContentCache[t].vs,r=this.rawContentCache[t].fs,i=this.rawContentCache[t].inject,o={};null!=i&&i["vs:#decl"]&&(n=(null==i?void 0:i["vs:#decl"])+n,o=Ov(null==i?void 0:i["vs:#decl"]).uniforms),null!=i&&i["vs:#main-start"]&&(n=n.replace(Uv,(function(t){return t+(null==i?void 0:i["vs:#main-start"])})));var a=this.processModule(n,[],"vs"),s=a.content,u=a.includeList,l=this.processModule(r,[],"fs"),c=l.content,h=l.includeList,p="",f=ti.exports.uniq(u.concat(h).concat(t)).reduce((function(t,n){return It(It({},t),e.rawContentCache[n].uniforms)}),It({},o));return Fv.test(c)||(p+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"),p+=c,this.moduleCache[t]={fs:p.trim(),uniforms:f,vs:s.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,e,n){var r=this;return{content:t.replace(Bv,(function(t,i){var o=i.split(" ")[0].replace(/"/g,"");if(e.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return e.push(o),r.processModule(a,e,n).content})),includeList:e}}},{key:"injectDefines",value:function(t){return Object.keys(t).reduce((function(e,n){return e+"#define ".concat(n.toUpperCase()," ").concat(t[n],";\n")}),"\n")}}]),t}())||Lv;function Vv(){return Vv="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ze(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Vv.apply(this,arguments)}!function(t){t.Normal="normal",t.PostProcessing="post-processing"}(Dv||(Dv={}));var Gv,Hv=ku.injectable()(Nv=function(){function t(){Ee(this,t),kt(this,"shaderModuleService",void 0),kt(this,"rendererService",void 0),kt(this,"cameraService",void 0),kt(this,"mapService",void 0),kt(this,"interactionService",void 0),kt(this,"layerService",void 0),kt(this,"config",void 0)}return Te(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Dv.Normal}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(Hh.IRendererService),this.cameraService=t.getContainer().get(Hh.ICameraService),this.mapService=t.getContainer().get(Hh.IMapService),this.interactionService=t.getContainer().get(Hh.IInteractionService),this.layerService=t.getContainer().get(Hh.ILayerService),this.shaderModuleService=t.getContainer().get(Hh.IShaderModuleService)}},{key:"render",value:function(t){}}]),t}())||Nv;function Wv(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Zv,qv,Xv,Yv,Kv,Qv=ku.injectable()(Gv=function(t){Oe(n,t);var e=Wv(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,e){Vv(ze(n.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(Hv))||Gv;function Jv(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return $v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $v(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function $v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var tm,em=(Zv=ku.injectable(),qv=ku.inject(Hh.IPostProcessor),Zv((Yv=function(){function t(){Ee(this,t),kt(this,"passes",[]),Rp(this,"postProcessor",Kv,this),kt(this,"layer",void 0),kt(this,"renderFlag",void 0),kt(this,"width",0),kt(this,"height",0)}var e;return Te(t,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(e=Zt(Kt.mark((function t(){var e,n,r;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Jv(this.passes),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=9;break}return r=n.value,t.next=7,r.render(this.layer);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.e(t.t0);case 14:return t.prev=14,e.f(),t.finish(14);case 17:return t.next=19,this.postProcessor.render(this.layer);case 19:case"end":return t.stop()}}),t,this,[[1,11,14,17]])}))),function(){return e.apply(this,arguments)})},{key:"resize",value:function(t,e){this.width===t&&this.height===e||(this.postProcessor.resize(t,e),this.width=t,this.height=e)}},{key:"add",value:function(t,e){t.getType()===Dv.PostProcessing?this.postProcessor.add(t,this.layer,e):(t.init(this.layer,e),this.passes.push(t))}},{key:"insert",value:function(t,e,n){t.init(this.layer,e),this.passes.splice(n,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),t}(),Kv=Op(Yv.prototype,"postProcessor",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xv=Yv))||Xv);function nm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var rm,im,om,am,sm,um,lm=ku.injectable()(tm=function(t){Oe(n,t);var e=nm(n);function n(){var t;Ee(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return kt(De(t=e.call.apply(e,[this].concat(i))),"pickingFBO",void 0),kt(De(t),"layer",void 0),kt(De(t),"width",0),kt(De(t),"height",0),kt(De(t),"alreadyInRendering",!1),kt(De(t),"pickFromPickingFBO",(function(e){var n=e.x,r=e.y,i=e.lngLat,o=e.type;if(t.layer.isVisible()&&t.layer.needPick(o)){var a,s=t.rendererService,u=s.getViewportSize,l=s.readPixels,c=s.useFramebuffer,h=u(),p=h.width,f=h.height,d=t.layer.getLayerConfig(),v=d.enableHighlight,m=d.enableSelect,y=n*hi,g=r*hi;if(!(y>p||y<0||g>f||g<0))c(t.pickingFBO,(function(){var e;if(0!==(a=l({x:Math.round(y),y:Math.round(f-(r+1)*hi),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO}))[0]||0!==a[1]||0!==a[2]){var s=Wr(a),u=t.layer.getSource().getFeatureById(s),c={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(t.layer.setCurrentPickId(s),t.triggerHoverOnLayer(c))}else{var h={x:n,y:r,lngLat:i,type:null===t.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};t.triggerHoverOnLayer(It(It({},h),{},{type:"unpick"})),t.triggerHoverOnLayer(h),t.layer.setCurrentPickId(null)}v&&t.highlightPickedFeature(a),m&&"click"===o&&(null===(e=a)||void 0===e?void 0:e.toString())!==[0,0,0,0].toString()&&t.selectFeature(a)}))}})),t}return Te(n,[{key:"getType",value:function(){return Dv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,e){Vv(ze(n.prototype),"init",this).call(this,t,e),this.layer=t;var r=this.rendererService,i=r.createTexture2D,o=r.createFramebuffer,a=(0,r.getViewportSize)(),s=a.width,u=a.height;this.pickingFBO=o({color:i({width:s,height:u,wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE})}),this.interactionService.on(rf.Hover,this.pickFromPickingFBO),this.interactionService.on(rf.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(rf.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var e=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=e.layer.multiPassRenderer.getRenderFlag();e.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),e.layer.multiPassRenderer.setRenderFlag(n),e.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var e=$r(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var e=$r(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var e=Zr(t.featureId);this.selectFeature(new Uint8Array(e))}},{key:"highlightFeatureHandle",value:function(t){var e=Zr(t.featureId);this.highlightPickedFeature(new Uint8Array(e))}}]),n}(Hv))||tm,cm=(rm=ku.injectable(),im=ku.inject(Hh.IShaderModuleService),rm((am=function(){function t(){Ee(this,t),Rp(this,"shaderModuleService",sm,this),kt(this,"rendererService",void 0),kt(this,"config",void 0),kt(this,"quad","attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}"),kt(this,"enabled",!0),kt(this,"renderToScreen",!1),kt(this,"model",void 0),kt(this,"name",void 0),kt(this,"optionsToUpdate",{})}return Te(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Dv.PostProcessing}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(Hh.IRendererService),this.shaderModuleService=t.getContainer().get(Hh.IShaderModuleService);var n=this.rendererService,r=n.createAttribute,i=n.createBuffer,o=n.createModel,a=this.setupShaders(),s=a.vs,u=a.fs,l=a.uniforms;this.model=o({vs:s,fs:u,attributes:{a_Position:r({buffer:i({data:[-4,-4,4,-4,0,4],type:pf.FLOAT}),size:2})},uniforms:It(It({u_Texture:null},l),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(t,e){var n=this,r=t.multiPassRenderer.getPostProcessor(),i=this.rendererService,o=i.useFramebuffer,a=i.getViewportSize,s=i.clear,u=a(),l=u.width,c=u.height;o(this.renderToScreen?null:r.getWriteFBO(),(function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var t=It({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[l,c]},n.convertOptionsToUniforms(n.optionsToUpdate));e&&(t.u_BloomFinal=1,t.u_Texture2=e),n.model.draw({uniforms:t})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=It(It({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var e={};return Object.keys(t).forEach((function(n){ti.exports.isNil(t[n])||(e["u_".concat(ti.exports.upperFirst(ti.exports.camelCase(n)))]=t[n])})),e}}]),t}(),sm=Op(am.prototype,"shaderModuleService",[im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=am))||om);function hm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var pm,fm=ku.injectable()(um=function(t){Oe(n,t);var e=hm(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:It(It({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return ti.exports.isNil(t.bloomRadius)||(e.u_radius=t.bloomRadius),ti.exports.isNil(t.bloomIntensity)||(e.u_intensity=t.bloomIntensity),ti.exports.isNil(t.bloomBaseRadio)||(e.u_baseRadio=t.bloomBaseRadio),e}}]),n}(cm))||um;function dm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var vm,mm=ku.injectable()(pm=function(t){Oe(n,t);var e=dm(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:It(It({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return ti.exports.isNil(t.blurRadius)||(e.u_BlurDir=[t.blurRadius,0]),e}}]),n}(cm))||pm;function ym(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var gm,_m=ku.injectable()(vm=function(t){Oe(n,t);var e=ym(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:It(It({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return ti.exports.isNil(t.blurRadius)||(e.u_BlurDir=[0,t.blurRadius]),e}}]),n}(cm))||vm;function xm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var bm,wm=ku.injectable()(gm=function(t){Oe(n,t);var e=xm(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var t=this.shaderModuleService.getModule("colorhalftone-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:It(It({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(cm))||gm;function Sm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Em,Am=ku.injectable()(bm=function(t){Oe(n,t);var e=Sm(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}"}),this.shaderModuleService.getModule("copy-pass")}}]),n}(cm))||bm;function Tm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Cm,km=ku.injectable()(Em=function(t){Oe(n,t);var e=Tm(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:It(It({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(cm))||Em;function Mm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Im,Pm=ku.injectable()(Cm=function(t){Oe(n,t);var e=Mm(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var t=this.shaderModuleService.getModule("ink-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:It(It({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(cm))||Cm;function Lm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Rm,Om=ku.injectable()(Im=function(t){Oe(n,t);var e=Lm(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),n}(cm))||Im;function Dm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Nm,zm,Fm,Bm,Um,jm,Vm,Gm=ku.injectable()(Rm=function(t){Oe(n,t);var e=Dm(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(cm))||Rm,Hm=(Nm=ku.injectable(),zm=ku.inject(Hh.IRendererService),Fm=ku.postConstruct(),Nm((Um=function(){function t(){Ee(this,t),Rp(this,"rendererService",jm,this),kt(this,"passes",[]),kt(this,"readFBO",void 0),kt(this,"writeFBO",void 0)}var e,n;return Te(t,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,e=t.getViewportSize,n=t.createTexture2D,r=e();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,e=this.rendererService.useFramebuffer;return new Promise((function(n){e(t.readFBO,Zt(Kt.mark((function e(){return Kt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(t.getCurrentFBOTex());case 1:case"end":return e.stop()}}),e)}))))}))}},{key:"renderBloomPass",value:(n=Zt(Kt.mark((function t(e,n){var r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getReadFBOTex();case 2:r=t.sent,i=0;case 4:if(!(i<4)){t.next=11;break}return t.next=7,n.render(e,r);case 7:this.swap(),i++,t.next=4;break;case 11:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"render",value:(e=Zt(Kt.mark((function t(e){var n,r;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<this.passes.length)){t.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){t.next=9;break}return t.next=7,this.renderBloomPass(e,r);case 7:t.next=12;break;case 9:return t.next=11,r.render(e);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,t.next=1;break;case 15:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"resize",value:function(t,e){this.readFBO.resize({width:t,height:e}),this.writeFBO.resize({width:t,height:e})}},{key:"add",value:function(t,e,n){t.init(e,n),this.passes.push(t)}},{key:"insert",value:function(t,e,n,r){t.init(n,r),this.passes.splice(e,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find((function(e){return e.getName()===t}))}},{key:"init",value:function(){var t=this.rendererService,e=t.createFramebuffer,n=t.createTexture2D;this.readFBO=e({color:n({width:1,height:1,wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE})}),this.writeFBO=e({color:n({width:1,height:1,wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),t}(),jm=Op(Um.prototype,"rendererService",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Op(Um.prototype,"init",[Fm],Object.getOwnPropertyDescriptor(Um.prototype,"init"),Um.prototype),Bm=Um))||Bm);function Wm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Zm,qm,Xm,Ym,Km,Qm=ku.injectable()(Vm=function(t){Oe(n,t);var e=Wm(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"getType",value:function(){return Dv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,e){Vv(ze(n.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(t){var e=this.rendererService,n=e.useFramebuffer,r=e.clear,i=t.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach((function(e){e.draw({uniforms:t.layerModel.getUninforms()})})),t.multiPassRenderer.setRenderFlag(!0)}))}}]),n}(Hv))||Vm;function Jm(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var $m="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}";function ty(t,e){for(var n=0,r=1/e,i=t;i>0;)n+=r*(i%e),i=Math.floor(i/e),r/=e;return n}var ey=1,ny=(Zm=ku.injectable(),qm=ku.inject(Hh.IShaderModuleService),Zm((Ym=function(t){Oe(n,t);var e=Jm(n);function n(){var t;Ee(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return Rp(De(t=e.call.apply(e,[this].concat(i))),"shaderModuleService",Km,De(t)),kt(De(t),"haltonSequence",[]),kt(De(t),"accumulatingId",0),kt(De(t),"frame",0),kt(De(t),"timer",void 0),kt(De(t),"sampleRenderTarget",void 0),kt(De(t),"prevRenderTarget",void 0),kt(De(t),"outputRenderTarget",void 0),kt(De(t),"copyRenderTarget",void 0),kt(De(t),"blendModel",void 0),kt(De(t),"outputModel",void 0),kt(De(t),"copyModel",void 0),t}return Te(n,[{key:"getType",value:function(){return Dv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,e){Vv(ze(n.prototype),"init",this).call(this,t,e);var r=this.rendererService,i=r.createFramebuffer,o=r.createTexture2D;this.sampleRenderTarget=i({color:o({width:1,height:1,wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE})}),this.prevRenderTarget=i({color:o({width:1,height:1,wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE})}),this.outputRenderTarget=i({color:o({width:1,height:1,wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE})}),this.copyRenderTarget=i({color:o({width:1,height:1,wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([ty(a,2),ty(a,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\n\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  vec4 texel1 = texture2D(u_Diffuse1, v_UV);\n  vec4 texel2 = texture2D(u_Diffuse2, v_UV);\n  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}\n"),this.outputModel=this.createTriangleModel("copy-pass",$m,{blend:{enable:!0,func:{srcRGB:pf.ONE,dstRGB:pf.ONE_MINUS_SRC_ALPHA,srcAlpha:pf.ONE,dstAlpha:pf.ONE_MINUS_SRC_ALPHA},equation:{rgb:pf.FUNC_ADD,alpha:pf.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",$m)}},{key:"render",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var l=t.multiPassRenderer.getPostProcessor().getReadFBO();o(l,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)}));var c=function n(r){e.accumulatingId&&r===e.accumulatingId&&(e.isFinished()||(e.doRender(t),tr.requestAnimationFrame((function(){n(r)}))))};this.accumulatingId=ey++,this.timer=tr.setTimeout((function(){c(e.accumulatingId)}),50)}},{key:"doRender",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,l=t.getLayerConfig().jitterScale,c=void 0===l?1:l,h=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*h[0]-1)/s*c,(2*h[1]-1)/u*c),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.sampleRenderTarget}),t.render()})),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var p=t.getLayerConfig();o(this.outputRenderTarget,(function(){e.blendModel.draw({uniforms:{u_opacity:p.opacity||1,u_MixRatio:0===e.frame?1:.9,u_Diffuse1:e.sampleRenderTarget,u_Diffuse2:0===e.frame?t.multiPassRenderer.getPostProcessor().getReadFBO():e.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){e.outputModel.draw({uniforms:{u_Texture:e.outputRenderTarget}})})),o(t.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){e.copyModel.draw({uniforms:{u_Texture:e.copyRenderTarget}})})),t.multiPassRenderer.getPostProcessor().render(t));var f=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=f,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,tr.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,e,n){this.shaderModuleService.registerModule(t,{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:e});var r=this.shaderModuleService.getModule(t),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,l=s.createBuffer;return(0,s.createModel)(It({vs:i,fs:o,attributes:{a_Position:u({buffer:l({data:[-4,-4,4,-4,0,4],type:pf.FLOAT}),size:2})},uniforms:It({},a),depth:{enable:!1},count:3},n))}}]),n}(Hv),Km=Op(Ym.prototype,"shaderModuleService",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xm=Ym))||Xm),ry=new ku.Container;ry.bind(Hh.IGlobalConfigService).to(Lp).inSingletonScope(),ku.decorate(ku.injectable(),Oi.exports.EventEmitter),ry.bind(Hh.IEventEmitter).to(Oi.exports.EventEmitter);var iy=Gh(ry,!1),oy=function(t){var e=iy.lazyInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}},ay=0;function sy(t){var e=new ku.Container;return e.parent=t,e.bind(Hh.IStyleAttributeService).to(nd).inSingletonScope(),e.bind(Hh.IMultiPassRenderer).to(em).inSingletonScope(),e.bind(Hh.IPostProcessor).to(Hm).inSingletonScope(),e}var uy,ly,cy,hy="u_ProjectionMatrix",py="u_ViewMatrix",fy="u_ViewProjectionMatrix",dy="u_Zoom",vy="u_ZoomScale",yy="u_FocalDistance",gy="u_CameraPosition",_y="layerInitStart",xy="layerInitEnd",by="sourceInitStart",wy="sourceInitEnd",Sy="scaleInitStart",Ey="scaleInitEnd",Ay="mappingStart",Ty="mappingEnd",Cy="buildModelStart",ky="buildModelEnd";!function(t){t.LINEAR="linear",t.SEQUENTIAL="sequential",t.POWER="power",t.LOG="log",t.IDENTITY="identity",t.TIME="time",t.QUANTILE="quantile",t.QUANTIZE="quantize",t.THRESHOLD="threshold",t.CAT="cat",t.DIVERGING="diverging"}(uy||(uy={})),function(t){t.CONSTANT="constant",t.VARIABLE="variable"}(ly||(ly={})),function(t){t[t.Attribute=0]="Attribute",t[t.InstancedAttribute=1]="InstancedAttribute",t[t.Uniform=2]="Uniform"}(cy||(cy={}));var My,Iy=["mapload","mapchange","mapAfterFrameChange"],Py=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];!function(t){t.IMAGE="image",t.CUSTOMIMAGE="customImage",t.ARRAYBUFFER="arraybuffer",t.RGB="rgb",t.TERRAINRGB="terrainRGB",t.CUSTOMRGB="customRGB",t.CUSTOMARRAYBUFFER="customArrayBuffer",t.CUSTOMTERRAINRGB="customTerrainRGB"}(My||(My={}));var Ly=function(){var t=Zt(Kt.mark((function t(e,n,r,i){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,o){n({x:e.x,y:e.y,z:e.z},(function(e,n){e||0===n.length?o(e):n&&Au([{data:n,bands:[0]}],r,i,(function(e,n){e?o(e):n&&t(n)}))}))})));case 1:case"end":return t.stop()}}),t)})));return function(e,n,r,i){return t.apply(this,arguments)}}(),Ry=function(){var t=Zt(Kt.mark((function t(e,n){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){n({x:e.x,y:e.y,z:e.z},(function(e,n){var i,o;!e&&n?n instanceof ArrayBuffer?(i=n,o=function(e,n){e&&r(e),t(n)},"function"==typeof createImageBitmap?cr(i,o):lr(i,o)):n instanceof HTMLImageElement?t(n):r(e):r(e)}))})));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();function Oy(t,e){return Array.isArray(t)?"string"==typeof t[0]?t.map((function(t){return no(t,e)})):t.map((function(t){return{url:no(t.url,e),bands:t.bands||[0]}})):no(t,e)}function Dy(t,e){t.xhrCancel=function(){e.map((function(t){t.abort()}))}}var Ny=function(){var t=Zt(Kt.mark((function t(e,n,r,i,o){var a,s,u,l,c,h;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(p=n.url,!((a="string"==typeof p?[{url:p,bands:[0]}]:"string"==typeof p[0]?p.map((function(t){return{url:t,bands:[0]}})):p).length>1)){t.next=15;break}return t.next=4,zy(a,n);case 4:if(s=t.sent,u=s.rasterFiles,l=s.xhrList,c=s.errList,Dy(e,l),!(c.length>0)){t.next=12;break}return r(c,null),t.abrupt("return");case 12:Au(u,i,o,r),t.next=17;break;case 15:h=sr(n,(function(t,e){if(t)r(t);else if(e){Au([{data:e,bands:a[0].bands}],i,o,r)}})),Dy(e,[h]);case 17:case"end":return t.stop()}var p}),t)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}();function zy(t,e){return Fy.apply(this,arguments)}function Fy(){return Fy=Zt(Kt.mark((function t(e,n){var r,i,o,a,s,u,l,c,h,p,f;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<e.length)){t.next=20;break}return s=e[a],u=It(It({},n),{},{url:s.url}),l=s.bands,t.next=10,or(It(It({},u),{},{type:"arrayBuffer"}));case 10:c=t.sent,h=c.err,p=c.data,f=c.xhr,h&&o.push(h),i.push(f),r.push({data:p,bands:l});case 17:a++,t.next=4;break;case 20:return t.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return t.stop()}}),t)}))),Fy.apply(this,arguments)}var By=function(){var t=Zt(Kt.mark((function t(e,n,r,i,o){var a;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={url:Oy(e,n)},t.abrupt("return",new Promise((function(t,e){Ny(r,a,(function(n,r){n?e(n):r&&t(r)}),i,o)})));case 2:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}(),Uy=function(){var t=Zt(Kt.mark((function t(e,n,r,i){var o,a,s,u;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Array.isArray(e)?e[0]:e,i.wmtsOptions?(s=(null==i?void 0:i.getURLFromTemplate)||ro,o=s(a,It(It({},n),i.wmtsOptions))):(u=(null==i?void 0:i.getURLFromTemplate)||no,o=u(a,n)),t.abrupt("return",new Promise((function(t,e){var n,a=hr({url:o,type:(null==i||null===(n=i.requestParameters)||void 0===n?void 0:n.type)||"arrayBuffer"},(function(n,r){n?e(n):r&&t(r)}),i.transformResponse);r.xhrCancel=function(){return a.abort()}})));case 3:case"end":return t.stop()}}),t)})));return function(e,n,r,i){return t.apply(this,arguments)}}(),jy=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Vy={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};My.ARRAYBUFFER,My.RGB;var Gy=["extent","min","max","width","height","format","operation"];var Hy={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},Wy=function(){var t=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=$r(e.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3];t({layers:{testTile:{features:[{type:"Feature",properties:{key:e.x+"/"+e.y+"/"+e.z,x:(r+o)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}})})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var Zy={exports:{}};!function(t,e){t.exports=function(){function t(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;e(n,r,u,o,a,s%2),t(n,r,i,o,u-1,s+1),t(n,r,i,u+1,a,s+1)}}function e(t,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,l=i-o+1,c=Math.log(u),h=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*h*(u-h)/u)*(l-u/2<0?-1:1);e(t,r,i,Math.max(o,Math.floor(i-l*h/u+p)),Math.min(a,Math.floor(i+(u-l)*h/u+p)),s)}var f=r[2*i+s],d=o,v=a;for(n(t,r,o,i),r[2*a+s]>f&&n(t,r,o,a);d<v;){for(n(t,r,d,v),d++,v--;r[2*d+s]<f;)d++;for(;r[2*v+s]>f;)v--}r[2*o+s]===f?n(t,r,o,v):n(t,r,++v,a),v<=i&&(o=v+1),i<=v&&(a=v-1)}}function n(t,e,n,i){r(t,n,i),r(e,2*n,2*i),r(e,2*n+1,2*i+1)}function r(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function i(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),p=l.pop(),f=l.pop();if(p-f<=a)for(var d=f;d<=p;d++)s=e[2*d],u=e[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[d]);else{var v=Math.floor((f+p)/2);s=e[2*v],u=e[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[v]);var m=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(f),l.push(v-1),l.push(m)),(0===h?i>=s:o>=u)&&(l.push(v+1),l.push(p),l.push(m))}}return c}function o(t,e,n,r,i,o){for(var s=[0,t.length-1,0],u=[],l=i*i;s.length;){var c=s.pop(),h=s.pop(),p=s.pop();if(h-p<=o)for(var f=p;f<=h;f++)a(e[2*f],e[2*f+1],n,r)<=l&&u.push(t[f]);else{var d=Math.floor((p+h)/2),v=e[2*d],m=e[2*d+1];a(v,m,n,r)<=l&&u.push(t[d]);var y=(c+1)%2;(0===c?n-i<=v:r-i<=m)&&(s.push(p),s.push(d-1),s.push(y)),(0===c?n+i>=v:r+i>=m)&&(s.push(d+1),s.push(h),s.push(y))}}return u}function a(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}var s=function(t){return t[0]},u=function(t){return t[1]},l=function(e,n,r,i,o){void 0===n&&(n=s),void 0===r&&(r=u),void 0===i&&(i=64),void 0===o&&(o=Float64Array),this.nodeSize=i,this.points=e;for(var a=e.length<65536?Uint16Array:Uint32Array,l=this.ids=new a(e.length),c=this.coords=new o(2*e.length),h=0;h<e.length;h++)l[h]=h,c[2*h]=n(e[h]),c[2*h+1]=r(e[h]);t(l,c,i,0,l.length-1,0)};l.prototype.range=function(t,e,n,r){return i(this.ids,this.coords,t,e,n,r,this.nodeSize)},l.prototype.within=function(t,e,n){return o(this.ids,this.coords,t,e,n,this.nodeSize)};var c={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},h=Math.fround||function(t){return function(e){return t[0]=+e,t[0]}}(new Float32Array(1)),p=function(t){this.options=b(Object.create(c),t),this.trees=new Array(this.options.maxZoom+1)};function f(t,e,n,r,i){return{x:h(t),y:h(e),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function d(t,e){var n=t.geometry.coordinates,r=n[0],i=n[1];return{x:h(y(r)),y:h(g(i)),zoom:1/0,index:e,parentId:-1}}function v(t){return{type:"Feature",id:t.id,properties:m(t),geometry:{type:"Point",coordinates:[_(t.x),x(t.y)]}}}function m(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return b(b({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function y(t){return t/360+.5}function g(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function _(t){return 360*(t-.5)}function x(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function b(t,e){for(var n in e)t[n]=e[n];return t}function w(t){return t.x}function S(t){return t.y}return p.prototype.load=function(t){var e=this.options,n=e.log,r=e.minZoom,i=e.maxZoom,o=e.nodeSize;n&&console.time("total time");var a="prepare "+t.length+" points";n&&console.time(a),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(d(t[u],u));this.trees[i+1]=new l(s,w,S,o,Float32Array),n&&console.timeEnd(a);for(var c=i;c>=r;c--){var h=+Date.now();s=this._cluster(s,c),this.trees[c]=new l(s,w,S,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,s.length,+Date.now()-h)}return n&&console.timeEnd("total time"),this},p.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(y(n),g(o),y(i),g(r));c<h.length;c+=1){var p=h[c],f=u.points[p];l.push(f.numPoints?v(f):this.points[f.index])}return l},p.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=l[u],h=i.points[c];h.parentId===t&&s.push(h.numPoints?v(h):this.points[h.index])}if(0===s.length)throw new Error(r);return s},p.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,n,0),r},p.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((e-s)/i,u,(e+1+s)/i,l),r.points,e,n,i,c),0===e&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),e===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},p.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},p.prototype._appendLeaves=function(t,e,n,r,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},p.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l=u.numPoints,c=void 0,h=void 0,p=void 0;if(l)c=m(u),h=u.x,p=u.y;else{var f=this.points[u.index];c=f.properties,h=y(f.geometry.coordinates[0]),p=g(f.geometry.coordinates[1])}var d={type:1,geometry:[[Math.round(this.options.extent*(h*i-n)),Math.round(this.options.extent*(p*i-r))]],tags:c},v=void 0;l?v=u.id:this.options.generateId?v=u.index:this.points[u.index].id&&(v=this.points[u.index].id),void 0!==v&&(d.id=v),o.features.push(d)}},p.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))},p.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,e)),l=0;l<t.length;l++){var c=t[l];if(!(c.zoom<=e)){c.zoom=e;for(var h=this.trees[e+1],p=h.within(c.x,c.y,u),d=c.numPoints||1,v=d,m=0,y=p;m<y.length;m+=1){var g=y[m],_=h.points[g];_.zoom>e&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var x=c.x*d,b=c.y*d,w=a&&d>1?this._map(c,!0):null,S=(l<<5)+(e+1)+this.points.length,E=0,A=p;E<A.length;E+=1){var T=A[E],C=h.points[T];if(!(C.zoom<=e)){C.zoom=e;var k=C.numPoints||1;x+=C.x*k,b+=C.y*k,C.parentId=S,a&&(w||(w=this._map(c,!0)),a(w,this._map(C)))}}c.parentId=S,n.push(f(x/v,b/v,S,v,w))}else if(n.push(c),v>1)for(var M=0,I=p;M<I.length;M+=1){var P=I[M],L=h.points[P];L.zoom<=e||(L.zoom=e,n.push(L))}}}return n},p.prototype._getOriginId=function(t){return t-this.points.length>>5},p.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},p.prototype._map=function(t,e){if(t.numPoints)return e?b({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?b({},r):r},p}()}(Zy);var qy=Zy.exports;function Xy(t,e){var n=e.radius,r=void 0===n?40:n,i=e.maxZoom,o=void 0===i?18:i,a=e.minZoom,s=void 0===a?0:a,u=e.zoom,l=void 0===u?2:u;if(t.pointIndex){var c=t.pointIndex.getClusters(t.extent,Math.floor(l));return t.dataArray=c.map((function(t,e){return It({coordinates:t.geometry.coordinates,_id:e+1},t.properties)})),t}var h=new qy({radius:r,minZoom:s,maxZoom:o}),p={type:"FeatureCollection",features:[]};return p.features=t.dataArray.map((function(t){return{type:"Feature",geometry:{type:"Point",coordinates:t.coordinates},properties:It({},t)}})),h.load(p.features),h}function Yy(t){if(0===t.length)return 0;for(var e,n=t[0],r=0,i=1;i<t.length;i++)e=n+1*t[i],Math.abs(n)>=Math.abs(t[i])?r+=n-e+t[i]:r+=t[i]-e+n,n=e;return n+1*r}var Ky={min:function(t){if(0===t.length)throw new Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return e},max:function(t){if(0===t.length)throw new Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return e},mean:function(t){if(0===t.length)throw new Error("mean requires at least one data point");return Yy(t)/t.length},sum:Yy};function Qy(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}function Jy(t,e){if(Array.isArray(e))return e}var $y=function(t){Oe(i,t);var e,n,r=Qy(i);function i(t,e){var n;return Ee(this,i),kt(De(n=r.call(this)),"type","source"),kt(De(n),"isTile",!1),kt(De(n),"inited",!1),kt(De(n),"hooks",{init:new Dd}),kt(De(n),"parser",{type:"geojson"}),kt(De(n),"transforms",[]),kt(De(n),"cluster",!1),kt(De(n),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),kt(De(n),"invalidExtent",!1),kt(De(n),"dataArrayChanged",!1),kt(De(n),"cfg",{autoRender:!0}),n.originData=t,n.initCfg(e),n.init().then((function(){n.inited=!0,n.emit("update",{type:"inited"})})),n}return Te(i,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var e=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,o=n.field,a=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,a.forEach((function(t){t.id||(t.properties.point_count=1)})),(o||ti.exports.isFunction(i))&&(a=a.map((function(t){var n=t.id;if(n){var r,a=e.clusterIndex.getLeaves(n,1/0).map((function(t){return t.properties}));if(ti.exports.isString(i)&&o){var s=function(t,e){return t.map((function(t){return 1*t[e]}))}(a,o);r=Ky[i](s)}ti.exports.isFunction(i)&&(r=i(a)),t.properties.stat=r}else t.properties.point_count=1;return t}))),this.data=pt("geojson")({type:"FeatureCollection",features:a}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var e=this.parser,n=e.type,r=void 0===n?"geojson":n,i=e.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(e){return e._id===t})):t<this.data.dataArray.length?this.data.dataArray[t]:"null";var o=t<this.originData.features.length?this.originData.features[t]:"null",a=ti.exports.cloneDeep(o);if(null!=a&&a.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(e){return e._id===t}));a.properties=s}return a}},{key:"updateFeaturePropertiesById",value:function(t,e){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===t?It(It({},n),e):n})),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(t,e){var n=this.data.dataArray.find((function(n){return n[t]===e}));return null==n?void 0:n._id}},{key:"setData",value:function(t,e){var n=this;this.originData=t,this.dataArrayChanged=!1,this.initCfg(e),this.init().then((function(){n.emit("update",{type:"update"})}))}},{key:"reloadAllTile",value:function(){var t;null===(t=this.tileset)||void 0===t||t.reloadAll()}},{key:"reloadTilebyId",value:function(t,e,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileById(t,e,n)}},{key:"reloadTileByLnglat",value:function(t,e,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileByLnglat(t,e,n)}},{key:"getTileExtent",value:function(t,e){var n;return null===(n=this.tileset)||void 0===n?void 0:n.getTileExtent(t,e)}},{key:"getTileByZXY",value:function(t,e,n){var r;return null===(r=this.tileset)||void 0===r?void 0:r.getTileByZXY(t,e,n)}},{key:"reloadTileByExtent",value:function(t,e){var n;null===(n=this.tileset)||void 0===n||n.reloadTileByExtent(t,e)}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(t=this.tileset)||void 0===t||t.destroy()}},{key:"processData",value:(n=Zt(Kt.mark((function t(){var e=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){try{e.excuteParser(),e.initCluster(),e.executeTrans(),t({})}catch(t){n(t)}})));case 1:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"initCfg",value:function(t){this.cfg=ti.exports.mergeWith(this.cfg,t,Jy);var e=this.cfg;e&&(e.parser&&(this.parser=e.parser),e.transforms&&(this.transforms=e.transforms),this.cluster=e.cluster||!1,e.clusterOptions&&(this.cluster=!0,this.clusterOptions=It(It({},this.clusterOptions),e.clusterOptions)))}},{key:"init",value:(e=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.inited=!1,t.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"excuteParser",value:function(){var t=this.parser,e=t.type||"geojson",n=pt(e);this.data=n(this.originData,t),this.tileset=this.initTileset(),t.cancelExtent||(this.extent=gi(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(t)return this.isTile=!0,this.tileset?(this.tileset.updateOptions(t),this.tileset):new eo(It({},t))}},{key:"executeTrans",value:function(){var t=this;this.transforms.forEach((function(e){var n=function(t){return ct[t]}(e.type)(t.data,e);Object.assign(t.data,n)}))}},{key:"initCluster",value:function(){if(this.cluster){var t=this.clusterOptions||{};this.clusterIndex=Xy(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var e=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(e=Ei(Ti(this.extent),t)),e[0].concat(e[1])}}]),i}(Oi.exports.EventEmitter);function tg(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return eg(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eg(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function eg(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ng=6378e3;var rg=Math.PI/3,ig=[0,rg,2*rg,3*rg,4*rg,5*rg];function og(t){return t[0]}function ag(t){return t[1]}function sg(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}ft("rasterTile",(function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e=t,Array.isArray(e)&&0===e.length||!Array.isArray(e)&&"string"!=typeof e)throw new Error("tile server url is error");var r=(null==n?void 0:n.dataType)||My.IMAGE;r===My.RGB&&(r=My.ARRAYBUFFER);var i=It(It(It({},Vy),n),{},{getTileData:function(e,i){switch(r){case My.IMAGE:return Uy(t,e,i,n);case My.CUSTOMIMAGE:case My.CUSTOMTERRAINRGB:return Ry(i,null==n?void 0:n.getCustomData);case My.ARRAYBUFFER:return By(t,e,i,(null==n?void 0:n.format)||jy,null==n?void 0:n.operation);case My.CUSTOMARRAYBUFFER:case My.CUSTOMRGB:return Ly(i,null==n?void 0:n.getCustomData,(null==n?void 0:n.format)||jy,null==n?void 0:n.operation);default:return Uy(t,e,i,n)}}});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}})),ft("mvt",(function(t,e){var n=Array.isArray(t)?t[0]:t,r=It(It(It({},du),e),{},{getTileData:function(t,r){return vu(n,t,r,null==e?void 0:e.requestParameters,null==e?void 0:e.getCustomData)}});return{data:n,dataArray:[],tilesetOptions:r,isTile:!0}})),ft("geojsonvt",(function(t,e){var n=function(t){var e={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===t||void 0===t.geojsonvtOptions?e:It(It({},e),t.geojsonvtOptions)}(e),r=n.extent||4096,i=function(t,e){return new we(t,e)}(t,n);return{data:t,dataArray:[],tilesetOptions:It(It(It({},ke),e),{},{getTileData:function(t,e){return Le(e,i,t,r)}}),isTile:!0}})),ft("testTile",(function(t,e){return{data:t,dataArray:[],tilesetOptions:It(It(It({},Hy),e),{},{getTileData:function(t){return Wy(t)}}),isTile:!0}})),ft("geojson",(function(t,e){var n=[],r={};return t.features?(t.features=t.features.filter((function(t){var e=t.geometry;return null!=t&&e&&e.type&&e.coordinates&&e.coordinates.length>0})),Pt(t,!0),0===t.features.length?{dataArray:[],featureKeys:r}:(Gt(t,(function(t,r){var i=function(t,e){return void 0===e?null:1*Tt(t.properties[e])==="number"?1*t.properties[e]:t.properties&&t.properties[e]?function(t){for(var e=t.toString(),n=5381,r=e.length;r;)n=33*n^e.charCodeAt(--r);return n>>>0}(t.properties[e]+"")%1000019:null}(t,null==e?void 0:e.featureId);null===i&&(i=r);var o=i,a=Ut(t),s=It(It({},t.properties),{},{coordinates:a,_id:o});n.push(s)})),{dataArray:n,featureKeys:r})):(t.features=[],{dataArray:[]})})),ft("image",Ms),ft("csv",(function(t,e){return Ht(wt(t),e)})),ft("json",Ht),ft("raster",(function(t,e){var n,r,i,o=e.extent,a=e.width,s=e.height,u=e.min,l=e.max,c=e.format,h=e.operation;return void 0===c||Cu(t)?(n=Array.from(t),r=a,i=s):n=wu(Array.isArray(t)?t:[t],c,h),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:l,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]}}
/*! *****************************************************************************
    Copyright (C) Microsoft. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */)),ft("rasterRgb",(function(t,e){var n,r=e.extent,i=e.min,o=e.max,a=e.width,s=e.height,u=e.format,l=e.operation,c=Wf(e,Gy);return n=void 0===u||Cu(t)?Array.from(t):wu(Array.isArray(t)?t:[t],u,l),{_id:1,dataArray:[It(It({_id:1,data:n,width:a,height:s},c),{},{min:i,max:o,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]}})),dt("cluster",Xy),dt("filter",(function(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.filter(n)),t})),dt("join",(function(t,e){var n=e.sourceField,r=e.targetField,i=e.data,o={};return i.forEach((function(t){o[t[n]]=t})),t.dataArray=t.dataArray.map((function(t){var e=t[r];return It(It({},t),o[e])})),t})),dt("map",(function(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.map(n)),t})),dt("grid",(function(t,e){var n=t.dataArray,r=e.size,i=void 0===r?10:r,o=i/(2*Math.PI*ng)*(256<<20)/2,a=function(t,e){var n,r,i=1/0,o=-1/0,a=tg(t);try{for(a.s();!(r=a.n()).done;){n=r.value.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(t){a.e(t)}finally{a.f()}var s=function(t,e){var n=(i=t,i/ng*(180/Math.PI)),r=function(t,e){return e/ng*(180/Math.PI)/Math.cos(t*Math.PI/180)}(e,t);var i;return{yOffset:n,xOffset:r}}(e,(i+o)/2);if(s.xOffset<=0||s.yOffset<=0)return{gridHash:{},gridOffset:s};var u,l={},c=tg(t);try{for(c.s();!(u=c.n()).done;){var h=u.value,p=h.coordinates[1],f=h.coordinates[0];if(Number.isFinite(p)&&Number.isFinite(f)){var d=Math.floor((p+90)/s.yOffset),v=Math.floor((f+180)/s.xOffset),m="".concat(d,"-").concat(v);l[m]=l[m]||{count:0,points:[]},l[m].count+=1,l[m].points.push(h)}}}catch(t){c.e(t)}finally{c.f()}return{gridHash:l,gridOffset:s}}(n,i),s=function(t,e,n){return Object.keys(t).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),l={};if(n.field&&n.method){var c=Li(t[i].points,n.field);l[n.method]=Pi[n.method](c)}return Object.assign(l,{_id:o,coordinates:bi([e.xOffset*(u+.5)-180,e.yOffset*(s+.5)-90]),rawData:t[i].points,count:t[i].count}),r.push(l),r}),[])}(a.gridHash,a.gridOffset,e);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:s}})),dt("hexagon",(function(t,e){var n=t.dataArray,r=e.size,i=void 0===r?10:r,o=e.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(t){var e=$r(bi(t.coordinates),2),n=e[0],r=e[1];return It(It({},t),{},{coordinates:[n,r]})})),l=function(){var t,e,n,r=0,i=0,o=1,a=1,s=og,u=ag;function l(t){var r,i={},o=[],a=t.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=t[r],r,t))&&!isNaN(h=+u.call(null,l,r,t))){var l,c,h,p=Math.round(h/=n),f=Math.round(c=c/e-(1&p)/2),d=h-p;if(3*Math.abs(d)>1){var v=c-f,m=f+(c<f?-1:1)/2,y=p+(h<p?-1:1),g=c-m,_=h-y;v*v+d*d>g*g+_*_&&(f=m+(1&p?1:-1)/2,p=y)}var x=f+"-"+p,b=i[x];b?b.push(l):(o.push(b=i[x]=[l]),b.x=(f+(1&p)/2)*e,b.y=p*n)}return o}function c(t){var e=0,n=0;return ig.map((function(r){var i=Math.sin(r)*t,o=-Math.cos(r)*t,a=i-e,s=o-n;return e=i,n=o,[a,s]}))}return l.hexagon=function(e){return"m"+c(null==e?t:+e).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/e),c=u*n;c<a+t;c+=n,++u)for(var h=l*e+(1&u)*e/2;h<o+e/2;h+=e)s.push([h,c]);return s},l.mesh=function(){var e=c(t).slice(0,4).join("l");return l.centers().map((function(t){return"M"+t+"m"+e})).join("")},l.x=function(t){return arguments.length?(s=t,l):s},l.y=function(t){return arguments.length?(u=t,l):u},l.radius=function(r){return arguments.length?(e=2*(t=+r)*Math.sin(rg),n=1.5*t,l):t},l.size=function(t){return arguments.length?(r=i=0,o=+t[0],a=+t[1],l):[o-r,a-i]},l.extent=function(t){return arguments.length?(r=+t[0][0],i=+t[0][1],o=+t[1][0],a=+t[1][1],l):[[r,i],[o,a]]},l.radius(1)}().radius(s).x((function(t){return t.coordinates[0]})).y((function(t){return t.coordinates[1]})),c={dataArray:l(u).map((function(t,n){var r;if(e.field&&a){var i=Li(t,e.field);t[a]=Pi[a](i)}return kt(r={},e.method,t[a]),kt(r,"count",t.length),kt(r,"rawData",t),kt(r,"coordinates",[t.x,t.y]),kt(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"};return c}));var ug=function(t){Oe(n,t);var e=sg(n);function n(t){var r;return Ee(this,n),kt(De(r=e.call(this)),"added",!1),kt(De(r),"eventHandle",(function(t){r.polyfillEvent(t),r.emit(t.type,{target:t,data:r.markerOption.extData,lngLat:r.lngLat})})),r.markerOption=It(It({},r.getDefault()),t),function(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}(["update","onMove","onMapClick"],De(r)),r.init(),r}return Te(n,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:pr.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(Hh.IMapService),this.sceneSerive=t.get(Hh.ISceneService);var e=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&ii(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var e=this;if(!this.added)return this.once("added",(function(){e.setElement(t)})),this;var n=this.markerOption.element;return n&&ii(n),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",(function(){t.openPopup()})),this;var e=this.popup;return e?(e.isOpen()||e.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",(function(){t.closePopup()}));var e=this.popup;return e&&e.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;return t?(t.isOpen()?t.remove():t.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(this.mapsService){var t,e,n=this.markerOption,r=n.element,i=n.anchor;this.updatePosition(),t=r,e="".concat(fr[i]),t.style[li]=e}}},{key:"onMapClick",value:function(t){var e=this.markerOption.element;this.popup&&e&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(null==t?void 0:t.scrollHeight)||0,containerWidth:(null==t?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(e){e.style.display="block",e.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,l=s.containerWidth,c=s.bounds;if(!c)return;if(Math.abs(c[0][0])>180||Math.abs(c[1][0])>180){if(a.x>l){var h=this.mapsService.lngLatToContainer([i-360,o]);a.x=h.x}if(a.x<0){var p=this.mapsService.lngLatToContainer([i+360,o]);a.x=p.x}}(a.x>l||a.x<0||a.y>u||a.y<0)&&(e.style.display="none"),e.style.left=a.x+n[0]+"px",e.style.top=a.y-n[1]+"px"}}}},{key:"init",value:function(){var t=this,e=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!e){this.defaultMarker=!0,e=ri("div"),this.markerOption.element=e;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),e.appendChild(o)}oi(e,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=t.markerOption)||void 0===r?void 0:r.style)&&(null===(i=t.markerOption)||void 0===i?void 0:i.style[n]);e&&(e.style[n]=o)})),function(t,e,n){var r=t.classList;for(var i in fr)fr.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(e))}(e,i,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(t){this.mapsService&&"GAODE2.x"===this.mapsService.version&&(function(){for(var t=di,e=!0,n=0,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];n<r.length;n++){var i=r[n];if(t.indexOf(i)>0){e=!1;break}}return e}()||("touchstart"===t.type&&(this.touchStartTime=Date.now()),"touchend"===t.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat})))}},{key:"addDragHandler",value:function(t){return null}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),n}(Oi.exports.EventEmitter);function lg(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(t){try{var e,n=(e=(e=document.getElementsByTagName("script"))[e.length-1]).getAttribute("data-injectcss");if(!(e=e.getAttribute("data-disable-injectsvg"))){var r,i,o,a,s;if(n&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(e){console&&console.log(e)}}r=function(){var e,n=document.createElement("div");n.innerHTML=t._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",(e=document.body).firstChild?function(t,e){e.parentNode.insertBefore(t,e)}(n,e.firstChild):e.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),r()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=r,a=t.document,s=!1,l(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,u())})}function u(){s||(s=!0,o())}function l(){try{a.documentElement.doScroll("left")}catch(t){return void setTimeout(l,50)}u()}}catch(c){}}(window);var cg=function(t){Oe(n,t);var e=lg(n);function n(t){var r;return Ee(this,n),r=e.call(this),n.controlCount++,r.controlOption=It(It({},r.getDefault(t)),t||{}),r}return Te(n,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var e=this.getDefault(t);Object.entries(t).forEach((function(n){var r=$r(n,2),i=r[0];void 0===r[1]&&(t[i]=e[i])})),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=It(It({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(Hh.IMapService),this.renderService=t.get(Hh.IRendererService),this.layerService=t.get(Hh.ILayerService),this.controlService=t.get(Hh.IControlService),this.configService=t.get(Hh.IGlobalConfigService),this.scene=t.get(Hh.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),oi(this.container,"l7-control");var e=this.controlOption,n=e.className,r=e.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;ii(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return ri("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){ai(this.container,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){oi(this.container,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:pp.TOPRIGHT,name:"".concat(n.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var e=this.mapsService.getContainer();null!==e&&e.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pp.TOPLEFT,e=this.controlService;return e&&e.removeControl(this),this.controlOption.position=t,e&&e.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var e=this.container,n=this.controlOption.className;n&&ai(e,n),t&&oi(e,t)}},{key:"setStyle",value:function(t){var e=this.container;t?e.setAttribute("style",t):e.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.controlOption.position,e=this.container;if(t instanceof Element)t.appendChild(e);else{var n=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?n.insertBefore(e,n.firstChild):n.appendChild(e)}}},{key:"checkUpdateOption",value:function(t,e){return e.some((function(e){return e in t}))}}]),n}(Ni);function hg(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}kt(cg,"controlCount",0);var pg=function(t){Oe(n,t);var e=hg(n);function n(t,r){var i;return Ee(this,n),kt(De(i=e.call(this)),"isShow",!1),kt(De(i),"timeout",null),kt(De(i),"show",(function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),ai(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&n.conflictPopperList.forEach((function(t){t!==De(i)&&t.isShow&&t.hide()})),i.emit("show")),De(i)})),kt(De(i),"hide",(function(){return i.isShow?(oi(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide"),De(i)):De(i)})),kt(De(i),"setHideTimeout",(function(){i.timeout||(i.timeout=window.setTimeout((function(){i.isShow&&(i.hide(),i.timeout=null)}),300))})),kt(De(i),"clearHideTimeout",(function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)})),kt(De(i),"onBtnClick",(function(){i.isShow?i.hide():i.show()})),kt(De(i),"onBtnMouseLeave",(function(){i.setHideTimeout()})),kt(De(i),"onBtnMouseMove",(function(){i.clearHideTimeout(),i.isShow||i.show()})),i.button=t,i.option=r,i.init(),r.unique&&n.conflictPopperList.push(De(i)),i}return Te(n,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){"string"==typeof t?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(fi(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),"click"===t?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),ii(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t,e,n={},r=this.option,i=r.container,o=r.offset,a=void 0===o?[0,0]:o,s=r.placement,u=$r(a,2),l=u[0],c=u[1],h=this.button.getBoundingClientRect(),p=i.getBoundingClientRect(),f=(e=p,{left:(t=h).left-e.left,top:t.top-e.top,right:e.left+e.width-t.left-t.width,bottom:e.top+e.height-t.top-t.height}),d=f.left,v=f.right,m=f.top,y=f.bottom,g=!1,_=!1;/^(left|right)/.test(s)?(s.includes("left")?n.right="".concat(h.width+v,"px"):s.includes("right")&&(n.left="".concat(h.width+d,"px")),s.includes("start")?n.top="".concat(m,"px"):s.includes("end")?n.bottom="".concat(y,"px"):(n.top="".concat(m+h.height/2,"px"),_=!0,n.transform="translate(".concat(l,"px, calc(").concat(c,"px - 50%))"))):/^(top|bottom)/.test(s)&&(s.includes("top")?n.bottom="".concat(h.height+y,"px"):s.includes("bottom")&&(n.top="".concat(h.height+m,"px")),s.includes("start")?n.left="".concat(d,"px"):s.includes("end")?n.right="".concat(v,"px"):(n.left="".concat(d+h.width/2,"px"),g=!0,n.transform="translate(calc(".concat(l,"px - 50%), ").concat(c,"px)"))),n.transform="translate(calc(".concat(l,"px - ").concat(g?"50%":"0%","), calc(").concat(c,"px - ").concat(_?"50%":"0%",")");var x=s.split("-");x.length&&oi(this.popperDOM,x.map((function(t){return"l7-popper-".concat(t)})).join(" ")),pi(this.popperDOM,function(t){return Object.entries(t).map((function(t){var e=$r(t,2),n=e[0],r=e[1];return"".concat(n,": ").concat(r)})).join(";")}(n))}},{key:"createPopper",value:function(){var t=this.option,e=t.container,n=t.className,r=void 0===n?"":n,i=t.content,o=ri("div","l7-popper l7-popper-hide ".concat(r)),a=ri("div","l7-popper-content"),s=ri("div","l7-popper-arrow");return o.appendChild(a),o.appendChild(s),e.appendChild(o),this.popperDOM=o,this.contentDOM=a,i&&this.setContent(i),o}}]),n}(Oi.exports.EventEmitter);kt(pg,"conflictPopperList",[]);var fg=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("l7-iconfont"),e.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(t)),e.appendChild(n),e};function dg(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return vg(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vg(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function vg(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var mg=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],yg=function(){if("undefined"==typeof document)return!1;for(var t=mg[0],e={},n=0,r=mg;n<r.length;n++){var i=r[n];if((null==i?void 0:i[1])in document){var o,a=dg(i.entries());try{for(a.s();!(o=a.n()).done;){var s=$r(o.value,2),u=s[0],l=s[1];e[t[u]]=l}}catch(t){a.e(t)}finally{a.f()}return e}}return!1}(),gg={change:yg.fullscreenchange,error:yg.fullscreenerror},_g={request:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,e=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function t(){_g.off("change",t),n()};_g.on("change",i);var o=t[yg.requestFullscreen](e);o instanceof Promise&&o.then(i).catch(r)}))},exit:function(){return new Promise((function(t,e){if(_g.isFullscreen){var n=function e(){_g.off("change",e),t()};_g.on("change",n);var r=document[yg.exitFullscreen]();r instanceof Promise&&r.then(n).catch(e)}else t()}))},toggle:function(t,e){return _g.isFullscreen?_g.exit():_g.request(t,e)},onchange:function(t){_g.on("change",t)},onerror:function(t){_g.on("error",t)},on:function(t,e){var n=gg[t];n&&document.addEventListener(n,e,!1)},off:function(t,e){var n=gg[t];n&&document.removeEventListener(n,e,!1)},raw:yg};function xg(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}Object.defineProperties(_g,{isFullscreen:{get:function(){return Boolean(document[yg.fullscreenElement])}},element:{enumerable:!0,get:function(){var t;return null!==(t=document[yg.fullscreenElement])&&void 0!==t?t:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[yg.fullscreenEnabled])}}}),yg||(_g={isEnabled:!1});var bg=function(t){Oe(n,t);var e=xg(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"getDefault",value:function(){return{position:pp.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=ri("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){Vv(ze(n.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(fi(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var e=this.controlOption,n=e.href,r=e.img,i=ri("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),i.setAttribute("draggable","false"),n){var o=ri("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),t.appendChild(o)}else t.appendChild(i)}}]),n}(cg);function wg(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Sg=function(t){Oe(n,t);var e=wg(n);function n(){var t;Ee(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return kt(De(t=e.call.apply(e,[this].concat(i))),"update",(function(){var e=t.mapsService,n=t.controlOption.maxWidth,r=e.getSize()[1]/2,i=e.containerToLngLat([0,r]),o=e.containerToLngLat([n,r]),a=Si([i.lng,i.lat],[o.lng,o.lat]);t.updateScales(a)})),t}return Te(n,[{key:"getDefault",value:function(t){return It(It({},Vv(ze(n.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:pp.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t=ri("div","l7-control-scale");this.resetScaleLines(t);var e=this.controlOption.updateWhenIdle;return this.mapsService.on(e?"moveend":"mapmove",this.update),this.mapsService.on(e?"zoomend":"zoomchange",this.update),t}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){Vv(ze(n.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var e=this.controlOption,n=e.metric,r=e.imperial;n&&t&&this.updateMetric(t),r&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){fi(t);var e=this.controlOption,n=e.metric,r=e.imperial,i=e.maxWidth;e.lockWidth&&pi(t,"width: ".concat(i,"px")),n&&(this.mScale=ri("div","l7-control-scale-line",t)),r&&(this.iScale=ri("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,e,n){var r=this.controlOption.maxWidth;t.style.width=Math.round(r*n)+"px",t.innerHTML=e}},{key:"getRoundNum",value:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"updateMetric",value:function(t){var e=this.getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this.updateScale(this.mScale,n,e/t)}},{key:"updateImperial",value:function(t){var e,n,r,i=3.2808399*t;i>5280?(e=i/5280,n=this.getRoundNum(e),this.updateScale(this.iScale,n+" mi",n/e)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),n}(cg);function Eg(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Ag,Tg=function(t){Oe(n,t);var e=Eg(n);function n(){var t;Ee(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return kt(De(t=e.call.apply(e,[this].concat(i))),"zoomIn",(function(){!t.disabled&&t.mapsService.getZoom()<t.mapsService.getMaxZoom()&&t.mapsService.zoomIn()})),kt(De(t),"zoomOut",(function(){!t.disabled&&t.mapsService.getZoom()>t.mapsService.getMinZoom()&&t.mapsService.zoomOut()})),kt(De(t),"updateDisabled",(function(){var e=t.mapsService;t.zoomInButton.removeAttribute("disabled"),t.zoomOutButton.removeAttribute("disabled"),(t.disabled||e.getZoom()<=e.getMinZoom())&&t.zoomOutButton.setAttribute("disabled","true"),(t.disabled||e.getZoom()>=e.getMaxZoom())&&t.zoomInButton.setAttribute("disabled","true")})),t}return Te(n,[{key:"getDefault",value:function(t){return It(It({},Vv(ze(n.prototype),"getDefault",this).call(this,t)),{},{position:pp.BOTTOMRIGHT,name:"zoom",zoomInText:fg("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:fg("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(t){Vv(ze(n.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=ri("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){fi(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,e,n,r,i){var o=ri("button",n,r);return"string"==typeof t?o.innerHTML=t:o.append(t),o.title=e,o.addEventListener("click",i),o}}]),n}(cg);!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  -webkit-box-shadow: none;\n          box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 1000;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 800;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  -webkit-transition: all 0.2s;\n  transition: all 0.2s;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 6px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  -webkit-transform: scale(0.83333);\n          transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  height: 24px;\n  line-height: 24px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 16px;\n  font-size: 12px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  height: 14px;\n  width: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  padding: 12px 12px 0 12px;\n  width: 474px;\n  height: 320px;\n  overflow: auto;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-select-control--image .l7-select-control-item {\n  margin-right: 12px;\n  border-radius: 2px;\n  overflow: hidden;\n  border: 1px solid #fff;\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box;\n  width: calc((100% - 36px) / 3);\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  margin-bottom: 12px;\n  position: relative;\n  font-size: 12px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 142px;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control--image .l7-select-control-item:nth-child(3n) {\n  margin-right: 0;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.l7-control-zoom .l7-button-control {\n  -webkit-box-shadow: 0 0 0;\n          box-shadow: 0 0 0;\n  border-radius: 0;\n  font-size: 16px;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:first-child {\n  border-bottom: 1px solid #f0f0f0;\n}\n.l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  -webkit-transition: width 0.1s;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  -webkit-user-select: text;\n     -moz-user-select: text;\n      -ms-user-select: text;\n          user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n");var Cg,kg,Mg,Ig=(kt(Ag={},xp.additive,{enable:!0,func:{srcRGB:pf.ONE,dstRGB:pf.ONE,srcAlpha:1,dstAlpha:1}}),kt(Ag,xp.none,{enable:!1}),kt(Ag,xp.normal,{enable:!0,func:{srcRGB:pf.SRC_ALPHA,dstRGB:pf.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),kt(Ag,xp.subtractive,{enable:!0,func:{srcRGB:pf.ONE,dstRGB:pf.ONE,srcAlpha:pf.ZERO,dstAlpha:pf.ONE_MINUS_SRC_COLOR},equation:{rgb:pf.FUNC_SUBTRACT,alpha:pf.FUNC_SUBTRACT}}),kt(Ag,xp.max,{enable:!0,func:{srcRGB:pf.ONE,dstRGB:pf.ONE},equation:{rgb:pf.MAX_EXT}}),kt(Ag,xp.min,{enable:!0,func:{srcRGB:pf.ONE,dstRGB:pf.ONE},equation:{rgb:pf.MIN_EXT}}),Ag),Pg=(Cg=oy(Hh.IGlobalConfigService),kg=function(){function t(e){Ee(this,t),Rp(this,"configService",Mg,this),this.config=e}return Te(t,[{key:"setContainer",value:function(t,e,n,r){t.bind(Hh.MapConfig).toConstantValue(It(It({},this.config),{},{id:e,canvas:n,hasBaseMap:r})),t.bind(Hh.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),t}(),Mg=Op(kg.prototype,"configService",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kg),Lg={exports:{}};!function(t,e){t.exports=function(){function t(t){var r=[];return t.AMapUI&&r.push(e(t.AMapUI)),t.Loca&&r.push(n(t.Loca)),Promise.all(r)}function e(t){return new Promise((function(e,n){var i=[];if(t.plugins)for(var u=0;u<t.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(t.plugins[u])&&i.push(t.plugins[u]);if(a.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=t.version||o.AMapUI.version,u=o.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+u+"/main.js",c.onerror=function(t){a.AMapUI=r.failed,n("请求 AMapUI 失败")},c.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}for(e();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(e();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else a.AMapUI===r.loaded?t.version&&t.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}e()})):e():t.version&&t.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(t){t?n(t):i.length?window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}e()})):e()}))}))}function n(t){return new Promise((function(e,n){if(a.Loca===r.failed)n("前次请求 Loca 失败");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=t.version||o.Loca.version;var i=o.Loca.version,u=o.AMap.version.startsWith("2"),l=i.startsWith("2");if(u&&!l||!u&&l)n("JSAPI 与 Loca 版本不对应！！");else{u=o.key,l=document.body||document.head;var c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+u,c.onerror=function(t){a.Loca=r.failed,n("请求 AMapUI 失败")},c.onload=function(){for(a.Loca=r.loaded,e();s.Loca.length;)s.Loca.splice(0,1)[0]()},l.appendChild(c)}}else a.Loca===r.loaded?t.version&&t.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):e():t.version&&t.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(t){t?n(t):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[],l=function(t){"function"==typeof t&&(a.AMap===r.loaded?t(window.AMap):u.push(t))};return{load:function(e){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=e.key,c=e.version,h=e.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),o.key=s,o.AMap.version=c||o.AMap.version,o.AMap.plugins=h||o.AMap.plugins,a.AMap=r.loading,c=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,t(e).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(h=document.createElement("script")).type="text/javascript",h.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),h.onerror=function(t){a.AMap=r.failed,i(t)},c.appendChild(h)):i("请填写key")}else if(a.AMap==r.loaded)if(e.key&&e.key!==o.key)i("多个不一致的 key");else if(e.version&&e.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],e.plugins)for(c=0;c<e.plugins.length;c+=1)-1==o.AMap.plugins.indexOf(e.plugins[c])&&s.push(e.plugins[c]);s.length?window.AMap.plugin(s,(function(){t(e).then((function(){n(window.AMap)})).catch(i)})):t(e).then((function(){n(window.AMap)})).catch(i)}else if(e.key&&e.key!==o.key)i("多个不一致的 key");else if(e.version&&e.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{var p=[];if(e.plugins)for(c=0;c<e.plugins.length;c+=1)-1==o.AMap.plugins.indexOf(e.plugins[c])&&p.push(e.plugins[c]);l((function(){p.length?window.AMap.plugin(p,(function(){t(e).then((function(){n(window.AMap)})).catch(i)})):t(e).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}()}(Lg);var Rg=Lg.exports,Og=function(t){return t["GAODE1.x"]="GAODE1.x",t["GAODE2.x"]="GAODE2.x",t.MAPBOX="MAPBOX",t.DEFUALT="DEFUALTMAP",t.SIMPLE="SIMPLE",t.GLOBEL="GLOBEL",t}({}),Dg=function(){function t(e){Ee(this,t),kt(this,"size",1e4),this.size=e||1e4}return Te(t,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var e=180-360*(1-t/this.size);return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}},{key:"project",value:function(t){return[this.mercatorXfromLng(t[0]),this.mercatorYfromLat(t[1])]}},{key:"unproject",value:function(t){return[this.lngFromMercatorX(t[0]),this.latFromMercatorY(t[1])]}}]),t}();function Ng(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("number"==typeof t)return{top:t,right:t,bottom:t,left:t};if(Array.isArray(t)){if(4===t.length)return{top:t[0],right:t[1],bottom:t[2],left:t[3]};if(2===t.length)return{top:t[0],right:t[1],bottom:t[0],left:t[1]}}return It(It({},{top:0,right:0,bottom:0,left:0}),t)}function zg(t,e){var n,r,i,o=es([],e,t);return n=o,r=o,i=1/o[3],n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,o}function Fg(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}var Bg=Math.PI,Ug=Bg/4,jg=Bg/180,Vg=180/Bg,Gg=4003e4,Hg=1.5;function Wg(t){return Math.pow(2,t)}function Zg(t,e){var n=$r(t,2),r=n[0],i=n[1];Fg(Number.isFinite(r)&&Number.isFinite(e)),Fg(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*jg;return[(e*=512)*(r*jg+Bg)/(2*Bg),e*(Bg-Math.log(Math.tan(Ug+.5*o)))/(2*Bg)]}function qg(t,e){var n=$r(t,2),r=n[0],i=n[1],o=r/(e*=512)*(2*Bg)-Bg,a=2*(Math.atan(Math.exp(Bg-i/e*(2*Bg)))-Ug);return[o*Vg,a*Vg]}function Xg(t){var e=t.width,n=t.height,r=t.pitch,i=function(t){var e=t.width,n=t.height,r=t.altitude,i=void 0===r?Hg:r,o=t.pitch,a=void 0===o?0:o,s=t.nearZMultiplier,u=void 0===s?1:s,l=t.farZMultiplier,c=void 0===l?1:l,h=a*jg,p=Math.atan(.5/i),f=Math.sin(p)*i/Math.sin(Math.PI/2-h-p),d=Math.cos(Math.PI/2-h)*f+i;return{fov:2*Math.atan(n/2/i),aspect:e/n,focalDistance:i,near:u,far:d*c}}({width:e,height:n,altitude:t.altitude,pitch:r,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return _a([],o,a,s,u)}function Yg(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=$r(t,3),i=r[0],o=r[1],a=r[2];if(Fg(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a))return zg(e,[i,o,a,1]);var s=zg(e,[i,o,0,1]),u=zg(e,[i,o,1,1]),l=s[2],c=u[2];return function(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}([],s,u,l===c?0:((n||0)-l)/(c-l))}var Kg=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Qg=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=e.height,i=e.viewMatrix,o=void 0===i?Kg:i,a=e.projectionMatrix,s=void 0===a?Kg:a;Ee(this,t),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];la(u,u,this.projectionMatrix),la(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];ha(l,l,[this.width/2,-this.height/2,1]),ca(l,l,[1,-1,0]),la(l,l,this.viewProjectionMatrix);var c=ua([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Te(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&Ea(e.projectionMatrix,this.projectionMatrix)&&Ea(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,n=void 0===e||e,r=function(t,e){var n=$r(t,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return Fg(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),zg(e,[r,i,a,1])}(this.projectPosition(t),this.pixelProjectionMatrix),i=$r(r,2),o=i[0],a=i[1],s=n?a:this.height-a;return 2===t.length?[o,s]:[o,s,r[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=e.targetZ,o=$r(t,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=i&&i*this.pixelsPerMeter,h=Yg([a,l,u],this.pixelUnprojectionMatrix,c),p=$r(this.unprojectPosition(h),3),f=p[0],d=p[1],v=p[2];return Number.isFinite(u)?[f,d,v]:Number.isFinite(i)?[f,d,i]:[f,d]}},{key:"projectPosition",value:function(t){var e=$r(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=$r(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]||this.scale,t}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]||this.scale,t}}]),t}();function Jg(t){var e=t.width,n=t.height,r=t.bounds,i=t.minExtent,o=void 0===i?0:i,a=t.maxZoom,s=void 0===a?24:a,u=t.padding,l=void 0===u?0:u,c=t.offset,h=void 0===c?[0,0]:c,p=$r(r,2),f=$r(p[0],2),d=f[0],v=f[1],m=$r(p[1],2),y=m[0],g=m[1];if(Number.isFinite(l)){l={top:l,bottom:l,left:l,right:l}}else Fg(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var _=new c_({width:e,height:n,longitude:0,latitude:0,zoom:0}),x=_.project([d,g]),b=_.project([y,v]),w=[Math.max(Math.abs(b[0]-x[0]),o),Math.max(Math.abs(b[1]-x[1]),o)],S=[e-l.left-l.right-2*Math.abs(h[0]),n-l.top-l.bottom-2*Math.abs(h[1])];Fg(S[0]>0&&S[1]>0);var E=S[0]/w[0],A=S[1]/w[1],T=(l.right-l.left)/2/E,C=(l.bottom-l.top)/2/A,k=[(b[0]+x[0])/2+T,(b[1]+x[1])/2+C],M=_.unproject(k),I=_.zoom+Math.log2(Math.abs(Math.min(E,A)));return{longitude:M[0],latitude:M[1],zoom:Math.min(I,s)}}var $g,t_,e_,n_,r_,i_,o_,a_,s_,u_,l_,c_=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,l=n.zoom,c=void 0===l?0:l,h=n.pitch,p=void 0===h?0:h,f=n.bearing,d=void 0===f?0:f,v=n.altitude,m=void 0===v?1.5:v,y=n.nearZMultiplier,g=n.farZMultiplier;Ee(this,e),r=r||1,i=i||1;var _=Wg(c);m=Math.max(.75,m);var x=Zg([u,a],_);x[2]=0;var b=Xg({width:r,height:i,pitch:p,bearing:d,altitude:m,nearZMultiplier:y||1/i,farZMultiplier:g||1.01}),w=function(t){var e=t.height,n=t.pitch,r=t.bearing,i=t.altitude,o=t.center,a=void 0===o?null:o,s=t.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return ca(l,l,[0,0,-i]),ha(l,l,[1,1,1/e]),pa(l,l,-n*jg),da(l,l,r*jg),u&&ha(l,l,[1,-1,1]),a&&ca(l,l,za([],a)),l}({height:i,center:x,pitch:p,bearing:d,altitude:m,flipY:!0});return(t=Ne(this,ze(e).call(this,{width:r,height:i,viewMatrix:w,projectionMatrix:b}))).latitude=a,t.longitude=u,t.zoom=c,t.pitch=p,t.bearing=d,t.altitude=m,t.scale=_,t.center=x,t.pixelsPerMeter=function(t){var e=t.latitude,n=t.longitude,r=t.zoom,i=t.scale,o=t.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:Wg(r),Fg(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,l=Math.cos(e*jg),c=u/360,h=c/l,p=u/Gg/l;if(s.pixelsPerMeter=[p,-p,p],s.metersPerPixel=[1/p,-1/p,1/p],s.pixelsPerDegree=[c,-h,p],s.degreesPerPixel=[1/c,-1/h,1/p],a){var f=jg*Math.tan(e*jg)/l,d=c*f/2,v=u/Gg*f,m=v/h*p;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[m,0,m]}return s}(De(De(t))).pixelsPerMeter[2],Object.freeze(De(De(t))),t}return Oe(e,t),Te(e,[{key:"projectFlat",value:function(t){return Zg(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"unprojectFlat",value:function(t){return qg(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e,n,r=t.lngLat,i=Yg(t.pos,this.pixelUnprojectionMatrix),o=as([],Zg(r,this.scale),((e=[])[0]=-(n=i)[0],e[1]=-n[1],e));return qg(as([],this.center,o),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=Jg(Object.assign({width:r,height:i,bounds:t},n));return new e({width:r,height:i,longitude:o.longitude,latitude:o.latitude,zoom:o.zoom})}}]),e}(Qg),h_=function(){function t(){Ee(this,t)}return Te(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth,s=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new c_(It(It({},s),{},{width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),p_={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},f_=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var d_={"GAODE1.x":{contextmenu:"rightclick"},"GAODE2.x":{contextmenu:"rightclick",camerachange:"viewchange"}},v_=0;window.forceWebGL=!0;var m_="15cd8a57710d40c9b7c0e3cc120f1200",y_=!1,g_=[],__=($g=ku.injectable(),t_=ku.inject(Hh.IGlobalConfigService),e_=ku.inject(Hh.MapConfig),n_=ku.inject(Hh.ICoordinateSystemService),r_=ku.inject(Hh.IEventEmitter),$g((o_=function(){function t(){var e=this;Ee(this,t),kt(this,"version",Og["GAODE1.x"]),kt(this,"simpleMapCoord",new Dg),kt(this,"bgColor","rgba(0, 0, 0, 0)"),Rp(this,"configService",a_,this),Rp(this,"config",s_,this),Rp(this,"coordinateSystemService",u_,this),Rp(this,"eventEmitter",l_,this),kt(this,"handleCameraChanged",(function(t){var n=t.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,h=e.getCenter(),p=h.lng,f=h.lat;if(e.emit("mapchange"),e.cameraChangedCallback){e.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:e.map.getZoom()-1,center:[p,f],offsetOrigin:[c.x,c.y]});var d=e.config.offsetZoom,v=void 0===d?12:d;e.viewport.getZoom()>v?e.coordinateSystemService.setCoordinateSystem(Dp.P20_OFFSET):e.coordinateSystemService.setCoordinateSystem(Dp.P20),e.cameraChangedCallback(e.viewport)}}))}var e;return Te(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];this.markerContainer=ri("div","l7-marker-container",e)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==Iy.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(d_[this.version][t]||t,e)}},{key:"off",value:function(t,e){-1!==Iy.indexOf(t)?this.eventEmitter.off(t,e):this.map.off(d_[this.version][t]||t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(null!=t&&t.padding){var e=this.getCenter(),n=Ng(t.padding),r=this.lngLatToPixel([e.lng,e.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"setCenter",value:function(t,e){if(null!=e&&e.padding){var n=Ng(e.padding),r=this.lngLatToPixel(t),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(t,e)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,e){this.map.setZoomAndCenter(t+1,e)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyleValue(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"getMapStyleConfig",value:function(){return p_}},{key:"getMapStyleValue",value:function(t){return this.getMapStyleConfig()[t]||t}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(t){var e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"containerToLngLat",value:function(t){var e=new AMap.Pixel(t[0],t[1]),n=this.map.containerToLngLat(e);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(t){var e=new AMap.LngLat(t[0],t[1]),n=this.map.lngLatToContainer(e);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(t){var e=this.map.lngLatToGeodeticCoord(t);return[e.x,-e.y]}},{key:"lngLatToMercator",value:function(t,e){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=ia();return ca(o,o,Ia(i[0],i[1],e)),ha(o,o,Ia(r[0],r[1],r[2])),pa(o,o,n[0]),fa(o,o,n[1]),da(o,o,n[2]),o}},{key:"init",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,p,f,d,v=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,l=e.token,c=void 0===l?m_:l,h=e.mapInstance,p=e.plugin,f=void 0===p?[]:p,d=Wf(e,f_),t.next=3,new Promise((function(t){var e=function(){if(h)v.map=h,v.$mapContainer=v.map.getContainer(),setTimeout((function(){v.map.on("camerachange",v.handleCameraChanged),t()}),30);else{v.$mapContainer=v.creatMapContainer(n);var e=It({mapStyle:v.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);e.zoom&&(e.zoom+=1);var r=new AMap.Map(v.$mapContainer,e);r.on("camerachange",v.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return v.handleAfterMapChange()}))})),v.map=r,setTimeout((function(){t()}),10)}};y_||h?y_&&window.AMap||h?e():g_.push(e):(c===m_&&console.warn("%c".concat(v.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),y_=!0,f.push("Map3D"),Rg.load({key:c,version:"1.4.15",plugins:f}).then((function(){e(),g_.length&&(g_.forEach((function(t){return t()})),g_=[])})).catch((function(t){throw new Error(t)})))}));case 3:this.viewport=new h_;case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance(Fe(AMap.LngLat,At(t)),Fe(AMap.LngLat,At(e))),r=$r(this.lngLatToCoord(t),2),i=r[0],o=r[1],a=$r(this.lngLatToCoord(e),2),s=a[0],u=a[1];return Math.sqrt(Math.pow(i-s,2)+Math.pow(o-u,2))/n}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n),this.map.destroy()}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",n.id="l7_amap_div"+v_++,e.appendChild(n),n}}]),t}(),a_=Op(o_.prototype,"configService",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s_=Op(o_.prototype,"config",[e_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u_=Op(o_.prototype,"coordinateSystemService",[n_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l_=Op(o_.prototype,"eventEmitter",[r_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i_=o_))||i_);if(!window)throw Error("AMap JSAPI can only be used in Browser.");var x_=function(t){return t.notload="notload",t.loading="loading",t.loaded="loaded",t.failed="failed",t}(x_||{}),b_={key:"",AMap:{version:"2.0",plugins:[]}},w_={AMap:x_.notload},S_=function(){var t=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){if(w_.AMap===x_.failed)n("");else if(w_.AMap===x_.notload){var r=e.key,i=e.version,o=e.plugins;if(!r)return void n("请填写key");window.AMap&&"lbs.amap.com"!==location.host&&n("禁止多种API加载方式混用"),b_.key=r,b_.AMap.version=i||b_.AMap.version,b_.AMap.plugins=o||b_.AMap.plugins,w_.AMap=x_.loading;var a=document.body||document.head;window._onAPILoaded=function(e){e?(w_.AMap=x_.failed,n(e)):(w_.AMap=x_.loaded,t(null))};var s=document.createElement("script");s.type="text/javascript",s.async=!1,s.src="https://webapi.amap.com/maps?callback=_onAPILoaded&v="+b_.AMap.version+"&key="+r+"&plugin="+b_.AMap.plugins.join(","),s.onerror=function(t){w_.AMap=x_.failed,n(t)},a.appendChild(s)}else if(w_.AMap===x_.loaded){if(e.key&&e.key!==b_.key)return void n("多个不一致的 key");if(e.version&&e.version!==b_.AMap.version)return void n("不允许多个版本 JSAPI 混用");var u=[];e.plugins&&e.plugins.forEach((function(t){-1===b_.AMap.plugins.indexOf(t)&&u.push(t)})),u.length&&window.AMap.plugin(u,(function(){t(window.AMap)}))}else{if(e.key&&e.key!==b_.key)return void n("多个不一致的 key");if(e.version&&e.version!==b_.AMap.version)return void n("不允许多个版本 JSAPI 混用");var l=[];e.plugins&&e.plugins.forEach((function(t){-1===b_.AMap.plugins.indexOf(t)&&l.push(t)})),"function"!=typeof(c=function(){l.length&&window.AMap.plugin(l,(function(){t(window.AMap)}))})||w_.AMap!==x_.loaded||c(window.AMap)}var c})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var E_,A_={load:S_,reset:function(){delete window.AMap,b_={key:"",AMap:{version:"1.4.15",plugins:[]}},w_={AMap:x_.notload}}},T_=Math.PI/180,C_=function(){function t(){Ee(this,t),kt(this,"projectionMatrix",ia()),kt(this,"viewMatrix",ia()),kt(this,"viewProjectionMatrix",ia()),kt(this,"ViewProjectionMatrixUncentered",ia()),kt(this,"viewUncenteredMatrix",ia())}return Te(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=void 0===e?1:e,r=t.pitch,i=void 0===r?0:r,o=t.bearing,a=void 0===o?0:o,s=t.center,u=void 0===s?[0,0]:s,l=t.offsetOrigin,c=void 0===l?[0,0]:l,h=t.cameraHeight,p=void 0===h?1:h,f=t.aspect,d=void 0===f?1:f,v=t.near,m=void 0===v?.1:v,y=t.far,g=void 0===y?1e3:y,_=t.fov,x=void 0===_?0:_;this.zoom=n,this.center=u;var b=i*T_,w=(360-a)*T_;_a(this.projectionMatrix,x,d,m,g);var S=Ia(p*Math.sin(b)*Math.sin(w),-p*Math.sin(b)*Math.cos(w),p*Math.cos(b)),E=Ia(-Math.cos(b)*Math.sin(w),Math.cos(b)*Math.cos(w),Math.sin(b));wa(this.viewMatrix,S,Ia(0,0,0),E),this.viewUncenteredMatrix=oa(this.viewMatrix),ca(this.viewMatrix,this.viewMatrix,Ia(-c[0],c[1],0)),la(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),la(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=$r(this.center,2);return[t[0],t[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return[o=r*(.5/Math.PI*o+.5)-215440491,a=-(r*(-.5/Math.PI*a+(i=.5))-106744817)]}}]),t}(),k_=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];function M_(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}window.forceWebGL=!0;var I_="15cd8a57710d40c9b7c0e3cc120f1200",P_=!1,L_=[],R_=ku.injectable()(E_=function(t){Oe(r,t);var e,n=M_(r);function r(){var t;Ee(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return kt(De(t=n.call.apply(n,[this].concat(i))),"version",Og["GAODE1.x"]),kt(De(t),"handleCameraChanged",(function(e){var n=e.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,h=t.getCenter(),p=h.lng,f=h.lat;if(t.emit("mapchange"),t.cameraChangedCallback){t.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:t.map.getZoom()-1,center:[p,f],offsetOrigin:[c.x,c.y]});var d=t.config.offsetZoom,v=void 0===d?12:d;t.viewport.getZoom()>v?t.coordinateSystemService.setCoordinateSystem(Dp.P20_OFFSET):t.coordinateSystemService.setCoordinateSystem(Dp.P20),t.cameraChangedCallback(t.viewport)}})),t}return Te(r,[{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=ia();return ca(o,o,Ia(i[0],i[1],e)),ha(o,o,Ia(r[0],r[1],r[2])),pa(o,o,n[0]),fa(o,o,n[1]),da(o,o,n[2]),o}},{key:"init",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,p,f,d,v=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,l=e.token,c=void 0===l?I_:l,h=e.mapInstance,p=e.plugin,f=void 0===p?[]:p,d=Wf(e,k_),t.next=3,new Promise((function(t){var e=function(){if(h)v.map=h,v.$mapContainer=v.map.getContainer(),setTimeout((function(){v.map.on("camerachange",v.handleCameraChanged),t()}),30);else{v.$mapContainer=v.creatMapContainer(n);var e=It({mapStyle:v.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);e.zoom&&(e.zoom+=1);var r=new AMap.Map(v.$mapContainer,e);r.on("camerachange",v.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return v.handleAfterMapChange()}))})),v.map=r,setTimeout((function(){t()}),10)}};P_||h?P_&&window.AMap||h?e():L_.push(e):(c===I_&&console.warn(v.configService.getSceneWarninfo("MapToken")),P_=!0,f.push("Map3D"),A_.load({key:c,version:"1.4.15",plugins:f}).then((function(t){e(),L_.length&&(L_.forEach((function(t){return t()})),L_=[])})).catch((function(t){throw new Error(t)})))}));case 3:this.viewport=new C_;case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance(Fe(AMap.LngLat,At(t)),Fe(AMap.LngLat,At(e))),r=$r(this.lngLatToCoord(t),2),i=r[0],o=r[1],a=$r(this.lngLatToCoord(e),2),s=a[0],u=a[1];return Math.sqrt(Math.pow(i-s,2)+Math.pow(o-u,2))/n}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}}]),r}(__))||E_;function O_(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var D_,N_=function(t){Oe(n,t);var e=O_(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"getServiceConstructor",value:function(){return R_}}]),n}(Pg),z_=function(){function t(){Ee(this,t),kt(this,"projectionMatrix",ia()),kt(this,"viewMatrix",ia()),kt(this,"viewProjectionMatrix",ia()),kt(this,"ViewProjectionMatrixUncentered",ia()),kt(this,"viewUncenteredMatrix",ia())}return Te(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=void 0===e?1:e,r=t.center,i=void 0===r?[0,0]:r,o=t.offsetOrigin,a=void 0===o?[0,0]:o,s=t.cameraPosition,u=void 0===s?[0,0,0]:s,l=t.up,c=void 0===l?[0,1,0]:l,h=t.lookAt,p=void 0===h?[0,0,0]:h,f=t.aspect,d=void 0===f?1:f,v=t.near,m=void 0===v?.1:v,y=t.far,g=void 0===y?1e3:y,_=t.fov,x=void 0===_?45:_;this.zoom=n,this.center=i,_a(this.projectionMatrix,x/180*Math.PI,d,m,g);var b=Ia.apply(Ja,At(u)),w=Ia.apply(Ja,At(p)),S=Ia.apply(Ja,At(c));wa(this.viewMatrix,b,w,S),this.viewUncenteredMatrix=oa(this.viewMatrix),ca(this.viewMatrix,this.viewMatrix,Ia(-a[0],a[1],0)),la(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),la(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var t=$r(this.center,2);return[t[0],t[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1.2}},{key:"projectFlat",value:function(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return[o=r*(.5/Math.PI*o+.5)-215440491,a=-(r*(-.5/Math.PI*a+(i=.5))-106744817)]}}]),t}(),F_=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];function B_(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var U_=[108.92361,34.54083];window.forceWebGL=!0;var j_="ff533602d57df6f8ab3b0fea226ae52f",V_=ku.injectable()(D_=function(t){Oe(r,t);var e,n=B_(r);function r(){var t;Ee(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return kt(De(t=n.call.apply(n,[this].concat(i))),"version",Og["GAODE2.x"]),kt(De(t),"handleViewChanged",(function(e){var n=t.map.customCoords.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,l=n.up;t.emit("mapchange");var c=t.map.customCoords.getCenter();t.cameraChangedCallback&&(t.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,up:l,near:i,zoom:t.map.getZoom()-1,center:c,offsetOrigin:[s[0],s[1]]}),t.coordinateSystemService.setCoordinateSystem(Dp.P20_2),t.cameraChangedCallback(t.viewport))})),t}return Te(r,[{key:"setCustomCoordCenter",value:function(t){this.sceneCenter=t,this.sceneCenterMercator=wi.apply(void 0,At(t))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMercator}},{key:"lngLatToCoordByLayer",value:function(t,e){var n=e||this.sceneCenterMercator,r=this._sub(wi(t[0],t[1]),n);return t[2]&&r.push(t[2]),r}},{key:"coordToAMap2RelativeCoordinates",value:function(t,e){var n=this,r=wi(e[0],e[1]);return"number"==typeof t[0]?this.lngLatToCoordByLayer(t,r):t.map((function(t){return Array.isArray(t)&&"number"==typeof t[0]?n.lngLatToCoordByLayer(t,r):t.map((function(t){return n.lngLatToCoordByLayer(t,r)}))}))}},{key:"setCoordCenter",value:function(t){this.map.customCoords.setCenter(t||U_),this.setCustomCoordCenter(t||U_)}},{key:"lngLatToCoord",value:function(t){return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub(wi(t[0],t[1]),this.sceneCenterMercator)}},{key:"lngLatToCoords",value:function(t){var e=this;return t.map((function(t){return"number"==typeof t[0]?e.lngLatToCoord(t):t.map((function(t){return e.lngLatToCoord(t)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];e.style.zIndex="auto",this.markerContainer=ri("div","l7-marker-container2",e)}}}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var t=this.map.getBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"lngLatToContainer",value:function(t){var e=this.map.lngLatToContainer(t);return{x:e.getX(),y:e.getY()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lngLatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(t),o=ia();return ca(o,o,Ia(i[0],i[1],e)),ha(o,o,Ia(r[0],r[1],r[2])),pa(o,o,n[0]),fa(o,o,n[1]),da(o,o,n[2]),o}},{key:"init",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,y,g,_,x;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,l=e.token,c=void 0===l?j_:l,h=e.mapInstance,p=e.plugin,f=void 0===p?[]:p,e.version,d=Wf(e,F_),this.viewport=new z_,window.AMap||h){t.next=6;break}return f.push("Map3D"),t.next=6,Rg.load({key:c,version:"2.0",plugins:f});case 6:h?(this.map=h,this.$mapContainer=this.map.getContainer(),m=this.map.getCenter(),null===(v=this.map.customCoords)||void 0===v||v.setCenter([m.lng,m.lat]),this.setCustomCoordCenter([m.lng,m.lat]),this.map.on("viewchange",this.handleViewChanged)):(this.$mapContainer=this.creatMapContainer(n),(g=It({mapStyle:this.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d)).zoom&&(g.zoom+=1),c===j_&&console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),_=new AMap.Map(this.$mapContainer,g),this.map=_,x=_.getCenter(),null===(y=this.map.customCoords)||void 0===y||y.setCenter([x.lng,x.lat]),this.setCustomCoordCenter([x.lng,x.lat]),_.on("viewchange",this.handleViewChanged)),this.initViewPort();case 8:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"initViewPort",value:function(){var t,e=null===(t=this.map.customCoords)||void 0===t?void 0:t.getCameraParams(),n=e.fov,r=e.near,i=e.far,o=e.aspect,a=e.position,s=e.lookAt,u=e.up;this.emit("mapchange");var l=this.map.customCoords.getCenter(),c=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:n,cameraPosition:a,lookAt:s,near:r,up:u,zoom:c-1,center:l,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(Dp.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(t,e){var n=[0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n}}]),r}(__))||D_;function G_(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var H_,W_=function(t){Oe(n,t);var e=G_(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"getServiceConstructor",value:function(){return V_}}]),n}(Pg),Z_=q_;function q_(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}function X_(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Y_(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y_(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Y_(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function K_(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function Q_(t,e,n){return Math.min(n,Math.max(e,t))}function J_(t,e,n){return t*(1-n)+e*n}function $_(t,e,n,r){var i=new Z_(t,e,n,r);return function(t){return i.solve(t)}}q_.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},q_.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},q_.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},q_.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},q_.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var tx=$_(.25,.1,.25,1);function ex(){return!(Jn||!tr.matchMedia)&&(null==H_&&(H_=tr.matchMedia("(prefers-reduced-motion: reduce)")),H_.matches)}var nx=Jn?Date.now.bind(Date):tr.performance&&tr.performance.now?tr.performance.now.bind(tr.performance):Date.now.bind(Date),rx=tr.requestAnimationFrame||tr.mozRequestAnimationFrame||tr.webkitRequestAnimationFrame||tr.msRequestAnimationFrame,ix=tr.cancelAnimationFrame||tr.mozCancelAnimationFrame||tr.webkitCancelAnimationFrame||tr.msCancelAnimationFrame;function ox(t){var e=rx(t);return{cancel:function(){return ix(e)}}}var ax=6371008.8,sx=function(){function t(e,n){if(Ee(this,t),isNaN(e)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(n,")"));if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return Te(t,[{key:"wrap",value:function(){return new t(K_(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return ax*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(e){if(e instanceof t)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new t(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"===Tt(e)&&null!==e){var n="lng"in e?e.lng:e.lon;return new t(Number(n),Number(e.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),t}(),ux=function(){function t(e,n){Ee(this,t),e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}return Te(t,[{key:"setNorthEast",value:function(t){return this.ne=t instanceof sx?new sx(t.lng,t.lat):sx.convert(t),this}},{key:"setSouthWest",value:function(t){return this.sw=t instanceof sx?new sx(t.lng,t.lat):sx.convert(t),this}},{key:"extend",value:function(e){var n,r,i=this.sw,o=this.ne;if(e instanceof sx)n=e,r=e;else{if(!(e instanceof t)){if(Array.isArray(e)){if(4===e.length||e.every(Array.isArray)){var a=e;return this.extend(t.convert(a))}var s=e;return this.extend(sx.convert(s))}return this}if(n=e.sw,r=e.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new sx(n.lng,n.lat),this.ne=new sx(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new sx((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new sx(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new sx(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(t){var e=sx.convert(t),n=e.lng,r=e.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(e){return e instanceof t?e:new t(e)}}]),t}(),lx=function(){function t(e,n){Ee(this,t),this.x=e,this.y=n}return Te(t,[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"_add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"add",value:function(t){return this.clone()._add(t)}},{key:"_sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"sub",value:function(t){return this.clone()._sub(t)}},{key:"_multByPoint",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multByPoint",value:function(t){return this.clone()._multByPoint(t)}},{key:"_divByPoint",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divByPoint",value:function(t){return this.clone()._divByPoint(t)}},{key:"_mult",value:function(t){return this.x*=t,this.y*=t,this}},{key:"mult",value:function(t){return this.clone()._mult(t)}},{key:"_div",value:function(t){return this.x/=t,this.y/=t,this}},{key:"div",value:function(t){return this.clone()._div(t)}},{key:"_rotate",value:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(t){return this.clone()._rotate(t)}},{key:"_rotateAround",value:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(t,e){return this.clone()._rotateAround(t,e)}},{key:"_matMult",value:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this}},{key:"matMult",value:function(t){return this.clone()._matMult(t)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var t=this.y;return this.y=this.x,this.x=-t,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"dist",value:function(t){return Math.sqrt(this.distSqr(t))}},{key:"distSqr",value:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"angleWith",value:function(t){return this.angleWithSep(t.x,t.y)}},{key:"angleWithSep",value:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)}}],[{key:"convert",value:function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}}]),t}(),cx=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Ee(this,t),isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=r,this.right=i}return Te(t,[{key:"interpolate",value:function(t,e,n){return null!=e.top&&null!=t.top&&(this.top=J_(t.top,e.top,n)),null!=e.bottom&&null!=t.bottom&&(this.bottom=J_(t.bottom,e.bottom,n)),null!=e.left&&null!=t.left&&(this.left=J_(t.left,e.left,n)),null!=e.right&&null!=t.right&&(this.right=J_(t.right,e.right,n)),this}},{key:"getCenter",value:function(t,e){var n=Q_((this.left+t-this.right)/2,0,t),r=Q_((this.top+e-this.bottom)/2,0,e);return new lx(n,r)}},{key:"equals",value:function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}},{key:"clone",value:function(){return new t(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),t}(),hx=2*Math.PI*ax;function px(t){return hx*Math.cos(t*Math.PI/180)}function fx(t){return(180+t)/360}function dx(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function vx(t,e){return t/px(e)}function mx(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}var yx=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Ee(this,t),this.x=+e,this.y=+n,this.z=+r}return Te(t,[{key:"toLngLat",value:function(){return new sx(360*this.x-180,mx(this.y))}},{key:"toAltitude",value:function(){return t=this.z,e=this.y,t*px(mx(e));var t,e}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/hx*(t=mx(this.y),1/Math.cos(t*Math.PI/180));var t}}],[{key:"fromLngLat",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=sx.convert(e);return new t(fx(r.lng),dx(r.lat),vx(n,r.lat))}}]),t}();function gx(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return _x(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _x(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _x(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var xx=function(){function t(e,n,r,i,o){Ee(this,t),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new sx(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new cx,this.posMatrixCache={},this.alignedPosMatrixCache={}}return Te(t,[{key:"minZoom",get:function(){return this._minZoom},set:function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}},{key:"minPitch",get:function(){return this._minPitch},set:function(t){this._minPitch!==t&&(this._minPitch=t,this._pitch=Math.max(this._pitch,t))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(t){this._maxPitch!==t&&(this._maxPitch=t,this._pitch=Math.min(this._pitch,t))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new lx(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(t){var e,n=-K_(t,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(e=new na(4),na!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e),function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var e=Q_(t,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==e&&(this.unmodified=!1,this._pitch=e,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this.unmodified=!1,this._fov=t/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(t){var e=Math.min(Math.max(t,this._minZoom),this._maxZoom);this._zoom!==e&&(this.unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this.unmodified=!1,this._center=t,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(t){this.edgeInsets.equals(t)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,t,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var e=new t(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e.center=this._center,e.zoom=this.zoom,e.angle=this.angle,e.fov=this._fov,e.pitch=this._pitch,e.unmodified=this.unmodified,e.edgeInsets=this.edgeInsets.clone(),e.calcMatrices(),e}},{key:"isPaddingEqual",value:function(t){return this.edgeInsets.equals(t)}},{key:"interpolatePadding",value:function(t,e,n){this.unmodified=!1,this.edgeInsets.interpolate(t,e,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(t){return Math.pow(2,t)}},{key:"scaleZoom",value:function(t){return Math.log(t)/Math.LN2}},{key:"project",value:function(t){var e=Q_(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new lx(fx(t.lng)*this.worldSize,dx(e)*this.worldSize)}},{key:"unproject",value:function(t){return new yx(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(t,e){var n=this.pointCoordinate(e),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(t),o=new yx(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(t){var e=new Float64Array([t.x,t.y,0,1]),n=new Float64Array([t.x,t.y,1,1]);es(e,e,this.pixelMatrixInverse),es(n,n,this.pixelMatrixInverse);var r=e[3],i=n[3],o=e[0]/r,a=n[0]/i,s=e[1]/r,u=n[1]/i,l=e[2]/r,c=n[2]/i,h=l===c?0:(0-l)/(c-l);return new yx(J_(o,a,h)/this.worldSize,J_(s,u,h)/this.worldSize)}},{key:"getBounds",value:function(){return(new ux).extend(this.pointLocation(new lx(0,0))).extend(this.pointLocation(new lx(this.width,0))).extend(this.pointLocation(new lx(this.width,this.height))).extend(this.pointLocation(new lx(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new ux([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new lx(0,0)),e=new Float32Array([t.x*this.worldSize,t.y*this.worldSize,0,1]);return es(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var t=this._pitch,e=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new lx(0,e))}},{key:"getCameraQueryGeometry",value:function(t){var e=this.getCameraPoint();if(1===t.length)return[t[0],e];var n,r=e.x,i=e.y,o=e.x,a=e.y,s=gx(t);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(t){s.e(t)}finally{s.f()}return[new lx(r,i),new lx(o,i),new lx(o,a),new lx(r,a),new lx(r,i)]}},{key:"coordinatePoint",value:function(t){var e=ts(t.x*this.worldSize,t.y*this.worldSize,0,1);return es(e,e,this.pixelMatrix),new lx(e[0]/e[3],e[1]/e[3])}},{key:"locationPoint",value:function(t){return this.coordinatePoint(this.locationCoordinate(t))}},{key:"pointLocation",value:function(t){return this.coordinateLocation(this.pointCoordinate(t))}},{key:"locationCoordinate",value:function(t){return yx.fromLngLat(t)}},{key:"coordinateLocation",value:function(t){return t.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var t,e,n,r,i=-90,o=90,a=-180,s=180,u=this.size,l=this.unmodified;if(this.latRange){var c=this.latRange;i=dx(c[1])*this.worldSize,t=(o=dx(c[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var h=this.lngRange;a=fx(h[0])*this.worldSize,e=(s=fx(h[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var p=this.point,f=Math.max(e||0,t||0);if(f)return this.center=this.unproject(new lx(e?(s+a)/2:p.x,t?(o+i)/2:p.y)),Jn?this.zoom=Math.max(this.zoom,Math.max(-1,this.minZoom)):this.zoom+=this.scaleZoom(f),this.unmodified=l,void(this.constraining=!1);if(this.latRange){var d=p.y,v=u.y/2;d-v<i&&(r=i+v),d+v>o&&(r=o-v)}if(this.lngRange){var m=p.x,y=u.x/2;m-y<a&&(n=a+y),m+y>s&&(n=s-y)}void 0===n&&void 0===r||(this.center=this.unproject(new lx(void 0!==n?n:p.x,void 0!==r?r:p.y))),this.unmodified=l,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var t=this._fov/2,e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(t)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(Q_(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);_a(c,this._fov,this.width/this.height,l,u),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,ha(c,c,[1,-1,1]),ca(c,c,[0,0,-this.cameraToCenterDistance]),pa(c,c,this._pitch),da(c,c,this.angle),ca(c,c,[-a,-s,0]),this.mercatorMatrix=ha([],c,[this.worldSize,this.worldSize,this.worldSize]),ha(c,c,[1,1,vx(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=ua([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,f=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+f*h+d*p,m=s-Math.round(s)+f*p+d*h,y=new Float64Array(c);if(ca(y,y,[v>.5?v-1:v,m>.5?m-1:m,0]),this.alignedProjMatrix=y,ha(c=ia(),c,[this.width/2,-this.height/2,1]),ca(c,c,[1,-1,0]),this.labelPlaneMatrix=c,ha(c=ia(),c,[1,-1,1]),ca(c,c,[-1,-1,0]),ha(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=la(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=ua(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),t}();var bx=function(){this.__data__=[],this.size=0};var Sx=function(t,e){return t===e||t!=t&&e!=e},Ex=Sx;var Ax=function(t,e){for(var n=t.length;n--;)if(Ex(t[n][0],e))return n;return-1},Tx=Ax,Cx=Array.prototype.splice;var kx=function(t){var e=this.__data__,n=Tx(e,t);return!(n<0)&&(n==e.length-1?e.pop():Cx.call(e,n,1),--this.size,!0)},Mx=Ax;var Ix=function(t){var e=this.__data__,n=Mx(e,t);return n<0?void 0:e[n][1]},Px=Ax;var Lx=Ax;var Rx=function(t,e){var n=this.__data__,r=Lx(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Ox=bx,Dx=kx,Nx=Ix,zx=function(t){return Px(this.__data__,t)>-1},Fx=Rx;function Bx(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Bx.prototype.clear=Ox,Bx.prototype.delete=Dx,Bx.prototype.get=Nx,Bx.prototype.has=zx,Bx.prototype.set=Fx;var Ux=Bx,jx=Ux;var Vx=function(){this.__data__=new jx,this.size=0};var Gx=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var Hx=function(t){return this.__data__.get(t)};var Wx=function(t){return this.__data__.has(t)},Zx="object"==typeof D&&D&&D.Object===Object&&D,qx=Zx,Xx="object"==typeof self&&self&&self.Object===Object&&self,Yx=qx||Xx||Function("return this")(),Kx=Yx.Symbol,Qx=Kx,Jx=Object.prototype,$x=Jx.hasOwnProperty,tb=Jx.toString,eb=Qx?Qx.toStringTag:void 0;var nb=function(t){var e=$x.call(t,eb),n=t[eb];try{t[eb]=void 0;var r=!0}catch(t){}var i=tb.call(t);return r&&(e?t[eb]=n:delete t[eb]),i},rb=Object.prototype.toString;var ib=nb,ob=function(t){return rb.call(t)},ab=Kx?Kx.toStringTag:void 0;var sb=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":ab&&ab in Object(t)?ib(t):ob(t)};var ub=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},lb=sb,cb=ub;var hb,pb=function(t){if(!cb(t))return!1;var e=lb(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},fb=Yx["__core-js_shared__"],db=(hb=/[^.]+$/.exec(fb&&fb.keys&&fb.keys.IE_PROTO||""))?"Symbol(src)_1."+hb:"";var vb=function(t){return!!db&&db in t},mb=Function.prototype.toString;var yb=function(t){if(null!=t){try{return mb.call(t)}catch(t){}try{return t+""}catch(t){}}return""},gb=pb,_b=vb,xb=ub,bb=yb,wb=/^\[object .+?Constructor\]$/,Sb=Function.prototype,Eb=Object.prototype,Ab=Sb.toString,Tb=Eb.hasOwnProperty,Cb=RegExp("^"+Ab.call(Tb).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var kb=function(t,e){return null==t?void 0:t[e]},Mb=function(t){return!(!xb(t)||_b(t))&&(gb(t)?Cb:wb).test(bb(t))},Ib=kb;var Pb=function(t,e){var n=Ib(t,e);return Mb(n)?n:void 0},Lb=Pb(Yx,"Map"),Rb=Pb(Object,"create"),Ob=Rb;var Db=function(){this.__data__=Ob?Ob(null):{},this.size=0};var Nb=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},zb=Rb,Fb=Object.prototype.hasOwnProperty;var Bb=function(t){var e=this.__data__;if(zb){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return Fb.call(e,t)?e[t]:void 0},Ub=Rb,jb=Object.prototype.hasOwnProperty;var Vb=function(t){var e=this.__data__;return Ub?void 0!==e[t]:jb.call(e,t)},Gb=Rb;var Hb=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Gb&&void 0===e?"__lodash_hash_undefined__":e,this},Wb=Db,Zb=Nb,qb=Bb,Xb=Vb,Yb=Hb;function Kb(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Kb.prototype.clear=Wb,Kb.prototype.delete=Zb,Kb.prototype.get=qb,Kb.prototype.has=Xb,Kb.prototype.set=Yb;var Qb=Kb,Jb=Ux,$b=Lb;var tw=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var ew=function(t,e){var n=t.__data__;return tw(e)?n["string"==typeof e?"string":"hash"]:n.map},nw=ew;var rw=function(t){var e=nw(this,t).delete(t);return this.size-=e?1:0,e},iw=ew;var ow=ew;var aw=ew;var sw=function(t,e){var n=aw(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},uw=function(){this.size=0,this.__data__={hash:new Qb,map:new($b||Jb),string:new Qb}},lw=rw,cw=function(t){return iw(this,t).get(t)},hw=function(t){return ow(this,t).has(t)},pw=sw;function fw(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}fw.prototype.clear=uw,fw.prototype.delete=lw,fw.prototype.get=cw,fw.prototype.has=hw,fw.prototype.set=pw;var dw=Ux,vw=Lb,mw=fw;var yw=function(t,e){var n=this.__data__;if(n instanceof dw){var r=n.__data__;if(!vw||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new mw(r)}return n.set(t,e),this.size=n.size,this},gw=Ux,_w=Vx,xw=Gx,bw=Hx,ww=Wx,Sw=yw;function Ew(t){var e=this.__data__=new gw(t);this.size=e.size}Ew.prototype.clear=_w,Ew.prototype.delete=xw,Ew.prototype.get=bw,Ew.prototype.has=ww,Ew.prototype.set=Sw;var Aw=Ew,Tw=Pb,Cw=function(){try{var t=Tw(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),kw=Cw,Mw=kw;var Iw=function(t,e,n){"__proto__"==e&&Mw?Mw(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},Pw=Iw,Lw=Sx;var Rw=function(t,e,n){(void 0!==n&&!Lw(t[e],n)||void 0===n&&!(e in t))&&Pw(t,e,n)};var Ow=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}},Dw=Ow(),Nw={exports:{}};!function(t,e){var n=Yx,r=e&&!e.nodeType&&e,i=r&&t&&!t.nodeType&&t,o=i&&i.exports===r?n.Buffer:void 0,a=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=a?a(n):new t.constructor(n);return t.copy(r),r}}(Nw,Nw.exports);var zw=Yx.Uint8Array;var Fw=function(t){var e=new t.constructor(t.byteLength);return new zw(e).set(new zw(t)),e},Bw=Fw;var Uw=function(t,e){var n=e?Bw(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var jw=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e},Vw=ub,Gw=Object.create,Hw=function(){function t(){}return function(e){if(!Vw(e))return{};if(Gw)return Gw(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),Ww=Hw;var Zw=function(t,e){return function(n){return t(e(n))}},qw=Zw(Object.getPrototypeOf,Object),Xw=Object.prototype;var Yw=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Xw)},Kw=Ww,Qw=qw,Jw=Yw;var $w=function(t){return"function"!=typeof t.constructor||Jw(t)?{}:Kw(Qw(t))};var tS=function(t){return null!=t&&"object"==typeof t},eS=sb,nS=tS;var rS=function(t){return nS(t)&&"[object Arguments]"==eS(t)},iS=tS,oS=Object.prototype,aS=oS.hasOwnProperty,sS=oS.propertyIsEnumerable,uS=rS(function(){return arguments}())?rS:function(t){return iS(t)&&aS.call(t,"callee")&&!sS.call(t,"callee")},lS=uS,cS=Array.isArray;var hS=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},pS=pb,fS=hS;var dS=function(t){return null!=t&&fS(t.length)&&!pS(t)},vS=dS,mS=tS;var yS=function(t){return mS(t)&&vS(t)},gS={exports:{}};var _S=function(){return!1};!function(t,e){var n=Yx,r=_S,i=e&&!e.nodeType&&e,o=i&&t&&!t.nodeType&&t,a=o&&o.exports===i?n.Buffer:void 0,s=(a?a.isBuffer:void 0)||r;t.exports=s}(gS,gS.exports);var xS=sb,bS=qw,wS=tS,SS=Function.prototype,ES=Object.prototype,AS=SS.toString,TS=ES.hasOwnProperty,CS=AS.call(Object);var kS=function(t){if(!wS(t)||"[object Object]"!=xS(t))return!1;var e=bS(t);if(null===e)return!0;var n=TS.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&AS.call(n)==CS},MS=sb,IS=hS,PS=tS,LS={};LS["[object Float32Array]"]=LS["[object Float64Array]"]=LS["[object Int8Array]"]=LS["[object Int16Array]"]=LS["[object Int32Array]"]=LS["[object Uint8Array]"]=LS["[object Uint8ClampedArray]"]=LS["[object Uint16Array]"]=LS["[object Uint32Array]"]=!0,LS["[object Arguments]"]=LS["[object Array]"]=LS["[object ArrayBuffer]"]=LS["[object Boolean]"]=LS["[object DataView]"]=LS["[object Date]"]=LS["[object Error]"]=LS["[object Function]"]=LS["[object Map]"]=LS["[object Number]"]=LS["[object Object]"]=LS["[object RegExp]"]=LS["[object Set]"]=LS["[object String]"]=LS["[object WeakMap]"]=!1;var RS=function(t){return PS(t)&&IS(t.length)&&!!LS[MS(t)]};var OS=function(t){return function(e){return t(e)}},DS={exports:{}};!function(t,e){var n=Zx,r=e&&!e.nodeType&&e,i=r&&t&&!t.nodeType&&t,o=i&&i.exports===r&&n.process,a=function(){try{var t=i&&i.require&&i.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a}(DS,DS.exports);var NS=RS,zS=OS,FS=DS.exports,BS=FS&&FS.isTypedArray,US=BS?zS(BS):NS;var jS=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},VS=Iw,GS=Sx,HS=Object.prototype.hasOwnProperty;var WS=function(t,e,n){var r=t[e];HS.call(t,e)&&GS(r,n)&&(void 0!==n||e in t)||VS(t,e,n)},ZS=WS,qS=Iw;var XS=function(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],u=r?r(n[s],t[s],s,n,t):void 0;void 0===u&&(u=t[s]),i?qS(n,s,u):ZS(n,s,u)}return n};var YS=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},KS=/^(?:0|[1-9]\d*)$/;var QS=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&KS.test(t))&&t>-1&&t%1==0&&t<e},JS=YS,$S=lS,tE=cS,eE=gS.exports,nE=QS,rE=US,iE=Object.prototype.hasOwnProperty;var oE=function(t,e){var n=tE(t),r=!n&&$S(t),i=!n&&!r&&eE(t),o=!n&&!r&&!i&&rE(t),a=n||r||i||o,s=a?JS(t.length,String):[],u=s.length;for(var l in t)!e&&!iE.call(t,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||nE(l,u))||s.push(l);return s};var aE=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},sE=ub,uE=Yw,lE=aE,cE=Object.prototype.hasOwnProperty;var hE=function(t){if(!sE(t))return lE(t);var e=uE(t),n=[];for(var r in t)("constructor"!=r||!e&&cE.call(t,r))&&n.push(r);return n},pE=oE,fE=hE,dE=dS;var vE=function(t){return dE(t)?pE(t,!0):fE(t)},mE=XS,yE=vE;var gE=Rw,_E=Nw.exports,xE=Uw,bE=jw,wE=$w,SE=lS,EE=cS,AE=yS,TE=gS.exports,CE=pb,kE=ub,ME=kS,IE=US,PE=jS,LE=function(t){return mE(t,yE(t))};var RE=function(t,e,n,r,i,o,a){var s=PE(t,n),u=PE(e,n),l=a.get(u);if(l)gE(t,n,l);else{var c=o?o(s,u,n+"",t,e,a):void 0,h=void 0===c;if(h){var p=EE(u),f=!p&&TE(u),d=!p&&!f&&IE(u);c=u,p||f||d?EE(s)?c=s:AE(s)?c=bE(s):f?(h=!1,c=_E(u,!0)):d?(h=!1,c=xE(u,!0)):c=[]:ME(u)||SE(u)?(c=s,SE(s)?c=LE(s):kE(s)&&!CE(s)||(c=wE(u))):h=!1}h&&(a.set(u,c),i(c,u,r,o,a),a.delete(u)),gE(t,n,c)}},OE=Aw,DE=Rw,NE=Dw,zE=RE,FE=ub,BE=vE,UE=jS;var jE=function t(e,n,r,i,o){e!==n&&NE(n,(function(a,s){if(o||(o=new OE),FE(a))zE(e,n,s,r,t,i,o);else{var u=i?i(UE(e,s),a,s+"",e,n,o):void 0;void 0===u&&(u=a),DE(e,s,u)}}),BE)};var VE=function(t){return t};var GE=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},HE=GE,WE=Math.max;var ZE=function(t,e,n){return e=WE(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=WE(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),HE(t,this,s)}};var qE=function(t){return function(){return t}},XE=kw,YE=XE?function(t,e){return XE(t,"toString",{configurable:!0,enumerable:!1,value:qE(e),writable:!0})}:VE,KE=YE,QE=Date.now;var JE=function(t){var e=0,n=0;return function(){var r=QE(),i=16-(r-n);if(n=r,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}},$E=JE(KE),tA=VE,eA=ZE,nA=$E;var rA=function(t,e){return nA(eA(t,e,tA),t+"")},iA=Sx,oA=dS,aA=QS,sA=ub;var uA=function(t,e,n){if(!sA(n))return!1;var r=typeof e;return!!("number"==r?oA(n)&&aA(e,n.length):"string"==r&&e in n)&&iA(n[e],t)},lA=rA,cA=uA;var hA=function(t){return lA((function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(i--,o):void 0,a&&cA(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),e=Object(e);++r<i;){var s=n[r];s&&t(e,s,r,o)}return e}))},pA=jE,fA=hA((function(t,e,n){pA(t,e,n)})),dA=fA,vA=Te((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ee(this,t),dA(this,n),this.type=e}));function mA(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var yA=function(t){Oe(n,t);var e=mA(n);function n(t){var r;Ee(this,n),kt(De(r=e.call(this)),"renderFrameCallback",(function(){var t=Math.min((nx()-r.easeStart)/r.easeOptions.duration,1);r.onEaseFrame(r.easeOptions.easing(t)),t<1?r.easeFrameId=r.requestRenderFrame(r.renderFrameCallback):r.stop()})),r.options=t;var i=t.minZoom,o=t.maxZoom,a=t.minPitch,s=t.maxPitch,u=t.renderWorldCopies;return r.moving=!1,r.zooming=!1,r.bearingSnap=t.bearingSnap,r.pitchEnabled=t.pitchEnabled,r.rotateEnabled=t.rotateEnabled,r.transform=new xx(i,o,a,s,u),r}return Te(n,[{key:"requestRenderFrame",value:function(t){return 0}},{key:"cancelRenderFrame",value:function(t){}},{key:"getCenter",value:function(){var t=this.transform.center,e=t.lng,n=t.lat;return new sx(e,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(t,e){return this.jumpTo({center:t},e)}},{key:"setPitch",value:function(t,e){return this.jumpTo({pitch:t},e),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(t,e,n){return this.easeTo(ti.exports.merge({center:t},e),n)}},{key:"panBy",value:function(t,e,n){return t=lx.convert(t).mult(-1),this.panTo(this.transform.center,function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];for(var s in a)void 0!==a[s]&&(t[s]=a[s])}return t}({offset:t},e||{}),n)}},{key:"zoomOut",value:function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}},{key:"setBearing",value:function(t,e){return this.jumpTo({bearing:t},e),this}},{key:"setZoom",value:function(t,e){return this.jumpTo({zoom:t},e),this}},{key:"zoomIn",value:function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}},{key:"zoomTo",value:function(t,e,n){return this.easeTo(ti.exports.merge({zoom:t},e),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(t,e){return this.jumpTo({padding:t},e),this}},{key:"rotateTo",value:function(t,e,n){return this.easeTo(ti.exports.merge({bearing:t},e),n)}},{key:"resetNorth",value:function(t,e){return this.rotateTo(0,ti.exports.merge({duration:1e3},t),e),this}},{key:"resetNorthPitch",value:function(t,e){return this.easeTo(ti.exports.merge({bearing:0,pitch:0,duration:1e3},t),e),this}},{key:"fitBounds",value:function(t,e,n){return this.fitInternal(this.cameraForBounds(t,e),e,n)}},{key:"cameraForBounds",value:function(t,e){return t=ux.convert(t),this.cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,e)}},{key:"snapToNorth",value:function(t,e){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(t,e):this}},{key:"jumpTo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return void 0!==t.zoom&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=sx.convert(t.center)),void 0!==t.bearing&&n.bearing!==+t.bearing&&(i=!0,n.bearing=+t.bearing),void 0!==t.pitch&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),void 0===t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),this.emit("movestart",new vA("movestart",e)),this.emit("move",new vA("move",e)),r&&(this.emit("zoomstart",new vA("zoomstart",e)),this.emit("zoom",new vA("zoom",e)),this.emit("zoomend",new vA("zoomend",e))),i&&(this.emit("rotatestart",new vA("rotatestart",e)),this.emit("rotate",new vA("rotate",e)),this.emit("rotateend",new vA("rotateend",e))),o&&(this.emit("pitchstart",new vA("pitchstart",e)),this.emit("pitch",new vA("pitch",e)),this.emit("pitchend",new vA("pitchend",e))),this.emit("moveend",new vA("moveend",e))}},{key:"easeTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(e=ti.exports.merge({offset:[0,0],duration:500,easing:tx},e)).animate||!e.essential&&ex())&&(e.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=e.zoom?+e.zoom:i,l=e.bearing?this.normalizeBearing(e.bearing,o):o,c=e.pitch?+e.pitch:a,h=e.padding?e.padding:r.padding,p=lx.convert(e.offset),f=r.centerPoint.add(p),d=r.pointLocation(f),v=sx.convert(e.center||d);this.normalizeCenter(v);var m,y,g=r.project(d),_=r.project(v).sub(g),x=r.zoomScale(u-i);e.around&&(m=sx.convert(e.around),y=r.locationPoint(m));var b={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==l,this.pitching=this.pitching||c!==a,this.padding=!r.isPaddingEqual(h),this.easeId=e.easeId,this.prepareEase(n,e.noMoveStart,b),clearTimeout(this.easeEndTimeoutID),this.ease((function(e){if(t.zooming&&(r.zoom=J_(i,u,e)),t.rotating&&t.rotateEnabled&&(r.bearing=J_(o,l,e)),t.pitching&&t.pitchEnabled&&(r.pitch=J_(a,c,e)),t.padding&&(r.interpolatePadding(s,h,e),f=r.centerPoint.add(p)),m)r.setLocationAtPoint(m,y);else{var d=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,x):Math.max(.5,x),b=Math.pow(v,1-e),w=r.unproject(g.add(_.mult(e*b)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?w.wrap():w,f)}t.fireMoveEvents(n)}),(function(e){t.afterEase(n,e)}),e),this}},{key:"flyTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!e.essential&&ex()){var r=function(t,e){var n,r={},i=X_(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in t&&(r[o]=t[o])}}catch(t){i.e(t)}finally{i.f()}return r}(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),e=ti.exports.merge({offset:[0,0],speed:1.2,curve:1.42,easing:tx},e);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l=e.zoom?Q_(+e.zoom,i.minZoom,i.maxZoom):o,c=e.bearing?this.normalizeBearing(e.bearing,a):a,h=e.pitch?+e.pitch:s,p="padding"in e?e.padding:i.padding,f=i.zoomScale(l-o),d=lx.convert(e.offset),v=i.centerPoint.add(d),m=i.pointLocation(v),y=sx.convert(e.center||m);this.normalizeCenter(y);var g=i.project(m),_=i.project(y).sub(g),x=e.curve,b=Math.max(i.width,i.height),w=b/f,S=_.mag();if("minZoom"in e){var E=Q_(Math.min(e.minZoom,o,l),i.minZoom,i.maxZoom),A=b/i.zoomScale(E-o);x=Math.sqrt(A/S*2)}var T=x*x;function C(t){var e=(w*w-b*b+(t?-1:1)*T*T*S*S)/(2*(t?w:b)*T*S);return Math.log(Math.sqrt(e*e+1)-e)}function k(t){return(Math.exp(t)-Math.exp(-t))/2}function M(t){return(Math.exp(t)+Math.exp(-t))/2}var I=C(0),P=function(t){return M(I)/M(I+x*t)},L=function(t){return b*((M(I)*(k(e=I+x*t)/M(e))-k(I))/T)/S;var e},R=(C(1)-I)/x;if(Math.abs(S)<1e-6||!isFinite(R)){if(Math.abs(b-w)<1e-6)return this.easeTo(e,n);var O=w<b?-1:1;R=Math.abs(Math.log(w/b))/x,L=function(){return 0},P=function(t){return Math.exp(O*x*t)}}if("duration"in e)e.duration=+e.duration;else{var D="screenSpeed"in e?+e.screenSpeed/x:+e.speed;e.duration=1e3*R/D}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this.zooming=!0,this.rotating=a!==c,this.pitching=h!==s,this.padding=!i.isPaddingEqual(p),this.prepareEase(n,!1),this.ease((function(e){var r=e*R,f=1/P(r);i.zoom=1===e?l:o+i.scaleZoom(f),t.rotating&&(i.bearing=J_(a,c,e)),t.pitching&&(i.pitch=J_(s,h,e)),t.padding&&(i.interpolatePadding(u,p,e),v=i.centerPoint.add(d));var m=1===e?y:i.unproject(g.add(_.mult(L(r))).mult(f));i.setLocationAtPoint(i.renderWorldCopies?m.wrap():m,v),t.fireMoveEvents(n)}),(function(){return t.afterEase(n)}),e),this}},{key:"fitScreenCoordinates",value:function(t,e,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(lx.convert(t)),this.transform.pointLocation(lx.convert(e)),n,r),r,i)}},{key:"stop",value:function(t,e){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,e)}return this}},{key:"normalizeBearing",value:function(t,e){t=K_(t,-180,180);var n=Math.abs(t-e);return Math.abs(t-360-e)<n&&(t-=360),Math.abs(t+360-e)<n&&(t+=360),t}},{key:"normalizeCenter",value:function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(t){this.emit("move",new vA("move",t)),this.zooming&&this.emit("zoom",new vA("zoom",t)),this.rotating&&this.emit("rotate",new vA("rotate",t)),this.pitching&&this.emit("rotate",new vA("pitch",t))}},{key:"prepareEase",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,e||n.moving||this.emit("movestart",new vA("movestart",t)),this.zooming&&!n.zooming&&this.emit("zoomstart",new vA("zoomstart",t)),this.rotating&&!n.rotating&&this.emit("rotatestart",new vA("rotatestart",t)),this.pitching&&!n.pitching&&this.emit("pitchstart",new vA("pitchstart",t))}},{key:"afterEase",value:function(t,e){if(!this.easeId||!e||this.easeId!==e){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new vA("zoomend",t)),r&&this.emit("rotateend",new vA("rotateend",t)),i&&this.emit("pitchend",new vA("pitchend",t)),this.emit("moveend",new vA("moveend",t))}}},{key:"ease",value:function(t,e,n){!1===n.animate||0===n.duration?(t(1),e()):(this.easeStart=nx(),this.easeOptions=n,this.onEaseFrame=t,this.onEaseEnd=e,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(t,e,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=ti.exports.merge({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=ti.exports.merge(i,r.padding);var a=this.transform,s=a.padding,u=a.project(sx.convert(t)),l=a.project(sx.convert(e)),c=u.rotate(-n*Math.PI/180),h=l.rotate(-n*Math.PI/180),p=new lx(Math.max(c.x,h.x),Math.max(c.y,h.y)),f=new lx(Math.min(c.x,h.x),Math.min(c.y,h.y)),d=p.sub(f),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,m=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(m<0||v<0)){var y=Math.min(a.scaleZoom(a.scale*Math.min(v,m)),r.maxZoom),g=lx.convert(r.offset),_=(r.padding.left-r.padding.right)/2,x=(r.padding.top-r.padding.bottom)/2,b=new lx(g.x+_,g.y+x).mult(a.scale/a.zoomScale(y));return{center:a.unproject(u.add(l).div(2).sub(b)),zoom:y,bearing:n}}}},{key:"fitInternal",value:function(t,e,n){return t?(delete(e=ti.exports.merge(t,e)).padding,e.linear?this.easeTo(e,n):this.flyTo(e,n)):this}}]),n}(Oi.exports.EventEmitter);function gA(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return _A(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _A(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _A(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var xA={create:function(t,e,n){var r=tr.document.createElement(t);return void 0!==e&&(r.className=e),n&&n.appendChild(r),r},createNS:function(t,e){return tr.document.createElementNS(t,e)}},bA=tr.document&&tr.document.documentElement.style;function wA(t){if(!bA)return t[0];var e,n=gA(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r in bA)return r}}catch(t){n.e(t)}finally{n.f()}return t[0]}var SA,EA=wA(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);xA.disableDrag=function(){bA&&EA&&(SA=bA[EA],bA[EA]="none")},xA.enableDrag=function(){bA&&EA&&(bA[EA]=SA)};var AA=wA(["transform","WebkitTransform"]);xA.setTransform=function(t,e){t.style[AA]=e};var TA=!1;try{var CA=Object.defineProperty({},"passive",{get:function(){TA=!0}});tr.addEventListener("test",CA,CA),tr.removeEventListener("test",CA,CA)}catch(t){TA=!1}xA.addEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&TA?t.addEventListener(e,n,r):t.addEventListener(e,n,r.capture)},xA.removeEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&TA?t.removeEventListener(e,n,r):t.removeEventListener(e,n,r.capture)};var kA=function t(e){e.preventDefault(),e.stopPropagation(),tr.removeEventListener("click",t,!0)};function MA(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}xA.suppressClick=function(){Jn||(tr.addEventListener("click",kA,!0),setTimeout((function(){tr.removeEventListener("click",kA,!0)}),0))},xA.mousePos=function(t,e){if(Jn)return new lx(e.clientX-t.left-0,e.clientY-t.top-0);var n=t.getBoundingClientRect();return new lx(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},xA.touchPos=function(t,e){if(Jn){var n,r=[],i=gA(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;r.push(new lx(o.clientX-t.left,o.clientY-t.top))}}catch(t){i.e(t)}finally{i.f()}return r}var a,s=t.getBoundingClientRect(),u=[],l=gA(e);try{for(l.s();!(a=l.n()).done;){var c=a.value;u.push(new lx(c.clientX-s.left-t.clientLeft,c.clientY-s.top-t.clientTop))}}catch(t){l.e(t)}finally{l.f()}return u},xA.mouseButton=function(t){return Jn&&void 0!==tr.InstallTrigger&&2===t.button&&t.ctrlKey&&tr.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},xA.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var IA=function(t){Oe(n,t);var e=MA(n);function n(t,r,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Ee(this,n);var s=xA.mousePos(r.getCanvasContainer(),i),u=r.unproject(s);return(o=e.call(this,t,dA({point:s,lngLat:u,originalEvent:i},a))).defaultPrevented=!1,o.target=r,o}return Te(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(vA);function PA(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var LA=function(t){Oe(n,t);var e=PA(n);function n(t,r,i){var o;Ee(this,n);var a="touchend"===t?i.changedTouches:i.touches,s=xA.touchPos(r.getCanvasContainer(),a),u=s.map((function(t){return r.unproject(t)})),l=s.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new lx(0,0)),c=r.unproject(l);return(o=e.call(this,t,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:i})).defaultPrevented=!1,o}return Te(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(vA);function RA(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var OA=function(t){Oe(n,t);var e=RA(n);function n(t,r,i){var o;return Ee(this,n),(o=e.call(this,t,{originalEvent:i})).defaultPrevented=!1,o}return Te(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(vA),DA=function(){function t(e){Ee(this,t),this.map=e}return Te(t,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(t){this.map.emit(t.type,new IA(t.type,this.map,t))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new IA("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(t){this.delayContextMenu?this.contextMenuEvent=t:this.map.emit(t.type,new IA(t.type,this.map,t)),this.map.listeners("contextmenu")&&t.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),t}(),NA=function(){function t(e,n){Ee(this,t),this.map=e,this.el=e.getCanvasContainer(),this.container=e.getContainer(),this.clickTolerance=n.clickTolerance||1}return Te(t,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(xA.disableDrag(),this.startPos=this.lastPos=e,this.active=!0)}},{key:"mousemoveWindow",value:function(t,e){if(this.active){var n=e;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=xA.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",t));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);xA.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(t,e){var n=this;if(this.active&&0===t.button){var r=this.startPos,i=e;if(this.reset(),xA.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new vA("boxzoomend",{originalEvent:t})),{cameraAnimation:function(t){return t.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",t)}}},{key:"keydown",value:function(t){this.active&&27===t.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",t))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(xA.remove(this.box),this.box=null),xA.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(t,e){return this.map.emit(t,new vA(t,{originalEvent:e}))}}]),t}(),zA=function(){function t(){Ee(this,t),this.reset()}return Te(t,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function FA(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var BA=function(t){Oe(n,t);var e=FA(n);function n(){var t;Ee(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return kt(De(t=e.call.apply(e,[this].concat(i))),"type","renderFrame"),t}return Te(n)}(vA);function UA(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return jA(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jA(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function jA(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var VA={linearity:.3,easing:$_(0,0,.3,1)},GA=dA({deceleration:2500,maxSpeed:1400},VA),HA=dA({deceleration:20,maxSpeed:1400},VA),WA=dA({deceleration:1e3,maxSpeed:360},VA),ZA=dA({deceleration:1e3,maxSpeed:90},VA),qA=function(){function t(e){Ee(this,t),this.map=e,this.clear()}return Te(t,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(t){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:nx(),settings:t})}},{key:"drainInertiaBuffer",value:function(){for(var t=this.inertiaBuffer,e=nx();t.length>0&&e-t[0].time>160;)t.shift()}},{key:"onMoveEnd",value:function(t){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var e,n={zoom:0,bearing:0,pitch:0,pan:new lx(0,0),pinchAround:void 0,around:void 0},r=UA(this.inertiaBuffer);try{for(r.s();!(e=r.n()).done;){var i=e.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(t){r.e(t)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=YA(n.pan.mag(),o,dA({},GA,t||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,XA(a,s)}if(n.zoom){var u=YA(n.zoom,o,HA);a.zoom=this.map.transform.zoom+u.amount,XA(a,u)}if(n.bearing){var l=YA(n.bearing,o,WA);a.bearing=this.map.transform.bearing+Q_(l.amount,-179,179),XA(a,l)}if(n.pitch){var c=YA(n.pitch,o,ZA);a.pitch=this.map.transform.pitch+c.amount,XA(a,c)}if(a.zoom||a.bearing){var h=void 0===n.pinchAround?n.around:n.pinchAround;a.around=h?this.map.unproject(h):this.map.getCenter()}return this.clear(),dA(a,{noMoveStart:!0})}}}]),t}();function XA(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function YA(t,e,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=Q_(t*i/(e/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var KA={panStep:100,bearingStep:15,pitchStep:10},QA=function(){function t(){Ee(this,t);var e=KA;this.panStep=e.panStep,this.bearingStep=e.bearingStep,this.pitchStep=e.pitchStep}return Te(t,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:JA,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e.bearingStep,pitch:s.getPitch()+i*e.pitchStep,offset:[-o*e.panStep,-a*e.panStep],center:s.getCenter()},{originalEvent:t})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function JA(t){return t*(2-t)}var $A,tT=function(){function t(e,n){Ee(this,t),this.map=e,this.clickTolerance=n.clickTolerance}return Te(t,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(t){return this.firePreventable(new OA(t.type,this.map,t))}},{key:"mousedown",value:function(t,e){return this.mousedownPos=e,this.firePreventable(new IA(t.type,this.map,t))}},{key:"mouseup",value:function(t){this.map.emit(t.type,new IA(t.type,this.map,t))}},{key:"click",value:function(t,e){this.mousedownPos&&this.mousedownPos.dist(e)>=this.clickTolerance||this.map.emit(t.type,new IA(t.type,this.map,t))}},{key:"dblclick",value:function(t){return this.firePreventable(new IA(t.type,this.map,t))}},{key:"mouseover",value:function(t){this.map.emit(t.type,new IA(t.type,this.map,t))}},{key:"mouseout",value:function(t){this.map.emit(t.type,new IA(t.type,this.map,t))}},{key:"touchstart",value:function(t){return this.firePreventable(new LA(t.type,this.map,t))}},{key:"touchmove",value:function(t){this.map.emit(t.type,new LA(t.type,this.map,t))}},{key:"touchend",value:function(t){this.map.emit(t.type,new LA(t.type,this.map,t))}},{key:"touchcancel",value:function(t){this.map.emit(t.type,new LA(t.type,this.map,t))}},{key:"firePreventable",value:function(t){if(this.map.emit(t.type,t),t.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),t}(),eT=(kt($A={},0,1),kt($A,2,2),$A);var nT=function(){function t(e){Ee(this,t),this.reset(),this.clickTolerance=e.clickTolerance||1}return Te(t,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(t,e){if(!this.lastPoint){var n=xA.mouseButton(t);this.correctButton(t,n)&&(this.lastPoint=e,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(t,e){var n=this.lastPoint;if(n)if(t.preventDefault(),function(t,e){var n=eT[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this.eventButton))this.reset();else if(this.moved||!(e.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=e,this.move(n,e)}},{key:"mouseupWindow",value:function(t){this.lastPoint&&(xA.mouseButton(t)===this.eventButton&&(this.moved&&xA.suppressClick(),this.reset()))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(t,e){return!1}},{key:"move",value:function(t,e){}}]),t}();function rT(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var iT=function(t){Oe(n,t);var e=rT(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"mousedown",value:function(t,e){Vv(ze(n.prototype),"mousedown",this).call(this,t,e),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(t,e){return{around:e,panDelta:e.sub(t)}}},{key:"correctButton",value:function(t,e){return 0===e&&!t.ctrlKey}}]),n}(nT);function oT(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var aT=function(t){Oe(n,t);var e=oT(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"correctButton",value:function(t,e){return 0===e&&t.ctrlKey||2===e}},{key:"move",value:function(t,e){var n=-.5*(e.y-t.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(t){t.preventDefault()}}]),n}(nT);function sT(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var uT=function(t){Oe(n,t);var e=sT(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"contextmenu",value:function(t){t.preventDefault()}},{key:"correctButton",value:function(t,e){return 0===e&&t.ctrlKey||2===e}},{key:"move",value:function(t,e){var n=.8*(e.x-t.x);if(n)return this.active=!0,{bearingDelta:n}}}]),n}(nT),lT=4.000244140625,cT=function(){function t(e,n){var r=this;Ee(this,t),kt(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var t=r.map.transform;if(0!==r.delta){var e="wheel"===r.type&&Math.abs(r.delta)>lT?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*e)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?t.zoomScale(r.targetZoom):t.scale;r.targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=t.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:t.zoom,s=r.startZoom,u=r.easing,l=!1;if("wheel"===r.type&&s&&u){var c=Math.min((nx()-r.lastWheelEventTime)/200,1);o=J_(s,a,u(c)),c<1?r.frameId||(r.frameId=!0):l=!0}else o=a,l=!0;return r.active=!0,l&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:o-t.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=e,this.el=e.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=.0022222222222222222}return Te(t,[{key:"setZoomRate",value:function(t){this.defaultZoomRate=t}},{key:"setWheelZoomRate",value:function(t){this.wheelZoomRate=t}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(t){this.isEnabled()||(this.enabled=!0,this.aroundCenter=t&&"center"===t.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(t){if(this.isEnabled()){var e=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,n=nx(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==e&&e%lT==0?this.type="wheel":0!==e&&Math.abs(e)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=e,this.timeout=setTimeout(this.onTimeout,40,t)):this.type||(this.type=Math.abs(r*e)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,e+=this.lastValue)),t.shiftKey&&e&&(e/=4),this.type&&(this.lastWheelEvent=t,this.delta-=e,this.active||this.start(t)),t.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(t){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(t)}},{key:"start",value:function(t){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var e=xA.mousePos(this.el,t);this.around=sx.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(e)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(t){var e=tx;if(this.prevEase){var n=this.prevEase,r=(nx()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;e=$_(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:nx(),duration:t,easing:e},e}}]),t}(),hT=function(){function t(e,n){Ee(this,t),this.clickZoom=e,this.tapZoom=n}return Te(t,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),t}(),pT=function(){function t(e,n,r){Ee(this,t),this.el=e,this.mousePan=n,this.touchPan=r}return Te(t,[{key:"enable",value:function(t){this.inertiaOptions=t||{},this.mousePan.enable(),this.touchPan.enable(),Jn||this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),Jn||this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),t}(),fT=function(){function t(e,n,r){Ee(this,t),this.pitchWithRotate=e.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return Te(t,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),t}(),dT=function(){function t(e,n,r,i){Ee(this,t),this.el=e,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return Te(t,[{key:"enable",value:function(t){this.touchZoom.enable(t),this.rotationDisabled||this.touchRotate.enable(t),this.tapDragZoom.enable(),Jn||this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),Jn||this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),t}();function vT(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}function mT(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return yT(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yT(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function yT(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var gT=function(){function t(e){Ee(this,t),this.reset(),this.numTouches=e.numTouches}return Te(t,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(t,e,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){var e,n=new lx(0,0),r=mT(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;n._add(i)}}catch(t){r.e(t)}finally{r.f()}return n.div(t.length)}(e),this.touches=vT(n,e)))}},{key:"touchmove",value:function(t,e,n){if(!this.aborted&&this.centroid){var r=vT(n,e);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),t}(),_T=function(){function t(e){Ee(this,t),this.singleTap=new gT(e),this.numTaps=e.numTaps,this.reset()}return Te(t,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(t,e,n){this.singleTap.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.singleTap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),t}(),xT=function(){function t(){Ee(this,t),this.tap=new _T({numTouches:1,numTaps:1}),this.reset()}return Te(t,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(t,e,n){this.swipePoint||(this.tapTime&&t.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=e[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(t,e,n))}},{key:"touchmove",value:function(t,e,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=e[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,t.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(t,e,n)&&(this.tapTime=t.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),bT=function(){function t(){Ee(this,t),this.zoomIn=new _T({numTouches:1,numTaps:2}),this.zoomOut=new _T({numTouches:2,numTaps:1}),this.reset()}return Te(t,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(t,e,n){this.zoomIn.touchstart(t,e,n),this.zoomOut.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.zoomIn.touchmove(t,e,n),this.zoomOut.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this,i=this.zoomIn.touchend(t,e,n),o=this.zoomOut.touchend(t,e,n);return i?(this.active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this.active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),wT=function(){function t(e){Ee(this,t),this.minTouches=1,this.clickTolerance=e.clickTolerance||1,this.reset()}return Te(t,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new lx(0,0)}},{key:"touchstart",value:function(t,e,n){return this.calculateTransform(t,e,n)}},{key:"touchmove",value:function(t,e,n){if(this.active)return t.preventDefault(),this.calculateTransform(t,e,n)}},{key:"touchend",value:function(t,e,n){this.calculateTransform(t,e,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(t,e,n){n.length>0&&(this.active=!0);var r=vT(n,e),i=new lx(0,0),o=new lx(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],l=this.touches[s];l&&(i._add(u),o._add(u.sub(l)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var c=o.div(a);if(this.sum._add(c),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:c}}}}]),t}(),ST=function(){function t(){Ee(this,t),this.reset()}return Te(t,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(t){}},{key:"move",value:function(t,e,n){}},{key:"touchstart",value:function(t,e,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([e[0],e[1]]))}},{key:"touchmove",value:function(t,e,n){if(this.firstTwoTouches){t.preventDefault();var r=$r(this.firstTwoTouches,2),i=r[0],o=r[1],a=ET(n,e,i),s=ET(n,e,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,t)}}}},{key:"touchend",value:function(t,e,n){if(this.firstTwoTouches){var r=$r(this.firstTwoTouches,2),i=r[0],o=r[1],a=ET(n,e,i),s=ET(n,e,o);a&&s||(this.active&&xA.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(t){this.enabled=!0,this.aroundCenter=!!t&&"center"===t.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function ET(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function AT(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}function TT(t){return Math.abs(t.y)>Math.abs(t.x)}var CT=function(t){Oe(n,t);var e=AT(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"reset",value:function(){Vv(ze(n.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(t){this.lastPoints=t,TT(t[0].sub(t[1]))&&(this.valid=!1)}},{key:"move",value:function(t,e,n){var r=t[0].sub(this.lastPoints[0]),i=t[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid){this.lastPoints=t,this.active=!0;return{pitchDelta:-.5*((r.y+i.y)/2)}}}},{key:"gestureBeginsVertically",value:function(t,e,n){if(void 0!==this.valid)return this.valid;var r=t.mag()>=2,i=e.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=t.y>0==e.y>0;return TT(t)&&TT(e)&&o}}}]),n}(ST);function kT(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}function MT(t,e){return 180*t.angleWith(e)/Math.PI}var IT=function(t){Oe(n,t);var e=kT(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"reset",value:function(){Vv(ze(n.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(t){this.startVector=this.vector=t[0].sub(t[1]),this.minDiameter=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.vector;if(this.vector=t[0].sub(t[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:MT(this.vector,n),pinchAround:e}}},{key:"isBelowThreshold",value:function(t){this.minDiameter=Math.min(this.minDiameter,t.mag());var e=25/(Math.PI*this.minDiameter)*360,n=MT(t,this.startVector);return Math.abs(n)<e}}]),n}(ST);function PT(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}function LT(t,e){return Math.log(t/e)/Math.LN2}var RT=function(t){Oe(n,t);var e=PT(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"reset",value:function(){Vv(ze(n.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(t){this.startDistance=this.distance=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.distance;if(this.distance=t[0].dist(t[1]),this.active||!(Math.abs(LT(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:LT(this.distance,n),pinchAround:e}}}]),n}(ST);function OT(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return DT(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return DT(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function DT(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var NT=function(t){return t.zoom||t.drag||t.pitch||t.rotate};function zT(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var FT=function(){function t(e,n){var r=this;Ee(this,t),kt(this,"handleWindowEvent",(function(t){r.handleEvent(t,"".concat(t.type,"Window"))})),kt(this,"handleEvent",(function(t,e){if("blur"!==t.type){r.updatingCamera=!0;var n,i="renderFrame"===t.type?void 0:t,o={needsRenderFrame:!1},a={},s={},u=t.touches?r.getMapTouches(t.touches):void 0,l=u?xA.touchPos(r.el,u):xA.mousePos(r.el,t),c=OT(r.handlers);try{for(c.s();!(n=c.n()).done;){var h=n.value,p=h.handlerName,f=h.handler,d=h.allowed;if(f.isEnabled()){var v=void 0;if(r.blockedByActive(s,d,p))f.reset();else{var m=e||t.type;f&&f[m]&&(v=f[m](t,l,u),r.mergeIHandlerResult(o,a,v,p,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||f.isActive())&&(s[p]=f)}}}catch(t){c.e(t)}finally{c.f()}var y={};for(var g in r.previousActiveHandlers)s[g]||(y[g]=i);r.previousActiveHandlers=s,(Object.keys(y).length||zT(o))&&(r.changes.push([o,a,y]),r.triggerRenderFrame()),(Object.keys(s).length||zT(o))&&r.map.stop(!0),r.updatingCamera=!1;var _=o.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=e,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new qA(e),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;if(this.listeners=[],Jn)tr.document.addEventListener("touchstart",(function(t){r.handleEvent(t)}),{}),tr.document.addEventListener("touchmove",(function(t){r.handleEvent(t)}),{}),tr.document.addEventListener("touchend",(function(t){r.handleEvent(t)}),{}),tr.document.addEventListener("touchcancel",(function(t){r.handleEvent(t)}),{});else{this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,a=OT(this.listeners);try{for(a.s();!(o=a.n()).done;){var s=$r(o.value,3),u=s[0],l=s[1],c=s[2];xA.addEventListener(u,l,u===window.document?this.handleWindowEvent:this.handleEvent,c)}}catch(t){a.e(t)}finally{a.f()}}}return Te(t,[{key:"destroy",value:function(){var t,e=OT(this.listeners);try{for(e.s();!(t=e.n()).done;){var n=$r(t.value,3),r=n[0],i=n[1],o=n[2];xA.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(t){e.e(t)}finally{e.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var t,e=OT(this.handlers);try{for(e.s();!(t=e.n()).done;){t.value.handler.reset()}}catch(t){e.e(t)}finally{e.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var t,e=OT(this.handlers);try{for(e.s();!(t=e.n()).done;){if(t.value.handler.isActive())return!0}}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(NT(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(t,e,n,r,i){if(n){ti.exports.merge(t,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(e.zoom=o),void 0!==n.panDelta&&(e.drag=o),void 0!==n.pitchDelta&&(e.pitch=o),void 0!==n.bearingDelta&&(e.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var t=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(e){delete t.frameId,t.handleEvent(new BA("renderFrame",{timeStamp:e})),t.applyChanges()})))}},{key:"addDefaultHandlers",value:function(t){var e=this.map,n=e.getCanvasContainer();this.add("mapEvent",new tT(e,t));var r=e.boxZoom=new NA(e,t);this.add("boxZoom",r);var i=new bT,o=new zA;e.doubleClickZoom=new hT(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new xT;this.add("tapDragZoom",a);var s=e.touchPitch=new CT;this.add("touchPitch",s);var u=new aT(t),l=new uT(t);e.dragRotate=new fT(t,u,l),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",l,["mouseRotate"]);var c=new iT(t),h=new wT(t);e.dragPan=new pT(n,c,h),this.add("mousePan",c),this.add("touchPan",h,["touchZoom","touchRotate"]);var p=new IT,f=new RT;e.touchZoomRotate=new dT(n,f,p,a),this.add("touchRotate",p,["touchPan","touchZoom"]),this.add("touchZoom",f,["touchPan","touchRotate"]);var d=e.scrollZoom=new cT(e,this);this.add("scrollZoom",d,["mousePan"]);var v=e.keyboard=new QA;this.add("keyboard",v),this.add("blockableMapEvent",new DA(e));for(var m=0,y=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<y.length;m++){var g=y[m];t.interactive&&t[g]&&e[g].enable(t[g])}}},{key:"add",value:function(t,e,n){this.handlers.push({handlerName:t,handler:e,allowed:n}),this.handlersById[t]=e}},{key:"blockedByActive",value:function(t,e,n){for(var r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(t){var e,n=[],r=OT(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,o=i.target;(Jn||this.el.contains(o))&&n.push(i)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var t,e={},n={},r={},i=OT(this.changes);try{for(i.s();!(t=i.n()).done;){var o=$r(t.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(e.panDelta=(e.panDelta||new lx(0,0))._add(a.panDelta)),a.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(e.around=a.around),void 0!==a.pinchAround&&(e.pinchAround=a.pinchAround),a.noInertia&&(e.noInertia=a.noInertia),ti.exports.merge(n,s),ti.exports.merge(r,u)}}catch(t){i.e(t)}finally{i.f()}this.updateMapTransform(e,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(t,e,n){var r=this.map,i=r.transform;if(!zT(t))return this.fireEvents(e,n);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,l=t.pinchAround,c=t.around;void 0!==l&&(c=l),r.stop(!0),c=c||r.transform.centerPoint;var h=i.pointLocation(o?c.sub(o):c);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,c),this.map.update(),t.noInertia||this.inertia.record(t),this.fireEvents(e,n)}},{key:"fireEvents",value:function(t,e){var n=this,r=NT(this.eventsInProgress),i=NT(t),o={};for(var a in t)if(t[a]){var s=t[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=t[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var l in t.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),t)if(t[l]){var c=t[l].originalEvent;this.fireEvent(l,c)}var h,p={};for(var f in this.eventsInProgress)if(this.eventsInProgress[f]){var d=this.eventsInProgress[f],v=d.handlerName,m=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[f],h=e[v]||m,p["".concat(f,"end")]=h)}for(var y in p)p[y]&&this.fireEvent(y,p[y]);var g=NT(this.eventsInProgress);if((r||i)&&!g){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),x=function(t){return 0!==t&&-n.bearingSnap<t&&t<n.bearingSnap};_?(x(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:h})):(this.map.emit("moveend",new vA("moveend",{originalEvent:h})),x(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(t,e){this.map.emit(t,new vA(t,e?{originalEvent:e}:{}))}}]),t}();function BT(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return UT(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return UT(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function UT(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}tr.performance;var jT=function(){function t(){Ee(this,t),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return Te(t,[{key:"add",value:function(t){var e=++this.id;return this.queue.push({callback:t,id:e,cancelled:!1}),e}},{key:"remove",value:function(t){var e,n=this.currentlyRunning,r=BT(n?this.queue.concat(n):this.queue);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.id===t)return void(i.cancelled=!0)}}catch(t){r.e(t)}finally{r.f()}}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.currentlyRunning=this.queue;this.queue=[];var n,r=BT(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(t),this.cleared))break}}catch(t){r.e(t)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),t}();!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var VT=function(){function t(e){var n=this;Ee(this,t),kt(this,"onHashChange",(function(){var t=n.getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(+t)}))){var e=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(t[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1})),kt(this,"getCurrentHash",(function(){var t,e=window.location.hash.replace("#","");return n.hashName?(e.split("&").map((function(t){return t.split("=")})).forEach((function(e){e[0]===n.hashName&&(t=e)})),(t&&t[1]||"").split("/")):e.split("/")})),kt(this,"updateHashUnthrottled",(function(){var t=n.getHashString();try{window.history.replaceState(window.history.state,"",t)}catch(t){}})),this.hashName=e&&encodeURIComponent(e),this.updateHash=ti.exports.throttle(this.updateHashUnthrottled,300)}return Te(t,[{key:"addTo",value:function(t){return this.map=t,tr.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return tr.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(t){var e=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(e.lng*i)/i,a=Math.round(e.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),l="";if(l+=t?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(l+="/".concat(Math.round(10*s)/10)),u&&(l+="/".concat(Math.round(u))),this.hashName){var c=this.hashName,h=!1,p=window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===c?(h=!0,"".concat(e,"=").concat(l)):t})).filter((function(t){return t}));return h||p.push("".concat(c,"=").concat(l)),"#".concat(p.join("&"))}return"#".concat(l)}}]),t}();function GT(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var HT,WT,ZT,qT,XT,YT,KT,QT,JT,$T,tC,eC,nC={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},rC=function(t){Oe(n,t);var e=GT(n);function n(t){var r;if(Ee(this,n),kt(De(r=e.call(this,ti.exports.merge({},nC,t))),"renderTaskQueue",new jT),kt(De(r),"trackResize",!0),kt(De(r),"onWindowOnline",(function(){r.update()})),kt(De(r),"onWindowResize",(function(t){r.trackResize&&r.resize({originalEvent:t}).update()})),Jn?r.initMiniContainer():r.initContainer(),r.resize(),r.handlers=new FT(De(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),!Jn){var i="string"==typeof t.hash&&t.hash||void 0;t.hash&&(r.hash=new VT(i).addTo(De(r)))}return r.hash&&r.hash.onHashChange()||(r.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(r.resize(),r.fitBounds(t.bounds,ti.exports.merge({},t.fitBoundsOptions,{duration:0})))),r}return Te(n,[{key:"resize",value:function(t){var e=$r(this.containerDimensions(),2),n=e[0],r=e[1];if(this.transform.resize(n,r),Jn)return this;var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new tr.Event("movestart",t)),this.emit("move",new tr.Event("move",t))),this.emit("resize",new tr.Event("resize",t)),i&&this.emit("moveend",new tr.Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(sx.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(lx.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(ux.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=ox((function(e){t.frame=null,t.update(e)})))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=ox((function(n){e.frame=null,e.renderTaskQueue.run(t)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=ri("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(Jn?(t=this.container.width/tr.devicePixelRatio,e=this.container.height/tr.devicePixelRatio):(t=0===(t=this.container.clientWidth)?400:t,e=0===(e=this.container.clientHeight)?300:e)),[t,e]}}]),n}(yA),iC={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},oC={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},aC=(HT=ku.injectable(),WT=ku.inject(Hh.MapConfig),ZT=ku.inject(Hh.IGlobalConfigService),qT=ku.inject(Hh.ICoordinateSystemService),XT=ku.inject(Hh.IEventEmitter),HT((KT=function(){function t(){var e=this;Ee(this,t),kt(this,"version",Og.DEFUALT),kt(this,"simpleMapCoord",new Dg),kt(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Rp(this,"config",QT,this),Rp(this,"configService",JT,this),Rp(this,"coordinateSystemService",$T,this),Rp(this,"eventEmitter",tC,this),kt(this,"handleCameraChanged",(function(t){var n=e.map.getCenter(),r=n.lat,i=n.lng;e.emit("mapchange"),e.viewport.syncWithMapCamera({bearing:e.map.getBearing(),center:[i,r],viewportHeight:e.map.transform.height,pitch:e.map.getPitch(),viewportWidth:e.map.transform.width,zoom:e.map.getZoom(),cameraHeight:0}),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)}))}return Te(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=ri("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,e){-1!==Iy.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(oC[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(oC[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===Og.SIMPLE)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.dragEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,e){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,e=null!==(t=this.map.getStyle().sprite)&&void 0!==t?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(e)?null==e?void 0:e.replace(/\/\w+$/,"").replace(/sprites/,"styles"):e}catch(t){return""}}},{key:"getMapStyleConfig",value:function(){return iC}},{key:"getMapStyleValue",value:function(t){var e;return null!==(e=this.getMapStyleConfig()[t])&&void 0!==e?e:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var e=t;return"string"==typeof t&&(e=document.getElementById(t)),e}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,e=void 0===t||t;this.viewport.getZoom()>12&&e?this.coordinateSystemService.setCoordinateSystem(Dp.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Dp.LNGLAT)}}]),t}(),QT=Op(KT.prototype,"config",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JT=Op(KT.prototype,"configService",[ZT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$T=Op(KT.prototype,"coordinateSystemService",[qT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tC=Op(KT.prototype,"eventEmitter",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YT=KT))||YT),sC=["id","style","rotation","mapInstance","version","mapSize","interactive"],uC=["id","style","rotation","mapInstance","canvas","hasBaseMap"];function lC(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var cC=ku.injectable()(eC=function(t){Oe(i,t);var e,n,r=lC(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"version",Og.DEFUALT),kt(De(t),"handleMiniCameraChanged",(function(e,n,r,i,o){var a=t.config.offsetCoordinate,s=void 0===a||a;t.viewport.syncWithMapCamera({bearing:i,center:[e,n],viewportHeight:t.map.transform.height,pitch:o,viewportWidth:t.map.transform.width,zoom:r,cameraHeight:0}),t.viewport.getZoom()>12&&s?t.coordinateSystemService.setCoordinateSystem(Dp.LNGLAT_OFFSET):t.coordinateSystemService.setCoordinateSystem(Dp.LNGLAT),t.cameraChangedCallback(t.viewport)})),t}return Te(i,[{key:"lngLatToCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(t,0),r=n.x,i=n.y;return[r-e.x,i-e.y]}},{key:"lngLatToMercator",value:function(t,e){var n=yx.fromLngLat(t,e),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=yx.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=ia();return ca(s,s,Ia(o.x-i.x,o.y-i.y,o.z||0-i.z)),ha(s,s,Ia(a*r[0],-a*r[1],a*r[2])),pa(s,s,n[0]),fa(s,s,n[1]),da(s,s,n[2]),s}},{key:"init",value:(n=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,i=e.style,o=void 0===i?"light":i,a=e.rotation,s=void 0===a?0:a,u=e.mapInstance,l=e.version,c=void 0===l?"DEFAULTMAP":l,h=e.mapSize,p=void 0===h?1e4:h,f=e.interactive,d=void 0===f||f,v=Wf(e,sC),this.viewport=new h_,this.version=c,this.simpleMapCoord.setSize(p),c===Og.SIMPLE&&v.center&&(v.center=this.simpleMapCoord.unproject(v.center)),u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new rC(It({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},v))),this.map.on("load",(function(){m.handleCameraChanged()})),d&&this.map.on("move",this.handleCameraChanged),setTimeout((function(){m.handleCameraChanged()}),100),this.handleCameraChanged();case 10:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"initMiniMap",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,p=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(e=this.config).id,n=e.style,r=void 0===n?"light":n,i=e.rotation,o=void 0===i?0:i,e.mapInstance,a=e.canvas,s=void 0===a?null:a,u=e.hasBaseMap,l=void 0!==u&&u,c=Wf(e,uC),this.viewport=new h_,this.$mapContainer=s,this.map=new rC(It({container:this.$mapContainer,style:this.getMapStyleValue(r),bearing:o,canvas:s},c)),l?(h=this.map.getCenter(),this.handleMiniCameraChanged(h.lng,h.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),tr.document.addEventListener("mapCameaParams",(function(t){var e=t.e,n=e.longitude,r=e.latitude,i=e.scale,o=e.bearing,a=e.pitch;p.handleMiniCameraChanged(n,r,i-1.25,o,a)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}}]),i}(aC))||eC;function hC(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var pC=function(t){Oe(n,t);var e=hC(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"getServiceConstructor",value:function(){return cC}}]),n}(Pg),fC={exports:{}};!function(t,e){t.exports=function(){var t,e,n;function r(r,i){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),n=i(a),"undefined"!=typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=i;else t=i}return r(["exports"],(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=r;function r(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}r.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},r.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},r.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},r.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},r.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=o;function o(t,e){this.x=t,this.y=e}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var a="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1;function u(t,e,r,i){var o=new n(t,e,r,i);return function(t){return o.solve(t)}}var l=u(.25,.1,.25,1);function c(t,e,n){return Math.min(n,Math.max(e,t))}function h(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function p(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}var f=1;function d(){return f++}function v(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function m(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function y(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function g(t,e){return-1!==t.indexOf(e,t.length-e.length)}function _(t,e,n){var r={};for(var i in t)r[i]=e.call(n||this,t[i],i,t);return r}function x(t,e,n){var r={};for(var i in t)e.call(n||this,t[i],i,t)&&(r[i]=t[i]);return r}function b(t){return Array.isArray(t)?t.map(b):"object"==typeof t&&t?_(t,b):t}var w={};function S(t){w[t]||("undefined"!=typeof console&&console.warn(t),w[t]=!0)}function E(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function A(t){for(var e=0,n=0,r=t.length,i=r-1,o=void 0,a=void 0;n<r;i=n++)e+=((a=t[i]).x-(o=t[n]).x)*(o.y+a.y);return e}function T(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function C(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,n,r,i){var o=r||i;return e[n]=!o||o.toLowerCase(),""})),e["max-age"]){var n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}var k=null;function M(t){if(null==k){var e=t.navigator?t.navigator.userAgent:null;k=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return k}function I(t){try{var e=a[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var P,L,R,O,D=a.performance&&a.performance.now?a.performance.now.bind(a.performance):Date.now.bind(Date),N=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,z=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame,F={now:D,frame:function(t){var e=N(t);return{cancel:function(){return z(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var n=a.document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return P||(P=a.document.createElement("a")),P.href=t,P.href},hardwareConcurrency:a.navigator&&a.navigator.hardwareConcurrency||4,get devicePixelRatio(){return a.devicePixelRatio},get prefersReducedMotion(){return!!a.matchMedia&&(null==L&&(L=a.matchMedia("(prefers-reduced-motion: reduce)")),L.matches)}},B={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},U={supported:!1,testSupport:function(t){!j&&O&&(V?G(t):R=t)}},j=!1,V=!1;function G(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,O),t.isContextLost())return;U.supported=!0}catch(t){}t.deleteTexture(e),j=!0}a.document&&((O=a.document.createElement("img")).onload=function(){R&&G(R),R=null,V=!0},O.onerror=function(){j=!0,R=null},O.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var H="01",W=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function Z(t){return 0===t.indexOf("mapbox:")}W.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",H,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},W.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},W.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},W.prototype.normalizeStyleURL=function(t,e){if(!Z(t))return t;var n=K(t);return n.path="/styles/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeGlyphsURL=function(t,e){if(!Z(t))return t;var n=K(t);return n.path="/fonts/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeSourceURL=function(t,e){if(!Z(t))return t;var n=K(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeSpriteURL=function(t,e,n,r){var i=K(t);return Z(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+n,this._makeAPIURL(i,this._customAccessToken||r)):(i.path+=""+e+n,Q(i))},W.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Z(t))return t;var n=K(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,(F.devicePixelRatio>=2||512===e?"@2x":"")+(U.supported?".webp":"$1")),n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/v4"+n.path;var r=this._customAccessToken||function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e].match(/^access_token=(.*)$/);if(r)return r[1]}return null}(n.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push("sku="+this._skuToken),this._makeAPIURL(n,r)},W.prototype.canonicalizeTileURL=function(t,e){var n=K(t);if(!n.path.match(/(^\/v4\/)/)||!n.path.match(/\.[\w]+$/))return t;var r="mapbox://tiles/";r+=n.path.replace("/v4/","");var i=n.params;return e&&(i=i.filter((function(t){return!t.match(/^access_token=/)}))),i.length&&(r+="?"+i.join("&")),r},W.prototype.canonicalizeTileset=function(t,e){for(var n=!!e&&Z(e),r=[],i=0,o=t.tiles||[];i<o.length;i+=1){var a=o[i];X(a)?r.push(this.canonicalizeTileURL(a,n)):r.push(a)}return r},W.prototype._makeAPIURL=function(t,e){var n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=K(B.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){var i=t.params.indexOf("secure");i>=0&&t.params.splice(i,1)}if("/"!==r.path&&(t.path=""+r.path+t.path),!B.REQUIRE_ACCESS_TOKEN)return Q(t);if(!(e=e||B.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),Q(t)};var q=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function X(t){return q.test(t)}var Y=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function K(t){var e=t.match(Y);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Q(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function J(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(a.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var $=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};$.prototype.getStorageKey=function(t){var e,n=J(B.ACCESS_TOKEN);return e=n&&n.u?a.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):B.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},$.prototype.fetchEventData=function(){var t=I("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{var r=a.localStorage.getItem(e);r&&(this.eventData=JSON.parse(r));var i=a.localStorage.getItem(n);i&&(this.anonId=i)}catch(t){S("Unable to read from LocalStorage")}},$.prototype.saveEventData=function(){var t=I("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{a.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&a.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){S("Unable to write to LocalStorage")}},$.prototype.processRequests=function(t){},$.prototype.postEvent=function(t,e,n,r){var i=this;if(B.EVENTS_URL){var o=K(B.EVENTS_URL);o.params.push("access_token="+(r||B.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:H,userId:this.anonId},s=e?p(a,e):a,u={url:Q(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=bt(u,(function(t){i.pendingRequest=null,n(t),i.saveEventData(),i.processRequests(r)}))}},$.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var tt,et,nt=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,n,r){this.skuToken=n;var i=!(!r&&!B.ACCESS_TOKEN),o=Array.isArray(t)&&t.some((function(t){return Z(t)||X(t)}));B.EVENTS_URL&&i&&o&&this.queueRequest({id:e,timestamp:Date.now()},r)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),r=n.id,i=n.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),m(this.anonId)||(this.anonId=v()),this.postEvent(i,{skuToken:this.skuToken},(function(t){t||r&&(e.success[r]=!0)}),t))}},e}($),rt=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return Z(t)||X(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=J(B.ACCESS_TOKEN),r=n?n.u:B.ACCESS_TOKEN,i=r!==this.eventData.tokenU;m(this.anonId)||(this.anonId=v(),i=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),u=(o-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||a.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=r)}),t)}},e}($)),it=rt.postTurnstileEvent.bind(rt),ot=new nt,at=ot.postMapLoadEvent.bind(ot),st=500,ut=50;function lt(){a.caches&&!tt&&(tt=a.caches.open("mapbox-tiles"))}function ct(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ht,pt=1/0;function ft(){return null==ht&&(ht=a.OffscreenCanvas&&new a.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.createImageBitmap),ht}var dt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(dt);var vt,mt,yt=function(t){function e(e,n,r){401===n&&X(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=n,this.url=r,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),gt=T()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===a.location.protocol?a.parent:a).location.href},_t=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(gt())&&!/^\w+:/.test(n))){if(a.fetch&&a.Request&&a.AbortController&&a.Request.prototype.hasOwnProperty("signal"))return function(t,e){var n,r=new a.AbortController,i=new a.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:gt(),signal:r.signal}),o=!1,s=!1,u=(n=i.url).indexOf("sku=")>0&&X(n);"json"===t.type&&i.headers.set("Accept","application/json");var l=function(n,r,o){if(!s){if(n&&"SecurityError"!==n.message&&S(n),r&&o)return c(r);var l=Date.now();a.fetch(i).then((function(n){if(n.ok){var r=u?n.clone():null;return c(n,r,l)}return e(new yt(n.statusText,n.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},c=function(n,r,u){("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then((function(t){s||(r&&u&&function(t,e,n){if(lt(),tt){var r={status:e.status,statusText:e.statusText,headers:new a.Headers};e.headers.forEach((function(t,e){return r.headers.set(e,t)}));var i=C(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-n<42e4||function(t,e){if(void 0===et)try{new Response(new ReadableStream),et=!0}catch(t){et=!1}et?e(t.body):t.blob().then(e)}(e,(function(e){var n=new a.Response(e,r);lt(),tt&&tt.then((function(e){return e.put(ct(t.url),n)})).catch((function(t){return S(t.message)}))})))}}(i,r,u),o=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((function(t){s||e(new Error(t.message))}))};return u?function(t,e){if(lt(),!tt)return e(null);var n=ct(t.url);tt.then((function(t){t.match(n).then((function(r){var i=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),n=C(t.headers.get("Cache-Control")||"");return e>Date.now()&&!n["no-cache"]}(r);t.delete(n),i&&t.put(n,r.clone()),e(null,r,i)})).catch(e)})).catch(e)}(i,l):l(null,null),{cancel:function(){s=!0,o||r.abort()}}}(t,e);if(T()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){var n=new a.XMLHttpRequest;for(var r in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(r,t.headers[r]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var r=n.response;if("json"===t.type)try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new yt(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}}(t,e)},xt=function(t,e){return _t(p(t,{type:"arrayBuffer"}),e)},bt=function(t,e){return _t(p(t,{method:"POST"}),e)},wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";vt=[],mt=0;var St=function(t,e){if(U.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),mt>=B.MAX_PARALLEL_IMAGE_REQUESTS){var n={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return vt.push(n),n}mt++;var r=!1,i=function(){if(!r)for(r=!0,mt--;vt.length&&mt<B.MAX_PARALLEL_IMAGE_REQUESTS;){var t=vt.shift();t.cancelled||(t.cancel=St(t.requestParameters,t.callback).cancel)}},o=xt(t,(function(t,n,r,o){i(),t?e(t):n&&(ft()?function(t,e){var n=new a.Blob([new Uint8Array(t)],{type:"image/png"});a.createImageBitmap(n).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(n,e):function(t,e,n,r){var i=new a.Image,o=a.URL;i.onload=function(){e(null,i),o.revokeObjectURL(i.src),i.onload=null,a.requestAnimationFrame((function(){i.src=wt}))},i.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new a.Blob([new Uint8Array(t)],{type:"image/png"});i.cacheControl=n,i.expires=r,i.src=t.byteLength?o.createObjectURL(s):wt}(n,e,r,o))}));return{cancel:function(){o.cancel(),i()}}};function Et(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function At(t,e,n){if(n&&n[t]){var r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}var Tt=function(t,e){void 0===e&&(e={}),p(this,e),this.type=t},Ct=function(t){function e(e,n){void 0===n&&(n={}),t.call(this,"error",p({error:e},n))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Tt),kt=function(){};kt.prototype.on=function(t,e){return this._listeners=this._listeners||{},Et(t,e,this._listeners),this},kt.prototype.off=function(t,e){return At(t,e,this._listeners),At(t,e,this._oneTimeListeners),this},kt.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},Et(t,e,this._oneTimeListeners),this},kt.prototype.fire=function(t,e){"string"==typeof t&&(t=new Tt(t,e||{}));var n=t.type;if(this.listens(n)){t.target=this;for(var r=0,i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];r<i.length;r+=1)i[r].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];o<a.length;o+=1){var s=a[o];At(n,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(p(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof Ct&&console.error(t.error);return this},kt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},kt.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Mt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},It=function(t,e,n,r){this.message=(t?t+": ":"")+n,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)};function Pt(t){var e=t.value;return e?[new It(t.key,e,"constants have been deprecated as of v8")]:[]}function Lt(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}function Rt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ot(t){if(Array.isArray(t))return t.map(Ot);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var n in t)e[n]=Ot(t[n]);return e}return Rt(t)}var Dt=function(t){function e(e,n){t.call(this,n),this.message=n,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Nt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var n=0,r=e;n<r.length;n+=1){var i=r[n];this.bindings[i[0]]=i[1]}};Nt.prototype.concat=function(t){return new Nt(this,t)},Nt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Nt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var zt={kind:"null"},Ft={kind:"number"},Bt={kind:"string"},Ut={kind:"boolean"},jt={kind:"color"},Vt={kind:"object"},Gt={kind:"value"},Ht={kind:"collator"},Wt={kind:"formatted"},Zt={kind:"resolvedImage"};function qt(t,e){return{kind:"array",itemType:t,N:e}}function Xt(t){if("array"===t.kind){var e=Xt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Yt=[zt,Ft,Bt,Ut,jt,Wt,Vt,qt(Gt),Zt];function Kt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Kt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var n=0,r=Yt;n<r.length;n+=1)if(!Kt(r[n],e))return null}return"Expected "+Xt(t)+" but found "+Xt(e)+" instead."}function Qt(t,e){return e.some((function(e){return e.kind===t.kind}))}function Jt(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t}))}var $t=e((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return r("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function a(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in n)return n[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=s.indexOf("("),l=s.indexOf(")");if(-1!==u&&l+1===s.length){var c=s.substr(0,u),h=s.substr(u+1,l-(u+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=o(h[1]),v=o(h[2]),m=v<=.5?v*(d+1):v+d-v*d,y=2*v-m;return[r(255*a(y,m,f+1/3)),r(255*a(y,m,f)),r(255*a(y,m,f-1/3)),p];default:return null}}return null}}catch(t){}})).parseCSSColor,te=function(t,e,n,r){void 0===r&&(r=1),this.r=t,this.g=e,this.b=n,this.a=r};te.parse=function(t){if(t){if(t instanceof te)return t;if("string"==typeof t){var e=$t(t);if(e)return new te(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},te.prototype.toString=function(){var t=this.toArray(),e=t[1],n=t[2],r=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(n)+","+r+")"},te.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},te.black=new te(0,0,0,1),te.white=new te(1,1,1,1),te.transparent=new te(0,0,0,0),te.red=new te(1,0,0,1);var ee=function(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ee.prototype.compare=function(t,e){return this.collator.compare(t,e)},ee.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ne=function(t,e,n,r,i){this.text=t,this.image=e,this.scale=n,this.fontStack=r,this.textColor=i},re=function(t){this.sections=t};re.fromString=function(t){return new re([new ne(t,null,null,null,null)])},re.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},re.factory=function(t){return t instanceof re?t:re.fromString(t)},re.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},re.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];if(r.image)t.push(["image",r.image.name]);else{t.push(r.text);var i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),r.textColor&&(i["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(i)}}return t};var ie=function(t){this.name=t.name,this.available=t.available};function oe(t,e,n,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value ["+[t,e,n,r].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof r?[t,e,n,r]:[t,e,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ae(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof te)return!0;if(t instanceof ee)return!0;if(t instanceof re)return!0;if(t instanceof ie)return!0;if(Array.isArray(t)){for(var e=0,n=t;e<n.length;e+=1)if(!ae(n[e]))return!1;return!0}if("object"==typeof t){for(var r in t)if(!ae(t[r]))return!1;return!0}return!1}function se(t){if(null===t)return zt;if("string"==typeof t)return Bt;if("boolean"==typeof t)return Ut;if("number"==typeof t)return Ft;if(t instanceof te)return jt;if(t instanceof ee)return Ht;if(t instanceof re)return Wt;if(t instanceof ie)return Zt;if(Array.isArray(t)){for(var e,n=t.length,r=0,i=t;r<i.length;r+=1){var o=se(i[r]);if(e){if(e===o)continue;e=Gt;break}e=o}return qt(e||Gt,n)}return Vt}function ue(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof te||t instanceof re||t instanceof ie?t.toString():JSON.stringify(t)}ie.prototype.toString=function(){return this.name},ie.fromString=function(t){return t?new ie({name:t,available:!1}):null},ie.prototype.serialize=function(){return["image",this.name]};var le=function(t,e){this.type=t,this.value=e};le.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ae(t[1]))return e.error("invalid value");var n=t[1],r=se(n),i=e.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new le(r,n)},le.prototype.evaluate=function(){return this.value},le.prototype.eachChild=function(){},le.prototype.outputDefined=function(){return!0},le.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof te?["rgba"].concat(this.value.toArray()):this.value instanceof re?this.value.serialize():this.value};var ce=function(t){this.name="ExpressionEvaluationError",this.message=t};ce.prototype.toJSON=function(){return this.message};var he={string:Bt,number:Ft,boolean:Ut,object:Vt},pe=function(t,e){this.type=t,this.args=e};pe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n,r=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in he)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=he[s],r++}else o=Gt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],r++}n=qt(o,a)}else n=he[i];for(var u=[];r<t.length;r++){var l=e.parse(t[r],r,Gt);if(!l)return null;u.push(l)}return new pe(n,u)},pe.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var n=this.args[e].evaluate(t);if(!Kt(this.type,se(n)))return n;if(e===this.args.length-1)throw new ce("Expected value to be of type "+Xt(this.type)+", but found "+Xt(se(n))+" instead.")}return null},pe.prototype.eachChild=function(t){this.args.forEach(t)},pe.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},pe.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);var r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var fe=function(t){this.type=Wt,this.sections=t};fe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");for(var r=[],i=!1,o=1;o<=t.length-1;++o){var a=t[o];if(i&&"object"==typeof a&&!Array.isArray(a)){i=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,Ft)))return null;var u=null;if(a["text-font"]&&!(u=e.parse(a["text-font"],1,qt(Bt))))return null;var l=null;if(a["text-color"]&&!(l=e.parse(a["text-color"],1,jt)))return null;var c=r[r.length-1];c.scale=s,c.font=u,c.textColor=l}else{var h=e.parse(t[o],1,Gt);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:h,scale:null,font:null,textColor:null})}}return new fe(r)},fe.prototype.evaluate=function(t){return new re(this.sections.map((function(e){var n=e.content.evaluate(t);return se(n)===Zt?new ne("",n,null,null,null):new ne(ue(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},fe.prototype.eachChild=function(t){for(var e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}},fe.prototype.outputDefined=function(){return!1},fe.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t.push(r.content.serialize());var i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),r.textColor&&(i["text-color"]=r.textColor.serialize()),t.push(i)}return t};var de=function(t){this.type=Zt,this.input=t};de.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Bt);return n?new de(n):e.error("No image name provided.")},de.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=ie.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n},de.prototype.eachChild=function(t){t(this.input)},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){return["image",this.input.serialize()]};var ve={"to-boolean":Ut,"to-color":jt,"to-number":Ft,"to-string":Bt},me=function(t,e){this.type=t,this.args=e};me.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");for(var r=ve[n],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Gt);if(!a)return null;i.push(a)}return new me(r,i)},me.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,n,r=0,i=this.args;r<i.length;r+=1){if(n=null,(e=i[r].evaluate(t))instanceof te)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(n=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":oe(e[0],e[1],e[2],e[3])))return new te(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ce(n||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var l=Number(a);if(!isNaN(l))return l}throw new ce("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?re.fromString(ue(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ie.fromString(ue(this.args[0].evaluate(t))):ue(this.args[0].evaluate(t))},me.prototype.eachChild=function(t){this.args.forEach(t)},me.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},me.prototype.serialize=function(){if("formatted"===this.type.kind)return new fe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new de(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var ye=["Unknown","Point","LineString","Polygon"],ge=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ge.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ge.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ye[this.feature.type]:this.feature.type:null},ge.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ge.prototype.canonicalID=function(){return this.canonical},ge.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ge.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=te.parse(t)),e};var _e=function(t,e,n,r){this.name=t,this.type=e,this._evaluate=n,this.args=r};_e.prototype.evaluate=function(t){return this._evaluate(t,this.args)},_e.prototype.eachChild=function(t){this.args.forEach(t)},_e.prototype.outputDefined=function(){return!1},_e.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},_e.parse=function(t,e){var n,r=t[0],i=_e.definitions[r];if(!i)return e.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter((function(e){var n=e[0];return!Array.isArray(n)||n.length===t.length-1})),u=null,l=0,c=s;l<c.length;l+=1){var h=c[l],p=h[0],f=h[1];u=new je(e.registry,e.path,null,e.scope);for(var d=[],v=!1,m=1;m<t.length;m++){var y=t[m],g=Array.isArray(p)?p[m-1]:p.type,_=u.parse(y,1+d.length,g);if(!_){v=!0;break}d.push(_)}if(!v)if(Array.isArray(p)&&p.length!==d.length)u.error("Expected "+p.length+" arguments, but found "+d.length+" instead.");else{for(var x=0;x<d.length;x++){var b=Array.isArray(p)?p[x]:p.type,w=d[x];u.concat(x+1).checkSubtype(b,w.type)}if(0===u.errors.length)return new _e(r,o,f,d)}}if(1===s.length)(n=e.errors).push.apply(n,u.errors);else{for(var S=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Xt).join(", ")+")":"("+Xt(e.type)+"...)"})).join(" | "),E=[],A=1;A<t.length;A++){var T=e.parse(t[A],1+E.length);if(!T)return null;E.push(Xt(T.type))}e.error("Expected arguments of type "+S+", but found ("+E.join(", ")+") instead.")}return null},_e.register=function(t,e){for(var n in _e.definitions=e,e)t[n]=_e};var xe=function(t,e,n){this.type=Ht,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e};function be(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function we(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Se(t,e){var n=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(n*i*8192),Math.round(r*i*8192)]}function Ee(t,e,n){return e[1]>t[1]!=n[1]>t[1]&&t[0]<(n[0]-e[0])*(t[1]-e[1])/(n[1]-e[1])+e[0]}function Ae(t,e){for(var n,r,i,o,a,s,u,l=!1,c=0,h=e.length;c<h;c++)for(var p=e[c],f=0,d=p.length;f<d-1;f++){if((o=(n=t)[0]-(r=p[f])[0])*(u=n[1]-(i=p[f+1])[1])-(s=n[0]-i[0])*(a=n[1]-r[1])==0&&o*s<=0&&a*u<=0)return!1;Ee(t,p[f],p[f+1])&&(l=!l)}return l}function Te(t,e){for(var n=0;n<e.length;n++)if(Ae(t,e[n]))return!0;return!1}function Ce(t,e,n,r){var i=r[0]-n[0],o=r[1]-n[1],a=(t[0]-n[0])*o-i*(t[1]-n[1]),s=(e[0]-n[0])*o-i*(e[1]-n[1]);return a>0&&s<0||a<0&&s>0}function ke(t,e,n){for(var r=0,i=n;r<i.length;r+=1)for(var o=i[r],a=0;a<o.length-1;++a)if(0!=(h=[(c=o[a+1])[0]-(l=o[a])[0],c[1]-l[1]])[0]*(p=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-h[1]*p[0]&&Ce(s,u,l,c)&&Ce(l,c,s,u))return!0;var s,u,l,c,h,p;return!1}function Me(t,e){for(var n=0;n<t.length;++n)if(!Ae(t[n],e))return!1;for(var r=0;r<t.length-1;++r)if(ke(t[r],t[r+1],e))return!1;return!0}function Ie(t,e){for(var n=0;n<e.length;n++)if(Me(t,e[n]))return!0;return!1}function Pe(t,e,n){for(var r=[],i=0;i<t.length;i++){for(var o=[],a=0;a<t[i].length;a++){var s=Se(t[i][a],n);be(e,s),o.push(s)}r.push(o)}return r}function Le(t,e,n){for(var r=[],i=0;i<t.length;i++){var o=Pe(t[i],e,n);r.push(o)}return r}function Re(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){var i=.5*r,o=t[0]-n[0]>i?-r:n[0]-t[0]>i?r:0;0===o&&(o=t[0]-n[2]>i?-r:n[2]-t[0]>i?r:0),t[0]+=o}be(e,t)}function Oe(t,e,n,r){for(var i=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[],s=0,u=t;s<u.length;s+=1)for(var l=0,c=u[s];l<c.length;l+=1){var h=c[l],p=[h.x+o[0],h.y+o[1]];Re(p,e,n,i),a.push(p)}return a}function De(t,e,n,r){for(var i,o=8192*Math.pow(2,r.z),a=[8192*r.x,8192*r.y],s=[],u=0,l=t;u<l.length;u+=1){for(var c=[],h=0,p=l[u];h<p.length;h+=1){var f=p[h],d=[f.x+a[0],f.y+a[1]];be(e,d),c.push(d)}s.push(c)}if(e[2]-e[0]<=o/2){(i=e)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var v=0,m=s;v<m.length;v+=1)for(var y=0,g=m[v];y<g.length;y+=1)Re(g[y],e,n,o)}return s}xe.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");var r=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Ut);if(!r)return null;var i=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Ut);if(!i)return null;var o=null;return n.locale&&!(o=e.parse(n.locale,1,Bt))?null:new xe(r,i,o)},xe.prototype.evaluate=function(t){return new ee(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},xe.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},xe.prototype.outputDefined=function(){return!1},xe.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Ne=function(t,e){this.type=Ut,this.geojson=t,this.geometries=e};function ze(t){if(t instanceof _e){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Ne)return!1;var e=!0;return t.eachChild((function(t){e&&!ze(t)&&(e=!1)})),e}function Fe(t){if(t instanceof _e&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!Fe(t)&&(e=!1)})),e}function Be(t,e){if(t instanceof _e&&e.indexOf(t.name)>=0)return!1;var n=!0;return t.eachChild((function(t){n&&!Be(t,e)&&(n=!1)})),n}Ne.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ae(t[1])){var n=t[1];if("FeatureCollection"===n.type)for(var r=0;r<n.features.length;++r){var i=n.features[r].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ne(n,n.features[r].geometry)}else if("Feature"===n.type){var o=n.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new Ne(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new Ne(n,n)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ne.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Pe(e.coordinates,r,i),a=Oe(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Ae(u[s],o))return!1}if("MultiPolygon"===e.type){var l=Le(e.coordinates,r,i),c=Oe(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Te(p[h],l))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Pe(e.coordinates,r,i),a=De(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Me(u[s],o))return!1}if("MultiPolygon"===e.type){var l=Le(e.coordinates,r,i),c=De(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Ie(p[h],l))return!1}return!0}(t,this.geometries)}return!1},Ne.prototype.eachChild=function(){},Ne.prototype.outputDefined=function(){return!0},Ne.prototype.serialize=function(){return["within",this.geojson]};var Ue=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};Ue.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var n=t[1];return e.scope.has(n)?new Ue(n,e.scope.get(n)):e.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},Ue.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ue.prototype.eachChild=function(){},Ue.prototype.outputDefined=function(){return!1},Ue.prototype.serialize=function(){return["var",this.name]};var je=function(t,e,n,r,i){void 0===e&&(e=[]),void 0===r&&(r=new Nt),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=r,this.errors=i,this.expectedType=n};function Ve(t,e){for(var n,r=t.length-1,i=0,o=r,a=0;i<=o;)if((n=t[a=Math.floor((i+o)/2)])<=e){if(a===r||e<t[a+1])return a;i=a+1}else{if(!(n>e))throw new ce("Input is not a number.");o=a-1}return 0}je.prototype.parse=function(t,e,n,r,i){return void 0===i&&(i={}),e?this.concat(e,n,r)._parse(t,i):this._parse(t,i)},je.prototype._parse=function(t,e){function n(t,e,n){return"assert"===n?new pe(e,[t]):"coerce"===n?new me(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=t[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+typeof r+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[r];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=n(o,a,e.typeAnnotation||"coerce");else o=n(o,a,e.typeAnnotation||"assert")}if(!(o instanceof le)&&"resolvedImage"!==o.type.kind&&function t(e){if(e instanceof Ue)return t(e.boundExpression);if(e instanceof _e&&"error"===e.name)return!1;if(e instanceof xe)return!1;if(e instanceof Ne)return!1;var n=e instanceof me||e instanceof pe,r=!0;return e.eachChild((function(e){r=n?r&&t(e):r&&e instanceof le})),!!r&&ze(e)&&Be(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var u=new ge;try{o=new le(o.type,o.evaluate(u))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},je.prototype.concat=function(t,e,n){var r="number"==typeof t?this.path.concat(t):this.path,i=n?this.scope.concat(n):this.scope;return new je(this.registry,r,e||null,i,this.errors)},je.prototype.error=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Dt(r,t))},je.prototype.checkSubtype=function(t,e){var n=Kt(t,e);return n&&this.error(n),n};var Ge=function(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var r=0,i=n;r<i.length;r+=1){var o=i[r],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function He(t,e,n){return t*(1-n)+e*n}Ge.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var n=e.parse(t[1],1,Ft);if(!n)return null;var r=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],u=o,l=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var c=e.parse(s,l,i);if(!c)return null;i=i||c.type,r.push([a,c])}return new Ge(i,n,r)},Ge.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;return r>=e[i-1]?n[i-1].evaluate(t):n[Ve(e,r)].evaluate(t)},Ge.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},Ge.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Ge.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var We=Object.freeze({__proto__:null,number:He,color:function(t,e,n){return new te(He(t.r,e.r,n),He(t.g,e.g,n),He(t.b,e.b,n),He(t.a,e.a,n))},array:function(t,e,n){return t.map((function(t,r){return He(t,e[r],n)}))}}),Ze=6/29*3*(6/29),qe=Math.PI/180,Xe=180/Math.PI;function Ye(t){return t>.008856451679035631?Math.pow(t,1/3):t/Ze+4/29}function Ke(t){return t>6/29?t*t*t:Ze*(t-4/29)}function Qe(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Je(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $e(t){var e=Je(t.r),n=Je(t.g),r=Je(t.b),i=Ye((.4124564*e+.3575761*n+.1804375*r)/.95047),o=Ye((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-Ye((.0193339*e+.119192*n+.9503041*r)/1.08883)),alpha:t.a}}function tn(t){var e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Ke(e),n=.95047*Ke(n),r=1.08883*Ke(r),new te(Qe(3.2404542*n-1.5371385*e-.4985314*r),Qe(-.969266*n+1.8760108*e+.041556*r),Qe(.0556434*n-.2040259*e+1.0572252*r),t.alpha)}function en(t,e,n){var r=e-t;return t+n*(r>180||r<-180?r-360*Math.round(r/360):r)}var nn={forward:$e,reverse:tn,interpolate:function(t,e,n){return{l:He(t.l,e.l,n),a:He(t.a,e.a,n),b:He(t.b,e.b,n),alpha:He(t.alpha,e.alpha,n)}}},rn={forward:function(t){var e=$e(t),n=e.l,r=e.a,i=e.b,o=Math.atan2(i,r)*Xe;return{h:o<0?o+360:o,c:Math.sqrt(r*r+i*i),l:n,alpha:t.a}},reverse:function(t){var e=t.h*qe,n=t.c;return tn({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:en(t.h,e.h,n),c:He(t.c,e.c,n),l:He(t.l,e.l,n),alpha:He(t.alpha,e.alpha,n)}}},on=Object.freeze({__proto__:null,lab:nn,hcl:rn}),an=function(t,e,n,r,i){this.type=t,this.operator=e,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[1];this.labels.push(s[0]),this.outputs.push(u)}};function sn(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}an.interpolationFactor=function(t,e,r,i){var o=0;if("exponential"===t.name)o=sn(e,t.base,r,i);else if("linear"===t.name)o=sn(e,1,r,i);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new n(a[0],a[1],a[2],a[3]).solve(sn(e,1,r,i))}return o},an.parse=function(t,e){var n=t[0],r=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var a=r[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:a}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);var s=r.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,Ft)))return null;var u=[],l=null;"interpolate-hcl"===n||"interpolate-lab"===n?l=jt:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<o.length;c+=2){var h=o[c],p=o[c+1],f=c+3,d=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var v=e.parse(p,d,l);if(!v)return null;l=l||v.type,u.push([h,v])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new an(l,n,r,i,u):e.error("Type "+Xt(l)+" is not interpolatable.")},an.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;if(r>=e[i-1])return n[i-1].evaluate(t);var o=Ve(e,r),a=an.interpolationFactor(this.interpolation,r,e[o],e[o+1]),s=n[o].evaluate(t),u=n[o+1].evaluate(t);return"interpolate"===this.operator?We[this.type.kind.toLowerCase()](s,u,a):"interpolate-hcl"===this.operator?rn.reverse(rn.interpolate(rn.forward(s),rn.forward(u),a)):nn.reverse(nn.interpolate(nn.forward(s),nn.forward(u),a))},an.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},an.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},an.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e};var un=function(t,e){this.type=t,this.args=e};un.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var n=null,r=e.expectedType;r&&"value"!==r.kind&&(n=r);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+i.length,n,void 0,{typeAnnotation:"omit"});if(!s)return null;n=n||s.type,i.push(s)}var u=r&&i.some((function(t){return Kt(r,t.type)}));return new un(u?Gt:n,i)},un.prototype.evaluate=function(t){for(var e,n=null,r=0,i=0,o=this.args;i<o.length&&(r++,(n=o[i].evaluate(t))&&n instanceof ie&&!n.available&&(e||(e=n.name),n=null,r===this.args.length&&(n=e)),null===n);i+=1);return n},un.prototype.eachChild=function(t){this.args.forEach(t)},un.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},un.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var ln=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};ln.prototype.evaluate=function(t){return this.result.evaluate(t)},ln.prototype.eachChild=function(t){for(var e=0,n=this.bindings;e<n.length;e+=1)t(n[e][1]);t(this.result)},ln.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var n=[],r=1;r<t.length-1;r+=2){var i=t[r];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);var o=e.parse(t[r+1],r+1);if(!o)return null;n.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return a?new ln(n,a):null},ln.prototype.outputDefined=function(){return this.result.outputDefined()},ln.prototype.serialize=function(){for(var t=["let"],e=0,n=this.bindings;e<n.length;e+=1){var r=n[e];t.push(r[0],r[1].serialize())}return t.push(this.result.serialize()),t};var cn=function(t,e,n){this.type=t,this.index=e,this.input=n};cn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Ft),r=e.parse(t[2],2,qt(e.expectedType||Gt));return n&&r?new cn(r.type.itemType,n,r):null},cn.prototype.evaluate=function(t){var e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new ce("Array index out of bounds: "+e+" < 0.");if(e>=n.length)throw new ce("Array index out of bounds: "+e+" > "+(n.length-1)+".");if(e!==Math.floor(e))throw new ce("Array index must be an integer, but found "+e+" instead.");return n[e]},cn.prototype.eachChild=function(t){t(this.index),t(this.input)},cn.prototype.outputDefined=function(){return!1},cn.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var hn=function(t,e){this.type=Ut,this.needle=t,this.haystack=e};hn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Gt);return n&&r?Qt(n.type,[Ut,Bt,Ft,zt,Gt])?new hn(n,r):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Xt(n.type)+" instead"):null},hn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!Jt(e,["boolean","string","number","null"]))throw new ce("Expected first argument to be of type boolean, string, number or null, but found "+Xt(se(e))+" instead.");if(!Jt(n,["string","array"]))throw new ce("Expected second argument to be of type array or string, but found "+Xt(se(n))+" instead.");return n.indexOf(e)>=0},hn.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},hn.prototype.outputDefined=function(){return!0},hn.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var pn=function(t,e,n){this.type=Ft,this.needle=t,this.haystack=e,this.fromIndex=n};pn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Gt);if(!n||!r)return null;if(!Qt(n.type,[Ut,Bt,Ft,zt,Gt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Xt(n.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Ft);return i?new pn(n,r,i):null}return new pn(n,r)},pn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!Jt(e,["boolean","string","number","null"]))throw new ce("Expected first argument to be of type boolean, string, number or null, but found "+Xt(se(e))+" instead.");if(!Jt(n,["string","array"]))throw new ce("Expected second argument to be of type array or string, but found "+Xt(se(n))+" instead.");if(this.fromIndex){var r=this.fromIndex.evaluate(t);return n.indexOf(e,r)}return n.indexOf(e)},pn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},pn.prototype.outputDefined=function(){return!1},pn.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var fn=function(t,e,n,r,i,o){this.inputType=t,this.type=e,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o};fn.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var n,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var l=e.concat(a);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return l.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return l.error("Numeric branch labels must be integer values.");if(n){if(l.checkSubtype(n,se(p)))return null}else n=se(p);if(void 0!==i[String(p)])return l.error("Branch labels must be unique.");i[String(p)]=o.length}var f=e.parse(u,a,r);if(!f)return null;r=r||f.type,o.push(f)}var d=e.parse(t[1],1,Gt);if(!d)return null;var v=e.parse(t[t.length-1],t.length-1,r);return v?"value"!==d.type.kind&&e.concat(1).checkSubtype(n,d.type)?null:new fn(n,r,d,i,o,v):null},fn.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(se(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},fn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},fn.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},fn.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],n=[],r={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(h=r[this.cases[a]])?(r[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=n;u<l.length;u+=1){var c=l[u],h=c[0],p=c[1];e.push(1===p.length?s(p[0]):p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var dn=function(t,e,n){this.type=t,this.branches=e,this.otherwise=n};dn.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var r=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,Ut);if(!o)return null;var a=e.parse(t[i+1],i+1,n);if(!a)return null;r.push([o,a]),n=n||a.type}var s=e.parse(t[t.length-1],t.length-1,n);return s?new dn(n,r,s):null},dn.prototype.evaluate=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[1];if(r[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},dn.prototype.eachChild=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[1];t(r[0]),t(i)}t(this.otherwise)},dn.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},dn.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var vn=function(t,e,n,r){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=r};function mn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function yn(t,e,n,r){return 0===r.compare(e,n)}function gn(t,e,n){var r="=="!==t&&"!="!==t;return function(){function i(t,e,n){this.type=Ut,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=t[0],o=e.parse(t[1],1,Gt);if(!o)return null;if(!mn(n,o.type))return e.concat(1).error('"'+n+"\" comparisons are not supported for type '"+Xt(o.type)+"'.");var a=e.parse(t[2],2,Gt);if(!a)return null;if(!mn(n,a.type))return e.concat(2).error('"'+n+"\" comparisons are not supported for type '"+Xt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+Xt(o.type)+"' and '"+Xt(a.type)+"'.");r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new pe(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new pe(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Ht)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){var s=se(o),u=se(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new ce('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!r&&this.hasUntypedArgument){var l=se(o),c=se(a);if("string"!==l.kind||"string"!==c.kind)return e(i,o,a)}return this.collator?n(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},i}()}vn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Ft);if(!n||!r)return null;if(!Qt(n.type,[qt(Gt),Bt,Gt]))return e.error("Expected first argument to be of type array or string, but found "+Xt(n.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Ft);return i?new vn(n.type,n,r,i):null}return new vn(n.type,n,r)},vn.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!Jt(e,["string","array"]))throw new ce("Expected first argument to be of type array or string, but found "+Xt(se(e))+" instead.");if(this.endIndex){var r=this.endIndex.evaluate(t);return e.slice(n,r)}return e.slice(n)},vn.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},vn.prototype.outputDefined=function(){return!1},vn.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var _n=gn("==",(function(t,e,n){return e===n}),yn),xn=gn("!=",(function(t,e,n){return e!==n}),(function(t,e,n,r){return!yn(0,e,n,r)})),bn=gn("<",(function(t,e,n){return e<n}),(function(t,e,n,r){return r.compare(e,n)<0})),wn=gn(">",(function(t,e,n){return e>n}),(function(t,e,n,r){return r.compare(e,n)>0})),Sn=gn("<=",(function(t,e,n){return e<=n}),(function(t,e,n,r){return r.compare(e,n)<=0})),En=gn(">=",(function(t,e,n){return e>=n}),(function(t,e,n,r){return r.compare(e,n)>=0})),An=function(t,e,n,r,i){this.type=Bt,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i};An.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Ft);if(!n)return null;var r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");var i=null;if(r.locale&&!(i=e.parse(r.locale,1,Bt)))return null;var o=null;if(r.currency&&!(o=e.parse(r.currency,1,Bt)))return null;var a=null;if(r["min-fraction-digits"]&&!(a=e.parse(r["min-fraction-digits"],1,Ft)))return null;var s=null;return r["max-fraction-digits"]&&!(s=e.parse(r["max-fraction-digits"],1,Ft))?null:new An(n,i,o,a,s)},An.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},An.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},An.prototype.outputDefined=function(){return!1},An.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Tn=function(t){this.type=Ft,this.input=t};Tn.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found "+Xt(n.type)+" instead."):new Tn(n):null},Tn.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ce("Expected value to be of type string or array, but found "+Xt(se(e))+" instead.")},Tn.prototype.eachChild=function(t){t(this.input)},Tn.prototype.outputDefined=function(){return!1},Tn.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Cn={"==":_n,"!=":xn,">":wn,"<":bn,">=":En,"<=":Sn,array:pe,at:cn,boolean:pe,case:dn,coalesce:un,collator:xe,format:fe,image:de,in:hn,"index-of":pn,interpolate:an,"interpolate-hcl":an,"interpolate-lab":an,length:Tn,let:ln,literal:le,match:fn,number:pe,"number-format":An,object:pe,slice:vn,step:Ge,string:pe,"to-boolean":me,"to-color":me,"to-number":me,"to-string":me,var:Ue,within:Ne};function kn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3];n=n.evaluate(t),r=r.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=oe(n,r,i,a);if(s)throw new ce(s);return new te(n/255*a,r/255*a,i/255*a,a)}function Mn(t,e){return t in e}function In(t,e){var n=e[t];return void 0===n?null:n}function Pn(t){return{type:t}}function Ln(t){return{result:"success",value:t}}function Rn(t){return{result:"error",value:t}}function On(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Dn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Nn(t){return!!t.expression&&t.expression.interpolated}function zn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Fn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Bn(t){return t}function Un(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function jn(t,e,n,r,i){return Un(typeof n===i?r[n]:void 0,t.default,e.default)}function Vn(t,e,n){if("number"!==zn(n))return Un(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];var i=Ve(t.stops.map((function(t){return t[0]})),n);return t.stops[i][1]}function Gn(t,e,n){var r=void 0!==t.base?t.base:1;if("number"!==zn(n))return Un(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var o=Ve(t.stops.map((function(t){return t[0]})),n),a=function(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(n,r,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],u=t.stops[o+1][1],l=We[e.type]||Bn;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=on[t.colorSpace];l=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=s.evaluate.apply(void 0,t),r=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==r)return l(n,r,a)}}:l(s,u,a)}function Hn(t,e,n){return"color"===e.type?n=te.parse(n):"formatted"===e.type?n=re.fromString(n.toString()):"resolvedImage"===e.type?n=ie.fromString(n.toString()):zn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),Un(n,t.default,e.default)}_e.register(Cn,{error:[{kind:"error"},[Bt],function(t,e){throw new ce(e[0].evaluate(t))}],typeof:[Bt,[Gt],function(t,e){return Xt(se(e[0].evaluate(t)))}],"to-rgba":[qt(Ft,4),[jt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[jt,[Ft,Ft,Ft],kn],rgba:[jt,[Ft,Ft,Ft,Ft],kn],has:{type:Ut,overloads:[[[Bt],function(t,e){return Mn(e[0].evaluate(t),t.properties())}],[[Bt,Vt],function(t,e){var n=e[1];return Mn(e[0].evaluate(t),n.evaluate(t))}]]},get:{type:Gt,overloads:[[[Bt],function(t,e){return In(e[0].evaluate(t),t.properties())}],[[Bt,Vt],function(t,e){var n=e[1];return In(e[0].evaluate(t),n.evaluate(t))}]]},"feature-state":[Gt,[Bt],function(t,e){return In(e[0].evaluate(t),t.featureState||{})}],properties:[Vt,[],function(t){return t.properties()}],"geometry-type":[Bt,[],function(t){return t.geometryType()}],id:[Gt,[],function(t){return t.id()}],zoom:[Ft,[],function(t){return t.globals.zoom}],"heatmap-density":[Ft,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ft,[],function(t){return t.globals.lineProgress||0}],accumulated:[Gt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Ft,Pn(Ft),function(t,e){for(var n=0,r=0,i=e;r<i.length;r+=1)n+=i[r].evaluate(t);return n}],"*":[Ft,Pn(Ft),function(t,e){for(var n=1,r=0,i=e;r<i.length;r+=1)n*=i[r].evaluate(t);return n}],"-":{type:Ft,overloads:[[[Ft,Ft],function(t,e){var n=e[1];return e[0].evaluate(t)-n.evaluate(t)}],[[Ft],function(t,e){return-e[0].evaluate(t)}]]},"/":[Ft,[Ft,Ft],function(t,e){var n=e[1];return e[0].evaluate(t)/n.evaluate(t)}],"%":[Ft,[Ft,Ft],function(t,e){var n=e[1];return e[0].evaluate(t)%n.evaluate(t)}],ln2:[Ft,[],function(){return Math.LN2}],pi:[Ft,[],function(){return Math.PI}],e:[Ft,[],function(){return Math.E}],"^":[Ft,[Ft,Ft],function(t,e){var n=e[1];return Math.pow(e[0].evaluate(t),n.evaluate(t))}],sqrt:[Ft,[Ft],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Ft,[Ft],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Ft,[Ft],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Ft,[Ft],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Ft,[Ft],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Ft,[Ft],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Ft,[Ft],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Ft,[Ft],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Ft,Pn(Ft),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Ft,Pn(Ft),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Ft,[Ft],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Ft,[Ft],function(t,e){var n=e[0].evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ft,[Ft],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Ft,[Ft],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[Ut,[Bt,Gt],function(t,e){var n=e[0],r=e[1];return t.properties()[n.value]===r.value}],"filter-id-==":[Ut,[Gt],function(t,e){var n=e[0];return t.id()===n.value}],"filter-type-==":[Ut,[Bt],function(t,e){var n=e[0];return t.geometryType()===n.value}],"filter-<":[Ut,[Bt,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i<o}],"filter-id-<":[Ut,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r<i}],"filter->":[Ut,[Bt,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i>o}],"filter-id->":[Ut,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r>i}],"filter-<=":[Ut,[Bt,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[Ut,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r<=i}],"filter->=":[Ut,[Bt,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[Ut,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r>=i}],"filter-has":[Ut,[Gt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Ut,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[Ut,[qt(Bt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Ut,[qt(Gt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Ut,[Bt,qt(Gt)],function(t,e){var n=e[0];return e[1].value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[Ut,[Bt,qt(Gt)],function(t,e){var n=e[0],r=e[1];return function(t,e,n,r){for(;n<=r;){var i=n+r>>1;if(e[i]===t)return!0;e[i]>t?r=i-1:n=i+1}return!1}(t.properties()[n.value],r.value,0,r.value.length-1)}],all:{type:Ut,overloads:[[[Ut,Ut],function(t,e){var n=e[1];return e[0].evaluate(t)&&n.evaluate(t)}],[Pn(Ut),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(!r[n].evaluate(t))return!1;return!0}]]},any:{type:Ut,overloads:[[[Ut,Ut],function(t,e){var n=e[1];return e[0].evaluate(t)||n.evaluate(t)}],[Pn(Ut),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(r[n].evaluate(t))return!0;return!1}]]},"!":[Ut,[Ut],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Ut,[Bt],function(t,e){var n=t.globals&&t.globals.isSupportedScript;return!n||n(e[0].evaluate(t))}],upcase:[Bt,[Bt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Bt,[Bt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Bt,Pn(Gt),function(t,e){return e.map((function(e){return ue(e.evaluate(t))})).join("")}],"resolved-locale":[Bt,[Ht],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Wn=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new ge,this._defaultValue=e?function(t){return"color"===t.type&&Fn(t.default)?new te(0,0,0,0):"color"===t.type?te.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function Zn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Cn}function qn(t,e){var n=new je(Cn,[],e?function(t){var e={color:jt,string:Bt,number:Ft,enum:Bt,boolean:Ut,formatted:Wt,resolvedImage:Zt};return"array"===t.type?qt(e[t.value]||Gt,t.length):e[t.type]}(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?Ln(new Wn(r,e)):Rn(n.errors)}Wn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},Wn.prototype.evaluate=function(t,e,n,r,i,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null;try{var a=this.expression.evaluate(this._evaluator);if(null==a||"number"==typeof a&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new ce("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(a)+" instead.");return a}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Xn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Fe(e.expression)};Xn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)},Xn.prototype.evaluate=function(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)};var Yn=function(t,e,n,r){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Fe(e.expression),this.interpolationType=r};function Kn(t,e){if("error"===(t=qn(t,e)).result)return t;var n=t.value.expression,r=ze(n);if(!r&&!On(e))return Rn([new Dt("","data expressions not supported")]);var i=Be(n,["zoom"]);if(!i&&!Dn(e))return Rn([new Dt("","zoom expressions not supported")]);var o=function t(e){var n=null;if(e instanceof ln)n=t(e.result);else if(e instanceof un)for(var r=0,i=e.args;r<i.length&&!(n=t(i[r]));r+=1);else(e instanceof Ge||e instanceof an)&&e.input instanceof _e&&"zoom"===e.input.name&&(n=e);return n instanceof Dt||e.eachChild((function(e){var r=t(e);r instanceof Dt?n=r:!n&&r?n=new Dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&r&&n!==r&&(n=new Dt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}(n);return o||i?o instanceof Dt?Rn([o]):o instanceof an&&!Nn(e)?Rn([new Dt("",'"interpolate" expressions cannot be used with this property')]):Ln(o?new Yn(r?"camera":"composite",t.value,o.labels,o instanceof an?o.interpolation:void 0):new Xn(r?"constant":"source",t.value)):Rn([new Dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Yn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)},Yn.prototype.evaluate=function(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)},Yn.prototype.interpolationFactor=function(t,e,n){return this.interpolationType?an.interpolationFactor(this.interpolationType,t,e,n):0};var Qn=function(t,e){this._parameters=t,this._specification=e,Lt(this,function t(e,n){var r,i,o,a="color"===n.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||!(s||void 0!==e.property),l=e.type||(Nn(n)?"exponential":"interval");if(a&&((e=Lt({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],te.parse(t[1])]}))),e.default=te.parse(e.default?e.default:n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!on[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)r=Gn;else if("interval"===l)r=Vn;else if("categorical"===l){r=jn,i=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var p=h[c];i[p[0]]=p[1]}o=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');r=Hn}if(s){for(var f={},d=[],v=0;v<e.stops.length;v++){var m=e.stops[v],y=m[0].zoom;void 0===f[y]&&(f[y]={zoom:y,type:e.type,property:e.property,default:e.default,stops:[]},d.push(y)),f[y].stops.push([m[0].value,m[1]])}for(var g=[],_=0,x=d;_<x.length;_+=1){var b=x[_];g.push([f[b].zoom,t(f[b],n)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:an.interpolationFactor.bind(void 0,w),zoomStops:g.map((function(t){return t[0]})),evaluate:function(t,r){var i=t.zoom;return Gn({stops:g,base:e.base},n,i).evaluate(i,r)}}}if(u){var S="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:an.interpolationFactor.bind(void 0,S),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return r(e,n,t.zoom,i,o)}}}return{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?Un(e.default,n.default):r(e,n,s,i,o)}}}(this._parameters,this._specification))};function Jn(t){var e=t.key,n=t.value,r=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],u=zn(n);if("object"!==u)return[new It(e,n,"object expected, "+u+" found")];for(var l in n){var c=l.split(".")[0],h=r[c]||r["*"],p=void 0;if(i[c])p=i[c];else if(r[c])p=Sr;else if(i["*"])p=i["*"];else{if(!r["*"]){s.push(new It(e,n[l],'unknown property "'+l+'"'));continue}p=Sr}s=s.concat(p({key:(e?e+".":e)+l,value:n[l],valueSpec:h,style:o,styleSpec:a,object:n,objectKey:l},n))}for(var f in r)i[f]||r[f].required&&void 0===r[f].default&&void 0===n[f]&&s.push(new It(e,n,'missing required property "'+f+'"'));return s}function $n(t){var e=t.value,n=t.valueSpec,r=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||Sr;if("array"!==zn(e))return[new It(o,e,"array expected, "+zn(e)+" found")];if(n.length&&e.length!==n.length)return[new It(o,e,"array length "+n.length+" expected, length "+e.length+" found")];if(n["min-length"]&&e.length<n["min-length"])return[new It(o,e,"array length at least "+n["min-length"]+" expected, length "+e.length+" found")];var s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),"object"===zn(n.value)&&(s=n.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(a({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:r,styleSpec:i,key:o+"["+l+"]"}));return u}function tr(t){var e=t.key,n=t.value,r=t.valueSpec,i=zn(n);return"number"===i&&n!=n&&(i="NaN"),"number"!==i?[new It(e,n,"number expected, "+i+" found")]:"minimum"in r&&n<r.minimum?[new It(e,n,n+" is less than the minimum value "+r.minimum)]:"maximum"in r&&n>r.maximum?[new It(e,n,n+" is greater than the maximum value "+r.maximum)]:[]}function er(t){var e,n,r,i=t.valueSpec,o=Rt(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,u=!s,l="array"===zn(t.value.stops)&&"array"===zn(t.value.stops[0])&&"object"===zn(t.value.stops[0][0]),c=Jn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new It(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;return e=e.concat($n({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===zn(n)&&0===n.length&&e.push(new It(t.key,n,"array must have at least one stop")),e},default:function(t){return Sr({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&c.push(new It(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||c.push(new It(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!Nn(t.valueSpec)&&c.push(new It(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!On(t.valueSpec)?c.push(new It(t.key,t.value,"property functions not supported")):s&&!Dn(t.valueSpec)&&c.push(new It(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!l||void 0!==t.value.property||c.push(new It(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],o=t.value,s=t.key;if("array"!==zn(o))return[new It(s,o,"array expected, "+zn(o)+" found")];if(2!==o.length)return[new It(s,o,"array length 2 expected, length "+o.length+" found")];if(l){if("object"!==zn(o[0]))return[new It(s,o,"object expected, "+zn(o[0])+" found")];if(void 0===o[0].zoom)return[new It(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new It(s,o,"object stop key must have value")];if(r&&r>Rt(o[0].zoom))return[new It(s,o[0].zoom,"stop zoom values must appear in ascending order")];Rt(o[0].zoom)!==r&&(r=Rt(o[0].zoom),n=void 0,a={}),e=e.concat(Jn({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:tr,value:p}}))}else e=e.concat(p({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return Zn(Ot(o[1]))?e.concat([new It(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(Sr({key:s+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,r){var s=zn(t.value),u=Rt(t.value),l=null!==t.value?t.value:r;if(e){if(s!==e)return[new It(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new It(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var c="number expected, "+s+" found";return On(i)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(t.key,l,c)]}return"categorical"!==o||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==o&&"number"===s&&void 0!==n&&u<n?[new It(t.key,l,"stop domain values must appear in ascending order")]:(n=u,"categorical"===o&&u in a?[new It(t.key,l,"stop domain values must be unique")]:(a[u]=!0,[])):[new It(t.key,l,"integer expected, found "+u)]}}function nr(t){var e=("property"===t.expressionContext?Kn:qn)(Ot(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new It(""+t.key+e.key,t.value,e.message)}));var n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new It(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Fe(n))return[new It(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Fe(n))return[new It(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Be(n,["zoom","feature-state"]))return[new It(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!ze(n))return[new It(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rr(t){var e=t.key,n=t.value,r=t.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Rt(n))&&i.push(new It(e,n,"expected one of ["+r.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(r.values).indexOf(Rt(n))&&i.push(new It(e,n,"expected one of ["+Object.keys(r.values).join(", ")+"], "+JSON.stringify(n)+" found")),i}function ir(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,n=t.slice(1);e<n.length;e+=1){var r=n[e];if(!ir(r)&&"boolean"!=typeof r)return!1}return!0;default:return!0}}Qn.deserialize=function(t){return new Qn(t._parameters,t._specification)},Qn.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var or={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ar(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};ir(t)||(t=ur(t));var e=qn(t,or);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,n,r){return e.value.evaluate(t,n,{},r)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var n=1;n<e.length;n++)if(t(e[n]))return!0;return!1}(t)}}function sr(t,e){return t<e?-1:t>e?1:0}function ur(t){if(!t)return!0;var e,n=t[0];return t.length<=1?"any"!==n:"=="===n?lr(t[1],t[2],"=="):"!="===n?pr(lr(t[1],t[2],"==")):"<"===n||">"===n||"<="===n||">="===n?lr(t[1],t[2],n):"any"===n?(e=t.slice(1),["any"].concat(e.map(ur))):"all"===n?["all"].concat(t.slice(1).map(ur)):"none"===n?["all"].concat(t.slice(1).map(ur).map(pr)):"in"===n?cr(t[1],t.slice(2)):"!in"===n?pr(cr(t[1],t.slice(2))):"has"===n?hr(t[1]):"!has"===n?pr(hr(t[1])):"within"!==n||t}function lr(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function cr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(sr)]]:["filter-in-small",t,["literal",e]]}}function hr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function pr(t){return["!",t]}function fr(t){return ir(Ot(t.value))?nr(Lt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var n=e.value,r=e.key;if("array"!==zn(n))return[new It(r,n,"array expected, "+zn(n)+" found")];var i,o=e.styleSpec,a=[];if(n.length<1)return[new It(r,n,"filter array must have at least 1 element")];switch(a=a.concat(rr({key:r+"[0]",value:n[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Rt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Rt(n[1])&&a.push(new It(r,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&a.push(new It(r,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":n.length>=2&&"string"!==(i=zn(n[1]))&&a.push(new It(r+"[1]",n[1],"string expected, "+i+" found"));for(var s=2;s<n.length;s++)i=zn(n[s]),"$type"===Rt(n[1])?a=a.concat(rr({key:r+"["+s+"]",value:n[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new It(r+"["+s+"]",n[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<n.length;u++)a=a.concat(t({key:r+"["+u+"]",value:n[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=zn(n[1]),2!==n.length?a.push(new It(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new It(r+"[1]",n[1],"string expected, "+i+" found"));break;case"within":i=zn(n[1]),2!==n.length?a.push(new It(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"object"!==i&&a.push(new It(r+"[1]",n[1],"object expected, "+i+" found"))}return a}(t)}function dr(t,e){var n=t.key,r=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return Sr({key:n,value:o,valueSpec:i.transition,style:r,styleSpec:i});var l,c=t.valueSpec||s[a];if(!c)return[new It(n,o,'unknown property "'+a+'"')];if("string"===zn(o)&&On(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(o)))return[new It(n,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&r&&!r.glyphs&&h.push(new It(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Fn(Ot(o))&&"identity"===Rt(o.type)&&h.push(new It(n,o,'"text-font" does not support identity functions'))),h.concat(Sr({key:t.key,value:o,valueSpec:c,style:r,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function vr(t){return dr(t,"paint")}function mr(t){return dr(t,"layout")}function yr(t){var e=[],n=t.value,r=t.key,i=t.style,o=t.styleSpec;n.type||n.ref||e.push(new It(r,n,'either "type" or "ref" is required'));var a,s=Rt(n.type),u=Rt(n.ref);if(n.id)for(var l=Rt(n.id),c=0;c<t.arrayIndex;c++){var h=i.layers[c];Rt(h.id)===l&&e.push(new It(r,n.id,'duplicate layer id "'+n.id+'", previously used at line '+h.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(t){t in n&&e.push(new It(r,n[t],'"'+t+'" is prohibited for ref layers'))})),i.layers.forEach((function(t){Rt(t.id)===u&&(a=t)})),a?a.ref?e.push(new It(r,n.ref,"ref cannot reference another ref layer")):s=Rt(a.type):e.push(new It(r,n.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(n.source){var p=i.sources&&i.sources[n.source],f=p&&Rt(p.type);p?"vector"===f&&"raster"===s?e.push(new It(r,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new It(r,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==f||n["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new It(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||e.push(new It(r,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new It(r,n,'layer "'+n.id+'" must specify a "source-layer"')):e.push(new It(r,n.source,'source "'+n.source+'" not found'))}else e.push(new It(r,n,'missing required property "source"'));return e=e.concat(Jn({key:r,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Sr({key:r+".type",value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"})},filter:fr,layout:function(t){return Jn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return mr(Lt({layerType:s},t))}}})},paint:function(t){return Jn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return vr(Lt({layerType:s},t))}}})}}}))}function gr(t){var e=t.value,n=t.key,r=zn(e);return"string"!==r?[new It(n,e,"string expected, "+r+" found")]:[]}var _r={promoteId:function(t){var e=t.key,n=t.value;if("string"===zn(n))return gr({key:e,value:n});var r=[];for(var i in n)r.push.apply(r,gr({key:e+"."+i,value:n[i]}));return r}};function xr(t){var e=t.value,n=t.key,r=t.styleSpec,i=t.style;if(!e.type)return[new It(n,e,'"type" is required')];var o,a=Rt(e.type);switch(a){case"vector":case"raster":case"raster-dem":return Jn({key:n,value:e,valueSpec:r["source_"+a.replace("-","_")],style:t.style,styleSpec:r,objectElementValidators:_r});case"geojson":if(o=Jn({key:n,value:e,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:_r}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],l=u[0],c="string"==typeof l?[l,["accumulated"],["get",s]]:l;o.push.apply(o,nr({key:n+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),o.push.apply(o,nr({key:n+"."+s+".reduce",value:c,expressionContext:"cluster-reduce"}))}return o;case"video":return Jn({key:n,value:e,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return Jn({key:n,value:e,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new It(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rr({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function br(t){var e=t.value,n=t.styleSpec,r=n.light,i=t.style,o=[],a=zn(e);if(void 0===e)return o;if("object"!==a)return o.concat([new It("light",e,"object expected, "+a+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);o=o.concat(u&&r[u[1]]&&r[u[1]].transition?Sr({key:s,value:e[s],valueSpec:n.transition,style:i,styleSpec:n}):r[s]?Sr({key:s,value:e[s],valueSpec:r[s],style:i,styleSpec:n}):[new It(s,e[s],'unknown property "'+s+'"')])}return o}var wr={"*":function(){return[]},array:$n,boolean:function(t){var e=t.value,n=t.key,r=zn(e);return"boolean"!==r?[new It(n,e,"boolean expected, "+r+" found")]:[]},number:tr,color:function(t){var e=t.key,n=t.value,r=zn(n);return"string"!==r?[new It(e,n,"color expected, "+r+" found")]:null===$t(n)?[new It(e,n,'color expected, "'+n+'" found')]:[]},constants:Pt,enum:rr,filter:fr,function:er,layer:yr,object:Jn,source:xr,light:br,string:gr,formatted:function(t){return 0===gr(t).length?[]:nr(t)},resolvedImage:function(t){return 0===gr(t).length?[]:nr(t)}};function Sr(t){var e=t.value,n=t.valueSpec,r=t.styleSpec;return n.expression&&Fn(Rt(e))?er(t):n.expression&&Zn(Ot(e))?nr(t):n.type&&wr[n.type]?wr[n.type](t):Jn(Lt({},t,{valueSpec:n.type?r[n.type]:n}))}function Er(t){var e=t.value,n=t.key,r=gr(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new It(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new It(n,e,'"glyphs" url must include a "{range}" token'))),r}function Ar(t,e){void 0===e&&(e=Mt);var n=[];return n=n.concat(Sr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Er,"*":function(){return[]}}})),t.constants&&(n=n.concat(Pt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Tr(n)}function Tr(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function Cr(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return Tr(t.apply(this,e))}}Ar.source=Cr(xr),Ar.light=Cr(br),Ar.layer=Cr(yr),Ar.filter=Cr(fr),Ar.paintProperty=Cr(vr),Ar.layoutProperty=Cr(mr);var kr=Ar,Mr=kr.light,Ir=kr.paintProperty,Pr=kr.layoutProperty;function Lr(t,e){var n=!1;if(e&&e.length)for(var r=0,i=e;r<i.length;r+=1)t.fire(new Ct(new Error(i[r].message))),n=!0;return n}var Rr=Or;function Or(t,e,n){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(n=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[3+o],s=i[3+o+1];r.push(a===s?null:i.subarray(a,s))}var u=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var l=0;l<this.d*this.d;l++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var c=n/e*t;this.min=-c,this.max=t+c}Or.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Or.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Or.prototype._insertCell=function(t,e,n,r,i,o){this.cells[i].push(o)},Or.prototype.query=function(t,e,n,r,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=n&&a<=r&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,n,r,this._queryCell,s,{},i),s},Or.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=this.cells[i];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var p=u[h];if(void 0===a[p]){var f=4*p;(s?s(c[f+0],c[f+1],c[f+2],c[f+3]):t<=c[f+2]&&e<=c[f+3]&&n>=c[f+0]&&r>=c[f+1])?(a[p]=!0,o.push(l[p])):a[p]=!1}}},Or.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(n),h=this._convertToCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.d*f+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&i.call(this,t,e,n,r,d,o,a,s))return}},Or.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Or.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Or.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[3+a]=o,i.set(s,o),o+=s.length}return i[3+t.length]=o,i.set(this.keys,o),i[3+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var Dr=a.ImageData,Nr=a.ImageBitmap,zr={};function Fr(t,e,n){void 0===n&&(n={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),zr[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}for(var Br in Fr("Object",Object),Rr.serialize=function(t,e){var n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Rr.deserialize=function(t){return new Rr(t.buffer)},Fr("Grid",Rr),Fr("Color",te),Fr("Error",Error),Fr("ResolvedImage",ie),Fr("StylePropertyFunction",Qn),Fr("StyleExpression",Wn,{omit:["_evaluator"]}),Fr("ZoomDependentExpression",Yn),Fr("ZoomConstantExpression",Xn),Fr("CompoundExpression",_e,{omit:["_evaluate"]}),Cn)Cn[Br]._classRegistryKey||Fr("Expression_"+Br,Cn[Br]);function Ur(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function jr(t){return Nr&&t instanceof Nr}function Vr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Ur(t)||jr(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var n=t;return e&&e.push(n.buffer),n}if(t instanceof Dr)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var r=[],i=0,o=t;i<o.length;i+=1)r.push(Vr(o[i],e));return r}if("object"==typeof t){var a=t.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var u=a.serialize?a.serialize(t,e):{};if(!a.serialize){for(var l in t)if(t.hasOwnProperty(l)&&!(zr[s].omit.indexOf(l)>=0)){var c=t[l];u[l]=zr[s].shallow.indexOf(l)>=0?c:Vr(c,e)}t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function Gr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Ur(t)||jr(t)||ArrayBuffer.isView(t)||t instanceof Dr)return t;if(Array.isArray(t))return t.map(Gr);if("object"==typeof t){var e=t.$name||"Object",n=zr[e].klass;if(!n)throw new Error("can't deserialize unregistered class "+e);if(n.deserialize)return n.deserialize(t);for(var r=Object.create(n.prototype),i=0,o=Object.keys(t);i<o.length;i+=1){var a=o[i];if("$name"!==a){var s=t[a];r[a]=zr[e].shallow.indexOf(a)>=0?s:Gr(s)}}return r}throw new Error("can't deserialize object of type "+typeof t)}var Hr=function(){this.first=!0};Hr.prototype.update=function(t,e){var n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))};var Wr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Zr(t){for(var e=0,n=t;e<n.length;e+=1)if(qr(n[e].charCodeAt(0)))return!0;return!1}function qr(t){return!(746!==t&&747!==t&&(t<4352||!(Wr["Bopomofo Extended"](t)||Wr.Bopomofo(t)||Wr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Wr["CJK Compatibility Ideographs"](t)||Wr["CJK Compatibility"](t)||Wr["CJK Radicals Supplement"](t)||Wr["CJK Strokes"](t)||!(!Wr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Wr["CJK Unified Ideographs Extension A"](t)||Wr["CJK Unified Ideographs"](t)||Wr["Enclosed CJK Letters and Months"](t)||Wr["Hangul Compatibility Jamo"](t)||Wr["Hangul Jamo Extended-A"](t)||Wr["Hangul Jamo Extended-B"](t)||Wr["Hangul Jamo"](t)||Wr["Hangul Syllables"](t)||Wr.Hiragana(t)||Wr["Ideographic Description Characters"](t)||Wr.Kanbun(t)||Wr["Kangxi Radicals"](t)||Wr["Katakana Phonetic Extensions"](t)||Wr.Katakana(t)&&12540!==t||!(!Wr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Wr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Wr["Unified Canadian Aboriginal Syllabics"](t)||Wr["Unified Canadian Aboriginal Syllabics Extended"](t)||Wr["Vertical Forms"](t)||Wr["Yijing Hexagram Symbols"](t)||Wr["Yi Syllables"](t)||Wr["Yi Radicals"](t))))}function Xr(t){return!(qr(t)||function(t){return!!(Wr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Wr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Wr["Letterlike Symbols"](t)||Wr["Number Forms"](t)||Wr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Wr["Control Pictures"](t)&&9251!==t||Wr["Optical Character Recognition"](t)||Wr["Enclosed Alphanumerics"](t)||Wr["Geometric Shapes"](t)||Wr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Wr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Wr["CJK Symbols and Punctuation"](t)||Wr.Katakana(t)||Wr["Private Use Area"](t)||Wr["CJK Compatibility Forms"](t)||Wr["Small Form Variants"](t)||Wr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Yr(t){return t>=1424&&t<=2303||Wr["Arabic Presentation Forms-A"](t)||Wr["Arabic Presentation Forms-B"](t)}function Kr(t,e){return!(!e&&Yr(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Wr.Khmer(t))}function Qr(t){for(var e=0,n=t;e<n.length;e+=1)if(Yr(n[e].charCodeAt(0)))return!0;return!1}var Jr=null,$r="unavailable",ti=null,ei=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&($r="error"),Jr&&Jr(t)};function ni(){ri.fire(new Tt("pluginStateChange",{pluginStatus:$r,pluginURL:ti}))}var ri=new kt,ii=function(){return $r},oi=function(){if("deferred"!==$r||!ti)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$r="loading",ni(),ti&&xt({url:ti},(function(t){t?ei(t):($r="loaded",ni())}))},ai={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===$r||null!=ai.applyArabicShaping},isLoading:function(){return"loading"===$r},setState:function(t){$r=t.pluginStatus,ti=t.pluginURL},isParsed:function(){return null!=ai.applyArabicShaping&&null!=ai.processBidirectionalText&&null!=ai.processStyledBidirectionalText},getPluginURL:function(){return ti}},si=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Hr,this.transition={})};si.prototype.isSupportedScript=function(t){return function(t,e){for(var n=0,r=t;n<r.length;n+=1)if(!Kr(r[n].charCodeAt(0),e))return!1;return!0}(t,ai.isLoaded())},si.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},si.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}};var ui=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Fn(t))return new Qn(t,e);if(Zn(t)){var n=Kn(t,e);if("error"===n.result)throw new Error(n.value.map((function(t){return t.key+": "+t.message})).join(", "));return n.value}var r=t;return"string"==typeof t&&"color"===e.type&&(r=te.parse(t)),{kind:"constant",evaluate:function(){return r}}}(void 0===e?t.specification.default:e,t.specification)};ui.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},ui.prototype.possiblyEvaluate=function(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)};var li=function(t){this.property=t,this.value=new ui(t,void 0)};li.prototype.transitioned=function(t,e){return new hi(this.property,this.value,e,p({},t.transition,this.transition),t.now)},li.prototype.untransitioned=function(){return new hi(this.property,this.value,null,{},0)};var ci=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};ci.prototype.getValue=function(t){return b(this._values[t].value.value)},ci.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new li(this._values[t].property)),this._values[t].value=new ui(this._values[t].property,null===e?void 0:b(e))},ci.prototype.getTransition=function(t){return b(this._values[t].transition)},ci.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new li(this._values[t].property)),this._values[t].transition=b(e)||void 0},ci.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i);var o=this.getTransition(r);void 0!==o&&(t[r+"-transition"]=o)}return t},ci.prototype.transitioned=function(t,e){for(var n=new pi(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var o=i[r];n._values[o]=this._values[o].transitioned(t,e._values[o])}return n},ci.prototype.untransitioned=function(){for(var t=new pi(this._properties),e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e];t._values[r]=this._values[r].untransitioned()}return t};var hi=function(t,e,n,r,i){this.property=t,this.value=e,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=n)};hi.prototype.possiblyEvaluate=function(t,e,n){var r=t.now||0,i=this.value.possiblyEvaluate(t,e,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(t,e,n);var a=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,n),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(a))}return i};var pi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};pi.prototype.possiblyEvaluate=function(t,e,n){for(var r=new vi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(t,e,n)}return r},pi.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var fi=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};fi.prototype.getValue=function(t){return b(this._values[t].value)},fi.prototype.setValue=function(t,e){this._values[t]=new ui(this._values[t].property,null===e?void 0:b(e))},fi.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i)}return t},fi.prototype.possiblyEvaluate=function(t,e,n){for(var r=new vi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(t,e,n)}return r};var di=function(t,e,n){this.property=t,this.value=e,this.parameters=n};di.prototype.isConstant=function(){return"constant"===this.value.kind},di.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},di.prototype.evaluate=function(t,e,n,r){return this.property.evaluate(this.value,this.parameters,t,e,n,r)};var vi=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};vi.prototype.get=function(t){return this._values[t]};var mi=function(t){this.specification=t};mi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},mi.prototype.interpolate=function(t,e,n){var r=We[this.specification.type];return r?r(t,e,n):t};var yi=function(t,e){this.specification=t,this.overrides=e};yi.prototype.possiblyEvaluate=function(t,e,n,r){return new di(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,r)}:t.expression,e)},yi.prototype.interpolate=function(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new di(this,{kind:"constant",value:void 0},t.parameters);var r=We[this.specification.type];return r?new di(this,{kind:"constant",value:r(t.value.value,e.value.value,n)},t.parameters):t},yi.prototype.evaluate=function(t,e,n,r,i,o){return"constant"===t.kind?t.value:t.evaluate(e,n,r,i,o)};var gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,n,r){if(void 0===t.value)return new di(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(o,o,o,e);return new di(this,{kind:"constant",value:a},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new di(this,{kind:"constant",value:s},e)}return new di(this,t.expression,e)},e.prototype.evaluate=function(t,e,n,r,i,o){if("source"===t.kind){var a=t.evaluate(e,n,r,i,o);return this._calculate(a,a,a,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,r),t.evaluate({zoom:Math.floor(e.zoom)},n,r),t.evaluate({zoom:Math.floor(e.zoom)+1},n,r),e):t.value},e.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},e.prototype.interpolate=function(t){return t},e}(yi),_i=function(t){this.specification=t};_i.prototype.possiblyEvaluate=function(t,e,n,r){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n,r);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new si(Math.floor(e.zoom-1),e)),t.expression.evaluate(new si(Math.floor(e.zoom),e)),t.expression.evaluate(new si(Math.floor(e.zoom+1),e)),e)}},_i.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},_i.prototype.interpolate=function(t){return t};var xi=function(t){this.specification=t};xi.prototype.possiblyEvaluate=function(t,e,n,r){return!!t.expression.evaluate(e,null,{},n,r)},xi.prototype.interpolate=function(){return!1};var bi=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var n=t[e];n.specification.overridable&&this.overridableProperties.push(e);var r=this.defaultPropertyValues[e]=new ui(n,void 0),i=this.defaultTransitionablePropertyValues[e]=new li(n);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}};Fr("DataDrivenProperty",yi),Fr("DataConstantProperty",mi),Fr("CrossFadedDataDrivenProperty",gi),Fr("CrossFadedProperty",_i),Fr("ColorRampProperty",xi);var wi=function(t){function e(e,n){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new fi(n.layout)),n.paint)){for(var r in this._transitionablePaint=new ci(n.paint),e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vi(n.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,n){void 0===n&&(n={}),null!=e&&this._validate(Pr,"layers."+this.id+".layout."+t,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return g(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e&&this._validate(Ir,"layers."+this.id+".paint."+t,t,e,n))return!1;if(g(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;var r=this._transitionablePaint._values[t],i="cross-faded-data-driven"===r.property.specification["property-type"],o=r.value.isDataDriven(),a=r.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||o||i||this._handleOverridablePaintPropertyUpdate(t,a,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,n){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),x(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,n,r,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&Lr(this,t.call(kr,{key:e,layerType:this.type,objectKey:n,value:r,styleSpec:Mt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof di&&On(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(kt),Si={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ei=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ai=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ti(t,e){void 0===e&&(e=1);var n=0,r=0;return{members:t.map((function(t){var i=Si[t.type].BYTES_PER_ELEMENT,o=n=Ci(n,Math.max(e,i)),a=t.components||1;return r=Math.max(r,i),n+=i*a,{name:t.name,type:t.type,components:a,offset:o}})),size:Ci(n,Math.max(r,e)),alignment:e}}function Ci(t,e){return Math.ceil(t/e)*e}Ai.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ai.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Ai.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ai.prototype.clear=function(){this.length=0},Ai.prototype.resize=function(t){this.reserve(t),this.length=t},Ai.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Ai.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.int16[r+0]=e,this.int16[r+1]=n,t},e}(Ai);ki.prototype.bytesPerElement=4,Fr("StructArrayLayout2i4",ki);var Mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,t},e}(Ai);Mi.prototype.bytesPerElement=8,Fr("StructArrayLayout4i8",Mi);var Ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ai);Ii.prototype.bytesPerElement=12,Fr("StructArrayLayout2i4i12",Ii);var Pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=4*t,u=8*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.uint8[u+4]=r,this.uint8[u+5]=i,this.uint8[u+6]=o,this.uint8[u+7]=a,t},e}(Ai);Pi.prototype.bytesPerElement=8,Fr("StructArrayLayout2i4ub8",Pi);var Li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.float32[r+0]=e,this.float32[r+1]=n,t},e}(Ai);Li.prototype.bytesPerElement=8,Fr("StructArrayLayout2f8",Li);var Ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,r,i,o,a,s,u,l)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c){var h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=i,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=u,this.uint16[h+8]=l,this.uint16[h+9]=c,t},e}(Ai);Ri.prototype.bytesPerElement=20,Fr("StructArrayLayout10ui20",Ri);var Oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,n,r,i,o,a,s,u,l,c,h)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,p){var f=12*t;return this.int16[f+0]=e,this.int16[f+1]=n,this.int16[f+2]=r,this.int16[f+3]=i,this.uint16[f+4]=o,this.uint16[f+5]=a,this.uint16[f+6]=s,this.uint16[f+7]=u,this.int16[f+8]=l,this.int16[f+9]=c,this.int16[f+10]=h,this.int16[f+11]=p,t},e}(Ai);Oi.prototype.bytesPerElement=24,Fr("StructArrayLayout4i4ui4i24",Oi);var Di=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=n,this.float32[i+2]=r,t},e}(Ai);Di.prototype.bytesPerElement=12,Fr("StructArrayLayout3f12",Di);var Ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Ai);Ni.prototype.bytesPerElement=4,Fr("StructArrayLayout1ul4",Ni);var zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,n,r,i,o,a,s,u)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l){var c=10*t,h=5*t;return this.int16[c+0]=e,this.int16[c+1]=n,this.int16[c+2]=r,this.int16[c+3]=i,this.int16[c+4]=o,this.int16[c+5]=a,this.uint32[h+3]=s,this.uint16[c+8]=u,this.uint16[c+9]=l,t},e}(Ai);zi.prototype.bytesPerElement=20,Fr("StructArrayLayout6i1ul2ui20",zi);var Fi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ai);Fi.prototype.bytesPerElement=12,Fr("StructArrayLayout2i2i2i12",Fi);var Bi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,r,i)},e.prototype.emplace=function(t,e,n,r,i,o){var a=4*t,s=8*t;return this.float32[a+0]=e,this.float32[a+1]=n,this.float32[a+2]=r,this.int16[s+6]=i,this.int16[s+7]=o,t},e}(Ai);Bi.prototype.bytesPerElement=16,Fr("StructArrayLayout2f1f2i16",Bi);var Ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=n,this.float32[a+1]=r,this.float32[a+2]=i,t},e}(Ai);Ui.prototype.bytesPerElement=12,Fr("StructArrayLayout2ub2f12",Ui);var ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,this.uint16[i+2]=r,t},e}(Ai);ji.prototype.bytesPerElement=6,Fr("StructArrayLayout3ui6",ji);var Vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m){var y=this.length;return this.resize(y+1),this.emplace(y,t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,y){var g=24*t,_=12*t,x=48*t;return this.int16[g+0]=e,this.int16[g+1]=n,this.uint16[g+2]=r,this.uint16[g+3]=i,this.uint32[_+2]=o,this.uint32[_+3]=a,this.uint32[_+4]=s,this.uint16[g+10]=u,this.uint16[g+11]=l,this.uint16[g+12]=c,this.float32[_+7]=h,this.float32[_+8]=p,this.uint8[x+36]=f,this.uint8[x+37]=d,this.uint8[x+38]=v,this.uint32[_+10]=m,this.int16[g+22]=y,t},e}(Ai);Vi.prototype.bytesPerElement=48,Fr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Vi);var Gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,y,g,_,x,b,w,S,E,A,T,C){var k=this.length;return this.resize(k+1),this.emplace(k,t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,y,g,_,x,b,w,S,E,A,T,C)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,y,g,_,x,b,w,S,E,A,T,C,k){var M=34*t,I=17*t;return this.int16[M+0]=e,this.int16[M+1]=n,this.int16[M+2]=r,this.int16[M+3]=i,this.int16[M+4]=o,this.int16[M+5]=a,this.int16[M+6]=s,this.int16[M+7]=u,this.uint16[M+8]=l,this.uint16[M+9]=c,this.uint16[M+10]=h,this.uint16[M+11]=p,this.uint16[M+12]=f,this.uint16[M+13]=d,this.uint16[M+14]=v,this.uint16[M+15]=m,this.uint16[M+16]=y,this.uint16[M+17]=g,this.uint16[M+18]=_,this.uint16[M+19]=x,this.uint16[M+20]=b,this.uint16[M+21]=w,this.uint16[M+22]=S,this.uint32[I+12]=E,this.float32[I+13]=A,this.float32[I+14]=T,this.float32[I+15]=C,this.float32[I+16]=k,t},e}(Ai);Gi.prototype.bytesPerElement=68,Fr("StructArrayLayout8i15ui1ul4f68",Gi);var Hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Ai);Hi.prototype.bytesPerElement=4,Fr("StructArrayLayout1f4",Hi);var Wi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=n,this.int16[i+2]=r,t},e}(Ai);Wi.prototype.bytesPerElement=6,Fr("StructArrayLayout3i6",Wi);var Zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=n,this.uint16[i+3]=r,t},e}(Ai);Zi.prototype.bytesPerElement=8,Fr("StructArrayLayout1ul2ui8",Zi);var qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,t},e}(Ai);qi.prototype.bytesPerElement=4,Fr("StructArrayLayout2ui4",qi);var Xi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Ai);Xi.prototype.bytesPerElement=2,Fr("StructArrayLayout1ui2",Xi);var Yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,t},e}(Ai);Yi.prototype.bytesPerElement=16,Fr("StructArrayLayout4f16",Yi);var Ki=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,n),e}(Ei);Ki.prototype.size=20;var Qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ki(this,t)},e}(zi);Fr("CollisionBoxArray",Qi);var Ji=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},n.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},n.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},n.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},n.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,n),e}(Ei);Ji.prototype.size=48;var $i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ji(this,t)},e}(Vi);Fr("PlacedSymbolArray",$i);var to=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},n.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},n.key.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},n.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},n.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},n.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},n.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},n.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},n.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},n.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,n),e}(Ei);to.prototype.size=68;var eo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new to(this,t)},e}(Gi);Fr("SymbolInstanceArray",eo);var no=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(Hi);Fr("GlyphOffsetArray",no);var ro=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Wi);Fr("SymbolLineVertexArray",ro);var io=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,n),e}(Ei);io.prototype.size=8;var oo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new io(this,t)},e}(Zi);Fr("FeatureIndexArray",oo);var ao=Ti([{name:"a_pos",components:2,type:"Int16"}],4).members,so=function(t){void 0===t&&(t=[]),this.segments=t};function uo(t,e){return 256*(t=c(Math.floor(t),0,255))+c(Math.floor(e),0,255)}so.prototype.prepareSegment=function(t,e,n,r){var i=this.segments[this.segments.length-1];return t>so.MAX_VERTEX_ARRAY_LENGTH&&S("Max vertices per segment is "+so.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>so.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i},so.prototype.get=function(){return this.segments},so.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var n=e[t];for(var r in n.vaos)n.vaos[r].destroy()}},so.simpleSegment=function(t,e,n,r){return new so([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])},so.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fr("SegmentVector",so);var lo=Ti([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),co=e((function(t){t.exports=function(t,e){var n,r,i,o,a,s,u,l;for(r=t.length-(n=3&t.length),i=e,a=3432918353,s=461845907,l=0;l<r;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),ho=e((function(t){t.exports=function(t,e){for(var n,r=t.length,i=e^r,o=0;r>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),po=co,fo=ho;po.murmur3=co,po.murmur2=fo;var vo=function(){this.ids=[],this.positions=[],this.indexed=!1};vo.prototype.add=function(t,e,n,r){this.ids.push(yo(t)),this.positions.push(e,n,r)},vo.prototype.getPositions=function(t){for(var e=yo(t),n=0,r=this.ids.length-1;n<r;){var i=n+r>>1;this.ids[i]>=e?r=i:n=i+1}for(var o=[];this.ids[n]===e;)o.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return o},vo.serialize=function(t,e){var n=new Float64Array(t.ids),r=new Uint32Array(t.positions);return function t(e,n,r,i){for(;r<i;){for(var o=e[r+i>>1],a=r-1,s=i+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;go(e,a,s),go(n,3*a,3*s),go(n,3*a+1,3*s+1),go(n,3*a+2,3*s+2)}s-r<i-s?(t(e,n,r,s),r=s+1):(t(e,n,s+1,i),i=s)}}(n,r,0,n.length-1),e&&e.push(n.buffer,r.buffer),{ids:n,positions:r}},vo.deserialize=function(t){var e=new vo;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var mo=Math.pow(2,53)-1;function yo(t){var e=+t;return!isNaN(e)&&e<=mo?e:po(String(t))}function go(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}Fr("FeaturePositionMap",vo);var _o=function(t,e){this.gl=t.gl,this.location=e},xo=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(_o),bo=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(_o),wo=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(_o),So=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(_o),Eo=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(_o),Ao=function(t){function e(e,n){t.call(this,e,n),this.current=te.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(_o),To=new Float32Array(16),Co=function(t){function e(e,n){t.call(this,e,n),this.current=To}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(_o);function ko(t){return[uo(255*t.r,255*t.g),uo(255*t.b,255*t.a)]}var Mo=function(t,e,n){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=n};Mo.prototype.setUniform=function(t,e,n){t.set(n.constantOr(this.value))},Mo.prototype.getBinding=function(t,e,n){return"color"===this.type?new Ao(t,e):new bo(t,e)};var Io=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Io.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Io.prototype.setUniform=function(t,e,n,r){var i="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;i&&t.set(i)},Io.prototype.getBinding=function(t,e,n){return"u_pattern"===n.substr(0,9)?new Eo(t,e):new bo(t,e)};var Po=function(t,e,n,r){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?2:1,offset:0}})),this.paintVertexArray=new r};Po.prototype.populatePaintArray=function(t,e,n,r,i){var o=this.paintVertexArray.length,a=this.expression.evaluate(new si(0),e,{},r,[],i);this.paintVertexArray.resize(t),this._setPaintValue(o,t,a)},Po.prototype.updatePaintArray=function(t,e,n,r){var i=this.expression.evaluate({zoom:0},n,r);this._setPaintValue(t,e,i)},Po.prototype._setPaintValue=function(t,e,n){if("color"===this.type)for(var r=ko(n),i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1]);else{for(var o=t;o<e;o++)this.paintVertexArray.emplace(o,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}},Po.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Po.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Lo=function(t,e,n,r,i,o){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?4:2,offset:0}})),this.paintVertexArray=new o};Lo.prototype.populatePaintArray=function(t,e,n,r,i){var o=this.expression.evaluate(new si(this.zoom),e,{},r,[],i),a=this.expression.evaluate(new si(this.zoom+1),e,{},r,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,o,a)},Lo.prototype.updatePaintArray=function(t,e,n,r){var i=this.expression.evaluate({zoom:this.zoom},n,r),o=this.expression.evaluate({zoom:this.zoom+1},n,r);this._setPaintValue(t,e,i,o)},Lo.prototype._setPaintValue=function(t,e,n,r){if("color"===this.type)for(var i=ko(n),o=ko(r),a=t;a<e;a++)this.paintVertexArray.emplace(a,i[0],i[1],o[0],o[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}},Lo.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Lo.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Lo.prototype.setUniform=function(t,e){var n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=c(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(r)},Lo.prototype.getBinding=function(t,e,n){return new bo(t,e)};var Ro=function(t,e,n,r,i,o){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i};Ro.prototype.populatePaintArray=function(t,e,n){var r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],n)},Ro.prototype.updatePaintArray=function(t,e,n,r,i){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],i)},Ro.prototype._setPaintValues=function(t,e,n,r){if(r&&n){var i=r[n.min],o=r[n.mid],a=r[n.max];if(i&&o&&a)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],o.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio)}},Ro.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,lo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,lo.members,this.expression.isStateDependent))},Ro.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Oo=function(t,e,n){this.binders={},this._buffers=[];var r=[];for(var i in t.paint._values)if(n(i)){var o=t.paint.get(i);if(o instanceof di&&On(o.property.specification)){var a=No(i,t.type),s=o.value,u=o.property.specification.type,l=o.property.useIntegerZoom,c=o.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===s.kind)this.binders[i]=h?new Io(s.value,a):new Mo(s.value,a,u),r.push("/u_"+i);else if("source"===s.kind||h){var p=zo(i,u,"source");this.binders[i]=h?new Ro(s,u,l,e,p,t.id):new Po(s,a,u,p),r.push("/a_"+i)}else{var f=zo(i,u,"composite");this.binders[i]=new Lo(s,a,u,l,e,f),r.push("/z_"+i)}}}this.cacheKey=r.sort().join("")};Oo.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Po||e instanceof Lo?e.maxValue:0},Oo.prototype.populatePaintArrays=function(t,e,n,r,i){for(var o in this.binders){var a=this.binders[o];(a instanceof Po||a instanceof Lo||a instanceof Ro)&&a.populatePaintArray(t,e,n,r,i)}},Oo.prototype.setConstantPatternPositions=function(t,e){for(var n in this.binders){var r=this.binders[n];r instanceof Io&&r.setConstantPatternPositions(t,e)}},Oo.prototype.updatePaintArrays=function(t,e,n,r,i){var o=!1;for(var a in t)for(var s=0,u=e.getPositions(a);s<u.length;s+=1){var l=u[s],c=n.feature(l.index);for(var h in this.binders){var p=this.binders[h];if((p instanceof Po||p instanceof Lo||p instanceof Ro)&&!0===p.expression.isStateDependent){var f=r.paint.get(h);p.expression=f.value,p.updatePaintArray(l.start,l.end,c,t[a],i),o=!0}}}return o},Oo.prototype.defines=function(){var t=[];for(var e in this.binders){var n=this.binders[e];(n instanceof Mo||n instanceof Io)&&t.push.apply(t,n.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},Oo.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Po||n instanceof Lo)for(var r=0;r<n.paintVertexAttributes.length;r++)t.push(n.paintVertexAttributes[r].name);else if(n instanceof Ro)for(var i=0;i<lo.members.length;i++)t.push(lo.members[i].name)}return t},Oo.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Mo||n instanceof Io||n instanceof Lo)for(var r=0,i=n.uniformNames;r<i.length;r+=1)t.push(i[r])}return t},Oo.prototype.getPaintVertexBuffers=function(){return this._buffers},Oo.prototype.getUniforms=function(t,e){var n=[];for(var r in this.binders){var i=this.binders[r];if(i instanceof Mo||i instanceof Io||i instanceof Lo)for(var o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var u=i.getBinding(t,e[s],s);n.push({name:s,property:r,binding:u})}}}return n},Oo.prototype.setUniforms=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.name,u=a.property;this.binders[u].setUniform(a.binding,r,n.get(u),s)}},Oo.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var n=this.binders[e];if(t&&n instanceof Ro){var r=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else(n instanceof Po||n instanceof Lo)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}},Oo.prototype.upload=function(t){for(var e in this.binders){var n=this.binders[e];(n instanceof Po||n instanceof Lo||n instanceof Ro)&&n.upload(t)}this.updatePaintBuffers()},Oo.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Po||e instanceof Lo||e instanceof Ro)&&e.destroy()}};var Do=function(t,e,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var r=0,i=t;r<i.length;r+=1){var o=i[r];this.programConfigurations[o.id]=new Oo(o,e,n)}this.needsUpload=!1,this._featureMap=new vo,this._bufferOffset=0};function No(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function zo(t,e,n){var r={color:{source:Li,composite:Yi},number:{source:Hi,composite:Li}},i=function(t){return{"line-pattern":{source:Ri,composite:Ri},"fill-pattern":{source:Ri,composite:Ri},"fill-extrusion-pattern":{source:Ri,composite:Ri}}[t]}(t);return i&&i[n]||r[e][n]}Do.prototype.populatePaintArrays=function(t,e,n,r,i,o){for(var a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,r,i,o);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Do.prototype.updatePaintArrays=function(t,e,n,r){for(var i=0,o=n;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,e,a,r)||this.needsUpload}},Do.prototype.get=function(t){return this.programConfigurations[t]},Do.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},Do.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Fr("ConstantBinder",Mo),Fr("CrossFadedConstantBinder",Io),Fr("SourceExpressionBinder",Po),Fr("CrossFadedCompositeBinder",Ro),Fr("CompositeExpressionBinder",Lo),Fr("ProgramConfiguration",Oo,{omit:["_buffers"]}),Fr("ProgramConfigurationSet",Do);var Fo=Math.pow(2,14)-1,Bo=-Fo-1;function Uo(t){for(var e=8192/t.extent,n=t.loadGeometry(),r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.length;o++){var a=i[o],s=Math.round(a.x*e),u=Math.round(a.y*e);a.x=c(s,Bo,Fo),a.y=c(u,Bo,Fo),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&S("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function jo(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Uo(t):[]}}function Vo(t,e,n,r,i){t.emplaceBack(2*e+(r+1)/2,2*n+(i+1)/2)}var Go=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ki,this.indexArray=new ji,this.segments=new so,this.programConfigurations=new Do(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ho(t,e){for(var n=0;n<t.length;n++)if($o(e,t[n]))return!0;for(var r=0;r<e.length;r++)if($o(t,e[r]))return!0;return!!Xo(t,e)}function Wo(t,e,n){return!!$o(t,e)||!!Ko(e,t,n)}function Zo(t,e){if(1===t.length)return Jo(e,t[0]);for(var n=0;n<e.length;n++)for(var r=e[n],i=0;i<r.length;i++)if($o(t,r[i]))return!0;for(var o=0;o<t.length;o++)if(Jo(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(Xo(t,e[a]))return!0;return!1}function qo(t,e,n){if(t.length>1){if(Xo(t,e))return!0;for(var r=0;r<e.length;r++)if(Ko(e[r],t,n))return!0}for(var i=0;i<t.length;i++)if(Ko(t[i],e,n))return!0;return!1}function Xo(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var r=t[n],i=t[n+1],o=0;o<e.length-1;o++)if(Yo(r,i,e[o],e[o+1]))return!0;return!1}function Yo(t,e,n,r){return E(t,n,r)!==E(e,n,r)&&E(t,e,n)!==E(t,e,r)}function Ko(t,e,n){var r=n*n;if(1===e.length)return t.distSqr(e[0])<r;for(var i=1;i<e.length;i++)if(Qo(t,e[i-1],e[i])<r)return!0;return!1}function Qo(t,e,n){var r=e.distSqr(n);if(0===r)return t.distSqr(e);var i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return t.distSqr(i<0?e:i>1?n:n.sub(e)._mult(i)._add(e))}function Jo(t,e){for(var n,r,i,o=!1,a=0;a<t.length;a++)for(var s=0,u=(n=t[a]).length-1;s<n.length;u=s++)(r=n[s]).y>e.y!=(i=n[u]).y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(o=!o);return o}function $o(t,e){for(var n=!1,r=0,i=t.length-1;r<t.length;i=r++){var o=t[r],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function ta(t,e,n){var r=n[0],i=n[2];if(t.x<r.x&&e.x<r.x||t.x>i.x&&e.x>i.x||t.y<r.y&&e.y<r.y||t.y>i.y&&e.y>i.y)return!1;var o=E(t,e,n[0]);return o!==E(t,e,n[1])||o!==E(t,e,n[2])||o!==E(t,e,n[3])}function ea(t,e,n){var r=e.paint.get(t).value;return"constant"===r.kind?r.value:n.programConfigurations.get(e.id).getMaxValue(t)}function na(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ra(t,e,n,r,o){if(!e[0]&&!e[1])return t;var a=i.convert(e)._mult(o);"viewport"===n&&a._rotate(-r);for(var s=[],u=0;u<t.length;u++)s.push(t[u].sub(a));return s}Go.prototype.populate=function(t,e,n){var r=this.layers[0],i=[],o=null;"circle"===r.type&&(o=r.layout.get("circle-sort-key"));for(var a=0,s=t;a<s.length;a+=1){var u=s[a],l=u.feature,c=u.id,h=u.index,p=u.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,d=jo(l,f);if(this.layers[0]._featureFilter.filter(new si(this.zoom),d,n)){var v=o?o.evaluate(d,{},n):void 0,m={id:c,properties:l.properties,type:l.type,sourceLayerIndex:p,index:h,geometry:f?d.geometry:Uo(l),patterns:{},sortKey:v};i.push(m)}}o&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var y=0,g=i;y<g.length;y+=1){var _=g[y],x=_.geometry,b=_.index,w=_.sourceLayerIndex,S=t[b].feature;this.addFeature(_,x,b,n),e.featureIndex.insert(S,x,b,w,this.index)}},Go.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Go.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Go.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Go.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ao),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Go.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Go.prototype.addFeature=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1)for(var a=0,s=o[i];a<s.length;a+=1){var u=s[a],l=u.x,c=u.y;if(!(l<0||l>=8192||c<0||c>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),p=h.vertexLength;Vo(this.layoutVertexArray,l,c,-1,-1),Vo(this.layoutVertexArray,l,c,1,-1),Vo(this.layoutVertexArray,l,c,1,1),Vo(this.layoutVertexArray,l,c,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},r)},Fr("CircleBucket",Go,{omit:["layers"]});var ia=new bi({"circle-sort-key":new yi(Mt.layout_circle["circle-sort-key"])}),oa={paint:new bi({"circle-radius":new yi(Mt.paint_circle["circle-radius"]),"circle-color":new yi(Mt.paint_circle["circle-color"]),"circle-blur":new yi(Mt.paint_circle["circle-blur"]),"circle-opacity":new yi(Mt.paint_circle["circle-opacity"]),"circle-translate":new mi(Mt.paint_circle["circle-translate"]),"circle-translate-anchor":new mi(Mt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mi(Mt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mi(Mt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yi(Mt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yi(Mt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yi(Mt.paint_circle["circle-stroke-opacity"])}),layout:ia},aa="undefined"!=typeof Float32Array?Float32Array:Array;function sa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ua(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],v=e[12],m=e[13],y=e[14],g=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*h+w*v,t[1]=_*i+x*u+b*p+w*m,t[2]=_*o+x*l+b*f+w*y,t[3]=_*a+x*c+b*d+w*g,t[4]=(_=n[4])*r+(x=n[5])*s+(b=n[6])*h+(w=n[7])*v,t[5]=_*i+x*u+b*p+w*m,t[6]=_*o+x*l+b*f+w*y,t[7]=_*a+x*c+b*d+w*g,t[8]=(_=n[8])*r+(x=n[9])*s+(b=n[10])*h+(w=n[11])*v,t[9]=_*i+x*u+b*p+w*m,t[10]=_*o+x*l+b*f+w*y,t[11]=_*a+x*c+b*d+w*g,t[12]=(_=n[12])*r+(x=n[13])*s+(b=n[14])*h+(w=n[15])*v,t[13]=_*i+x*u+b*p+w*m,t[14]=_*o+x*l+b*f+w*y,t[15]=_*a+x*c+b*d+w*g,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,n=arguments.length;n--;)e+=t[n]*t[n];return Math.sqrt(e)});var la,ca=ua;function ha(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}la=new aa(3),aa!=Float32Array&&(la[0]=0,la[1]=0,la[2]=0),function(){var t=new aa(4);aa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var pa=(function(){var t=new aa(2);aa!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(e){t.call(this,e,oa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Go(t)},e.prototype.queryRadius=function(t){var e=t;return ea("circle-radius",this,e)+ea("circle-stroke-width",this,e)+na(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a,s){for(var u=ra(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),l=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),c="map"===this.paint.get("circle-pitch-alignment"),h=c?u:function(t,e){return t.map((function(t){return fa(t,e)}))}(u,s),p=c?l*a:l,f=0,d=r;f<d.length;f+=1)for(var v=0,m=d[f];v<m.length;v+=1){var y=m[v],g=c?y:fa(y,s),_=p,x=ha([],[y.x,y.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=x[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=o.cameraToCenterDistance/x[3]),Wo(h,g,_))return!0}return!1},e}(wi));function fa(t,e){var n=ha([],[t.x,t.y,0,1],e);return new i(n[0]/n[3],n[1]/n[3])}var da=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Go);function va(t,e,n,r){var i=e.width,o=e.height;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return t.width=i,t.height=o,t.data=r,t}function ma(t,e,n){var r=e.width,i=e.height;if(r!==t.width||i!==t.height){var o=va({},{width:r,height:i},n);ya(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,i)},n),t.width=r,t.height=i,t.data=o.data}}function ya(t,e,n,r,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<i.height;u++)for(var l=((n.y+u)*t.width+n.x)*o,c=((r.y+u)*e.width+r.x)*o,h=0;h<i.width*o;h++)s[c+h]=a[l+h];return e}Fr("HeatmapBucket",da,{omit:["layers"]});var ga=function(t,e){va(this,t,1,e)};ga.prototype.resize=function(t){ma(this,t,1)},ga.prototype.clone=function(){return new ga({width:this.width,height:this.height},new Uint8Array(this.data))},ga.copy=function(t,e,n,r,i){ya(t,e,n,r,i,1)};var _a=function(t,e){va(this,t,4,e)};_a.prototype.resize=function(t){ma(this,t,4)},_a.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},_a.prototype.clone=function(){return new _a({width:this.width,height:this.height},new Uint8Array(this.data))},_a.copy=function(t,e,n,r,i){ya(t,e,n,r,i,4)},Fr("AlphaImage",ga),Fr("RGBAImage",_a);var xa={paint:new bi({"heatmap-radius":new yi(Mt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yi(Mt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mi(Mt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xi(Mt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mi(Mt.paint_heatmap["heatmap-opacity"])})};function ba(t){var e={},n=t.resolution||256,r=t.clips?t.clips.length:1,i=t.image||new _a({width:n,height:r}),o=function(n,r,o){e[t.evaluationKey]=o;var a=t.expression.evaluate(e);i.data[n+r+0]=Math.floor(255*a.r/a.a),i.data[n+r+1]=Math.floor(255*a.g/a.a),i.data[n+r+2]=Math.floor(255*a.b/a.a),i.data[n+r+3]=Math.floor(255*a.a)};if(t.clips)for(var a=0,s=0;a<r;++a,s+=4*n)for(var u=0,l=0;u<n;u++,l+=4){var c=u/(n-1),h=t.clips[a];o(s,l,h.start*(1-c)+h.end*c)}else for(var p=0,f=0;p<n;p++,f+=4)o(0,f,p/(n-1));return i}var wa=function(t){function e(e){t.call(this,e,xa),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new da(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=ba({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(wi),Sa={paint:new bi({"hillshade-illumination-direction":new mi(Mt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mi(Mt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mi(Mt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mi(Mt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mi(Mt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mi(Mt.paint_hillshade["hillshade-accent-color"])})},Ea=function(t){function e(e){t.call(this,e,Sa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(wi),Aa=Ti([{name:"a_pos",components:2,type:"Int16"}],4).members,Ta=ka,Ca=ka;function ka(t,e,n){n=n||2;var r,i,o,a,s,u,l,c=e&&e.length,h=c?e[0]*n:t.length,p=Ma(t,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Ma(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(Ua(a));for(s.sort(Na),i=0;i<s.length;i++)za(s[i],n),n=Ia(n,n.next);return n}(t,e,p,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var d=n;d<h;d+=n)(s=t[d])<r&&(r=s),(u=t[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-r,a-i))?1/l:0}return Pa(p,f,n,r,i,l),f}function Ma(t,e,n,r,i){var o,a;if(i===$a(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Ka(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Ka(o,t[o],t[o+1],a);return a&&Ha(a,a.next)&&(Qa(a),a=a.next),a}function Ia(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Ha(r,r.next)&&0!==Ga(r.prev,r,r.next))r=r.next;else{if(Qa(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Pa(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=Ba(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,r,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Ra(t,r,i,o):La(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),Qa(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?Pa(t=Oa(Ia(t),e,n),e,n,r,i,o,2):2===a&&Da(t,e,n,r,i,o):Pa(Ia(t),e,n,r,i,o,1);break}}}function La(t){var e=t.prev,n=t,r=t.next;if(Ga(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(ja(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Ga(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Ra(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Ga(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,l=Ba(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),c=Ba(s,u,e,n,r),h=t.prevZ,p=t.nextZ;h&&h.z>=l&&p&&p.z<=c;){if(h!==t.prev&&h!==t.next&&ja(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&ja(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Ga(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=l;){if(h!==t.prev&&h!==t.next&&ja(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&ja(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Ga(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Oa(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Ha(i,o)&&Wa(i,r,r.next,o)&&Xa(i,o)&&Xa(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Qa(r),Qa(r.next),r=t=o),r=r.next}while(r!==t);return Ia(r)}function Da(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Va(a,s)){var u=Ya(a,s);return a=Ia(a,a.next),u=Ia(u,u.next),Pa(a,e,n,r,i,o),void Pa(u,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function Na(t,e){return t.x-e.x}function za(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,l=n,c=n.x,h=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&ja(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),Xa(r,t)&&(u<p||u===p&&(r.x>n.x||r.x===n.x&&Fa(n,r)))&&(n=r,p=u)),r=r.next}while(r!==l);return n}(t,e)){var n=Ya(e,t);Ia(e,e.next),Ia(n,n.next)}}function Fa(t,e){return Ga(t.prev,t,e.prev)<0&&Ga(e.next,t,t.next)<0}function Ba(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ua(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function ja(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Va(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Wa(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Xa(t,e)&&Xa(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Ga(t.prev,t,e.prev)||Ga(t,e.prev,e))||Ha(t,e)&&Ga(t.prev,t,t.next)>0&&Ga(e.prev,e,e.next)>0)}function Ga(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ha(t,e){return t.x===e.x&&t.y===e.y}function Wa(t,e,n,r){var i=qa(Ga(t,e,n)),o=qa(Ga(t,e,r)),a=qa(Ga(n,r,t)),s=qa(Ga(n,r,e));return i!==o&&a!==s||!(0!==i||!Za(t,n,e))||!(0!==o||!Za(t,r,e))||!(0!==a||!Za(n,t,r))||!(0!==s||!Za(n,e,r))}function Za(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function qa(t){return t>0?1:t<0?-1:0}function Xa(t,e){return Ga(t.prev,t,t.next)<0?Ga(t,e,t.next)>=0&&Ga(t,t.prev,e)>=0:Ga(t,e,t.prev)<0||Ga(t,t.next,e)<0}function Ya(t,e){var n=new Ja(t.i,t.x,t.y),r=new Ja(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ka(t,e,n,r){var i=new Ja(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Qa(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ja(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $a(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function ts(t,e,n,r,i){!function t(e,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1);t(e,n,Math.max(r,Math.floor(n-s*l/a+c)),Math.min(i,Math.floor(n+(a-s)*l/a+c)),o)}var h=e[n],p=r,f=i;for(es(e,r,n),o(e[i],h)>0&&es(e,r,i);p<f;){for(es(e,p,f),p++,f--;o(e[p],h)<0;)p++;for(;o(e[f],h)>0;)f--}0===o(e[r],h)?es(e,r,f):es(e,++f,i),f<=n&&(r=f+1),n<=f&&(i=f-1)}}(t,e,n||0,r||t.length-1,i||ns)}function es(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function ns(t,e){return t<e?-1:t>e?1:0}function rs(t,e){var n=t.length;if(n<=1)return[t];for(var r,i,o=[],a=0;a<n;a++){var s=A(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(r&&o.push(r),r=[t[a]]):r.push(t[a]))}if(r&&o.push(r),e>1)for(var u=0;u<o.length;u++)o[u].length<=e||(ts(o[u],e,1,o[u].length-1,is),o[u]=o[u].slice(0,e));return o}function is(t,e){return e.area-t.area}function os(t,e,n){for(var r=n.patternDependencies,i=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,r[u.to]=!0,r[u.from]=!0)}return i}function as(t,e,n,r,i){for(var o=i.patternDependencies,a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:r-1},n,{},i.availableImages),h=l.evaluate({zoom:r},n,{},i.availableImages),p=l.evaluate({zoom:r+1},n,{},i.availableImages);h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,o[c=c&&c.name?c.name:c]=!0,o[h]=!0,o[p]=!0,n.patterns[u.id]={min:c,mid:h,max:p}}}return n}ka.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs($a(t,0,i?e[0]*n:t.length,n));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs($a(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n));var u=0;for(a=0;a<r.length;a+=3){var l=r[a]*n,c=r[a+1]*n,h=r[a+2]*n;u+=Math.abs((t[l]-t[h])*(t[c+1]-t[l+1])-(t[l]-t[c])*(t[h+1]-t[l+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},ka.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&n.holes.push(r+=t[i-1].length)}return n},Ta.default=Ca;var ss=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ki,this.indexArray=new ji,this.indexArray2=new qi,this.programConfigurations=new Do(t.layers,t.zoom),this.segments=new so,this.segments2=new so,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};ss.prototype.populate=function(t,e,n){this.hasPattern=os("fill",this.layers,e);for(var r=this.layers[0].layout.get("fill-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.id,c=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,f=jo(u,p);if(this.layers[0]._featureFilter.filter(new si(this.zoom),f,n)){var d=r?r.evaluate(f,{},n,e.availableImages):void 0,v={id:l,properties:u.properties,type:u.type,sourceLayerIndex:h,index:c,geometry:p?f.geometry:Uo(u),patterns:{},sortKey:d};i.push(v)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,y=i;m<y.length;m+=1){var g=y[m],_=g.geometry,x=g.index,b=g.sourceLayerIndex;if(this.hasPattern){var w=as("fill",this.layers,g,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(g,_,x,n,{});e.featureIndex.insert(t[x].feature,_,x,b,this.index)}},ss.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},ss.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},ss.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Aa),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ss.prototype.addFeature=function(t,e,n,r,i){for(var o=0,a=rs(e,500);o<a.length;o+=1){for(var s=a[o],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),p=h.vertexLength,f=[],d=[],v=0,m=s;v<m.length;v+=1){var y=m[v];if(0!==y.length){y!==s[0]&&d.push(f.length/2);var g=this.segments2.prepareSegment(y.length,this.layoutVertexArray,this.indexArray2),_=g.vertexLength;this.layoutVertexArray.emplaceBack(y[0].x,y[0].y),this.indexArray2.emplaceBack(_+y.length-1,_),f.push(y[0].x),f.push(y[0].y);for(var x=1;x<y.length;x++)this.layoutVertexArray.emplaceBack(y[x].x,y[x].y),this.indexArray2.emplaceBack(_+x-1,_+x),f.push(y[x].x),f.push(y[x].y);g.vertexLength+=y.length,g.primitiveLength+=y.length}}for(var b=Ta(f,d),w=0;w<b.length;w+=3)this.indexArray.emplaceBack(p+b[w],p+b[w+1],p+b[w+2]);h.vertexLength+=u,h.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Fr("FillBucket",ss,{omit:["layers","patternFeatures"]});var us=new bi({"fill-sort-key":new yi(Mt.layout_fill["fill-sort-key"])}),ls={paint:new bi({"fill-antialias":new mi(Mt.paint_fill["fill-antialias"]),"fill-opacity":new yi(Mt.paint_fill["fill-opacity"]),"fill-color":new yi(Mt.paint_fill["fill-color"]),"fill-outline-color":new yi(Mt.paint_fill["fill-outline-color"]),"fill-translate":new mi(Mt.paint_fill["fill-translate"]),"fill-translate-anchor":new mi(Mt.paint_fill["fill-translate-anchor"]),"fill-pattern":new gi(Mt.paint_fill["fill-pattern"])}),layout:us},cs=function(t){function e(e){t.call(this,e,ls)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new ss(t)},e.prototype.queryRadius=function(){return na(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a){return Zo(ra(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),r)},e.prototype.isTileClipped=function(){return!0},e}(wi),hs=Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,ps=fs;function fs(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(ds,this,e)}function ds(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function vs(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)r+=((n=t[a]).x-(e=t[i]).x)*(e.y+n.y);return r}fs.types=["Unknown","Point","LineString","Polygon"],fs.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,o=0,a=0,s=0,u=[];t.pos<n;){if(o<=0){var l=t.readVarint();r=7&l,o=l>>3}if(o--,1===r||2===r)a+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&u.push(e),e=[]),e.push(new i(a,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&u.push(e),u},fs.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(r<=0){var c=t.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},fs.prototype.toGeoJSON=function(t,e,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=fs.types[this.type];function c(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];c(u=h);break;case 2:for(r=0;r<u.length;r++)c(u[r]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=vs(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)c(u[r][i])}1===u.length?u=u[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p};var ms=ys;function ys(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(gs,this,e),this.length=this._features.length}function gs(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}function _s(t,e,n){if(3===t){var r=new ms(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}ys.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ps(this._pbf,e,this.extent,this._keys,this._values)};var xs={VectorTile:function(t,e){this.layers=t.readFields(_s,{},e)},VectorTileFeature:ps,VectorTileLayer:ms},bs=xs.VectorTileFeature.types,ws=Math.pow(2,13);function Ss(t,e,n,r,i,o,a,s){t.emplaceBack(e,n,2*Math.floor(r*ws)+a,i*ws*2,o*ws*2,Math.round(s))}var Es=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ii,this.indexArray=new ji,this.programConfigurations=new Do(t.layers,t.zoom),this.segments=new so,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function As(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}Es.prototype.populate=function(t,e,n){this.features=[],this.hasPattern=os("fill-extrusion",this.layers,e);for(var r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.feature,s=o.id,u=o.index,l=o.sourceLayerIndex,c=this.layers[0]._featureFilter.needGeometry,h=jo(a,c);if(this.layers[0]._featureFilter.filter(new si(this.zoom),h,n)){var p={id:s,sourceLayerIndex:l,index:u,geometry:c?h.geometry:Uo(a),properties:a.properties,type:a.type,patterns:{}};this.hasPattern?this.features.push(as("fill-extrusion",this.layers,p,this.zoom,e)):this.addFeature(p,p.geometry,u,n,{}),e.featureIndex.insert(a,p.geometry,u,l,this.index,!0)}}},Es.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.features;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},Es.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Es.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Es.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Es.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Es.prototype.addFeature=function(t,e,n,r,i){for(var o=0,a=rs(e,500);o<a.length;o+=1){for(var s=a[o],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,f=s;p<f.length;p+=1){var d=f[p];if(0!==d.length&&!((L=d).every((function(t){return t.x<0}))||L.every((function(t){return t.x>8192}))||L.every((function(t){return t.y<0}))||L.every((function(t){return t.y>8192}))))for(var v=0,m=0;m<d.length;m++){var y=d[m];if(m>=1){var g=d[m-1];if(!As(y,g)){h.vertexLength+4>so.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=y.sub(g)._perp()._unit(),x=g.dist(y);v+x>32768&&(v=0),Ss(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,v),Ss(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,v),Ss(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,0,v+=x),Ss(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,1,v);var b=h.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+u>so.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray)),"Polygon"===bs[t.type]){for(var w=[],S=[],E=h.vertexLength,A=0,T=s;A<T.length;A+=1){var C=T[A];if(0!==C.length){C!==s[0]&&S.push(w.length/2);for(var k=0;k<C.length;k++){var M=C[k];Ss(this.layoutVertexArray,M.x,M.y,0,0,1,1,0),w.push(M.x),w.push(M.y)}}}for(var I=Ta(w,S),P=0;P<I.length;P+=3)this.indexArray.emplaceBack(E+I[P],E+I[P+2],E+I[P+1]);h.primitiveLength+=I.length/3,h.vertexLength+=u}}var L;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Fr("FillExtrusionBucket",Es,{omit:["layers","features"]});var Ts={paint:new bi({"fill-extrusion-opacity":new mi(Mt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yi(Mt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mi(Mt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mi(Mt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gi(Mt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yi(Mt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yi(Mt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mi(Mt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Cs=function(t){function e(e){t.call(this,e,Ts)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Es(t)},e.prototype.queryRadius=function(){return na(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,n,r,o,a,s,u){var l=ra(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,n),h=this.paint.get("fill-extrusion-base").evaluate(e,n),p=function(t,e,n,r){for(var o=[],a=0,s=t;a<s.length;a+=1){var u=s[a],l=[u.x,u.y,0,1];ha(l,l,e),o.push(new i(l[0]/l[3],l[1]/l[3]))}return o}(l,u),f=function(t,e,n,r){for(var o=[],a=[],s=r[8]*e,u=r[9]*e,l=r[10]*e,c=r[11]*e,h=r[8]*n,p=r[9]*n,f=r[10]*n,d=r[11]*n,v=0,m=t;v<m.length;v+=1){for(var y=[],g=[],_=0,x=m[v];_<x.length;_+=1){var b=x[_],w=b.x,S=b.y,E=r[0]*w+r[4]*S+r[12],A=r[1]*w+r[5]*S+r[13],T=r[2]*w+r[6]*S+r[14],C=r[3]*w+r[7]*S+r[15],k=T+l,M=C+c,I=E+h,P=A+p,L=T+f,R=C+d,O=new i((E+s)/M,(A+u)/M);O.z=k/M,y.push(O);var D=new i(I/R,P/R);D.z=L/R,g.push(D)}o.push(y),a.push(g)}return[o,a]}(r,h,c,u);return function(t,e,n){var r=1/0;Zo(n,e)&&(r=Ms(n,e[0]));for(var i=0;i<e.length;i++)for(var o=e[i],a=t[i],s=0;s<o.length-1;s++){var u=o[s],l=[u,o[s+1],a[s+1],a[s],u];Ho(n,l)&&(r=Math.min(r,Ms(n,l)))}return r!==1/0&&r}(f[0],f[1],p)},e}(wi);function ks(t,e){return t.x*e.x+t.y*e.y}function Ms(t,e){if(1===t.length){for(var n,r=0,i=e[r++];!n||i.equals(n);)if(!(n=e[r++]))return 1/0;for(;r<e.length;r++){var o=e[r],a=t[0],s=n.sub(i),u=o.sub(i),l=a.sub(i),c=ks(s,s),h=ks(s,u),p=ks(u,u),f=ks(l,s),d=ks(l,u),v=c*p-h*h,m=(p*f-h*d)/v,y=(c*d-h*f)/v,g=i.z*(1-m-y)+n.z*m+o.z*y;if(isFinite(g))return g}return 1/0}for(var _=1/0,x=0,b=e;x<b.length;x+=1)_=Math.min(_,b[x].z);return _}var Is=Ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ps=Ti([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Ls=xs.VectorTileFeature.types,Rs=Math.cos(Math.PI/180*37.5),Os=Math.pow(2,14)/.5,Ds=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new Pi,this.layoutVertexArray2=new Li,this.indexArray=new ji,this.programConfigurations=new Do(t.layers,t.zoom),this.segments=new so,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};Ds.prototype.populate=function(t,e,n){this.hasPattern=os("line",this.layers,e);for(var r=this.layers[0].layout.get("line-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.id,c=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,f=jo(u,p);if(this.layers[0]._featureFilter.filter(new si(this.zoom),f,n)){var d=r?r.evaluate(f,{},n):void 0,v={id:l,properties:u.properties,type:u.type,sourceLayerIndex:h,index:c,geometry:p?f.geometry:Uo(u),patterns:{},sortKey:d};i.push(v)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,y=i;m<y.length;m+=1){var g=y[m],_=g.geometry,x=g.index,b=g.sourceLayerIndex;if(this.hasPattern){var w=as("line",this.layers,g,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(g,_,x,n,{});e.featureIndex.insert(t[x].feature,_,x,b,this.index)}},Ds.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Ds.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},Ds.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ds.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ds.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ps)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Is),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ds.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ds.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ds.prototype.addFeature=function(t,e,n,r,i){var o=this.layers[0].layout,a=o.get("line-join").evaluate(t,{}),s=o.get("line-cap"),u=o.get("line-miter-limit"),l=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var c=0,h=e;c<h.length;c+=1)this.addLine(h[c],t,a,s,u,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Ds.prototype.addLine=function(t,e,n,r,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var a=0;a<t.length-1;a++)this.totalDistance+=t[a].dist(t[a+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Ls[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var l=0;l<u-1&&t[l].equals(t[l+1]);)l++;if(!(u<(s?3:2))){"bevel"===n&&(i=1.05);var c,h=this.overscaling<=16?122880/(512*this.overscaling):0,p=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray),f=void 0,d=void 0,v=void 0,m=void 0;this.e1=this.e2=-1,s&&(m=t[l].sub(c=t[u-2])._unit()._perp());for(var y=l;y<u;y++)if(!(d=y===u-1?s?t[l+1]:void 0:t[y+1])||!t[y].equals(d)){m&&(v=m),c&&(f=c),c=t[y],m=d?d.sub(c)._unit()._perp():v;var g=(v=v||m).add(m);0===g.x&&0===g.y||g._unit();var _=v.x*m.x+v.y*m.y,x=g.x*m.x+g.y*m.y,b=0!==x?1/x:1/0,w=2*Math.sqrt(2-2*x),S=x<Rs&&f&&d,E=v.x*m.y-v.y*m.x>0;if(S&&y>l){var A=c.dist(f);if(A>2*h){var T=c.sub(c.sub(f)._mult(h/A)._round());this.updateDistance(f,T),this.addCurrentVertex(T,v,0,0,p),f=T}}var C=f&&d,k=C?n:s?"butt":r;if(C&&"round"===k&&(b<o?k="miter":b<=2&&(k="fakeround")),"miter"===k&&b>i&&(k="bevel"),"bevel"===k&&(b>2&&(k="flipbevel"),b<i&&(k="miter")),f&&this.updateDistance(f,c),"miter"===k)g._mult(b),this.addCurrentVertex(c,g,0,0,p);else if("flipbevel"===k){if(b>100)g=m.mult(-1);else{var M=b*v.add(m).mag()/v.sub(m).mag();g._perp()._mult(M*(E?-1:1))}this.addCurrentVertex(c,g,0,0,p),this.addCurrentVertex(c,g.mult(-1),0,0,p)}else if("bevel"===k||"fakeround"===k){var I=-Math.sqrt(b*b-1),P=E?I:0,L=E?0:I;if(f&&this.addCurrentVertex(c,v,P,L,p),"fakeround"===k)for(var R=Math.round(180*w/Math.PI/20),O=1;O<R;O++){var D=O/R;if(.5!==D){var N=D-.5;D+=D*N*(D-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*N*N+(.848013+_*(.215638*_-1.06021)))}var z=m.sub(v)._mult(D)._add(v)._unit()._mult(E?-1:1);this.addHalfVertex(c,z.x,z.y,!1,E,0,p)}d&&this.addCurrentVertex(c,m,-P,-L,p)}else if("butt"===k)this.addCurrentVertex(c,g,0,0,p);else if("square"===k){var F=f?1:-1;this.addCurrentVertex(c,g,F,F,p)}else"round"===k&&(f&&(this.addCurrentVertex(c,v,0,0,p),this.addCurrentVertex(c,v,1,1,p,!0)),d&&(this.addCurrentVertex(c,m,-1,-1,p,!0),this.addCurrentVertex(c,m,0,0,p)));if(S&&y<u-1){var B=c.dist(d);if(B>2*h){var U=c.add(d.sub(c)._mult(h/B)._round());this.updateDistance(c,U),this.addCurrentVertex(U,m,0,0,p),c=U}}}}},Ds.prototype.addCurrentVertex=function(t,e,n,r,i,o){void 0===o&&(o=!1);var a=e.y*r-e.x,s=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,o,!1,n,i),this.addHalfVertex(t,a,s,o,!0,-r,i),this.distance>Os/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,n,r,i,o))},Ds.prototype.addHalfVertex=function(t,e,n,r,i,o,a){var s=.5*(this.lineClips?this.scaledDistance*(Os-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(r?1:0),(t.y<<1)+(i?1:0),Math.round(63*e)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),i?this.e2=u:this.e1=u},Ds.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ds.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},Fr("LineBucket",Ds,{omit:["layers","patternFeatures"]});var Ns=new bi({"line-cap":new mi(Mt.layout_line["line-cap"]),"line-join":new yi(Mt.layout_line["line-join"]),"line-miter-limit":new mi(Mt.layout_line["line-miter-limit"]),"line-round-limit":new mi(Mt.layout_line["line-round-limit"]),"line-sort-key":new yi(Mt.layout_line["line-sort-key"])}),zs={paint:new bi({"line-opacity":new yi(Mt.paint_line["line-opacity"]),"line-color":new yi(Mt.paint_line["line-color"]),"line-translate":new mi(Mt.paint_line["line-translate"]),"line-translate-anchor":new mi(Mt.paint_line["line-translate-anchor"]),"line-width":new yi(Mt.paint_line["line-width"]),"line-gap-width":new yi(Mt.paint_line["line-gap-width"]),"line-offset":new yi(Mt.paint_line["line-offset"]),"line-blur":new yi(Mt.paint_line["line-blur"]),"line-dasharray":new _i(Mt.paint_line["line-dasharray"]),"line-pattern":new gi(Mt.paint_line["line-pattern"]),"line-gradient":new xi(Mt.paint_line["line-gradient"])}),layout:Ns},Fs=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,n){return n=new si(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),t.prototype.possiblyEvaluate.call(this,e,n)},e.prototype.evaluate=function(e,n,r,i){return n=p({},n,{zoom:Math.floor(n.zoom)}),t.prototype.evaluate.call(this,e,n,r,i)},e}(yi))(zs.paint.properties["line-width"].specification);Fs.useIntegerZoom=!0;var Bs=function(t){function e(e){t.call(this,e,zs),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ge,this.gradientVersion=(this.gradientVersion+1)%s)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n),this.paint._values["line-floorwidth"]=Fs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Ds(t)},e.prototype.queryRadius=function(t){var e=t,n=Us(ea("line-width",this,e),ea("line-gap-width",this,e)),r=ea("line-offset",this,e);return n/2+Math.abs(r)+na(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,o,a,s){var u=ra(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),l=s/2*Us(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(r=function(t,e){for(var n=[],r=new i(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],u=0;u<a.length;u++){var l=a[u],c=a[u+1],h=0===u?r:l.sub(a[u-1])._unit()._perp(),p=u===a.length-1?r:c.sub(l)._unit()._perp(),f=h._add(p)._unit();f._mult(1/(f.x*p.x+f.y*p.y)),s.push(f._mult(e)._add(l))}n.push(s)}return n}(r,c*s)),function(t,e,n){for(var r=0;r<e.length;r++){var i=e[r];if(t.length>=3)for(var o=0;o<i.length;o++)if($o(t,i[o]))return!0;if(qo(t,i,n))return!0}return!1}(u,r,l)},e.prototype.isTileClipped=function(){return!0},e}(wi);function Us(t,e){return e>0?e+2*t:t}var js=Ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vs=Ti([{name:"a_projected_pos",components:3,type:"Float32"}],4),Gs=(Ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Hs=(Ti([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ws=Ti([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Zs(t,e,n){return t.sections.forEach((function(t){t.text=function(t,e,n){var r=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),ai.applyArabicShaping&&(t=ai.applyArabicShaping(t)),t}(t.text,e,n)})),t}Ti([{name:"triangle",components:3,type:"Uint16"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ti([{type:"Float32",name:"offsetX"}]),Ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var qs={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Xs=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,p=n?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},Ys=function(t,e,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+f]=255&a,f+=d,a/=256,l-=8);t[n+f-d]|=128*v},Ks=Qs;function Qs(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Qs.Varint=0,Qs.Fixed64=1,Qs.Bytes=2,Qs.Fixed32=5;var Js="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function $s(t){return t.type===Qs.Bytes?t.readVarint()+t.pos:t.pos+1}function tu(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function eu(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function nu(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function ru(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function iu(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function ou(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function au(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function su(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function uu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function lu(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function cu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function hu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function pu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function fu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function du(t,e,n){1===t&&n.readMessage(vu,e)}function vu(t,e,n){if(3===t){var r=n.readMessage(mu,{}),i=r.width,o=r.height,a=r.left,s=r.top,u=r.advance;e.push({id:r.id,bitmap:new ga({width:i+6,height:o+6},r.bitmap),metrics:{width:i,height:o,left:a,top:s,advance:u}})}}function mu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function yu(t){for(var e=0,n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];e+=o.w*o.h,n=Math.max(n,o.w)}t.sort((function(t,e){return e.h-t.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,u=0,l=0,c=t;l<c.length;l+=1)for(var h=c[l],p=a.length-1;p>=0;p--){var f=a[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===f.w&&h.h===f.h){var d=a.pop();p<a.length&&(a[p]=d)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(a.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}Qs.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=hu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=fu(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hu(this.buf,this.pos)+4294967296*hu(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=hu(this.buf,this.pos)+4294967296*fu(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Xs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Xs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return tu(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return tu(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Js?function(t,e,n){return Js.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var r="",i=e;i<n;){var o,a,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Qs.Bytes)return t.push(this.readVarint(e));var n=$s(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Qs.Bytes)return t.push(this.readSVarint());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Qs.Bytes)return t.push(this.readBoolean());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Qs.Bytes)return t.push(this.readFloat());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Qs.Bytes)return t.push(this.readDouble());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Qs.Bytes)return t.push(this.readFixed32());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Qs.Bytes)return t.push(this.readSFixed32());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Qs.Bytes)return t.push(this.readFixed64());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Qs.Bytes)return t.push(this.readSFixed64());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Qs.Varint)for(;this.buf[this.pos++]>127;);else if(e===Qs.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Qs.Fixed32)this.pos+=4;else{if(e!==Qs.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),pu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),pu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),pu(this.buf,-1&t,this.pos),pu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),pu(this.buf,-1&t,this.pos),pu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&eu(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Ys(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ys(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&eu(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Qs.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,nu,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,ru,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,au,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,iu,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ou,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,su,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,uu,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,lu,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,cu,e)},writeBytesField:function(t,e){this.writeTag(t,Qs.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Qs.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Qs.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Qs.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Qs.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Qs.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Qs.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Qs.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Qs.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Qs.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var gu=function(t,e){var n=e.pixelRatio,r=e.version,i=e.stretchX,o=e.stretchY,a=e.content;this.paddedRect=t,this.pixelRatio=n,this.stretchX=i,this.stretchY=o,this.content=a,this.version=r},_u={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};_u.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},_u.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},_u.tlbr.get=function(){return this.tl.concat(this.br)},_u.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(gu.prototype,_u);var xu=function(t,e){var n={},r={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,n,i),this.addImages(e,r,i);var o=yu(i),a=new _a({width:o.w||1,height:o.h||1});for(var s in t){var u=t[s],l=n[s].paddedRect;_a.copy(u.data,a,{x:0,y:0},{x:l.x+1,y:l.y+1},u.data)}for(var c in e){var h=e[c],p=r[c].paddedRect,f=p.x+1,d=p.y+1,v=h.data.width,m=h.data.height;_a.copy(h.data,a,{x:0,y:0},{x:f,y:d},h.data),_a.copy(h.data,a,{x:0,y:m-1},{x:f,y:d-1},{width:v,height:1}),_a.copy(h.data,a,{x:0,y:0},{x:f,y:d+m},{width:v,height:1}),_a.copy(h.data,a,{x:v-1,y:0},{x:f-1,y:d},{width:1,height:m}),_a.copy(h.data,a,{x:0,y:0},{x:f+v,y:d},{width:1,height:m})}this.image=a,this.iconPositions=n,this.patternPositions=r};xu.prototype.addImages=function(t,e,n){for(var r in t){var i=t[r],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(o),e[r]=new gu(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}},xu.prototype.patchUpdatedImages=function(t,e){for(var n in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)},xu.prototype.patchUpdatedImage=function(t,e,n){if(t&&e&&t.version!==e.version){t.version=e.version;var r=t.tl;n.update(e.data,void 0,{x:r[0],y:r[1]})}},Fr("ImagePosition",gu),Fr("ImageAtlas",xu);var bu={horizontal:1,vertical:2,horizontalOnly:3},wu=function(){this.scale=1,this.fontStack="",this.imageName=null};wu.forText=function(t,e){var n=new wu;return n.scale=t||1,n.fontStack=e,n},wu.forImage=function(t){var e=new wu;return e.imageName=t,e};var Su=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Eu(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v){var m,y=Su.fromFeature(t,i);h===bu.vertical&&y.verticalizePunctuation();var g=ai.processBidirectionalText,_=ai.processStyledBidirectionalText;if(g&&1===y.sections.length){m=[];for(var x=0,b=g(y.toString(),Pu(y,l,o,e,r,f,d));x<b.length;x+=1){var w=b[x],S=new Su;S.text=w,S.sections=y.sections;for(var E=0;E<w.length;E++)S.sectionIndex.push(0);m.push(S)}}else if(_){m=[];for(var A=0,T=_(y.text,y.sectionIndex,Pu(y,l,o,e,r,f,d));A<T.length;A+=1){var C=T[A],k=new Su;k.text=C[0],k.sectionIndex=C[1],k.sections=y.sections,m.push(k)}}else m=function(t,e){for(var n=[],r=t.text,i=0,o=0,a=e;o<a.length;o+=1){var s=a[o];n.push(t.substring(i,s)),i=s}return i<r.length&&n.push(t.substring(i,r.length)),n}(y,Pu(y,l,o,e,r,f,d));var M=[],I={positionedLines:M,text:y.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,n,r,i,o,a,s,u,l,c,h){for(var p=0,f=-17,d=0,v=0,m="right"===s?1:"left"===s?0:.5,y=0,g=0,_=i;g<_.length;g+=1){var x=_[g];x.trim();var b=x.getMaxScale(),w=24*(b-1),S={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=S;var E=S.positionedGlyphs,A=0;if(x.length()){for(var T=0;T<x.length();T++){var C=x.getSection(T),k=x.getSectionIndex(T),M=x.getCharCode(T),I=0,P=null,L=null,R=null,O=24,D=!(u===bu.horizontal||!c&&!qr(M)||c&&(Au[M]||(H=M,Wr.Arabic(H)||Wr["Arabic Supplement"](H)||Wr["Arabic Extended-A"](H)||Wr["Arabic Presentation Forms-A"](H)||Wr["Arabic Presentation Forms-B"](H))));if(C.imageName){var N=r[C.imageName];if(!N)continue;R=C.imageName,t.iconsInText=t.iconsInText||!0,L=N.paddedRect;var z=N.displaySize;C.scale=24*C.scale/h,I=w+(24-z[1]*C.scale),O=(P={width:z[0],height:z[1],left:1,top:-3,advance:D?z[1]:z[0]}).advance;var F=D?z[0]*C.scale-24*b:z[1]*C.scale-24*b;F>0&&F>A&&(A=F)}else{var B=n[C.fontStack],U=B&&B[M];if(U&&U.rect)L=U.rect,P=U.metrics;else{var j=e[C.fontStack],V=j&&j[M];if(!V)continue;P=V.metrics}I=24*(b-C.scale)}D?(t.verticalizable=!0,E.push({glyph:M,imageName:R,x:p,y:f+I,vertical:D,scale:C.scale,fontStack:C.fontStack,sectionIndex:k,metrics:P,rect:L}),p+=O*C.scale+l):(E.push({glyph:M,imageName:R,x:p,y:f+I,vertical:D,scale:C.scale,fontStack:C.fontStack,sectionIndex:k,metrics:P,rect:L}),p+=P.advance*C.scale+l)}0!==E.length&&(d=Math.max(p-l,d),Ru(E,0,E.length-1,m,A)),p=0;var G=o*b+A;S.lineOffset=Math.max(A,w),f+=G,v=Math.max(G,v),++y}else f+=o,++y}var H,W=f- -17,Z=Lu(a),q=Z.horizontalAlign,X=Z.verticalAlign;(function(t,e,n,r,i,o,a,s,u){var l,c=(e-n)*i;l=o!==a?-s*r- -17:(-r*u+.5)*a;for(var h=0,p=t;h<p.length;h+=1)for(var f=0,d=p[h].positionedGlyphs;f<d.length;f+=1){var v=d[f];v.x+=c,v.y+=l}})(t.positionedLines,m,q,X,d,v,o,W,i.length),t.top+=-X*W,t.bottom=t.top+W,t.left+=-q*d,t.right=t.left+d}(I,e,n,r,m,a,s,u,h,l,p,v),!function(t){for(var e=0,n=t;e<n.length;e+=1)if(0!==n[e].positionedGlyphs.length)return!1;return!0}(M)&&I}Su.fromFeature=function(t,e){for(var n=new Su,r=0;r<t.sections.length;r++){var i=t.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,e)}return n},Su.prototype.length=function(){return this.text.length},Su.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Su.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Su.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Su.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n+1)||null,i=t.charCodeAt(n-1)||null;e+=r&&Xr(r)&&!qs[t[n+1]]||i&&Xr(i)&&!qs[t[n-1]]||!qs[t[n]]?t[n]:qs[t[n]]}return e}(this.text)},Su.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Au[this.text.charCodeAt(e)];e++)t++;for(var n=this.text.length,r=this.text.length-1;r>=0&&r>=t&&Au[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)},Su.prototype.substring=function(t,e){var n=new Su;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n},Su.prototype.toString=function(){return this.text},Su.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,n){return Math.max(e,t.sections[n].scale)}),0)},Su.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(wu.forText(t.scale,t.fontStack||e));for(var n=this.sections.length-1,r=0;r<t.text.length;++r)this.sectionIndex.push(n)},Su.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(wu.forImage(e)),this.sectionIndex.push(this.sections.length-1)):S("Reached maximum number of images 6401")}else S("Can't add FormattedSection with an empty image.")},Su.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Au={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Tu={};function Cu(t,e,n,r,i,o){if(e.imageName){var a=r[e.imageName];return a?a.displaySize[0]*e.scale*24/o+i:0}var s=n[e.fontStack],u=s&&s[t];return u?u.metrics.advance*e.scale+i:0}function ku(t,e,n,r){var i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(n)*n}function Mu(t,e,n){var r=0;return 10===t&&(r-=1e4),n&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Iu(t,e,n,r,i,o){for(var a=null,s=ku(e,n,i,o),u=0,l=r;u<l.length;u+=1){var c=l[u],h=ku(e-c.x,n,i,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function Pu(t,e,n,r,i,o,a){if("point"!==o)return[];if(!t)return[];for(var s,u=[],l=function(t,e,n,r,i,o){for(var a=0,s=0;s<t.length();s++){var u=t.getSection(s);a+=Cu(t.getCharCode(s),u,r,i,e,o)}return a/Math.max(1,Math.ceil(a/n))}(t,e,n,r,i,a),c=t.text.indexOf("​")>=0,h=0,p=0;p<t.length();p++){var f=t.getSection(p),d=t.getCharCode(p);if(Au[d]||(h+=Cu(d,f,r,i,e,a)),p<t.length()-1){var v=!((s=d)<11904||!(Wr["Bopomofo Extended"](s)||Wr.Bopomofo(s)||Wr["CJK Compatibility Forms"](s)||Wr["CJK Compatibility Ideographs"](s)||Wr["CJK Compatibility"](s)||Wr["CJK Radicals Supplement"](s)||Wr["CJK Strokes"](s)||Wr["CJK Symbols and Punctuation"](s)||Wr["CJK Unified Ideographs Extension A"](s)||Wr["CJK Unified Ideographs"](s)||Wr["Enclosed CJK Letters and Months"](s)||Wr["Halfwidth and Fullwidth Forms"](s)||Wr.Hiragana(s)||Wr["Ideographic Description Characters"](s)||Wr["Kangxi Radicals"](s)||Wr["Katakana Phonetic Extensions"](s)||Wr.Katakana(s)||Wr["Vertical Forms"](s)||Wr["Yi Radicals"](s)||Wr["Yi Syllables"](s)));(Tu[d]||v||f.imageName)&&u.push(Iu(p+1,h,l,u,Mu(d,t.getCharCode(p+1),v&&c),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Iu(t.length(),h,l,u,0,!0))}function Lu(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Ru(t,e,n,r,i){if(r||i)for(var o=t[n],a=(t[n].x+o.metrics.advance*o.scale)*r,s=e;s<=n;s++)t[s].x-=a,t[s].y+=i}function Ou(t,e,n,r,i,o){var a,s=t.image;if(s.content){var u=s.content,l=s.pixelRatio||1;a=[u[0]/l,u[1]/l,s.displaySize[0]-u[2]/l,s.displaySize[1]-u[3]/l]}var c,h,p,f,d=e.left*o,v=e.right*o;"width"===n||"both"===n?(f=i[0]+d-r[3],h=i[0]+v+r[1]):h=(f=i[0]+(d+v-s.displaySize[0])/2)+s.displaySize[0];var m=e.top*o,y=e.bottom*o;return"height"===n||"both"===n?(c=i[1]+m-r[0],p=i[1]+y+r[2]):p=(c=i[1]+(m+y-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:h,bottom:p,left:f,collisionPadding:a}}Tu[10]=!0,Tu[32]=!0,Tu[38]=!0,Tu[40]=!0,Tu[41]=!0,Tu[43]=!0,Tu[45]=!0,Tu[47]=!0,Tu[173]=!0,Tu[183]=!0,Tu[8203]=!0,Tu[8208]=!0,Tu[8211]=!0,Tu[8231]=!0;var Du=function(t){function e(e,n,r,i){t.call(this,e,n),this.angle=r,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(i);function Nu(t,e){var n=e.expression;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new si(t+1))};if("source"===n.kind)return{kind:"source"};for(var r=n.zoomStops,i=n.interpolationType,o=0;o<r.length&&r[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<r.length&&r[a]<t+1;)a++;a=Math.min(r.length-1,a);var s=r[o],u=r[a];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:n.evaluate(new si(s)),maxSize:n.evaluate(new si(u)),interpolationType:i}}function zu(t,e,n){var r=e.uSize,i=n.lowerSize;return"source"===t.kind?i/128:"composite"===t.kind?He(i/128,n.upperSize/128,e.uSizeT):r}function Fu(t,e){var n=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){var i=t.interpolationType,o=i?c(an.interpolationFactor(i,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?r=He(t.minSize,t.maxSize,o):n=o}return{uSizeT:n,uSize:r}}Fr("Anchor",Du);var Bu=Object.freeze({__proto__:null,getSizeData:Nu,evaluateSizeForFeature:zu,evaluateSizeForZoom:Fu,SIZE_PACK_FACTOR:128});function Uu(t,e,n,r,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-n/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var u=[],l=0;s<n/2;){var c=t[a],h=t[a+1];if(!h)return!1;var p=t[a-1].angleTo(c)-c.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:p}),l+=p;s-u[0].distance>r;)l-=u.shift().angleDelta;if(l>i)return!1;a++,s+=c.dist(h)}return!0}function ju(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Vu(t,e,n){return t?.6*e*n:0}function Gu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Hu(t,e,n,r,i,o){for(var a=Vu(n,i,o),s=Gu(n,r)*o,u=0,l=ju(t)/2,c=0;c<t.length-1;c++){var h=t[c],p=t[c+1],f=h.dist(p);if(u+f>l){var d=(l-u)/f,v=He(h.x,p.x,d),m=He(h.y,p.y,d),y=new Du(v,m,p.angleTo(h),c);return y._round(),!a||Uu(t,y,s,a,e)?y:void 0}u+=f}}function Wu(t,e,n,r,i,o,a,s,u){var l=Vu(r,o,a),c=Gu(r,i),h=c*a,p=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,n,r,i,o,a,s,u,l){for(var c=a/2,h=ju(e),p=0,f=n-r,d=[],v=0;v<e.length-1;v++){for(var m=e[v],y=e[v+1],g=m.dist(y),_=y.angleTo(m);f+r<p+g;){var x=((f+=r)-p)/g,b=He(m.x,y.x,x),w=He(m.y,y.y,x);if(b>=0&&b<l&&w>=0&&w<l&&f-c>=0&&f+c<=h){var S=new Du(b,w,_,v);S._round(),i&&!Uu(e,S,a,i,o)||d.push(S)}}p+=g}return u||d.length||s||(d=t(e,p/2,r,i,o,a,s,!0,l)),d}(t,p?e/2*s%e:(c/2+2*o)*a*s%e,e,l,n,h,p,!1,u)}function Zu(t,e,n,r,o){for(var a=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,c=0;c<u.length-1;c++){var h=u[c],p=u[c+1];h.x<e&&p.x<e||(h.x<e?h=new i(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<e&&(p=new i(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<n&&p.y<n||(h.y<n?h=new i(h.x+(n-h.y)/(p.y-h.y)*(p.x-h.x),n)._round():p.y<n&&(p=new i(h.x+(n-h.y)/(p.y-h.y)*(p.x-h.x),n)._round()),h.x>=r&&p.x>=r||(h.x>=r?h=new i(r,h.y+(r-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=r&&(p=new i(r,h.y+(r-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=o&&p.y>=o||(h.y>=o?h=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round():p.y>=o&&(p=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round()),l&&h.equals(l[l.length-1])||a.push(l=[h]),l.push(p)))))}return a}function qu(t,e,n,r){var o=[],a=t.image,s=a.pixelRatio,u=a.paddedRect.w-2,l=a.paddedRect.h-2,c=t.right-t.left,h=t.bottom-t.top,p=a.stretchX||[[0,u]],f=a.stretchY||[[0,l]],d=function(t,e){return t+e[1]-e[0]},v=p.reduce(d,0),m=f.reduce(d,0),y=u-v,g=l-m,_=0,x=v,b=0,w=m,S=0,E=y,A=0,T=g;if(a.content&&r){var C=a.content;_=Xu(p,0,C[0]),b=Xu(f,0,C[1]),x=Xu(p,C[0],C[2]),w=Xu(f,C[1],C[3]),S=C[0]-_,A=C[1]-b,E=C[2]-C[0]-x,T=C[3]-C[1]-w}var k=function(r,o,u,l){var p=Ku(r.stretch-_,x,c,t.left),f=Qu(r.fixed-S,E,r.stretch,v),d=Ku(o.stretch-b,w,h,t.top),y=Qu(o.fixed-A,T,o.stretch,m),g=Ku(u.stretch-_,x,c,t.left),C=Qu(u.fixed-S,E,u.stretch,v),k=Ku(l.stretch-b,w,h,t.top),M=Qu(l.fixed-A,T,l.stretch,m),I=new i(p,d),P=new i(g,d),L=new i(g,k),R=new i(p,k),O=new i(f/s,y/s),D=new i(C/s,M/s),N=e*Math.PI/180;if(N){var z=Math.sin(N),F=Math.cos(N),B=[F,-z,z,F];I._matMult(B),P._matMult(B),R._matMult(B),L._matMult(B)}var U=r.stretch+r.fixed,j=o.stretch+o.fixed;return{tl:I,tr:P,bl:R,br:L,tex:{x:a.paddedRect.x+1+U,y:a.paddedRect.y+1+j,w:u.stretch+u.fixed-U,h:l.stretch+l.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:D,minFontScaleX:E/s/c,minFontScaleY:T/s/h,isSDF:n}};if(r&&(a.stretchX||a.stretchY))for(var M=Yu(p,y,v),I=Yu(f,g,m),P=0;P<M.length-1;P++)for(var L=M[P],R=M[P+1],O=0;O<I.length-1;O++)o.push(k(L,I[O],R,I[O+1]));else o.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:l+1}));return o}function Xu(t,e,n){for(var r=0,i=0,o=t;i<o.length;i+=1){var a=o[i];r+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]))}return r}function Yu(t,e,n){for(var r=[{fixed:-1,stretch:0}],i=0,o=t;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],l=r[r.length-1];r.push({fixed:s-l.stretch,stretch:l.stretch}),r.push({fixed:s-l.stretch,stretch:l.stretch+(u-s)})}return r.push({fixed:e+1,stretch:n}),r}function Ku(t,e,n,r){return t/e*n+r}function Qu(t,e,n,r){return t-e*n/r}var Ju=function(t,e,n,r,o,a,s,u,l,c){if(this.boxStartIndex=t.length,l){var h=a.top,p=a.bottom,f=a.collisionPadding;f&&(h-=f[1],p+=f[3]);var d=p-h;d>0&&(d=Math.max(10,d),this.circleDiameter=d)}else{var v=a.top*s-u,m=a.bottom*s+u,y=a.left*s-u,g=a.right*s+u,_=a.collisionPadding;if(_&&(y-=_[0]*s,v-=_[1]*s,g+=_[2]*s,m+=_[3]*s),c){var x=new i(y,v),b=new i(g,v),w=new i(y,m),S=new i(g,m),E=c*Math.PI/180;x._rotate(E),b._rotate(E),w._rotate(E),S._rotate(E),y=Math.min(x.x,b.x,w.x,S.x),g=Math.max(x.x,b.x,w.x,S.x),v=Math.min(x.y,b.y,w.y,S.y),m=Math.max(x.y,b.y,w.y,S.y)}t.emplaceBack(e.x,e.y,y,v,g,m,n,r,o)}this.boxEndIndex=t.length},$u=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=tl),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function tl(t,e){return t<e?-1:t>e?1:0}function el(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var r=1/0,o=1/0,a=-1/0,s=-1/0,u=t[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<r)&&(r=c.x),(!l||c.y<o)&&(o=c.y),(!l||c.x>a)&&(a=c.x),(!l||c.y>s)&&(s=c.y)}var h=Math.min(a-r,s-o),p=h/2,f=new $u([],nl);if(0===h)return new i(r,o);for(var d=r;d<a;d+=h)for(var v=o;v<s;v+=h)f.push(new rl(d+p,v+p,p,t));for(var m=function(t){for(var e=0,n=0,r=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],l=i[s],c=u.x*l.y-l.x*u.y;n+=(u.x+l.x)*c,r+=(u.y+l.y)*c,e+=3*c}return new rl(n/e,r/e,0,t)}(t),y=f.length;f.length;){var g=f.pop();(g.d>m.d||!m.d)&&(m=g,n&&console.log("found best %d after %d probes",Math.round(1e4*g.d)/1e4,y)),g.max-m.d<=e||(f.push(new rl(g.p.x-(p=g.h/2),g.p.y-p,p,t)),f.push(new rl(g.p.x+p,g.p.y-p,p,t)),f.push(new rl(g.p.x-p,g.p.y+p,p,t)),f.push(new rl(g.p.x+p,g.p.y+p,p,t)),y+=4)}return n&&(console.log("num probes: "+y),console.log("best distance: "+m.d)),m.p}function nl(t,e){return e.max-t.max}function rl(t,e,n,r){this.p=new i(t,e),this.h=n,this.d=function(t,e){for(var n=!1,r=1/0,i=0;i<e.length;i++)for(var o=e[i],a=0,s=o.length,u=s-1;a<s;u=a++){var l=o[a],c=o[u];l.y>t.y!=c.y>t.y&&t.x<(c.x-l.x)*(t.y-l.y)/(c.y-l.y)+l.x&&(n=!n),r=Math.min(r,Qo(t,l,c))}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}$u.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},$u.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},$u.prototype.peek=function(){return this.data[0]},$u.prototype._up=function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r},$u.prototype._down=function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i};var il=Number.POSITIVE_INFINITY;function ol(t,e){return e[1]!==il?function(t,e,n){var r=0,i=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,i]}(t,e[0],e[1]):function(t,e){var n=0,r=0;e<0&&(e=0);var i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-e;break;case"top":r=e-7}switch(t){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=e;break;case"right":n=-e}return[n,r]}(t,e[0])}function al(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sl(t,e,n,r,o,a,s,u,l,c,h,p,f,d,v){var m=function(t,e,n,r,o,a,s,u){for(var l=r.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=[],h=0,p=e.positionedLines;h<p.length;h+=1)for(var f=p[h],d=0,v=f.positionedGlyphs;d<v.length;d+=1){var m=v[d];if(m.rect){var y=m.rect||{},g=4,_=!0,x=1,b=0,w=(o||u)&&m.vertical,S=m.metrics.advance*m.scale/2;if(u&&e.verticalizable&&(b=f.lineOffset/2-(m.imageName?-(24-m.metrics.width*m.scale)/2:24*(m.scale-1))),m.imageName){var E=s[m.imageName];_=E.sdf,g=1/(x=E.pixelRatio)}var A=o?[m.x+S,m.y]:[0,0],T=o?[0,0]:[m.x+S+n[0],m.y+n[1]-b],C=[0,0];w&&(C=T,T=[0,0]);var k=(m.metrics.left-g)*m.scale-S+T[0],M=(-m.metrics.top-g)*m.scale+T[1],I=k+y.w*m.scale/x,P=M+y.h*m.scale/x,L=new i(k,M),R=new i(I,M),O=new i(k,P),D=new i(I,P);if(w){var N=new i(-S,S- -17),z=-Math.PI/2,F=12-S,B=new i(22-F,-(m.imageName?F:0)),U=new(Function.prototype.bind.apply(i,[null].concat(C)));L._rotateAround(z,N)._add(B)._add(U),R._rotateAround(z,N)._add(B)._add(U),O._rotateAround(z,N)._add(B)._add(U),D._rotateAround(z,N)._add(B)._add(U)}if(l){var j=Math.sin(l),V=Math.cos(l),G=[V,-j,j,V];L._matMult(G),R._matMult(G),O._matMult(G),D._matMult(G)}var H=new i(0,0),W=new i(0,0);c.push({tl:L,tr:R,bl:O,br:D,tex:y,writingMode:e.writingMode,glyphOffset:A,sectionIndex:m.sectionIndex,isSDF:_,pixelOffsetTL:H,pixelOffsetBR:W,minFontScaleX:0,minFontScaleY:0})}}return c}(0,n,u,o,a,s,r,t.allowVerticalPlacement),y=t.textSizeData,g=null;"source"===y.kind?(g=[128*o.layout.get("text-size").evaluate(s,{})])[0]>32640&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===y.kind&&((g=[128*d.compositeTextSizes[0].evaluate(s,{},v),128*d.compositeTextSizes[1].evaluate(s,{},v)])[0]>32640||g[1]>32640)&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,m,g,u,a,s,c,e,l.lineStartIndex,l.lineLength,f,v);for(var _=0,x=h;_<x.length;_+=1)p[x[_]]=t.text.placedSymbolArray.length-1;return 4*m.length}function ul(t){for(var e in t)return t[e];return null}function ll(t,e,n,r){var i=t.compareText;if(e in i){for(var o=i[e],a=o.length-1;a>=0;a--)if(r.dist(o[a])<n)return!0}else i[e]=[];return i[e].push(r),!1}var cl=xs.VectorTileFeature.types,hl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pl(t,e,n,r,i,o,a,s,u,l,c,h,p){var f=s?Math.min(32640,Math.round(s[0])):0,d=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,n,Math.round(32*r),Math.round(32*i),o,a,(f<<1)+(u?1:0),d,16*l,16*c,256*h,256*p)}function fl(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function dl(t){for(var e=0,n=t.sections;e<n.length;e+=1)if(Qr(n[e].text))return!0;return!1}var vl=function(t){this.layoutVertexArray=new Oi,this.indexArray=new ji,this.programConfigurations=t,this.segments=new so,this.dynamicLayoutVertexArray=new Di,this.opacityVertexArray=new Ni,this.placedSymbolArray=new $i};vl.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},vl.prototype.upload=function(t,e,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,js.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Vs.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,hl,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(t))},vl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Fr("SymbolBuffers",vl);var ml=function(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new so,this.collisionVertexArray=new Ui};ml.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Gs.members,!0)},ml.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Fr("CollisionBuffers",ml);var yl=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sa([]),this.placementViewportMatrix=sa([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nu(this.zoom,e["text-size"]),this.iconSizeData=Nu(this.zoom,e["icon-size"]);var n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((function(t){return bu[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};yl.prototype.createArrays=function(){this.text=new vl(new Do(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new vl(new Do(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new no,this.lineVertexArray=new ro,this.symbolInstances=new eo},yl.prototype.calculateGlyphDependencies=function(t,e,n,r,i){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(n||r)&&i){var a=qs[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},yl.prototype.populate=function(t,e,n){var r=this.layers[0],i=r.layout,o=i.get("text-font"),a=i.get("text-field"),s=i.get("icon-image"),u=("constant"!==a.value.kind||a.value.value instanceof re&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),l="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,c=i.get("symbol-sort-key");if(this.features=[],u||l){for(var h=e.iconDependencies,p=e.glyphDependencies,f=e.availableImages,d=new si(this.zoom),v=0,m=t;v<m.length;v+=1){var y=m[v],g=y.feature,_=y.id,x=y.index,b=y.sourceLayerIndex,w=r._featureFilter.needGeometry,S=jo(g,w);if(r._featureFilter.filter(d,S,n)){w||(S.geometry=Uo(g));var E=void 0;if(u){var A=r.getValueAndResolveTokens("text-field",S,n,f),T=re.factory(A);dl(T)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ii()||this.hasRTLText&&ai.isParsed())&&(E=Zs(T,r,S))}var C=void 0;if(l){var k=r.getValueAndResolveTokens("icon-image",S,n,f);C=k instanceof ie?k:ie.fromString(k)}if(E||C){var M=this.sortFeaturesByKey?c.evaluate(S,{},n):void 0;if(this.features.push({id:_,text:E,icon:C,index:x,sourceLayerIndex:b,geometry:S.geometry,properties:g.properties,type:cl[g.type],sortKey:M}),C&&(h[C.name]=!0),E){var I=o.evaluate(S,{},n).join(","),P="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bu.vertical)>=0;for(var L=0,R=E.sections;L<R.length;L+=1){var O=R[L];if(O.image)h[O.image.name]=!0;else{var D=Zr(E.toString()),N=O.fontStack||I,z=p[N]=p[N]||{};this.calculateGlyphDependencies(O.text,z,P,this.allowVerticalPlacement,D)}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},n={},r=[],i=0;function o(e){r.push(t[e]),i++}function a(t,e,i){var o=n[t];return delete n[t],n[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function s(t,n,i){var o=e[n];return delete e[n],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function u(t,e,n){var r=n?e[0][e[0].length-1]:e[0][0];return t+":"+r.x+":"+r.y}for(var l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.text?c.text.toString():null;if(p){var f=u(p,h),d=u(p,h,!0);if(f in n&&d in e&&n[f]!==e[d]){var v=s(f,d,h),m=a(f,d,r[v].geometry);delete e[f],delete n[d],n[u(p,r[m].geometry,!0)]=m,r[v].geometry=null}else f in n?a(f,d,h):d in e?s(f,d,h):(o(l),e[f]=i-1,n[d]=i-1)}else o(l)}return r.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},yl.prototype.update=function(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))},yl.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},yl.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},yl.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},yl.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},yl.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},yl.prototype.addToLineVertexArray=function(t,e){var n=this.lineVertexArray.length;if(void 0!==t.segment){for(var r=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:r},a<e.length-1&&(r+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=o[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},yl.prototype.addSymbols=function(t,e,n,r,i,o,a,s,u,l,c,h){for(var p=t.indexArray,f=t.layoutVertexArray,d=t.segments.prepareSegment(4*e.length,f,p,this.canOverlap?o.sortKey:void 0),v=this.glyphOffsetArray.length,m=d.vertexLength,y=this.allowVerticalPlacement&&a===bu.vertical?Math.PI/2:0,g=o.text&&o.text.sections,_=0;_<e.length;_++){var x=e[_],b=x.tl,w=x.tr,S=x.bl,E=x.br,A=x.tex,T=x.pixelOffsetTL,C=x.pixelOffsetBR,k=x.minFontScaleX,M=x.minFontScaleY,I=x.glyphOffset,P=x.isSDF,L=x.sectionIndex,R=d.vertexLength,O=I[1];pl(f,s.x,s.y,b.x,O+b.y,A.x,A.y,n,P,T.x,T.y,k,M),pl(f,s.x,s.y,w.x,O+w.y,A.x+A.w,A.y,n,P,C.x,T.y,k,M),pl(f,s.x,s.y,S.x,O+S.y,A.x,A.y+A.h,n,P,T.x,C.y,k,M),pl(f,s.x,s.y,E.x,O+E.y,A.x+A.w,A.y+A.h,n,P,C.x,C.y,k,M),fl(t.dynamicLayoutVertexArray,s,y),p.emplaceBack(R,R+1,R+2),p.emplaceBack(R+1,R+2,R+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(I[0]),_!==e.length-1&&L===e[_+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,o,o.index,{},h,g&&g[L])}t.placedSymbolArray.emplaceBack(s.x,s.y,v,this.glyphOffsetArray.length-v,m,u,l,s.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],a,0,!1,0,c)},yl.prototype._addCollisionDebugVertex=function(t,e,n,r,i,o){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,r,i,Math.round(o.x),Math.round(o.y))},yl.prototype.addCollisionDebugVertices=function(t,e,n,r,o,a,s){var u=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),l=u.vertexLength,c=o.layoutVertexArray,h=o.collisionVertexArray,p=s.anchorX,f=s.anchorY;this._addCollisionDebugVertex(c,h,a,p,f,new i(t,e)),this._addCollisionDebugVertex(c,h,a,p,f,new i(n,e)),this._addCollisionDebugVertex(c,h,a,p,f,new i(n,r)),this._addCollisionDebugVertex(c,h,a,p,f,new i(t,r)),u.vertexLength+=4;var d=o.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),u.primitiveLength+=4},yl.prototype.addDebugCollisionBoxes=function(t,e,n,r){for(var i=t;i<e;i++){var o=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,r?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,n)}},yl.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ml(Fi,Hs.members,qi),this.iconCollisionBox=new ml(Fi,Hs.members,qi);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},yl.prototype._deserializeCollisionBoxesForSymbol=function(t,e,n,r,i,o,a,s,u){for(var l={},c=e;c<n;c++){var h=t.get(c);l.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},l.textFeatureIndex=h.featureIndex;break}for(var p=r;p<i;p++){var f=t.get(p);l.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},l.verticalTextFeatureIndex=f.featureIndex;break}for(var d=o;d<a;d++){var v=t.get(d);l.iconBox={x1:v.x1,y1:v.y1,x2:v.x2,y2:v.y2,anchorPointX:v.anchorPointX,anchorPointY:v.anchorPointY},l.iconFeatureIndex=v.featureIndex;break}for(var m=s;m<u;m++){var y=t.get(m);l.verticalIconBox={x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2,anchorPointX:y.anchorPointX,anchorPointY:y.anchorPointY},l.verticalIconFeatureIndex=y.featureIndex;break}return l},yl.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}},yl.prototype.hasTextData=function(){return this.text.segments.get().length>0},yl.prototype.hasIconData=function(){return this.icon.segments.get().length>0},yl.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},yl.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},yl.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},yl.prototype.addIndicesForPlacedSymbol=function(t,e){for(var n=t.placedSymbolArray.get(e),r=n.vertexStartIndex+4*n.numGlyphs,i=n.vertexStartIndex;i<r;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)},yl.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),n=Math.cos(t),r=[],i=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);r.push(0|Math.round(e*s.anchorX+n*s.anchorY)),i.push(s.featureIndex)}return o.sort((function(t,e){return r[t]-r[e]||i[e]-i[t]})),o},yl.prototype.addToSortKeyRanges=function(t,e){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},yl.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var n=0,r=this.symbolInstanceIndexes;n<r.length;n+=1){var i=this.symbolInstances.get(r[n]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((function(t,n,r){t>=0&&r.indexOf(t)===n&&e.addIndicesForPlacedSymbol(e.text,t)})),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Fr("SymbolBucket",yl,{omit:["layers","collisionBoxArray","features","compareText"]}),yl.MAX_GLYPHS=65535,yl.addDynamicAttributes=fl;var gl=new bi({"symbol-placement":new mi(Mt.layout_symbol["symbol-placement"]),"symbol-spacing":new mi(Mt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mi(Mt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yi(Mt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mi(Mt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mi(Mt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new mi(Mt.layout_symbol["icon-ignore-placement"]),"icon-optional":new mi(Mt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mi(Mt.layout_symbol["icon-rotation-alignment"]),"icon-size":new yi(Mt.layout_symbol["icon-size"]),"icon-text-fit":new mi(Mt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mi(Mt.layout_symbol["icon-text-fit-padding"]),"icon-image":new yi(Mt.layout_symbol["icon-image"]),"icon-rotate":new yi(Mt.layout_symbol["icon-rotate"]),"icon-padding":new mi(Mt.layout_symbol["icon-padding"]),"icon-keep-upright":new mi(Mt.layout_symbol["icon-keep-upright"]),"icon-offset":new yi(Mt.layout_symbol["icon-offset"]),"icon-anchor":new yi(Mt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mi(Mt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mi(Mt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mi(Mt.layout_symbol["text-rotation-alignment"]),"text-field":new yi(Mt.layout_symbol["text-field"]),"text-font":new yi(Mt.layout_symbol["text-font"]),"text-size":new yi(Mt.layout_symbol["text-size"]),"text-max-width":new yi(Mt.layout_symbol["text-max-width"]),"text-line-height":new mi(Mt.layout_symbol["text-line-height"]),"text-letter-spacing":new yi(Mt.layout_symbol["text-letter-spacing"]),"text-justify":new yi(Mt.layout_symbol["text-justify"]),"text-radial-offset":new yi(Mt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mi(Mt.layout_symbol["text-variable-anchor"]),"text-anchor":new yi(Mt.layout_symbol["text-anchor"]),"text-max-angle":new mi(Mt.layout_symbol["text-max-angle"]),"text-writing-mode":new mi(Mt.layout_symbol["text-writing-mode"]),"text-rotate":new yi(Mt.layout_symbol["text-rotate"]),"text-padding":new mi(Mt.layout_symbol["text-padding"]),"text-keep-upright":new mi(Mt.layout_symbol["text-keep-upright"]),"text-transform":new yi(Mt.layout_symbol["text-transform"]),"text-offset":new yi(Mt.layout_symbol["text-offset"]),"text-allow-overlap":new mi(Mt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new mi(Mt.layout_symbol["text-ignore-placement"]),"text-optional":new mi(Mt.layout_symbol["text-optional"])}),_l={paint:new bi({"icon-opacity":new yi(Mt.paint_symbol["icon-opacity"]),"icon-color":new yi(Mt.paint_symbol["icon-color"]),"icon-halo-color":new yi(Mt.paint_symbol["icon-halo-color"]),"icon-halo-width":new yi(Mt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yi(Mt.paint_symbol["icon-halo-blur"]),"icon-translate":new mi(Mt.paint_symbol["icon-translate"]),"icon-translate-anchor":new mi(Mt.paint_symbol["icon-translate-anchor"]),"text-opacity":new yi(Mt.paint_symbol["text-opacity"]),"text-color":new yi(Mt.paint_symbol["text-color"],{runtimeType:jt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new yi(Mt.paint_symbol["text-halo-color"]),"text-halo-width":new yi(Mt.paint_symbol["text-halo-width"]),"text-halo-blur":new yi(Mt.paint_symbol["text-halo-blur"]),"text-translate":new mi(Mt.paint_symbol["text-translate"]),"text-translate-anchor":new mi(Mt.paint_symbol["text-translate-anchor"])}),layout:gl},xl=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:zt,this.defaultValue=t};xl.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},xl.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},xl.prototype.outputDefined=function(){return!1},xl.prototype.serialize=function(){return null},Fr("FormatSectionOverride",xl,{omit:["defaultValue"]});var bl=function(t){function e(e){t.call(this,e,_l)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){if(t.prototype.recalculate.call(this,e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var r=this.layout.get("text-writing-mode");if(r){for(var i=[],o=0,a=r;o<a.length;o+=1){var s=a[o];i.indexOf(s)<0&&i.push(s)}this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,n,r){var i=this.layout.get(t).evaluate(e,{},n,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||Zn(o.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,n){return n in t?String(t[n]):""}))}(e.properties,i)},e.prototype.createBucket=function(t){return new yl(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,n=_l.paint.overridableProperties;t<n.length;t+=1){var r=n[t];if(e.hasPaintOverride(this.layout,r)){var i,o=this.paint.get(r),a=new xl(o),s=new Wn(a,o.property.specification);i="constant"===o.value.kind||"source"===o.value.kind?new Xn("source",s):new Yn("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new di(o.property,i,o.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var n=t.get("text-field"),r=_l.paint.properties[e],i=!1,o=function(t){for(var e=0,n=t;e<n.length;e+=1)if(r.overrides&&r.overrides.hasOverride(n[e]))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof re)o(n.value.value.sections);else if("source"===n.value.kind){var a=function(t){i||(t instanceof le&&se(t.value)===Wt?o(t.value.sections):t instanceof fe?o(t.sections):t.eachChild(a))},s=n.value;s._styleExpression&&a(s._styleExpression.expression)}return i},e}(wi),wl={paint:new bi({"background-color":new mi(Mt.paint_background["background-color"]),"background-pattern":new _i(Mt.paint_background["background-pattern"]),"background-opacity":new mi(Mt.paint_background["background-opacity"])})},Sl=function(t){function e(e){t.call(this,e,wl)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wi),El={paint:new bi({"raster-opacity":new mi(Mt.paint_raster["raster-opacity"]),"raster-hue-rotate":new mi(Mt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mi(Mt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mi(Mt.paint_raster["raster-brightness-max"]),"raster-saturation":new mi(Mt.paint_raster["raster-saturation"]),"raster-contrast":new mi(Mt.paint_raster["raster-contrast"]),"raster-resampling":new mi(Mt.paint_raster["raster-resampling"]),"raster-fade-duration":new mi(Mt.paint_raster["raster-fade-duration"])})},Al=function(t){function e(e){t.call(this,e,El)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wi),Tl=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(wi),Cl={circle:pa,heatmap:wa,hillshade:Ea,fill:cs,"fill-extrusion":Cs,line:Bs,symbol:bl,background:Sl,raster:Al},kl=a.HTMLImageElement,Ml=a.HTMLCanvasElement,Il=a.HTMLVideoElement,Pl=a.ImageData,Ll=a.ImageBitmap,Rl=function(t,e,n,r){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,r)};Rl.prototype.update=function(t,e,n){var r=t.width,i=t.height,o=!(this.size&&this.size[0]===r&&this.size[1]===i||n),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[r,i],t instanceof kl||t instanceof Ml||t instanceof Il||t instanceof Pl||Ll&&t instanceof Ll?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=n||{x:0,y:0},l=u.x,c=u.y;t instanceof kl||t instanceof Ml||t instanceof Il||t instanceof Pl||Ll&&t instanceof Ll?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,c,r,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Rl.prototype.bind=function(t,e,n){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)},Rl.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Rl.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ol=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};Ol.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},Ol.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Dl=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},y(["receive","process"],this),this.invoker=new Ol(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=T()?t:a};function Nl(t,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}Dl.prototype.send=function(t,e,n,r,i){var o=this;void 0===i&&(i=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[a]=n);var s=M(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:Vr(e,s)},s),{cancel:function(){n&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:r,sourceMapId:o.mapId})}}},Dl.prototype.receive=function(t){var e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[n];var r=this.cancelCallbacks[n];delete this.cancelCallbacks[n],r&&r()}else T()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)},Dl.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Dl.prototype.processTask=function(t,e){var n=this;if("<response>"===e.type){var r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(Gr(e.error)):r(null,Gr(e.data)))}else{var i=!1,o=M(this.globalScope)?void 0:[],a=e.hasCallback?function(e,r){i=!0,delete n.cancelCallbacks[t],n.target.postMessage({id:t,type:"<response>",sourceMapId:n.mapId,error:e?Vr(e):null,data:Vr(r,o)},o)}:function(t){i=!0},s=null,u=Gr(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){var l=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,l[0],u.source)[l[1]](u,a)}else a(new Error("Could not find function "+e.type));!i&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},Dl.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var zl=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};zl.prototype.setNorthEast=function(t){return this._ne=t instanceof Fl?new Fl(t.lng,t.lat):Fl.convert(t),this},zl.prototype.setSouthWest=function(t){return this._sw=t instanceof Fl?new Fl(t.lng,t.lat):Fl.convert(t),this},zl.prototype.extend=function(t){var e,n,r=this._sw,i=this._ne;if(t instanceof Fl)e=t,n=t;else{if(!(t instanceof zl))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(zl.convert(t)):this.extend(Fl.convert(t)):this;if(n=t._ne,!(e=t._sw)||!n)return this}return r||i?(r.lng=Math.min(e.lng,r.lng),r.lat=Math.min(e.lat,r.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new Fl(e.lng,e.lat),this._ne=new Fl(n.lng,n.lat)),this},zl.prototype.getCenter=function(){return new Fl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},zl.prototype.getSouthWest=function(){return this._sw},zl.prototype.getNorthEast=function(){return this._ne},zl.prototype.getNorthWest=function(){return new Fl(this.getWest(),this.getNorth())},zl.prototype.getSouthEast=function(){return new Fl(this.getEast(),this.getSouth())},zl.prototype.getWest=function(){return this._sw.lng},zl.prototype.getSouth=function(){return this._sw.lat},zl.prototype.getEast=function(){return this._ne.lng},zl.prototype.getNorth=function(){return this._ne.lat},zl.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},zl.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},zl.prototype.isEmpty=function(){return!(this._sw&&this._ne)},zl.prototype.contains=function(t){var e=Fl.convert(t),n=e.lng,r=e.lat,i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i},zl.convert=function(t){return!t||t instanceof zl?t:new zl(t)};var Fl=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Fl.prototype.wrap=function(){return new Fl(h(this.lng,-180,180),this.lat)},Fl.prototype.toArray=function(){return[this.lng,this.lat]},Fl.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Fl.prototype.distanceTo=function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(i,1))},Fl.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new zl(new Fl(this.lng-n,this.lat-e),new Fl(this.lng+n,this.lat+e))},Fl.convert=function(t){if(t instanceof Fl)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Fl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Fl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Bl=2*Math.PI*6371008.8;function Ul(t){return Bl*Math.cos(t*Math.PI/180)}function jl(t){return(180+t)/360}function Vl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Gl(t,e){return t/Ul(e)}function Hl(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Wl=function(t,e,n){void 0===n&&(n=0),this.x=+t,this.y=+e,this.z=+n};Wl.fromLngLat=function(t,e){void 0===e&&(e=0);var n=Fl.convert(t);return new Wl(jl(n.lng),Vl(n.lat),Gl(e,n.lat))},Wl.prototype.toLngLat=function(){return new Fl(360*this.x-180,Hl(this.y))},Wl.prototype.toAltitude=function(){return this.z*Ul(Hl(this.y))},Wl.prototype.meterInMercatorCoordinateUnits=function(){return 1/Bl*(t=Hl(this.y),1/Math.cos(t*Math.PI/180));var t};var Zl=function(t,e,n){this.z=t,this.x=e,this.y=n,this.key=Yl(0,t,t,e,n)};Zl.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Zl.prototype.url=function(t,e){var n,r,i,o,a,s=(r=this.y,i=this.z,o=Nl(256*(n=this.x),256*(r=Math.pow(2,i)-r-1),i),a=Nl(256*(n+1),256*(r+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),u=function(t,e,n){for(var r,i="",o=t;o>0;o--)i+=(e&(r=1<<o-1)?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},Zl.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new i(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},Zl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var ql=function(t,e){this.wrap=t,this.canonical=e,this.key=Yl(t,e.z,e.z,e.x,e.y)},Xl=function(t,e,n,r,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Zl(n,+r,+i),this.key=Yl(e,t,n,r,i)};function Yl(t,e,n,r,i){(t*=2)<0&&(t=-1*t-1);var o=1<<n;return(o*o*t+o*i+r).toString(36)+n.toString(36)+e.toString(36)}Xl.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Xl.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Xl(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xl(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Xl.prototype.calculateScaledKey=function(t,e){var n=this.canonical.z-t;return t>this.canonical.z?Yl(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Yl(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)},Xl.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Xl.prototype.children=function(t){if(this.overscaledZ>=t)return[new Xl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Xl(e,this.wrap,e,n,r),new Xl(e,this.wrap,e,n+1,r),new Xl(e,this.wrap,e,n,r+1),new Xl(e,this.wrap,e,n+1,r+1)]},Xl.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Xl.prototype.wrapped=function(){return new Xl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xl.prototype.unwrapTo=function(t){return new Xl(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Xl.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xl.prototype.toUnwrapped=function(){return new ql(this.wrap,this.canonical)},Xl.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xl.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Wl(t.x-this.wrap,t.y))},Fr("CanonicalTileID",Zl),Fr("OverscaledTileID",Xl,{omit:["posMatrix"]});var Kl=function(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return S('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var r=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox";for(var i=0;i<r;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(r,i)]=this.data[this._idx(r-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,r)]=this.data[this._idx(i,r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(r,-1)]=this.data[this._idx(r-1,0)],this.data[this._idx(-1,r)]=this.data[this._idx(0,r-1)],this.data[this._idx(r,r)]=this.data[this._idx(r-1,r-1)]};Kl.prototype.get=function(t,e){var n=new Uint8Array(this.data.buffer),r=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[r],n[r+1],n[r+2])},Kl.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Kl.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Kl.prototype._unpackMapbox=function(t,e,n){return(256*t*256+256*e+n)/10-1e4},Kl.prototype._unpackTerrarium=function(t,e,n){return 256*t+e+n/256-32768},Kl.prototype.getPixels=function(){return new _a({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Kl.prototype.backfillBorder=function(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var r=e*this.dim,i=e*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(e){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,u=-n*this.dim,l=o;l<a;l++)for(var c=r;c<i;c++)this.data[this._idx(c,l)]=t.data[this._idx(c+s,l+u)]},Fr("DEMData",Kl);var Ql=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}};Ql.prototype.encode=function(t){return this._stringToNumber[t]},Ql.prototype.decode=function(t){return this._numberToString[t]};var Jl=function(t,e,n,r,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=r,this.properties=t.properties,this.id=i},$l={geometry:{configurable:!0}};$l.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},$l.geometry.set=function(t){this._geometry=t},Jl.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Jl.prototype,$l);var tc=function(){this.state={},this.stateChanges={},this.deletedStates={}};tc.prototype.updateState=function(t,e,n){var r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},p(this.stateChanges[t][r],n),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==r&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][r])for(var o in this.deletedStates[t][r]={},this.state[t][r])n[o]||(this.deletedStates[t][r][o]=null);else for(var a in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][a]&&delete this.deletedStates[t][r][a]},tc.prototype.removeFeatureState=function(t,e,n){if(null!==this.deletedStates[t]){var r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(n in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][n]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}},tc.prototype.getState=function(t,e){var n=String(e),r=p({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return{};for(var o in i)delete r[o]}return r},tc.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},tc.prototype.coalesceChanges=function(t,e){var n={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var i={};for(var o in this.stateChanges[r])this.state[r][o]||(this.state[r][o]={}),p(this.state[r][o],this.stateChanges[r][o]),i[o]=this.state[r][o];n[r]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var u in this.state[a])s[u]={},this.state[a][u]={};else for(var l in this.deletedStates[a]){if(null===this.deletedStates[a][l])this.state[a][l]={};else for(var c=0,h=Object.keys(this.deletedStates[a][l]);c<h.length;c+=1)delete this.state[a][l][h[c]];s[l]=this.state[a][l]}n[a]=n[a]||{},p(n[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var f in t)t[f].setFeatureState(n,e)};var ec=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Rr(8192,16,0),this.grid3D=new Rr(8192,16,0),this.featureIndexArray=new oo,this.promoteId=e};function nc(t,e,n,r,i){return _(t,(function(t,o){var a=e instanceof vi?e.get(o):null;return a&&a.evaluate?a.evaluate(n,r,i):a}))}function rc(t){for(var e=1/0,n=1/0,r=-1/0,i=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}return{minX:e,minY:n,maxX:r,maxY:i}}function ic(t,e){return e-t}ec.prototype.insert=function(t,e,n,r,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);for(var s=o?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var p=l[h];c[0]=Math.min(c[0],p.x),c[1]=Math.min(c[1],p.y),c[2]=Math.max(c[2],p.x),c[3]=Math.max(c[3],p.y)}c[0]<8192&&c[1]<8192&&c[2]>=0&&c[3]>=0&&s.insert(a,c[0],c[1],c[2],c[3])}},ec.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new xs.VectorTile(new Ks(this.rawTileData)).layers,this.sourceLayerCoder=new Ql(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ec.prototype.query=function(t,e,n,r){var o=this;this.loadVTLayers();for(var a=t.params||{},s=8192/t.tileSize/t.scale,u=ar(a.filter),l=t.queryGeometry,c=t.queryPadding*s,h=rc(l),p=this.grid.query(h.minX-c,h.minY-c,h.maxX+c,h.maxY+c),f=rc(t.cameraQueryGeometry),d=this.grid3D.query(f.minX-c,f.minY-c,f.maxX+c,f.maxY+c,(function(e,n,r,o){return function(t,e,n,r,o){for(var a=0,s=t;a<s.length;a+=1){var u=s[a];if(e<=u.x&&n<=u.y&&r>=u.x&&o>=u.y)return!0}var l=[new i(e,n),new i(e,o),new i(r,o),new i(r,n)];if(t.length>2)for(var c=0,h=l;c<h.length;c+=1)if($o(t,h[c]))return!0;for(var p=0;p<t.length-1;p++)if(ta(t[p],t[p+1],l))return!0;return!1}(t.cameraQueryGeometry,e-c,n-c,r+c,o+c)})),v=0,m=d;v<m.length;v+=1)p.push(m[v]);p.sort(ic);for(var y,g={},_=function(i){var c=p[i];if(c!==y){y=c;var h=o.featureIndexArray.get(c),f=null;o.loadMatchingFeature(g,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,u,a.layers,a.availableImages,e,n,r,(function(e,n,r){return f||(f=Uo(e)),n.queryIntersectsFeature(l,e,r,f,o.z,t.transform,s,t.pixelPosMatrix)}))}},x=0;x<p.length;x++)_(x);return g},ec.prototype.loadMatchingFeature=function(t,e,n,r,i,o,a,s,u,l,c){var h=this.bucketLayerIDs[e];if(!o||function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(o,h)){var f=this.sourceLayerCoder.decode(n),d=this.vtLayers[f].feature(r);if(i.needGeometry){var v=jo(d,!0);if(!i.filter(new si(this.tileID.overscaledZ),v,this.tileID.canonical))return}else if(!i.filter(new si(this.tileID.overscaledZ),d))return;for(var m=this.getId(d,f),y=0;y<h.length;y++){var g=h[y];if(!(o&&o.indexOf(g)<0)){var _=s[g];if(_){var x={};void 0!==m&&l&&(x=l.getState(_.sourceLayer||"_geojsonTileLayer",m));var b=p({},u[g]);b.paint=nc(b.paint,_.paint,d,x,a),b.layout=nc(b.layout,_.layout,d,x,a);var w=!c||c(d,_,x);if(w){var S=new Jl(d,this.z,this.x,this.y,m);S.layer=b;var E=t[g];void 0===E&&(E=t[g]=[]),E.push({featureIndex:r,feature:S,intersectionZ:w})}}}}}},ec.prototype.lookupSymbolFeatures=function(t,e,n,r,i,o,a,s){var u={};this.loadVTLayers();for(var l=ar(i),c=0,h=t;c<h.length;c+=1)this.loadMatchingFeature(u,n,r,h[c],l,o,a,s,e);return u},ec.prototype.hasLayer=function(t){for(var e=0,n=this.bucketLayerIDs;e<n.length;e+=1)for(var r=0,i=n[e];r<i.length;r+=1)if(t===i[r])return!0;return!1},ec.prototype.getId=function(t,e){var n=t.id;return this.promoteId&&"boolean"==typeof(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(n=Number(n)),n},Fr("FeatureIndex",ec,{omit:["rawTileData","sourceLayerCoder"]});var oc=function(t,e){this.tileID=t,this.uid=d(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};oc.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<F.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},oc.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},oc.prototype.loadVectorData=function(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var r in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var n={};if(!e)return n;for(var r=function(){var t=o[i],r=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==r.length){t.layers=r,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return r.filter((function(e){return e.id===t}))[0]})));for(var a=0,s=r;a<s.length;a+=1)n[s[a].id]=t}},i=0,o=t;i<o.length;i+=1)r();return n}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[r];if(i instanceof yl){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof yl&&a.hasRTLText){this.hasRTLText=!0,ai.isLoading()||ai.isLoaded()||"deferred"!==ii()||oi();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(u))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Qi},oc.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},oc.prototype.getBucket=function(t){return this.buckets[t.id]},oc.prototype.upload=function(t){for(var e in this.buckets){var n=this.buckets[e];n.uploadPending()&&n.upload(t)}var r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Rl(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Rl(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)},oc.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},oc.prototype.queryRenderedFeatures=function(t,e,n,r,i,o,a,s,u,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:o,tileSize:this.tileSize,pixelPosMatrix:l,transform:s,params:a,queryPadding:this.queryPadding*u},t,e,n):{}},oc.prototype.querySourceFeatures=function(t,e){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var r=n.loadVTLayers(),i=e?e.sourceLayer:"",o=r._geojsonTileLayer||r[i];if(o)for(var a=ar(e&&e.filter),s=this.tileID.canonical,u=s.z,l=s.x,c=s.y,h={z:u,x:l,y:c},p=0;p<o.length;p++){var f=o.feature(p);if(a.needGeometry){var d=jo(f,!0);if(!a.filter(new si(this.tileID.overscaledZ),d,this.tileID.canonical))continue}else if(!a.filter(new si(this.tileID.overscaledZ),f))continue;var v=n.getId(f,i),m=new Jl(f,u,l,c,v);m.tile=h,t.push(m)}}},oc.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},oc.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},oc.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=C(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),i=!1;if(this.expirationTime>r)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var o=this.expirationTime-e;o?this.expirationTime=r+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},oc.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},oc.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var n=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets)if(e.style.hasLayer(r)){var i=this.buckets[r],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=n[o],s=t[o];if(a&&s&&0!==Object.keys(s).length){i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});var u=e&&e.style&&e.style.getLayer(r);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(i)))}}}},oc.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},oc.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()},oc.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},oc.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=F.now()+t},oc.prototype.setDependencies=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1)n[i[r]]=!0;this.dependencies[t]=n},oc.prototype.hasDependency=function(t,e){for(var n=0,r=t;n<r.length;n+=1){var i=this.dependencies[r[n]];if(i)for(var o=0,a=e;o<a.length;o+=1)if(i[a[o]])return!0}return!1};var ac=a.performance,sc=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},ac.mark(this._marks.start)};sc.prototype.finish=function(){ac.mark(this._marks.end);var t=ac.getEntriesByName(this._marks.measure);return 0===t.length&&(ac.measure(this._marks.measure,this._marks.start,this._marks.end),t=ac.getEntriesByName(this._marks.measure),ac.clearMarks(this._marks.start),ac.clearMarks(this._marks.end),ac.clearMeasures(this._marks.measure)),t},t.Actor=Dl,t.AlphaImage=ga,t.CanonicalTileID=Zl,t.CollisionBoxArray=Qi,t.Color=te,t.DEMData=Kl,t.DataConstantProperty=mi,t.DictionaryCoder=Ql,t.EXTENT=8192,t.ErrorEvent=Ct,t.EvaluationParameters=si,t.Event=Tt,t.Evented=kt,t.FeatureIndex=ec,t.FillBucket=ss,t.FillExtrusionBucket=Es,t.ImageAtlas=xu,t.ImagePosition=gu,t.LineBucket=Ds,t.LngLat=Fl,t.LngLatBounds=zl,t.MercatorCoordinate=Wl,t.ONE_EM=24,t.OverscaledTileID=Xl,t.Point=i,t.Point$1=i,t.Properties=bi,t.Protobuf=Ks,t.RGBAImage=_a,t.RequestManager=W,t.RequestPerformance=sc,t.ResourceType=dt,t.SegmentVector=so,t.SourceFeatureState=tc,t.StructArrayLayout1ui2=Xi,t.StructArrayLayout2f1f2i16=Bi,t.StructArrayLayout2i4=ki,t.StructArrayLayout3ui6=ji,t.StructArrayLayout4i8=Mi,t.SymbolBucket=yl,t.Texture=Rl,t.Tile=oc,t.Transitionable=ci,t.Uniform1f=bo,t.Uniform1i=xo,t.Uniform2f=wo,t.Uniform3f=So,t.Uniform4f=Eo,t.UniformColor=Ao,t.UniformMatrix4f=Co,t.UnwrappedTileID=ql,t.ValidationError=It,t.WritingMode=bu,t.ZoomHistory=Hr,t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},t.addDynamicAttributes=fl,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var r=t.length,i=new Array(t.length),o=null;t.forEach((function(t,a){e(t,(function(t,e){t&&(o=t),i[a]=e,0==--r&&n(o,i)}))}))},t.bezier=u,t.bindAll=y,t.browser=F,t.cacheEntryPossiblyAdded=function(t){++pt>ut&&(t.getActor().send("enforceCacheSizeLimit",st),pt=0)},t.clamp=c,t.clearTileCache=function(t){var e=a.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=Zu,t.clone=function(t){var e=new aa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=b,t.clone$2=function(t){var e=new aa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=Ws,t.config=B,t.create=function(){var t=new aa(16);return aa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new aa(9);return aa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new aa(4);return aa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=qn,t.createLayout=Ti,t.createStyleLayer=function(t){return"custom"===t.type?new Tl(t):new Cl[t.type](t)},t.cross=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t},t.deepEqual=function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var i in e)if(!t(e[i],n[i]))return!1;return!0}return e===n},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=l,t.emitValidationErrors=Lr,t.endsWith=g,t.enforceCacheSizeLimit=function(t){lt(),tt&&tt.then((function(e){e.keys().then((function(n){for(var r=0;r<n.length-t;r++)e.delete(n[r])}))}))},t.evaluateSizeForFeature=zu,t.evaluateSizeForZoom=Fu,t.evaluateVariableOffset=ol,t.evented=ri,t.extend=p,t.featureFilter=ar,t.filterObject=x,t.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Lu,t.getAnchorJustification=al,t.getArrayBuffer=xt,t.getImage=St,t.getJSON=function(t,e){return _t(p(t,{type:"json"}),e)},t.getRTLTextPluginStatus=ii,t.getReferrer=gt,t.getVideo=function(t,e){var n,r,i=a.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var s=a.document.createElement("source");n=t[o],r=void 0,(r=a.document.createElement("a")).href=n,(r.protocol!==a.document.location.protocol||r.host!==a.document.location.host)&&(i.crossOrigin="Anonymous"),s.src=t[o],i.appendChild(s)}return{cancel:function(){}}},t.identity=sa,t.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],v=e[13],m=e[14],y=e[15],g=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,w=r*l-o*s,S=i*l-o*u,E=c*v-h*d,A=c*m-p*d,T=c*y-f*d,C=h*m-p*v,k=h*y-f*v,M=p*y-f*m,I=g*M-_*k+x*C+b*T-w*A+S*E;return I?(t[0]=(s*M-u*k+l*C)*(I=1/I),t[1]=(i*k-r*M-o*C)*I,t[2]=(v*S-m*w+y*b)*I,t[3]=(p*w-h*S-f*b)*I,t[4]=(u*T-a*M-l*A)*I,t[5]=(n*M-i*T+o*A)*I,t[6]=(m*x-d*S-y*_)*I,t[7]=(c*S-p*x+f*_)*I,t[8]=(a*k-s*T+l*E)*I,t[9]=(r*T-n*k-o*E)*I,t[10]=(d*w-v*x+y*g)*I,t[11]=(h*x-c*w-f*g)*I,t[12]=(s*A-a*C-u*E)*I,t[13]=(n*C-r*A+i*E)*I,t[14]=(v*_-d*b-m*g)*I,t[15]=(c*b-h*_+p*g)*I,t):null},t.isChar=Wr,t.isMapboxURL=Z,t.keysDifference=function(t,e){var n=[];for(var r in t)r in e||n.push(r);return n},t.makeRequest=_t,t.mapObject=_,t.mercatorXfromLng=jl,t.mercatorYfromLat=Vl,t.mercatorZfromAltitude=Gl,t.mul=ca,t.multiply=ua,t.mvt=xs,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},t.number=He,t.offscreenCanvasSupported=ft,t.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new Ks(t).readFields(du,[])},t.pbf=Ks,t.performSymbolLayout=function(t,e,n,r,i,o,a){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.kind){var c=t.textSizeData,h=c.maxZoom;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new si(c.minZoom),a),u["text-size"].possiblyEvaluate(new si(h),a)]}if("composite"===t.iconSizeData.kind){var p=t.iconSizeData,f=p.maxZoom;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new si(p.minZoom),a),u["icon-size"].possiblyEvaluate(new si(f),a)]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new si(t.zoom+1),a),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new si(t.zoom+1),a),l.textMaxSize=u["text-size"].possiblyEvaluate(new si(18));for(var d=24*s.get("text-line-height"),v="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),m=s.get("text-keep-upright"),y=s.get("text-size"),g=function(){var o=x[_],u=s.get("text-font").evaluate(o,{},a).join(","),c=y.evaluate(o,{},a),h=l.layoutTextSize.evaluate(o,{},a),p=l.layoutIconSize.evaluate(o,{},a),f={horizontal:{},vertical:void 0},g=o.text,b=[0,0];if(g){var w=g.toString(),E=24*s.get("text-letter-spacing").evaluate(o,{},a),A=function(t){for(var e=0,n=t;e<n.length;e+=1)if(r=n[e].charCodeAt(0),Wr.Arabic(r)||Wr["Arabic Supplement"](r)||Wr["Arabic Extended-A"](r)||Wr["Arabic Presentation Forms-A"](r)||Wr["Arabic Presentation Forms-B"](r))return!1;var r;return!0}(w)?E:0,T=s.get("text-anchor").evaluate(o,{},a),C=s.get("text-variable-anchor");if(!C){var k=s.get("text-radial-offset").evaluate(o,{},a);b=k?ol(T,[24*k,il]):s.get("text-offset").evaluate(o,{},a).map((function(t){return 24*t}))}var M=v?"center":s.get("text-justify").evaluate(o,{},a),I=s.get("symbol-placement"),P="point"===I?24*s.get("text-max-width").evaluate(o,{},a):0,L=function(){t.allowVerticalPlacement&&Zr(w)&&(f.vertical=Eu(g,e,n,i,u,P,d,T,"left",A,b,bu.vertical,!0,I,h,c))};if(!v&&C){for(var R="auto"===M?C.map((function(t){return al(t)})):[M],O=!1,D=0;D<R.length;D++){var N=R[D];if(!f.horizontal[N])if(O)f.horizontal[N]=f.horizontal[0];else{var z=Eu(g,e,n,i,u,P,d,"center",N,A,b,bu.horizontal,!1,I,h,c);z&&(f.horizontal[N]=z,O=1===z.positionedLines.length)}}L()}else{"auto"===M&&(M=al(T));var F=Eu(g,e,n,i,u,P,d,T,M,A,b,bu.horizontal,!1,I,h,c);F&&(f.horizontal[M]=F),L(),Zr(w)&&v&&m&&(f.vertical=Eu(g,e,n,i,u,P,d,T,M,A,b,bu.vertical,!1,I,h,c))}}var B=void 0,U=!1;if(o.icon&&o.icon.name){var j=r[o.icon.name];j&&(B=function(t,e,n){var r=Lu(n),i=e[0]-t.displaySize[0]*r.horizontalAlign,o=e[1]-t.displaySize[1]*r.verticalAlign;return{image:t,top:o,bottom:o+t.displaySize[1],left:i,right:i+t.displaySize[0]}}(i[o.icon.name],s.get("icon-offset").evaluate(o,{},a),s.get("icon-anchor").evaluate(o,{},a)),U=j.sdf,void 0===t.sdfIcons?t.sdfIcons=j.sdf:t.sdfIcons!==j.sdf&&S("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var V=ul(f.horizontal)||f.vertical;t.iconsInText=!!V&&V.iconsInText,(V||B)&&function(t,e,n,r,i,o,a,s,u,l,c){var h=o.textMaxSize.evaluate(e,{});void 0===h&&(h=a);var p,f=t.layers[0].layout,d=f.get("icon-offset").evaluate(e,{},c),v=ul(n.horizontal),m=a/24,y=t.tilePixelRatio*m,g=t.tilePixelRatio*h/24,_=t.tilePixelRatio*s,x=t.tilePixelRatio*f.get("symbol-spacing"),b=f.get("text-padding")*t.tilePixelRatio,w=f.get("icon-padding")*t.tilePixelRatio,E=f.get("text-max-angle")/180*Math.PI,A="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),T="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),C=f.get("symbol-placement"),k=x/2,M=f.get("icon-text-fit");r&&"none"!==M&&(t.allowVerticalPlacement&&n.vertical&&(p=Ou(r,n.vertical,M,f.get("icon-text-fit-padding"),d,m)),v&&(r=Ou(r,v,M,f.get("icon-text-fit-padding"),d,m)));var I=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,m,y,g,_,x,b,w,E,A){var T,C,k,M,I,P=t.addToLineVertexArray(e,n),L=0,R=0,O=0,D=0,N=-1,z=-1,F={},B=po(""),U=0,j=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(U=(T=s.layout.get("text-offset").evaluate(x,{},E).map((function(t){return 24*t})))[0],j=T[1]):(U=24*s.layout.get("text-radial-offset").evaluate(x,{},E),j=il),t.allowVerticalPlacement&&r.vertical){var V=s.layout.get("text-rotate").evaluate(x,{},E)+90;M=new Ju(u,e,l,c,h,r.vertical,p,f,d,V),a&&(I=new Ju(u,e,l,c,h,a,m,y,d,V))}if(i){var G=s.layout.get("icon-rotate").evaluate(x,{}),H="none"!==s.layout.get("icon-text-fit"),W=qu(i,G,w,H),Z=a?qu(a,G,w,H):void 0;k=new Ju(u,e,l,c,h,i,m,y,!1,G),L=4*W.length;var q=t.iconSizeData,X=null;"source"===q.kind?(X=[128*s.layout.get("icon-size").evaluate(x,{})])[0]>32640&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===q.kind&&((X=[128*b.compositeIconSizes[0].evaluate(x,{},E),128*b.compositeIconSizes[1].evaluate(x,{},E)])[0]>32640||X[1]>32640)&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,W,X,_,g,x,!1,e,P.lineStartIndex,P.lineLength,-1,E),N=t.icon.placedSymbolArray.length-1,Z&&(R=4*Z.length,t.addSymbols(t.icon,Z,X,_,g,x,bu.vertical,e,P.lineStartIndex,P.lineLength,-1,E),z=t.icon.placedSymbolArray.length-1)}for(var Y in r.horizontal){var K=r.horizontal[Y];if(!C){B=po(K.text);var Q=s.layout.get("text-rotate").evaluate(x,{},E);C=new Ju(u,e,l,c,h,K,p,f,d,Q)}var J=1===K.positionedLines.length;if(O+=sl(t,e,K,o,s,d,x,v,P,r.vertical?bu.horizontal:bu.horizontalOnly,J?Object.keys(r.horizontal):[Y],F,N,b,E),J)break}r.vertical&&(D+=sl(t,e,r.vertical,o,s,d,x,v,P,bu.vertical,["vertical"],F,z,b,E));var $=C?C.boxStartIndex:t.collisionBoxArray.length,tt=C?C.boxEndIndex:t.collisionBoxArray.length,et=M?M.boxStartIndex:t.collisionBoxArray.length,nt=M?M.boxEndIndex:t.collisionBoxArray.length,rt=k?k.boxStartIndex:t.collisionBoxArray.length,it=k?k.boxEndIndex:t.collisionBoxArray.length,ot=I?I.boxStartIndex:t.collisionBoxArray.length,at=I?I.boxEndIndex:t.collisionBoxArray.length,st=-1,ut=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=ut(C,st),st=ut(M,st),st=ut(k,st);var lt=(st=ut(I,st))>-1?1:0;lt&&(st*=A/24),t.glyphOffsetArray.length>=yl.MAX_GLYPHS&&S("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,F.right>=0?F.right:-1,F.center>=0?F.center:-1,F.left>=0?F.left:-1,F.vertical||-1,N,z,B,$,tt,et,nt,rt,it,ot,at,l,O,D,L,R,lt,0,p,U,j,st)}(t,h,s,n,r,i,p,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,y,b,A,u,_,w,T,d,e,o,l,c,a)};if("line"===C)for(var P=0,L=Zu(e.geometry,0,0,8192,8192);P<L.length;P+=1)for(var R=L[P],O=0,D=Wu(R,x,E,n.vertical||v,r,24,g,t.overscaling,8192);O<D.length;O+=1){var N=D[O];v&&ll(t,v.text,k,N)||I(R,N)}else if("line-center"===C)for(var z=0,F=e.geometry;z<F.length;z+=1){var B=F[z];if(B.length>1){var U=Hu(B,E,n.vertical||v,r,24,g);U&&I(B,U)}}else if("Polygon"===e.type)for(var j=0,V=rs(e.geometry,0);j<V.length;j+=1){var G=V[j],H=el(G,16);I(G[0],new Du(H.x,H.y,0))}else if("LineString"===e.type)for(var W=0,Z=e.geometry;W<Z.length;W+=1){var q=Z[W];I(q,new Du(q[0].x,q[0].y,0))}else if("Point"===e.type)for(var X=0,Y=e.geometry;X<Y.length;X+=1)for(var K=0,Q=Y[X];K<Q.length;K+=1){var J=Q[K];I([J],new Du(J.x,J.y,0))}}(t,o,f,B,r,l,h,p,b,U,a)},_=0,x=t.features;_<x.length;_+=1)g();o&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+r)*(o=1/(r-i)),t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t},t.pick=function(t,e){for(var n={},r=0;r<e.length;r++){var i=e[r];i in t&&(n[i]=t[i])}return n},t.plugin=ai,t.polygonIntersectsPolygon=Ho,t.postMapLoadEvent=at,t.postTurnstileEvent=it,t.potpack=yu,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=Fr,t.registerForPluginStateChange=function(t){return t({pluginStatus:$r,pluginURL:ti}),ri.on("pluginStateChange",t),t},t.renderColorRamp=ba,t.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t},t.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=u*i+p*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=p*i-u*r,t},t.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=u*i+p*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=p*i-u*r,t},t.scale=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.scale$2=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},t.setCacheLimits=function(t,e){st=t,ut=e},t.setRTLTextPlugin=function(t,e,n){if(void 0===n&&(n=!1),"deferred"===$r||"loading"===$r||"loaded"===$r)throw new Error("setRTLTextPlugin cannot be called multiple times.");ti=F.resolveURL(t),$r="deferred",Jr=e,ni(),n||oi()},t.sphericalToCartesian=function(t){var e=t[0],n=t[1],r=t[2];return n+=90,n*=Math.PI/180,r*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(r),y:e*Math.sin(n)*Math.sin(r),z:e*Math.cos(r)}},t.sqrLen=function(t){var e=t[0],n=t[1];return e*e+n*n},t.styleSpec=Mt,t.sub=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},t.symbolSize=Bu,t.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},t.transformMat4=ha,t.translate=function(t,e,n){var r,i,o,a,s,u,l,c,h,p,f,d,v=n[0],m=n[1],y=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*y+e[12],t[13]=e[1]*v+e[5]*m+e[9]*y+e[13],t[14]=e[2]*v+e[6]*m+e[10]*y+e[14],t[15]=e[3]*v+e[7]*m+e[11]*y+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=r=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=r*v+s*m+h*y+e[12],t[13]=i*v+u*m+p*y+e[13],t[14]=o*v+l*m+f*y+e[14],t[15]=a*v+c*m+d*y+e[15]),t},t.triggerPluginCompletionEvent=ei,t.uniqueId=d,t.validateCustomStyleLayer=function(t){var e=[],n=t.id;return void 0===n&&e.push({message:"layers."+n+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+n+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=Mr,t.validateStyle=kr,t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.vectorTile=xs,t.version="1.13.3",t.warnOnce=S,t.webpSupported=U,t.window=a,t.wrap=h})),r(["./shared"],(function(t){function e(t){var n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var r="[",i=0,o=t;i<o.length;i+=1)r+=e(o[i])+",";return r+"]"}for(var a=Object.keys(t).sort(),s="{",u=0;u<a.length;u++)s+=JSON.stringify(a[u])+":"+e(t[a[u]])+",";return s+"}"}function n(n){for(var r="",i=0,o=t.refProperties;i<o.length;i+=1)r+="/"+e(n[o[i]]);return r}var r=function(t){this.keyCache={},t&&this.replace(t)};r.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},r.prototype.update=function(e,r){for(var i=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var l=0,c=r;l<c.length;l+=1){var h=c[l];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,f=function(t,e){for(var r={},i=0;i<t.length;i++){var o=e&&e[t[i].id]||n(t[i]);e&&(e[t[i].id]=o);var a=r[o];a||(a=r[o]=[]),a.push(t[i])}var s=[];for(var u in r)s.push(r[u]);return s}(t.values(this._layerConfigs),this.keyCache);p<f.length;p+=1){var d=f[p].map((function(t){return i._layers[t.id]})),v=d[0];if("none"!==v.visibility){var m=v.source||"",y=this.familiesBySource[m];y||(y=this.familiesBySource[m]={});var g=v.sourceLayer||"_geojsonTileLayer",_=y[g];_||(_=y[g]=[]),_.push(d)}}};var i=function(e){var n={},r=[];for(var i in e){var o=e[i],a=n[i]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(l),a[s]={rect:l,metrics:u.metrics}}}}var c=t.potpack(r),h=new t.AlphaImage({width:c.w||1,height:c.h||1});for(var p in e){var f=e[p];for(var d in f){var v=f[+d];if(v&&0!==v.bitmap.width&&0!==v.bitmap.height){var m=n[p][d].rect;t.AlphaImage.copy(v.bitmap,h,{x:0,y:0},{x:m.x+1,y:m.y+1},v.bitmap)}}}this.image=h,this.positions=n};t.register("GlyphAtlas",i);var o=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function a(e,n,r){for(var i=new t.EvaluationParameters(n),o=0,a=e;o<a.length;o+=1)a[o].recalculate(i,r)}function s(e,n){var r=t.getArrayBuffer(e.request,(function(e,r,i,o){e?n(e):r&&n(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(r)),rawData:r,cacheControl:i,expires:o})}));return function(){r.cancel(),n()}}o.prototype.parse=function(e,n,r,o,s){var u=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var l=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];var h,p,f,d,v={},m={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:r},y=n.familiesBySource[this.source];for(var g in y){var _=e.layers[g];if(_){1===_.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+g+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var x=l.encode(g),b=[],w=0;w<_.length;w++){var S=_.feature(w),E=c.getId(S,g);b.push({feature:S,id:E,index:w,sourceLayerIndex:x})}for(var A=0,T=y[g];A<T.length;A+=1){var C=T[A],k=C[0];k.minzoom&&this.zoom<Math.floor(k.minzoom)||k.maxzoom&&this.zoom>=k.maxzoom||"none"!==k.visibility&&(a(C,this.zoom,r),(v[k.id]=k.createBucket({index:c.bucketLayerIDs.length,layers:C,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:x,sourceID:this.source})).populate(b,m,this.tileID.canonical),c.bucketLayerIDs.push(C.map((function(t){return t.id}))))}}}var M=t.mapObject(m.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(M).length?o.send("getGlyphs",{uid:this.uid,stacks:M},(function(t,e){h||(h=t,p=e,L.call(u))})):p={};var I=Object.keys(m.iconDependencies);I.length?o.send("getImages",{icons:I,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,f=e,L.call(u))})):f={};var P=Object.keys(m.patternDependencies);function L(){if(h)return s(h);if(p&&f&&d){var e=new i(p),n=new t.ImageAtlas(f,d);for(var o in v){var u=v[o];u instanceof t.SymbolBucket?(a(u.layers,this.zoom,r),t.performSymbolLayout(u,p,e.positions,f,n.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):u.hasPattern&&(u instanceof t.LineBucket||u instanceof t.FillBucket||u instanceof t.FillExtrusionBucket)&&(a(u.layers,this.zoom,r),u.addFeatures(m,this.tileID.canonical,n.patternPositions))}this.status="done",s(null,{buckets:t.values(v).filter((function(t){return!t.isEmpty()})),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:n,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}}P.length?o.send("getImages",{icons:P,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,d=e,L.call(u))})):d={},L.call(this)};var u=function(t,e,n,r){this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=r||s,this.loading={},this.loaded={}};u.prototype.loadTile=function(e,n){var r=this,i=e.uid;this.loading||(this.loading={});var a=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[i]=new o(e);s.abort=this.loadVectorData(e,(function(e,o){if(delete r.loading[i],e||!o)return s.status="done",r.loaded[i]=s,n(e);var u=o.rawData,l={};o.expires&&(l.expires=o.expires),o.cacheControl&&(l.cacheControl=o.cacheControl);var c={};if(a){var h=a.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,r.layerIndex,r.availableImages,r.actor,(function(e,r){if(e||!r)return n(e);n(null,t.extend({rawTileData:u.slice(0)},r,l,c))})),r.loaded=r.loaded||{},r.loaded[i]=s}))},u.prototype.reloadTile=function(t,e){var n=this,r=this.loaded,i=t.uid,o=this;if(r&&r[i]){var a=r[i];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,r){var i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,n.availableImages,o.actor,i)),e(t,r)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},u.prototype.abortTile=function(t,e){var n=this.loading,r=t.uid;n&&n[r]&&n[r].abort&&(n[r].abort(),delete n[r]),e()},u.prototype.removeTile=function(t,e){var n=this.loaded,r=t.uid;n&&n[r]&&delete n[r],e()};var l=t.window.ImageBitmap,c=function(){this.loaded={}};function h(t,e){if(0!==t.length){p(t[0],e);for(var n=1;n<t.length;n++)p(t[n],!e)}}function p(t,e){for(var n=0,r=0,i=0,o=t.length,a=o-1;i<o;a=i++){var s=(t[i][0]-t[a][0])*(t[a][1]+t[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!e&&t.reverse()}c.prototype.loadTile=function(e,n){var r=e.uid,i=e.encoding,o=e.rawImageData,a=l&&o instanceof l?this.getImageData(o):o,s=new t.DEMData(r,a,i);this.loaded=this.loaded||{},this.loaded[r]=s,n(null,s)},c.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var n=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:n.width,height:n.height},n.data)},c.prototype.removeTile=function(t){var e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]};var f=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,d=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};d.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],n=0,r=this._feature.geometry;n<r.length;n+=1){var i=r[n];e.push([new t.Point$1(i[0],i[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var u=[],l=0,c=s[a];l<c.length;l+=1){var h=c[l];u.push(new t.Point$1(h[0],h[1]))}o.push(u)}return o},d.prototype.toGeoJSON=function(t,e,n){return f.call(this,t,e,n)};var v=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};v.prototype.feature=function(t){return new d(this._features[t])};var m=t.vectorTile.VectorTileFeature,y=g;function g(t,e){this.options=e||{},this.features=t,this.length=t.length}function _(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}g.prototype.feature=function(t){return new _(this.features[t],this.options.extent)},_.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<r.length;o++)i.push(new t.Point$1(r[o][0],r[o][1]));this.geometry.push(i)}return this.geometry},_.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),n=Math.max(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.y)}return[e,r,n,i]},_.prototype.toGeoJSON=m.prototype.toGeoJSON;var x=w,b=y;function w(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,S,t.layers[n])}(e,n),n.finish()}function S(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)r.feature=t.feature(n),e.writeMessage(2,E,r);var i=r.keys;for(n=0;n<i.length;n++)e.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)e.writeMessage(4,M,o[n])}function E(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,A,t),e.writeVarintField(3,n.type),e.writeMessage(4,k,n)}function A(t,e){var n=t.feature,r=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in n.properties){var u=o[s];void 0===u&&(r.push(s),o[s]=u=r.length-1),e.writeVarint(u);var l=n.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,p=a[h];void 0===p&&(i.push(l),a[h]=p=i.length-1),e.writeVarint(p)}}function T(t,e){return(e<<3)+(7&t)}function C(t){return t<<1^t>>31}function k(t,e){for(var n=t.loadGeometry(),r=t.type,i=0,o=0,a=n.length,s=0;s<a;s++){var u=n[s],l=1;1===r&&(l=u.length),e.writeVarint(T(1,l));for(var c=3===r?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==r&&e.writeVarint(T(2,c-1));var p=u[h].x-i,f=u[h].y-o;e.writeVarint(C(p)),e.writeVarint(C(f)),i+=p,o+=f}3===r&&e.writeVarint(T(7,1))}}function M(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function I(t,e,n,r){P(t,n,r),P(e,2*n,2*r),P(e,2*n+1,2*r+1)}function P(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function L(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}x.fromVectorTileJs=w,x.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var r in t)n[r]=new y(t[r].features,e),n[r].name=r,n[r].version=e.version,n[r].extent=e.extent;return w({layers:n})},x.GeoJSONWrapper=b;var R=function(t){return t[0]},O=function(t){return t[1]},D=function(t,e,n,r,i){void 0===e&&(e=R),void 0===n&&(n=O),void 0===r&&(r=64),void 0===i&&(i=Float64Array),this.nodeSize=r,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=n(t[u]);!function t(e,n,r,i,o,a){if(!(o-i<=r)){var s=i+o>>1;!function t(e,n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(e,n,r,Math.max(i,Math.floor(r-u*c/s+h)),Math.min(o,Math.floor(r+(s-u)*c/s+h)),a)}var p=n[2*r+a],f=i,d=o;for(I(e,n,i,r),n[2*o+a]>p&&I(e,n,i,o);f<d;){for(I(e,n,f,d),f++,d--;n[2*f+a]<p;)f++;for(;n[2*d+a]>p;)d--}n[2*i+a]===p?I(e,n,i,d):I(e,n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}(e,n,s,i,o,a%2),t(e,n,r,i,s-1,a+1),t(e,n,r,s+1,o,a+1)}}(a,s,r,0,a.length-1,0)};D.prototype.range=function(t,e,n,r){return function(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),p=l.pop(),f=l.pop();if(p-f<=a)for(var d=f;d<=p;d++)u=e[2*d+1],(s=e[2*d])>=n&&s<=i&&u>=r&&u<=o&&c.push(t[d]);else{var v=Math.floor((f+p)/2);u=e[2*v+1],(s=e[2*v])>=n&&s<=i&&u>=r&&u<=o&&c.push(t[v]);var m=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(f),l.push(v-1),l.push(m)),(0===h?i>=s:o>=u)&&(l.push(v+1),l.push(p),l.push(m))}}return c}(this.ids,this.coords,t,e,n,r,this.nodeSize)},D.prototype.within=function(t,e,n){return function(t,e,n,r,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)L(e[2*p],e[2*p+1],n,r)<=u&&s.push(t[p]);else{var f=Math.floor((h+c)/2),d=e[2*f],v=e[2*f+1];L(d,v,n,r)<=u&&s.push(t[f]);var m=(l+1)%2;(0===l?n-i<=d:r-i<=v)&&(a.push(h),a.push(f-1),a.push(m)),(0===l?n+i>=d:r+i>=v)&&(a.push(f+1),a.push(c),a.push(m))}}return s}(this.ids,this.coords,t,e,n,this.nodeSize)};var N={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},z=function(t){this.options=H(Object.create(N),t),this.trees=new Array(this.options.maxZoom+1)};function F(t,e,n,r,i){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function B(t,e){var n=t.geometry.coordinates,r=n[1];return{x:V(n[0]),y:G(r),zoom:1/0,index:e,parentId:-1}}function U(t){return{type:"Feature",id:t.id,properties:j(t),geometry:{type:"Point",coordinates:[(r=t.x,360*(r-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,r}function j(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return H(H({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function V(t){return t/360+.5}function G(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function H(t,e){for(var n in e)t[n]=e[n];return t}function W(t){return t.x}function Z(t){return t.y}function q(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((t-n)*a+(e-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=t-n)*a+(s=e-r)*s}function X(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)Y(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)Y(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)Y(t,e[r][i])}(i),i}function Y(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function K(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)Q(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)Q(i[l],s);else if("LineString"===o)J(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)J(i[l],s=[],a,!1),t.push(X(u,"LineString",s,e.properties));return}$(i,s,a,!1)}else if("Polygon"===o)$(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)K(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];$(i[l],c,a,!0),s.push(c)}}t.push(X(u,o,s,e.properties))}}function Q(t,e){e.push(tt(t[0])),e.push(et(t[1])),e.push(0)}function J(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var u=tt(t[s][0]),l=et(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=e.length-3;e[2]=1,function t(e,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,l=e[n],c=e[n+1],h=e[r],p=e[r+1],f=n+3;f<r;f+=3){var d=q(e[f],e[f+1],l,c,h,p);if(d>a)o=f,a=d;else if(d===a){var v=Math.abs(f-s);v<u&&(o=f,u=v)}}a>i&&(o-n>3&&t(e,n,o,i),e[o+2]=a,r-o>3&&t(e,o,r,i))}(e,0,c,n),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function $(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];J(t[i],o,n,r),e.push(o)}}function tt(t){return t/360+.5}function et(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function nt(t,e,n,r,i,o,a,s){if(r/=e,o>=(n/=e)&&a<r)return t;if(a<n||o>=r)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=n&&d<r)u.push(c);else if(!(d<n||f>=r)){var v=[];if("Point"===p||"MultiPoint"===p)rt(h,v,n,r,i);else if("LineString"===p)it(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===p)at(h,v,n,r,i,!1);else if("Polygon"===p)at(h,v,n,r,i,!0);else if("MultiPolygon"===p)for(var m=0;m<h.length;m++){var y=[];at(h[m],y,n,r,i,!0),y.length&&v.push(y)}if(v.length){if(s.lineMetrics&&"LineString"===p){for(m=0;m<v.length;m++)u.push(X(c.id,p,v[m],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===v.length?(p="LineString",v=v[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===v.length?"Point":"MultiPoint"),u.push(X(c.id,p,v,c.tags))}}}return u.length?u:null}function rt(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function it(t,e,n,r,i,o,a){for(var s,u,l=ot(t),c=0===i?ut:lt,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],v=t[p+2],m=t[p+3],y=t[p+4],g=0===i?f:d,_=0===i?m:y,x=!1;a&&(s=Math.sqrt(Math.pow(f-m,2)+Math.pow(d-y,2))),g<n?_>n&&(u=c(l,f,d,m,y,n),a&&(l.start=h+s*u)):g>r?_<r&&(u=c(l,f,d,m,y,r),a&&(l.start=h+s*u)):st(l,f,d,v),_<n&&g>=n&&(u=c(l,f,d,m,y,n),x=!0),_>r&&g<=r&&(u=c(l,f,d,m,y,r),x=!0),!o&&x&&(a&&(l.end=h+s*u),e.push(l),l=ot(t)),a&&(h+=s)}var b=t.length-3;f=t[b],d=t[b+1],v=t[b+2],(g=0===i?f:d)>=n&&g<=r&&st(l,f,d,v),b=l.length-3,o&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&st(l,l[0],l[1],l[2]),l.length&&e.push(l)}function ot(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function at(t,e,n,r,i,o){for(var a=0;a<t.length;a++)it(t[a],e,n,r,i,o,!1)}function st(t,e,n,r){t.push(e),t.push(n),t.push(r)}function ut(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function lt(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function ct(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=ht(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(ht(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(ht(o.geometry[s][l],e));i.push(u)}n.push(X(o.id,a,i,o.tags))}return n}function ht(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function pt(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(ft(l[r],l[r+1],e,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(ft(l[r][i],l[r][i+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function ft(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function dt(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,vt(a,t[s],o,i);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function vt(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)mt(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)mt(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)mt(a,l[s],t,n,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function mt(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===r||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}(s,o),t.push(s)}}function yt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)K(n,t.features[r],e,r);else K(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var n=e.buffer/e.extent,r=t,i=nt(t,1,-1-n,n,0,-1,2,e),o=nt(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=nt(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=ct(i,1).concat(r)),o&&(r=r.concat(ct(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gt(t,e,n){return 32*((1<<t)*n+e)+t}function _t(t,e){var n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return e(null,null);var i=new v(r.features),o=x(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}z.prototype.load=function(t){var e=this.options,n=e.log,r=e.minZoom,i=e.maxZoom,o=e.nodeSize;n&&console.time("total time");var a="prepare "+t.length+" points";n&&console.time(a),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(B(t[u],u));this.trees[i+1]=new D(s,W,Z,o,Float32Array),n&&console.timeEnd(a);for(var l=i;l>=r;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new D(s,W,Z,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return n&&console.timeEnd("total time"),this},z.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(V(n),G(o),V(i),G(r));c<h.length;c+=1){var p=u.points[h[c]];l.push(p.numPoints?U(p):this.points[p.index])}return l},z.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=i.points[l[u]];c.parentId===t&&s.push(c.numPoints?U(c):this.points[c.index])}if(0===s.length)throw new Error(r);return s},z.prototype.getLeaves=function(t,e,n){var r=[];return this._appendLeaves(r,t,e=e||10,n=n||0,0),r},z.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(n-a)/i,u=(n+1+a)/i,l={features:[]};return this._addTileFeatures(r.range((e-a)/i,s,(e+1+a)/i,u),r.points,e,n,i,l),0===e&&this._addTileFeatures(r.range(1-a/i,s,1,u),r.points,i,n,i,l),e===i-1&&this._addTileFeatures(r.range(0,s,a/i,u),r.points,-1,n,i,l),l.features.length?l:null},z.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},z.prototype._appendLeaves=function(t,e,n,r,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},z.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l=u.numPoints,c={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-r))]],tags:l?j(u):this.points[u.index].properties},h=void 0;l?h=u.id:this.options.generateId?h=u.index:this.points[u.index].id&&(h=this.points[u.index].id),void 0!==h&&(c.id=h),o.features.push(c)}},z.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},z.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.reduce,o=r.minPoints,a=r.radius/(r.extent*Math.pow(2,e)),s=0;s<t.length;s++){var u=t[s];if(!(u.zoom<=e)){u.zoom=e;for(var l=this.trees[e+1],c=l.within(u.x,u.y,a),h=u.numPoints||1,p=h,f=0,d=c;f<d.length;f+=1){var v=l.points[d[f]];v.zoom>e&&(p+=v.numPoints||1)}if(p>=o){for(var m=u.x*h,y=u.y*h,g=i&&h>1?this._map(u,!0):null,_=(s<<5)+(e+1)+this.points.length,x=0,b=c;x<b.length;x+=1){var w=l.points[b[x]];if(!(w.zoom<=e)){w.zoom=e;var S=w.numPoints||1;m+=w.x*S,y+=w.y*S,w.parentId=_,i&&(g||(g=this._map(u,!0)),i(g,this._map(w)))}}u.parentId=_,n.push(F(m/p,y/p,_,p,g))}else if(n.push(u),p>1)for(var E=0,A=c;E<A.length;E+=1){var T=l.points[A[E]];T.zoom<=e||(T.zoom=e,n.push(T))}}}return n},z.prototype._getOriginId=function(t){return t-this.points.length>>5},z.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},z.prototype._map=function(t,e){if(t.numPoints)return e?H({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?H({},r):r},yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(t,e,n,r,i,o,a){for(var s=[t,e,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=gt(e,n,r),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=dt(t,e,n,r,u),this.tileCoords.push({z:e,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){l>1&&console.time("clipping");var v,m,y,g,_,x,b=.5*u.buffer/u.extent,w=.5-b,S=.5+b,E=1+b;v=m=y=g=null,_=nt(t,c,n-b,n+S,0,p.minX,p.maxX,u),x=nt(t,c,n+w,n+E,0,p.minX,p.maxX,u),t=null,_&&(v=nt(_,c,r-b,r+S,1,p.minY,p.maxY,u),m=nt(_,c,r+w,r+E,1,p.minY,p.maxY,u),_=null),x&&(y=nt(x,c,r-b,r+S,1,p.minY,p.maxY,u),g=nt(x,c,r+w,r+E,1,p.minY,p.maxY,u),x=null),l>1&&console.timeEnd("clipping"),s.push(v||[],e+1,2*n,2*r),s.push(m||[],e+1,2*n,2*r+1),s.push(y||[],e+1,2*n+1,2*r),s.push(g||[],e+1,2*n+1,2*r+1)}}},yt.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var a=1<<t,s=gt(t,e=(e%a+a)%a,n);if(this.tiles[s])return pt(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,l=t,c=e,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[gt(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?pt(this.tiles[s],i):null):null};var xt=function(e){function n(t,n,r,i){e.call(this,t,n,r,_t),i&&(this.loadGeoJSON=i)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},n.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(r&&r.request&&r.request.collectResourceTiming)&&new t.RequestPerformance(r.request);this.loadGeoJSON(r,(function(o,a){if(o||!a)return n(o);if("object"!=typeof a)return n(new Error("Input data given to '"+r.source+"' is not a valid GeoJSON object."));!function t(e,n){var r,i=e&&e.type;if("FeatureCollection"===i)for(r=0;r<e.features.length;r++)t(e.features[r],n);else if("GeometryCollection"===i)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],n);else if("Feature"===i)t(e.geometry,n);else if("Polygon"===i)h(e.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<e.coordinates.length;r++)h(e.coordinates[r],n);return e}(a,!0);try{if(r.filter){var s=t.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(t){return t.key+": "+t.message})).join(", "));var u=a.features.filter((function(t){return s.value.evaluate({zoom:0},t)}));a={type:"FeatureCollection",features:u}}e._geoJSONIndex=r.cluster?new z(function(e){var n=e.superclusterOptions,r=e.clusterProperties;if(!r||!n)return n;for(var i={},o={},a={accumulated:null,zoom:0},s={properties:null},u=Object.keys(r),l=0,c=u;l<c.length;l+=1){var h=c[l],p=r[h],f=p[0],d=t.createExpression(p[1]),v=t.createExpression("string"==typeof f?[f,["accumulated"],["get",h]]:f);i[h]=d.value,o[h]=v.value}return n.map=function(t){s.properties=t;for(var e={},n=0,r=u;n<r.length;n+=1){var o=r[n];e[o]=i[o].evaluate(a,s)}return e},n.reduce=function(t,e){s.properties=e;for(var n=0,r=u;n<r.length;n+=1){var i=r[n];a.accumulated=t[i],t[i]=o[i].evaluate(a,s)}},n}(r)).load(a.features):function(t,e){return new yt(t,e)}(a,r.geojsonVtOptions)}catch(o){return n(o)}e.loaded={};var l={};if(i){var c=i.finish();c&&(l.resourceTiming={},l.resourceTiming[r.source]=JSON.parse(JSON.stringify(c)))}n(null,l)}))}},n.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},n.prototype.reloadTile=function(t,n){var r=this.loaded;return r&&r[t.uid]?e.prototype.reloadTile.call(this,t,n):this.loadTile(t,n)},n.prototype.loadGeoJSON=function(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},n.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},n.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},n}(u),bt=function(e){var n=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:u,geojson:xt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(n.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');n.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return bt.prototype.setReferrer=function(t,e){this.referrer=e},bt.prototype.setImages=function(t,e,n){for(var r in this.availableImages[t]=e,this.workerSources[t]){var i=this.workerSources[t][r];for(var o in i)i[o].availableImages=e}n()},bt.prototype.setLayers=function(t,e,n){this.getLayerIndex(t).replace(e),n()},bt.prototype.updateLayers=function(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()},bt.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)},bt.prototype.loadDEMTile=function(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)},bt.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)},bt.prototype.abortTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)},bt.prototype.removeTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)},bt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},bt.prototype.removeSource=function(t,e,n){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,n):n()}},bt.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}},bt.prototype.syncRTLPluginState=function(e,n,r){try{t.plugin.setState(n);var i=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=i){this.self.importScripts(i);var o=t.plugin.isParsed();r(o?void 0:new Error("RTL Text Plugin failed to import scripts from "+i),o)}}catch(t){r(t.toString())}},bt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},bt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e},bt.prototype.getWorkerSource=function(t,e,n){var r=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][n]||(this.workerSources[t][e][n]=new this.workerSourceTypes[e]({send:function(e,n,i){r.actor.send(e,n,i,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][n]},bt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new c),this.demWorkerSources[t][e]},bt.prototype.enforceCacheSizeLimit=function(e,n){t.enforceCacheSizeLimit(n)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new bt(self)),bt})),r(["./shared"],(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!n(t)}function n(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()?(void 0===r[n=t&&t.failIfMajorPerformanceCaveat]&&(r[n]=function(t){var n=function(t){var n=document.createElement("canvas"),r=Object.create(e.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,n.probablySupportsContext?n.probablySupportsContext("webgl",r)||n.probablySupportsContext("experimental-webgl",r):n.supportsContext?n.supportsContext("webgl",r)||n.supportsContext("experimental-webgl",r):n.getContext("webgl",r)||n.getContext("experimental-webgl",r)}(t);if(!n)return!1;var r=n.createShader(n.VERTEX_SHADER);return!(!r||n.isContextLost())&&(n.shaderSource(r,"void main() {}"),n.compileShader(r),!0===n.getShaderParameter(r,n.COMPILE_STATUS))}(n)),r[n]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=n);var r={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),n={create:function(e,n,r){var i=t.window.document.createElement(e);return void 0!==n&&(i.className=n),r&&r.appendChild(i),i},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},r=t.window.document&&t.window.document.documentElement.style;function i(t){if(!r)return t[0];for(var e=0;e<t.length;e++)if(t[e]in r)return t[e];return t[0]}var o,a=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){r&&a&&(o=r[a],r[a]="none")},n.enableDrag=function(){r&&a&&(r[a]=o)};var s=i(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[s]=e};var u=!1;try{var l=Object.defineProperty({},"passive",{get:function(){u=!0}});t.window.addEventListener("test",l,l),t.window.removeEventListener("test",l,l)}catch(t){u=!1}n.addEventListener=function(t,e,n,r){void 0===r&&(r={}),t.addEventListener(e,n,"passive"in r&&u?r:r.capture)},n.removeEventListener=function(t,e,n,r){void 0===r&&(r={}),t.removeEventListener(e,n,"passive"in r&&u?r:r.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}n.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",c,!0)}),0)},n.mousePos=function(e,n){var r=e.getBoundingClientRect();return new t.Point(n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop)},n.touchPos=function(e,n){for(var r=e.getBoundingClientRect(),i=[],o=0;o<n.length;o++)i.push(new t.Point(n[o].clientX-r.left-e.clientLeft,n[o].clientY-r.top-e.clientTop));return i},n.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function n(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,n=this.requestors;e<n.length;e+=1){var r=n[e];this._notify(r.ids,r.callback)}this.requestors=[]}},n.prototype.getImage=function(t){return this.images[t]},n.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},n.prototype._validate=function(e,n){var r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),r=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),r=!1),r},n.prototype._validateStretch=function(t,e){if(!t)return!0;for(var n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];if(o[0]<n||o[1]<o[0]||e<o[1])return!1;n=o[1]}return!0},n.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},n.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},n.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(t,e){var n=!0;if(!this.isLoaded())for(var r=0,i=t;r<i.length;r+=1)this.images[i[r]]||(n=!1);this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})},n.prototype._notify=function(e,n){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?r[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}n(null,r)},n.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},n.prototype.getPattern=function(e){var n=this.patterns[e],r=this.getImage(e);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{var i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new t.ImagePosition(i,r);this.patterns[e]={bin:i,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},n.prototype.bind=function(e){var n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var e=[];for(var n in this.patterns)e.push(this.patterns[n].bin);var r=t.potpack(e),i=r.w,o=r.h,a=this.atlasImage;for(var s in a.resize({width:i||1,height:o||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,h=this.images[s].data,p=h.width,f=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c},{width:p,height:f}),t.RGBAImage.copy(h,a,{x:0,y:f-1},{x:l,y:c-1},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c+f},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:p-1,y:0},{x:l-1,y:c},{width:1,height:f}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:l+p,y:c},{width:1,height:f})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var i=this.images[r];h(i)&&this.updateImage(r,i)}}},n}(t.Evented),f=m,d=m,v=1e20;function m(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function y(t,e,n,r,i,o,a){for(var s=0;s<e;s++){for(var u=0;u<n;u++)r[u]=t[u*e+s];for(g(r,i,o,a,n),u=0;u<n;u++)t[u*e+s]=i[u]}for(u=0;u<n;u++){for(s=0;s<e;s++)r[s]=t[u*e+s];for(g(r,i,o,a,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(i[s])}}function g(t,e,n,r,i){n[0]=0,r[0]=-v,r[1]=+v;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=r[a];)a--,s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=s,r[a+1]=+v}for(o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++;e[o]=(o-n[a])*(o-n[a])+t[n[a]]}}m.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=e.data[4*r+3]/255;this.gridOuter[r]=1===i?0:0===i?v:Math.pow(Math.max(0,.5-i),2),this.gridInner[r]=1===i?v:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(y(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),y(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)n[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return n},f.default=d;var _=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};_.prototype.setURL=function(t){this.url=t},_.prototype.getGlyphs=function(e,n){var r=this,i=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1)i.push({stack:o,id:s[a]});t.asyncAll(i,(function(t,e){var n=t.stack,i=t.id,o=r.entries[n];o||(o=r.entries[n]={glyphs:{},requests:{},ranges:{}});var a=o.glyphs[i];if(void 0===a){if(a=r._tinySDF(o,n,i))return o.glyphs[i]=a,void e(null,{stack:n,id:i,glyph:a});var s=Math.floor(i/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(o.ranges[s])e(null,{stack:n,id:i,glyph:a});else{var u=o.requests[s];u||(u=o.requests[s]=[],_.loadGlyphRange(n,s,r.url,r.requestManager,(function(t,e){if(e){for(var n in e)r._doesCharSupportLocalGlyph(+n)||(o.glyphs[+n]=e[+n]);o.ranges[s]=!0}for(var i=0,a=u;i<a.length;i+=1)(0,a[i])(t,e);delete o.requests[s]}))),u.push((function(t,r){t?e(t):r&&e(null,{stack:n,id:i,glyph:r[i]||null})}))}}else e(null,{stack:n,id:i,glyph:a})}),(function(t,e){if(t)n(t);else if(e){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.stack,u=a.id,l=a.glyph;(r[s]||(r[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}n(null,r)}}))},_.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},_.prototype._tinySDF=function(e,n,r){var i=this.localIdeographFontFamily;if(i&&this._doesCharSupportLocalGlyph(r)){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(n)?a="900":/medium/i.test(n)?a="500":/light/i.test(n)&&(a="200"),o=e.tinySDF=new _.TinySDF(24,3,8,.25,i,a)}return{id:r,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_.loadGlyphRange=function(e,n,r,i,o){var a=256*n,s=a+255,u=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,(function(e,n){if(e)o(e);else if(n){for(var r={},i=0,a=t.parseGlyphPBF(n);i<a.length;i+=1){var s=a[i];r[s.id]=s}o(null,r)}}))},_.TinySDF=f;var x=function(){this.specification=t.styleSpec.light.position};x.prototype.possiblyEvaluate=function(e,n){return t.sphericalToCartesian(e.expression.evaluate(n))},x.prototype.interpolate=function(e,n,r){return{x:t.number(e.x,n.x,r),y:t.number(e.y,n.y,r),z:t.number(e.z,n.z,r)}};var b=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new x,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),w=function(e){function n(n){e.call(this),this._transitionable=new t.Transitionable(b),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(e,n){if(void 0===n&&(n={}),!this._validate(t.validateLight,e,n))for(var r in e){var i=e[r];t.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-11),i):this._transitionable.setValue(r,i)}},n.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},n.prototype._validate=function(e,n,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},n}(t.Evented),S=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};S.prototype.getDash=function(t,e){var n=t.join(",")+String(e);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(t,e)),this.dashEntry[n]},S.prototype.getDashRanges=function(t,e,n){var r=[],i=t.length%2==1?-t[t.length-1]*n:0,o=t[0]*n,a=!0;r.push({left:i,right:o,isDash:a,zeroLength:0===t[0]});for(var s=t[0],u=1;u<t.length;u++){var l=t[u];r.push({left:i=s*n,right:o=(s+=l)*n,isDash:a=!a,zeroLength:0===l})}return r},S.prototype.addRoundDash=function(t,e,n){for(var r=e/2,i=-n;i<=n;i++)for(var o=this.width*(this.nextRow+n+i),a=0,s=t[a],u=0;u<this.width;u++){u/s.right>1&&(s=t[++a]);var l=Math.abs(u-s.left),c=Math.abs(u-s.right),h=Math.min(l,c),p=void 0,f=i/n*(r+1);if(s.isDash){var d=r-Math.abs(f);p=Math.sqrt(h*h+d*d)}else p=r-Math.sqrt(h*h+f*f);this.data[o+u]=Math.max(0,Math.min(255,p+128))}},S.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var n=t[e],r=t[e+1];n.zeroLength?t.splice(e,1):r&&r.isDash===n.isDash&&(r.left=n.left,t.splice(e,1))}var i=t[0],o=t[t.length-1];i.isDash===o.isDash&&(i.left=o.left-this.width,o.right=i.right+this.width);for(var a=this.width*this.nextRow,s=0,u=t[s],l=0;l<this.width;l++){l/u.right>1&&(u=t[++s]);var c=Math.abs(l-u.left),h=Math.abs(l-u.right),p=Math.min(c,h);this.data[a+l]=Math.max(0,Math.min(255,(u.isDash?p:-p)+128))}},S.prototype.addDash=function(e,n){var r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];if(0!==o){var s=this.width/o,u=this.getDashRanges(e,this.width,s);n?this.addRoundDash(u,s,r):this.addRegularDash(u)}var l={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=i,this.dirty=!0,l},S.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var E=function e(n,r){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=new e.Actor(i[o],r,this.id);a.name="Worker "+o,this.actors.push(a)}};function A(e,n,r){var i=function(i,o){if(i)return r(i);if(o){var a=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map((function(t){return t.id}))),a.tiles=n.canonicalizeTileset(a,e.url),r(null,a)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame((function(){return i(null,e)}))}E.prototype.broadcast=function(e,n,r){t.asyncAll(this.actors,(function(t,r){t.send(e,n,r)}),r=r||function(){})},E.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},E.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},E.Actor=t.Actor;var T=function(e,n,r){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=r||24};T.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},T.prototype.contains=function(e){var n=Math.pow(2,e.z),r=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=r&&e.x<o&&e.y>=i&&e.y<a};var C=function(e){function n(n,r,i,o){if(e.call(this),this.id=n,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(r,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=A(this._options,this.map._requestManager,(function(n,r){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new T(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},n.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},n.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.loadTile=function(e,n){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function o(r,i){return delete e.request,e.aborted?n(null):r&&404!==r.status?n(r):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",i,o.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,o.bind(this)))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.hasTransition=function(){return!1},n}(t.Evented),k=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},r),t.extend(this,t.pick(r,["url","scheme","tileSize"]))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=A(this._options,this.map._requestManager,(function(n,r){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new T(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.loadTile=function(e,n){var r=this,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(function(i,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(o){r.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=r.map.painter.context,s=a.gl;e.texture=r.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(r.dispatcher),n(null)}}))},n.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},n.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},n.prototype.hasTransition=function(){return!1},n}(t.Evented),M=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(e,n){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function i(t,r){t&&(e.state="errored",n(t)),r&&(e.dem=r,e.needsHillshadePrepare=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),function(r,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?o:t.browser.getImageData(o,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,i.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},n.prototype._getNeighboringTiles=function(e){var n=e.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?e.wrap-1:e.wrap,a=(n.x+1+r)%r,s=n.x+1===r?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<r&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),u},n.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},n}(k),I=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=r.data,this._options=t.extend({},r),this._collectResourceTiming=r.collectResourceTiming,this._resourceTiming=[],void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*a,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?Math.min(r.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.EXTENT,radius:(r.clusterRadius||50)*a,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(n){if(n)e.fire(new t.ErrorEvent(n));else{var r={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(r.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",r))}}))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setData=function(e){var n=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)n.fire(new t.ErrorEvent(e));else{var r={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(r.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new t.Event("data",r))}})),this},n.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},n.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},n.prototype.getClusterLeaves=function(t,e,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},r),this},n.prototype._updateWorkerData=function(e){var n=this;this._loaded=!1;var r=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(r.request=this.map._requestManager.transformRequest(t.browser.resolveURL(i),t.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(i),this.actor.send(this.type+".loadData",r,(function(t,i){n._removed||i&&i.abandoned||(n._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[n.id]&&(n._resourceTiming=i.resourceTiming[n.id].slice(0)),n.actor.send(n.type+".coalesce",{source:r.source},null),e(t))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.loadTile=function(e,n){var r=this,i=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(i,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,o){return delete e.request,e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(o,r.map.painter,"reloadTile"===i),n(null))}))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},n.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},n.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},n.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(t.Evented),P=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),L=function(e){function n(t,n,r,i){e.call(this),this.id=t,this.dispatcher=r,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(e,n){var r=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(i,o){r._loaded=!0,i?r.fire(new t.ErrorEvent(i)):o&&(r.image=o,e&&(r.coordinates=e),n&&n(),r._finishLoading())}))},n.prototype.loaded=function(){return this._loaded},n.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setCoordinates=function(e){var n=this;this.coordinates=e;var r=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var n=1/0,r=1/0,i=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var u=s[a];n=Math.min(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.x),o=Math.max(o,u.y)}var l=Math.max(i-n,o-r),c=Math.max(0,Math.floor(-Math.log(l)/Math.LN2)),h=Math.pow(2,c);return new t.CanonicalTileID(c,Math.floor((n+i)/2*h),Math.floor((r+o)/2*h))}(r),this.minzoom=this.maxzoom=this.tileID.z;var i=r.map((function(t){return n.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},n.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,P.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},n.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(t.Evented),R=function(e){function n(t,n,r,i){e.call(this,t,n,r,i),this.roundZoom=!0,this.type="video",this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1;var n=this.options;this.urls=[];for(var r=0,i=n.urls;r<i.length;r+=1)this.urls.push(this.map._requestManager.transformRequest(i[r],t.ResourceType.Source).url);t.getVideo(this.urls,(function(n,r){e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(e.video=r,e.video.loop=!0,e.video.setAttribute("playsinline",""),e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},n.prototype.pause=function(){this.video&&this.video.pause()},n.prototype.play=function(){this.video&&this.video.play()},n.prototype.seek=function(e){if(this.video){var n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+n.start(0)+" and "+n.end(0)+"-second mark."))):this.video.currentTime=e}},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,P.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(L),O=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,r=n.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,P.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},n}(L),D={vector:C,raster:k,"raster-dem":M,geojson:I,video:R,image:L,canvas:O};function N(e,n){var r=t.identity([]);return t.translate(r,r,[1,1,0]),t.scale(r,r,[.5*e.width,.5*e.height,1]),t.multiply(r,r,e.calculatePosMatrix(n.toUnwrapped()))}function z(t,e,n,r,i,o){var a=function(t,e,n){if(t)for(var r=0,i=t;r<i.length;r+=1){var o=e[i[r]];if(o&&o.source===n&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===n&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,e,t.id),s=o.maxPitchScaleFactor(),u=t.tilesIn(r,s,a);u.sort(F);for(var l=[],c=0,h=u;c<h.length;c+=1){var p=h[c];l.push({wrappedTileID:p.tileID.wrapped().key,queryResults:p.tile.queryRenderedFeatures(e,n,t._state,p.queryGeometry,p.cameraQueryGeometry,p.scale,i,o,s,N(t.transform,p.tileID))})}var f=function(t){for(var e={},n={},r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.queryResults,s=o.wrappedTileID,u=n[s]=n[s]||{};for(var l in a)for(var c=a[l],h=u[l]=u[l]||{},p=e[l]=e[l]||[],f=0,d=c;f<d.length;f+=1){var v=d[f];h[v.featureIndex]||(h[v.featureIndex]=!0,p.push(v))}}return e}(l);for(var d in f)f[d].forEach((function(e){var n=e.feature,r=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r}));return f}function F(t,e){var n=t.tileID,r=e.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}var B=function(t,e){this.max=t,this.onRemove=e,this.reset()};B.prototype.reset=function(){for(var t in this.data)for(var e=0,n=this.data[t];e<n.length;e+=1){var r=n[e];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}return this.data={},this.order=[],this},B.prototype.add=function(t,e,n){var r=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:e,timeout:void 0};if(void 0!==n&&(o.timeout=setTimeout((function(){r.remove(t,o)}),n)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},B.prototype.has=function(t){return t.wrapped().key in this.data},B.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},B.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},B.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},B.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},B.prototype.remove=function(t,e){if(!this.has(t))return this;var n=t.wrapped().key,r=void 0===e?0:this.data[n].indexOf(e),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this},B.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},B.prototype.filter=function(t){var e=[];for(var n in this.data)for(var r=0,i=this.data[n];r<i.length;r+=1){var o=i[r];t(o.value)||e.push(o)}for(var a=0,s=e;a<s.length;a+=1){var u=s[a];this.remove(u.value.tileID,u)}};var U=function(t,e,n){this.context=t;var r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};U.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},U.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},U.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var j={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},V=function(t,e,n,r){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;var i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};V.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},V.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},V.prototype.enableAttributes=function(t,e){for(var n=0;n<this.attributes.length;n++){var r=e.attributes[this.attributes[n].name];void 0!==r&&t.enableVertexAttribArray(r)}},V.prototype.setVertexAttribPointers=function(t,e,n){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[j[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}},V.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var G=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};G.prototype.get=function(){return this.current},G.prototype.set=function(t){},G.prototype.getDefault=function(){return this.default},G.prototype.setDefault=function(){this.set(this.default)};var H=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(G),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(G),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(G),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(G),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(G),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(G),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(G),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(G),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(G),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(G),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(G),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),it=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(G),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(G),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(G),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(G),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(G),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(G),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(G),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(G),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(G),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(G),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(G),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(G),yt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(G),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(G),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),bt=function(t){function e(e,n){t.call(this,e),this.context=e,this.parent=n}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(G),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(bt),St=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(bt),Et=function(t,e,n,r){this.context=t,this.width=e,this.height=n;var i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new wt(t,i),r&&(this.depthAttachment=new St(t,i))};Et.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}t.deleteFramebuffer(this.framebuffer)};var At=function(t,e,n){this.func=t,this.mask=e,this.range=n};At.ReadOnly=!1,At.ReadWrite=!0,At.disabled=new At(519,At.ReadOnly,[0,1]);var Tt=function(t,e,n,r,i,o){this.test=t,this.ref=e,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o};Tt.disabled=new Tt({func:519,mask:0},0,0,7680,7680,7680);var Ct=function(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n};Ct.disabled=new Ct(Ct.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Ct.unblended=new Ct(Ct.Replace,t.Color.transparent,[!0,!0,!0,!0]),Ct.alphaBlended=new Ct([1,771],t.Color.transparent,[!0,!0,!0,!0]);var kt=function(t,e,n){this.enable=t,this.mode=e,this.frontFace=n};kt.disabled=new kt(!1,1029,2305),kt.backCCW=new kt(!0,1029,2305);var Mt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new H(this),this.clearDepth=new W(this),this.clearStencil=new Z(this),this.colorMask=new q(this),this.depthMask=new X(this),this.stencilMask=new Y(this),this.stencilFunc=new K(this),this.stencilOp=new Q(this),this.stencilTest=new J(this),this.depthRange=new $(this),this.depthTest=new tt(this),this.depthFunc=new et(this),this.blend=new nt(this),this.blendFunc=new rt(this),this.blendColor=new it(this),this.blendEquation=new ot(this),this.cullFace=new at(this),this.cullFaceSide=new st(this),this.frontFace=new ut(this),this.program=new lt(this),this.activeTexture=new ct(this),this.viewport=new ht(this),this.bindFramebuffer=new pt(this),this.bindRenderbuffer=new ft(this),this.bindTexture=new dt(this),this.bindVertexBuffer=new vt(this),this.bindElementBuffer=new mt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yt(this),this.pixelStoreUnpack=new gt(this),this.pixelStoreUnpackPremultiplyAlpha=new _t(this),this.pixelStoreUnpackFlipY=new xt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};Mt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Mt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Mt.prototype.createIndexBuffer=function(t,e){return new U(this,t,e)},Mt.prototype.createVertexBuffer=function(t,e,n){return new V(this,t,e,n)},Mt.prototype.createRenderbuffer=function(t,e,n){var r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),i},Mt.prototype.createFramebuffer=function(t,e,n){return new Et(this,t,e,n)},Mt.prototype.clear=function(t){var e=t.color,n=t.depth,r=this.gl,i=0;e&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),r.clear(i)},Mt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},Mt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Mt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Mt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Ct.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},Mt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var It=function(e){function n(n,r,i){var o=this;e.call(this),this.id=n,this.dispatcher=i,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=function(e,n,r,i){var o=new D[n.type](e,n,r,i);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o}(n,r,i,this),this._tiles={},this._cache=new B(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},n.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},n.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},n.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(Pt).map((function(t){return t.key}))},n.prototype.getRenderableIds=function(e){var n=this,r=[];for(var i in this._tiles)this._isIdRenderable(i,e)&&r.push(this._tiles[i]);return e?r.sort((function(e,r){var i=e.tileID,o=r.tileID,a=new t.Point(i.canonical.x,i.canonical.y)._rotate(n.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(n.transform.angle);return i.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})).map((function(t){return t.tileID.key})):r.map((function(t){return t.tileID})).sort(Pt).map((function(t){return t.key}))},n.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},n.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},n.prototype._reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))},n.prototype._tileLoaded=function(e,n,r,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new t.ErrorEvent(i,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},n.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),n=0;n<e.length;n++){var r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){var i=this.getTileByID(r);o(t,i),o(i,t)}}function o(t,e){t.needsHillshadePrepare=!0;var n=e.tileID.canonical.x-t.tileID.canonical.x,r=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},n.prototype.getTile=function(t){return this.getTileByID(t.key)},n.prototype.getTileByID=function(t){return this._tiles[t]},n.prototype._retainLoadedChildren=function(t,e,n,r){for(var i in this._tiles){var o=this._tiles[i];if(!(r[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>n)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var u=a;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){r[a.key]=a;break}}}},n.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(var r=t.overscaledZ-1;r>=e;r--){var i=t.scaledTo(r),o=this._getLoadedTile(i);if(o)return o}},n.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},n.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,n=Math.ceil(t.height/this._source.tileSize)+1,r=Math.floor(e*n*5),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(i)},n.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var n={};for(var r in this._tiles){var i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),n[i.tileID.key]=i}for(var o in this._tiles=n,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},n.prototype.update=function(e){var r=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter((function(t){return r._source.hasTile(t)})))):i=[];var o=e.coveringZoomLevel(this._source),a=Math.max(o-n.maxOverzooming,this._source.minzoom),s=Math.max(o+n.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(i,o);if(Lt(this._source.type)){for(var l={},c={},h=0,p=Object.keys(u);h<p.length;h+=1){var f=p[h],d=u[f],v=this._tiles[f];if(v&&!(v.fadeEndTime&&v.fadeEndTime<=t.browser.now())){var m=this.findLoadedParent(d,a);m&&(this._addTile(m.tileID),l[m.tileID.key]=m.tileID),c[f]=d}}for(var y in this._retainLoadedChildren(c,o,s,u),l)u[y]||(this._coveredTiles[y]=!0,u[y]=l[y])}for(var g in u)this._tiles[g].clearFadeHold();for(var _=0,x=t.keysDifference(this._tiles,u);_<x.length;_+=1){var b=x[_],w=this._tiles[b];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(b)}this._updateLoadedParentTileCache()}},n.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},n.prototype._updateRetainedTiles=function(t,e){for(var r={},i={},o=Math.max(e-n.maxOverzooming,this._source.minzoom),a=Math.max(e+n.maxUnderzooming,this._source.minzoom),s={},u=0,l=t;u<l.length;u+=1){var c=l[u],h=this._addTile(c);r[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,a,r);for(var p=0,f=t;p<f.length;p+=1){var d=f[p],v=this._tiles[d.key];if(!v.hasData()){if(e+1>this._source.maxzoom){var m=d.children(this._source.maxzoom)[0],y=this.getTile(m);if(y&&y.hasData()){r[m.key]=m;continue}}else{var g=d.children(this._source.maxzoom);if(r[g[0].key]&&r[g[1].key]&&r[g[2].key]&&r[g[3].key])continue}for(var _=v.wasRequested(),x=d.overscaledZ-1;x>=o;--x){var b=d.scaledTo(x);if(i[b.key])break;if(i[b.key]=!0,!(v=this.getTile(b))&&_&&(v=this._addTile(b)),v&&(r[b.key]=b,_=v.wasRequested(),v.hasData()))break}}}return r},n.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],n=void 0,r=this._tiles[t].tileID;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}e.push(r.key);var i=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(i))break;r=i}for(var o=0,a=e;o<a.length;o+=1)this._loadedParentTiles[a[o]]=n}},n.prototype._addTile=function(e){var n=this._tiles[e.key];if(n)return n;(n=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));var r=Boolean(n);return r||(n=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n?(n.uses++,this._tiles[e.key]=n,r||this._source.fire(new t.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null},n.prototype._setTileReloadTimer=function(t,e){var n=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout((function(){n._reloadTile(t,"expired"),delete n._timers[t]}),r))},n.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},n.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},n.prototype.tilesIn=function(e,n,r){var i=this,o=[],a=this.transform;if(!a)return o;for(var s=r?a.getCameraQueryGeometry(e):e,u=e.map((function(t){return a.pointCoordinate(t)})),l=s.map((function(t){return a.pointCoordinate(t)})),c=this.getIds(),h=1/0,p=1/0,f=-1/0,d=-1/0,v=0,m=l;v<m.length;v+=1){var y=m[v];h=Math.min(h,y.x),p=Math.min(p,y.y),f=Math.max(f,y.x),d=Math.max(d,y.y)}for(var g=function(e){var r=i._tiles[c[e]];if(!r.holdingForFade()){var s=r.tileID,v=Math.pow(2,a.zoom-r.tileID.overscaledZ),m=n*r.queryPadding*t.EXTENT/r.tileSize/v,y=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(f,d))];if(y[0].x-m<t.EXTENT&&y[0].y-m<t.EXTENT&&y[1].x+m>=0&&y[1].y+m>=0){var g=u.map((function(t){return s.getTilePoint(t)})),_=l.map((function(t){return s.getTilePoint(t)}));o.push({tile:r,tileID:s,queryGeometry:g,cameraQueryGeometry:_,scale:v})}}},_=0;_<c.length;_++)g(_);return o},n.prototype.getVisibleCoordinates=function(t){for(var e=this,n=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),r=0,i=n;r<i.length;r+=1){var o=i[r];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Lt(this._source.type))for(var e in this._tiles){var n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=t.browser.now())return!0}return!1},n.prototype.setFeatureState=function(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)},n.prototype.removeFeatureState=function(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)},n.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},n.prototype.setDependencies=function(t,e,n){var r=this._tiles[t];r&&r.setDependencies(e,n)},n.prototype.reloadTilesForDependencies=function(t,e){for(var n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(n,"reloading");this._cache.filter((function(n){return!n.hasDependency(t,e)}))},n}(t.Evented);function Pt(t,e){var n=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Lt(t){return"raster"===t||"image"===t||"video"===t}function Rt(){return new t.window.Worker(Yi.workerUrl)}It.maxOverzooming=10,It.maxUnderzooming=3;var Ot="mapboxgl_preloaded_worker_pool",Dt=function(){this.active={}};Dt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Rt);return this.active[t]=!0,this.workers.slice()},Dt.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},Dt.prototype.isPreloaded=function(){return!!this.active[Ot]},Dt.prototype.numActive=function(){return Object.keys(this.active).length};var Nt,zt=Math.floor(t.browser.hardwareConcurrency/2);function Ft(){return Nt||(Nt=new Dt),Nt}function Bt(e,n){var r={};for(var i in e)"ref"!==i&&(r[i]=e[i]);return t.refProperties.forEach((function(t){t in n&&(r[t]=n[t])})),r}function Ut(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=Bt(t[r],e[t[r].ref]));return t}Dt.workerCount=Math.max(Math.min(zt,6),1);var jt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Vt(t,e,n){n.push({command:jt.addSource,args:[t,e[t]]})}function Gt(t,e,n){e.push({command:jt.removeSource,args:[t]}),n[t]=!0}function Ht(t,e,n,r){Gt(t,n,r),Vt(t,e,n)}function Wt(e,n,r){var i;for(i in e[r])if(e[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;return!0}function Zt(e,n,r,i,o,a){var s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}))}function qt(t){return t.id}function Xt(t,e){return t[e.id]=e,t}var Yt=function(t,e){this.reset(t,e)};Yt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Yt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var n=1,r=this._distances[n],i=e*this.paddedLength+this.padding;r<i&&n<this._distances.length;)r=this._distances[++n];var o=n-1,a=this._distances[o],s=r-a,u=s>0?(i-a)/s:0;return this.points[o].mult(1-u).add(this.points[n].mult(u))};var Kt=function(t,e,n){var r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Qt(e,n,r,i,o){var a=t.create();return n?(t.scale(a,a,[1/o,1/o,1]),r||t.rotateZ(a,a,i.angle)):t.multiply(a,i.labelPlaneMatrix,e),a}function Jt(e,n,r,i,o){if(n){var a=t.clone(e);return t.scale(a,a,[o,o,1]),r||t.rotateZ(a,a,-i.angle),a}return i.glCoordMatrix}function $t(e,n){var r=[e.x,e.y,0,1];ce(r,r,n);var i=r[3];return{point:new t.Point(r[0]/i,r[1]/i),signedDistanceFromCamera:i}}function te(t,e){return.5+t/e*.5}function ee(t,e){var n=t[0]/t[3],r=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&r>=-e[1]&&r<=e[1]}function ne(e,n,r,i,o,a,s,u){var l=i?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(l,r.transform.zoom),h=[256/r.width*2+1,256/r.height*2+1],p=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var f=e.lineVertexArray,d=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=r.transform.width/r.transform.height,m=!1,y=0;y<d.length;y++){var g=d.get(y);if(g.hidden||g.writingMode===t.WritingMode.vertical&&!m)le(g.numGlyphs,p);else{m=!1;var _=[g.anchorX,g.anchorY,0,1];if(t.transformMat4(_,_,n),ee(_,h)){var x=te(r.transform.cameraToCenterDistance,_[3]),b=t.evaluateSizeForFeature(l,c,g),w=s?b/x:b*x,S=new t.Point(g.anchorX,g.anchorY),E=$t(S,o).point,A={},T=oe(g,w,!1,u,n,o,a,e.glyphOffsetArray,f,p,E,S,A,v);m=T.useVertical,(T.notEnoughRoom||m||T.needsFlipping&&oe(g,w,!0,u,n,o,a,e.glyphOffsetArray,f,p,E,S,A,v).notEnoughRoom)&&le(g.numGlyphs,p)}else le(g.numGlyphs,p)}}i?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function re(t,e,n,r,i,o,a,s,u,l,c){var h=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,f=s.lineStartIndex+s.lineLength,d=e.getoffsetX(s.glyphStartIndex),v=e.getoffsetX(h-1),m=se(t*d,n,r,i,o,a,s.segment,p,f,u,l,c);if(!m)return null;var y=se(t*v,n,r,i,o,a,s.segment,p,f,u,l,c);return y?{first:m,last:y}:null}function ie(e,n,r,i){return e===t.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function oe(e,n,r,i,o,a,s,u,l,c,h,p,f,d){var v,m=n/24,y=e.lineOffsetX*m,g=e.lineOffsetY*m;if(e.numGlyphs>1){var _=e.glyphStartIndex+e.numGlyphs,x=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,w=re(m,u,y,g,r,h,p,e,l,a,f);if(!w)return{notEnoughRoom:!0};var S=$t(w.first.point,s).point,E=$t(w.last.point,s).point;if(i&&!r){var A=ie(e.writingMode,S,E,d);if(A)return A}v=[w.first];for(var T=e.glyphStartIndex+1;T<_-1;T++)v.push(se(m*u.getoffsetX(T),y,g,r,h,p,e.segment,x,b,l,a,f));v.push(w.last)}else{if(i&&!r){var C=$t(p,o).point,k=e.lineStartIndex+e.segment+1,M=new t.Point(l.getx(k),l.gety(k)),I=$t(M,o),P=I.signedDistanceFromCamera>0?I.point:ae(p,M,C,1,o),L=ie(e.writingMode,C,P,d);if(L)return L}var R=se(m*u.getoffsetX(e.glyphStartIndex),y,g,r,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,a,f);if(!R)return{notEnoughRoom:!0};v=[R]}for(var O=0,D=v;O<D.length;O+=1){var N=D[O];t.addDynamicAttributes(c,N.point,N.angle)}return{}}function ae(t,e,n,r,i){var o=$t(t.add(t.sub(e)._unit()),i).point,a=n.sub(o);return n.add(a._mult(r/a.mag()))}function se(e,n,r,i,o,a,s,u,l,c,h,p){var f=i?e-n:e+n,d=f>0?1:-1,v=0;i&&(d*=-1,v=Math.PI),d<0&&(v+=Math.PI);for(var m=d>0?u+s:u+s+1,y=o,g=o,_=0,x=0,b=Math.abs(f),w=[];_+x<=b;){if((m+=d)<u||m>=l)return null;if(g=y,w.push(y),void 0===(y=p[m])){var S=new t.Point(c.getx(m),c.gety(m)),E=$t(S,h);if(E.signedDistanceFromCamera>0)y=p[m]=E.point;else{var A=m-d;y=ae(0===_?a:new t.Point(c.getx(A),c.gety(A)),S,g,b-_+1,h)}}_+=x,x=g.dist(y)}var T=(b-_)/x,C=y.sub(g),k=C.mult(T)._add(g);k._add(C._unit()._perp()._mult(r*d));var M=v+Math.atan2(y.y-g.y,y.x-g.x);return w.push(k),{point:k,angle:M,path:w}}Kt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Kt.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Kt.prototype.insertCircle=function(t,e,n,r){this._forEachCell(e-r,n-r,e+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(r)},Kt.prototype._insertBoxCell=function(t,e,n,r,i,o){this.boxCells[i].push(o)},Kt.prototype._insertCircleCell=function(t,e,n,r,i,o){this.circleCells[i].push(o)},Kt.prototype._query=function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],h=this.circles[3*u+2];a.push({key:this.circleKeys[u],x1:l-h,y1:c-h,x2:l+h,y2:c+h})}return o?a.filter(o):a}return this._forEachCell(t,e,n,r,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a},Kt.prototype._queryCircle=function(t,e,n,r,i){var o=t-n,a=t+n,s=e-n,u=e+n;if(a<0||o>this.width||u<0||s>this.height)return!r&&[];var l=[];return this._forEachCell(o,s,a,u,this._queryCellCircle,l,{hitTest:r,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},i),r?l.length>0:l},Kt.prototype.query=function(t,e,n,r,i){return this._query(t,e,n,r,!1,i)},Kt.prototype.hitTest=function(t,e,n,r,i){return this._query(t,e,n,r,!0,i)},Kt.prototype.hitTestCircle=function(t,e,n,r){return this._queryCircle(t,e,n,!0,r)},Kt.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l)for(var c=this.bboxes,h=0,p=l;h<p.length;h+=1){var f=p[h];if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=c[d+2]&&e<=c[d+3]&&n>=c[d+0]&&r>=c[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}var v=this.circleCells[i];if(null!==v)for(var m=this.circles,y=0,g=v;y<g.length;y+=1){var _=g[y];if(!u.circle[_]){u.circle[_]=!0;var x=3*_;if(this._circleAndRectCollide(m[x],m[x+1],m[x+2],t,e,n,r)&&(!s||s(this.circleKeys[_]))){if(a.hitTest)return o.push(!0),!0;var b=m[x],w=m[x+1],S=m[x+2];o.push({key:this.circleKeys[_],x1:b-S,y1:w-S,x2:b+S,y2:w+S})}}}},Kt.prototype._queryCellCircle=function(t,e,n,r,i,o,a,s){var u=a.circle,l=a.seenUids,c=this.boxCells[i];if(null!==c)for(var h=this.bboxes,p=0,f=c;p<f.length;p+=1){var d=f[p];if(!l.box[d]){l.box[d]=!0;var v=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[v+0],h[v+1],h[v+2],h[v+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var m=this.circleCells[i];if(null!==m)for(var y=this.circles,g=0,_=m;g<_.length;g+=1){var x=_[g];if(!l.circle[x]){l.circle[x]=!0;var b=3*x;if(this._circlesCollide(y[b],y[b+1],y[b+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[x])))return o.push(!0),!0}}},Kt.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++)if(i.call(this,t,e,n,r,this.xCellCount*f+p,o,a,s))return},Kt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Kt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Kt.prototype._circlesCollide=function(t,e,n,r,i,o){var a=r-t,s=i-e,u=n+o;return u*u>a*a+s*s},Kt.prototype._circleAndRectCollide=function(t,e,n,r,i,o,a){var s=(o-r)/2,u=Math.abs(t-(r+s));if(u>s+n)return!1;var l=(a-i)/2,c=Math.abs(e-(i+l));if(c>l+n)return!1;if(u<=s||c<=l)return!0;var h=u-s,p=c-l;return h*h+p*p<=n*n};var ue=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function le(t,e){for(var n=0;n<t;n++){var r=e.length;e.resize(r+4),e.float32.set(ue,3*r)}}function ce(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t[3]=n[3]*r+n[7]*i+n[15],t}var he=function(t,e,n){void 0===e&&(e=new Kt(t.width+200,t.height+200,25)),void 0===n&&(n=new Kt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function pe(e,n,r){return n*(t.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}he.prototype.placeCollisionBox=function(t,e,n,r,i){var o=this.projectAndGetPerspectiveRatio(r,t.anchorPointX,t.anchorPointY),a=n*o.perspectiveRatio,s=t.x1*a+o.point.x,u=t.y1*a+o.point.y,l=t.x2*a+o.point.x,c=t.y2*a+o.point.y;return!this.isInsideGrid(s,u,l,c)||!e&&this.grid.hitTest(s,u,l,c,i)?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},he.prototype.placeCollisionCircles=function(e,n,r,i,o,a,s,u,l,c,h,p,f){var d=[],v=new t.Point(n.anchorX,n.anchorY),m=$t(v,a),y=te(this.transform.cameraToCenterDistance,m.signedDistanceFromCamera),g=(c?o/y:o*y)/t.ONE_EM,_=$t(v,s).point,x=re(g,i,n.lineOffsetX*g,n.lineOffsetY*g,!1,_,v,n,r,s,{}),b=!1,w=!1,S=!0;if(x){for(var E=.5*p*y+f,A=new t.Point(-100,-100),T=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),C=new Yt,k=x.first,M=x.last,I=[],P=k.path.length-1;P>=1;P--)I.push(k.path[P]);for(var L=1;L<M.path.length;L++)I.push(M.path[L]);var R=2.5*E;if(u){var O=I.map((function(t){return $t(t,u)}));I=O.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:O.map((function(t){return t.point}))}var D=[];if(I.length>0){for(var N=I[0].clone(),z=I[0].clone(),F=1;F<I.length;F++)N.x=Math.min(N.x,I[F].x),N.y=Math.min(N.y,I[F].y),z.x=Math.max(z.x,I[F].x),z.y=Math.max(z.y,I[F].y);D=N.x>=A.x&&z.x<=T.x&&N.y>=A.y&&z.y<=T.y?[I]:z.x<A.x||N.x>T.x||z.y<A.y||N.y>T.y?[]:t.clipLine([I],A.x,A.y,T.x,T.y)}for(var B=0,U=D;B<U.length;B+=1){var j;C.reset(U[B],.25*E),j=C.length<=.5*E?1:Math.ceil(C.paddedLength/R)+1;for(var V=0;V<j;V++){var G=V/Math.max(j-1,1),H=C.lerp(G),W=H.x+100,Z=H.y+100;d.push(W,Z,E,0);var q=W-E,X=Z-E,Y=W+E,K=Z+E;if(S=S&&this.isOffscreen(q,X,Y,K),w=w||this.isInsideGrid(q,X,Y,K),!e&&this.grid.hitTestCircle(W,Z,E,h)&&(b=!0,!l))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!l&&b||!w?[]:d,offscreen:S,collisionDetected:b}},he.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var n=[],r=1/0,i=1/0,o=-1/0,a=-1/0,s=0,u=e;s<u.length;s+=1){var l=u[s],c=new t.Point(l.x+100,l.y+100);r=Math.min(r,c.x),i=Math.min(i,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y),n.push(c)}for(var h={},p={},f=0,d=this.grid.query(r,i,o,a).concat(this.ignoredGrid.query(r,i,o,a));f<d.length;f+=1){var v=d[f],m=v.key;if(void 0===h[m.bucketInstanceId]&&(h[m.bucketInstanceId]={}),!h[m.bucketInstanceId][m.featureIndex]){var y=[new t.Point(v.x1,v.y1),new t.Point(v.x2,v.y1),new t.Point(v.x2,v.y2),new t.Point(v.x1,v.y2)];t.polygonIntersectsPolygon(n,y)&&(h[m.bucketInstanceId][m.featureIndex]=!0,void 0===p[m.bucketInstanceId]&&(p[m.bucketInstanceId]=[]),p[m.bucketInstanceId].push(m.featureIndex))}}return p},he.prototype.insertCollisionBox=function(t,e,n,r,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},t[0],t[1],t[2],t[3])},he.prototype.insertCollisionCircles=function(t,e,n,r,i){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:r,collisionGroupID:i},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},he.prototype.projectAndGetPerspectiveRatio=function(e,n,r){var i=[n,r,0,1];return ce(i,i,e),{point:new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},he.prototype.isOffscreen=function(t,e,n,r){return n<100||t>=this.screenRightBoundary||r<100||e>this.screenBottomBoundary},he.prototype.isInsideGrid=function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary},he.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var fe=function(t,e,n,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&n?1:0,this.placed=n};fe.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var de=function(t,e,n,r,i){this.text=new fe(t?t.text:null,e,n,i),this.icon=new fe(t?t.icon:null,e,r,i)};de.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ve=function(t,e,n){this.text=t,this.icon=e,this.skipFade=n},me=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},ye=function(t,e,n,r,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i},ge=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function _e(e,n,r,i,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*n,u=-(a.verticalAlign-.5)*r,l=t.evaluateVariableOffset(e,i);return new t.Point(s+l[0]*o,u+l[1]*o)}function xe(e,n,r,i,o,a){var s=e.x1,u=e.x2,l=e.y1,c=e.y2,h=e.anchorPointX,p=e.anchorPointY,f=new t.Point(n,r);return i&&f._rotate(o?a:-a),{x1:s+f.x,y1:l+f.y,x2:u+f.x,y2:c+f.y,anchorPointX:h,anchorPointY:p}}ge.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var be=function(t,e,n,r){this.transform=t.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new ge(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}};function we(t,e,n,r,i){t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0)}be.prototype.getBucketParts=function(e,n,r,i){var o=r.getBucket(n),a=r.latestFeatureIndex;if(o&&a&&n.id===o.layerIds[0]){var s=r.collisionBoxArray,u=o.layers[0].layout,l=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),p="map"===u.get("text-pitch-alignment"),f="map"===u.get("text-rotation-alignment"),d=pe(r,1,this.transform.zoom),v=Qt(h,p,f,this.transform,d),m=null;if(p){var y=Jt(h,p,f,this.transform,d);m=t.multiply([],this.transform.labelPlaneMatrix,y)}this.retainedQueryData[o.bucketInstanceId]=new ye(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID);var g={bucket:o,layout:u,posMatrix:h,textLabelPlaneMatrix:v,labelToScreenMatrix:m,scale:l,textPixelRatio:c,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(var _=0,x=o.sortKeyRanges;_<x.length;_+=1){var b=x[_];e.push({sortKey:b.sortKey,symbolInstanceStart:b.symbolInstanceStart,symbolInstanceEnd:b.symbolInstanceEnd,parameters:g})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:g})}},be.prototype.attemptAnchorPlacement=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d){var v,m=[h.textOffset0,h.textOffset1],y=_e(t,n,r,m,i),g=this.collisionIndex.placeCollisionBox(xe(e,y.x,y.y,o,a,this.transform.angle),c,s,u,l.predicate);if(!d||0!==this.collisionIndex.placeCollisionBox(xe(d,y.x,y.y,o,a,this.transform.angle),c,s,u,l.predicate).box.length)return g.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(v=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:m,width:n,height:r,anchor:t,textBoxScale:i,prevAnchor:v},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:y,placedGlyphBoxes:g}):void 0},be.prototype.placeLayerBucketPart=function(e,n,r){var i=this,o=e.parameters,a=o.bucket,s=o.layout,u=o.posMatrix,l=o.textLabelPlaneMatrix,c=o.labelToScreenMatrix,h=o.textPixelRatio,p=o.holdingForFade,f=o.collisionBoxArray,d=o.partiallyEvaluatedTextSize,v=o.collisionGroup,m=s.get("text-optional"),y=s.get("icon-optional"),g=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),S="viewport-y"===s.get("symbol-z-order"),E=g&&(_||!a.hasIconData()||y),A=_&&(g||!a.hasTextData()||m);!a.collisionArrays&&f&&a.deserializeCollisionBoxes(f);var T=function(e,o){if(!n[e.crossTileID])if(p)i.placements[e.crossTileID]=new ve(!1,!1,!1);else{var f,S=!1,T=!1,C=!0,k=null,M={box:null,offscreen:null},I={box:null,offscreen:null},P=null,L=null,R=0,O=0,D=0;o.textFeatureIndex?R=o.textFeatureIndex:e.useRuntimeCollisionCircles&&(R=e.featureIndex),o.verticalTextFeatureIndex&&(O=o.verticalTextFeatureIndex);var N=o.textBox;if(N){var z=function(n){var r=t.WritingMode.horizontal;if(a.allowVerticalPlacement&&!n&&i.prevPlacement){var o=i.prevPlacement.placedOrientations[e.crossTileID];o&&(i.placedOrientations[e.crossTileID]=o,i.markUsedOrientation(a,r=o,e))}return r},F=function(n,r){if(a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&o.verticalTextBox)for(var i=0,s=a.writingModes;i<s.length&&(s[i]===t.WritingMode.vertical?(M=r(),I=M):M=n(),!(M&&M.box&&M.box.length));i+=1);else M=n()};if(s.get("text-variable-anchor")){var B=s.get("text-variable-anchor");if(i.prevPlacement&&i.prevPlacement.variableOffsets[e.crossTileID]){var U=i.prevPlacement.variableOffsets[e.crossTileID];B.indexOf(U.anchor)>0&&(B=B.filter((function(t){return t!==U.anchor}))).unshift(U.anchor)}var j=function(t,n,r){for(var o=t.x2-t.x1,s=t.y2-t.y1,l=e.textBoxScale,c=w&&!_?n:null,p={box:[],offscreen:!1},f=g?2*B.length:B.length,d=0;d<f;++d){var m=i.attemptAnchorPlacement(B[d%B.length],t,o,s,l,x,b,h,u,v,d>=B.length,e,a,r,c);if(m&&(p=m.placedGlyphBoxes)&&p.box&&p.box.length){S=!0,k=m.shift;break}}return p};F((function(){return j(N,o.iconBox,t.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&!(M&&M.box&&M.box.length)&&e.numVerticalGlyphVertices>0&&n?j(n,o.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),M&&(S=M.box,C=M.offscreen);var V=z(M&&M.box);if(!S&&i.prevPlacement){var G=i.prevPlacement.variableOffsets[e.crossTileID];G&&(i.variableOffsets[e.crossTileID]=G,i.markUsedJustification(a,G.anchor,e,V))}}else{var H=function(t,n){var r=i.collisionIndex.placeCollisionBox(t,g,h,u,v.predicate);return r&&r.box&&r.box.length&&(i.markUsedOrientation(a,n,e),i.placedOrientations[e.crossTileID]=n),r};F((function(){return H(N,t.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?H(n,t.WritingMode.vertical):{box:null,offscreen:null}})),z(M&&M.box&&M.box.length)}}if(S=(f=M)&&f.box&&f.box.length>0,C=f&&f.offscreen,e.useRuntimeCollisionCircles){var W=a.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),Z=t.evaluateSizeForFeature(a.textSizeData,d,W),q=s.get("text-padding");P=i.collisionIndex.placeCollisionCircles(g,W,a.lineVertexArray,a.glyphOffsetArray,Z,u,l,c,r,b,v.predicate,e.collisionCircleDiameter,q),S=g||P.circles.length>0&&!P.collisionDetected,C=C&&P.offscreen}if(o.iconFeatureIndex&&(D=o.iconFeatureIndex),o.iconBox){var X=function(t){var e=w&&k?xe(t,k.x,k.y,x,b,i.transform.angle):t;return i.collisionIndex.placeCollisionBox(e,_,h,u,v.predicate)};T=I&&I.box&&I.box.length&&o.verticalIconBox?(L=X(o.verticalIconBox)).box.length>0:(L=X(o.iconBox)).box.length>0,C=C&&L.offscreen}var Y=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,K=y||0===e.numIconVertices;if(Y||K?K?Y||(T=T&&S):S=T&&S:T=S=T&&S,S&&f&&f.box&&i.collisionIndex.insertCollisionBox(f.box,s.get("text-ignore-placement"),a.bucketInstanceId,I&&I.box&&O?O:R,v.ID),T&&L&&i.collisionIndex.insertCollisionBox(L.box,s.get("icon-ignore-placement"),a.bucketInstanceId,D,v.ID),P&&(S&&i.collisionIndex.insertCollisionCircles(P.circles,s.get("text-ignore-placement"),a.bucketInstanceId,R,v.ID),r)){var Q=a.bucketInstanceId,J=i.collisionCircleArrays[Q];void 0===J&&(J=i.collisionCircleArrays[Q]=new me);for(var $=0;$<P.circles.length;$+=4)J.circles.push(P.circles[$+0]),J.circles.push(P.circles[$+1]),J.circles.push(P.circles[$+2]),J.circles.push(P.collisionDetected?1:0)}i.placements[e.crossTileID]=new ve(S||E,T||A,C||a.justReloaded),n[e.crossTileID]=!0}};if(S)for(var C=a.getSortedSymbolIndexes(this.transform.angle),k=C.length-1;k>=0;--k){var M=C[k];T(a.symbolInstances.get(M),a.collisionArrays[M])}else for(var I=e.symbolInstanceStart;I<e.symbolInstanceEnd;I++)T(a.symbolInstances.get(I),a.collisionArrays[I]);if(r&&a.bucketInstanceId in this.collisionCircleArrays){var P=this.collisionCircleArrays[a.bucketInstanceId];t.invert(P.invProjMatrix,u),P.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1},be.prototype.markUsedJustification=function(e,n,r,i){var o;o=i===t.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(n)];for(var a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];a<s.length;a+=1){var u=s[a];u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=o>=0&&u!==o?0:r.crossTileID)}},be.prototype.markUsedOrientation=function(e,n,r){for(var i=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,o=n===t.WritingMode.vertical?n:0,a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];a<s.length;a+=1)e.text.placedSymbolArray.get(s[a]).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)},be.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var r=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],l=i[s];l?(this.opacities[s]=new de(l,r,u.text,u.icon),n=n||u.text!==l.text.placed||u.icon!==l.icon.placed):(this.opacities[s]=new de(null,r,u.text,u.icon,u.skipFade),n=n||u.text||u.icon)}for(var c in i){var h=i[c];if(!this.opacities[c]){var p=new de(h,r,!1,!1);p.isHidden()||(this.opacities[c]=p,n=n||h.text.placed||h.icon.placed)}}for(var f in o)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=o[f]);for(var d in a)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=a[d]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},be.prototype.updateLayerOpacities=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1){var o=i[r],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,n,o.collisionBoxArray)}},be.prototype.updateBucketOpacities=function(e,n,r){var i=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var o=e.layers[0].layout,a=new de(null,0,!1,!1,!0),s=o.get("text-allow-overlap"),u=o.get("icon-allow-overlap"),l=o.get("text-variable-anchor"),c="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),p="none"!==o.get("icon-text-fit"),f=new de(null,0,s&&(u||!e.hasIconData()||o.get("icon-optional")),u&&(s||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);for(var d=function(t,e,n){for(var r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(n)},v=function(r){var o=e.symbolInstances.get(r),s=o.numHorizontalGlyphVertices,u=o.numVerticalGlyphVertices,v=o.crossTileID,m=i.opacities[v];n[v]?m=a:m||(i.opacities[v]=m=f),n[v]=!0;var y=o.numIconVertices>0,g=i.placedOrientations[o.crossTileID],_=g===t.WritingMode.vertical,x=g===t.WritingMode.horizontal||g===t.WritingMode.horizontalOnly;if(s>0||u>0){var b=Ie(m.text);d(e.text,s,_?Pe:b),d(e.text,u,x?Pe:b);var w=m.text.isHidden();[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=w||_?1:0)})),o.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).hidden=w||x?1:0);var S=i.variableOffsets[o.crossTileID];S&&i.markUsedJustification(e,S.anchor,o,g);var E=i.placedOrientations[o.crossTileID];E&&(i.markUsedJustification(e,"left",o,E),i.markUsedOrientation(e,E,o))}if(y){var A=Ie(m.icon),T=!(p&&o.verticalPlacedIconSymbolIndex&&_);o.placedIconSymbolIndex>=0&&(d(e.icon,o.numIconVertices,T?A:Pe),e.icon.placedSymbolArray.get(o.placedIconSymbolIndex).hidden=m.icon.isHidden()),o.verticalPlacedIconSymbolIndex>=0&&(d(e.icon,o.numVerticalIconVertices,T?Pe:A),e.icon.placedSymbolArray.get(o.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var C=e.collisionArrays[r];if(C){var k=new t.Point(0,0);if(C.textBox||C.verticalTextBox){var M=!0;if(l){var I=i.variableOffsets[v];I?(k=_e(I.anchor,I.width,I.height,I.textOffset,I.textBoxScale),c&&k._rotate(h?i.transform.angle:-i.transform.angle)):M=!1}C.textBox&&we(e.textCollisionBox.collisionVertexArray,m.text.placed,!M||_,k.x,k.y),C.verticalTextBox&&we(e.textCollisionBox.collisionVertexArray,m.text.placed,!M||x,k.x,k.y)}var P=Boolean(!x&&C.verticalIconBox);C.iconBox&&we(e.iconCollisionBox.collisionVertexArray,m.icon.placed,P,p?k.x:0,p?k.y:0),C.verticalIconBox&&we(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!P,p?k.x:0,p?k.y:0)}}},m=0;m<e.symbolInstances.length;m++)v(m);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var y=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=y.invProjMatrix,e.placementViewportMatrix=y.viewportMatrix,e.collisionCircleArray=y.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},be.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},be.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},be.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},be.prototype.stillRecent=function(t,e){var n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t},be.prototype.setStale=function(){this.stale=!0};var Se=Math.pow(2,25),Ee=Math.pow(2,24),Ae=Math.pow(2,17),Te=Math.pow(2,16),Ce=Math.pow(2,9),ke=Math.pow(2,8),Me=Math.pow(2,1);function Ie(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*Se+e*Ee+n*Ae+e*Te+n*Ce+e*ke+n*Me+e}var Pe=0,Le=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Le.prototype.continuePlacement=function(t,e,n,r,i){for(var o=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1};var Re=function(t,e,n,r,i,o,a){this.placement=new be(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1};Re.prototype.isDone=function(){return this._done},Re.prototype.continuePlacement=function(e,n,r){for(var i=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!i._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=n[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Le(s)),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Re.prototype.commit=function(t){return this.placement.commit(t),this.placement};var Oe=512/t.EXTENT/2,De=function(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var r=0;r<e.length;r++){var i=e.get(r),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}};De.prototype.getScaledCoordinates=function(e,n){var r=Oe/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*r),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*r)}},De.prototype.findMatches=function(t,e,n){for(var r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var o=t.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),u=0,l=a;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=r&&Math.abs(c.coord.y-s.y)<=r&&!n[c.crossTileID]){n[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var Ne=function(){this.maxCrossTileID=0};Ne.prototype.generate=function(){return++this.maxCrossTileID};var ze=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ze.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var n in this.indexes){var r=this.indexes[n],i={};for(var o in r){var a=r[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),i[a.tileID.key]=a}this.indexes[n]=i}this.lng=t},ze.prototype.addBucket=function(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var u=a[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,i)}else{var l=a[t.scaledTo(Number(o)).key];l&&l.findMatches(e.symbolInstances,t,i)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=n.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new De(t,e.symbolInstances,e.bucketInstanceId),!0},ze.prototype.removeBucketCrossTileIDs=function(t,e){for(var n in e.indexedSymbolInstances)for(var r=0,i=e.indexedSymbolInstances[n];r<i.length;r+=1)delete this.usedCrossTileIDs[t][i[r].crossTileID]},ze.prototype.removeStaleBuckets=function(t){var e=!1;for(var n in this.indexes){var r=this.indexes[n];for(var i in r)t[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],e=!0)}return e};var Fe=function(){this.layerIndexes={},this.crossTileIDs=new Ne,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Fe.prototype.addLayer=function(t,e,n){var r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new ze);var i=!1,o={};r.handleWrapJump(n);for(var a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(u.tileID,l,this.crossTileIDs)&&(i=!0),o[l.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(i=!0),i},Fe.prototype.pruneUnusedLayers=function(t){var e={};for(var n in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[n]||delete this.layerIndexes[n]};var Be=function(e,n){return t.emitValidationErrors(e,n&&n.filter((function(t){return"source.canvas"!==t.identifier})))},Ue=t.pick(jt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),je=t.pick(jt,["setCenter","setZoom","setBearing","setPitch"]),Ve=function(){var e={},n=t.styleSpec.$version;for(var r in t.styleSpec.$root){var i,o=t.styleSpec.$root[r];o.required&&null!=(i="version"===r?n:"array"===o.type?[]:{})&&(e[r]=i)}return e}(),Ge=function(e){function n(r,i){var o=this;void 0===i&&(i={}),e.call(this),this.map=r,this.dispatcher=new E(Ft(),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new _(r._requestManager,i.localIdeographFontFamily),this.lineAtlas=new S(256,512),this.crossTileSymbolIndex=new Fe,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=n.registerForPluginStateChange((function(e){a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,n){if(t.triggerPluginCompletionEvent(e),n&&n.every((function(t){return t})))for(var r in a.sourceCaches)a.sourceCaches[r].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var n=e.getSource();if(n&&n.vectorLayerIds)for(var r in o._layers){var i=o._layers[r];i.source===n.id&&o._validateLayer(i)}}}}))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadURL=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,(function(e,n){r._request=null,e?r.fire(new t.ErrorEvent(e)):n&&r._load(n,i)}))},n.prototype.loadJSON=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){r._request=null,r._load(e,!1!==n.validate)}))},n.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ve,!1)},n.prototype._load=function(e,n){if(!n||!Be(this,t.validateStyle(e))){for(var r in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(r,e.sources[r],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var i=Ut(this.stylesheet.layers);this._order=i.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var o=0,a=i;o<a.length;o+=1){var s=a[o];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},n.prototype._loadSprite=function(e){var n=this;this._spriteRequest=function(e,n,r){var i,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){u=null,a||(a=t,i=e,c())})),l=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){l=null,a||(a=t,o=e,c())}));function c(){if(a)r(a);else if(i&&o){var e=t.browser.getImageData(o),n={};for(var s in i){var u=i[s],l=u.width,c=u.height,h=u.x,p=u.y,f=u.sdf,d=u.pixelRatio,v=u.stretchX,m=u.stretchY,y=u.content,g=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,g,{x:h,y:p},{x:0,y:0},{width:l,height:c}),n[s]={data:g,pixelRatio:d,sdf:f,stretchX:v,stretchY:m,content:y}}r(null,n)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,(function(e,r){if(n._spriteRequest=null,e)n.fire(new t.ErrorEvent(e));else if(r)for(var i in r)n.imageManager.addImage(i,r[i]);n.imageManager.setLoaded(!0),n._availableImages=n.imageManager.listImages(),n.dispatcher.broadcast("setImages",n._availableImages),n.fire(new t.Event("data",{dataType:"style"}))}))},n.prototype._validateLayer=function(e){var n=this.sourceCaches[e.source];if(n){var r=e.sourceLayer;if(r){var i=n.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')))}}},n.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=this._layers[r[n]];"custom"!==i.type&&e.push(i.serialize())}return e},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},n.prototype.update=function(e){if(this._loaded){var n=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var o in(r.length||i.length)&&this._updateWorkerLayers(r,i),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}var u={};for(var l in this.sourceCaches){var c=this.sourceCaches[l];u[l]=c.used,c.used=!1}for(var h=0,p=this._order;h<p.length;h+=1){var f=this._layers[p[h]];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(var d in u){var v=this.sourceCaches[d];u[d]!==v.used&&v.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}},n.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},n.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},n.prototype.setState=function(e){var n=this;if(this._checkLoaded(),Be(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Ut(e.layers);var r=function(e,n){if(!e)return[{command:jt.setStyle,args:[n]}];var r=[];try{if(!t.deepEqual(e.version,n.version))return[{command:jt.setStyle,args:[n]}];t.deepEqual(e.center,n.center)||r.push({command:jt.setCenter,args:[n.center]}),t.deepEqual(e.zoom,n.zoom)||r.push({command:jt.setZoom,args:[n.zoom]}),t.deepEqual(e.bearing,n.bearing)||r.push({command:jt.setBearing,args:[n.bearing]}),t.deepEqual(e.pitch,n.pitch)||r.push({command:jt.setPitch,args:[n.pitch]}),t.deepEqual(e.sprite,n.sprite)||r.push({command:jt.setSprite,args:[n.sprite]}),t.deepEqual(e.glyphs,n.glyphs)||r.push({command:jt.setGlyphs,args:[n.glyphs]}),t.deepEqual(e.transition,n.transition)||r.push({command:jt.setTransition,args:[n.transition]}),t.deepEqual(e.light,n.light)||r.push({command:jt.setLight,args:[n.light]});var i={},o=[];!function(e,n,r,i){var o;for(o in n=n||{},e=e||{})e.hasOwnProperty(o)&&(n.hasOwnProperty(o)||Gt(o,r,i));for(o in n)n.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],n[o])||("geojson"===e[o].type&&"geojson"===n[o].type&&Wt(e,n,o)?r.push({command:jt.setGeoJSONSourceData,args:[o,n[o].data]}):Ht(o,n,r,i)):Vt(o,n,r))}(e.sources,n.sources,o,i);var a=[];e.layers&&e.layers.forEach((function(t){i[t.source]?r.push({command:jt.removeLayer,args:[t.id]}):a.push(t)})),r=r.concat(o),function(e,n,r){n=n||[];var i,o,a,s,u,l,c,h=(e=e||[]).map(qt),p=n.map(qt),f=e.reduce(Xt,{}),d=n.reduce(Xt,{}),v=h.slice(),m=Object.create(null);for(i=0,o=0;i<h.length;i++)d.hasOwnProperty(a=h[i])?o++:(r.push({command:jt.removeLayer,args:[a]}),v.splice(v.indexOf(a,o),1));for(i=0,o=0;i<p.length;i++)v[v.length-1-i]!==(a=p[p.length-1-i])&&(f.hasOwnProperty(a)?(r.push({command:jt.removeLayer,args:[a]}),v.splice(v.lastIndexOf(a,v.length-o),1)):o++,r.push({command:jt.addLayer,args:[d[a],l=v[v.length-i]]}),v.splice(v.length-i,0,a),m[a]=!0);for(i=0;i<p.length;i++)if(s=f[a=p[i]],u=d[a],!m[a]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(c in Zt(s.layout,u.layout,r,a,null,jt.setLayoutProperty),Zt(s.paint,u.paint,r,a,null,jt.setPaintProperty),t.deepEqual(s.filter,u.filter)||r.push({command:jt.setFilter,args:[a,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||r.push({command:jt.setLayerZoomRange,args:[a,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Zt(s[c],u[c],r,a,c.slice(6),jt.setPaintProperty):t.deepEqual(s[c],u[c])||r.push({command:jt.setLayerProperty,args:[a,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Zt(s[c],u[c],r,a,c.slice(6),jt.setPaintProperty):t.deepEqual(s[c],u[c])||r.push({command:jt.setLayerProperty,args:[a,c,u[c]]}))}else r.push({command:jt.removeLayer,args:[a]}),l=v[v.lastIndexOf(a)+1],r.push({command:jt.addLayer,args:[u,l]})}(a,n.layers,r)}catch(t){console.warn("Unable to compute style diff:",t),r=[{command:jt.setStyle,args:[n]}]}return r}(this.serialize(),e).filter((function(t){return!(t.command in je)}));if(0===r.length)return!1;var i=r.filter((function(t){return!(t.command in Ue)}));if(i.length>0)throw new Error("Unimplemented: "+i.map((function(t){return t.command})).join(", ")+".");return r.forEach((function(t){"setTransition"!==t.command&&n[t.command].apply(n,t.args)})),this.stylesheet=e,!0},n.prototype.addImage=function(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this._afterImageUpdated(e)},n.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},n.prototype.getImage=function(t){return this.imageManager.getImage(t)},n.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},n.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(e,n,r){var i=this;if(void 0===r&&(r={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(n).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,n,null,r))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var o=this.sourceCaches[e]=new It(e,n,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:i.loaded(),source:o.serialize(),sourceId:e}})),o.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var n in this._layers)if(this._layers[n].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+n+'" is using it.')));var r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},n.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},n.prototype.addLayer=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=e.id;if(this.getLayer(i))this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var o;if("custom"===e.type){if(Be(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},r))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[o.id]=o.serialize()}var a=n?this._order.indexOf(n):this._order.length;if(n&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.')));else{if(this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o,this._removedLayers[i]&&o.source&&"custom"!==o.type){var s=this._removedLayers[i];delete this._removedLayers[i],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},n.prototype.moveLayer=function(e,n){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==n){var r=this._order.indexOf(e);this._order.splice(r,1);var i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.'))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},n.prototype.removeLayer=function(e){this._checkLoaded();var n=this._layers[e];if(n){n.setEventedParent(null);var r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},n.prototype.getLayer=function(t){return this._layers[t]},n.prototype.hasLayer=function(t){return t in this._layers},n.prototype.setLayerZoomRange=function(e,n,r){this._checkLoaded();var i=this.getLayer(e);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},n.prototype.setFilter=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,n))return null==n?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,"layers."+i.id+".filter",n,null,r)||(i.filter=t.clone$1(n),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},n.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},n.prototype.setLayoutProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(n),r)||(o.setLayoutProperty(n,r,i),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getLayoutProperty=function(e,n){var r=this.getLayer(e);if(r)return r.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},n.prototype.setPaintProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(n),r)||(o.setPaintProperty(n,r,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},n.prototype.setFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=e.sourceLayer,o=this.sourceCaches[r];if(void 0!==o){var a=o.getSource().type;"geojson"===a&&i?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==a||i?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),o.setFeatureState(i,e.id,n)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.removeFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=this.sourceCaches[r];if(void 0!==i){var o=i.getSource().type,a="vector"===o?e.sourceLayer:void 0;"vector"!==o||a?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):i.removeFeatureState(a,e.id,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.getFeatureState=function(e){this._checkLoaded();var n=e.source,r=e.sourceLayer,i=this.sourceCaches[n];if(void 0!==i){if("vector"!==i.getSource().type||r)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),i.getFeatureState(r,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},n.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},n.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,n=function(t){return"fill-extrusion"===e._layers[t].type},r={},i=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(n(a)){r[a]=o;for(var s=0,u=t;s<u.length;s+=1){var l=u[s][a];if(l)for(var c=0,h=l;c<h.length;c+=1)i.push(h[c])}}}i.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var p=[],f=this._order.length-1;f>=0;f--){var d=this._order[f];if(n(d))for(var v=i.length-1;v>=0;v--){var m=i[v].feature;if(r[m.layer.id]<f)break;p.push(m),i.pop()}else for(var y=0,g=t;y<g.length;y+=1){var _=g[y][d];if(_)for(var x=0,b=_;x<b.length;x+=1)p.push(b[x].feature)}}return p},n.prototype.queryRenderedFeatures=function(e,n,r){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);var i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=n.layers;o<a.length;o+=1){var s=a[o],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[u.source]=!0}}var l=[];for(var c in n.availableImages=this._availableImages,this.sourceCaches)n.layers&&!i[c]||l.push(z(this.sourceCaches[c],this._layers,this._serializedLayers,e,n,r));return this.placement&&l.push(function(t,e,n,r,i,o,a){for(var s={},u=o.queryRenderedSymbols(r),l=[],c=0,h=Object.keys(u).map(Number);c<h.length;c+=1)l.push(a[h[c]]);l.sort(F);for(var p=function(){var n=d[f],r=n.featureIndex.lookupSymbolFeatures(u[n.bucketInstanceId],e,n.bucketIndex,n.sourceLayerIndex,i.filter,i.layers,i.availableImages,t);for(var o in r){var a=s[o]=s[o]||[],l=r[o];l.sort((function(t,e){var r=n.featureSortOrder;if(r){var i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(var c=0,h=l;c<h.length;c+=1)a.push(h[c])}},f=0,d=l;f<d.length;f+=1)p();var v=function(e){s[e].forEach((function(r){var i=r.feature,o=n[t[e].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}))};for(var m in s)v(m);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},n.prototype.querySourceFeatures=function(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);var r=this.sourceCaches[e];return r?function(t,e){for(var n=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),r=[],i={},o=0;o<n.length;o++){var a=n[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(r,e))}return r}(r,n):[]},n.prototype.addSourceType=function(t,e,r){return n.getSourceType(t)?r(new Error('A source type called "'+t+'" already exists.')):(n.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},r):r(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(e,n){void 0===n&&(n={}),this._checkLoaded();var r=this.light.getLight(),i=!1;for(var o in e)if(!t.deepEqual(e[o],r[o])){i=!0;break}if(i){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(a)}},n.prototype._validate=function(e,n,r,i,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&Be(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:r,styleSpec:t.styleSpec},i)))},n.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var n in this.sourceCaches)this.sourceCaches[n].clearTiles(),this.sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},n.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},n.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},n.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},n.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},n.prototype._updatePlacement=function(e,n,r,i,o){void 0===o&&(o=!1);for(var a=!1,s=!1,u={},l=0,c=this._order;l<c.length;l+=1){var h=this._layers[c[l]];if("symbol"===h.type){if(!u[h.source]){var p=this.sourceCaches[h.source];u[h.source]=p.getRenderableIds(!0).map((function(t){return p.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var f=this.crossTileSymbolIndex.addLayer(h,u[h.source],e.center.lng);a=a||f}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Re(e,this._order,o,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,u),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(var d=0,v=this._order;d<v.length;d+=1){var m=this._layers[v[d]];"symbol"===m.type&&this.placement.updateLayerOpacities(m,u[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},n.prototype.getImages=function(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();var r=this.sourceCaches[e.source];r&&r.setDependencies(e.tileID.key,e.type,e.icons)},n.prototype.getGlyphs=function(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)},n.prototype.getResource=function(e,n,r){return t.makeRequest(n,r)},n}(t.Evented);Ge.getSourceType=function(t){return D[t]},Ge.setSourceType=function(t,e){D[t]=e},Ge.registerForPluginStateChange=t.registerForPluginStateChange;var He=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),We=gn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),Ze=gn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),qe=gn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Xe=gn("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ye=gn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ke=gn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Qe=gn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Je=gn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),$e=gn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),tn=gn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),en=gn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),nn=gn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),rn=gn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),on=gn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),an=gn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),sn=gn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),un=gn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ln=gn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cn=gn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hn=gn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),pn=gn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),fn=gn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),dn=gn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),vn=gn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),mn=gn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),yn=gn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function gn(t,e){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/attribute ([\w]+) ([\w]+)/g),i=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=o?o.concat(i):i,s={};return{fragmentSource:t=t.replace(n,(function(t,e,n,r,i){return s[i]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),vertexSource:e=e.replace(n,(function(t,e,n,r,i){var o="float"===r?"vec2":"vec4",a=i.match(/color/)?"color":o;return s[i]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),staticAttributes:r,staticUniforms:a}}var _n=Object.freeze({__proto__:null,prelude:We,background:Ze,backgroundPattern:qe,circle:Xe,clippingMask:Ye,heatmap:Ke,heatmapTexture:Qe,collisionBox:Je,collisionCircle:$e,debug:tn,fill:en,fillOutline:nn,fillOutlinePattern:rn,fillPattern:on,fillExtrusion:an,fillExtrusionPattern:sn,hillshadePrepare:un,hillshade:ln,line:cn,lineGradient:hn,linePattern:pn,lineSDF:fn,raster:dn,symbolIcon:vn,symbolSDF:mn,symbolTextAndIcon:yn}),xn=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function bn(t){for(var e=[],n=0;n<t.length;n++)if(null!==t[n]){var r=t[n].split(" ");e.push(r.pop())}return e}xn.prototype.bind=function(t,e,n,r,i,o,a,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==r.length,l=0;!u&&l<r.length;l++)this.boundPaintVertexBuffers[l]!==r[l]&&(u=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===n&&!u&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(e,n,r,i,o,a,s)},xn.prototype.freshBind=function(t,e,n,r,i,o,a){var s,u=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=l.currentNumAttributes||0;for(var h=u;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,f=n;p<f.length;p+=1)f[p].enableAttributes(c,t);o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,i);for(var d=0,v=n;d<v.length;d+=1){var m=v[d];m.bind(),m.setVertexAttribPointers(c,t,i)}o&&(o.bind(),o.setVertexAttribPointers(c,t,i)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,i)),l.currentNumAttributes=u},xn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var wn=function(t,e,n,r,i,o){var a=t.gl;this.program=a.createProgram();for(var s=bn(n.staticAttributes),u=r?r.getBinderAttributes():[],l=s.concat(u),c=n.staticUniforms?bn(n.staticUniforms):[],h=r?r.getBinderUniforms():[],p=[],f=0,d=c.concat(h);f<d.length;f+=1){var v=d[f];p.indexOf(v)<0&&p.push(v)}var m=r?r.defines():[];o&&m.push("#define OVERDRAW_INSPECTOR;");var y=m.concat(We.fragmentSource,n.fragmentSource).join("\n"),g=m.concat(We.vertexSource,n.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(_,y),a.compileShader(_),a.attachShader(this.program,_);var x=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(x,g),a.compileShader(x),a.attachShader(this.program,x),this.attributes={};var b={};this.numAttributes=l.length;for(var w=0;w<this.numAttributes;w++)l[w]&&(a.bindAttribLocation(this.program,w,l[w]),this.attributes[l[w]]=w);a.linkProgram(this.program),a.deleteShader(x),a.deleteShader(_);for(var S=0;S<p.length;S++){var E=p[S];if(E&&!b[E]){var A=a.getUniformLocation(this.program,E);A&&(b[E]=A)}}this.fixedUniforms=i(t,b),this.binderUniforms=r?r.getUniforms(t,b):[]}}};function Sn(t,e,n){var r=1/pe(n,1,e.transform.tileZoom),i=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,e.transform.tileZoom)/i,a=o*(n.tileID.canonical.x+n.tileID.wrap*i),s=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}wn.prototype.draw=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v){var m,y=t.gl;if(!this.failedToCreate){for(var g in t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(r),t.setColorMode(i),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[g].set(a[g]);f&&f.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var _=(m={},m[y.LINES]=2,m[y.TRIANGLES]=3,m[y.LINE_STRIP]=1,m)[e],x=0,b=c.get();x<b.length;x+=1){var w=b[x],S=w.vaos||(w.vaos={});(S[s]||(S[s]=new xn)).bind(t,this,u,f?f.getPaintVertexBuffers():[],l,w.vertexOffset,d,v),y.drawElements(e,w.primitiveLength*_,y.UNSIGNED_SHORT,w.primitiveOffset*_*2)}}};var En=function(e,n,r,i){var o=n.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],u=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(u,-n.transform.angle),t.transformMat3(s,s,u);var l=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+r,u_opacity:i}},An=function(e,n,r,i,o,a,s){return t.extend(En(e,n,r,i),Sn(a,n,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},Tn=function(t){return{u_matrix:t}},Cn=function(e,n,r,i){return t.extend(Tn(e),Sn(r,n,i))},kn=function(t,e){return{u_matrix:t,u_world:e}},Mn=function(e,n,r,i,o){return t.extend(Cn(e,n,r,i),{u_world:o})},In=function(e,n,r,i){var o,a,s=e.transform;if("map"===i.paint.get("circle-pitch-alignment")){var u=pe(r,1,s.zoom);o=!0,a=[u,u]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(n.posMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},Pn=function(t,e,n){var r=pe(n,1,e.zoom),i=Math.pow(2,e.zoom-n.tileID.overscaledZ),o=n.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[e.pixelsToGLUnits[0]/(r*i),e.pixelsToGLUnits[1]/(r*i)],u_overscale_factor:o}},Ln=function(t,e,n){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}},Rn=function(t,e,n){return void 0===n&&(n=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}},On=function(t){return{u_matrix:t}},Dn=function(t,e,n,r){return{u_matrix:t,u_extrude_scale:pe(e,1,n),u_intensity:r}},Nn=function(e,n,r){var i=e.transform;return{u_matrix:jn(e,n,r),u_ratio:1/pe(n,1,i.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},zn=function(e,n,r,i){return t.extend(Nn(e,n,r),{u_image:0,u_image_height:i})},Fn=function(e,n,r,i){var o=e.transform,a=Un(n,o);return{u_matrix:jn(e,n,r),u_texsize:n.imageAtlasTexture.size,u_ratio:1/pe(n,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[a,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Bn=function(e,n,r,i,o){var a=e.lineAtlas,s=Un(n,e.transform),u="round"===r.layout.get("line-cap"),l=a.getDash(i.from,u),c=a.getDash(i.to,u),h=l.width*o.fromScale,p=c.width*o.toScale;return t.extend(Nn(e,n,r),{u_patternscale_a:[s/h,-l.height/2],u_patternscale_b:[s/p,-c.height/2],u_sdfgamma:a.width/(256*Math.min(h,p)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:l.y,u_tex_y_b:c.y,u_mix:o.t})};function Un(t,e){return 1/pe(t,1,e.tileZoom)}function jn(t,e,n){return t.translatePosMatrix(e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Vn=function(t,e,n,r,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Gn(i.paint.get("raster-hue-rotate"))};var o,a};function Gn(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}var Hn,Wn=function(t,e,n,r,i,o,a,s,u,l){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+r,u_texsize:l,u_texture:0}},Zn=function(e,n,r,i,o,a,s,u,l,c,h){var p=o.transform;return t.extend(Wn(e,n,r,i,o,a,s,u,l,c),{u_gamma_scale:i?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},qn=function(e,n,r,i,o,a,s,u,l,c){return t.extend(Zn(e,n,r,i,o,a,s,u,!0,l,!0),{u_texsize_icon:c,u_texture_icon:1})},Xn=function(t,e,n){return{u_matrix:t,u_opacity:e,u_color:n}},Yn=function(e,n,r,i,o,a){return t.extend(function(t,e,n,r){var i=n.imageManager.getPattern(t.from.toString()),o=n.imageManager.getPattern(t.to.toString()),a=n.imageManager.getPixelSize(),s=a.width,u=a.height,l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,n.transform.tileZoom)/l,h=c*(r.tileID.canonical.x+r.tileID.wrap*l),p=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/pe(r,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(i,a,r,o),{u_matrix:e,u_opacity:n})},Kn={fillExtrusion:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fillExtrusionPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fill:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},fillPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},fillOutline:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}},fillOutlinePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},circle:function(e,n){return{u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,n.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},collisionBox:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,n.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,n.u_overscale_factor)}},collisionCircle:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,n.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,n.u_viewport_size)}},debug:function(e,n){return{u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_overlay:new t.Uniform1i(e,n.u_overlay),u_overlay_scale:new t.Uniform1f(e,n.u_overlay_scale)}},clippingMask:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmap:function(e,n){return{u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmapTexture:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}},hillshade:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}},hillshadePrepare:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}},line:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels)}},lineGradient:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image),u_image_height:new t.Uniform1f(e,n.u_image_height)}},linePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},lineSDF:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}},raster:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}},symbolIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}},symbolSDF:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},symbolTextAndIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},background:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}},backgroundPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}}};function Qn(e,n,r,i,o,a,s){for(var u=e.context,l=u.gl,c=e.useProgram("collisionBox"),h=[],p=0,f=0,d=0;d<i.length;d++){var v=i[d],m=n.getTile(v),y=m.getBucket(r);if(y){var g=v.posMatrix;0===o[0]&&0===o[1]||(g=e.translatePosMatrix(v.posMatrix,m,o,a));var _=s?y.textCollisionBox:y.iconCollisionBox,x=y.collisionCircleArray;if(x.length>0){var b=t.create(),w=g;t.mul(b,y.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(b,b,y.placementViewportMatrix),h.push({circleArray:x,circleOffset:f,transform:w,invTransform:b}),f=p+=x.length/4}_&&c.draw(u,l.LINES,At.disabled,Tt.disabled,e.colorModeForRenderPass(),kt.disabled,Pn(g,e.transform,m),r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,null,_.collisionVertexBuffer)}}if(s&&h.length){var S=e.useProgram("collisionCircle"),E=new t.StructArrayLayout2f1f2i16;E.resize(4*p),E._trim();for(var A=0,T=0,C=h;T<C.length;T+=1)for(var k=C[T],M=0;M<k.circleArray.length/4;M++){var I=4*M,P=k.circleArray[I+0],L=k.circleArray[I+1],R=k.circleArray[I+2],O=k.circleArray[I+3];E.emplace(A++,P,L,R,O,0),E.emplace(A++,P,L,R,O,1),E.emplace(A++,P,L,R,O,2),E.emplace(A++,P,L,R,O,3)}(!Hn||Hn.length<2*p)&&(Hn=function(e){var n=2*e,r=new t.StructArrayLayout3ui6;r.resize(n),r._trim();for(var i=0;i<n;i++){var o=6*i;r.uint16[o+0]=4*i+0,r.uint16[o+1]=4*i+1,r.uint16[o+2]=4*i+2,r.uint16[o+3]=4*i+2,r.uint16[o+4]=4*i+3,r.uint16[o+5]=4*i+0}return r}(p));for(var D=u.createIndexBuffer(Hn,!0),N=u.createVertexBuffer(E,t.collisionCircleLayout.members,!0),z=0,F=h;z<F.length;z+=1){var B=F[z],U=Ln(B.transform,B.invTransform,e.transform);S.draw(u,l.TRIANGLES,At.disabled,Tt.disabled,e.colorModeForRenderPass(),kt.disabled,U,r.id,N,D,t.SegmentVector.simpleSegment(0,2*B.circleOffset,B.circleArray.length,B.circleArray.length/2),null,e.transform.zoom,null,null,null)}N.destroy(),D.destroy()}}var Jn=t.identity(new Float32Array(16));function $n(e,n,r,i,o,a){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*n,l=-(s.verticalAlign-.5)*r,c=t.evaluateVariableOffset(e,i);return new t.Point((u/o+c[0])*a,(l/o+c[1])*a)}function tr(e,n,r,i,o,a,s,u,l,c,h){var p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,d=e.icon.dynamicLayoutVertexArray,v={};f.clear();for(var m=0;m<p.length;m++){var y=p.get(m),g=y.hidden||!y.crossTileID||e.allowVerticalPlacement&&!y.placedOrientation?null:i[y.crossTileID];if(g){var _=new t.Point(y.anchorX,y.anchorY),x=$t(_,r?u:s),b=te(a.cameraToCenterDistance,x.signedDistanceFromCamera),w=o.evaluateSizeForFeature(e.textSizeData,c,y)*b/t.ONE_EM;r&&(w*=e.tilePixelRatio/l);for(var S=$n(g.anchor,g.width,g.height,g.textOffset,g.textBoxScale,w),E=r?$t(_.add(S),s).point:x.point.add(n?S.rotate(-a.angle):S),A=e.allowVerticalPlacement&&y.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,T=0;T<y.numGlyphs;T++)t.addDynamicAttributes(f,E,A);h&&y.associatedIconIndex>=0&&(v[y.associatedIconIndex]={shiftedAnchor:E,angle:A})}else le(y.numGlyphs,f)}if(h){d.clear();for(var C=e.icon.placedSymbolArray,k=0;k<C.length;k++){var M=C.get(k);if(M.hidden)le(M.numGlyphs,d);else{var I=v[k];if(I)for(var P=0;P<M.numGlyphs;P++)t.addDynamicAttributes(d,I.shiftedAnchor,I.angle);else le(M.numGlyphs,d)}}e.icon.dynamicLayoutVertexBuffer.updateData(d)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function er(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function nr(e,n,r,i,o,a,s,u,l,c,h,p){for(var f=e.context,d=f.gl,v=e.transform,m="map"===u,y="map"===l,g=m&&"point"!==r.layout.get("symbol-placement"),_=m&&!y&&!g,x=void 0!==r.layout.get("symbol-sort-key").constantOr(1),b=!1,w=e.depthModeForSublayer(0,At.ReadOnly),S=r.layout.get("text-variable-anchor"),E=[],A=0,T=i;A<T.length;A+=1){var C=T[A],k=n.getTile(C),M=k.getBucket(r);if(M){var I=o?M.text:M.icon;if(I&&I.segments.get().length){var P=I.programConfigurations.get(r.id),L=o||M.sdfIcons,R=o?M.textSizeData:M.iconSizeData,O=y||0!==v.pitch,D=e.useProgram(er(L,o,M),P),N=t.evaluateSizeForZoom(R,v.zoom),z=void 0,F=[0,0],B=void 0,U=void 0,j=null,V=void 0;if(o)B=k.glyphAtlasTexture,U=d.LINEAR,z=k.glyphAtlasTexture.size,M.iconsInText&&(F=k.imageAtlasTexture.size,j=k.imageAtlasTexture,V=O||e.options.rotating||e.options.zooming||"composite"===R.kind||"camera"===R.kind?d.LINEAR:d.NEAREST);else{var G=1!==r.layout.get("icon-size").constantOr(0)||M.iconsNeedLinear;B=k.imageAtlasTexture,U=L||e.options.rotating||e.options.zooming||G||O?d.LINEAR:d.NEAREST,z=k.imageAtlasTexture.size}var H=pe(k,1,e.transform.zoom),W=Qt(C.posMatrix,y,m,e.transform,H),Z=Jt(C.posMatrix,y,m,e.transform,H),q=S&&M.hasTextData(),X="none"!==r.layout.get("icon-text-fit")&&q&&M.hasIconData();g&&ne(M,C.posMatrix,e,o,W,Z,y,c);var Y=e.translatePosMatrix(C.posMatrix,k,a,s),K=g||o&&S||X?Jn:W,Q=e.translatePosMatrix(Z,k,a,s,!0),J=L&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),$={program:D,buffers:I,uniformValues:L?M.iconsInText?qn(R.kind,N,_,y,e,Y,K,Q,z,F):Zn(R.kind,N,_,y,e,Y,K,Q,o,z,!0):Wn(R.kind,N,_,y,e,Y,K,Q,o,z),atlasTexture:B,atlasTextureIcon:j,atlasInterpolation:U,atlasInterpolationIcon:V,isSDF:L,hasHalo:J};if(x&&M.canOverlap){b=!0;for(var tt=0,et=I.segments.get();tt<et.length;tt+=1){var nt=et[tt];E.push({segments:new t.SegmentVector([nt]),sortKey:nt.sortKey,state:$})}}else E.push({segments:I.segments,sortKey:0,state:$})}}}b&&E.sort((function(t,e){return t.sortKey-e.sortKey}));for(var rt=0,it=E;rt<it.length;rt+=1){var ot=it[rt],at=ot.state;if(f.activeTexture.set(d.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,d.CLAMP_TO_EDGE),at.atlasTextureIcon&&(f.activeTexture.set(d.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,d.CLAMP_TO_EDGE)),at.isSDF){var st=at.uniformValues;at.hasHalo&&(st.u_is_halo=1,rr(at.buffers,ot.segments,r,e,at.program,w,h,p,st)),st.u_is_halo=0}rr(at.buffers,ot.segments,r,e,at.program,w,h,p,at.uniformValues)}}function rr(t,e,n,r,i,o,a,s,u){var l=r.context;i.draw(l,l.gl.TRIANGLES,o,a,s,kt.disabled,u,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,r.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function ir(t,e,n,r,i,o,a){var s,u,l,c,h,p=t.context.gl,f=n.paint.get("fill-pattern"),d=f&&f.constantOr(1),v=n.getCrossfadeParameters();a?(u=d&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(u=d?"fillPattern":"fill",s=p.TRIANGLES);for(var m=0,y=r;m<y.length;m+=1){var g=y[m],_=e.getTile(g);if(!d||_.patternsLoaded()){var x=_.getBucket(n);if(x){var b=x.programConfigurations.get(n.id),w=t.useProgram(u,b);d&&(t.context.activeTexture.set(p.TEXTURE0),_.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),b.updatePaintBuffers(v));var S=f.constantOr(null);if(S&&_.imageAtlas){var E=_.imageAtlas,A=E.patternPositions[S.to.toString()],T=E.patternPositions[S.from.toString()];A&&T&&b.setConstantPatternPositions(A,T)}var C=t.translatePosMatrix(g.posMatrix,_,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){c=x.indexBuffer2,h=x.segments2;var k=[p.drawingBufferWidth,p.drawingBufferHeight];l="fillOutlinePattern"===u&&d?Mn(C,t,v,_,k):kn(C,k)}else c=x.indexBuffer,h=x.segments,l=d?Cn(C,t,v,_):Tn(C);w.draw(t.context,s,i,t.stencilModeForClipping(g),o,kt.disabled,l,n.id,x.layoutVertexBuffer,c,h,n.paint,t.transform.zoom,b)}}}}function or(t,e,n,r,i,o,a){for(var s=t.context,u=s.gl,l=n.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),h=n.getCrossfadeParameters(),p=n.paint.get("fill-extrusion-opacity"),f=0,d=r;f<d.length;f+=1){var v=d[f],m=e.getTile(v),y=m.getBucket(n);if(y){var g=y.programConfigurations.get(n.id),_=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",g);c&&(t.context.activeTexture.set(u.TEXTURE0),m.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),g.updatePaintBuffers(h));var x=l.constantOr(null);if(x&&m.imageAtlas){var b=m.imageAtlas,w=b.patternPositions[x.to.toString()],S=b.patternPositions[x.from.toString()];w&&S&&g.setConstantPatternPositions(w,S)}var E=t.translatePosMatrix(v.posMatrix,m,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),A=n.paint.get("fill-extrusion-vertical-gradient"),T=c?An(E,t,A,p,v,h,m):En(E,t,A,p);_.draw(s,s.gl.TRIANGLES,i,o,a,kt.backCCW,T,n.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,n.paint,t.transform.zoom,g)}}}function ar(e,n,r,i,o,a){var s=e.context,u=s.gl,l=n.fbo;if(l){var c=e.useProgram("hillshade");s.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,l.colorAttachment.get());var h=function(e,n,r){var i=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),a=r.paint.get("hillshade-accent-color"),s=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var u,l,c,h=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(n.tileID.toUnwrapped(),h),u_image:0,u_latrange:(u=n.tileID,l=Math.pow(2,u.canonical.z),c=u.canonical.y,[new t.MercatorCoordinate(0,c/l).toLngLat().lat,new t.MercatorCoordinate(0,(c+1)/l).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:o,u_accent:a}}(e,n,r);c.draw(s,u.TRIANGLES,i,o,a,kt.disabled,h,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function sr(e,n,r,i,o,a){var s=e.context,u=s.gl,l=n.dem;if(l&&l.data){var c=l.dim,h=l.stride,p=l.getPixels();if(s.activeTexture.set(u.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(h),n.demTexture){var f=n.demTexture;f.update(p,{premultiply:!1}),f.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else n.demTexture=new t.Texture(s,p,u.RGBA,{premultiply:!1}),n.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);s.activeTexture.set(u.TEXTURE0);var d=n.fbo;if(!d){var v=new t.Texture(s,{width:c,height:c,data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE),(d=n.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(v.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(s,u.TRIANGLES,i,o,a,kt.disabled,function(e,n){var r=n.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}}(n.tileID,l),r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function ur(e,n,r,i,o){var a=i.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),u=(s-e.timeAdded)/a,l=n?(s-n.timeAdded)/a:-1,c=r.getSource(),h=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),f=p&&e.refreshedUponExpiration?1:t.clamp(p?u:1-l,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}var lr=new t.Color(1,0,0,1),cr=new t.Color(0,1,0,1),hr=new t.Color(0,0,1,1),pr=new t.Color(1,0,1,1),fr=new t.Color(0,1,1,1);function dr(t,e,n,r){mr(t,0,e+n/2,t.transform.width,n,r)}function vr(t,e,n,r){mr(t,e-n/2,0,n,t.transform.height,r)}function mr(e,n,r,i,o,a){var s=e.context,u=s.gl;u.enable(u.SCISSOR_TEST),u.scissor(n*t.browser.devicePixelRatio,r*t.browser.devicePixelRatio,i*t.browser.devicePixelRatio,o*t.browser.devicePixelRatio),s.clear({color:a}),u.disable(u.SCISSOR_TEST)}function yr(e,n,r){var i=e.context,o=i.gl,a=r.posMatrix,s=e.useProgram("debug"),u=At.disabled,l=Tt.disabled,c=e.colorModeForRenderPass();i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.draw(i,o.LINE_STRIP,u,l,c,kt.disabled,Rn(a,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=n.getTileByID(r.key).latestRawTileData,p=Math.floor((h&&h.byteLength||0)/1024),f=n.getTile(r).tileSize,d=512/Math.min(f,512)*(r.overscaledZ/e.transform.zoom)*.5,v=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(v+=" => "+r.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var n=t.debugOverlayCanvas,r=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,v+" "+p+"kb"),s.draw(i,o.TRIANGLES,u,l,Ct.alphaBlended,kt.disabled,Rn(a,t.Color.transparent,d),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var gr={symbol:function(e,n,r,i,o){if("translucent"===e.renderPass){var a=Tt.disabled,s=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,n,r,i,o,a,s){for(var u=n.transform,l="map"===o,c="map"===a,h=0,p=e;h<p.length;h+=1){var f=p[h],d=i.getTile(f),v=d.getBucket(r);if(v&&v.text&&v.text.segments.get().length){var m=t.evaluateSizeForZoom(v.textSizeData,u.zoom),y=pe(d,1,n.transform.zoom),g=Qt(f.posMatrix,c,l,n.transform,y),_="none"!==r.layout.get("icon-text-fit")&&v.hasIconData();if(m){var x=Math.pow(2,u.zoom-d.tileID.overscaledZ);tr(v,l,c,s,t.symbolSize,u,g,f.posMatrix,x,m,_)}}}}(i,e,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&nr(e,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,s),0!==r.paint.get("text-opacity").constantOr(1)&&nr(e,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,s),n.map.showCollisionBoxes&&(Qn(e,n,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Qn(e,n,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),u=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var l=e.context,c=l.gl,h=e.depthModeForSublayer(0,At.ReadOnly),p=Tt.disabled,f=e.colorModeForRenderPass(),d=[],v=0;v<i.length;v++){var m=i[v],y=n.getTile(m),g=y.getBucket(r);if(g){var _=g.programConfigurations.get(r.id),x={programConfiguration:_,program:e.useProgram("circle",_),layoutVertexBuffer:g.layoutVertexBuffer,indexBuffer:g.indexBuffer,uniformValues:In(e,m,y,r)};if(u)for(var b=0,w=g.segments.get();b<w.length;b+=1){var S=w[b];d.push({segments:new t.SegmentVector([S]),sortKey:S.sortKey,state:x})}else d.push({segments:g.segments,sortKey:0,state:x})}}u&&d.sort((function(t,e){return t.sortKey-e.sortKey}));for(var E=0,A=d;E<A.length;E+=1){var T=A[E],C=T.state;C.program.draw(l,c.TRIANGLES,h,p,f,kt.disabled,C.uniformValues,r.id,C.layoutVertexBuffer,C.indexBuffer,T.segments,r.paint,e.transform.zoom,C.programConfiguration)}}}},heatmap:function(e,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=Tt.disabled,u=new Ct([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){var r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,n,r){var i=t.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width/4,e.height/4,0,i.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(t,e,o,i)}}(o,e,r),o.clear({color:t.Color.transparent});for(var l=0;l<i.length;l++){var c=i[l];if(!n.hasRenderableParent(c)){var h=n.getTile(c),p=h.getBucket(r);if(p){var f=p.programConfigurations.get(r.id);e.useProgram("heatmap",f).draw(o,a.TRIANGLES,At.disabled,s,u,kt.disabled,Dn(c.posMatrix,h,e.transform.zoom,r.paint.get("heatmap-intensity")),r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,r.paint,e.transform.zoom,f)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){var r=e.context,i=r.gl,o=n.heatmapFbo;if(o){r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);var a=n.colorRampTexture;a||(a=n.colorRampTexture=new t.Texture(r,n.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,i.TRIANGLES,At.disabled,Tt.disabled,e.colorModeForRenderPass(),kt.disabled,function(e,n,r,i){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}}(e,n),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}}(e,r))},line:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=e.depthModeForSublayer(0,At.ReadOnly),u=e.colorModeForRenderPass(),l=r.paint.get("line-dasharray"),c=r.paint.get("line-pattern"),h=c.constantOr(1),p=r.paint.get("line-gradient"),f=r.getCrossfadeParameters(),d=h?"linePattern":l?"lineSDF":p?"lineGradient":"line",v=e.context,m=v.gl,y=!0,g=0,_=i;g<_.length;g+=1){var x=_[g],b=n.getTile(x);if(!h||b.patternsLoaded()){var w=b.getBucket(r);if(w){var S=w.programConfigurations.get(r.id),E=e.context.program.get(),A=e.useProgram(d,S),T=y||A.program!==E,C=c.constantOr(null);if(C&&b.imageAtlas){var k=b.imageAtlas,M=k.patternPositions[C.to.toString()],I=k.patternPositions[C.from.toString()];M&&I&&S.setConstantPatternPositions(M,I)}var P=h?Fn(e,b,r,f):l?Bn(e,b,r,l,f):p?zn(e,b,r,w.lineClipsArray.length):Nn(e,b,r);if(h)v.activeTexture.set(m.TEXTURE0),b.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),S.updatePaintBuffers(f);else if(l&&(T||e.lineAtlas.dirty))v.activeTexture.set(m.TEXTURE0),e.lineAtlas.bind(v);else if(p){var L=w.gradients[r.id],R=L.texture;if(r.gradientVersion!==L.version){var O=256;if(r.stepInterpolant){var D=n.getSource().maxzoom,N=x.canonical.z===D?Math.ceil(1<<e.transform.maxZoom-x.canonical.z):1;O=t.clamp(t.nextPowerOfTwo(w.maxLineLength/t.EXTENT*1024*N),256,v.maxTextureSize)}L.gradient=t.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:O,image:L.gradient||void 0,clips:w.lineClipsArray}),L.texture?L.texture.update(L.gradient):L.texture=new t.Texture(v,L.gradient,m.RGBA),L.version=r.gradientVersion,R=L.texture}v.activeTexture.set(m.TEXTURE0),R.bind(r.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}A.draw(v,m.TRIANGLES,s,e.stencilModeForClipping(x),u,kt.disabled,P,r.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,r.paint,e.transform.zoom,S,w.layoutVertexBuffer2),y=!1}}}}},fill:function(e,n,r,i){var o=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?At.ReadWrite:At.ReadOnly);ir(e,n,r,i,c,s,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){var h=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,At.ReadOnly);ir(e,n,r,i,h,s,!0)}}},"fill-extrusion":function(t,e,n,r){var i=n.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var o=new At(t.context.gl.LEQUAL,At.ReadWrite,t.depthRangeFor3D);if(1!==i||n.paint.get("fill-extrusion-pattern").constantOr(1))or(t,e,n,r,o,Tt.disabled,Ct.disabled),or(t,e,n,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();or(t,e,n,r,o,Tt.disabled,a)}}},hillshade:function(t,e,n,r){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,o=t.depthModeForSublayer(0,At.ReadOnly),a=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(r):[{},r],u=s[0],l=0,c=s[1];l<c.length;l+=1){var h=c[l],p=e.getTile(h);p.needsHillshadePrepare&&"offscreen"===t.renderPass?sr(t,p,n,o,Tt.disabled,a):"translucent"===t.renderPass&&ar(t,p,n,o,u[h.overscaledZ],a)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,n,r){if("translucent"===t.renderPass&&0!==n.paint.get("raster-opacity")&&r.length)for(var i=t.context,o=i.gl,a=e.getSource(),s=t.useProgram("raster"),u=t.colorModeForRenderPass(),l=a instanceof L?[{},r]:t.stencilConfigForOverlap(r),c=l[0],h=l[1],p=h[h.length-1].overscaledZ,f=!t.options.moving,d=0,v=h;d<v.length;d+=1){var m=v[d],y=t.depthModeForSublayer(m.overscaledZ-p,1===n.paint.get("raster-opacity")?At.ReadWrite:At.ReadOnly,o.LESS),g=e.getTile(m),_=t.transform.calculatePosMatrix(m.toUnwrapped(),f);g.registerFadeDuration(n.paint.get("raster-fade-duration"));var x=e.findLoadedParent(m,0),b=ur(g,x,e,n,t.transform),w=void 0,S=void 0,E="nearest"===n.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),g.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),x?(x.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,x.tileID.overscaledZ-g.tileID.overscaledZ),S=[g.tileID.canonical.x*w%1,g.tileID.canonical.y*w%1]):g.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var A=Vn(_,S||[0,0],w||1,b,n);a instanceof L?s.draw(i,o.TRIANGLES,y,Tt.disabled,u,kt.disabled,A,n.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):s.draw(i,o.TRIANGLES,y,c[m.overscaledZ],u,kt.disabled,A,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,n){var r=n.paint.get("background-color"),i=n.paint.get("background-opacity");if(0!==i){var o=t.context,a=o.gl,s=t.transform,u=s.tileSize,l=n.paint.get("background-pattern");if(!t.isPatternMissing(l)){var c=!l&&1===r.a&&1===i&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===c){var h=Tt.disabled,p=t.depthModeForSublayer(0,"opaque"===c?At.ReadWrite:At.ReadOnly),f=t.colorModeForRenderPass(),d=t.useProgram(l?"backgroundPattern":"background"),v=s.coveringTiles({tileSize:u});l&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var m=n.getCrossfadeParameters(),y=0,g=v;y<g.length;y+=1){var _=g[y],x=t.transform.calculatePosMatrix(_.toUnwrapped()),b=l?Yn(x,i,t,l,{tileID:_,tileSize:u},m):Xn(x,i,r);d.draw(o,a.TRIANGLES,p,h,f,kt.disabled,b,n.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,n){for(var r=0;r<n.length;r++)yr(t,e,n[r])},custom:function(t,e,n){var r=t.context,i=n.implementation;if("offscreen"===t.renderPass){var o=i.prerender;o&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),o.call(i,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(Tt.disabled);var a="3d"===i.renderingMode?new At(t.context.gl.LEQUAL,At.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,At.ReadOnly);r.setDepthMode(a),i.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}},_r=function(t,e){this.context=new Mt(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=It.maxUnderzooming+It.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Fe,this.gpuTimers={}};_r.prototype.resize=function(e,n){if(this.width=e*t.browser.devicePixelRatio,this.height=n*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,i=this.style._order;r<i.length;r+=1)this.style._layers[i[r]].resize()},_r.prototype.setup=function(){var e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,He.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(r,He.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,P.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,He.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var u=this.context.gl;this.stencilClearMode=new Tt({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},_r.prototype.clearStencil=function(){var e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=t.create();t.ortho(r,0,this.width,this.height,0,0,1),t.scale(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,At.disabled,this.stencilClearMode,Ct.disabled,kt.disabled,On(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},_r.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var n=this.context,r=n.gl;this.nextStencilID+e.length>256&&this.clearStencil(),n.setColorMode(Ct.disabled),n.setDepthMode(At.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(n,r.TRIANGLES,At.disabled,new Tt({func:r.ALWAYS,mask:0},u,255,r.KEEP,r.KEEP,r.REPLACE),Ct.disabled,kt.disabled,On(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},_r.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new Tt({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},_r.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Tt({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},_r.prototype.stencilConfigForOverlap=function(t){var e,n=this.context.gl,r=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),i=r[r.length-1].overscaledZ,o=r[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var a={},s=0;s<o;s++)a[s+i]=new Tt({func:n.GEQUAL,mask:255},s+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[a,r]}return[(e={},e[i]=Tt.disabled,e),r]},_r.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Ct([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Ct.unblended:Ct.alphaBlended},_r.prototype.depthModeForSublayer=function(t,e,n){if(!this.opaquePassEnabledForLayer())return At.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new At(n||this.context.gl.LEQUAL,e,[r,r])},_r.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},_r.prototype.render=function(e,n){var r=this;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var i=this.style._order,o=this.style.sourceCaches;for(var a in o){var s=o[a];s.used&&s.prepare(this.context)}var u,l,c={},h={},p={};for(var f in o){var d=o[f];c[f]=d.getVisibleCoordinates(),h[f]=c[f].slice().reverse(),p[f]=d.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var v=0;v<i.length;v++)if(this.style._layers[i[v]].is3D()){this.opaquePassCutoff=v;break}this.renderPass="offscreen";for(var m=0,y=i;m<y.length;m+=1){var g=this.style._layers[y[m]];if(g.hasOffscreenPass()&&!g.isHidden(this.transform.zoom)){var _=h[g.source];("custom"===g.type||_.length)&&this.renderLayer(this,o[g.source],g,_)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var x=this.style._layers[i[this.currentLayer]],b=o[x.source],w=c[x.source];this._renderTileClippingMasks(x,w),this.renderLayer(this,b,x,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var S=this.style._layers[i[this.currentLayer]],E=o[S.source],A=("symbol"===S.type?p:h)[S.source];this._renderTileClippingMasks(S,c[S.source]),this.renderLayer(this,E,S,A)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(r.transform.zoom)&&(t.source!==(l&&l.id)&&(l=r.style.sourceCaches[t.source]),(!u||u.getSource().maxzoom<l.getSource().maxzoom)&&(u=l))})),u&&gr.debug(this,u,u.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;dr(t,t.transform.height-(e.top||0),3,lr),dr(t,e.bottom||0,3,cr),vr(t,e.left||0,3,hr),vr(t,t.transform.width-(e.right||0),3,pr);var n=t.transform.centerPoint;!function(t,e,n,r){mr(t,e-1,n-10,2,20,r),mr(t,e-10,n-1,20,2,r)}(t,n.x,t.transform.height-n.y,fr)}(this),this.context.setDefault()},_r.prototype.renderLayer=function(t,e,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||r.length)&&(this.id=n.id,this.gpuTimingStart(n),gr[n.type](t,e,n,r,this.style.placement.variableOffsets),this.gpuTimingEnd())},_r.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}},_r.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},_r.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},_r.prototype.queryGpuTimers=function(t){var e={};for(var n in t){var r=t[n],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(r.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r.query),e[n]=o}return e},_r.prototype.translatePosMatrix=function(e,n,r,i,o){if(!r[0]&&!r[1])return e;var a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var s=Math.sin(a),u=Math.cos(a);r=[r[0]*u-r[1]*s,r[0]*s+r[1]*u]}var l=[o?r[0]:pe(n,r[0],this.transform.zoom),o?r[1]:pe(n,r[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,l),c},_r.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},_r.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},_r.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n},_r.prototype.useProgram=function(t,e){this.cache=this.cache||{};var n=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new wn(this.context,t,_n[t],e,Kn[t],this._showOverdrawInspector)),this.cache[n]},_r.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},_r.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},_r.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},_r.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var xr=function(t,e){this.points=t,this.planes=e};xr.fromInvProjectionMatrix=function(e,n,r){var i=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(n){return t.transformMat4([],n,e)})).map((function(e){return t.scale$1([],e,1/e[3]/n*i)})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var n=t.sub([],o[e[0]],o[e[1]]),r=t.sub([],o[e[2]],o[e[1]]),i=t.normalize([],t.cross([],n,r)),a=-t.dot(i,o[e[1]]);return i.concat(a)}));return new xr(o,a)};var br=function(e,n){this.min=e,this.max=n,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};br.prototype.quadrant=function(e){for(var n=[e%2==0,e<2],r=t.clone$2(this.min),i=t.clone$2(this.max),o=0;o<n.length;o++)r[o]=n[o]?this.min[o]:this.center[o],i[o]=n[o]?this.center[o]:this.max[o];return i[2]=this.max[2],new br(r,i)},br.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},br.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},br.prototype.intersects=function(e){for(var n=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],r=!0,i=0;i<e.planes.length;i++){for(var o=e.planes[i],a=0,s=0;s<n.length;s++)a+=t.dot$1(o,n[s])>=0;if(0===a)return 0;a!==n.length&&(r=!1)}if(r)return 2;for(var u=0;u<3;u++){for(var l=Number.MAX_VALUE,c=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var p=e.points[h][u]-this.min[u];l=Math.min(l,p),c=Math.max(c,p)}if(c<0||l>this.max[u]-this.min[u])return 0}return 1};var wr=function(t,e,n,r){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=r};wr.prototype.interpolate=function(e,n,r){return null!=n.top&&null!=e.top&&(this.top=t.number(e.top,n.top,r)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,n.bottom,r)),null!=n.left&&null!=e.left&&(this.left=t.number(e.left,n.left,r)),null!=n.right&&null!=e.right&&(this.right=t.number(e.right,n.right,r)),this},wr.prototype.getCenter=function(e,n){var r=t.clamp((this.left+e-this.right)/2,0,e),i=t.clamp((this.top+n-this.bottom)/2,0,n);return new t.Point(r,i)},wr.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},wr.prototype.clone=function(){return new wr(this.top,this.bottom,this.left,this.right)},wr.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Sr=function(e,n,r,i,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wr,this._posMatrixCache={},this._alignedPosMatrixCache={}},Er={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Sr.prototype.clone=function(){var t=new Sr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},Er.minZoom.get=function(){return this._minZoom},Er.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Er.maxZoom.get=function(){return this._maxZoom},Er.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Er.minPitch.get=function(){return this._minPitch},Er.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},Er.maxPitch.get=function(){return this._maxPitch},Er.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},Er.renderWorldCopies.get=function(){return this._renderWorldCopies},Er.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Er.worldSize.get=function(){return this.tileSize*this.scale},Er.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Er.size.get=function(){return new t.Point(this.width,this.height)},Er.bearing.get=function(){return-this.angle/Math.PI*180},Er.bearing.set=function(e){var n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Er.pitch.get=function(){return this._pitch/Math.PI*180},Er.pitch.set=function(e){var n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},Er.fov.get=function(){return this._fov/Math.PI*180},Er.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Er.zoom.get=function(){return this._zoom},Er.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Er.center.get=function(){return this._center},Er.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Er.padding.get=function(){return this._edgeInsets.toJSON()},Er.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},Er.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Sr.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},Sr.prototype.interpolatePadding=function(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()},Sr.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},Sr.prototype.getVisibleUnwrappedCoordinates=function(e){var n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(r.x,i.x,o.x,a.x)),u=Math.floor(Math.max(r.x,i.x,o.x,a.x)),l=s-1;l<=u+1;l++)0!==l&&n.push(new t.UnwrappedTileID(l,e));return n},Sr.prototype.coveringTiles=function(e){var n=this.coveringZoomLevel(e),r=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);var i=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,n),a=[o*i.x,o*i.y,0],s=xr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),u=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(u=n);var l=function(t){return{aabb:new br([t*o,0,0],[(t+1)*o,o,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},c=[],h=[],p=n,f=e.reparseOverscaled?r:n;if(this._renderWorldCopies)for(var d=1;d<=3;d++)c.push(l(-d)),c.push(l(d));for(c.push(l(0));c.length>0;){var v=c.pop(),m=v.x,y=v.y,g=v.fullyVisible;if(!g){var _=v.aabb.intersects(s);if(0===_)continue;g=2===_}var x=v.aabb.distanceX(a),b=v.aabb.distanceY(a),w=Math.max(Math.abs(x),Math.abs(b));if(v.zoom===p||w>3+(1<<p-v.zoom)-2&&v.zoom>=u)h.push({tileID:new t.OverscaledTileID(v.zoom===p?f:v.zoom,v.wrap,v.zoom,m,y),distanceSq:t.sqrLen([a[0]-.5-m,a[1]-.5-y])});else for(var S=0;S<4;S++){var E=(m<<1)+S%2,A=(y<<1)+(S>>1);c.push({aabb:v.aabb.quadrant(S),zoom:v.zoom+1,x:E,y:A,wrap:v.wrap,fullyVisible:g})}}return h.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},Sr.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Er.unmodified.get=function(){return this._unmodified},Sr.prototype.zoomScale=function(t){return Math.pow(2,t)},Sr.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Sr.prototype.project=function(e){var n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)},Sr.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},Er.point.get=function(){return this.project(this.center)},Sr.prototype.setLocationAtPoint=function(e,n){var r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(r.x-i.x),o.y-(r.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},Sr.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Sr.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Sr.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},Sr.prototype.coordinateLocation=function(t){return t.toLngLat()},Sr.prototype.pointCoordinate=function(e){var n=[e.x,e.y,0,1],r=[e.x,e.y,1,1];t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(r,r,this.pixelMatrixInverse);var i=n[3],o=r[3],a=n[1]/i,s=r[1]/o,u=n[2]/i,l=r[2]/o,c=u===l?0:(0-u)/(l-u);return new t.MercatorCoordinate(t.number(n[0]/i,r[0]/o,c)/this.worldSize,t.number(a,s,c)/this.worldSize)},Sr.prototype.coordinatePoint=function(e){var n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix),new t.Point(n[0]/n[3],n[1]/n[3])},Sr.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},Sr.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Sr.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Sr.prototype.calculatePosMatrix=function(e,n){void 0===n&&(n=!1);var r=e.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*a,o.y*a,0]),t.scale(u,u,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(u,n?this.alignedProjMatrix:this.projMatrix,u),i[r]=new Float32Array(u),i[r]},Sr.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Sr.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,n,r,i,o=-90,a=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<l.y?l.y/(a-o):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,n=(u=t.mercatorXfromLng(p[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var f=this.point,d=Math.max(n||0,e||0);if(d)return this.center=this.unproject(new t.Point(n?(u+s)/2:f.x,e?(a+o)/2:f.y)),this.zoom+=this.scaleZoom(d),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var v=f.y,m=l.y/2;v-m<o&&(i=o+m),v+m>a&&(i=a-m)}if(this.lngRange){var y=f.x,g=l.x/2;y-g<s&&(r=s+g),y+g>u&&(r=u-g)}void 0===r&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==r?r:f.x,void 0!==i?i:f.y))),this._unmodified=c,this._constraining=!1}},Sr.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);t.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,t.scale(c,c,[1,-1,1]),t.translate(c,c,[0,0,-this.cameraToCenterDistance]),t.rotateX(c,c,this._pitch),t.rotateZ(c,c,this.angle),t.translate(c,c,[-a,-s,0]),this.mercatorMatrix=t.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),t.scale(c,c,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=t.invert([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,f=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+f*h+d*p,m=s-Math.round(s)+f*p+d*h,y=new Float64Array(c);if(t.translate(y,y,[v>.5?v-1:v,m>.5?m-1:m,0]),this.alignedProjMatrix=y,c=t.create(),t.scale(c,c,[this.width/2,-this.height/2,1]),t.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=t.create(),t.scale(c,c,[1,-1,1]),t.translate(c,c,[-1,-1,0]),t.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Sr.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},Sr.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},Sr.prototype.getCameraQueryGeometry=function(e){var n=this.getCameraPoint();if(1===e.length)return[e[0],n];for(var r=n.x,i=n.y,o=n.x,a=n.y,s=0,u=e;s<u.length;s+=1){var l=u[s];r=Math.min(r,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),a=Math.max(a,l.y)}return[new t.Point(r,i),new t.Point(o,i),new t.Point(o,a),new t.Point(r,a),new t.Point(r,i)]},Object.defineProperties(Sr.prototype,Er);var Ar=function(e){var n,r,i,o;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(n=this._updateHashUnthrottled.bind(this),r=!1,i=null,o=function(){i=null,r&&(n(),i=setTimeout(o,300),r=!1)},function(){return r=!0,i||o(),i})};Ar.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ar.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ar.prototype.getHashString=function(e){var n=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),a=Math.round(n.lng*o)/o,s=Math.round(n.lat*o)/o,u=this._map.getBearing(),l=this._map.getPitch(),c="";if(c+=e?"/"+a+"/"+s+"/"+r:r+"/"+s+"/"+a,(u||l)&&(c+="/"+Math.round(10*u)/10),l&&(c+="/"+Math.round(l)),this._hashName){var h=this._hashName,p=!1,f=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(p=!0,e+"="+c):t})).filter((function(t){return t}));return p||f.push(h+"="+c),"#"+f.join("&")}return"#"+c},Ar.prototype._getCurrentHash=function(){var e,n=this,r=t.window.location.hash.replace("#","");return this._hashName?(r.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===n._hashName&&(e=t)})),(e&&e[1]||"").split("/")):r.split("/")},Ar.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},Ar.prototype._updateHashUnthrottled=function(){var e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());try{t.window.history.replaceState(t.window.history.state,null,e)}catch(t){}};var Tr={linearity:.3,easing:t.bezier(0,0,.3,1)},Cr=t.extend({deceleration:2500,maxSpeed:1400},Tr),kr=t.extend({deceleration:20,maxSpeed:1400},Tr),Mr=t.extend({deceleration:1e3,maxSpeed:360},Tr),Ir=t.extend({deceleration:1e3,maxSpeed:90},Tr),Pr=function(t){this._map=t,this.clear()};function Lr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Rr(e,n,r){var i=r.maxSpeed,o=r.linearity,a=r.deceleration,s=t.clamp(e*o/(n/1e3),-i,i),u=Math.abs(s)/(a*o);return{easing:r.easing,duration:1e3*u,amount:s*(u/2)}}Pr.prototype.clear=function(){this._inertiaBuffer=[]},Pr.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},Pr.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,n=t.browser.now();e.length>0&&n-e[0].time>160;)e.shift()},Pr.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var n={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},r=0,i=this._inertiaBuffer;r<i.length;r+=1){var o=i[r].settings;n.zoom+=o.zoomDelta||0,n.bearing+=o.bearingDelta||0,n.pitch+=o.pitchDelta||0,o.panDelta&&n.pan._add(o.panDelta),o.around&&(n.around=o.around),o.pinchAround&&(n.pinchAround=o.pinchAround)}var a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){var u=Rr(n.pan.mag(),a,t.extend({},Cr,e||{}));s.offset=n.pan.mult(u.amount/n.pan.mag()),s.center=this._map.transform.center,Lr(s,u)}if(n.zoom){var l=Rr(n.zoom,a,kr);s.zoom=this._map.transform.zoom+l.amount,Lr(s,l)}if(n.bearing){var c=Rr(n.bearing,a,Mr);s.bearing=this._map.transform.bearing+t.clamp(c.amount,-179,179),Lr(s,c)}if(n.pitch){var h=Rr(n.pitch,a,Ir);s.pitch=this._map.transform.pitch+h.amount,Lr(s,h)}if(s.zoom||s.bearing){var p=void 0===n.pinchAround?n.around:n.pinchAround;s.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Or=function(e){function r(r,i,o,a){void 0===a&&(a={});var s=n.mousePos(i.getCanvasContainer(),o),u=i.unproject(s);e.call(this,r,t.extend({point:s,lngLat:u,originalEvent:o},a)),this._defaultPrevented=!1,this.target=i}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),Dr=function(e){function r(r,i,o){var a="touchend"===r?o.changedTouches:o.touches,s=n.touchPos(i.getCanvasContainer(),a),u=s.map((function(t){return i.unproject(t)})),l=s.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new t.Point(0,0)),c=i.unproject(l);e.call(this,r,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:o}),this._defaultPrevented=!1}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),Nr=function(t){function e(e,n,r){t.call(this,e,{originalEvent:r}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,n),e}(t.Event),zr=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};zr.prototype.reset=function(){delete this._mousedownPos},zr.prototype.wheel=function(t){return this._firePreventable(new Nr(t.type,this._map,t))},zr.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Or(t.type,this._map,t))},zr.prototype.mouseup=function(t){this._map.fire(new Or(t.type,this._map,t))},zr.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Or(t.type,this._map,t))},zr.prototype.dblclick=function(t){return this._firePreventable(new Or(t.type,this._map,t))},zr.prototype.mouseover=function(t){this._map.fire(new Or(t.type,this._map,t))},zr.prototype.mouseout=function(t){this._map.fire(new Or(t.type,this._map,t))},zr.prototype.touchstart=function(t){return this._firePreventable(new Dr(t.type,this._map,t))},zr.prototype.touchmove=function(t){this._map.fire(new Dr(t.type,this._map,t))},zr.prototype.touchend=function(t){this._map.fire(new Dr(t.type,this._map,t))},zr.prototype.touchcancel=function(t){this._map.fire(new Dr(t.type,this._map,t))},zr.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},zr.prototype.isEnabled=function(){return!0},zr.prototype.isActive=function(){return!1},zr.prototype.enable=function(){},zr.prototype.disable=function(){};var Fr=function(t){this._map=t};Fr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Fr.prototype.mousemove=function(t){this._map.fire(new Or(t.type,this._map,t))},Fr.prototype.mousedown=function(){this._delayContextMenu=!0},Fr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Fr.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Or(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},Fr.prototype.isEnabled=function(){return!0},Fr.prototype.isActive=function(){return!1},Fr.prototype.enable=function(){},Fr.prototype.disable=function(){};var Br=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function Ur(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}Br.prototype.isEnabled=function(){return!!this._enabled},Br.prototype.isActive=function(){return!!this._active},Br.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Br.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Br.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(n.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},Br.prototype.mousemoveWindow=function(t,e){if(this._active){var r=e;if(!(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=r,this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var o=Math.min(i.x,r.x),a=Math.max(i.x,r.x),s=Math.min(i.y,r.y),u=Math.max(i.y,r.y);n.setTransform(this._box,"translate("+o+"px,"+s+"px)"),this._box.style.width=a-o+"px",this._box.style.height=u-s+"px"}}},Br.prototype.mouseupWindow=function(e,r){var i=this;if(this._active&&0===e.button){var o=this._startPos,a=r;if(this.reset(),n.suppressClick(),o.x!==a.x||o.y!==a.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(o,a,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},Br.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},Br.prototype.blur=function(){this.reset()},Br.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos},Br.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))};var jr=function(t){this.reset(),this.numTouches=t.numTouches};jr.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},jr.prototype.touchstart=function(e,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){for(var n=new t.Point(0,0),r=0,i=e;r<i.length;r+=1)n._add(i[r]);return n.div(e.length)}(n),this.touches=Ur(r,n)))},jr.prototype.touchmove=function(t,e,n){if(!this.aborted&&this.centroid){var r=Ur(n,e);for(var i in this.touches){var o=r[i];(!o||o.dist(this.touches[i])>30)&&(this.aborted=!0)}}},jr.prototype.touchend=function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}};var Vr=function(t){this.singleTap=new jr(t),this.numTaps=t.numTaps,this.reset()};Vr.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Vr.prototype.touchstart=function(t,e,n){this.singleTap.touchstart(t,e,n)},Vr.prototype.touchmove=function(t,e,n){this.singleTap.touchmove(t,e,n)},Vr.prototype.touchend=function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}};var Gr=function(){this._zoomIn=new Vr({numTouches:1,numTaps:2}),this._zoomOut=new Vr({numTouches:2,numTaps:1}),this.reset()};Gr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Gr.prototype.touchstart=function(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)},Gr.prototype.touchmove=function(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)},Gr.prototype.touchend=function(t,e,n){var r=this,i=this._zoomIn.touchend(t,e,n),o=this._zoomOut.touchend(t,e,n);return i?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0},Gr.prototype.touchcancel=function(){this.reset()},Gr.prototype.enable=function(){this._enabled=!0},Gr.prototype.disable=function(){this._enabled=!1,this.reset()},Gr.prototype.isEnabled=function(){return this._enabled},Gr.prototype.isActive=function(){return this._active};var Hr={0:1,2:2},Wr=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};Wr.prototype.blur=function(){this.reset()},Wr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Wr.prototype._correctButton=function(t,e){return!1},Wr.prototype._move=function(t,e){return{}},Wr.prototype.mousedown=function(t,e){if(!this._lastPoint){var r=n.mouseButton(t);this._correctButton(t,r)&&(this._lastPoint=e,this._eventButton=r)}},Wr.prototype.mousemoveWindow=function(t,e){var n=this._lastPoint;if(n)if(t.preventDefault(),function(t,e){var n=Hr[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(n,e)},Wr.prototype.mouseupWindow=function(t){this._lastPoint&&n.mouseButton(t)===this._eventButton&&(this._moved&&n.suppressClick(),this.reset())},Wr.prototype.enable=function(){this._enabled=!0},Wr.prototype.disable=function(){this._enabled=!1,this.reset()},Wr.prototype.isEnabled=function(){return this._enabled},Wr.prototype.isActive=function(){return this._active};var Zr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,n){t.prototype.mousedown.call(this,e,n),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(Wr),qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=.8*(e.x-t.x);if(n)return this._active=!0,{bearingDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Wr),Xr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=-.5*(e.y-t.y);if(n)return this._active=!0,{pitchDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Wr),Yr=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};Yr.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},Yr.prototype.touchstart=function(t,e,n){return this._calculateTransform(t,e,n)},Yr.prototype.touchmove=function(t,e,n){if(this._active&&!(n.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,n)},Yr.prototype.touchend=function(t,e,n){this._calculateTransform(t,e,n),this._active&&n.length<this._minTouches&&this.reset()},Yr.prototype.touchcancel=function(){this.reset()},Yr.prototype._calculateTransform=function(e,n,r){r.length>0&&(this._active=!0);var i=Ur(r,n),o=new t.Point(0,0),a=new t.Point(0,0),s=0;for(var u in i){var l=i[u],c=this._touches[u];c&&(o._add(l),a._add(l.sub(c)),s++,i[u]=l)}if(this._touches=i,!(s<this._minTouches)&&a.mag()){var h=a.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:o.div(s),panDelta:h}}},Yr.prototype.enable=function(){this._enabled=!0},Yr.prototype.disable=function(){this._enabled=!1,this.reset()},Yr.prototype.isEnabled=function(){return this._enabled},Yr.prototype.isActive=function(){return this._active};var Kr=function(){this.reset()};function Qr(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function Jr(t,e){return Math.log(t/e)/Math.LN2}Kr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Kr.prototype._start=function(t){},Kr.prototype._move=function(t,e,n){return{}},Kr.prototype.touchstart=function(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))},Kr.prototype.touchmove=function(t,e,n){if(this._firstTwoTouches){t.preventDefault();var r=this._firstTwoTouches,i=r[1],o=Qr(n,e,r[0]),a=Qr(n,e,i);if(o&&a){var s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,t)}}},Kr.prototype.touchend=function(t,e,r){if(this._firstTwoTouches){var i=this._firstTwoTouches,o=i[1],a=Qr(r,e,i[0]),s=Qr(r,e,o);a&&s||(this._active&&n.suppressClick(),this.reset())}},Kr.prototype.touchcancel=function(){this.reset()},Kr.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var $r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Jr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jr(this._distance,n),pinchAround:e}},e}(Kr);function ti(t,e){return 180*t.angleWith(e)/Math.PI}var ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ti(this._vector,n),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,n=ti(t,this._startVector);return Math.abs(n)<e},e}(Kr);function ni(t){return Math.abs(t.y)>Math.abs(t.x)}var ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,ni(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,n){var r=t[0].sub(this._lastPoints[0]),i=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,n){if(void 0!==this._valid)return this._valid;var r=t.mag()>=2,i=e.mag()>=2;if(r||i){if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;var o=t.y>0==e.y>0;return ni(t)&&ni(e)&&o}},e}(Kr),ii={panStep:100,bearingStep:15,pitchStep:10},oi=function(){var t=ii;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1};function ai(t){return t*(2-t)}oi.prototype.blur=function(){this.reset()},oi.prototype.reset=function(){this._active=!1},oi.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:ai,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e._bearingStep,pitch:s.getPitch()+i*e._pitchStep,offset:[-o*e._panStep,-a*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},oi.prototype.enable=function(){this._enabled=!0},oi.prototype.disable=function(){this._enabled=!1,this.reset()},oi.prototype.isEnabled=function(){return this._enabled},oi.prototype.isActive=function(){return this._active},oi.prototype.disableRotation=function(){this._rotationDisabled=!0},oi.prototype.enableRotation=function(){this._rotationDisabled=!1};var si=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};si.prototype.setZoomRate=function(t){this._defaultZoomRate=t},si.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},si.prototype.isEnabled=function(){return!!this._enabled},si.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},si.prototype.isZooming=function(){return!!this._zooming},si.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},si.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},si.prototype.wheel=function(e){if(this.isEnabled()){var n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,r=t.browser.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}},si.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},si.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var r=n.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},si.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var n=this._map.transform;if(0!==this._delta){var r="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==i&&(i=1/i);var o="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a,s="number"==typeof this._targetZoom?this._targetZoom:n.zoom,u=this._startZoom,l=this._easing,c=!1;if("wheel"===this._type&&u&&l){var h=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),p=l(h);a=t.number(u,s,p),h<1?this._frameId||(this._frameId=!0):c=!0}else a=s,c=!0;return this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:a-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},si.prototype._smoothOutEasing=function(e){var n=t.ease;if(this._prevEase){var r=this._prevEase,i=(t.browser.now()-r.start)/r.duration,o=r.easing(i+.01)-r.easing(i),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:n},n},si.prototype.blur=function(){this.reset()},si.prototype.reset=function(){this._active=!1};var ui=function(t,e){this._clickZoom=t,this._tapZoom=e};ui.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ui.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ui.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ui.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var li=function(){this.reset()};li.prototype.reset=function(){this._active=!1},li.prototype.blur=function(){this.reset()},li.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}},li.prototype.enable=function(){this._enabled=!0},li.prototype.disable=function(){this._enabled=!1,this.reset()},li.prototype.isEnabled=function(){return this._enabled},li.prototype.isActive=function(){return this._active};var ci=function(){this._tap=new Vr({numTouches:1,numTaps:1}),this.reset()};ci.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ci.prototype.touchstart=function(t,e,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=e[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,e,n))},ci.prototype.touchmove=function(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var r=e[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,n)},ci.prototype.touchend=function(t,e,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(t,e,n)&&(this._tapTime=t.timeStamp)},ci.prototype.touchcancel=function(){this.reset()},ci.prototype.enable=function(){this._enabled=!0},ci.prototype.disable=function(){this._enabled=!1,this.reset()},ci.prototype.isEnabled=function(){return this._enabled},ci.prototype.isActive=function(){return this._active};var hi=function(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n};hi.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hi.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hi.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hi.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pi=function(t,e,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=n};pi.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pi.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pi.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pi.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var fi=function(t,e,n,r){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0};fi.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},fi.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},fi.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},fi.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},fi.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},fi.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var di=function(t){return t.zoom||t.drag||t.pitch||t.rotate},vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event);function mi(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var yi=function(e,r){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pr(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),t.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[t.window,"blur",void 0]];for(var o=0,a=this._listeners;o<a.length;o+=1){var s=a[o],u=s[0];n.addEventListener(u,s[1],u===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};yi.prototype.destroy=function(){for(var e=0,r=this._listeners;e<r.length;e+=1){var i=r[e],o=i[0];n.removeEventListener(o,i[1],o===t.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},yi.prototype._addDefaultHandlers=function(t){var e=this._map,n=e.getCanvasContainer();this._add("mapEvent",new zr(e,t));var r=e.boxZoom=new Br(e,t);this._add("boxZoom",r);var i=new Gr,o=new li;e.doubleClickZoom=new ui(o,i),this._add("tapZoom",i),this._add("clickZoom",o);var a=new ci;this._add("tapDragZoom",a);var s=e.touchPitch=new ri;this._add("touchPitch",s);var u=new qr(t),l=new Xr(t);e.dragRotate=new pi(t,u,l),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",l,["mouseRotate"]);var c=new Zr(t),h=new Yr(t);e.dragPan=new hi(n,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);var p=new ei,f=new $r;e.touchZoomRotate=new fi(n,f,p,a),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]);var d=e.scrollZoom=new si(e,this);this._add("scrollZoom",d,["mousePan"]);var v=e.keyboard=new oi;this._add("keyboard",v),this._add("blockableMapEvent",new Fr(e));for(var m=0,y=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<y.length;m+=1){var g=y[m];t.interactive&&t[g]&&e[g].enable(t[g])}},yi.prototype._add=function(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e},yi.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,n=this._handlers;e<n.length;e+=1)n[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},yi.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},yi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},yi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},yi.prototype.isMoving=function(){return Boolean(di(this._eventsInProgress))||this.isZooming()},yi.prototype._blockedByActive=function(t,e,n){for(var r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1},yi.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},yi.prototype._getMapTouches=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=r[n];this._el.contains(i.target)&&e.push(i)}return e},yi.prototype.handleEvent=function(t,e){this._updatingCamera=!0;for(var r="renderFrame"===t.type?void 0:t,i={needsRenderFrame:!1},o={},a={},s=t.touches?this._getMapTouches(t.touches):void 0,u=s?n.touchPos(this._el,s):n.mousePos(this._el,t),l=0,c=this._handlers;l<c.length;l+=1){var h=c[l],p=h.handlerName,f=h.handler,d=h.allowed;if(f.isEnabled()){var v=void 0;this._blockedByActive(a,d,p)?f.reset():f[e||t.type]&&(v=f[e||t.type](t,u,s),this.mergeHandlerResult(i,o,v,p,r),v&&v.needsRenderFrame&&this._triggerRenderFrame()),(v||f.isActive())&&(a[p]=f)}}var m={};for(var y in this._previousActiveHandlers)a[y]||(m[y]=r);this._previousActiveHandlers=a,(Object.keys(m).length||mi(i))&&(this._changes.push([i,o,m]),this._triggerRenderFrame()),(Object.keys(a).length||mi(i))&&this._map._stop(!0),this._updatingCamera=!1;var g=i.cameraAnimation;g&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],g(this._map))},yi.prototype.mergeHandlerResult=function(e,n,r,i,o){if(r){t.extend(e,r);var a={handlerName:i,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(n.zoom=a),void 0!==r.panDelta&&(n.drag=a),void 0!==r.pitchDelta&&(n.pitch=a),void 0!==r.bearingDelta&&(n.rotate=a)}},yi.prototype._applyChanges=function(){for(var e={},n={},r={},i=0,o=this._changes;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],l=a[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(n,u),t.extend(r,l)}this._updateMapTransform(e,n,r),this._changes=[]},yi.prototype._updateMapTransform=function(t,e,n){var r=this._map,i=r.transform;if(!mi(t))return this._fireEvents(e,n,!0);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,l=t.around,c=t.pinchAround;void 0!==c&&(l=c),r._stop(!0),l=l||r.transform.centerPoint;var h=i.pointLocation(o?l.sub(o):l);s&&(i.bearing+=s),u&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,l),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,n,!0)},yi.prototype._fireEvents=function(e,n,r){var i=this,o=di(this._eventsInProgress),a=di(e),s={};for(var u in e)this._eventsInProgress[u]||(s[u+"start"]=e[u].originalEvent),this._eventsInProgress[u]=e[u];for(var l in!o&&a&&this._fireEvent("movestart",a.originalEvent),s)this._fireEvent(l,s[l]);for(var c in a&&this._fireEvent("move",a.originalEvent),e)this._fireEvent(c,e[c].originalEvent);var h,p={};for(var f in this._eventsInProgress){var d=this._eventsInProgress[f],v=d.handlerName,m=d.originalEvent;this._handlersById[v].isActive()||(delete this._eventsInProgress[f],p[f+"end"]=h=n[v]||m)}for(var y in p)this._fireEvent(y,p[y]);var g=di(this._eventsInProgress);if(r&&(o||a)&&!g){this._updatingCamera=!0;var _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),x=function(t){return 0!==t&&-i._bearingSnap<t&&t<i._bearingSnap};_?(x(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:h})):(this._map.fire(new t.Event("moveend",{originalEvent:h})),x(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},yi.prototype._fireEvent=function(e,n){this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},yi.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new vi("renderFrame",{timeStamp:e})),t._applyChanges()}))},yi.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var gi=function(e){function n(n,r){e.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=r.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},n.prototype.panBy=function(e,n,r){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),r)},n.prototype.panTo=function(e,n,r){return this.easeTo(t.extend({center:e},n),r)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},n.prototype.zoomTo=function(e,n,r){return this.easeTo(t.extend({zoom:e},n),r)},n.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},n.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},n.prototype.getPadding=function(){return this.transform.padding},n.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},n.prototype.rotateTo=function(e,n,r){return this.easeTo(t.extend({bearing:e},n),r)},n.prototype.resetNorth=function(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this},n.prototype.resetNorthPitch=function(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this},n.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},n.prototype.cameraForBounds=function(e,n){e=t.LngLatBounds.convert(e);var r=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),r,n)},n.prototype._cameraForBoxAndBearing=function(e,n,r,i){var o={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=t.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var a=i.padding;i.padding={top:a,bottom:a,right:a,left:a}}i.padding=t.extend(o,i.padding);var s=this.transform,u=s.padding,l=s.project(t.LngLat.convert(e)),c=s.project(t.LngLat.convert(n)),h=l.rotate(-r*Math.PI/180),p=c.rotate(-r*Math.PI/180),f=new t.Point(Math.max(h.x,p.x),Math.max(h.y,p.y)),d=new t.Point(Math.min(h.x,p.x),Math.min(h.y,p.y)),v=f.sub(d),m=(s.width-(u.left+u.right+i.padding.left+i.padding.right))/v.x,y=(s.height-(u.top+u.bottom+i.padding.top+i.padding.bottom))/v.y;if(!(y<0||m<0)){var g=Math.min(s.scaleZoom(s.scale*Math.min(m,y)),i.maxZoom),_="number"==typeof i.offset.x?new t.Point(i.offset.x,i.offset.y):t.Point.convert(i.offset),x=new t.Point((i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2).rotate(r*Math.PI/180),b=_.add(x).mult(s.scale/s.zoomScale(g));return{center:s.unproject(l.add(c).div(2).sub(b)),zoom:g,bearing:r}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},n.prototype.fitBounds=function(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)},n.prototype.fitScreenCoordinates=function(e,n,r,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(n)),r,i),i,o)},n.prototype._fitInternal=function(e,n,r){return e?(delete(n=t.extend(e,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this},n.prototype.jumpTo=function(e,n){this.stop();var r=this.transform,i=!1,o=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(i=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),i&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),o&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),a&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))},n.prototype.easeTo=function(e,n){var r=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l="zoom"in e?+e.zoom:o,c="bearing"in e?this._normalizeBearing(e.bearing,a):a,h="pitch"in e?+e.pitch:s,p="padding"in e?e.padding:i.padding,f=t.Point.convert(e.offset),d=i.centerPoint.add(f),v=i.pointLocation(d),m=t.LngLat.convert(e.center||v);this._normalizeCenter(m);var y,g,_=i.project(v),x=i.project(m).sub(_),b=i.zoomScale(l-o);e.around&&(y=t.LngLat.convert(e.around),g=i.locationPoint(y));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==o,this._rotating=this._rotating||a!==c,this._pitching=this._pitching||h!==s,this._padding=!i.isPaddingEqual(p),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,w),this._ease((function(e){if(r._zooming&&(i.zoom=t.number(o,l,e)),r._rotating&&(i.bearing=t.number(a,c,e)),r._pitching&&(i.pitch=t.number(s,h,e)),r._padding&&(i.interpolatePadding(u,p,e),d=i.centerPoint.add(f)),y)i.setLocationAtPoint(y,g);else{var v=i.zoomScale(i.zoom-o),m=l>o?Math.min(2,b):Math.max(.5,b),w=Math.pow(m,1-e),S=i.unproject(_.add(x.mult(e*w)).mult(v));i.setLocationAtPoint(i.renderWorldCopies?S.wrap():S,d)}r._fireMoveEvents(n)}),(function(t){r._afterEase(n,t)}),e),this},n.prototype._prepareEase=function(e,n,r){void 0===r&&(r={}),this._moving=!0,n||r.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.Event("pitchstart",e))},n.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},n.prototype._afterEase=function(e,n){if(!this._easeId||!n||this._easeId!==n){delete this._easeId;var r=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},n.prototype.flyTo=function(e,n){var r=this;if(!e.essential&&t.browser.prefersReducedMotion){var i=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,a=this.getZoom(),s=this.getBearing(),u=this.getPitch(),l=this.getPadding(),c="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):a,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,p="pitch"in e?+e.pitch:u,f="padding"in e?e.padding:o.padding,d=o.zoomScale(c-a),v=t.Point.convert(e.offset),m=o.centerPoint.add(v),y=o.pointLocation(m),g=t.LngLat.convert(e.center||y);this._normalizeCenter(g);var _=o.project(y),x=o.project(g).sub(_),b=e.curve,w=Math.max(o.width,o.height),S=w/d,E=x.mag();if("minZoom"in e){var A=t.clamp(Math.min(e.minZoom,a,c),o.minZoom,o.maxZoom),T=w/o.zoomScale(A-a);b=Math.sqrt(T/E*2)}var C=b*b;function k(t){var e=(S*S-w*w+(t?-1:1)*C*C*E*E)/(2*(t?S:w)*C*E);return Math.log(Math.sqrt(e*e+1)-e)}function M(t){return(Math.exp(t)-Math.exp(-t))/2}function I(t){return(Math.exp(t)+Math.exp(-t))/2}var P=k(0),L=function(t){return I(P)/I(P+b*t)},R=function(t){return w*((I(P)*(M(e=P+b*t)/I(e))-M(P))/C)/E;var e},O=(k(1)-P)/b;if(Math.abs(E)<1e-6||!isFinite(O)){if(Math.abs(w-S)<1e-6)return this.easeTo(e,n);var D=S<w?-1:1;O=Math.abs(Math.log(S/w))/b,R=function(){return 0},L=function(t){return Math.exp(D*b*t)}}return e.duration="duration"in e?+e.duration:1e3*O/("screenSpeed"in e?+e.screenSpeed/b:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=p!==u,this._padding=!o.isPaddingEqual(f),this._prepareEase(n,!1),this._ease((function(e){var i=e*O,d=1/L(i);o.zoom=1===e?c:a+o.scaleZoom(d),r._rotating&&(o.bearing=t.number(s,h,e)),r._pitching&&(o.pitch=t.number(u,p,e)),r._padding&&(o.interpolatePadding(l,f,e),m=o.centerPoint.add(v));var y=1===e?g:o.unproject(_.add(x.mult(R(i))).mult(d));o.setLocationAtPoint(o.renderWorldCopies?y.wrap():y,m),r._fireMoveEvents(n)}),(function(){return r._afterEase(n)}),e),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){return this._stop()},n.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,e)}if(!t){var r=this.handlers;r&&r.stop(!1)}return this},n.prototype._ease=function(e,n,r){!1===r.animate||0===r.duration?(e(1),n()):(this._easeStart=t.browser.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(e,n){e=t.wrap(e,-180,180);var r=Math.abs(e-n);return Math.abs(e-360-n)<r&&(e-=360),Math.abs(e+360-n)<r&&(e+=360),e},n.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}},n}(t.Evented),_i=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};_i.prototype.getDefaultPosition=function(){return"bottom-right"},_i.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=n.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=n.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},_i.prototype.onRemove=function(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},_i.prototype._setElementTitle=function(t,e){var n=this._map._getUIString("AttributionControl."+e);t.title=n,t.setAttribute("aria-label",n)},_i.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},_i.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var r=n.reduce((function(t,e,r){return e.value&&(t+=e.key+"="+e.value+(r<n.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+r+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}},_i.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},_i.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var n=this._map.style.sourceCaches;for(var r in n){var i=n[r];if(i.used){var o=i.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((function(t,e){return t.length-e.length}));var a=(t=t.filter((function(e,n){for(var r=n+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}))).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},_i.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var xi=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};xi.prototype.onAdd=function(t){this._map=t,this._container=n.create("div","mapboxgl-ctrl");var e=n.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},xi.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},xi.prototype.getDefaultPosition=function(){return"bottom-left"},xi.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},xi.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},xi.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var bi=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};bi.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},bi.prototype.remove=function(t){for(var e=this._currentlyRunning,n=0,r=e?this._queue.concat(e):this._queue;n<r.length;n+=1){var i=r[n];if(i.id===t)return void(i.cancelled=!0)}},bi.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var n=0,r=e;n<r.length;n+=1){var i=r[n];if(!i.cancelled&&(i.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},bi.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var wi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Si=t.window.HTMLImageElement,Ei=t.window.HTMLElement,Ai=t.window.ImageBitmap,Ti={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ci=function(r){function i(e){var n=this;if(null!=(e=t.extend({},Ti,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var i=new Sr(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(r.call(this,i,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new bi,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},wi,e.locale),this._clickTolerance=e.clickTolerance,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Ei))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return n._update(!1)})),this.on("moveend",(function(){return n._update(!1)})),this.on("zoom",(function(){return n._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new yi(this,e),this._hash=e.hash&&new Ar("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new _i({customAttribution:e.customAttribution})),this.addControl(new xi,e.logoPosition),this.on("style.load",(function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)})),this.on("data",(function(e){n._update("style"===e.dataType),n.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){n.fire(new t.Event(e.dataType+"dataloading",e))}))}r&&(i.__proto__=r),(i.prototype=Object.create(r&&r.prototype)).constructor=i;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=e.onAdd(this);this._controls.push(e);var i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this},i.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this},i.prototype.hasControl=function(t){return this._controls.indexOf(t)>-1},i.prototype.resize=function(e){var n=this._containerDimensions(),r=n[0],i=n[1];if(r===this.transform.width&&i===this.transform.height)return this;this._resizeCanvas(r,i),this.transform.resize(r,i),this.painter.resize(r,i);var o=!this._moving;return o&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),o&&this.fire(new t.Event("moveend",e)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},i.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},i.prototype.getMinPitch=function(){return this.transform.minPitch},i.prototype.setMaxPitch=function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},i.prototype.getMaxPitch=function(){return this.transform.maxPitch},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},i.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},i.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},i.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},i.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},i.prototype._createDelegatedListener=function(t,e,n){var r,i=this;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){var a=i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[];a.length?o||(o=!0,n.call(i,new Or(t,i,r.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){(i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,n.call(i,new Or(t,i,r.originalEvent)))},mouseout:function(e){a&&(a=!1,n.call(i,new Or(t,i,e.originalEvent)))}}}}return{layer:e,listener:n,delegates:(r={},r[t]=function(t){var r=i.getLayer(e)?i.queryRenderedFeatures(t.point,{layers:[e]}):[];r.length&&(t.features=r,n.call(i,t),delete t.features)},r)}},i.prototype.on=function(t,e,n){if(void 0===n)return r.prototype.on.call(this,t,e);var i=this._createDelegatedListener(t,e,n);for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i),i.delegates)this.on(o,i.delegates[o]);return this},i.prototype.once=function(t,e,n){if(void 0===n)return r.prototype.once.call(this,t,e);var i=this._createDelegatedListener(t,e,n);for(var o in i.delegates)this.once(o,i.delegates[o]);return this},i.prototype.off=function(t,e,n){var i=this;return void 0===n?r.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(r){for(var o=r[t],a=0;a<o.length;a++){var s=o[a];if(s.layer===e&&s.listener===n){for(var u in s.delegates)i.off(u,s.delegates[u]);return o.splice(a,1),i}}}(this._delegatedListeners),this)},i.prototype.queryRenderedFeatures=function(e,n){if(!this.style)return[];var r;if(void 0!==n||void 0===e||e instanceof t.Point||Array.isArray(e)||(n=e,e=void 0),n=n||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])r=[t.Point.convert(e)];else{var i=t.Point.convert(e[0]),o=t.Point.convert(e[1]);r=[i,new t.Point(o.x,i.y),o,new t.Point(i.x,o.y),i]}return this.style.queryRenderedFeatures(r,n,this.transform)},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))},i.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},i.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Ge(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ge(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},i.prototype._diffStyle=function(e,n){var r=this;if("string"==typeof e){var i=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(i,t.ResourceType.Style);t.getJSON(o,(function(e,i){e?r.fire(new t.ErrorEvent(e)):i&&r._updateDiff(i,n)}))}else"object"==typeof e&&this._updateDiff(e,n)},i.prototype._updateDiff=function(e,n){try{this.style.setState(e)&&this._update(!0)}catch(r){t.warnOnce("Unable to perform style diff: "+(r.message||r.error||r)+".  Rebuilding the style from scratch."),this._updateStyle(e,n)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},i.prototype.isSourceLoaded=function(e){var n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var n=t[e]._tiles;for(var r in n){var i=n[r];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(e,n,r){void 0===r&&(r={});var i=r.pixelRatio;void 0===i&&(i=1);var o=r.sdf;void 0===o&&(o=!1);var a=r.stretchX,s=r.stretchY,u=r.content;if(this._lazyInitEmptyStyle(),n instanceof Si||Ai&&n instanceof Ai){var l=t.browser.getImageData(n);this.style.addImage(e,{data:new t.RGBAImage({width:l.width,height:l.height},l.data),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=n;this.style.addImage(e,{data:new t.RGBAImage({width:n.width,height:n.height},new Uint8Array(n.data)),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}},i.prototype.updateImage=function(e,n){var r=this.style.getImage(e);if(!r)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=n instanceof Si||Ai&&n instanceof Ai?t.browser.getImageData(n):n,o=i.width,a=i.height,s=i.data;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==r.data.width||a!==r.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(n instanceof Si||Ai&&n instanceof Ai)),void this.style.updateImage(e,r))},i.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),n)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)},i.prototype.setFilter=function(t,e,n){return void 0===n&&(n={}),this.style.setFilter(t,e,n),this._update(!0)},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setPaintProperty(t,e,n,r),this._update(!0)},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setLayoutProperty(t,e,n,r),this._update(!0)},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},i.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},i.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=n.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=n.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=n.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var i=this._controlContainer=n.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){o[t]=n.create("div","mapboxgl-ctrl-"+t,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},i.prototype._resizeCanvas=function(e,n){var r=t.browser.devicePixelRatio||1;this._canvas.width=r*e,this._canvas.height=r*n,this._canvas.style.width=e+"px",this._canvas.style.height=n+"px"},i.prototype._setupPainter=function(){var n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);r?(this.painter=new _r(r,this.transform),t.webpSupported.testSupport(r)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},i.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},i.prototype._onMapScroll=function(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},i.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},i.prototype._render=function(e){var n,r=this,i=0,o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,n),i=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,u=t.browser.now();this.style.zoomHistory.update(s,u);var l=new t.EvaluationParameters(s,{now:u,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=l.crossFadingFactor();1===c&&c===this._crossFadingFactor||(a=!0,this._crossFadingFactor=c),this.style.update(l)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=t.browser.now()-i;o.endQueryEXT(o.TIME_ELAPSED_EXT,n),setTimeout((function(){var e=o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(n),r.fire(new t.Event("gpu-timing-frame",{cpuTime:h,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var p=this.painter.collectGpuTimers();setTimeout((function(){var e=r.painter.queryGpuTimers(p);r.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0),this}},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,n=this._controls;e<n.length;e+=1)n[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),ki(this._canvasContainer),ki(this._controlContainer),ki(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},i.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},i.prototype._setCacheLimits=function(e,n){t.setCacheLimits(e,n)},o.version.get=function(){return t.version},Object.defineProperties(i.prototype,o),i}(gi);function ki(t){t.parentNode&&t.parentNode.removeChild(t)}var Mi={showCompass:!0,showZoom:!0,visualizePitch:!1},Ii=function(e){var r=this;this.options=t.extend({},Mi,e),this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return r._map.zoomIn({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return r._map.zoomOut({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){r.options.visualizePitch?r._map.resetNorthPitch({},{originalEvent:t}):r._map.resetNorth({},{originalEvent:t})})),this._compassIcon=n.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ii.prototype._updateZoomButtons=function(){var t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},Ii.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},Ii.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pi(this._map,this._compass,this.options.visualizePitch)),this._container},Ii.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ii.prototype._createButton=function(t,e){var r=n.create("button",t,this._container);return r.type="button",r.addEventListener("click",e),r},Ii.prototype._setButtonTitle=function(t,e){var n=this._map._getUIString("NavigationControl."+e);t.title=n,t.setAttribute("aria-label",n)};var Pi=function(e,r,i){void 0===i&&(i=!1),this._clickTolerance=10,this.element=r,this.mouseRotate=new qr({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new Xr({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener(r,"mousedown",this.mousedown),n.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),n.addEventListener(r,"touchmove",this.touchmove),n.addEventListener(r,"touchend",this.touchend),n.addEventListener(r,"touchcancel",this.reset)};function Li(e,n,r){if(e=new t.LngLat(e.lng,e.lat),n){var i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=r.locationPoint(e).distSqr(n);r.locationPoint(i).distSqr(n)<a?e=i:r.locationPoint(o).distSqr(n)<a&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){var s=r.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}Pi.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),n.disableDrag()},Pi.prototype.move=function(t,e){var n=this.map,r=this.mouseRotate.mousemoveWindow(t,e);if(r&&r.bearingDelta&&n.setBearing(n.getBearing()+r.bearingDelta),this.mousePitch){var i=this.mousePitch.mousemoveWindow(t,e);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}},Pi.prototype.off=function(){var t=this.element;n.removeEventListener(t,"mousedown",this.mousedown),n.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),n.removeEventListener(t,"touchmove",this.touchmove),n.removeEventListener(t,"touchend",this.touchend),n.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},Pi.prototype.offTemp=function(){n.enableDrag(),n.removeEventListener(t.window,"mousemove",this.mousemove),n.removeEventListener(t.window,"mouseup",this.mouseup)},Pi.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),n.mousePos(this.element,e)),n.addEventListener(t.window,"mousemove",this.mousemove),n.addEventListener(t.window,"mouseup",this.mouseup)},Pi.prototype.mousemove=function(t){this.move(t,n.mousePos(this.element,t))},Pi.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},Pi.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},Pi.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},Pi.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Pi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ri={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Oi(t,e,n){var r=t.classList;for(var i in Ri)r.remove("mapboxgl-"+n+"-anchor-"+i);r.add("mapboxgl-"+n+"-anchor-"+e)}var Di,Ni=function(e){function r(r,i){if(e.call(this),(r instanceof t.window.HTMLElement||i)&&(r=t.extend({element:r},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=t.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div"),this._element.setAttribute("aria-label","Map marker");var o=n.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=n.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=n.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var h=c[l],p=n.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),u.appendChild(p)}var f=n.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill",this._color);var d=n.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),f.appendChild(d);var v=n.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"fill","#000000");var m=n.createNS("http://www.w3.org/2000/svg","path");m.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),v.appendChild(m);var y=n.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),y.setAttributeNS(null,"fill","#FFFFFF");var g=n.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=n.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var x=n.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#FFFFFF"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962"),g.appendChild(_),g.appendChild(x),s.appendChild(u),s.appendChild(f),s.appendChild(v),s.appendChild(y),s.appendChild(g),o.appendChild(s),o.setAttributeNS(null,"height",41*this._scale+"px"),o.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(o),this._offset=t.Point.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),Oi(this._element,this._anchor,"marker"),this._popup=null}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},r.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},r.prototype.getElement=function(){return this._element},r.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},r.prototype._onKeyPress=function(t){var e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()},r.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},r.prototype.getPopup=function(){return this._popup},r.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},r.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Li(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),n.setTransform(this._element,Ri[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+r+" "+e)}},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},r.prototype._onMove=function(e){if(!this._isDragging){var n=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))},r.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},r.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},r.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},r.prototype.isDraggable=function(){return this._draggable},r.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},r.prototype.getRotation=function(){return this._rotation},r.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},r.prototype.getRotationAlignment=function(){return this._rotationAlignment},r.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},r.prototype.getPitchAlignment=function(){return this._pitchAlignment},r}(t.Evented),zi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Fi=0,Bi=!1,Ui=function(e){function r(n){e.call(this),this.options=t.extend({},zi,n),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(e){var r;return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Di?r(Di):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){r(Di="denied"!==t.state)})):r(Di=!!t.window.navigator.geolocation),this._container},r.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fi=0,Bi=!1},r.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())},r.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},r.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},r.prototype._updateCamera=function(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),o,{geolocateSource:!0})},r.prototype._updateMarker=function(e){if(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},r.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),n=this._map.unproject([1,t]),r=e.distanceTo(n),i=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"},r.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},r.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Bi)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},r.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},r.prototype._setupUI=function(e){var r=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=n.create("button","mapboxgl-ctrl-geolocate",this._container),n.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{var o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ni(this._dotElement),this._circleElement=n.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ni({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==r._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(r._watchState="BACKGROUND",r._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),r._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),r.fire(new t.Event("trackuserlocationend")))}))},r.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fi--,Bi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Fi>1?(e={maximumAge:6e5,timeout:0},Bi=!0):(e=this.options.positionOptions,Bi=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},r.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},r}(t.Evented),ji={maxWidth:100,unit:"metric"},Vi=function(e){this.options=t.extend({},ji,e),t.bindAll(["_onMove","setUnit"],this)};function Gi(t,e,n){var r=n&&n.maxWidth||100,i=t._container.clientHeight/2,o=t.unproject([0,i]),a=t.unproject([r,i]),s=o.distanceTo(a);if(n&&"imperial"===n.unit){var u=3.2808*s;u>5280?Hi(e,r,u/5280,t._getUIString("ScaleControl.Miles")):Hi(e,r,u,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?Hi(e,r,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?Hi(e,r,s/1e3,t._getUIString("ScaleControl.Kilometers")):Hi(e,r,s,t._getUIString("ScaleControl.Meters"))}function Hi(t,e,n,r){var i,o,a,s=(i=n,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=(a=i/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a)));t.style.width=e*(s/n)+"px",t.innerHTML=s+"&nbsp;"+r}Vi.prototype.getDefaultPosition=function(){return"bottom-left"},Vi.prototype._onMove=function(){Gi(this._map,this._container,this.options)},Vi.prototype.onAdd=function(t){return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Vi.prototype.onRemove=function(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Vi.prototype.setUnit=function(t){this.options.unit=t,Gi(this._map,this._container,this.options)};var Wi=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};Wi.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Wi.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Wi.prototype._setupUI=function(){var e=this._fullscreenButton=n.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);n.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Wi.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Wi.prototype._isFullscreen=function(){return this._fullscreen},Wi.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Wi.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Zi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Xi=function(e){function r(n){e.call(this),this.options=t.extend(Object.create(Zi),n),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},r.prototype.isOpen=function(){return!!this._map},r.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},r.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},r.prototype.getElement=function(){return this._container},r.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},r.prototype.setHTML=function(e){var n,r=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");for(i.innerHTML=e;n=i.firstChild;)r.appendChild(n);return this.setDOMContent(r)},r.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},r.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},r.prototype.setDOMContent=function(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this},r.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},r.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},r.prototype.setOffset=function(t){return this.options.offset=t,this._update(),this},r.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},r.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=n.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},r.prototype._onMouseUp=function(t){this._update(t.point)},r.prototype._onMouseMove=function(t){this._update(t.point)},r.prototype._onDrag=function(t){this._update(t.point)},r.prototype._update=function(e){var r=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=n.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return r._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Li(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var i=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),o=this.options.anchor,a=function e(n){if(n){if("number"==typeof n){var r=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new t.Point(0,0),top:new t.Point(0,n),"top-left":new t.Point(r,r),"top-right":new t.Point(-r,r),bottom:new t.Point(0,-n),"bottom-left":new t.Point(r,-r),"bottom-right":new t.Point(-r,-r),left:new t.Point(n,0),right:new t.Point(-n,0)}}if(n instanceof t.Point||Array.isArray(n)){var i=t.Point.convert(n);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.Point.convert(n.center||[0,0]),top:t.Point.convert(n.top||[0,0]),"top-left":t.Point.convert(n["top-left"]||[0,0]),"top-right":t.Point.convert(n["top-right"]||[0,0]),bottom:t.Point.convert(n.bottom||[0,0]),"bottom-left":t.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(n["bottom-right"]||[0,0]),left:t.Point.convert(n.left||[0,0]),right:t.Point.convert(n.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!o){var s,u=this._container.offsetWidth,l=this._container.offsetHeight;s=i.y+a.bottom.y<l?["top"]:i.y>this._map.transform.height-l?["bottom"]:[],i.x<u/2?s.push("left"):i.x>this._map.transform.width-u/2&&s.push("right"),o=0===s.length?"bottom":s.join("-")}var c=i.add(a[o]).round();n.setTransform(this._container,Ri[o]+" translate("+c.x+"px,"+c.y+"px)"),Oi(this._container,o,"popup")}},r.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var t=this._container.querySelector(qi);t&&t.focus()}},r.prototype._onClose=function(){this.remove()},r}(t.Evented),Yi={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:Ci,NavigationControl:Ii,GeolocateControl:Ui,AttributionControl:_i,ScaleControl:Vi,FullscreenControl:Wi,Popup:Xi,Marker:Ni,Style:Ge,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,prewarm:function(){Ft().acquire(Ot)},clearPrewarmedResources:function(){var t=Nt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Ot),Nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Dt.workerCount},set workerCount(t){Dt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return Yi})),n}()}(fC);var dC,vC=fC.exports,mC=function(){function t(){Ee(this,t)}return Te(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth;this.viewport=new c_({width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),yC=["id","attributionControl","style","token","rotation","mapInstance"];function gC(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=vC;var _C=0,xC="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",bC=ku.injectable()(dC=function(t){Oe(r,t);var e,n=gC(r);function r(){var t;Ee(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return kt(De(t=n.call.apply(n,[this].concat(i))),"version",Og.MAPBOX),t}return Te(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(t,0),r=n.x,i=n.y;return[r-e.x,i-e.y]}},{key:"lngLatToMercator",value:function(t,e){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=ia();return ca(s,s,Ia(o.x-i.x,o.y-i.y,o.z||0-i.z)),ha(s,s,Ia(a*r[0],-a*r[1],a*r[2])),pa(s,s,n[0]),fa(s,s,n[1]),da(s,s,n[2]),s}},{key:"init",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,p,f,d=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,i=e.attributionControl,o=void 0!==i&&i,a=e.style,s=void 0===a?"light":a,u=e.token,l=void 0===u?xC:u,c=e.rotation,h=void 0===c?0:c,p=e.mapInstance,f=Wf(e,yC),this.viewport=new mC,p||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),l!==xC||"blank"===s||window.mapboxgl.accessToken||p||console.warn(this.configService.getSceneWarninfo("MapToken")),p||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=l),p?(this.map=p,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.mapboxgl.Map(It({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:h},f))),this.map.on("load",(function(){d.handleCameraChanged()})),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,e){var n=new vC.LngLat(t[0],t[1]),r=new vC.LngLat(e[0],e[1]),i=n.distanceTo(r),o=vC.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),a=vC.MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=o.x,u=o.y,l=a.x,c=a.y;return 4194304*Math.sqrt(Math.pow(s-l,2)+Math.pow(u-c,2))*2/i}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"creatMapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+_C++,e.appendChild(n),n}}]),r}(aC))||dC;function wC(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-ctrl-logo {\n display: none !important;\n}\n");var SC=function(t){Oe(n,t);var e=wC(n);function n(){return Ee(this,n),e.apply(this,arguments)}return Te(n,[{key:"getServiceConstructor",value:function(){return bC}}]),n}(Pg);function EC(t,e){t.length>0&&e.version===Og.SIMPLE&&t.map((function(t){t.simpleCoordinate||(t.coordinates=function(t,e){if("number"==typeof t[0])return e.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var n=[];return t.map((function(t){var r=[];t.map((function(t){r.push(e.simpleMapCoord.unproject(t))})),n.push(r)})),n}var r=[];return t.map((function(t){r.push(e.simpleMapCoord.unproject(t))})),r}(t.coordinates,e),t.simpleCoordinate=!0)}))}function AC(t,e,n,r,i){var o=(null==i?void 0:i.getLayerConfig()).arrow,a=void 0===o?{enable:!1}:o,s=e.map((function(e){var r,i,o,s={id:e._id,coordinates:e.coordinates};if(t.filter((function(t){return void 0!==t.scale})).forEach((function(t){var r=function(t,e){var n;if(!t.scale)return[];var r=(null==t||null===(n=t.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(e.hasOwnProperty(o)||"variable"===(null===(r=t.scale)||void 0===r?void 0:r.type))&&i.push(e[o])})),t.mapping?t.mapping(i):[]}(t,e);t.needRemapping=!1,"color"===t.name&&(r=r.map((function(t){return Hr(t)}))),s[t.name]=Array.isArray(r)&&1===r.length?r[0]:r,"shape"===t.name&&(s.shape=n.getIconFontKey(s[t.name]))})),"line"===s.shape&&a.enable){var u=s.coordinates,l=(r=u[0],i=u[1],o=Ci([i[0]-r[0],i[1]-r[1]]),[r[0]+1e-4*o[0],r[1]+1e-4*o[1]]);s.coordinates.splice(1,0,l,l)}return s}));return function(t,e,n){if(t.length>0&&e.version===Og["GAODE2.x"]){var r=n.coordCenter;t[0].coordinates[0],t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=Og["GAODE2.x"],t.originCoordinates=ti.exports.cloneDeep(t.coordinates),t.coordinates=e.coordToAMap2RelativeCoordinates(t.coordinates,r)}))}}(s,r,i),EC(s,r),s}function TC(t){return t.map((function(t){return"string"==typeof t&&(t=[t,{}]),t}))}function CC(t,e,n,r){var i=t.multiPassRenderer;return t.getLayerConfig().enableTAA?i.add(r("taa")):i.add(r("render")),TC(e).forEach((function(t){var e=$r(t,2),r=e[0],o=e[1];i.add(n(r),o)})),i.add(n("copy")),i}var kC,MC,IC,PC=function(){function t(e){Ee(this,t),this.layer=e}return Te(t,[{key:"pickRender",value:function(t){var e=this.layer.getContainer().get(Hh.ILayerService),n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(t);n.hooks.beforePickingEncode.call(),e.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}},{key:"pick",value:function(t,e){var n=this.layer.getContainer().get(Hh.IPickingService);return"RasterLayer"===t.type?this.pickRasterLayer(t,e):(this.pickRender(e),n.pickFromPickingFBO(t,e))}},{key:"pickRasterLayer",value:function(t,e,n){var r,i,o,a,s,u,l=this.layer.getContainer(),c=l.get(Hh.IPickingService),h=l.get(Hh.IMapService),p=this.layer.getSource().extent,f=(r=e.lngLat,i=$r(p,4),o=i[0],a=i[1],s=i[2],u=i[3],r.lng>o&&r.lng<=s&&r.lat>a&&r.lat<=u),d={x:e.x,y:e.y,type:e.type,lngLat:e.lngLat,target:e,rasterValue:null},v=n||t;if(f){var m=this.readRasterValue(t,p,h,e.x,e.y);return d.rasterValue=m,c.triggerHoverOnLayer(v,d),!0}return d.type="mousemove"===e.type?"mouseout":"un"+e.type,c.triggerHoverOnLayer(v,It(It({},d),{},{type:"unpick"})),c.triggerHoverOnLayer(v,d),!1}},{key:"readRasterValue",value:function(t,e,n,r,i){var o=t.getSource().data.dataArray[0],a=$r(e,4),s=a[0],u=void 0===s?0:s,l=a[1],c=void 0===l?0:l,h=a[2],p=void 0===h?10:h,f=a[3],d=void 0===f?-10:f,v=n.lngLatToContainer([u,c]),m=n.lngLatToContainer([p,d]),y=m.x-v.x,g=v.y-m.y,_=[(r-v.x)/y,(i-m.y)/g],x=o.width||1,b=o.height||1,w=Math.floor(_[0]*x),S=Math.floor(_[1]*b),E=Math.max(0,S-1)*x+w;return o.data[E]}},{key:"selectFeature",value:function(t){var e=this.layer,n=$r(t,3),r=n[0],i=n[1],o=n[2];e.hooks.beforeSelect.call([r,i,o])}},{key:"highlightPickedFeature",value:function(t){var e=$r(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),t}(),LC=function(){function t(e){Ee(this,t),this.layer=e;var n=this.layer.getContainer();this.rendererService=n.get(Hh.IRendererService)}return Te(t,[{key:"getColorTexture",value:function(t,e){var n=this.getTextureKey(t,e);return this.key===n||(this.createColorTexture(t,e),this.key=n),this.colorTexture}},{key:"createColorTexture",value:function(t,e){var n=this.rendererService.createTexture2D,r=this.getColorRampBar(t,e),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1});return this.colorTexture=i,i}},{key:"setColorTexture",value:function(t,e,n){this.key=this.getTextureKey(e,n),this.colorTexture=t}},{key:"destroy",value:function(){var t;null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"getColorRampBar",value:function(t,e){switch(t.type){case"cat":return function(t){var e=tr.document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;var r=n.createImageData(256,1);return r.data.fill(0),t.positions.forEach((function(e,n){var i=Hr(t.colors[n]);r.data[4*e+0]=255*i[0],r.data[4*e+1]=255*i[1],r.data[4*e+2]=255*i[2],r.data[4*e+3]=255*i[3]})),e=null,n=null,r}(t);case"quantize":return function(t){var e=tr.document.createElement("canvas"),n=e.getContext("2d");n.globalAlpha=1,e.width=256,e.height=1;for(var r=256/t.colors.length,i=0;i<t.colors.length;i++)n.beginPath(),n.lineWidth=2,n.strokeStyle=t.colors[i],n.moveTo(i*r,0),n.lineTo((i+1)*r,0),n.stroke();var o=n.getImageData(0,0,256,1).data,a=Xr(n,o);return e=null,n=null,a}(t);case"custom":return function(t,e){var n=tr.document.createElement("canvas"),r=n.getContext("2d");r.globalAlpha=1,n.width=256,n.height=1;var i=e[1]-e[0];t.positions.length-t.colors.length!=1&&console.warn("positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值");for(var o=0;o<t.colors.length;o++)r.beginPath(),r.lineWidth=2,r.strokeStyle=t.colors[o],r.moveTo((t.positions[o]-e[0])/i*255,0),r.lineTo((t.positions[o+1]-e[0])/i*255,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=Xr(r,a);return n=null,r=null,s}(t,e);case"linear":return function(t,e){var n=tr.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=e[1]-e[0],a=0;a<t.colors.length;++a){var s=Math.max((t.positions[a]-e[0])/o,0);i.addColorStop(s,t.colors[a])}r.fillStyle=i,r.fillRect(0,0,256,1);var u=r.getImageData(0,0,256,1).data,l=Xr(r,u);return n=null,r=null,l}(t,e);default:return qr(t)}}},{key:"getTextureKey",value:function(t,e){var n;return"".concat(t.colors.join("_"),"_").concat(null==t||null===(n=t.positions)||void 0===n?void 0:n.join("_"),"_").concat(t.type,"_").concat(null==e?void 0:e.join("_"))}}]),t}(),RC=["passes"],OC=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"];function DC(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return NC(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return NC(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function NC(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function zC(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var FC,BC,UC,jC=0,VC=(kC=oy(Hh.IGlobalConfigService),MC=function(t){Oe(l,t);var e,n,r,i,o,a,s,u=zC(l);function l(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ee(this,l),kt(De(t=u.call(this)),"id","".concat(jC++)),kt(De(t),"name","".concat(jC)),kt(De(t),"visible",!0),kt(De(t),"zIndex",0),kt(De(t),"inited",!1),kt(De(t),"layerModelNeedUpdate",!1),kt(De(t),"pickedFeatureID",null),kt(De(t),"selectedFeatureID",null),kt(De(t),"styleNeedUpdate",!1),kt(De(t),"forceRender",!1),kt(De(t),"clusterZoom",0),kt(De(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),kt(De(t),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),kt(De(t),"hooks",{init:new Vd,afterInit:new Ud,beforeRender:new Ud,beforeRenderData:new Gd,afterRender:new Dd,beforePickingEncode:new Dd,afterPickingEncode:new Dd,beforeHighlight:new Dd(["pickedColor"]),afterHighlight:new Dd,beforeSelect:new Dd(["pickedColor"]),afterSelect:new Dd,beforeDestroy:new Dd,afterDestroy:new Dd}),kt(De(t),"models",[]),kt(De(t),"startInit",!1),kt(De(t),"layerChildren",[]),kt(De(t),"masks",[]),Rp(De(t),"configService",IC,De(t)),kt(De(t),"animateOptions",{enable:!1}),kt(De(t),"currentPickId",null),kt(De(t),"encodeStyleAttribute",{}),kt(De(t),"enableEncodeStyles",[]),kt(De(t),"pendingStyleAttributes",[]),kt(De(t),"scaleOptions",{}),kt(De(t),"animateStatus",!1),kt(De(t),"isDestroyed",!1),kt(De(t),"encodeDataLength",0),kt(De(t),"sourceEvent",(function(){t.dataState.dataSourceNeedUpdate=!0;var e=t.getLayerConfig();e&&e.autoFit&&t.fitBounds(e.fitBoundsOptions),t.layerSource.getSourceCfg().autoRender&&t.reRender()})),t.name=e.name||t.id,t.zIndex=e.zIndex||0,t.rawConfig=e,t}return Te(l,[{key:"addMask",value:function(t){this.masks.push(t),this.enableMask()}},{key:"removeMask",value:function(t){var e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var e=this;if(Object.keys(t).map((function(n){n in e.rawConfig&&(e.rawConfig[n]=t[n])})),this.startInit){var n=this.container.get(Hh.SceneID);this.configService.setLayerConfig(n,this.id,It(It(It({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}else this.needUpdateConfig=It(It({},this.needUpdateConfig),t)}},{key:"setContainer",value:function(t,e){this.container=t,this.sceneContainer=e}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:(s=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.container.get(Hh.SceneID),this.startInit=!0,this.configService.setLayerConfig(e,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Hh.IIconService),this.fontService=this.container.get(Hh.IFontService),this.rendererService=this.container.get(Hh.IRendererService),this.layerService=this.container.get(Hh.ILayerService),this.debugService=this.container.get(Hh.IDebugService),this.interactionService=this.container.get(Hh.IInteractionService),this.pickingService=this.container.get(Hh.IPickingService),this.mapService=this.container.get(Hh.IMapService),n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes,r&&null!=i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){s.renderLayers()})),this.cameraService=this.container.get(Hh.ICameraService),this.coordinateService=this.container.get(Hh.ICoordinateSystemService),this.shaderModuleService=this.container.get(Hh.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Hh.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Hh.IFactoryNormalPass),this.styleAttributeService=this.container.get(Hh.IStyleAttributeService),r&&(this.multiPassRenderer=this.container.get(Hh.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach((function(t){var e=t.attributeName,n=t.attributeField,r=t.attributeValues,i=t.updateOptions;s.styleAttributeService.updateStyleAttribute(e,{scale:It({field:n},s.splitValuesAndCallbackInAttribute(r,s.getLayerConfig()[e]))},i)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Hh.ILayerPlugin),o=DC(this.plugins);try{for(o.s();!(a=o.n()).done;)a.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(t){o.e(t)}finally{o.f()}return this.layerPickService=new PC(this),this.textureService=new LC(this),this.log(_y),t.next=31,this.hooks.init.promise();case 31:this.log(xy),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"log",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if(!this.tileLayer&&!this.isTileLayer){var r="".concat(this.id,".").concat(n,".").concat(t),i={id:this.id,type:this.type};null===(e=this.debugService)||void 0===e||e.log(r,i)}}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map((function(e){e.updateAttributesAndElements(t.attributes,t.elements)})):console.warn("data error")}},{key:"createModelData",value:function(t,e){var n;if(null!==(n=this.layerModel)&&void 0!==n&&n.createModelData)return this.layerModel.createModelData(e);var r=this.calculateEncodeData(t,e),i=this.triangulation;return r&&i?this.styleAttributeService.createAttributesAndIndices(r,i):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(t){this.layerPickService=t}},{key:"calculateEncodeData",value:function(t,e){return this.inited?function(t,e,n,r,i,o){var a=new $y(i,o),s=AC(r.getLayerStyleAttributes()||[],a.data.dataArray,e,n,t);return a.destroy(),s}(this,this.fontService,this.mapService,this.styleAttributeService,t,e):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});var t=this.getLayerConfig().animateOption;null!=t&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,e,n){return this.updateStyleAttribute("color",t,e,n),this}},{key:"texture",value:function(t,e,n){return this.updateStyleAttribute("texture",t,e,n),this}},{key:"rotate",value:function(t,e,n){return this.updateStyleAttribute("rotate",t,e,n),this}},{key:"size",value:function(t,e,n){return this.updateStyleAttribute("size",t,e,n),this}},{key:"filter",value:function(t,e,n){var r=this.updateStyleAttribute("filter",t,e,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"shape",value:function(t,e,n){this.shapeOption={field:t,values:e};var r=this.updateStyleAttribute("shape",t,e,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"label",value:function(t,e,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:e,updateOptions:n}),this}},{key:"animate",value:function(t){var e={};return ti.exports.isObject(t)?(e.enable=!0,e=It(It({},e),t)):e.enable=t,this.updateLayerConfig({animateOption:e}),this}},{key:"source",value:function(t,e){return"source"===(null==t?void 0:t.type)?(this.setSource(t),this):(this.sourceOption={data:t,options:e},this.clusterZoom=0,this)}},{key:"setData",value:function(t,e){var n=this;return this.inited?(this.log(by,Sp.UPDATE),this.layerSource.setData(t,e),this.log(wy,Sp.UPDATE)):this.on("inited",(function(){n.log(by,Sp.UPDATE),n.getSource()?n.layerSource.setData(t,e):n.source(new $y(t,e)),n.layerSource.once("update",(function(){n.log(wy,Sp.UPDATE)}))})),this}},{key:"style",value:function(t){var e=this,n=t.passes,r=Wf(t,RC);n&&TC(n).forEach((function(t){var n=e.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(t[0]);n&&n.updateOptions(t[1])}));var i=r;return Object.keys(r).forEach((function(t){var e=r[t];!Array.isArray(e)||2!==e.length||ti.exports.isNumber(e[0])||ti.exports.isNumber(e[1])||(i[t]={field:e[0],value:e[1]})})),this.encodeStyle(i),this.updateLayerConfig(i),this}},{key:"encodeStyle",value:function(t){var e=this;Object.keys(t).forEach((function(n){e.enableEncodeStyles.includes(n)&&ti.exports.isPlainObject(t[n])&&(t[n].field||t[n].value)&&!ti.exports.isEqual(e.encodeStyleAttribute[n],t[n])?(e.encodeStyleAttribute[n]=t[n],e.updateStyleAttribute(n,t[n].field,t[n].value),e.styleNeedUpdate=!0):e.encodeStyleAttribute[n]&&delete e.encodeStyleAttribute[n]}))}},{key:"scale",value:function(t,e){var n=It({},this.scaleOptions);if(ti.exports.isObject(t)?this.scaleOptions=It(It({},this.scaleOptions),t):this.scaleOptions[t]=e,this.styleAttributeService&&!ti.exports.isEqual(n,this.scaleOptions)){var r=ti.exports.isObject(t)?t:kt({},t,e);this.styleAttributeService.updateScaleAttribute(r)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(t),this)}},{key:"renderMultiPass",value:(a=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){t.next=2;break}return t.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){t.next=7;break}return t.next=5,this.multiPassRenderer.render();case 5:t.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"active",value:function(t){var e={};return e.enableHighlight=!!ti.exports.isObject(t)||t,ti.exports.isObject(t)?(e.enableHighlight=!0,t.color&&(e.highlightColor=t.color),t.mix&&(e.activeMix=t.mix)):e.enableHighlight=!!t,this.updateLayerConfig(e),this}},{key:"setActive",value:function(t,e){var n=this;if(ti.exports.isObject(t)){var r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:ti.exports.isObject(e)?e.color:this.getLayerConfig().highlightColor,activeMix:ti.exports.isObject(e)?e.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:ti.exports.isObject(e)?e.color:this.getLayerConfig().highlightColor,activeMix:ti.exports.isObject(e)?e.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Zr(t)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(t){var e={};return e.enableSelect=!!ti.exports.isObject(t)||t,ti.exports.isObject(t)?(e.enableSelect=!0,t.color&&(e.selectColor=t.color),t.mix&&(e.selectMix=t.mix)):e.enableSelect=!!t,this.updateLayerConfig(e),this}},{key:"setSelect",value:function(t,e){var n=this;if(ti.exports.isObject(t)){var r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:ti.exports.isObject(e)?e.color:this.getLayerConfig().selectColor,selectMix:ti.exports.isObject(e)?e.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:ti.exports.isObject(e)?e.color:this.getLayerConfig().selectColor,selectMix:ti.exports.isObject(e)?e.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Zr(t)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),e=this.getLayerConfig(),n=e.visible,r=e.minZoom,i=void 0===r?-1/0:r,o=e.maxZoom;return!!n&&t>=i&&t<(void 0===o?1/0:o)}},{key:"setMultiPass",value:function(t,e){if(this.updateLayerConfig({enableMultiPassRenderer:t}),e&&this.updateLayerConfig({passes:e}),t){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=CC(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),o=i.width,a=i.height;this.multiPassRenderer.resize(o,a)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(t){return this.getLayerConfig()[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var e=this.getSource().extent;return e.some((function(t){return Math.abs(t)===1/0}))||this.mapService.fitBounds([[e[0],e[1]],[e[2],e[3]]],t),this}},{key:"destroy",value:function(){var t,e,n,r,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isDestroyed||(this.layerChildren.map((function(t){return t.destroy(!1)})),this.layerChildren=[],this.getLayerConfig().maskfence&&(this.masks.map((function(t){return t.destroy(!1)})),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(t=this.multiPassRenderer)||void 0===t||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(e=this.layerModel)||void 0===e||e.clearModels(i),null===(n=this.tileLayer)||void 0===n||n.destroy(),this.models=[],null===(r=this.debugService)||void 0===r||r.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach((function(t){return t.destroy()})),null===(t=this.layerModel)||void 0===t||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices})).length}},{key:"setSource",value:function(t){var e=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(t){var n=t.type;if(void 0===e.coordCenter){var r,i=e.layerSource.center;e.coordCenter=i,null!==(r=e.mapService)&&void 0!==r&&r.setCoordCenter&&e.mapService.setCoordCenter(i)}if("update"===n){if(e.tileLayer)return void e.tileLayer.reload();e.sourceEvent()}}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var e,n,r,i=this.styleAttributeService.getLayerStyleAttribute(t);return{type:null===(n=((null==i||null===(e=i.scale)||void 0===e?void 0:e.scalers)||[])[0].option)||void 0===n?void 0:n.type,field:null==i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var e=this.styleAttributeService.getLayerAttributeScale(t);return e?e.invertExtent?e.range().map((function(n){return kt({value:e.invertExtent(n)},t,n)})):e.ticks?e.ticks().map((function(n){return kt({value:n},t,e(n))})):null!=e&&e.domain?e.domain().filter((function(t){return!ti.exports.isUndefined(t)})).map((function(n){return kt({value:n},t,e(n))})):[]:[]}},{key:"pick",value:function(t){var e=t.x,n=t.y;this.interactionService.triggerHover({x:e,y:n})}},{key:"boxSelect",value:function(t,e){this.pickingService.boxPickLayer(this,t,e)}},{key:"buildLayerModel",value:(o=Zt(Kt.mark((function t(e){var n,r,i,o,a,s,u,l,c,h,p,f,d=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.moduleName,r=e.vertexShader,i=e.fragmentShader,o=e.inject,a=e.triangulation,s=e.segmentNumber,u=Wf(e,OC),this.shaderModuleService.registerModule(n,{vs:r,fs:i,inject:o}),l=this.shaderModuleService.getModule(n),c=l.vs,h=l.fs,p=l.uniforms,f=this.rendererService.createModel,t.abrupt("return",new Promise((function(t){var e=d.styleAttributeService.createAttributesAndIndices(d.encodedData,a,s),n=e.attributes,r=e.elements,i=e.count,o=It({attributes:n,uniforms:p,fs:h,vs:c,elements:r,blend:Ig[xp.normal]},u);i&&(o.count=i),t(f(o))})));case 5:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"createAttributes",value:function(t){var e=t.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,e).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var e=this.getLayerConfig(),n=e.enableHighlight,r=void 0===n||n,i=e.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(t)||-1!==this.eventNames().indexOf("un"+t);return"click"!==t&&"dblclick"!==t||!o||(a=!0),"mousemove"!==t||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:(i=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return t.stop()}}),t)}))),function(){return i.apply(this,arguments)})},{key:"rebuildModels",value:(r=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.buildModels();case 2:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"renderMulPass",value:(n=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.render();case 2:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})},{key:"renderModels",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach((function(n){n.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(e)},(null==e?void 0:e.ispick)||!1)})),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(t,e,n,r){var i=this.configService.getAttributeConfig(this.id)||{};return!ti.exports.isEqual(i[t],{field:e,values:n})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(t)&&this.configService.setAttributeConfig(this.id,kt({},t,{field:e,values:n})),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:It({field:e},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[e]))},r):this.pendingStyleAttributes.push({attributeName:t,attributeField:e,attributeValues:n,updateOptions:r}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"processData",value:function(t){return t}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:(e=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.models.forEach((function(t){return t.destroy()})),this.models=[],t.next=4,this.layerModel.initModels();case 4:this.models=t.sent;case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t,e){return{values:ti.exports.isFunction(t)?void 0:t||e,callback:ti.exports.isFunction(t)?t:void 0}}}]),l}(Oi.exports.EventEmitter),IC=Op(MC.prototype,"configService",[kC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MC);function GC(t){return t.maskOperation===wp.OR?{enable:!0,mask:255,func:{cmp:pf.ALWAYS,ref:1,mask:255},opFront:{fail:pf.KEEP,zfail:pf.REPLACE,zpass:pf.REPLACE}}:{enable:!0,mask:255,func:{cmp:t.stencilType===bp.SINGLE||0===t.stencilIndex?pf.ALWAYS:pf.LESS,ref:t.stencilType===bp.SINGLE?1:0===t.stencilIndex?2:1,mask:255},opFront:{fail:pf.KEEP,zfail:pf.REPLACE,zpass:pf.REPLACE}}}var HC=(FC=oy(Hh.IGlobalConfigService),BC=function(){function t(e){Ee(this,t),kt(this,"preStyleAttribute",{}),kt(this,"encodeStyleAttribute",{}),Rp(this,"configService",UC,this),this.layer=e,this.rendererService=e.getContainer().get(Hh.IRendererService),this.pickingService=e.getContainer().get(Hh.IPickingService),this.shaderModuleService=e.getContainer().get(Hh.IShaderModuleService),this.styleAttributeService=e.getContainer().get(Hh.IStyleAttributeService),this.mapService=e.getContainer().get(Hh.IMapService),this.iconService=e.getContainer().get(Hh.IIconService),this.fontService=e.getContainer().get(Hh.IFontService),this.cameraService=e.getContainer().get(Hh.ICameraService),this.layerService=e.getContainer().get(Hh.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n}var e,n,r;return Te(t,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig().blend;return Ig[xp[void 0===t?"normal":t]]}},{key:"getStencil",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i,a=e.enableMask,s=e.maskOperation,u=void 0===s?wp.AND:s;return"MaskLayer"===this.layer.type?GC({isStencil:!0,stencilType:bp.SINGLE}):t.isStencil?GC(It(It({},t),{},{maskOperation:u})):function(t,e){return{enable:t,mask:255,func:{cmp:pf.EQUAL,ref:e?1:0,mask:1}}}(r||a&&0!==this.layer.masks.length||void 0!==this.layer.tileMask,o)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:(r=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",!1);case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"initModels",value:(e=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return t.stop()}}),t)}))),function(){return e.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(t){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var t=this.layer.encodeStyleAttribute,e="",n={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2"};this.layer.enableEncodeStyles.forEach((function(r){t[r]&&(e+="#define USE_ATTRIBUTE_".concat(r.toUpperCase()," 0.0; \n\n")),e+="\n      #ifdef USE_ATTRIBUTE_".concat(r.toUpperCase(),"\n  attribute ").concat(n[r]," a_").concat(r.charAt(0).toUpperCase()+r.slice(1),";\n#else\n  uniform ").concat(n[r]," u_").concat(r,";\n#endif\n\n")}));var r="";return this.layer.enableEncodeStyles.forEach((function(t){r+="\n\n#ifdef USE_ATTRIBUTE_".concat(t.toUpperCase(),"\n  ").concat(n[t]," ").concat(t,"  = a_").concat(t.charAt(0).toUpperCase()+t.slice(1),";\n#else\n  ").concat(n[t]," ").concat(t," = u_").concat(t,";\n#endif\n\n")})),{"vs:#decl":e,"vs:#main-start":r}}},{key:"getStyleAttribute",value:function(){var t=this,e={},n={opacity:1,stroke:[1,0,0,1],offsets:[0,0]};return this.layer.enableEncodeStyles.forEach((function(r){if(!t.layer.encodeStyleAttribute[r]){var i=t.layer.getLayerConfig()[r]||n[r];"stroke"===r&&(i=Hr(i)),e["u_"+r]=i}})),e}},{key:"registerStyleAttribute",value:function(){var t=this;Object.keys(this.layer.encodeStyleAttribute).forEach((function(e){var n=function(t){switch(t){case"stroke":return{name:"stroke",type:cy.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:4,update:function(t){var e=t.stroke;return void 0===e?[1,1,1,1]:e}}};case"opacity":return{name:"opacity",type:cy.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.opacity;return[void 0===e?1:e]}}};case"offsets":return{name:"offsets",type:cy.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t){return t.offsets}}};default:return}}(e);n&&t.styleAttributeService.registerStyleAttribute(n)}))}},{key:"updateEncodeAttribute",value:function(t,e){this.encodeStyleAttribute[t]=e}}]),t}(),UC=Op(BC.prototype,"configService",[FC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BC),WC=function(t){return t.VERTICAL="vertical",t.HORIZONTAL="horizontal",t}({}),ZC=function(t){return t.NORMAL="normal",t.REPLACE="replace",t}({}),qC=function(t){return t[t.pixel=0]="pixel",t[t.meter=1]="meter",t}({}),XC=100;function YC(t){return t/180*Math.acos(-1)}function KC(t){var e=YC(t[0])+Math.PI/2,n=YC(t[1]),r=XC+.4*Math.random(),i=r*Math.cos(n)*Math.cos(e);return[r*Math.cos(n)*Math.sin(e),r*Math.sin(n),i]}var QC=ns();ns();var JC=ns(),$C=ns(),tk=ns();function ek(t,e,n,r,i){return as(t,n,r),us(t,t),[i/ls(e=rs(-t[1],t[0]),rs(-n[1],n[0])),e]}function nk(t,e){return os(t,-e[1],e[0])}function rk(t,e,n){return cs(t,e,n),us(t,t),t}function ik(t,e){return t[0]===e[0]&&t[1]===e[1]}var ok,ak=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ee(this,t),kt(this,"lastFlip",-1),kt(this,"miter",rs(0,0)),kt(this,"started",!1),kt(this,"dash",!1),kt(this,"totalDistance",0),kt(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Te(t,[{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.simpleSegment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=t[o-1];l.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var c=e[o-1],h=t[o];h.push(null!==(s=e[o][2])&&void 0!==s?s:0);var p=e[o],f=o<t.length-1?[].concat(At(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null;i+=this.simpleSegment(n,i,l,h,f,c,p,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=t[o-1];l.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var c=e[o-1],h=t[o];h.push(null!==(s=e[o][2])&&void 0!==s?s:0);var p=e[o],f=o<t.length-1?[].concat(At(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null;i+=this.segment_gaode2(n,i,l,h,f,c,p,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.segment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleSegment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,l=bi([r[0],r[1]]),c=bi([n[0],n[1]]);rk(JC,l,c);var h=0;if(this.dash&&(h=this.lineSegmentDistance(l,c),this.totalDistance+=h),this.normal||(this.normal=ns(),nk(this.normal,JC)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(e+0,e+1,e+2),i){var p=bi([i[0],i[1]]);ik(l,p)&&as(p,l,us(p,ss(p,l,c))),rk($C,p,l);var f=$r(ek(tk,ns(),JC,$C,this.thickness),2),d=f[0],v=f[1];ls(tk,this.normal);this.extrusions(s,u,r,v,d,this.totalDistance),a.push.apply(a,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,is(this.normal,v),o+=2,this.lastFlip=-1}else nk(this.normal,JC),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2;return o}},{key:"segment_gaode2",value:function(t,e,n,r,i,o,a,s){var u=0,l=t.indices,c=t.positions,h=t.normals,p="square"===this.cap,f="bevel"===this.join,d=bi([a[0],a[1]]),v=bi([o[0],o[1]]);rk(JC,r,n);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,v),this.totalDistance+=m),this.normal||(this.normal=ns(),nk(this.normal,JC)),!this.started)if(this.started=!0,p){var y=ns(),g=ns();as(y,this.normal,JC),as(g,this.normal,JC),h.push(g[0],g[1],0),h.push(y[0],y[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-m);if(l.push(e+0,e+1,e+2),i){ik(r,i)&&as(i,r,us(i,ss(i,r,n))),rk($C,i,r);var _=$r(ek(tk,ns(),JC,$C,this.thickness),2),x=_[0],b=_[1],w=ls(tk,this.normal)<0?-1:1,S=f;if(!S&&"miter"===this.join)x>this.miterLimit&&(S=!0);S?(h.push(this.normal[0],this.normal[1],0),h.push(b[0],b[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,At(this.lastFlip!==-w?[e,e+2,e+3]:[e+2,e+1,e+3])),l.push(e+2,e+3,e+4),nk(QC,$C),is(this.normal,QC),h.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,h,r,b,x,this.totalDistance),l.push.apply(l,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),w=-1,is(this.normal,b),u+=2),this.lastFlip=w}else{if(nk(this.normal,JC),p){var E=ns(),A=ns();cs(A,JC,this.normal),as(E,JC,this.normal),h.push(A[0],A[1],0),h.push(E[0],E[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),u+=2}return u}},{key:"segment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,l="square"===this.cap,c="bevel"===this.join,h=bi([r[0],r[1]]),p=bi([n[0],n[1]]);rk(JC,h,p);var f=0;if(this.dash&&(f=this.lineSegmentDistance(h,p),this.totalDistance+=f),this.normal||(this.normal=ns(),nk(this.normal,JC)),!this.started)if(this.started=!0,l){var d=ns(),v=ns();as(d,this.normal,JC),as(v,this.normal,JC),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-f,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-f,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-f);if(a.push(e+0,e+1,e+2),i){var m=bi([i[0],i[1]]);ik(h,m)&&as(m,h,us(m,ss(m,h,p))),rk($C,m,h);var y=$r(ek(tk,ns(),JC,$C,this.thickness),2),g=y[0],_=y[1],x=ls(tk,this.normal)<0?-1:1,b=c;if(!b&&"miter"===this.join)g>this.miterLimit&&(b=!0);b?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,At(this.lastFlip!==-x?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),nk(QC,$C),is(this.normal,QC),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*x,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,_,g,this.totalDistance),a.push.apply(a,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),x=-1,is(this.normal,_),o+=2),this.lastFlip=x}else{if(nk(this.normal,JC),l){var w=ns(),S=ns();cs(S,JC,this.normal),as(w,JC,this.normal),u.push(S[0],S[1],0),u.push(w[0],w[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,At(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2}return o}},{key:"extrusions",value:function(t,e,n,r,i,o){e.push(r[0],r[1],0),e.push(r[0],r[1],0),t.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}}]),t}();function sk(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t[0][0],r=t[0][t[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var i=t[0].length,o=ta.flatten(t),a=o.vertices,s=o.dimensions,u=[],l=[],c=[],h=0;h<a.length/s;h++)u.push(a[h*s],a[h*s+1],1,-1,-1),c.push(0,0,1);var p=ta(o.vertices,o.holes,o.dimensions);l.push.apply(l,At(p));for(var f=function(){var t=o.vertices.slice(d*s,(d+1)*s),n=o.vertices.slice((d+1)*s,(d+2)*s);0===n.length&&(n=o.vertices.slice(0,s));var r=u.length/5;u.push(t[0],t[1],1,0,0,n[0],n[1],1,.1,0,t[0],t[1],0,0,.8,n[0],n[1],0,.1,.8);var i=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=ka(),o=ka(),a=ka();r&&(t=xi(t),e=xi(e),n=xi(n));var s=Ia.apply(Ja,At(t)),u=Ia.apply(Ja,At(e)),l=Ia.apply(Ja,At(n));Ha(i,l,u),Ha(o,s,u),Ua(a,i,o);var c=ka();return Fa(c,a),c}([n[0],n[1],1],[t[0],t[1],0],[t[0],t[1],1],e);c.push.apply(c,At(i).concat(At(i),At(i),At(i))),l.push.apply(l,At([1,2,0,3,2,1].map((function(t){return t+r}))))},d=0;d<i;d++)f();return{positions:u,index:l,normals:c}}var uk=function(t){return t.CYLINDER="cylinder",t.SQUARECOLUMN="squareColumn",t.TRIANGLECOLUMN="triangleColumn",t.HEXAGONCOLUMN="hexagonColumn",t.PENTAGONCOLUMN="pentagonColumn",t}({}),lk=function(t){return t.CIRCLE="circle",t.SQUARE="square",t.TRIANGLE="triangle",t.HEXAGON="hexagon",t.PENTAGON="pentagon",t}({});function ck(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/t,r=[],i=0;i<t;i++)r.push(n*i+e*Math.PI/12);return r.map((function(t){return[Math.sin(t+Math.PI/4),Math.cos(t+Math.PI/4),0]}))}function hk(){return ck(30)}function pk(){return ck(4)}function fk(){return ck(3)}function dk(){return ck(6,1)}function vk(){return ck(5)}var mk=(kt(ok={},lk.CIRCLE,hk),kt(ok,lk.HEXAGON,dk),kt(ok,lk.TRIANGLE,fk),kt(ok,lk.SQUARE,pk),kt(ok,lk.PENTAGON,vk),kt(ok,uk.CYLINDER,hk),kt(ok,uk.HEXAGONCOLUMN,dk),kt(ok,uk.TRIANGLECOLUMN,fk),kt(ok,uk.SQUARECOLUMN,pk),kt(ok,uk.PENTAGONCOLUMN,vk),ok),yk={};function gk(t){var e=ki(t.coordinates);return{vertices:[].concat(At(e),At(e),At(e),At(e)),indices:[0,1,2,2,3,0],size:e.length}}function _k(t){var e=KC(ki(t.coordinates));return{vertices:[].concat(At(e),At(e),At(e),At(e)),indices:[0,1,2,2,3,0],size:e.length}}function xk(t){var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(yk&&yk[t])return yk[t];var n=mk[t]?mk[t]():mk.cylinder(),r=sk([n],e);return yk[t]=r,r}(t.shape,!1);return{vertices:e.positions,indices:e.index,normals:e.normals,size:5}}function bk(t){var e=ki(t.coordinates);return{vertices:At(e),indices:[0],size:e.length}}function wk(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new ak({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=e;c[0]&&!Array.isArray(c[0][0])&&(c=[e]),c.forEach((function(t){i.extrude(t)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function Sk(t){var e=t.coordinates.flat();return{vertices:[1,0,0].concat(At(e),[1,2,-3],At(e),[1,1,-3],At(e),[0,1,0],At(e),[0,0,0],At(e),[1,0,0],At(e),[1,2,-3],At(e),[1,1,-3],At(e),[0,1,0],At(e),[0,0,0],At(e)),normals:[-1,2,1,2,-1,1,1,-1,1,1,-1,1,-1,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function Ek(t){var e=t.coordinates,n=[];if(!Array.isArray(e[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=function(t){var e=t;Array.isArray(e)&&Array.isArray(e[0])&&Array.isArray(e[0][0])&&(e=t.flat());var n=0;if(e.length<2)return{results:e,totalDistance:0};var r=[],i=Tk(e[0],n);r.push(i);for(var o=1;o<e.length-1;o++){n+=Ak(e[o-1],e[o]);var a=Tk(e[o],n);r.push(a),r.push(a)}return n+=Ak(e[e.length-2],e[e.length-1]),r.push(Tk(e[e.length-1],n)),{results:r,totalDistance:n}}(e),i=r.results,o=r.totalDistance;return i.map((function(t){n.push(t[0],t[1],t[2],t[3],0,o)})),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function Ak(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}function Tk(t,e){return t.length<3&&t.push(0),void 0!==e&&t.push(e),t}function Ck(t){var e=t.coordinates,n=ta.flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:ta(r,o,i),vertices:r,size:i}}function kk(t){var e=t.coordinates,n=ta.flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:ta(r,o,i),vertices:Mk(r),size:i+4}}function Mk(t){for(var e=[],n=function(t){for(var e=t[0],n=t[1],r=t[0],i=t[1],o=0,a=0,s=0,u=0;u<t.length;u+=2){var l=t[u],c=t[u+1];l&&c&&(e=Math.max(l,e),n=Math.max(c,n),r=Math.min(l,r),i=Math.min(c,i),o+=l,a+=c,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(e-r,2)+Math.pow(n-i,2))/2}}(t),r=n.center,i=n.radius,o=0;o<t.length;o+=2){var a=t[o],s=t[o+1];e.push.apply(e,[a,s,0].concat(At(r),[i]))}return e}function Ik(t){var e=sk(t.coordinates,!0);return{vertices:e.positions,indices:e.index,normals:e.normals,size:5}}function Pk(t){var e=function(t){var e=["cylinder","triangleColumn","hexagonColumn","squareColumn"],n=mk[t]?mk[t]():mk.circle(),r=-1===e.indexOf(t)?(i=[n],o=ta.flatten(i),a=ta(o.vertices,o.holes,o.dimensions),{positions:o.vertices,index:a}):function(t){var e=t[0][0],n=t[0][t[0].length-1];e[0]===n[0]&&e[1]===n[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var r=t[0].length,i=ta.flatten(t),o=i.vertices,a=i.dimensions,s=[],u=[],l=0;l<o.length/a;l++)2===a?s.push(o[2*l],o[2*l+1],1):s.push(o[3*l],o[3*l+1],1);var c=ta(i.vertices,i.holes,i.dimensions);u.push.apply(u,At(c));for(var h=function(){var t=i.vertices.slice(p*a,(p+1)*a),e=i.vertices.slice((p+1)*a,(p+2)*a);0===e.length&&(e=i.vertices.slice(0,a));var n=s.length/3;s.push(t[0],t[1],1,e[0],e[1],1,t[0],t[1],0,e[0],e[1],0),u.push.apply(u,At([0,2,1,2,3,1].map((function(t){return t+n}))))},p=0;p<r;p++)h();return{positions:s,index:u}}([n]);var i,o,a;return r}(t.shape);return{vertices:e.positions,indices:e.index,size:3}}function Lk(t){var e=t.coordinates;return{vertices:[].concat(At(e[0]),[0,0,1,e[1][0],e[0][1],0,1,1],At(e[1]),[0,1,0],At(e[0]),[0,0,1],At(e[1]),[0,1,0,e[0][0],e[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function Rk(t,e){for(var n=e||30,r=t.coordinates,i=[],o=[],a=function(t){i.push(t,1,t,r[0][0],r[0][1],r[1][0],r[1][1],t,-1,t,r[0][0],r[0][1],r[1][0],r[1][1]),t!==n-1&&o.push.apply(o,At([0,1,2,1,3,2].map((function(e){return 2*t+e}))))},s=0;s<n;s++)a(s);return{vertices:i,indices:o,size:7}}function Ok(t){var e=t.coordinates;2===e.length&&e.push(0);var n=Dk(-1,1),r=Dk(1,1),i=Dk(-1,-1),o=Dk(1,-1);return{vertices:[].concat(At(e),At(n),At(e),At(i),At(e),At(o),At(e),At(r)),indices:[0,1,2,3,0,2],size:5}}function Dk(t,e){return[(t+1)/2,(e+1)/2]}function Nk(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var zk=function(t){Oe(i,t);var e,n,r=Nk(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||.9,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'precision highp float;\r\n// 多边形顶点坐标\r\nattribute vec3 a_Position;\r\n// 多边形经纬度坐标\r\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\n\r\nuniform vec2 u_sceneCenterMercator;\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Pk,primitive:pf.TRIANGLES,depth:{enable:!1}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:cy.Attribute,descriptor:{name:"a_Pos",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),i}(HC);function Fk(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Bk,Uk=function(t){Oe(i,t);var e,n,r=Fk(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||1,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\n\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n \n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 经纬度\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:xk,primitive:pf.TRIANGLES,depth:{enable:!0}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:cy.Attribute,descriptor:{name:"a_Normal",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:cy.Attribute,descriptor:{name:"a_Pos",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),i}(HC);function jk(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Vk=ku.injectable()(Bk=function(t){Oe(o,t);var e,n,r,i=jk(o);function o(){return Ee(this,o),i.apply(this,arguments)}return Te(o,[{key:"render",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.useFramebuffer,o=this.layer.getLayerConfig().rampColors;i(this.heatmapFramerBuffer,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.heatmapFramerBuffer}),e.drawIntensityMode()})),ti.exports.isEqual(this.preRampColors,o)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode(t):this.draw3DHeatMap(t)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(r=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u,l,c;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.rendererService,r=n.createFramebuffer,i=n.getViewportSize,o=n.createTexture2D,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=(null==a||null===(e=a.scale)||void 0===e?void 0:e.field)||"heatmap",this.shapeType=s,t.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=t.sent,this.colorModel="heatmap"===s?this.buildHeatmapColor():this.build3dHeatMap(),u=i(),l=u.width,c=u.height,this.heatmapFramerBuffer=r({color:o({width:Math.floor(l/4),height:Math.floor(c/4),wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE,min:pf.LINEAR,mag:pf.LINEAR}),depth:!1}),this.updateColorTexture(),t.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:cy.Attribute,descriptor:{name:"a_Dir",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size;return[void 0===e?1:e]}}})}},{key:"buildHeatMapIntensity",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.triangulation=Ok,t.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n\nvoid main(){\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    gl_FragColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:Ok,depth:{enable:!1},cull:{enable:!0,face:Jr(this.mapService.version)}});case 3:return e=t.sent,t.abrupt("return",e);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n",fs:"uniform sampler2D u_texture;        // 热力强度图\nuniform sampler2D u_colorTexture;   // 根据强度分布的色带\nuniform float u_opacity;\nvarying vec2 v_texCoord;\n\nuniform vec2 u_ViewportSize;\n\nfloat getBlurIndusty() {\n    float vW = 2.0/u_ViewportSize.x;\n    float vH = 2.0/u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture2D(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\n\n    gl_FragColor =color;\n    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n\n}\n"});var t=this.shaderModuleService.getModule("heatmapColor"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService,o=i.createAttribute,a=i.createElements,s=i.createBuffer;return(0,i.createModel)({vs:e,fs:n,attributes:{a_Position:o({buffer:s({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:pf.FLOAT}),size:3}),a_Uv:o({buffer:s({data:[0,1,1,1,0,0,1,0],type:pf.FLOAT}),size:2})},uniforms:It({},r),depth:{enable:!1},elements:a({data:[0,2,1,2,3,1],type:pf.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.intensity,i=void 0===r?10:r,o=e.radius,a=void 0===o?5:o;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(t=this.intensityModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_radius:a,u_intensity:i},blend:{enable:!0,func:{srcRGB:pf.ONE,srcAlpha:1,dstRGB:pf.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(t){var e,n=this.layer.getLayerConfig().opacity;null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:n||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(t)})}},{key:"draw3DHeatMap",value:function(t){var e,n=this.layer.getLayerConfig().opacity,r=ia();ua(r,this.cameraService.getViewProjectionMatrixUncentered()),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:n||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:At(r)},blend:{enable:!0,func:{srcRGB:pf.SRC_ALPHA,srcAlpha:1,dstRGB:pf.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}},{key:"build3dHeatMap",value:function(){var t=(0,this.rendererService.getViewportSize)(),e=function(t,e){for(var n=[],r=[],i=[],o=t+1,a=e+1,s=t/2,u=e/2,l=0;l<a;l++)for(var c=l-u,h=0;h<o;h++){var p=h-s;r.push(p/s,-c/u,0),i.push(h/t),i.push(1-l/e)}for(var f=0;f<e;f++)for(var d=0;d<t;d++){var v=d+o*f,m=d+o*(f+1),y=d+1+o*(f+1),g=d+1+o*f;n.push(v,m,g),n.push(m,y,g)}return{vertices:r,indices:n,uvs:i}}(t.width/4,t.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\n\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n\tvec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n\tvec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n\tvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n\tinverseP2 = inverseP2 / inverseP2.w;\n\n\tfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n\tvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture2D(u_texture, v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\n\nvoid main(){\n   \n     float intensity = texture2D(u_texture, v_texCoord).r;\n    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\n    gl_FragColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"});var n=this.shaderModuleService.getModule("heatmap3dColor"),r=n.vs,i=n.fs,o=n.uniforms,a=this.rendererService,s=a.createAttribute,u=a.createElements,l=a.createBuffer;return(0,a.createModel)({vs:r,fs:i,attributes:{a_Position:s({buffer:l({data:e.vertices,type:pf.FLOAT}),size:3}),a_Uv:s({buffer:l({data:e.uvs,type:pf.FLOAT}),size:2})},primitive:pf.TRIANGLES,uniforms:It({},o),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:pf.SRC_ALPHA,srcAlpha:1,dstRGB:pf.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:u({data:e.indices,type:pf.UNSIGNED_INT,count:e.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var e=this.layer.getLayerConfig().rampColors,n=qr(e);this.colorTexture=t({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE,min:pf.NEAREST,mag:pf.NEAREST,flipY:!1}),this.preRampColors=e}}]),o}(HC))||Bk;function Gk(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Hk=function(t){Oe(i,t);var e,n,r=Gk(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||.9,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Pk,depth:{enable:!1},primitive:pf.TRIANGLES});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:cy.Attribute,descriptor:{name:"a_Pos",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),i}(HC),Wk={heatmap:Vk,heatmap3d:Vk,grid:zk,grid3d:Uk,hexagon:Hk};function Zk(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var qk=function(t){Oe(r,t);var e,n=Zk(r);function r(){var t;Ee(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return kt(De(t=n.call.apply(n,[this].concat(i))),"type","HeatMapLayer"),t}return Te(r,[{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new Wk[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"renderModels",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"heatmap"===this.getModelType()?(this.layerModel&&this.layerModel.render(e),this):(this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach((function(n){return n.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(e)})})),this.hooks.afterRender.call()),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),r}(VC);function Xk(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Yk=function(t){Oe(i,t);var e,n,r=Xk(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.layer.getSource(),n=this.rendererService.createTexture2D,this.texture=n({height:0,width:0}),!Jn){t.next=11;break}r=this.layerService.sceneService.getSceneConfig().canvas,(i=r.createImage()).crossOrigin="anonymous",i.src=e.data.originData,i.onload=function(){s.texture=n({data:i,width:i.width,height:i.height}),s.layerService.reRender()},t.next=15;break;case 11:return t.next=13,e.data.images;case 13:o=t.sent,this.texture=n({data:o[0],width:o[0].width,height:o[0].height,mag:pf.LINEAR,min:pf.LINEAR});case 15:return t.next=17,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n  if(gl_FragColor.a < 0.01)\n    discard;\n}\n",triangulation:Lk,primitive:pf.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 17:return a=t.sent,t.abrupt("return",[a]);case 19:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_Uv",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),i}(HC),Kk={image:Yk};function Qk(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var Jk=function(t){Oe(r,t);var e,n=Qk(r);function r(){var t;Ee(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return kt(De(t=n.call.apply(n,[this].concat(i))),"type","ImageLayer"),t}return Te(r,[{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new Kk[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),r}(VC);function $k(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var tM={solid:0,dash:1},eM=function(t){Oe(i,t);var e,n,r=$k(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:pf.NEAREST,min:pf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,l=t.dashArray,c=void 0===l?[10,5]:l,h=t.forward,p=void 0===h||h,f=t.lineTexture,d=void 0!==f&&f,v=t.iconStep,m=void 0===v?100:v,y=t.segmentNumber,g=void 0===y?30:y,_=t.thetaOffset,x=void 0===_?.314:_;2===c.length&&c.push(0,0);var b=0,w=[0,0,0,0],S=[0,0,0,0];return r&&i&&(w=Hr(r),S=Hr(i),b=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:x,u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:g,u_line_type:tM[u||"solid"],u_dash_array:c,u_blur:.9,u_lineDir:p?1:-1,u_texture:this.texture,u_line_texture:d?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:b,u_sourceColor:w,u_targetColor:S}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return"dash"===t.lineType?{frag:'\nuniform float u_opacity;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying float v_distance_ratio;\n\nuniform float segmentNumber;\n\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n\n\n  float flag = 0.;\n  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    flag = 1.;\n  };\n  gl_FragColor.a *=flag;\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\n\n\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\n\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n  // dash: index / (segmentNumber - 1.);\n  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 s = source;\n  vec2 t = target;\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    s = unProjCustomCoord(source);\n    t = unProjCustomCoord(target);\n  }\n  float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n \n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  gl_PointSize = 5.0;\n  setPickingColor(a_PickingColor);\n}\n',type:"Dash"}:e&&n?{frag:'varying vec4 v_color;\n\n#pragma include "picking"\n\nvoid main() {\n// 当前顶点在弧线中所处的分段位置\n\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nvarying float v_segmentIndex;\n\nuniform float u_lineDir: 1.0;\nuniform float u_opacity: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n\n  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  v_color.a *= u_opacity;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_color;\n  \n  gl_FragColor.a *= u_opacity;\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = v_lineData.g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = v_lineData.a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= u_opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n    \n  } else {\n     gl_FragColor = filterColor(gl_FragColor);\n  }\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\nvarying vec2 v_distance_ratio;\n\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    // dash: index / (segmentNumber - 1.);\n    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  \n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n v_lineData.b = d_distance_ratio;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n v_lineData.r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n    v_lineData.g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n    v_lineData.a = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,t.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+s,vertexShader:a,fragmentShader:o,triangulation:Rk,depth:{enable:!1},segmentNumber:r});case 4:return u=t.sent,t.abrupt("return",[u]);case 6:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:cy.Attribute,descriptor:{name:"a_Instance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(HC);function nM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var rM={solid:0,dash:1},iM=function(t){Oe(i,t);var e,n,r=nM(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:pf.NEAREST,min:pf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor,r=t.textureBlend,i=void 0===r?"normal":r,o=t.lineType,a=void 0===o?"solid":o,s=t.dashArray,u=void 0===s?[10,5]:s,l=t.lineTexture,c=void 0!==l&&l,h=t.iconStep,p=void 0===h?100:h,f=t.segmentNumber,d=void 0===f?30:f,v=t.globalArcHeight,m=void 0===v?10:v;2===u.length&&u.push(0,0);var y=0,g=[0,0,0,0],_=[0,0,0,0];return e&&n&&(g=Hr(e),_=Hr(n),y=1),this.rendererService.getDirty()&&this.texture.bind(),It({u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:XC,u_global_height:m,u_textureBlend:"normal"===i?0:1,segmentNumber:d,u_line_type:rM[a]||0,u_dash_array:u,u_texture:this.texture,u_line_texture:c?1:0,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:y,u_sourceColor:g,u_targetColor:_},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:'\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // 运动速度\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_opacity;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,t.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:Rk,segmentNumber:r});case 4:return u=t.sent,t.abrupt("return",[u]);case 6:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:cy.Attribute,descriptor:{name:"a_Instance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(HC);function oM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var aM={solid:0,dash:1},sM=function(t){Oe(i,t);var e,n,r=oM(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:pf.NEAREST,min:pf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,l=t.dashArray,c=void 0===l?[10,5]:l,h=t.lineTexture,p=void 0!==h&&h,f=t.iconStep,d=void 0===f?100:f,v=t.segmentNumber,m=void 0===v?30:v,y=t.globalArcHeight,g=void 0===y?10:y;2===c.length&&c.push(0,0);var _=0,x=[0,0,0,0],b=[0,0,0,0];return r&&i&&(x=Hr(r),b=Hr(i),_=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:XC,u_global_height:g,u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:m,u_line_type:aM[u]||0,u_dash_array:c,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_,u_sourceColor:x,u_targetColor:b}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:'\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // 运动速度\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_opacity;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,t.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+s,vertexShader:a,fragmentShader:o,triangulation:Rk,depth:{enable:!0},segmentNumber:r});case 4:return u=t.sent,t.abrupt("return",[u]);case 6:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:cy.Attribute,descriptor:{name:"a_Instance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(HC);function uM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var lM=function(t){Oe(i,t);var e,n,r=uM(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.gapWidth,n=void 0===e?2:e,r=t.strokeWidth,i=void 0===r?1:r,o=t.stroke,a=void 0===o?"#000":o,s=t.strokeOpacity,u=void 0===s?1:s;return It({u_gap_width:n,u_stroke_width:i,u_stroke:Hr(a),u_stroke_opacity:u},this.getStyleAttribute())}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec4 a_Instance;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nuniform float u_gap_width: 1.0;\nuniform float u_stroke_width: 1.0;\nuniform float u_stroke_opacity: 1.0;\n\n\nvoid main() {\n\n// #ifdef USE_ATTRIBUTE_OPACITY\n//   float opacity  = a_Opacity;\n// #else\n//   float opacity = u_opacity;\n// #endif\n\n\n// #ifdef USE_ATTRIBUTE_OFFSETS\n//   vec2 offsets  = a_Offsets;\n// #else\n//   vec2 offsets = u_offsets;\n// #endif\n\n  // float opacity = u_opacity;\n// 透明度计算\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  vec2 flowlineDir = normalize(target - source);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\n\n\n  vec2 position = mix(source, target, a_Position.x);\n\n  float lengthCommon = length(target - source);    \n  vec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);\n  vec2 limitedOffsetDistances = clamp(   \n   offsetDistances,\n    -lengthCommon*.8, lengthCommon*.8\n  );\n\n  float startOffsetCommon = project_pixel(offsets[0]);\n  float endOffsetCommon = project_pixel(offsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    a_Position.x\n  );\n\n  vec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);\n\n  float gapCommon =  project_pixel(u_gap_width);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n\n\n  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));\n\n  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\n  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offsetCommon.xy, 0., 1.0);\n  } else {\n     gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#extension GL_OES_standard_derivatives : enable\n\nvarying vec4 v_color;\n\n\n// line texture\n\n#pragma include "picking"\n\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor = filterColor(gl_FragColor);\n}\n',inject:this.getInject(),triangulation:Sk,primitive:pf.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:cy.Attribute,descriptor:{name:"a_Instance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:cy.Attribute,descriptor:{name:"a_Normal",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}})}}]),i}(HC);function cM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var hM={solid:0,dash:1},pM=function(t){Oe(i,t);var e,n,r=cM(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:pf.NEAREST,min:pf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,l=t.dashArray,c=void 0===l?[10,5]:l,h=t.lineTexture,p=void 0!==h&&h,f=t.iconStep,d=void 0===f?100:f,v=t.segmentNumber,m=void 0===v?30:v;2===c.length&&c.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var y=0,g=[0,0,0,0],_=[0,0,0,0];return r&&i&&(g=Hr(r),_=Hr(i),y=1),{u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:m,u_line_type:hM[u]||0,u_dash_array:c,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:y,u_sourceColor:g,u_targetColor:_}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n    return index / (segmentNumber - 1.);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n    vec2 x = mix(source, target, ratio);\n    vec2 center = mix(source, target, 0.5);\n    float dSourceCenter = distance(source, center);\n    float dXCenter = distance(x, center);\n    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n     float vertex_height = paraboloid(source, target, segmentRatio);\n\n    return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n    );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  \n\n  v_color = a_Color;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*16.0; // total_Distance*16.0 调整默认的效果\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\nv_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序\n  if(LineTexture == u_line_texture) { // 开启贴图模式  \n    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;\n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\nv_line_data.b = floor(d_arcDistrance/d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\nv_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying vec4 v_line_data;\n\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0;\n  float d_segmentIndex = v_line_data.g;\n  \n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // 实线部分\n    } else {\n      // 虚线部分\n      discard;\n    };\n  }\n\n  // 设置弧线的动画模式\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = gl_FragColor.a/opacity;\n    }\n\n    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n    \n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',triangulation:Rk,depth:{enable:!1}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:cy.Attribute,descriptor:{name:"a_Instance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(HC);function fM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var dM='\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\n\n\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\n\nvarying vec4 v_texture_data;\n\nvec2 calculateArrow(vec2 offset) {\n  /*\n  * 在支持箭头的时候，第二、第三组顶点是额外插入用于构建顶点的\n  */\n  float arrowFlag = -1.0;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // 高德 2.0 的旋转角度不同\n    arrowFlag = 1.0;\n  }\n  float pi = arrowFlag * 3.1415926/2.;\n  if(a_Miter < 0.) {\n    // 根据线的两侧偏移不同、旋转的方向相反\n    pi = -pi;\n  }\n  highp float angle_sin = sin(pi);\n  highp float angle_cos = cos(pi);\n  // 计算垂直与线方向的旋转矩阵\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float arrowWidth = u_arrowWidth;\n  float arrowHeight = u_arrowHeight;\n\n  vec2 arrowOffset = vec2(0.0);\n  /*\n  * a_DistanceAndIndex.y 用于标记当前顶点属于哪一组（两个顶点一组，构成线的其实是矩形，最简需要四个顶点、两组顶点构成）\n  */\n  if(a_DistanceAndIndex.y == 0.0) {\n    // 箭头尖部\n    offset = vec2(0.0);\n  } else if(a_DistanceAndIndex.y == 1.0) {\n    // 箭头两侧\n    arrowOffset = rotation_matrix*(offset * arrowHeight);\n    offset += arrowOffset; // 沿线偏移\n    offset = offset * arrowWidth; // 垂直线向外偏移（是构建箭头两侧的顶点）\n  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\n    // 偏移其余的点位（将长度让位给箭头）\n    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\n    offset += arrowOffset;// 沿线偏移\n  }\n\n  return offset;\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  \n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  v_color = a_Color;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n  if(u_arrow > 0.0) {\n      //  计算箭头\n    offset = calculateArrow(offset);\n\n    if(a_DistanceAndIndex.y > 4.0) {\n      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n    }\n  }\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  \n  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\n  // 设置数据集的参数\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',vM={solid:0,dash:1},mM=function(t){Oe(i,t);var e,n,r=fM(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"textureEventFlag",!1),kt(De(t),"texture",t.createTexture2D({data:[0,0,0,0],mag:pf.NEAREST,min:pf.NEAREST,premultiplyAlpha:!1,width:1,height:1})),kt(De(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:pf.NEAREST,min:pf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,l=t.dashArray,c=void 0===l?[10,5,0,0]:l,h=t.lineTexture,p=void 0!==h&&h,f=t.iconStep,d=void 0===f?100:f,v=t.vertexHeightScale,m=void 0===v?20:v,y=t.borderWidth,g=void 0===y?0:y,_=t.borderColor,x=void 0===_?"#ccc":_,b=t.raisingHeight,w=void 0===b?0:b,S=t.heightfixed,E=void 0!==S&&S,A=t.linearDir,T=void 0===A?WC.VERTICAL:A,C=t.blur,k=void 0===C?[1,1,1]:C,M=t.arrow,I=void 0===M?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:M;2===c.length&&c.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var P=0,L=[0,0,0,0],R=[0,0,0,0];return r&&i&&(L=Hr(r),R=Hr(i),P=1),{u_opacity:n,u_textureBlend:a===ZC.NORMAL?0:1,u_line_type:vM[u],u_dash_array:c,u_blur:k,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:g,u_borderColor:Hr(x),u_linearDir:T===WC.VERTICAL?1:0,u_linearColor:P,u_sourceColor:L,u_targetColor:R,u_heightfixed:Number(E),u_vertexScale:m,u_raisingHeight:Number(w),u_arrow:Number(I.enable),u_arrowHeight:I.arrowHeight||3,u_arrowWidth:I.arrowWidth||2,u_tailWidth:void 0===I.tailWidth?1:I.tailWidth}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.depth,r=void 0!==n&&n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,this.layer.triangulation=xs,t.next=5,this.layer.buildLayerModel({moduleName:"line"+s,vertexShader:a,fragmentShader:o,triangulation:xs,depth:{enable:r}});case 5:return u=t.sent,t.abrupt("return",[u]);case 7:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return"dash"===t.lineType?{frag:'#define LineTypeSolid 0.0\nvarying vec4 v_color;\n\n// dash\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动\n\n// [animate, duration, interval, trailLength],\nvoid main() {\n\n  gl_FragColor = v_color;\n\n \n  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    // 实线部分\n  } else {\n    // 虚线部分\n    discard;\n  };\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\n\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\nuniform float u_opacity: 1.0;\n\nvoid main() {\n\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  vec2 offset = project_pixel(size.xy);\n  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n \n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:"Dash"}:e&&n?{frag:'varying vec4 v_color;\nvarying vec4 v_texture_data;\nuniform float u_linearDir: 1.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity: 1.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n  float linearRadio = v_texture_data.r; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    linearRadio = v_texture_data.a;\n  }\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= u_opacity; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:dM,type:"Linear"}:{frag:'#extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\n\nuniform float u_borderWidth: 0.0;\n\nuniform vec3 u_blur;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_texture_data;\n\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // 控制运动\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  gl_FragColor.a *= u_opacity; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_texture_data.g;      // 当前顶点的距离\n    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n     vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor += pattern;\n    } else { // replace\n        pattern.a *= u_opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = pattern;\n    }\n  } \n\n  float v = v_texture_data.a;\n  float borderWidth = min(0.5, u_borderWidth);\n  // 绘制 border\n  if(borderWidth > 0.01) {\n    float borderOuterWidth = borderWidth / 2.0;\n\n\n    if(v >= 1.0 - borderWidth || v <= borderWidth) {\n      if(v > borderWidth) { // 外侧\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\n        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n      } else if(v <= borderWidth) {\n        float linear = smoothstep(0.0, 1.0, v/borderWidth);\n        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = v_texture_data.a;\n  if(blurV < 0.5) {\n    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:dM,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:cy.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:cy.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:cy.Attribute,descriptor:{name:"a_Normal",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:cy.Attribute,descriptor:{name:"a_Miter",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(HC);function yM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var gM=function(t){Oe(i,t);var e,n,r=yM(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"updateTexture",(function(){var e=t.rendererService.createTexture2D;t.colorTexture&&t.colorTexture.destroy();var n=qr(t.layer.getLayerConfig().rampColors);t.colorTexture=e({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE,min:pf.NEAREST,mag:pf.NEAREST,flipY:!1})})),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.vertexHeightScale,i=void 0===r?20:r,o=t.raisingHeight,a=void 0===o?0:o,s=t.heightfixed,u=void 0!==s&&s,l=t.linearDir,c=void 0===l?WC.VERTICAL:l;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:c===WC.VERTICAL?1:0,u_opacity:n,u_texture:this.colorTexture,u_heightfixed:Number(u),u_vertexScale:i,u_raisingHeight:Number(a)}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.updateTexture(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e,n,r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.depth,r=void 0!==n&&n,this.layer.triangulation=wk,t.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:'\nattribute float a_Miter;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity : 1.0;\nuniform sampler2D u_texture;\nuniform float u_linearDir: 1.0;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  float linearRadio =currentLinePointRatio; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    linearRadio = texV;\n  }\n\n  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));\n\n  v_Color.a *= u_opacity; // 全局透明度\n\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nvarying vec4 v_Color;\n#pragma include "picking"\nvoid main() {\n\n  gl_FragColor = v_Color; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:wk,depth:{enable:r}});case 4:return i=t.sent,t.abrupt("return",[i]);case 6:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:cy.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:cy.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:cy.Attribute,descriptor:{name:"a_Normal",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:cy.Attribute,descriptor:{name:"a_Miter",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}})}}]),i}(HC);function _M(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var xM='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\n\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_opacity: 1.0;\nuniform float u_vertexScale: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n#pragma include "projection"\n\nvarying vec4 v_color;\nvarying float v_distanceScale;\n\nvoid main() {\n\n  v_color = a_Color; \n  v_distanceScale = a_Distance / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity); \n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // 保持高度相对不变\n      h *= 2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n\n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n    gl_PointSize = 10.0;\n  }\n}\n',bM=function(t){Oe(i,t);var e,n,r=_M(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.vertexHeightScale,a=void 0===o?20:o,s=0,u=[0,0,0,0],l=[0,0,0,0];return r&&i&&(u=Hr(r),l=Hr(i),s=1),{u_opacity:n,u_linearColor:s,u_sourceColor:u,u_targetColor:l,u_vertexScale:a}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:"uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float opacity;\nvoid main() {\n  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\n  gl_FragColor.a *= opacity; // 全局透明度\n}\n",vert:xM,type:"lineSimpleLinear"}:{frag:"\nvarying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n\n}\n",vert:xM,type:"lineSimpleNormal"}}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getShaders(),n=e.frag,r=e.vert,i=e.type,t.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,triangulation:Ek,primitive:pf.LINES,depth:{enable:!1},pick:!1});case 3:return o=t.sent,t.abrupt("return",[o]);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:cy.Attribute,descriptor:{name:"a_Distance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t,e,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:cy.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}})}}]),i}(HC);function wM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var SM=function(t){Oe(i,t);var e,n,r=wM(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:pf.NEAREST,min:pf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.heightfixed,u=void 0!==s&&s,l=t.lineTexture,c=void 0!==l&&l,h=t.iconStep,p=void 0===h?100:h,f=t.iconStepCount,d=void 0===f?1:f;this.rendererService.getDirty()&&this.texture.bind();var v=0,m=[0,0,0,0],y=[0,0,0,0];return r&&i&&(m=Hr(r),y=Hr(i),v=1),{u_heightfixed:Number(u),u_opacity:ti.exports.isNumber(n)?n:1,u_textureBlend:"normal"===a?0:1,u_texture:this.texture,u_line_texture:c?1:0,u_iconStepCount:d,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:m,u_targetColor:y}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\nuniform float u_linearColor: 0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_dataset;\n\nvoid main() {\n\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_animate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // 设置数据集的参数\n  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  v_dataset[1] = a_Distance;       // 当前顶点的距离\n  v_dataset[2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  v_dataset[3] = miter;          // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // 固定高度\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    originSize = project_float_pixel(a_Size.x);\n  }\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动\n\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_color;\nvarying vec4 v_dataset;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // 当前顶点的距离\n    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:wk,depth:{enable:!1},blend:this.getBlend()});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:cy.Attribute,descriptor:{name:"a_Distance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t,e,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:cy.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:cy.Attribute,descriptor:{name:"a_Normal",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:cy.Attribute,descriptor:{name:"a_Miter",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(HC),EM={arc:eM,arc3d:iM,greatcircle:pM,wall:SM,line:mM,simple:bM,linearline:gM,earthArc3d:sM,flowline:lM};function AM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var TM=function(t){Oe(r,t);var e,n=AM(r);function r(){var t;Ee(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return kt(De(t=n.call.apply(n,[this].concat(i))),"type","LineLayer"),kt(De(t),"enableEncodeStyles",["opacity","offsets","stroke"]),kt(De(t),"arrowInsertCount",0),kt(De(t),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),t}return Te(r,[{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new EM[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;var e=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"line"}},{key:"processData",value:function(t){if("simple"!==this.getModelType())return t;var e=[];return t.map((function(t){if(Array.isArray(t.coordinates)&&Array.isArray(t.coordinates[0])&&Array.isArray(t.coordinates[0][0])){var n=It({},t);t.coordinates.map((function(t){e.push(It(It({},n),{},{coordinates:t}))}))}else e.push(t)})),e}}]),r}(VC);function CM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var kM=function(t){Oe(i,t);var e,n,r=CM(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"raiseCount",0),kt(De(t),"raiseRepeat",0),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1,speed:.01,repeat:!1}:e,r=t.opacity,i=void 0===r?1:r,o=t.sourceColor,a=t.targetColor,s=t.pickLight,u=void 0!==s&&s,l=t.heightfixed,c=void 0!==l&&l,h=t.opacityLinear,p=void 0===h?{enable:!1,dir:"up"}:h,f=t.lightEnable,d=void 0===f||f,v=0,m=[0,0,0,0],y=[0,0,0,0];if(o&&a&&(m=Hr(o),y=Hr(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var g=n.speed,_=void 0===g?.01:g;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(c),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:ti.exports.isNumber(i)?i:1,u_linearColor:v,u_sourceColor:m,u_targetColor:y,u_opacitylinear:Number(p.enable),u_opacitylinear_dir:"up"===p.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e,n,r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.animateOption.repeat,r=void 0===n?1:n,this.raiseRepeat=r,t.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n// 用于将在顶点着色器中计算好的样式值传递给片元\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  \n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  v_barLinearZ =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  v_lightWeight = lightWeight;\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);\n    v_color.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     v_color = a_Color;\n  }\n  v_color.a *= u_opacity;\n\n    \n  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n  //旋转矩阵mx，创建绕x轴旋转矩阵\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//求解旋转角度余弦值\n  float xsin = sin(xRadian);//求解旋转角度正弦值\n  mat4 mx = mat4(\n    1,0,0,0,  \n    0,xcos,-xsin,0,  \n    0,xsin,xcos,0,  \n    0,0,0,1);\n\n  //旋转矩阵my，创建绕y轴旋转矩阵\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//求解旋转角度余弦值\n  float ysin = sin(yRadian);//求解旋转角度正弦值\n  mat4 my = mat4(\n    ycos,0,-ysin,0,  \n    0,1,0,0,  \n    ysin,0,ycos,0,  \n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  \n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\n\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\nvoid main() {\n\n   gl_FragColor = v_color;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:xk,depth:{enable:!0},cull:{enable:!0,face:Jr(this.mapService.version)},blend:this.getBlend()});case 4:return i=t.sent,t.abrupt("return",[i]);case 6:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t){var e=t.size;if(e){var n=[];return Array.isArray(e)&&(n=2===e.length?[e[0],e[0],e[1]]:e),Array.isArray(e)||(n=[e,e,e]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:cy.Attribute,descriptor:{name:"a_Normal",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:cy.Attribute,descriptor:{name:"a_Pos",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t){var e=ki(t.coordinates);return KC([e[0],e[1]])}}})}}]),i}(HC);function MM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var IM=function(t){Oe(i,t);var e,n,r=MM(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.strokeOpacity,i=void 0===r?1:r,o=t.strokeWidth,a=void 0===o?0:o,s=t.stroke,u=void 0===s?"rgba(0,0,0,0)":s,l=t.blend,c=t.blur;return{u_blur:void 0===c?0:c,u_additive:"additive"===l?1:0,u_opacity:n,u_stroke_opacity:i,u_stroke_width:a,u_stroke_color:Hr(u)}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption,e=void 0===t?{enable:!1}:t;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.triangulation=_k,t.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n\nuniform float u_blur : 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:"uniform float u_additive;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + strokeWidth);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(strokeWidth < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",triangulation:_k,depth:{enable:!0},blend:this.getBlend()});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:cy.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r){var i=$r(n,3),o=i[0],a=i[1],s=i[2],u=Ia(0,0,1),l=Ia(o,0,s),c=o>=0?Va(u,l):2*Math.PI-Va(u,l),h=2*Math.PI-Math.asin(a/100),p=ia();fa(p,p,c),pa(p,p,h);var f=Ia(1,1,0);ja(f,f,p),Fa(f,f);var d=Ia(-1,1,0);ja(d,d,p),Fa(d,d);var v=Ia(-1,-1,0);ja(v,v,p),Fa(v,v);var m=Ia(1,-1,0);ja(m,m,p),Fa(m,m);var y=[].concat(At(f),At(d),At(v),At(m)),g=r%4*3;return[y[g],y[g+1],y[g+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:cy.Attribute,descriptor:{name:"a_Shape",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(e){var n=e.shape,r=void 0===n?2:n;return[t.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]),i}(HC);function PM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var LM=function(t){Oe(i,t);var e,n,r=PM(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"raiseCount",0),kt(De(t),"raiseRepeat",0),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1,speed:.01,repeat:!1}:e,r=t.opacity,i=void 0===r?1:r,o=t.sourceColor,a=t.targetColor,s=t.pickLight,u=void 0!==s&&s,l=t.heightfixed,c=void 0!==l&&l,h=t.opacityLinear,p=void 0===h?{enable:!1,dir:"up"}:h,f=t.lightEnable,d=void 0===f||f,v=0,m=[0,0,0,0],y=[0,0,0,0];if(o&&a&&(m=Hr(o),y=Hr(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var g=n.speed,_=void 0===g?.01:g;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(c),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:i,u_linearColor:v,u_sourceColor:m,u_targetColor:y,u_opacitylinear:Number(p.enable),u_opacitylinear_dir:"up"===p.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.depth,r=void 0===n||n,i=e.animateOption.repeat,o=void 0===i?1:i,this.raiseRepeat=o,t.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nuniform float u_opacitylinear: 0.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear_dir: 1.0;\nuniform float  u_linearColor: 0.0;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n\n  vec3 size = a_Size * a_Position;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // // 圆柱光照效果\n  float lightWeight = 1.0;\n\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n\n  v_lightWeight = lightWeight;\n\n  v_color = a_Color;\n\n    // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);\n    v_color.a =  v_color.a * u_opacity;\n  } else {\n    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);\n  }\n\n    if(u_opacitylinear > 0.0) {\n    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;\n  }\n\n\n  // gl_Position = project_common_position_to_clipspace(pos);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * pos;\n  } else {\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nvarying float v_lightWeight;\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n\n  gl_FragColor = v_color;\n  // 开启透明度渐变\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:xk,cull:{enable:!0,face:Jr(this.mapService.version)},depth:{enable:r}});case 4:return a=t.sent,t.abrupt("return",[a]);case 6:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t){var e=t.size;if(e){var n=[];return Array.isArray(e)&&(n=2===e.length?[e[0],e[0],e[1]]:e),Array.isArray(e)||(n=[e,e,e]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:cy.Attribute,descriptor:{name:"a_Normal",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:cy.Attribute,descriptor:{name:"a_Pos",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t){var e=ki(t.coordinates);return[e[0],e[1],0]}}})}}]),i}(HC);function RM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var OM="\nuniform float u_additive;\n\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  \n  outer_df = sdCircle(v_data.xy, 1.0);\n  inner_df = sdCircle(v_data.xy, r);\n\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  gl_FragColor = v_color;\n\n  float d = length(v_data.xy);\n  if(d > 0.5) {\n    discard;\n  }\n  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  \n  // 根据叠加模式选择效果\n  if(u_additive > 0.0) {\n    gl_FragColor *= intensity;\n    // 优化水波点 blend additive 模式下有的拾取效果 \n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",DM='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n\n// uniform float u_opacity : 1;\nuniform float u_stroke_width: 2;\nuniform vec3 u_blur_height_fixed: [0, 0, 0];\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  // 透明度计算\n  v_stroke = stroke;  \n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  *  u_meter2coord 在等面积大小的时候设置单位\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n\n\n  // unpack color(vec2)\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n   v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n  \n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_blur_height_fixed.y;\n\n  if(u_blur_height_fixed.z < 1.0) { // false\n    raisingHeight = project_pixel(u_blur_height_fixed.y);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n    }\n  }\n \n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position =  u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',NM=function(t){Oe(i,t);var e,n,r=RM(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.strokeOpacity,n=void 0===e?1:e,r=t.strokeWidth,i=void 0===r?0:r,o=t.blend,a=t.blur,s=void 0===a?0:a,u=t.raisingHeight,l=void 0===u?0:u,c=t.heightfixed,h=void 0!==c&&c,p=t.unit,f=void 0===p?"pixel":p;return It({u_blur_height_fixed:[s,Number(l),Number(h)],u_additive:"additive"===o?1:0,u_stroke_opacity:n,u_stroke_width:i,u_size_unit:qC[f]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption,e=void 0===t?{enable:!1}:t;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bs)}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.animateOption,r=void 0===n?{enable:!1}:n,i=this.getShaders(r),o=i.frag,a=i.vert,s=i.type,this.layer.triangulation=bs,t.next=5,this.layer.buildLayerModel({moduleName:s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:bs,depth:{enable:!1}});case 5:return u=t.sent,t.abrupt("return",[u]);case 7:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getShaders",value:function(t){return t.enable?(t.type,{frag:OM,vert:DM,type:"pointWave"}):{frag:"uniform float u_additive;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    gl_FragColor = v_color;\n  } else {\n    gl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n   // 作为 mask 模板时需要丢弃透明的像素\n  if(gl_FragColor.a < 0.01) {\n    discard;\n  } \n}\n",vert:DM,type:"pointFill"}}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:cy.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:cy.Attribute,descriptor:{name:"a_Shape",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(e){var n=e.shape,r=void 0===n?2:n;return[t.indexOf(r)]}}})}}]),i}(HC);function zM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var FM=function(t){Oe(i,t);var e,n,r=zM(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"meter2coord",1),kt(De(t),"isMeter",!1),kt(De(t),"radian",0),kt(De(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layerService.throttleRenderLayers();t.texture=e({data:t.iconService.getCanvas(),mag:pf.LINEAR,min:pf.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,i=void 0===r?[0,0]:r,o=t.rotation,a=t.raisingHeight,s=void 0===a?0:a,u=t.heightfixed,l=void 0!==u&&u,c=t.unit,h=void 0===c?"pixel":c;this.rendererService.getDirty()&&this.texture.bind();var p=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(p=-1),this.radian=void 0!==o?p*Math.PI*o/180:p*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_heightfixed:Number(l),u_size_unit:qC[h],u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),gk)}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\nattribute float a_Rotate;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform mat2 u_RotateMatrix;\nuniform int u_size_unit;\n\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv; // icon 贴图的 uv 坐标\n\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = (a_Extrude.xy + 1.0)/2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float newSize = a_Size;\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (newSize) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // height fixed\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv;\n\nvoid main() {\n\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  gl_FragColor = texture2D(u_texture, pos);\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:gk,depth:{enable:!1},cull:{enable:!0,face:Jr(this.mapService.version)}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"clearModels",value:function(){var t;this.iconService.off("imageUpdate",this.updateTexture),null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:cy.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.rotate,n=void 0===e?0:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_Uv",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.shape]||{x:-64,y:-64};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:cy.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(HC);function BM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var UM=function(t){Oe(i,t);var e,n,r=BM(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void setTimeout((function(){t.layerService.throttleRenderLayers()}));t.texture=e({data:t.iconService.getCanvas(),mag:pf.LINEAR,min:pf.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,i=void 0===r?[0,0]:r,o=t.raisingHeight,a=void 0===o?0:o,s=t.heightfixed,u=void 0!==s&&s;return this.rendererService.getDirty()&&this.texture.bind(),{u_raisingHeight:Number(a),u_heightfixed:Number(u),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec2 u_offsets;\n\nuniform float u_opacity : 1;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  v_color = a_Color;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  vec2 offset = project_pixel(u_offsets);\n\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "picking"\n\nvoid main(){\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: 去除边缘部分 mipmap 导致的混合变暗\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n\n      gl_FragColor.a = gl_FragColor.a * u_opacity;\n      \n      if (gl_FragColor.a < 0.01) {\n         discard;\n      }\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:bk,depth:{enable:!1},primitive:pf.POINTS});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_Uv",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap()[e.shape]||{x:-64,y:-64};return[n.x,n.y]}}})}}]),i}(HC);function jM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}function VM(t){var e=t.coordinates;return{vertices:At(e),indices:[0],size:e.length}}var GM=function(t){Oe(i,t);var e,n,r=jM(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t;return{u_opacity:ti.exports.isNumber(e)?e:1}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.triangulation=VM,t.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform float u_opacity : 1;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\n\nvarying vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n}\n',fragmentShader:"varying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n}\n",triangulation:VM,depth:{enable:!1},primitive:pf.POINTS,pick:!1});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(HC);function HM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var WM=function(t){Oe(i,t);var e,n,r=HM(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.blend,i=t.speed,o=void 0===i?1:i,a=t.unit;return{u_size_unit:qC[void 0===a?"pixel":a],u_speed:o,u_additive:"additive"===r?1:0,u_opacity:n}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption,e=void 0===t?{enable:!1}:t;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),gk)}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nuniform float u_speed: 1.0;\nuniform float u_time;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2( \n    cos(time), sin(time), \n    -sin(time), cos(time)\n  );\n  v_exteude = rotateMatrix * a_Extrude.xy;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n\n\n  // anti-alias\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  // radius(16-bit)\n  v_radius = newSize;\n\n  vec2 offset = (extrude.xy * (newSize));\n  vec3 aPosition = a_Position;\n  \n    // 不以米为实际单位\n  offset = project_pixel(offset);\n  \n  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_additive;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n  } else {\n    gl_FragColor.a *= opacity_t;\n  }\n\n  if(gl_FragColor.a > 0.0) {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  vec2 extrude =  v_exteude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  // full circle\n  // float rades = dot(dir, baseDir);\n  // float flag = sign(dir.y);\n  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;\n  \n  // half circle\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  gl_FragColor.a *= radar_v;\n}\n',triangulation:gk,depth:{enable:!1}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:cy.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(HC);function ZM(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}function qM(t){var e=t.coordinates;return{vertices:At(e),indices:[0],size:e.length}}var XM=function(t){Oe(i,t);var e,n,r=ZM(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,i=void 0===r?[0,0]:r,o=t.blend,a=t.strokeOpacity,s=void 0===a?1:a,u=t.strokeWidth,l=void 0===u?0:u,c=t.stroke;return{u_additive:"additive"===o?1:0,u_opacity:n,u_offsets:i,u_stroke_opacity:s,u_stroke_width:l,u_stroke_color:Hr(void 0===c?"#fff":c)}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.layer.triangulation=qM,t.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\n\nvarying float v_blur;\nvarying float v_innerRadius;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n  \n  vec2 offset = project_pixel(u_offsets);\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_additive;\nuniform float u_stroke_opacity : 1;\n\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      gl_FragColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      gl_FragColor = mix(v_color, stroke, mixR);\n    } else {\n      gl_FragColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    gl_FragColor = v_color;\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n  \n  if(u_additive > 0.0) {\n    gl_FragColor *= circleClipOpacity;\n  } else {\n    gl_FragColor.a *= circleClipOpacity;\n  }\n\n}\n',triangulation:qM,depth:{enable:!1},primitive:pf.POINTS});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(HC);function YM(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return KM(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return KM(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function KM(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var QM=function(){function t(e,n,r){Ee(this,t),kt(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0}return Te(t,[{key:"insert",value:function(t,e,n,r,i){this.forEachCell(e,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!1,i)}},{key:"hitTest",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!0,i)}},{key:"insertBoxCell",value:function(t,e,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(t,e,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(t,e,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l){var c,h=this.bboxes,p=YM(l);try{for(p.s();!(c=p.n()).done;){var f=c.value;if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=h[d+2]&&e<=h[d+3]&&n>=h[d+0]&&r>=h[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}}catch(t){p.e(t)}finally{p.f()}}return!1}},{key:"forEachCell",value:function(t,e,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(t),l=this.convertToYCellCoord(e),c=this.convertToXCellCoord(n),h=this.convertToYCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.xCellCount*f+p;if(i.call(this,t,e,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),t}(),JM=QM,$M=function(){function t(e,n){Ee(this,t),kt(this,"viewportPadding",100),this.width=e,this.height=n,this.viewportPadding=Math.max(e,n),this.grid=new JM(e+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=e+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=e+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return Te(t,[{key:"placeCollisionBox",value:function(t){var e=t.x1+t.anchorPointX+this.viewportPadding,n=t.y1+t.anchorPointY+this.viewportPadding,r=t.x2+t.anchorPointX+this.viewportPadding,i=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(e,n,r,i)||this.grid.hitTest(e,n,r,i)?{box:[]}:{box:[e,n,r,i]}}},{key:"insertCollisionBox",value:function(t,e){var n={featureIndex:e};this.grid.insert(n,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,e,n){var r=ts(e,n,0,1),i=$a();return es(i,r,aa.apply(Ca,At(t))),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}}]),t}();function tI(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return eI(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eI(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function eI(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function nI(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;break;default:e=.5}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:e,verticalAlign:n}}function rI(t,e,n,r,i){if(i){var o=t[r],a=o.glyph;if(a)for(var s=e[a].advance*o.scale,u=(t[r].x+s)*i,l=n;l<=r;l++)t[l].x-=u}}function iI(t,e,n,r,i,o,a){var s,u=(e-n)*i,l=(-r*a+.5)*o,c=tI(t);try{for(c.s();!(s=c.n()).done;){var h=s.value;h.x+=u,h.y+=l}}catch(t){c.e(t)}finally{c.f()}}function oI(t,e,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=t.split("\n"),l=[],c={positionedGlyphs:l,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:t};return s?function(t,e,n,r,i,o,a){var s=0,u=-8,l=0,c=t.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,p=c.length;n.forEach((function(t){var n=e[t];if(n&&(c.push({glyph:t,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),c.length!==p){var i=s-a;l=Math.max(i,l),rI(c,e,p,c.length-1,h)}s=0,u-=r+5}));var f=nI(i),d=f.horizontalAlign,v=f.verticalAlign;iI(c,h,d,v,l,r,n.length);var m=u- -8;t.top+=-v*m,t.bottom=t.top-m,t.left+=-d*l,t.right=t.left+l}(c,e,u,n,r,i,o):function(t,e,n,r,i,o,a){var s=0,u=-8,l=0,c=t.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,p=c.length;n.forEach((function(t){if(t.split("").forEach((function(t){var n=e[t];n&&(c.push({glyph:t,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),c.length!==p){var n=s-a;l=Math.max(n,l),rI(c,e,p,c.length-1,h)}s=0,u-=r+5}));var f=nI(i),d=f.horizontalAlign,v=f.verticalAlign;iI(c,h,d,v,l,r,n.length);var m=u- -8;t.top+=-v*m,t.bottom=t.top-m,t.left+=-d*l,t.right=t.left+l}(c,e,u,n,r,i,o),!!l.length&&c}function aI(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return sI(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sI(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function sI(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function uI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var lI='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\n\n  gl_FragColor.a *= alpha;\n   // 作为 mask 模板时需要丢弃透明的像素\n  if (gl_FragColor.a < 0.01) {\n    discard;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',cI='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying float v_fontScale;\n// uniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  \n  v_uv = a_tex / u_sdf_map_size;\n\n\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n   projected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  } else { // else\n   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  }\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n';function hI(t){var e=this,n=t.id,r=[],i=[];if(!e.glyphInfoMap||!e.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var o=e.glyphInfoMap[n].centroid,a=2===o.length?[o[0],o[1],0]:o;return e.glyphInfoMap[n].glyphQuads.forEach((function(t,e){r.push.apply(r,At(a).concat([t.tex.x,t.tex.y+t.tex.height,t.tl.x,t.tl.y],At(a),[t.tex.x+t.tex.width,t.tex.y+t.tex.height,t.tr.x,t.tr.y],At(a),[t.tex.x+t.tex.width,t.tex.y,t.br.x,t.br.y],At(a),[t.tex.x,t.tex.y,t.bl.x,t.bl.y])),i.push(0+4*e,1+4*e,2+4*e,2+4*e,3+4*e,0+4*e)})),{vertices:r,indices:i,size:7}}var pI=function(t){Oe(a,t);var e,n,r,i,o=uI(a);function a(){var t;Ee(this,a);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return kt(De(t=o.call.apply(o,[this].concat(n))),"glyphInfoMap",{}),kt(De(t),"currentZoom",-1),kt(De(t),"textureHeight",0),kt(De(t),"textCount",0),kt(De(t),"preTextStyle",{}),kt(De(t),"mapping",Zt(Kt.mark((function e(){return Kt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.initGlyph(),t.updateTexture(),e.next=4,t.reBuildModel();case 4:case"end":return e.stop()}}),e)})))),t}return Te(a,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();t.opacity;var e=t.stroke,n=void 0===e?"#fff":e,r=t.strokeWidth,i=void 0===r?0:r,o=t.halo,a=void 0===o?.5:o,s=t.gamma,u=void 0===s?2:s,l=t.raisingHeight,c=void 0===l?0:l,h=this.getFontServiceMapping(),p=this.getFontServiceCanvas();return h&&Object.keys(h).length!==this.textCount&&p&&(this.updateTexture(),this.textCount=Object.keys(h).length),this.preTextStyle=this.getTextStyle(),It({u_raisingHeight:Number(c),u_stroke_width:i,u_stroke_color:Hr(n),u_sdf_map:this.texture,u_halo_blur:a,u_gamma_scale:u,u_sdf_map_size:[(null==p?void 0:p.width)||1,(null==p?void 0:p.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:(i=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),t.abrupt("return",this.buildModels());case 5:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"buildModels",value:(r=Zt(Kt.mark((function t(){var e,n,r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.textAllowOverlap,r=void 0!==n&&n,this.initGlyph(),this.updateTexture(),r||this.filterGlyphs(),t.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:cI,fragmentShader:lI,inject:this.getInject(),triangulation:hI.bind(this),depth:{enable:!1}});case 6:return i=t.sent,t.abrupt("return",[i]);case 8:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"needUpdate",value:(n=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,p;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.getTextStyle(),n=e.textAllowOverlap,r=void 0!==n&&n,i=e.textAnchor,o=void 0===i?"center":i,a=e.textOffset,s=e.padding,u=e.fontFamily,l=e.fontWeight,ti.exports.isEqual(s,this.preTextStyle.padding)&&ti.exports.isEqual(a,this.preTextStyle.textOffset)&&ti.exports.isEqual(o,this.preTextStyle.textAnchor)&&ti.exports.isEqual(u,this.preTextStyle.fontFamily)&&ti.exports.isEqual(l,this.preTextStyle.fontWeight)){t.next=5;break}return t.next=4,this.mapping();case 4:case 13:return t.abrupt("return",!0);case 5:if(!r){t.next=7;break}return t.abrupt("return",!1);case 7:if(c=this.mapService.getZoom(),h=this.mapService.getBounds(),p=Ai(this.extent,h),!(Math.abs(this.currentZoom-c)>.5)&&p&&r===this.preTextStyle.textAllowOverlap){t.next=14;break}return t.next=13,this.reBuildModel();case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:cy.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.rotate,n=void 0===e?0:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:cy.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,e,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?12:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:cy.Attribute,descriptor:{name:"a_tex",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){return Ei(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var t=this.getTextStyle(),e=t.fontWeight,n=t.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(t){var e,n=t.shape,r=void 0===n?"":n,o=aI(r=r.toString());try{for(o.s();!(e=o.n()).done;){var a=e.value;-1===i.indexOf(a)&&i.push(a)}}catch(t){o.e(t)}finally{o.f()}})),this.fontService.setFontOptions({characterSet:i,fontWeight:e,fontFamily:n,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.getTextStyle(),e=t.fontWeight,n=t.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(t){var e=t.shape,n=void 0===e?"":e;n="".concat(n),-1===i.indexOf(n)&&i.push(n)})),this.fontService.setFontOptions({characterSet:i,fontWeight:e,fontFamily:n,iconfont:!0})}},{key:"getTextStyle",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r,o=t.textAllowOverlap,a=void 0!==o&&o,s=t.padding,u=void 0===s?[0,0]:s,l=t.textAnchor,c=void 0===l?"center":l,h=t.textOffset,p=void 0===h?[0,0]:h,f=t.opacity,d=void 0===f?1:f,v=t.strokeOpacity,m=void 0===v?1:v,y=t.strokeWidth,g=void 0===y?0:y,_=t.stroke;return{fontWeight:n,fontFamily:i,textAllowOverlap:a,padding:u,textAnchor:c,textOffset:p,opacity:d,strokeOpacity:m,strokeWidth:g,stroke:void 0===_?"#000":_}}},{key:"generateGlyphLayout",value:function(t){var e=this,n=this.getFontServiceMapping(),r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=r.textOffset,l=this.rawEncodeData;this.glyphInfo=l.map((function(r){var i=r.shape,a=void 0===i?"":i,l=r.id,c=r.size,h=void 0===c?1:c,p=oI(a.toString(),n,h,s,"left",o,u,t),f=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=t.positionedGlyphs,o=[],a=tI(void 0===i?[]:i);try{for(a.s();!(e=a.n()).done;){var s=e.value,u=s.metrics,l=u.advance*s.scale/2,c=r?[s.x+l,s.y]:[0,0],h=r?[0,0]:[s.x+l+n[0],s.y+n[1]],p=-4*s.scale-l+h[0],f=-4*s.scale+h[1],d=p+u.width*s.scale,v=f+u.height*s.scale,m={x:p,y:f},y={x:d,y:f},g={x:p,y:v},_={x:d,y:v};o.push({tl:m,tr:y,bl:g,br:_,tex:u,glyphOffset:c})}}catch(t){a.e(t)}finally{a.f()}return o}(p,u,!1);return r.shaping=p,r.glyphQuads=f,r.centroid=ki(r.coordinates),r.originCentroid="GAODE2.x"===r.version?ki(r.originCoordinates):r.originCentroid=r.centroid,e.glyphInfoMap[l]={shaping:p,glyphQuads:f,centroid:ki(r.coordinates)},r}))}},{key:"getFontServiceMapping",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getMappingByKey("".concat(i,"_").concat(n))}},{key:"getFontServiceCanvas",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getCanvasByKey("".concat(i,"_").concat(n))}},{key:"filterGlyphs",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.padding,r=void 0===n?[0,0]:n,i=e.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new $M(a,s),l=this.glyphInfo.filter((function(e){var n=e.shaping,i=e.id,o=void 0===i?0:i,a="GAODE2.x"===e.version?e.originCentroid:e.centroid,s=e.size/16,l=t.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length)&&(u.insertCollisionBox(c,o),!0)}));l.forEach((function(e){t.glyphInfoMap[e.id]=e}))}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig().iconfont,e=void 0!==t&&t;e?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(e)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.getFontServiceCanvas();this.textureHeight=e.height,this.texture&&this.texture.destroy(),this.texture=t({data:e,mag:pf.LINEAR,min:pf.LINEAR,width:e.width,height:e.height})}},{key:"reBuildModel",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.filterGlyphs(),t.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:cI,fragmentShader:lI,triangulation:hI.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:e=t.sent,this.layer.models=[e];case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),a}(HC),fI={fillImage:FM,fill:NM,radar:WM,image:UM,normal:GM,simplePoint:XM,extrude:LM,text:pI,earthFill:IM,earthExtrude:kM};function dI(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return vI(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vI(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function vI(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function mI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var yI=function(t){Oe(i,t);var e,n,r=mI(i);function i(){var t;Ee(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return kt(De(t=r.call.apply(r,[this].concat(n))),"type","PointLayer"),kt(De(t),"enableEncodeStyles",["opacity","offsets","stroke"]),kt(De(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),t}return Te(i,[{key:"buildModels",value:(n=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new fI[e](this),t.next=5,this.initLayerModels();case 5:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"rebuildModels",value:(e=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.buildModels();case 2:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,e=t.field,n=t.values,r=this.getLayerConfig().shape2d,i=this.iconService.getIconMap();if(e&&-1!==(null==r?void 0:r.indexOf(e)))return"fill";if("text"===n)return"text";if(n&&n instanceof Array){var o,a=dI(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;if("string"==typeof s&&i.hasOwnProperty(s))return"image"}}catch(t){a.e(t)}finally{a.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find((function(t){return t.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":"simple"===a?"simplePoint":"radar"===a?"radar":"fillImage"===this.layerType?"fillImage":-1!==(null==n?void 0:n.indexOf(a))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null==r?void 0:r.indexOf(a))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":i.hasOwnProperty(a)?"image":"text"}return this.getModelTypeWillEmptyData()}}]),i}(VC);function gI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var _I=function(t){Oe(o,t);var e,n,r,i=gI(o);function o(){return Ee(this,o),i.apply(this,arguments)}return Te(o,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.heightfixed,n=void 0!==e&&e,r=t.raisingHeight,i=void 0===r?0:r,o=t.topsurface,a=void 0===o||o,s=t.sidesurface,u=void 0===s||s,l=t.sourceColor,c=t.targetColor,h=0,p=[1,1,1,1],f=[1,1,1,1];return l&&c&&(p=Hr(l),f=Hr(c),h=1),It({u_topsurface:Number(a),u_sidesurface:Number(u),u_heightfixed:Number(n),u_raisingHeight:Number(i),u_linearColor:h,u_sourceColor:p,u_targetColor:f,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:(r=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadTexture();case 2:return t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=Zt(Kt.mark((function t(){var e,n,r,i,o;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getShaders(),n=e.frag,r=e.vert,i=e.type,t.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:Ik});case 3:return o=t.sent,t.abrupt("return",[o]);case 5:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.pickLight;return t.mapTexture?{frag:'uniform sampler2D u_texture;\nuniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide = v_texture_data.x;\n  float lightWeight = v_texture_data.y;\n  float topU = v_uvs[0];\n  float topV = 1.0 - v_uvs[1];\n  float sidey = v_uvs[2];\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {// 是否是边缘\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      gl_FragColor = v_Color;\n    }\n  } else {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = texture2D(u_texture, vec2(topU, topV));\n    // gl_FragColor = vec4(1.0, 0., 0., 1.0);\n  }\n  \n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform sampler2D u_texture;\n\n\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\nuniform float u_linearColor: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n  vec4 project_pos = project_position(pos);\n  v_uvs = a_uvs;\n\n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudeTexture"}:e?{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide =  v_texture_data.x;\n  float sidey = v_uvs[2];\n  float lightWeight = v_texture_data.y;\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      // side notuse linear\n       gl_FragColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    gl_FragColor = v_Color;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n\n\n  v_uvs = a_uvs;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  v_texture_data = vec2(a_Position.z,lightWeight);\n\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudePickLight"}:{frag:'uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\n\n#pragma include "picking"\n\nvoid main() {\n\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = v_Color;\n  \n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  float isSide = a_Position.z;\n float topU = a_uvs[0];\n float topV = 1.0 - a_uvs[1];\n float sidey = a_uvs[2];\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    // if(u_sidesurface < 1.0) {\n    //   discard;\n    // }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      v_Color = linearColor;\n    } else {\n      v_Color = a_Color;\n    }\n\n  } else {\n    v_Color = a_Color;\n  }\n\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=t,n=this.layer.coordCenter||this.layer.getSource().center,r=e[2]-e[0],i=e[3]-e[1];if("GAODE2.x"===this.mapService.version){var o=$r(this.mapService.coordToAMap2RelativeCoordinates([t[0],t[1]],n),2),a=o[0],s=o[1],u=$r(this.mapService.coordToAMap2RelativeCoordinates([t[2],t[3]],n),2),l=u[0],c=u[1];r=l-a,i=c-s,e=[a,s,l,c]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:cy.Attribute,descriptor:{name:"a_uvs",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,n,o){var a=o[0],s=o[1];return[(a-e[0])/r,(s-e[1])/i,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:cy.Attribute,descriptor:{name:"a_Normal",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:cy.Attribute,descriptor:{name:"a_Size",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?10:e;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:(e=Zt(Kt.mark((function t(){var e,n,r,i=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.layer.getLayerConfig(),n=e.mapTexture,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),!n){t.next=5;break}return t.abrupt("return",new Promise((function(t,e){var o=new Image;o.crossOrigin="anonymous",o.src=n,o.onload=function(){return i.texture=r({data:o,width:o.width,height:o.height,wrapS:pf.CLAMP_TO_EDGE,wrapT:pf.CLAMP_TO_EDGE,min:pf.LINEAR,mag:pf.LINEAR}),t(null)},o.onerror=function(){e(new Error("image load error"))}})));case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),o}(HC);function xI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var bI=function(t){Oe(i,t);var e,n,r=xI(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.raisingHeight,n=void 0===e?0:e,r=t.opacityLinear,i=void 0===r?{enable:!1,dir:"in"}:r;return It({u_raisingHeight:Number(n),u_opacitylinear:Number(i.enable),u_dir:"in"===i.dir?1:0},this.getStyleAttribute())}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u,l,c;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelParams(),n=e.frag,r=e.vert,i=e.triangulation,o=e.type,a=this.layer.getLayerConfig(),s=a.workerEnabled,u=void 0!==s&&s,l=a.enablePicking,this.layer.triangulation=i,t.next=5,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:i,primitive:pf.TRIANGLES,depth:{enable:!1},workerEnabled:u,workerOptions:{modelType:o,enablePicking:l}});case 5:return c=t.sent,t.abrupt("return",[c]);case 7:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().opacityLinear;(void 0===t?{enable:!1,dir:"in"}:t).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:cy.Attribute,descriptor:{name:"a_linear",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:3,update:function(t,e,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig().opacityLinear;return(void 0===t?{enable:!1}:t).enable?{frag:'#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvarying vec4 v_Color;\n\n\nvoid main() {\n   gl_FragColor = v_Color;\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nuniform float u_opacitylinear: 0.0;\n\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\nvoid main() {\n  if(u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}',type:"polygonLinear",triangulation:kk}:{frag:'varying vec4 v_color;\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n\n',type:"polygonFill",triangulation:ws}}}]),i}(HC);function wI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var SI=function(t){Oe(i,t);var e,n,r=wI(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.watercolor,i=void 0===r?"#6D99A8":r,o=t.watercolor2,a=void 0===o?"#0F121C":o;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Hr(i),u_watercolor2:Hr(a),u_opacity:ti.exports.isNumber(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadTexture(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'attribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec2 v_uv;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"\nuniform float u_time: 0.0;\nuniform float u_opacity: 1.0;\n\nvarying vec2 v_uv;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)\n// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture2D(u_texture2,p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture2D(u_texture1,fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n\n  float opacity = u_opacity;\n  gl_FragColor = vec4(col, opacity);  \n}\n",triangulation:Ck,primitive:pf.TRIANGLES,depth:{enable:!1}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"clearModels",value:function(){var t,e,n;null===(t=this.texture1)||void 0===t||t.destroy(),null===(e=this.texture2)||void 0===e||e.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=$r(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3],o=r-e,a=i-n;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:cy.Attribute,descriptor:{name:"a_uv",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,r,i,s){var u=$r(t.version===Og["GAODE2.x"]?t.originCoordinates[0][s]:i,2),l=u[0],c=u[1];return[(l-e)/o,(c-n)/a]}}})}},{key:"loadTexture",value:function(){var t,e,n,r=this,i=this.rendererService.createTexture2D,o={height:0,width:0};function a(t){return i({data:t,width:t.width,height:t.height,wrapS:pf.MIRRORED_REPEAT,wrapT:pf.MIRRORED_REPEAT,min:pf.LINEAR,mag:pf.LINEAR})}this.texture1=i(o),this.texture2=i(o),this.texture3=i(o),t=function(t){r.texture1=a(t[0]),r.texture2=a(t[1]),r.texture3=a(t[2]),r.layerService.reRender()},e=0,n=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){3==++e&&t(n)}}))}}]),i}(HC);function EI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var AI=function(t){Oe(i,t);var e,n,r=EI(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.speed,i=void 0===r?.5:r;return{u_texture:this.texture,u_speed:i,u_opacity:ti.exports.isNumber(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadTexture(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform sampler2D u_texture;\nuniform float u_time: 0.0;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n  float opacity = u_opacity;\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= opacity;\n\n  float spc = calSpc();\n  gl_FragColor += spc * 0.4;\n}\n",triangulation:Ck,primitive:pf.TRIANGLES,depth:{enable:!1}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=$r(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3],o=r-e,a=i-n;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:cy.Attribute,descriptor:{name:"a_uv",buffer:{usage:pf.STATIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,r,i,s){var u=$r(t.version===Og["GAODE2.x"]?t.originCoordinates[0][s]:i,2),l=u[0],c=u[1];return[(l-e)/o,(c-n)/a]}}})}},{key:"loadTexture",value:function(){var t=this,e=this.layer.getLayerConfig().waterTexture,n=this.rendererService.createTexture2D;this.texture=n({height:0,width:0});var r=new Image;r.crossOrigin="",e?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=e):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:pf.MIRRORED_REPEAT,wrapT:pf.MIRRORED_REPEAT,min:pf.LINEAR,mag:pf.LINEAR}),t.layerService.reRender()}}}]),i}(HC),TI={fill:bI,line:mM,extrude:_I,text:pI,point_fill:NM,point_image:UM,point_normal:GM,point_extrude:LM,water:AI,ocean:SI};function CI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var kI=function(t){Oe(r,t);var e,n=CI(r);function r(){var t;Ee(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return kt(De(t=n.call.apply(n,[this].concat(i))),"type","PolygonLayer"),kt(De(t),"enableEncodeStyles",["opacity"]),t}return Te(r,[{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new TI[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==e||null===(t=e.scale)||void 0===t?void 0:t.field;return"fill"!==n&&n?"extrude"===n?"extrude":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType():"fill"}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find((function(t){return t.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),r}(VC);function MI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var II=function(t){Oe(o,t);var e,n,r,i=MI(o);function o(){return Ee(this,o),i.apply(this,arguments)}return Te(o,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.clampLow,i=void 0===r||r,o=t.clampHigh,a=void 0===o||o,s=t.noDataValue,u=void 0===s?-9999999:s,l=t.domain,c=t.rampColors,h=l||Yr(c);return this.colorTexture=this.layer.textureService.getColorTexture(c,h),{u_opacity:n||1,u_texture:this.texture,u_domain:h,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:(r=Zt(Kt.mark((function t(e){var n,r,i,o;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Array.isArray(e.data)){t.next=4;break}return t.abrupt("return",{data:e.data,width:e.width,height:e.height});case 4:return t.next=6,e.data;case 6:return n=t.sent,r=n.rasterData,i=n.width,o=n.height,t.abrupt("return",{data:Array.from(r),width:i,height:o});case 11:case"end":return t.stop()}}),t)}))),function(t){return r.apply(this,arguments)})},{key:"initModels",value:(n=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getSource(),n=this.rendererService.createTexture2D,r=e.data.dataArray[0],t.next=5,this.getRasterData(r);case 5:return i=t.sent,o=i.data,a=i.width,s=i.height,this.texture=n({data:o,width:a,height:s,format:pf.LUMINANCE,type:pf.FLOAT}),t.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\n\n\nvoid main() {\n\n  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\n  if (value == u_noDataValue || isnan_emu(value))\n      discard;\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n     discard;\n  else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\n    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\n    \n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n    if(gl_FragColor.a < 0.01)\n      discard;\n   \n  }\n}\n",triangulation:Lk,primitive:pf.TRIANGLES,depth:{enable:!1}});case 12:return u=t.sent,t.abrupt("return",[u]);case 14:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_Uv",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),o}(HC),PI=["data"],LI=["rasterData"];function RI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var OI=function(t){Oe(o,t);var e,n,r,i=RI(o);function o(){var t;Ee(this,o);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return kt(De(t=i.call.apply(i,[this].concat(n))),"dataOption",{}),t}return Te(o,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.noDataValue,i=void 0===r?0:r,o=this.dataOption,a=o.rMinMax,s=o.gMinMax,u=o.bMinMax;return{u_opacity:n||1,u_texture:this.texture,u_noDataValue:i,u_rminmax:a,u_gminmax:s,u_bminmax:u}}},{key:"getRasterData",value:(r=Zt(Kt.mark((function t(e){var n,r,i,o,a;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Array.isArray(e.data)){t.next=4;break}return n=e.data,r=Wf(e,PI),this.dataOption=r,t.abrupt("return",It({data:n},r));case 4:return t.next=6,e.data;case 6:if(i=t.sent,o=i.rasterData,a=Wf(i,LI),this.dataOption=a,!Array.isArray(o)){t.next=14;break}return t.abrupt("return",It({data:o},a));case 14:return t.abrupt("return",It({data:Array.from(o)},a));case 15:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"initModels",value:(n=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s,u;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getSource(),n=this.rendererService.createTexture2D,r=e.data.dataArray[0],t.next=5,this.getRasterData(r);case 5:return i=t.sent,o=i.data,a=i.width,s=i.height,this.texture=n({data:o,width:a,height:s,format:pf.RGB,type:pf.FLOAT}),t.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform vec2 u_rminmax: vec2(0,255); \nuniform vec2 u_gminmax: vec2(0,255);\nuniform vec2 u_bminmax: vec2(0,255);\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform float u_noDataValue : 0.0;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;\n  if(rgb == vec3(u_noDataValue)) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n  }\n  if(gl_FragColor.a < 0.01)\n    discard;\n \n}",triangulation:Lk,primitive:pf.TRIANGLES,depth:{enable:!1}});case 12:return u=t.sent,t.abrupt("return",[u]);case 14:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_Uv",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),o}(HC);function DI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var NI=function(t){Oe(i,t);var e,n,r=DI(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.clampLow,r=void 0===n||n,i=t.clampHigh,o=void 0===i||i,a=t.noDataValue,s=void 0===a?-9999999:a,u=t.domain,l=t.rampColors,c=t.colorTexture,h=t.rScaler,p=void 0===h?6553.6:h,f=t.gScaler,d=void 0===f?25.6:f,v=t.bScaler,m=void 0===v?.1:v,y=t.offset,g=void 0===y?1e4:y,_=u||Yr(l),x=c;return c?this.layer.textureService.setColorTexture(c,l,_):x=this.layer.textureService.getColorTexture(l,_),{u_opacity:e||1,u_texture:this.texture,u_domain:_,u_clampLow:r,u_clampHigh:void 0!==o?o:r,u_noDataValue:s,u_unpack:[p,d,m,g],u_colorTexture:x}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){var e,n,r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.layer.getSource(),n=this.rendererService.createTexture2D,t.next=4,e.data.images;case 4:return r=t.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:pf.LINEAR,mag:pf.LINEAR}),t.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nvarying vec2 v_texCoord;\n\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nuniform vec4 u_unpack;\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data = texture2D(u_texture, coord,bias) * 255.0;\n    data.a = -1.0;\n    return dot(data, u_unpack);\n}\n\nvec4 getColor(float value) {\n   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec2 coord = vec2(normalisedValue, 0);\n    return texture2D(u_colorTexture, coord);\n}\n\nvoid main() {\n  float value = getElevation(v_texCoord,0.0);\n  if (value == u_noDataValue) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {\n     gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n   \n    gl_FragColor = getColor(value);\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n      if(gl_FragColor.a < 0.01)\n      discard;\n  }\n}\n",triangulation:Lk,primitive:pf.TRIANGLES,depth:{enable:!1}});case 8:return i=t.sent,t.abrupt("return",[i]);case 10:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:cy.Attribute,descriptor:{name:"a_Uv",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),i}(HC),zI={raster:II,rasterRgb:OI,raster3d:II,rasterTerrainRgb:NI};function FI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var BI=function(t){Oe(r,t);var e,n=FI(r);function r(){var t;Ee(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return kt(De(t=n.call.apply(n,[this].concat(i))),"type","RasterLayer"),t}return Te(r,[{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new zI[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.getParserType()){case"raster":default:return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb"}}}]),r}(VC);function UI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var jI=function(t){Oe(i,t);var e,n,r=UI(i);function i(){return Ee(this,i),r.apply(this,arguments)}return Te(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.color,i=void 0===r?"#000":r;return{u_opacity:ti.exports.isNumber(n)?n:0,u_color:Hr(i)}}},{key:"initModels",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform float u_opacity : 1.0;\nuniform vec4 u_color;\n\nvoid main() {\n  gl_FragColor = u_color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:Ck,depth:{enable:!1},pick:!1});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"clearModels",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),i}(HC),VI={fill:jI};function GI(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var HI,WI,ZI,qI,XI,YI,KI,QI,JI=function(t){Oe(r,t);var e,n=GI(r);function r(){var t;Ee(this,r);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return kt(De(t=n.call.apply(n,[this].concat(i))),"type","MaskLayer"),t}return Te(r,[{key:"buildModels",value:(e=Zt(Kt.mark((function t(){var e;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new VI[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getModelType",value:function(){return"fill"}}]),r}(VC),$I=(HI=ku.injectable(),WI=ku.inject(Hh.IMapService),ZI=ku.inject(Hh.IFontService),HI((XI=function(){function t(){Ee(this,t),Rp(this,"mapService",YI,this),Rp(this,"fontService",KI,this)}return Te(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",Zt(Kt.mark((function e(){return Kt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.log(Ay,Sp.INIT),n.generateMaping(t,{styleAttributeService:r}),t.log(Ty,Sp.INIT);case 3:case"end":return e.stop()}}),e)})))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var e=Zt(Kt.mark((function e(i){var o;return Kt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",i);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(Ay,Sp.UPDATE),o=n.generateMaping(t,{styleAttributeService:r}),t.log(Ty,Sp.UPDATE),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",(function(){var e=t.getSource();if(!t.layerModelNeedUpdate&&e&&e.inited){var i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=e.data.dataArray;if(!Array.isArray(a)||0!==a.length){var s=i.filter((function(t){return t.needRemapping})),u=a;if(null!=o&&o.needRemapping&&null!=o&&o.scale&&(u=a.filter((function(t){return n.applyAttributeMapping(o,t)[0]}))),s.length){var l=n.mapping(t,s,u,t.getEncodedData());t.setEncodedData(l)}}}}))}},{key:"generateMaping",value:function(t,e){var n=this,r=e.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.getSource().data.dataArray,s=a;null!=o&&o.scale&&(s=a.filter((function(t){return n.applyAttributeMapping(o,t)[0]}))),s=t.processData(s);var u=this.mapping(t,i,s,void 0);return t.setEncodedData(u),(0!==a.length||0!==t.encodeDataLength)&&(t.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(t,e,n,r){var i=this,o=t.getLayerConfig().arrow,a=void 0===o?{enable:!1}:o,s=e.filter((function(t){return void 0!==t.scale})).filter((function(t){return"filter"!==t.name})),u=n.map((function(e,n){var o=r?r[n]:{},u=It({id:e._id,coordinates:e.coordinates},o);if(s.forEach((function(t){var n=i.applyAttributeMapping(t,e);"color"!==t.name&&"stroke"!==t.name||(n=n.map((function(t){return Hr(t)}))),u[t.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===t.name&&(u.shape=i.fontService.getIconFontKey(u[t.name]))})),a.enable&&"line"===u.shape){var l=u.coordinates;if(t.arrowInsertCount<t.encodeDataLength){var c=i.getArrowPoints(l[0],l[1]);u.coordinates.splice(1,0,c,c),t.arrowInsertCount++}}return u}));return e.forEach((function(t){t.needRemapping=!1})),this.adjustData2Amap2Coordinates(u,t),this.adjustData2SimpleCoordinates(u),u}},{key:"adjustData2Amap2Coordinates",value:function(t,e){var n=this;if(t.length>0&&this.mapService.version===Og["GAODE2.x"]){var r=e.coordCenter||e.getSource().center;t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=Og["GAODE2.x"],t.originCoordinates=ti.exports.cloneDeep(t.coordinates),t.coordinates=n.mapService.coordToAMap2RelativeCoordinates(t.coordinates,r)}))}}},{key:"adjustData2SimpleCoordinates",value:function(t){var e=this;t.length>0&&this.mapService.version===Og.SIMPLE&&t.map((function(t){t.simpleCoordinate||(t.coordinates=e.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(t){var e=this;if("number"==typeof t[0])return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var n=[];return t.map((function(t){var r=[];t.map((function(t){r.push(e.mapService.simpleMapCoord.unproject(t))})),n.push(r)})),n}var r=[];return t.map((function(t){r.push(e.mapService.simpleMapCoord.unproject(t))})),r}},{key:"applyAttributeMapping",value:function(t,e){var n;if(!t.scale)return[];var r=(null==t||null===(n=t.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(e.hasOwnProperty(o)||"variable"===(null===(r=t.scale)||void 0===r?void 0:r.type))&&i.push(e[o])})),t.mapping?t.mapping(i):[]}},{key:"getArrowPoints",value:function(t,e){var n=Ci([e[0]-t[0],e[1]-t[1]]);return[t[0]+1e-4*n[0],t[1]+1e-4*n[1]]}}]),t}(),YI=Op(XI.prototype,"mapService",[WI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KI=Op(XI.prototype,"fontService",[ZI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qI=XI))||qI),tP=ku.injectable()(QI=function(){function t(){Ee(this,t)}return Te(t,[{key:"apply",value:function(t){var e=this;this.mapService=t.getContainer().get(Hh.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",Zt(Kt.mark((function n(){var r,i,o,a;return Kt.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.log(by,Sp.INIT),(r=t.getSource())||(i=t.sourceOption||t.defaultSourceConfig,o=i.data,a=i.options,r=new $y(o,a),t.setSource(r)),!r.inited){n.next=8;break}e.updateClusterData(t),t.log(wy,Sp.INIT),n.next=10;break;case 8:return n.next=10,new Promise((function(n){r.on("update",(function(r){"inited"===r.type&&(e.updateClusterData(t),t.log(wy,Sp.INIT)),n(null)}))}));case 10:case"end":return n.stop()}}),n)})))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",Zt(Kt.mark((function n(){var r,i,o;return Kt.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.updateClusterData(t),i=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,o=r||i,n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)}))))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var e=t.getSource(),n=e.cluster,r=e.clusterOptions.zoom,i=void 0===r?0:r,o=this.mapService.getZoom()-1,a=t.dataState.dataSourceNeedUpdate;return n&&a&&e.updateClusterData(Math.floor(o)),!!(n&&Math.abs(t.clusterZoom-o)>=1)&&(i!==Math.floor(o)&&e.updateClusterData(Math.floor(o)),t.clusterZoom=o,!0)}}]),t}())||QI;function eP(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function nP(t){var e;return 1===t.length&&(e=t,t=function(t,n){return eP(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}var rP=nP(eP).right;function iP(t){return null===t?NaN:+t}function oP(t,e){var n,r,i,o=t.length,a=-1;if(null==e){for(;++a<o;)if(null!=(n=t[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=t[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=e(t[a],a,t))&&n>=n)for(r=i=n;++a<o;)null!=(n=e(t[a],a,t))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}var aP=Math.sqrt(50),sP=Math.sqrt(10),uP=Math.sqrt(2);function lP(t,e,n){var r,i,o,a,s=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=cP(t,e,n))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(t+s)*a;else for(t=Math.floor(t*a),e=Math.ceil(e*a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(t-s)/a;return r&&o.reverse(),o}function cP(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=aP?10:o>=sP?5:o>=uP?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=aP?10:o>=sP?5:o>=uP?2:1)}function hP(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=aP?i*=10:o>=sP?i*=5:o>=uP&&(i*=2),e<t?-i:i}function pP(t,e,n){if(null==n&&(n=iP),r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),a=+n(t[o],o,t);return a+(+n(t[o+1],o+1,t)-a)*(i-o)}}function fP(t){return function(){return t}}function dP(t){return 1==(t=+t)?vP:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):fP(isNaN(e)?n:e)}}function vP(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):fP(isNaN(t)?e:t)}var mP=function t(e){var n=dP(e);function r(t,e){var r=n((t=Dr(t)).r,(e=Dr(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=vP(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);var yP,gP=(yP=function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return function(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}((n-r/e)*e,a,i,o,s)}},function(t){var e,n,r=t.length,i=new Array(r),o=new Array(r),a=new Array(r);for(e=0;e<r;++e)n=Dr(t[e]),i[e]=n.r||0,o[e]=n.g||0,a[e]=n.b||0;return i=yP(i),o=yP(o),a=yP(a),n.opacity=1,function(t){return n.r=i(t),n.g=o(t),n.b=a(t),n+""}});function _P(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function xP(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=CP(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}}function bP(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function wP(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function SP(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=CP(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var EP=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,AP=new RegExp(EP.source,"g");function TP(t,e){var n,r,i,o=EP.lastIndex=AP.lastIndex=0,a=-1,s=[],u=[];for(t+="",e+="";(n=EP.exec(t))&&(r=AP.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:wP(n,r)})),o=AP.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function CP(t,e){var n,r,i=typeof e;return null==e||"boolean"===i?fP(e):("number"===i?wP:"string"===i?(n=Lr(e))?(e=n,mP):TP:e instanceof Lr?mP:e instanceof Date?bP:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?xP:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?SP:wP:_P))(t,e)}function kP(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function MP(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function IP(t,e){switch(arguments.length){case 0:break;case 1:this.interpolator(t);break;default:this.interpolator(e).domain(t)}return this}var PP="$";function LP(){}function RP(t,e){var n=new LP;if(t instanceof LP)t.each((function(t,e){n.set(e,t)}));else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}function OP(){}LP.prototype=RP.prototype={constructor:LP,has:function(t){return PP+t in this},get:function(t){return this[PP+t]},set:function(t,e){return this[PP+t]=e,this},remove:function(t){var e=PP+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===PP&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===PP&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===PP&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===PP&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===PP&&++t;return t},empty:function(){for(var t in this)if(t[0]===PP)return!1;return!0},each:function(t){for(var e in this)e[0]===PP&&t(this[e],e.slice(1),this)}};var DP=RP.prototype;OP.prototype={constructor:OP,has:DP.has,add:function(t){return this[PP+(t+="")]=t,this},remove:DP.remove,clear:DP.clear,values:DP.keys,size:DP.size,empty:DP.empty,each:DP.each};var NP=Array.prototype,zP=NP.map,FP=NP.slice,BP={name:"implicit"};function UP(){var t=RP(),e=[],n=[],r=BP;function i(i){var o=i+"",a=t.get(o);if(!a){if(r!==BP)return r;t.set(o,a=e.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=RP();for(var r,o,a=-1,s=n.length;++a<s;)t.has(o=(r=n[a])+"")||t.set(o,e.push(r));return i},i.range=function(t){return arguments.length?(n=FP.call(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return UP(e,n).unknown(r)},MP.apply(i,arguments),i}function jP(t){return+t}var VP=[0,1];function GP(t){return t}function HP(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function WP(t){var e,n=t[0],r=t[t.length-1];return n>r&&(e=n,n=r,r=e),function(t){return Math.max(n,Math.min(r,t))}}function ZP(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=HP(i,r),o=n(a,o)):(r=HP(r,i),o=n(o,a)),function(t){return o(r(t))}}function qP(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=HP(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=rP(t,e,1,r)-1;return o[n](i[n](e))}}function XP(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function YP(){var t,e,n,r,i,o,a=VP,s=VP,u=CP,l=GP;function c(){return r=Math.min(a.length,s.length)>2?qP:ZP,i=o=null,h}function h(e){return isNaN(e=+e)?n:(i||(i=r(a.map(t),s,u)))(t(l(e)))}return h.invert=function(n){return l(e((o||(o=r(s,a.map(t),wP)))(n)))},h.domain=function(t){return arguments.length?(a=zP.call(t,jP),l===GP||(l=WP(a)),c()):a.slice()},h.range=function(t){return arguments.length?(s=FP.call(t),c()):s.slice()},h.rangeRound=function(t){return s=FP.call(t),u=kP,c()},h.clamp=function(t){return arguments.length?(l=t?WP(a):GP,h):l!==GP},h.interpolate=function(t){return arguments.length?(u=t,c()):u},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,c()}}function KP(t,e){return YP()(t,e)}function QP(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function JP(t){return(t=QP(Math.abs(t)))?t[1]:NaN}var $P,tL=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function eL(t){if(!(e=tL.exec(t)))throw new Error("invalid format: "+t);var e;return new nL({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function nL(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function rL(t,e){var n=QP(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}eL.prototype=nL.prototype,nL.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var iL={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return rL(100*t,e)},r:rL,s:function(t,e){var n=QP(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-($P=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+QP(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function oL(t){return t}var aL,sL,uL,lL=Array.prototype.map,cL=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function hL(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?oL:(e=lL.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?oL:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(lL.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"-":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=eL(t)).fill,n=t.align,h=t.sign,p=t.symbol,f=t.zero,d=t.width,v=t.comma,m=t.precision,y=t.trim,g=t.type;"n"===g?(v=!0,g="g"):iL[g]||(void 0===m&&(m=12),y=!0,g="g"),(f||"0"===e&&"="===n)&&(f=!0,e="0",n="=");var _="$"===p?i:"#"===p&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",x="$"===p?o:/[%p]/.test(g)?u:"",b=iL[g],w=/[defgprs%]/.test(g);function S(t){var i,o,u,p=_,S=x;if("c"===g)S=b(t)+S,t="";else{var E=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:b(Math.abs(t),m),y&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),E&&0==+t&&"+"!==h&&(E=!1),p=(E?"("===h?h:l:"-"===h||"("===h?"":h)+p,S=("s"===g?cL[8+$P/3]:"")+S+(E&&"("===h?")":""),w)for(i=-1,o=t.length;++i<o;)if(48>(u=t.charCodeAt(i))||u>57){S=(46===u?a+t.slice(i+1):t.slice(i))+S,t=t.slice(0,i);break}}v&&!f&&(t=r(t,1/0));var A=p.length+t.length+S.length,T=A<d?new Array(d-A+1).join(e):"";switch(v&&f&&(t=r(T+t,T.length?d-S.length:1/0),T=""),n){case"<":t=p+t+S+T;break;case"=":t=p+T+t+S;break;case"^":t=T.slice(0,A=T.length>>1)+p+t+S+T.slice(A);break;default:t=T+p+t+S}return s(t)}return m=void 0===m?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),S.toString=function(){return t+""},S}return{format:h,formatPrefix:function(t,e){var n=h(((t=eL(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(JP(e)/3))),i=Math.pow(10,-r),o=cL[8+r/3];return function(t){return n(i*t)+o}}}}function pL(t,e,n,r){var i,o=hP(t,e,n);switch((r=eL(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(JP(e)/3)))-JP(Math.abs(t)))}(o,a))||(r.precision=i),uL(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,JP(e)-JP(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-JP(Math.abs(t)))}(o))||(r.precision=i-2*("%"===r.type))}return sL(r)}function fL(t){var e=t.domain;return t.ticks=function(t){var n=e();return lP(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return pL(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i=e(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=cP(s,u,n))>0?r=cP(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=cP(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,e(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,e(i)),t},t}function dL(t,e){var n,r=0,i=(t=t.slice()).length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}function vL(t){return Math.log(t)}function mL(t){return Math.exp(t)}function yL(t){return-Math.log(-t)}function gL(t){return-Math.exp(-t)}function _L(t){return isFinite(t)?+("1e"+t):t<0?0:t}function xL(t){return function(e){return-t(-e)}}function bL(t){var e,n,r=t(vL,mL),i=r.domain,o=10;function a(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(o),n=function(t){return 10===t?_L:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(o),i()[0]<0?(e=xL(e),n=xL(n),t(yL,gL)):t(vL,mL),r}return r.base=function(t){return arguments.length?(o=+t,a()):o},r.domain=function(t){return arguments.length?(i(t),a()):i()},r.ticks=function(t){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(p=s,s=u,u=p);var l,c,h,p=e(s),f=e(u),d=null==t?10:+t,v=[];if(!(o%1)&&f-p<d){if(p=Math.round(p)-1,f=Math.round(f)+1,s>0){for(;p<f;++p)for(c=1,l=n(p);c<o;++c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else for(;p<f;++p)for(c=o-1,l=n(p);c>=1;--c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else v=lP(p,f,Math.min(f-p,d)).map(n);return r?v.reverse():v},r.tickFormat=function(t,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=sL(i)),t===1/0)return i;null==t&&(t=10);var a=Math.max(1,o*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*o<o-.5&&(r*=o),r<=a?i(t):""}},r.nice=function(){return i(dL(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r}function wL(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function SL(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function EL(t){return t<0?-t*t:t*t}function AL(t){var e=t(GP,GP),n=1;return e.exponent=function(e){return arguments.length?1===(n=+e)?t(GP,GP):.5===n?t(SL,EL):t(wL(n),wL(1/n)):n},fL(e)}aL=hL({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),sL=aL.format,uL=aL.formatPrefix;var TL=new Date,CL=new Date;function kL(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<r);return s},i.filter=function(n){return kL((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}))},n&&(i.count=function(e,r){return TL.setTime(+e),CL.setTime(+r),t(TL),t(CL),Math.floor(n(TL,CL))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var ML=kL((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));ML.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?kL((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):ML:null};var IL=ML;ML.range;var PL=1e3,LL=6e4,RL=36e5,OL=864e5,DL=6048e5,NL=kL((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*PL)}),(function(t,e){return(e-t)/PL}),(function(t){return t.getUTCSeconds()})),zL=NL;NL.range;var FL=kL((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*PL)}),(function(t,e){t.setTime(+t+e*LL)}),(function(t,e){return(e-t)/LL}),(function(t){return t.getMinutes()})),BL=FL;FL.range;var UL=kL((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*PL-t.getMinutes()*LL)}),(function(t,e){t.setTime(+t+e*RL)}),(function(t,e){return(e-t)/RL}),(function(t){return t.getHours()})),jL=UL;UL.range;var VL=kL((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*LL)/OL}),(function(t){return t.getDate()-1})),GL=VL;function HL(t){return kL((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*LL)/DL}))}VL.range;var WL=HL(0),ZL=HL(1),qL=HL(2),XL=HL(3),YL=HL(4),KL=HL(5),QL=HL(6);WL.range,ZL.range,qL.range,XL.range,YL.range,KL.range,QL.range;var JL=kL((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()})),$L=JL;JL.range;var tR=kL((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));tR.every=function(t){return isFinite(t=Math.floor(t))&&t>0?kL((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var eR=tR;tR.range;var nR=kL((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/OL}),(function(t){return t.getUTCDate()-1})),rR=nR;function iR(t){return kL((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/DL}))}nR.range;var oR=iR(0),aR=iR(1),sR=iR(2),uR=iR(3),lR=iR(4),cR=iR(5),hR=iR(6);oR.range,aR.range,sR.range,uR.range,lR.range,cR.range,hR.range;var pR=kL((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));pR.every=function(t){return isFinite(t=Math.floor(t))&&t>0?kL((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};var fR=pR;function dR(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function vR(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function mR(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}pR.range;var yR,gR,_R={"-":"",_:" ",0:"0"},xR=/^\s*\d+/,bR=/^%/,wR=/[\\^$*+?|[\]().{}]/g;function SR(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function ER(t){return t.replace(wR,"\\$&")}function AR(t){return new RegExp("^(?:"+t.map(ER).join("|")+")","i")}function TR(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function CR(t,e,n){var r=xR.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function kR(t,e,n){var r=xR.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function MR(t,e,n){var r=xR.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function IR(t,e,n){var r=xR.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function PR(t,e,n){var r=xR.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function LR(t,e,n){var r=xR.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function RR(t,e,n){var r=xR.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function OR(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function DR(t,e,n){var r=xR.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function NR(t,e,n){var r=xR.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function zR(t,e,n){var r=xR.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function FR(t,e,n){var r=xR.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function BR(t,e,n){var r=xR.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function UR(t,e,n){var r=xR.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function jR(t,e,n){var r=xR.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function VR(t,e,n){var r=xR.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function GR(t,e,n){var r=xR.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function HR(t,e,n){var r=bR.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function WR(t,e,n){var r=xR.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function ZR(t,e,n){var r=xR.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function qR(t,e){return SR(t.getDate(),e,2)}function XR(t,e){return SR(t.getHours(),e,2)}function YR(t,e){return SR(t.getHours()%12||12,e,2)}function KR(t,e){return SR(1+GL.count(eR(t),t),e,3)}function QR(t,e){return SR(t.getMilliseconds(),e,3)}function JR(t,e){return QR(t,e)+"000"}function $R(t,e){return SR(t.getMonth()+1,e,2)}function tO(t,e){return SR(t.getMinutes(),e,2)}function eO(t,e){return SR(t.getSeconds(),e,2)}function nO(t){var e=t.getDay();return 0===e?7:e}function rO(t,e){return SR(WL.count(eR(t)-1,t),e,2)}function iO(t){var e=t.getDay();return e>=4||0===e?YL(t):YL.ceil(t)}function oO(t,e){return t=iO(t),SR(YL.count(eR(t),t)+(4===eR(t).getDay()),e,2)}function aO(t){return t.getDay()}function sO(t,e){return SR(ZL.count(eR(t)-1,t),e,2)}function uO(t,e){return SR(t.getFullYear()%100,e,2)}function lO(t,e){return SR((t=iO(t)).getFullYear()%100,e,2)}function cO(t,e){return SR(t.getFullYear()%1e4,e,4)}function hO(t,e){var n=t.getDay();return SR((t=n>=4||0===n?YL(t):YL.ceil(t)).getFullYear()%1e4,e,4)}function pO(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+SR(e/60|0,"0",2)+SR(e%60,"0",2)}function fO(t,e){return SR(t.getUTCDate(),e,2)}function dO(t,e){return SR(t.getUTCHours(),e,2)}function vO(t,e){return SR(t.getUTCHours()%12||12,e,2)}function mO(t,e){return SR(1+rR.count(fR(t),t),e,3)}function yO(t,e){return SR(t.getUTCMilliseconds(),e,3)}function gO(t,e){return yO(t,e)+"000"}function _O(t,e){return SR(t.getUTCMonth()+1,e,2)}function xO(t,e){return SR(t.getUTCMinutes(),e,2)}function bO(t,e){return SR(t.getUTCSeconds(),e,2)}function wO(t){var e=t.getUTCDay();return 0===e?7:e}function SO(t,e){return SR(oR.count(fR(t)-1,t),e,2)}function EO(t){var e=t.getUTCDay();return e>=4||0===e?lR(t):lR.ceil(t)}function AO(t,e){return t=EO(t),SR(lR.count(fR(t),t)+(4===fR(t).getUTCDay()),e,2)}function TO(t){return t.getUTCDay()}function CO(t,e){return SR(aR.count(fR(t)-1,t),e,2)}function kO(t,e){return SR(t.getUTCFullYear()%100,e,2)}function MO(t,e){return SR((t=EO(t)).getUTCFullYear()%100,e,2)}function IO(t,e){return SR(t.getUTCFullYear()%1e4,e,4)}function PO(t,e){var n=t.getUTCDay();return SR((t=n>=4||0===n?lR(t):lR.ceil(t)).getUTCFullYear()%1e4,e,4)}function LO(){return"+0000"}function RO(){return"%"}function OO(t){return+t}function DO(t){return Math.floor(+t/1e3)}!function(t){yR=function(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,u=t.shortMonths,l=AR(i),c=TR(i),h=AR(o),p=TR(o),f=AR(a),d=TR(a),v=AR(s),m=TR(s),y=AR(u),g=TR(u),_={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:qR,e:qR,f:JR,g:lO,G:hO,H:XR,I:YR,j:KR,L:QR,m:$R,M:tO,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:OO,s:DO,S:eO,u:nO,U:rO,V:oO,w:aO,W:sO,x:null,X:null,y:uO,Y:cO,Z:pO,"%":RO},x={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return u[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:fO,e:fO,f:gO,g:MO,G:PO,H:dO,I:vO,j:mO,L:yO,m:_O,M:xO,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:OO,s:DO,S:bO,u:wO,U:SO,V:AO,w:TO,W:CO,x:null,X:null,y:kO,Y:IO,Z:LO,"%":RO},b={a:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=h.exec(e.slice(n));return r?(t.w=p[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=y.exec(e.slice(n));return r?(t.m=g[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=v.exec(e.slice(n));return r?(t.m=m[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return E(t,e,n,r)},d:zR,e:zR,f:GR,g:RR,G:LR,H:BR,I:BR,j:FR,L:VR,m:NR,M:UR,p:function(t,e,n){var r=l.exec(e.slice(n));return r?(t.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:DR,Q:WR,s:ZR,S:jR,u:kR,U:MR,V:IR,w:CR,W:PR,x:function(t,e,r){return E(t,n,e,r)},X:function(t,e,n){return E(t,r,e,n)},y:RR,Y:LR,Z:OR,"%":HR};function w(t,e){return function(n){var r,i,o,a=[],s=-1,u=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===t.charCodeAt(s)&&(a.push(t.slice(u,s)),null!=(i=_R[r=t.charAt(++s)])?r=t.charAt(++s):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(t.slice(u,s)),a.join("")}}function S(t,e){return function(n){var r,i,o=mR(1900,void 0,1);if(E(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=vR(mR(o.y,0,1))).getUTCDay(),r=i>4||0===i?aR.ceil(r):aR(r),r=rR.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=dR(mR(o.y,0,1))).getDay(),r=i>4||0===i?ZL.ceil(r):ZL(r),r=GL.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?vR(mR(o.y,0,1)).getUTCDay():dR(mR(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,vR(o)):dR(o)}}function E(t,e,n,r){for(var i,o,a=0,s=e.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=e.charCodeAt(a++))){if(i=e.charAt(a++),!(o=b[i in _R?e.charAt(a++):i])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=w(n,_),_.X=w(r,_),_.c=w(e,_),x.x=w(n,x),x.X=w(r,x),x.c=w(e,x),{format:function(t){var e=w(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=S(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=S(t+="",!0);return e.toString=function(){return t},e}}}(t),gR=yR.format,yR.parse,yR.utcFormat,yR.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var NO,zO,FO=1e3,BO=60*FO,UO=60*BO,jO=24*UO,VO=7*jO,GO=30*jO,HO=365*jO;function WO(t){return new Date(t)}function ZO(t){return t instanceof Date?+t:+new Date(+t)}function qO(t,e,n,r,i,o,a,s,u){var l=KP(GP,GP),c=l.invert,h=l.domain,p=u(".%L"),f=u(":%S"),d=u("%I:%M"),v=u("%I %p"),m=u("%a %d"),y=u("%b %d"),g=u("%B"),_=u("%Y"),x=[[a,1,FO],[a,5,5*FO],[a,15,15*FO],[a,30,30*FO],[o,1,BO],[o,5,5*BO],[o,15,15*BO],[o,30,30*BO],[i,1,UO],[i,3,3*UO],[i,6,6*UO],[i,12,12*UO],[r,1,jO],[r,2,2*jO],[n,1,VO],[e,1,GO],[e,3,3*GO],[t,1,HO]];function b(s){return(a(s)<s?p:o(s)<s?f:i(s)<s?d:r(s)<s?v:e(s)<s?n(s)<s?m:y:t(s)<s?g:_)(s)}function w(e,n,r,i){if(null==e&&(e=10),"number"==typeof e){var o=Math.abs(r-n)/e,a=nP((function(t){return t[2]})).right(x,o);a===x.length?(i=hP(n/HO,r/HO,e),e=t):a?(i=(a=x[o/x[a-1][2]<x[a][2]/o?a-1:a])[1],e=a[0]):(i=Math.max(hP(n,r,e),1),e=s)}return null==i?e:e.every(i)}return l.invert=function(t){return new Date(c(t))},l.domain=function(t){return arguments.length?h(zP.call(t,ZO)):h().map(WO)},l.ticks=function(t,e){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=w(t,i,o,e))?n.range(i,o+1):[],a?n.reverse():n},l.tickFormat=function(t,e){return null==e?b:u(e)},l.nice=function(t,e){var n=h();return(t=w(t,n[0],n[n.length-1],e))?h(dL(n,t)):l},l.copy=function(){return XP(l,qO(t,e,n,r,i,o,a,s,u))},l}function XO(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}var YO,KO,QO=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,JO=(kt(NO={},uy.LINEAR,(function t(){var e=KP(GP,GP);return e.copy=function(){return XP(e,t())},MP.apply(e,arguments),fL(e)})),kt(NO,uy.POWER,(function t(){var e=AL(YP());return e.copy=function(){return XP(e,t()).exponent(e.exponent())},MP.apply(e,arguments),e})),kt(NO,uy.LOG,(function t(){var e=bL(YP()).domain([1,10]);return e.copy=function(){return XP(e,t()).base(e.base())},MP.apply(e,arguments),e})),kt(NO,uy.IDENTITY,(function t(e){var n,r=[];function i(t){return null==t?n:t}return i.invert=i,i.domain=i.range=function(t){return t?(r=t,t):r},i.unknown=function(t){return t?(n=t,t):n},i.copy=function(){return t().unknown(n)},i})),kt(NO,uy.SEQUENTIAL,(function t(){var e=fL(function(){var t,e,n,r,i,o=0,a=1,s=GP,u=!1;function l(e){return isNaN(e=+e)?i:s(0===n?.5:(e=(r(e)-t)*n,u?Math.max(0,Math.min(1,e)):e))}return l.domain=function(i){return arguments.length?(t=r(o=+i[0]),e=r(a=+i[1]),n=t===e?0:1/(e-t),l):[o,a]},l.clamp=function(t){return arguments.length?(u=!!t,l):u},l.interpolator=function(t){return arguments.length?(s=t,l):s},l.unknown=function(t){return arguments.length?(i=t,l):i},function(i){return r=i,t=i(o),e=i(a),n=t===e?0:1/(e-t),l}}()(GP));return e.copy=function(){return XO(e,t())},IP.apply(e,arguments)})),kt(NO,uy.TIME,(function(){return MP.apply(qO(eR,$L,WL,GL,jL,BL,zL,IL,gR).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),kt(NO,uy.QUANTILE,(function t(){var e,n=[],r=[],i=[];function o(){var t=0,e=Math.max(1,r.length);for(i=new Array(e-1);++t<e;)i[t-1]=pP(n,t/e);return a}function a(t){return isNaN(t=+t)?e:r[rP(i,t)]}return a.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},a.domain=function(t){if(!arguments.length)return n.slice();n=[];for(var e,r=0,i=t.length;r<i;++r)null==(e=t[r])||isNaN(e=+e)||n.push(e);return n.sort(eP),o()},a.range=function(t){return arguments.length?(r=FP.call(t),o()):r.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return i.slice()},a.copy=function(){return t().domain(n).range(r).unknown(e)},MP.apply(a,arguments)})),kt(NO,uy.QUANTIZE,(function t(){var e,n=0,r=1,i=1,o=[.5],a=[0,1];function s(t){return t<=t?a[rP(o,t,0,i)]:e}function u(){var t=-1;for(o=new Array(i);++t<i;)o[t]=((t+1)*r-(t-i)*n)/(i+1);return s}return s.domain=function(t){return arguments.length?(n=+t[0],r=+t[1],u()):[n,r]},s.range=function(t){return arguments.length?(i=(a=FP.call(t)).length-1,u()):a.slice()},s.invertExtent=function(t){var e=a.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,o[0]]:e>=i?[o[i-1],r]:[o[e-1],o[e]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return t().domain([n,r]).range(a).unknown(e)},MP.apply(fL(s),arguments)})),kt(NO,uy.THRESHOLD,(function t(){var e,n=[.5],r=[0,1],i=1;function o(t){return t<=t?r[rP(n,t,0,i)]:e}return o.domain=function(t){return arguments.length?(n=FP.call(t),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(t){return arguments.length?(r=FP.call(t),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(t){var e=r.indexOf(t);return[n[e-1],n[e]]},o.unknown=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return t().domain(n).range(r).unknown(e)},MP.apply(o,arguments)})),kt(NO,uy.CAT,UP),kt(NO,uy.DIVERGING,(function t(){var e=fL(function(){var t,e,n,r,i,o,a,s=0,u=.5,l=1,c=GP,h=!1;function p(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-e)*(t<e?r:i),c(h?Math.max(0,Math.min(1,t)):t))}return p.domain=function(a){return arguments.length?(t=o(s=+a[0]),e=o(u=+a[1]),n=o(l=+a[2]),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),p):[s,u,l]},p.clamp=function(t){return arguments.length?(h=!!t,p):h},p.interpolator=function(t){return arguments.length?(c=t,p):c},p.unknown=function(t){return arguments.length?(a=t,p):a},function(a){return o=a,t=a(s),e=a(u),n=a(l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),p}}()(GP));return e.copy=function(){return XO(e,t())},IP.apply(e,arguments)})),NO),$O=ku.injectable()(zO=function(){function t(){Ee(this,t),kt(this,"scaleOptions",{})}return Te(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",Zt(Kt.mark((function e(){var i,o,a;return Kt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.log(Sy,Sp.INIT),n.scaleOptions=t.getScaleOptions(),o=r.getLayerStyleAttributes(),a=null===(i=t.getSource())||void 0===i?void 0:i.data.dataArray,!Array.isArray(a)||0!==a.length){e.next=8;break}return e.abrupt("return");case 8:n.caculateScalesForAttributes(o||[],a);case 9:t.log(Ey,Sp.INIT);case 10:case"end":return e.stop()}}),e)})))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var e=Zt(Kt.mark((function e(i){var o,a;return Kt.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",i);case 2:if(t.log(Sy,Sp.UPDATE),n.scaleOptions=t.getScaleOptions(),o=r.getLayerStyleAttributes(),a=t.getSource().data.dataArray,!Array.isArray(a)||0!==a.length){e.next=8;break}return e.abrupt("return",!0);case 8:return n.caculateScalesForAttributes(o||[],a),t.log(Ey,Sp.UPDATE),t.layerModelNeedUpdate=!0,e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!t.layerModelNeedUpdate){n.scaleOptions=t.getScaleOptions();var e=r.getLayerStyleAttributes(),i=t.getSource().data.dataArray;if((!Array.isArray(i)||0!==i.length)&&e){var o=e.filter((function(t){return t.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,e){var n=this;t.forEach((function(t){if(t.scale){var r=t.scale;r.names=n.parseFields(t.scale.field||[]);var i=[];r.names.forEach((function(r){var o;i.push(n.createScale(r,t.name,null===(o=t.scale)||void 0===o?void 0:o.values,e))})),i.some((function(t){return t.type===ly.VARIABLE}))?(r.type=ly.VARIABLE,i.forEach((function(t){var e,n;if(!r.callback&&"text"!==r.values)switch(null===(e=t.option)||void 0===e?void 0:e.type){case uy.LOG:case uy.LINEAR:case uy.POWER:if(r.values&&r.values.length>2){var i=t.scale.ticks(r.values.length);t.scale.domain(i)}r.values?t.scale.range(r.values):t.scale.range(t.option.domain);break;case uy.QUANTILE:case uy.QUANTIZE:case uy.THRESHOLD:t.scale.range(r.values);break;case uy.IDENTITY:break;case uy.CAT:r.values?t.scale.range(r.values):t.scale.range(t.option.domain);break;case uy.DIVERGING:case uy.SEQUENTIAL:t.scale.interpolator(gP(r.values))}"text"===r.values&&t.scale.range(null===(n=t.option)||void 0===n?void 0:n.domain)}))):(r.type=ly.CONSTANT,r.defaultValues=i.map((function(t,e){return t.scale(r.names[e])}))),r.scalers=i.map((function(t){return{field:t.field,func:t.scale,option:t.option}})),t.needRescale=!1}}))}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:ti.exports.isString(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,e,n,r){var i,o,a=this.scaleOptions[e]&&(null===(i=this.scaleOptions[e])||void 0===i?void 0:i.field)===t?this.scaleOptions[e]:this.scaleOptions[t],s={field:t,scale:void 0,type:ly.VARIABLE,option:a};if(!r||!r.length)return a&&a.type?s.scale=this.createDefaultScale(a):(s.scale=UP([t]),s.type=ly.CONSTANT),s;var u=null===(o=r.find((function(e){return!ti.exports.isNil(e[t])})))||void 0===o?void 0:o[t];if(this.isNumber(t)||ti.exports.isNil(u)&&!a)s.scale=UP([t]),s.type=ly.CONSTANT;else{var l=a&&a.type||this.getDefaultType(u);"text"===n&&(l=uy.CAT);var c=this.createScaleConfig(l,t,a,r);s.scale=this.createDefaultScale(c),s.option=c}return s}},{key:"getDefaultType",value:function(t){var e=uy.LINEAR;return"string"==typeof t&&(e=QO.test(t)?uy.TIME:uy.CAT),e}},{key:"createScaleConfig",value:function(t,e,n,r){var i={type:t},o=(null==r?void 0:r.map((function(t){return t[e]})))||[];if(null!=n&&n.domain)i.domain=null==n?void 0:n.domain;else if(t===uy.CAT||t===uy.IDENTITY)i.domain=ti.exports.uniq(o);else if(t===uy.QUANTILE)i.domain=o;else if(t===uy.DIVERGING){var a=oP(o),s=void 0!==(null==n?void 0:n.neutral)?null==n?void 0:n.neutral:(a[0]+a[1])/2;i.domain=[a[0],s,a[1]]}else i.domain=oP(o);return It(It({},i),n)}},{key:"createDefaultScale",value:function(t){var e=t.type,n=t.domain,r=t.unknown,i=t.clamp,o=t.nice,a=JO[e]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),t}())||zO,tD=ku.injectable()(YO=function(){function t(){Ee(this,t)}return Te(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){t.animateStatus&&t.models.forEach((function(e){e.addUniforms(It({},t.layerModel.getAnimateUniforms()))}))}))}}]),t}())||YO,eD=ku.injectable()(KO=function(){function t(){Ee(this,t)}return Te(t,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",(function(){var e,n=t.getLayerConfig(),r=n.maskLayers,i=n.enableMask;!t.tileLayer&&r&&r.length>0&&((e=t.masks).push.apply(e,At(r)),t.updateLayerConfig({mask:i}))}))}}]),t}())||KO,nD=function(){function t(e){var n=e.rendererService,r=e.layerService,i=e.parent;Ee(this,t),kt(this,"tileResource",new Map),kt(this,"layerTiles",[]),this.rendererService=n,this.layerService=r,this.parent=i}var e;return Te(t,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some((function(e){return e.key===t}))}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find((function(e){return e.key===t}))}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find((function(e){return e.isLoaded&&e.visible&&e.lnglatInBounds(t)}))}},{key:"removeTile",value:function(t){var e=this.layerTiles.findIndex((function(e){return e.key===t})),n=this.layerTiles.splice(e,1);n[0]&&n[0].destroy()}},{key:"updateTileVisible",value:function(t){var e=this.getTile(t.key);null==e||e.updateVisible(t.isVisible)}},{key:"isParentLoaded",value:function(t){var e=t.parent;if(!e)return!0;var n=this.getTile(null==e?void 0:e.key);return!(null==n||!n.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var e=this,n=null==t?void 0:t.children;return 0===n.length||n.some((function(t){var n=e.getTile(null==t?void 0:t.key);return!1===(null==n?void 0:n.isLoaded)}))}},{key:"render",value:(e=Zt(Kt.mark((function t(){var e,n,r=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getRenderLayers(),n=e.map(function(){var t=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.layerService.renderTileLayer(e);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=4,Promise.all(n);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter((function(t){return t.visible&&t.isLoaded})),e=[];return t.map((function(t){return e.push.apply(e,At(t.getLayers()))})),e}},{key:"getLayers",value:function(){var t=this.layerTiles.filter((function(t){return t.isLoaded})),e=[];return t.map((function(t){return e.push.apply(e,At(t.getLayers()))})),e}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach((function(t){return t.destroy()})),this.tileResource.clear()}}]),t}(),rD={exports:{}};!function(t,e){t.exports=function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}
/**
       * splaytree v3.1.0
       * Fast Splay tree for Node and browser
       *
       * @author Alexander Milevski <info@w8r.name>
       * @license MIT
       * @preserve
       */var r=function(){function t(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}return t}();function i(t,e){return t>e?1:t<e?-1:0}function o(t,e,n){for(var i=new r(null,null),o=i,a=i;;){var s=n(t,e.key);if(s<0){if(null===e.left)break;if(n(t,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,null===(e=u).left)break}a.left=e,a=e,e=e.left}else{if(!(s>0))break;if(null===e.right)break;if(n(t,e.right.key)>0&&(u=e.right,e.right=u.left,u.left=e,null===(e=u).right))break;o.right=e,o=e,e=e.right}}return o.right=e.left,a.left=e.right,e.left=i.right,e.right=i.left,e}function a(t,e,n,i){var a=new r(t,e);if(null===n)return a.left=a.right=null,a;var s=i(t,(n=o(t,n,i)).key);return s<0?(a.left=n.left,a.right=n,n.left=null):s>=0&&(a.right=n.right,a.left=n,n.right=null),a}function s(t,e,n){var r=null,i=null;if(e){var a=n((e=o(t,e,n)).key,t);0===a?(r=e.left,i=e.right):a<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function u(t,e,n){return null===e?t:(null===t||((e=o(t.key,e,n)).left=t),e)}function l(t,e,n,r,i){if(t){r(e+(n?"└── ":"├── ")+i(t)+"\n");var o=e+(n?"    ":"│   ");t.left&&l(t.left,o,!1,r,i),t.right&&l(t.right,o,!0,r,i)}}var c=function(){function t(t){void 0===t&&(t=i),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=a(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var n=new r(t,e);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,a=o(t,this._root,i),s=i(t,a.key);return 0===s?this._root=a:(s<0?(n.left=a.left,n.right=a,a.left=null):s>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,n){var r;return null===e?null:0===n(t,(e=o(t,e,n)).key)?(null===e.left?r=e.right:(r=o(t,e.left,n)).right=e.right,this._size--,r):e},t.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=o(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=o(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this},t.prototype.range=function(t,e,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,e)>0)break;if(o(a.key,t)>=0&&n.call(r,a))return this;a=a.right}return this},t.prototype.keys=function(){var t=[];return this.forEach((function(e){var n=e.key;return t.push(n)})),t},t.prototype.values=function(){var t=[];return this.forEach((function(e){var n=e.data;return t.push(n)})),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},t.prototype.at=function(t){for(var e=this._root,n=!1,r=0,i=[];!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null},t.prototype.next=function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n},t.prototype.prev=function(t){var e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return f(this._root)},t.prototype.load=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!1);var r=t.length,i=this._comparator;if(n&&m(t,e,0,r-1,i),null===this._root)this._root=h(t,e,0,r),this._size=r;else{var o=v(this.toList(),p(t,e),i);r=this._size+r,this._root=d({head:o},0,r)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return l(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},t.prototype.update=function(t,e,n){var r=this._comparator,i=s(t,this._root,r),o=i.left,l=i.right;r(t,e)<0?l=a(e,n,l,r):o=a(e,n,o,r),this._root=u(o,l,r)},t.prototype.split=function(t){return s(t,this._root,this._comparator)},t}();function h(t,e,n,i){var o=i-n;if(o>0){var a=n+Math.floor(o/2),s=t[a],u=e[a],l=new r(s,u);return l.left=h(t,e,n,a),l.right=h(t,e,a+1,i),l}return null}function p(t,e){for(var n=new r(null,null),i=n,o=0;o<t.length;o++)i=i.next=new r(t[o],e[o]);return i.next=null,n.next}function f(t){for(var e=t,n=[],i=!1,o=new r(null,null),a=o;!i;)e?(n.push(e),e=e.left):n.length>0?e=(e=a=a.next=n.pop()).right:i=!0;return a.next=null,o.next}function d(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),o=d(t,e,i),a=t.head;return a.left=o,t.head=t.head.next,a.right=d(t,i+1,n),a}return null}function v(t,e,n){for(var i=new r(null,null),o=i,a=t,s=e;null!==a&&null!==s;)n(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}function m(t,e,n,r,i){if(!(n>=r)){for(var o=t[n+r>>1],a=n-1,s=r+1;;){do{a++}while(i(t[a],o)<0);do{s--}while(i(t[s],o)>0);if(a>=s)break;var u=t[a];t[a]=t[s],t[s]=u,u=e[a],e[a]=e[s],e[s]=u}m(t,e,n,s,i),m(t,e,s+1,r,i)}}var y=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},g=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},_=Number.EPSILON;void 0===_&&(_=Math.pow(2,-52));var x=_*_,b=function(t,e){if(-_<t&&t<_&&-_<e&&e<_)return 0;var n=t-e;return n*n<x*t*e?0:t<e?-1:1},w=function(){function e(){t(this,e),this.reset()}return n(e,[{key:"reset",value:function(){this.xRounder=new S,this.yRounder=new S}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),e}(),S=function(){function e(){t(this,e),this.tree=new c,this.round(0)}return n(e,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===b(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===b(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),e}(),E=new w,A=function(t,e){return t.x*e.y-t.y*e.x},T=function(t,e){return t.x*e.x+t.y*e.y},C=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=A(r,i);return b(o,0)},k=function(t){return Math.sqrt(T(t,t))},M=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return A(i,r)/k(i)/k(r)},I=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return T(i,r)/k(i)/k(r)},P=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},L=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},R=function(t,e,n,r){if(0===e.x)return L(n,r,t.x);if(0===r.x)return L(t,e,n.x);if(0===e.y)return P(n,r,t.y);if(0===r.y)return P(t,e,n.y);var i=A(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},a=A(o,e)/i,s=A(o,r)/i;return{x:(t.x+s*e.x+(n.x+a*r.x))/2,y:(t.y+s*e.y+(n.y+a*r.y))/2}},O=function(){function e(n,r){t(this,e),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=r}return n(e,null,[{key:"compare",value:function(t,n){var r=e.comparePoints(t.point,n.point);return 0!==r?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:N.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),n(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i=r.otherSE;n.set(r,{sine:M(e.point,t.point,i.point),cosine:I(e.point,t.point,i.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,a=i.cosine,s=n.get(e),u=s.sine,l=s.cosine;return o>=0&&u>=0?a<l?1:a>l?-1:0:o<0&&u<0?a<l?-1:a>l?1:0:u<o?-1:u>o?1:0}}}]),e}(),D=0,N=function(){function e(n,r,i,o){t(this,e),this.id=++D,this.leftSE=n,n.segment=this,n.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=n,this.rings=i,this.windings=o}return n(e,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var a=t.leftSE.point.y,s=e.leftSE.point.y,u=t.rightSE.point.y,l=e.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;var c=t.comparePoint(e.leftSE.point);if(c<0)return 1;if(c>0)return-1;var h=e.comparePoint(t.rightSE.point);return 0!==h?h:-1}if(n>r){if(a<s&&a<l)return-1;if(a>s&&a>l)return 1;var p=e.comparePoint(t.leftSE.point);if(0!==p)return p;var f=t.comparePoint(e.rightSE.point);return f<0?1:f>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){var d=e.comparePoint(t.rightSE.point);if(0!==d)return d}if(i>o){var v=t.comparePoint(e.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(i!==o){var m=u-a,y=i-n,g=l-s,_=o-r;if(m>y&&g<_)return 1;if(m<y&&g>_)return-1}return i>o?1:i<o||u<l?-1:u>l?1:t.id<e.id?-1:t.id>e.id?1:0}}]),n(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;var a=(t.x-e.x)/r.x,s=e.y+a*r.y;return t.y===s?0:t.y<s?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),n=t.bbox(),r=g(e,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,s=t.rightSE.point,u=y(e,a)&&0===this.comparePoint(a),l=y(n,i)&&0===t.comparePoint(i),c=y(e,s)&&0===this.comparePoint(s),h=y(n,o)&&0===t.comparePoint(o);if(l&&u)return h&&!c?o:!h&&c?s:null;if(l)return c&&i.x===s.x&&i.y===s.y?null:i;if(u)return h&&o.x===a.x&&o.y===a.y?null:a;if(h&&c)return null;if(h)return o;if(c)return s;var p=R(i,this.vector(),a,t.vector());return null===p?null:y(r,p)?E.round(p.x,p.y):null}},{key:"split",value:function(t){var n=[],r=void 0!==t.events,i=new O(t,!0),o=new O(t,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var s=new e(i,a,this.rings.slice(),this.windings.slice());return O.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),O.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(t){for(var n=this,r=t;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=e.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var a=n;n=r,r=a}for(var s=0,u=r.rings.length;s<u;s++){var l=r.rings[s],c=r.windings[s],h=n.rings.indexOf(l);-1===h?(n.rings.push(l),n.windings.push(c)):n.windings[h]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var a=this.rings[i],s=this.windings[i],u=e.indexOf(a);-1===u?(e.push(a),n.push(s)):n[u]+=s}for(var l=[],c=[],h=0,p=e.length;h<p;h++)if(0!==n[h]){var f=e[h],d=f.poly;if(-1===c.indexOf(d))if(f.isExterior)l.push(d);else{-1===c.indexOf(d)&&c.push(d);var v=l.indexOf(f.poly);-1!==v&&l.splice(v,1)}}for(var m=0,y=l.length;m<y;m++){var g=l[m].multiPoly;-1===r.indexOf(g)&&r.push(g)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(q.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===q.numMultiPolys&&i<o;break;case"xor":var a=Math.abs(t.length-e.length);this._isInResult=a%2==1;break;case"difference":var s=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=s(t)!==s(e);break;default:throw new Error("Unrecognized operation type found ".concat(q.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,r){var i,o,a,s=O.comparePoints(t,n);if(s<0)i=t,o=n,a=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));i=n,o=t,a=-1}return new e(new O(i,!0),new O(o,!1),[r],[a])}}]),e}(),z=function(){function e(n,r,i){if(t(this,e),!Array.isArray(n)||0===n.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],"number"!=typeof n[0][0]||"number"!=typeof n[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=E.round(n[0][0],n[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var a=o,s=1,u=n.length;s<u;s++){if("number"!=typeof n[s][0]||"number"!=typeof n[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=E.round(n[s][0],n[s][1]);l.x===a.x&&l.y===a.y||(this.segments.push(N.fromRing(a,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),a=l)}o.x===a.x&&o.y===a.y||this.segments.push(N.fromRing(a,o,this))}return n(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),e}(),F=function(){function e(n,r){if(t(this,e),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new z(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,o=n.length;i<o;i++){var a=new z(n[i],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=r}return n(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),e}(),B=function(){function e(n,r){if(t(this,e),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof n[0][0][0]&&(n=[n])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,o=n.length;i<o;i++){var a=new F(n[i],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=r}return n(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),e}(),U=function(){function e(n){t(this,e),this.events=n;for(var r=0,i=n.length;r<i;r++)n[r].segment.ringOut=this;this.poly=null}return n(e,null,[{key:"factory",value:function(t){for(var n=[],r=0,i=t.length;r<i;r++){var o=t[r];if(o.isInResult()&&!o.ringOut){for(var a=null,s=o.leftSE,u=o.rightSE,l=[s],c=s.point,h=[];a=s,s=u,l.push(s),s.point!==c;)for(;;){var p=s.getAvailableLinkedEvents();if(0===p.length){var f=l[0].point,d=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(f.x,",")+" ".concat(f.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===p.length){u=p[0].otherSE;break}for(var v=null,m=0,y=h.length;m<y;m++)if(h[m].point===s.point){v=m;break}if(null===v){h.push({index:l.length,point:s.point});var g=s.getLeftmostComparator(a);u=p.sort(g)[0].otherSE;break}var _=h.splice(v)[0],x=l.splice(_.index);x.unshift(x[0].otherSE),n.push(new e(x.reverse()))}n.push(new e(l))}}return n}}]),n(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==C(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var a=e[0],s=e[1];0===C(a,t,s)&&e.shift(),e.push(e[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:e.length-1,c=this.isExteriorRing()?e.length:-1,h=[],p=l;p!=c;p+=u)h.push([e[p].x,e[p].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];O.compare(t,r)>0&&(t=r)}for(var i=t.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),e}(),j=function(){function e(n){t(this,e),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),e}(),V=function(){function e(n){t(this,e),this.rings=n,this.polys=this._composePolys(n)}return n(e,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new j(i));else{var o=i.enclosingRing();o.poly||e.push(new j(o)),o.poly.addInterior(i)}}return e}}]),e}(),G=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.compare;t(this,e),this.queue=n,this.tree=new c(r),this.segments=[]}return n(e,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,a=void 0,s=void 0;void 0===a;)null===(i=this.tree.prev(i))?a=null:void 0===i.key.consumedBy&&(a=i.key);for(;void 0===s;)null===(o=this.tree.next(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);if(t.isLeft){var u=null;if(a){var l=a.getIntersection(e);if(null!==l&&(e.isAnEndpoint(l)||(u=l),!a.isAnEndpoint(l)))for(var c=this._splitSafely(a,l),h=0,p=c.length;h<p;h++)n.push(c[h])}var f=null;if(s){var d=s.getIntersection(e);if(null!==d&&(e.isAnEndpoint(d)||(f=d),!s.isAnEndpoint(d)))for(var v=this._splitSafely(s,d),m=0,y=v.length;m<y;m++)n.push(v[m])}if(null!==u||null!==f){var g=null;g=null===u?f:null===f||O.comparePoints(u,f)<=0?u:f,this.queue.remove(e.rightSE),n.push(e.rightSE);for(var _=e.split(g),x=0,b=_.length;x<b;x++)n.push(_[x])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=a)}else{if(a&&s){var w=a.getIntersection(s);if(null!==w){if(!a.isAnEndpoint(w))for(var S=this._splitSafely(a,w),E=0,A=S.length;E<A;E++)n.push(S[E]);if(!s.isAnEndpoint(w))for(var T=this._splitSafely(s,w),C=0,k=T.length;C<k;C++)n.push(T[C])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),e}(),H="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,W="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Z=function(){function e(){t(this,e)}return n(e,[{key:"run",value:function(t,e,n){q.type=t,E.reset();for(var r=[new B(e,!0)],i=0,o=n.length;i<o;i++)r.push(new B(n[i],!1));if(q.numMultiPolys=r.length,"difference"===q.type)for(var a=r[0],s=1;s<r.length;)null!==g(r[s].bbox,a.bbox)?s++:r.splice(s,1);if("intersection"===q.type)for(var u=0,l=r.length;u<l;u++)for(var h=r[u],p=u+1,f=r.length;p<f;p++)if(null===g(h.bbox,r[p].bbox))return[];for(var d=new c(O.compare),v=0,m=r.length;v<m;v++)for(var y=r[v].getSweepEvents(),_=0,x=y.length;_<x;_++)if(d.insert(y[_]),d.size>H)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var b=new G(d),w=d.size,S=d.pop();S;){var A=S.key;if(d.size===w){var T=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(T.id," ")+"[".concat(T.leftSE.point.x,", ").concat(T.leftSE.point.y,"] -> ")+"[".concat(T.rightSE.point.x,", ").concat(T.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(d.size>H)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(b.segments.length>W)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var C=b.process(A),k=0,M=C.length;k<M;k++){var I=C[k];void 0===I.consumedBy&&d.insert(I)}w=d.size,S=d.pop()}E.reset();var P=U.factory(b.segments);return new V(P).getGeom()}}]),e}(),q=new Z,X=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q.run("union",t,n)},Y=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q.run("intersection",t,n)},K=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q.run("xor",t,n)},Q=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q.run("difference",t,n)},J={union:X,intersection:Y,xor:K,difference:Q};return J}()}(rD);var iD=rD.exports;function oD(t,e,n){void 0===n&&(n={});var r=jt(t),i=jt(e),o=iD.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?zt(o[0],n.properties):function(t,e,n){return void 0===n&&(n={}),Nt({type:"MultiPolygon",coordinates:t},e,n)}(o,n.properties)}var aD=function(){function t(){Ee(this,t)}return Te(t,[{key:"getCombineFeature",value:function(t){var e=null,n=t[0];return t.map((function(t){var n=zt(t.coordinates);e=null===e?n:oD(e,n)})),n&&(e.properties=It({},n)),e}}]),t}(),sD="select",uD="active",lD=function(){function t(e){var n=e.layerService,r=e.tileLayerService,i=e.parent;Ee(this,t),kt(this,"tilePickID",new Map),this.layerService=n,this.tileLayerService=r,this.parent=i,this.tileSourceService=new aD}return Te(t,[{key:"pickRender",value:function(t){var e=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(e){var n=e.getMainLayer();null==n||n.layerPickService.pickRender(t)}}},{key:"pick",value:function(t,e){var n=this.parent.getContainer().get(Hh.IPickingService);if("RasterLayer"===t.type){var r=this.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(r&&void 0!==r.getMainLayer()){var i=r.getMainLayer();return i.layerPickService.pickRasterLayer(i,e,this.parent)}return!1}return this.pickRender(e),n.pickFromPickingFBO(t,e)}},{key:"selectFeature",value:function(t){var e=$r(t,3),n=e[0],r=e[1],i=e[2],o=this.color2PickId(n,r,i);this.tilePickID.set(sD,o),this.updateHighLight(n,r,i,sD)}},{key:"highlightPickedFeature",value:function(t){var e=$r(t,3),n=e[0],r=e[1],i=e[2],o=this.color2PickId(n,r,i);this.tilePickID.set(uD,o),this.updateHighLight(n,r,i,uD)}},{key:"updateHighLight",value:function(t,e,n,r){this.tileLayerService.tiles.map((function(i){var o=i.getMainLayer();switch(r){case sD:null==o||o.hooks.beforeSelect.call([t,e,n]);break;case uD:null==o||o.hooks.beforeHighlight.call([t,e,n])}}))}},{key:"setPickState",value:function(){var t=this.tilePickID.get(sD),e=this.tilePickID.get(uD);if(t){var n=$r(this.pickId2Color(t),3),r=n[0],i=n[1],o=n[2];this.updateHighLight(r,i,o,sD)}else if(e){var a=$r(this.pickId2Color(e),3),s=a[0],u=a[1],l=a[2];this.updateHighLight(s,u,l,uD)}else;}},{key:"color2PickId",value:function(t,e,n){return Wr(new Uint8Array([t,e,n]))}},{key:"pickId2Color",value:function(t){return Zr(t)}},{key:"getFeatureById",value:function(t){var e=this.tileLayerService.getTiles().filter((function(t){return t.visible})),n=[];return e.forEach((function(e){n.push.apply(n,At(e.getFeatureById(t)))})),n}},{key:"pickRasterLayer",value:function(t,e,n){return!1}}]),t}(),cD=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"];var hD=function(){function t(e,n){Ee(this,t),kt(this,"visible",!0),kt(this,"layers",[]),kt(this,"isLoaded",!1),kt(this,"tileMaskLayers",[]),this.parent=n,this.sourceTile=e,this.x=e.x,this.y=e.y,this.z=e.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}var e,n,r;return Te(t,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(t){var e=$r(this.sourceTile.bounds,4),n=e[0],r=e[1],i=e[2],o=e[3],a=t.lng,s=t.lat;return a>=n&&a<=i&&s>=r&&s<=o}},{key:"getLayerOptions",value:function(){var t,e,n=this.parent.getLayerConfig();return It(It({},n),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:(e=this.parent.type,-1!==["PolygonLayer","LineLayer"].indexOf(e)),mask:n.mask||0!==(null===(t=n.maskLayers)||void 0===t?void 0:t.length)&&n.enableMask})}},{key:"getMaskLayer",value:function(){var t=this,e=this.parent.getLayerConfig().maskLayers,n=[];return null==e||e.forEach((function(e){if(!e.tileLayer)return n.push(e),e;var r=e.tileLayer.getTile(t.sourceTile.key),i=null==r?void 0:r.getLayers()[0];i&&n.push(i)})),n}},{key:"addTileMask",value:(r=Zt(Kt.mark((function t(){var e,n,r;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new kI({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill"),n=sy(this.parent.sceneContainer),e.setContainer(n,this.parent.sceneContainer),t.next=5,e.init();case 5:return this.tileMask=e,void 0!==(r=this.getMainLayer())&&(r.tileMask=e),t.abrupt("return",e);case 9:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"addMask",value:(n=Zt(Kt.mark((function t(e,n){var r;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=sy(this.parent.sceneContainer),n.setContainer(r,this.parent.sceneContainer),t.next=4,n.init();case 4:e.addMask(n),this.tileMaskLayers.push(n);case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"addLayer",value:(e=Zt(Kt.mark((function t(e){var n;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isTileLayer=!0,n=sy(this.parent.sceneContainer),e.setContainer(n,this.parent.sceneContainer),this.layers.push(e),t.next=6,e.init();case 6:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"updateVisible",value:function(t){this.visible=t,this.updateOptions("visible",t)}},{key:"updateOptions",value:function(t,e){this.layers.forEach((function(n){n.updateLayerConfig(kt({},t,e))}))}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(t){return[]}},{key:"getFeatureById",value:function(t){return[]}},{key:"destroy",value:function(){var t;null===(t=this.tileMask)||void 0===t||t.destroy(),this.layers.forEach((function(t){return t.destroy()}))}}]),t}();function pD(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var fD=function(t){Oe(r,t);var e,n=pD(r);function r(){return Ee(this,r),n.apply(this,arguments)}return Te(r,[{key:"initTileLayer",value:(e=Zt(Kt.mark((function t(){var e,n,r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getSourceOption(),n=e.data.features[0].properties,r=(new TM).source(e.data,e.options).size(1).shape("line").color("red"),i=new yI({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),t.next=6,this.addLayer(r);case 6:return t.next=8,this.addLayer(i);case 8:this.isLoaded=!0;case 9:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:t.transforms}}}}]),r}(hD);function dD(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var vD=function(t){Oe(r,t);var e,n=dD(r);function r(){return Ee(this,r),n.apply(this,arguments)}return Te(r,[{key:"initTileLayer",value:(e=Zt(Kt.mark((function t(){var e,n,r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new Jk(It({},n)).source(r.data,r.options),e&&Object.keys(e).forEach((function(t){var n,r,o=t;i[o](null===(n=e[o])||void 0===n?void 0:n.field,null===(r=e[o])||void 0===r?void 0:r.values)})),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(hD);function mD(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var yD=function(t){Oe(r,t);var e,n=mD(r);function r(){return Ee(this,r),n.apply(this,arguments)}return Te(r,[{key:"initTileLayer",value:(e=Zt(Kt.mark((function t(){var e,n,r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new JI(It({},n)).source(r.data,r.options),e&&Object.keys(e).forEach((function(t){var n,r,o=t;i[o](null===(n=e[o])||void 0===n?void 0:n.field,null===(r=e[o])||void 0===r?void 0:r.values)})),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getFeatures",value:function(t){return t?this.sourceTile.data.getTileData(t):[]}},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.parent.getLayerConfig(),n=e.sourceLayer,r=e.featureId;return{data:{type:"FeatureCollection",features:this.getFeatures(n)},options:{parser:{type:"geojson",featureId:r},transforms:t.transforms}}}}]),r}(hD),gD=["rasterData"];function _D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var xD=function(t){Oe(r,t);var e,n=_D(r);function r(){return Ee(this,r),n.apply(this,arguments)}return Te(r,[{key:"initTileLayer",value:(e=Zt(Kt.mark((function t(){var e,n,r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new BI(It({},n)).source(r.data,r.options),e&&Object.keys(e).forEach((function(t){var n,r,o=t;i[o](null===(n=e[o])||void 0===n?void 0:n.field,null===(r=e[o])||void 0===r?void 0:r.values)})),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.sourceTile.data.data,n=e.rasterData,r=Wf(e,gD);return{data:n,options:{parser:It({type:"rasterRgb",extent:this.sourceTile.bounds},r),transforms:t.transforms}}}}]),r}(hD);function bD(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var wD=function(t){Oe(r,t);var e,n=bD(r);function r(){return Ee(this,r),n.apply(this,arguments)}return Te(r,[{key:"initTileLayer",value:(e=Zt(Kt.mark((function t(){var e,n,r,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new BI(It({},n)).source(r.data,r.options),e&&Object.keys(e).forEach((function(t){var n,r,o=t;i[o](null===(n=e[o])||void 0===n?void 0:n.field,null===(r=e[o])||void 0===r?void 0:r.values)})),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(hD),SD=["rasterData"];function ED(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var AD={positions:[0,1],colors:["#000","#fff"]},TD=function(t){Oe(r,t);var e,n=ED(r);function r(){return Ee(this,r),n.apply(this,arguments)}return Te(r,[{key:"initTileLayer",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o,a,s;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=this.getLayerOptions(),o=i.rampColors,a=i.domain,this.colorTexture=this.parent.textureService.getColorTexture(o,a),s=new BI(It(It({},n),{},{colorTexture:this.colorTexture})).source(r.data,r.options),e&&Object.keys(e).forEach((function(t){var n,r,i=t;s[i](null===(n=e[i])||void 0===n?void 0:n.field,null===(r=e[i])||void 0===r?void 0:r.values)})),t.next=9,this.addLayer(s);case 9:this.isLoaded=!0;case 10:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.sourceTile.data.data,n=e.rasterData,r=Wf(e,SD);return{data:n,options:{parser:It({type:"raster",extent:this.sourceTile.bounds},r),transforms:t.transforms}}}},{key:"styleUpdate",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=n,o=i.rampColors,a=void 0===o?AD:o,s=i.domain;this.colorTexture=this.parent.textureService.getColorTexture(a,s||Yr(a)),this.layers.forEach((function(e){return e.style({colorTexture:t.colorTexture})}))}},{key:"destroy",value:function(){this.layers.forEach((function(t){return t.destroy()}))}}]),r}(hD);function CD(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var kD=function(t){Oe(r,t);var e,n=CD(r);function r(){return Ee(this,r),n.apply(this,arguments)}return Te(r,[{key:"initTileLayer",value:(e=Zt(Kt.mark((function t(){var e,n,r,i,o;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),a=this.parent.type,r="PolygonLayer"===a?kI:"LineLayer"===a?TM:yI,i=this.getSourceOption()){t.next=7;break}return this.isLoaded=!0,t.abrupt("return");case 7:return o=new r(It({},n)).source(i.data,i.options),Object.keys(e).forEach((function(t){var n,r,i=t;o[i](null===(n=e[i])||void 0===n?void 0:n.field,null===(r=e[i])||void 0===r?void 0:r.values)})),t.next=11,this.addLayer(o);case 11:if(!n.tileMask){t.next=14;break}return t.next=14,this.addTileMask();case 14:this.setLayerMinMaxZoom(o),this.isLoaded=!0;case 16:case"end":return t.stop()}var a}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.parent.getLayerConfig(),n=e.sourceLayer,r=void 0===n?"defaultLayer":n,i=e.featureId,o=void 0===i?"id":i;return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:o},transforms:t.transforms}}}},{key:"setLayerMinMaxZoom",value:function(t){"text"===t.getModelType()&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(t){return this.sourceTile.data.getTileData(t)}},{key:"getFeatureById",value:function(t){var e=this.getMainLayer();return e?e.getSource().data.dataArray.filter((function(e){return e._id===t})):[]}}]),r}(hD);function MD(t){switch(t.type){case"PolygonLayer":case"LineLayer":case"PointLayer":return kD;case"TileDebugLayer":return fD;case"MaskLayer":return yD;case"RasterLayer":switch(t.getSource().parser.dataType){case My.RGB:case My.CUSTOMRGB:return xD;case My.ARRAYBUFFER:case My.CUSTOMARRAYBUFFER:return TD;case My.TERRAINRGB:case My.CUSTOMTERRAINRGB:return wD;default:return vD}default:return kD}}var ID,PD,LD,RD=function(){function t(e){var n=this;Ee(this,t),kt(this,"initedTileset",!1),kt(this,"mapchange",(function(){var t,e=n.getCurrentView(),r=e.latLonBounds,i=e.zoom;if("GAODE1.x"===n.mapService.version){var o=n.parent.getLayerConfig().visible;i<2&&o?(n.parent.updateLayerConfig({visible:!1}),n.layerService.reRender()):i>=2&&!o&&(n.parent.updateLayerConfig({visible:!0}),n.layerService.reRender())}n.lastViewStates&&n.lastViewStates.zoom===i&&n.lastViewStates.latLonBounds.toString()===r.toString()||(n.lastViewStates={zoom:i,latLonBounds:r},null===(t=n.tilesetManager)||void 0===t||t.throttleUpdate(i,r))})),kt(this,"viewchange",ti.exports.debounce(this.mapchange,24)),this.parent=e;var r=this.parent.getContainer();this.rendererService=r.get(Hh.IRendererService),this.layerService=r.get(Hh.ILayerService),this.mapService=r.get(Hh.IMapService),this.pickingService=r.get(Hh.IPickingService),this.tileLayerService=new nD({rendererService:this.rendererService,layerService:this.layerService,parent:e}),this.tilePickService=new lD({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:e}),this.parent.setLayerPickService(this.tilePickService),this.proxy(e),this.initTileSetManager()}var e;return Te(t,[{key:"initTileSetManager",value:function(){var t,e=this.parent.getSource();this.tilesetManager=e.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(t=this.tilesetManager)||void 0===t||t.update(i,r)}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds();return{latLonBounds:[t[0][0],t[0][1],t[1][0],t[1][1]],zoom:this.mapService.getZoom()}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",(function(t){})),this.tilesetManager.on("tile-unload",(function(e){t.tileUnLoad(e)})),this.tilesetManager.on("tile-error",(function(e,n){t.tileError(e)})),this.tilesetManager.on("tile-update",(function(){t.tileUpdate()})),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(t=this.tilesetManager)||void 0===t||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var t;this.tilesetManager.clear();var e=this.getCurrentView(),n=e.latLonBounds,r=e.zoom;null===(t=this.tilesetManager)||void 0===t||t.update(r,n)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:(e=Zt(Kt.mark((function t(){var e,n,r=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.tilesetManager){t.next=2;break}return t.abrupt("return");case 2:return e=this.parent.getMinZoom(),n=this.parent.getMaxZoom(),t.next=6,Promise.all(this.tilesetManager.tiles.filter((function(t){return t.isLoaded})).filter((function(t){return t.isVisibleChange})).filter((function(t){return t.data})).filter((function(t){return t.z>=e&&t.z<n})).map(function(){var t=Zt(Kt.mark((function t(e){var n,i;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.tileLayerService.hasTile(e.key)){t.next=9;break}return n=MD(r.parent),i=new n(e,r.parent),t.next=5,i.initTileLayer();case 5:r.tilePickService.setPickState(),0!==i.getLayers().length&&(r.tileLayerService.addTile(i),r.tileLayerService.updateTileVisible(e),r.layerService.reRender()),t.next=12;break;case 9:r.tileLayerService.updateTileVisible(e),r.tilePickService.setPickState(),r.layerService.reRender();case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var e=this;cD.forEach((function(n){var r=t[n].bind(t);t[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r.apply(void 0,o),e.getLayers().map((function(t){t[n].apply(t,o)})),"style"===n&&e.getTiles().forEach((function(t){return t.styleUpdate.apply(t,o)})),t}}))}}]),t}(),OD=ku.injectable()(ID=function(){function t(){Ee(this,t)}var e,n,r;return Te(t,[{key:"build",value:(r=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.prepareBuildModel(),t.next=3,e.buildModels();case 3:case"end":return t.stop()}}),t)}))),function(t){return r.apply(this,arguments)})},{key:"initLayerModel",value:(n=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.build(e);case 2:e.styleNeedUpdate=!1;case 3:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"prepareLayerModel",value:(e=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.build(e);case 2:e.styleNeedUpdate=!1;case 3:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"apply",value:function(t){var e=this;t.hooks.init.tapPromise("LayerModelPlugin",Zt(Kt.mark((function n(){return Kt.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.getSource().isTile){n.next=4;break}return t.prepareBuildModel(),t.tileLayer=new RD(t),n.abrupt("return");case 4:return t.log(Cy,Sp.INIT),n.next=7,e.initLayerModel(t);case 7:t.log(ky,Sp.INIT);case 8:case"end":return n.stop()}}),n)})))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=Zt(Kt.mark((function n(r){return Kt.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return",!1);case 2:if(!t.getSource().isTile){n.next=5;break}return t.tileLayer=new RD(t),n.abrupt("return",!1);case 5:return t.log(Cy,Sp.UPDATE),n.next=8,e.prepareLayerModel(t);case 8:return t.log(ky,Sp.UPDATE),n.abrupt("return",!0);case 10:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()),t.hooks.beforeRender.tap("LayerModelPlugin",(function(){t.styleNeedUpdate&&e.prepareLayerModel(t).then((function(){t.styleNeedUpdate=!1,t.renderLayers()})),t.styleNeedUpdate=!1}))}}]),t}())||ID,DD=ku.injectable()(PD=function(){function t(){Ee(this,t)}return Te(t,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",(function(){var e=t.getLayerConfig(),n=e.autoFit,r=e.fitBoundsOptions;n&&t.fitBounds(r)}))}}]),t}())||PD,ND=["type"],zD={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},FD={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},BD={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},UD={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var jD,VD,GD,HD=ku.injectable()(LD=function(){function t(){Ee(this,t)}return Te(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",(function(){t.getLayerConfig().enableLighting&&t.models.forEach((function(t){return t.addUniforms(It({},(n={u_DirectionalLights:new Array(3).fill(It({},BD)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(It({},UD)),u_NumOfSpotLights:0},e&&e.length||(e=[FD]),e.forEach((function(t){var e=t.type,r=void 0===e?"directional":e,i=Wf(t,ND),o=zD[r].lights,a=zD[r].num,s=n[a];n[o][s]=It(It({},n[o][s]),i),n[a]++})),n)));var e,n}))}))}}]),t}())||LD,WD=ku.injectable()(jD=function(){function t(){Ee(this,t)}return Te(t,[{key:"apply",value:function(t,e){var n=this,r=e.rendererService,i=e.postProcessingPassFactory,o=e.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",(function(){var e=t.getLayerConfig(),r=e.enableMultiPassRenderer,a=e.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==t.getLayerConfig().enableMultiPassRenderer,n.enabled&&(t.multiPassRenderer=CC(t,s,i,o),t.multiPassRenderer.setRenderFlag(!0))})),t.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var e=r.getViewportSize(),i=e.width,o=e.height;t.multiPassRenderer.resize(i,o)}}))}}]),t}())||jD,ZD=1,qD=2,XD=ku.injectable()(VD=function(){function t(){Ee(this,t)}return Te(t,[{key:"apply",value:function(t,e){var n=e.styleAttributeService;t.hooks.init.tapPromise("PixelPickingPlugin",(function(){var e=t.getLayerConfig().enablePicking;n.registerStyleAttribute({name:"pickingColor",type:cy.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:pf.FLOAT},size:3,update:function(t){var n=t.id;return e?Zr(n):[0,0,0]}}})})),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(t){return t.addUniforms({u_PickingStage:ZD})}))})),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(t){return t.addUniforms({u_PickingStage:qD})}))})),t.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.highlightColor,i=n.activeMix,o=void 0===i?0:i,a="string"==typeof r?Hr(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Wr(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:qD,u_PickingColor:e,u_HighlightColor:a.map((function(t){return 255*t})),u_activeMix:o})}))})),t.hooks.beforeSelect.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.selectColor,i=n.selectMix,o=void 0===i?0:i,a="string"==typeof r?Hr(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Wr(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:qD,u_PickingColor:e,u_HighlightColor:a.map((function(t){return 255*t})),u_activeMix:o,u_CurrentSelectedId:e,u_SelectColor:a.map((function(t){return 255*t})),u_EnableSelect:1})}))}))}}]),t}())||VD,YD=["mvt","geojsonvt","testTile"];var KD,QD,JD,$D,tN,eN,nN,rN,iN,oN,aN,sN,uN,lN=ku.injectable()(GD=function(){function t(){Ee(this,t)}return Te(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",(function(){(function(t){var e=t.getSource();return YD.includes(e.parser.type)})(t)||n.registerBuiltinAttributes(r,t)}))}},{key:"registerBuiltinAttributes",value:function(t,e){"MaskLayer"!==e.type?(this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)):this.registerPositionAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:cy.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:pf.FLOAT},size:3,update:function(t,e,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerFilterAttribute",value:function(t){t.registerStyleAttribute({name:"filter",type:cy.Attribute,descriptor:{name:"filter",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t){return t.filter?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:cy.Attribute,descriptor:{name:"a_Color",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:4,update:function(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:cy.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:pf.DYNAMIC_DRAW,data:[],type:pf.FLOAT},size:1,update:function(t,e){return[e]}}})}}]),t}())||GD,cN=(KD=ku.injectable(),QD=ku.inject(Hh.ICameraService),JD=ku.inject(Hh.ICoordinateSystemService),$D=ku.inject(Hh.IRendererService),tN=ku.inject(Hh.IMapService),KD((nN=function(){function t(){Ee(this,t),Rp(this,"cameraService",rN,this),Rp(this,"coordinateSystemService",iN,this),Rp(this,"rendererService",oN,this),Rp(this,"mapService",aN,this)}return Te(t,[{key:"apply",value:function(t){var e=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var o=t.getLayerConfig().tileOrigin;e.coordinateSystemService.refresh(o),"GAODE2.x"===n&&(e.setLayerCenter(t),r=e.mapService.map.customCoords.getMVPMatrix(),i=e.mapService.getCustomCoordCenter());var a=e.rendererService.getViewportSize(),s=a.width,u=a.height;t.models.forEach((function(n){var o;n.addUniforms((kt(o={},hy,e.cameraService.getProjectionMatrix()),kt(o,py,e.cameraService.getViewMatrix()),kt(o,fy,e.cameraService.getViewProjectionMatrix()),kt(o,dy,e.cameraService.getZoom()),kt(o,vy,e.cameraService.getZoomScale()),kt(o,yy,e.cameraService.getFocalDistance()),kt(o,gy,e.cameraService.getCameraPosition()),kt(o,Wp,e.coordinateSystemService.getCoordinateSystem()),kt(o,Zp,e.coordinateSystemService.getViewportCenter()),kt(o,qp,e.coordinateSystemService.getViewportCenterProjection()),kt(o,Xp,e.coordinateSystemService.getPixelsPerDegree()),kt(o,Yp,e.coordinateSystemService.getPixelsPerDegree2()),kt(o,Kp,e.coordinateSystemService.getPixelsPerMeter()),kt(o,Qp,r),kt(o,"u_sceneCenterMercator",i),kt(o,"u_ViewportSize",[s,u]),kt(o,"u_ModelMatrix",e.cameraService.getModelMatrix()),kt(o,"u_DevicePixelRatio",tr.devicePixelRatio),kt(o,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),kt(o,"u_shaderPick",Number(t.getShaderPickStat())),o))}))}))}},{key:"setLayerCenter",value:function(t){void 0===t.coordCenter&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}}]),t}(),rN=Op(nN.prototype,"cameraService",[QD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iN=Op(nN.prototype,"coordinateSystemService",[JD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oN=Op(nN.prototype,"rendererService",[$D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aN=Op(nN.prototype,"mapService",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eN=nN))||eN),hN=ku.injectable()(sN=function(){function t(){Ee(this,t)}return Te(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",(function(){t.layerModel&&t.layerModel.needUpdate().then((function(e){e&&t.renderLayers()}))})),t.hooks.afterRender.tap("UpdateModelPlugin",(function(){t.layerModelNeedUpdate=!1}))}}]),t}())||sN,pN=ku.injectable()(uN=function(){function t(){Ee(this,t)}return Te(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(t,{styleAttributeService:r})})),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){t.layerModelNeedUpdate||t.inited&&n.updateStyleAttribute(t,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(t,e){var n=e.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return t.layerModelNeedUpdate=!0,void r.forEach((function(t){return t.needRegenerateVertices=!1}));r.filter((function(t){return t.needRegenerateVertices})).forEach((function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex,t),e.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(t,e){var n=e.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(t){return t.needRegenerateVertices})).forEach((function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex),e.needRegenerateVertices=!1}))}}]),t}())||uN;ry.bind(Hh.ILayerPlugin).to(tP).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(lN).inRequestScope(),ry.bind(Hh.ILayerPlugin).to($O).inRequestScope(),ry.bind(Hh.ILayerPlugin).to($I).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(DD).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(eD).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(pN).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(hN).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(WD).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(cN).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(tD).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(HD).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(XD).inRequestScope(),ry.bind(Hh.ILayerPlugin).to(OD).inRequestScope();var fN={exports:{}},dN={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},vN="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",mN={5:vN,"5module":vN+" export import",6:vN+" const class extends export import super"},yN=/^in(stanceof)?$/,gN="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࣇऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-鿼ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-ꟊꟵ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",_N="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿᫀᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",xN=new RegExp("["+gN+"]"),bN=new RegExp("["+gN+_N+"]");gN=_N=null;var wN=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],SN=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function EN(t,e){for(var n=65536,r=0;r<e.length;r+=2){if((n+=e[r])>t)return!1;if((n+=e[r+1])>=t)return!0}}function AN(t,e){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&xN.test(String.fromCharCode(t)):!1!==e&&EN(t,wN)))}function TN(t,e){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&bN.test(String.fromCharCode(t)):!1!==e&&(EN(t,wN)||EN(t,SN)))))}var CN=function(t,e){void 0===e&&(e={}),this.label=t,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null};function kN(t,e){return new CN(t,{beforeExpr:!0,binop:e})}var MN={beforeExpr:!0},IN={startsExpr:!0},PN={};function LN(t,e){return void 0===e&&(e={}),e.keyword=t,PN[t]=new CN(t,e)}var RN={num:new CN("num",IN),regexp:new CN("regexp",IN),string:new CN("string",IN),name:new CN("name",IN),eof:new CN("eof"),bracketL:new CN("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new CN("]"),braceL:new CN("{",{beforeExpr:!0,startsExpr:!0}),braceR:new CN("}"),parenL:new CN("(",{beforeExpr:!0,startsExpr:!0}),parenR:new CN(")"),comma:new CN(",",MN),semi:new CN(";",MN),colon:new CN(":",MN),dot:new CN("."),question:new CN("?",MN),questionDot:new CN("?."),arrow:new CN("=>",MN),template:new CN("template"),invalidTemplate:new CN("invalidTemplate"),ellipsis:new CN("...",MN),backQuote:new CN("`",IN),dollarBraceL:new CN("${",{beforeExpr:!0,startsExpr:!0}),eq:new CN("=",{beforeExpr:!0,isAssign:!0}),assign:new CN("_=",{beforeExpr:!0,isAssign:!0}),incDec:new CN("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new CN("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:kN("||",1),logicalAND:kN("&&",2),bitwiseOR:kN("|",3),bitwiseXOR:kN("^",4),bitwiseAND:kN("&",5),equality:kN("==/!=/===/!==",6),relational:kN("</>/<=/>=",7),bitShift:kN("<</>>/>>>",8),plusMin:new CN("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:kN("%",10),star:kN("*",10),slash:kN("/",10),starstar:new CN("**",{beforeExpr:!0}),coalesce:kN("??",1),_break:LN("break"),_case:LN("case",MN),_catch:LN("catch"),_continue:LN("continue"),_debugger:LN("debugger"),_default:LN("default",MN),_do:LN("do",{isLoop:!0,beforeExpr:!0}),_else:LN("else",MN),_finally:LN("finally"),_for:LN("for",{isLoop:!0}),_function:LN("function",IN),_if:LN("if"),_return:LN("return",MN),_switch:LN("switch"),_throw:LN("throw",MN),_try:LN("try"),_var:LN("var"),_const:LN("const"),_while:LN("while",{isLoop:!0}),_with:LN("with"),_new:LN("new",{beforeExpr:!0,startsExpr:!0}),_this:LN("this",IN),_super:LN("super",IN),_class:LN("class",IN),_extends:LN("extends",MN),_export:LN("export"),_import:LN("import",IN),_null:LN("null",IN),_true:LN("true",IN),_false:LN("false",IN),_in:LN("in",{beforeExpr:!0,binop:7}),_instanceof:LN("instanceof",{beforeExpr:!0,binop:7}),_typeof:LN("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:LN("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:LN("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},ON=/\r\n?|\n|\u2028|\u2029/,DN=new RegExp(ON.source,"g");function NN(t,e){return 10===t||13===t||!e&&(8232===t||8233===t)}var zN=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,FN=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,BN=Object.prototype,UN=BN.hasOwnProperty,jN=BN.toString;function VN(t,e){return UN.call(t,e)}var GN=Array.isArray||function(t){return"[object Array]"===jN.call(t)};function HN(t){return new RegExp("^(?:"+t.replace(/ /g,"|")+")$")}var WN=function(t,e){this.line=t,this.column=e};WN.prototype.offset=function(t){return new WN(this.line,this.column+t)};var ZN=function(t,e,n){this.start=e,this.end=n,null!==t.sourceFile&&(this.source=t.sourceFile)};function qN(t,e){for(var n=1,r=0;;){DN.lastIndex=r;var i=DN.exec(t);if(!(i&&i.index<e))return new WN(n,e-r);++n,r=i.index+i[0].length}}var XN={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function YN(t){var e={};for(var n in XN)e[n]=t&&VN(t,n)?t[n]:XN[n];if(e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),null==e.allowReserved&&(e.allowReserved=e.ecmaVersion<5),GN(e.onToken)){var r=e.onToken;e.onToken=function(t){return r.push(t)}}return GN(e.onComment)&&(e.onComment=function(t,e){return function(n,r,i,o,a,s){var u={type:n?"Block":"Line",value:r,start:i,end:o};t.locations&&(u.loc=new ZN(this,a,s)),t.ranges&&(u.range=[i,o]),e.push(u)}}(e,e.onComment)),e}function KN(t,e){return 2|(t?4:0)|(e?8:0)}var QN=function(t,e,n){this.options=t=YN(t),this.sourceFile=t.sourceFile,this.keywords=HN(mN[t.ecmaVersion>=6?6:"module"===t.sourceType?"5module":5]);var r="";if(!0!==t.allowReserved){for(var i=t.ecmaVersion;!(r=dN[i]);i--);"module"===t.sourceType&&(r+=" await")}this.reservedWords=HN(r);var o=(r?r+" ":"")+dN.strict;this.reservedWordsStrict=HN(o),this.reservedWordsStrictBind=HN(o+" "+dN.strictBind),this.input=String(e),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(ON).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=RN.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===t.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&t.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},JN={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};QN.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)},JN.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},JN.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},JN.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},JN.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},JN.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},JN.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},QN.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},QN.extend=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var n=this,r=0;r<t.length;r++)n=t[r](n);return n},QN.parse=function(t,e){return new this(e,t).parse()},QN.parseExpressionAt=function(t,e,n){var r=new this(n,t,e);return r.nextToken(),r.parseExpression()},QN.tokenizer=function(t,e){return new this(e,t)},Object.defineProperties(QN.prototype,JN);var $N=QN.prototype,tz=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function ez(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}$N.strictDirective=function(t){for(;;){FN.lastIndex=t,t+=FN.exec(this.input)[0].length;var e=tz.exec(this.input.slice(t));if(!e)return!1;if("use strict"===(e[1]||e[2])){FN.lastIndex=t+e[0].length;var n=FN.exec(this.input),r=n.index+n[0].length,i=this.input.charAt(r);return";"===i||"}"===i||ON.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(r+1))}t+=e[0].length,FN.lastIndex=t,t+=FN.exec(this.input)[0].length,";"===this.input[t]&&t++}},$N.eat=function(t){return this.type===t&&(this.next(),!0)},$N.isContextual=function(t){return this.type===RN.name&&this.value===t&&!this.containsEsc},$N.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},$N.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},$N.canInsertSemicolon=function(){return this.type===RN.eof||this.type===RN.braceR||ON.test(this.input.slice(this.lastTokEnd,this.start))},$N.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},$N.semicolon=function(){this.eat(RN.semi)||this.insertSemicolon()||this.unexpected()},$N.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0},$N.expect=function(t){this.eat(t)||this.unexpected()},$N.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")},$N.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var n=e?t.parenthesizedAssign:t.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},$N.checkExpressionErrors=function(t,e){if(!t)return!1;var n=t.shorthandAssign,r=t.doubleProto;if(!e)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},$N.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},$N.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var nz=QN.prototype;nz.parseTopLevel=function(t){var e={};for(t.body||(t.body=[]);this.type!==RN.eof;){var n=this.parseStatement(null,!0,e);t.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var o=i[r];this.raiseRecoverable(this.undefinedExports[o].start,"Export '"+o+"' is not defined")}return this.adaptDirectivePrologue(t.body),this.next(),t.sourceType=this.options.sourceType,this.finishNode(t,"Program")};var rz={kind:"loop"},iz={kind:"switch"};nz.isLet=function(t){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;FN.lastIndex=this.pos;var e=FN.exec(this.input),n=this.pos+e[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(t)return!1;if(123===r)return!0;if(AN(r,!0)){for(var i=n+1;TN(this.input.charCodeAt(i),!0);)++i;var o=this.input.slice(n,i);if(!yN.test(o))return!0}return!1},nz.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;FN.lastIndex=this.pos;var t=FN.exec(this.input),e=this.pos+t[0].length;return!(ON.test(this.input.slice(this.pos,e))||"function"!==this.input.slice(e,e+8)||e+8!==this.input.length&&TN(this.input.charAt(e+8)))},nz.parseStatement=function(t,e,n){var r,i=this.type,o=this.startNode();switch(this.isLet(t)&&(i=RN._var,r="let"),i){case RN._break:case RN._continue:return this.parseBreakContinueStatement(o,i.keyword);case RN._debugger:return this.parseDebuggerStatement(o);case RN._do:return this.parseDoStatement(o);case RN._for:return this.parseForStatement(o);case RN._function:return t&&(this.strict||"if"!==t&&"label"!==t)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1,!t);case RN._class:return t&&this.unexpected(),this.parseClass(o,!0);case RN._if:return this.parseIfStatement(o);case RN._return:return this.parseReturnStatement(o);case RN._switch:return this.parseSwitchStatement(o);case RN._throw:return this.parseThrowStatement(o);case RN._try:return this.parseTryStatement(o);case RN._const:case RN._var:return r=r||this.value,t&&"var"!==r&&this.unexpected(),this.parseVarStatement(o,r);case RN._while:return this.parseWhileStatement(o);case RN._with:return this.parseWithStatement(o);case RN.braceL:return this.parseBlock(!0,o);case RN.semi:return this.parseEmptyStatement(o);case RN._export:case RN._import:if(this.options.ecmaVersion>10&&i===RN._import){FN.lastIndex=this.pos;var a=FN.exec(this.input),s=this.pos+a[0].length,u=this.input.charCodeAt(s);if(40===u||46===u)return this.parseExpressionStatement(o,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===RN._import?this.parseImport(o):this.parseExport(o,n);default:if(this.isAsyncFunction())return t&&this.unexpected(),this.next(),this.parseFunctionStatement(o,!0,!t);var l=this.value,c=this.parseExpression();return i===RN.name&&"Identifier"===c.type&&this.eat(RN.colon)?this.parseLabeledStatement(o,l,c,t):this.parseExpressionStatement(o,c)}},nz.parseBreakContinueStatement=function(t,e){var n="break"===e;this.next(),this.eat(RN.semi)||this.insertSemicolon()?t.label=null:this.type!==RN.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==t.label||i.name===t.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(t.label&&n)break}}return r===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,n?"BreakStatement":"ContinueStatement")},nz.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},nz.parseDoStatement=function(t){return this.next(),this.labels.push(rz),t.body=this.parseStatement("do"),this.labels.pop(),this.expect(RN._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(RN.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},nz.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(rz),this.enterScope(0),this.expect(RN.parenL),this.type===RN.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var n=this.isLet();if(this.type===RN._var||this.type===RN._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===RN._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===RN._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,r)):(e>-1&&this.unexpected(e),this.parseFor(t,r))}var o=new ez,a=this.parseExpression(!0,o);return this.type===RN._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===RN._in?e>-1&&this.unexpected(e):t.await=e>-1),this.toAssignable(a,!1,o),this.checkLVal(a),this.parseForIn(t,a)):(this.checkExpressionErrors(o,!0),e>-1&&this.unexpected(e),this.parseFor(t,a))},nz.parseFunctionStatement=function(t,e,n){return this.next(),this.parseFunction(t,az|(n?0:sz),!1,e)},nz.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement("if"),t.alternate=this.eat(RN._else)?this.parseStatement("if"):null,this.finishNode(t,"IfStatement")},nz.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(RN.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},nz.parseSwitchStatement=function(t){var e;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(RN.braceL),this.labels.push(iz),this.enterScope(0);for(var n=!1;this.type!==RN.braceR;)if(this.type===RN._case||this.type===RN._default){var r=this.type===RN._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),r?e.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,e.test=null),this.expect(RN.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},nz.parseThrowStatement=function(t){return this.next(),ON.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var oz=[];nz.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===RN._catch){var e=this.startNode();if(this.next(),this.eat(RN.parenL)){e.param=this.parseBindingAtom();var n="Identifier"===e.param.type;this.enterScope(n?32:0),this.checkLVal(e.param,n?4:2),this.expect(RN.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0);e.body=this.parseBlock(!1),this.exitScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(RN._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},nz.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},nz.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(rz),t.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(t,"WhileStatement")},nz.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement("with"),this.finishNode(t,"WithStatement")},nz.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},nz.parseLabeledStatement=function(t,e,n,r){for(var i=0,o=this.labels;i<o.length;i+=1){o[i].name===e&&this.raise(n.start,"Label '"+e+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===RN._switch?"switch":null,s=this.labels.length-1;s>=0;s--){var u=this.labels[s];if(u.statementStart!==t.start)break;u.statementStart=this.start,u.kind=a}return this.labels.push({name:e,kind:a,statementStart:this.start}),t.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),t.label=n,this.finishNode(t,"LabeledStatement")},nz.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},nz.parseBlock=function(t,e,n){for(void 0===t&&(t=!0),void 0===e&&(e=this.startNode()),e.body=[],this.expect(RN.braceL),t&&this.enterScope(0);this.type!==RN.braceR;){var r=this.parseStatement(null);e.body.push(r)}return n&&(this.strict=!1),this.next(),t&&this.exitScope(),this.finishNode(e,"BlockStatement")},nz.parseFor=function(t,e){return t.init=e,this.expect(RN.semi),t.test=this.type===RN.semi?null:this.parseExpression(),this.expect(RN.semi),t.update=this.type===RN.parenR?null:this.parseExpression(),this.expect(RN.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,"ForStatement")},nz.parseForIn=function(t,e){var n=this.type===RN._in;return this.next(),"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==e.kind||"Identifier"!==e.declarations[0].id.type)?this.raise(e.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===e.type&&this.raise(e.start,"Invalid left-hand side in for-loop"),t.left=e,t.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(RN.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,n?"ForInStatement":"ForOfStatement")},nz.parseVar=function(t,e,n){for(t.declarations=[],t.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(RN.eq)?r.init=this.parseMaybeAssign(e):"const"!==n||this.type===RN._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||e&&(this.type===RN._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(RN.comma))break}return t},nz.parseVarId=function(t,e){t.id=this.parseBindingAtom(),this.checkLVal(t.id,"var"===e?1:2,!1)};var az=1,sz=2;nz.parseFunction=function(t,e,n,r){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===RN.star&&e&sz&&this.unexpected(),t.generator=this.eat(RN.star)),this.options.ecmaVersion>=8&&(t.async=!!r),e&az&&(t.id=4&e&&this.type!==RN.name?null:this.parseIdent(),!t.id||e&sz||this.checkLVal(t.id,this.strict||t.generator||t.async?this.treatFunctionsAsVar?1:2:3));var i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(KN(t.async,t.generator)),e&az||(t.id=this.type===RN.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,n,!1),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(t,e&az?"FunctionDeclaration":"FunctionExpression")},nz.parseFunctionParams=function(t){this.expect(RN.parenL),t.params=this.parseBindingList(RN.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},nz.parseClass=function(t,e){this.next();var n=this.strict;this.strict=!0,this.parseClassId(t,e),this.parseClassSuper(t);var r=this.startNode(),i=!1;for(r.body=[],this.expect(RN.braceL);this.type!==RN.braceR;){var o=this.parseClassElement(null!==t.superClass);o&&(r.body.push(o),"MethodDefinition"===o.type&&"constructor"===o.kind&&(i&&this.raise(o.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=n,this.next(),t.body=this.finishNode(r,"ClassBody"),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},nz.parseClassElement=function(t){var e=this;if(this.eat(RN.semi))return null;var n=this.startNode(),r=function(t,r){void 0===r&&(r=!1);var i=e.start,o=e.startLoc;return!!e.eatContextual(t)&&(!(e.type===RN.parenL||r&&e.canInsertSemicolon())||(n.key&&e.unexpected(),n.computed=!1,n.key=e.startNodeAt(i,o),n.key.name=t,e.finishNode(n.key,"Identifier"),!1))};n.kind="method",n.static=r("static");var i=this.eat(RN.star),o=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(o=!0,i=this.options.ecmaVersion>=9&&this.eat(RN.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key,s=!1;return n.computed||n.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),o&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor",s=t),this.parseClassMethod(n,i,o,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},nz.parseClassMethod=function(t,e,n,r){return t.value=this.parseMethod(e,n,r),this.finishNode(t,"MethodDefinition")},nz.parseClassId=function(t,e){this.type===RN.name?(t.id=this.parseIdent(),e&&this.checkLVal(t.id,2,!1)):(!0===e&&this.unexpected(),t.id=null)},nz.parseClassSuper=function(t){t.superClass=this.eat(RN._extends)?this.parseExprSubscripts():null},nz.parseExport=function(t,e){if(this.next(),this.eat(RN.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(t.exported=this.parseIdent(!0),this.checkExport(e,t.exported.name,this.lastTokStart)):t.exported=null),this.expectContextual("from"),this.type!==RN.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(RN._default)){var n;if(this.checkExport(e,"default",this.lastTokStart),this.type===RN._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),t.declaration=this.parseFunction(r,4|az,!1,n)}else if(this.type===RN._class){var i=this.startNode();t.declaration=this.parseClass(i,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(null),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id.name,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==RN.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var o=0,a=t.specifiers;o<a.length;o+=1){var s=a[o];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},nz.checkExport=function(t,e,n){t&&(VN(t,e)&&this.raiseRecoverable(n,"Duplicate export '"+e+"'"),t[e]=!0)},nz.checkPatternExport=function(t,e){var n=e.type;if("Identifier"===n)this.checkExport(t,e.name,e.start);else if("ObjectPattern"===n)for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.checkPatternExport(t,o)}else if("ArrayPattern"===n)for(var a=0,s=e.elements;a<s.length;a+=1){var u=s[a];u&&this.checkPatternExport(t,u)}else"Property"===n?this.checkPatternExport(t,e.value):"AssignmentPattern"===n?this.checkPatternExport(t,e.left):"RestElement"===n?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(t,e.expression)},nz.checkVariableExport=function(t,e){if(t)for(var n=0,r=e;n<r.length;n+=1){var i=r[n];this.checkPatternExport(t,i.id)}},nz.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},nz.parseExportSpecifiers=function(t){var e=[],n=!0;for(this.expect(RN.braceL);!this.eat(RN.braceR);){if(n)n=!1;else if(this.expect(RN.comma),this.afterTrailingComma(RN.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(t,r.exported.name,r.exported.start),e.push(this.finishNode(r,"ExportSpecifier"))}return e},nz.parseImport=function(t){return this.next(),this.type===RN.string?(t.specifiers=oz,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===RN.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},nz.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===RN.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,2),t.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(RN.comma))return t}if(this.type===RN.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,2),t.push(this.finishNode(r,"ImportNamespaceSpecifier")),t}for(this.expect(RN.braceL);!this.eat(RN.braceR);){if(e)e=!1;else if(this.expect(RN.comma),this.afterTrailingComma(RN.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,2),t.push(this.finishNode(i,"ImportSpecifier"))}return t},nz.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},nz.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var uz=QN.prototype;uz.toAssignable=function(t,e,n){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.toAssignable(o,e),"RestElement"!==o.type||"ArrayPattern"!==o.argument.type&&"ObjectPattern"!==o.argument.type||this.raise(o.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(t.expression,e,n);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return t},uz.toAssignableList=function(t,e){for(var n=t.length,r=0;r<n;r++){var i=t[r];i&&this.toAssignable(i,e)}if(n){var o=t[n-1];6===this.options.ecmaVersion&&e&&o&&"RestElement"===o.type&&"Identifier"!==o.argument.type&&this.unexpected(o.argument.start)}return t},uz.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")},uz.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==RN.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},uz.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case RN.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(RN.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case RN.braceL:return this.parseObj(!0)}return this.parseIdent()},uz.parseBindingList=function(t,e,n){for(var r=[],i=!0;!this.eat(t);)if(i?i=!1:this.expect(RN.comma),e&&this.type===RN.comma)r.push(null);else{if(n&&this.afterTrailingComma(t))break;if(this.type===RN.ellipsis){var o=this.parseRestBinding();this.parseBindingListItem(o),r.push(o),this.type===RN.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),r.push(a)}return r},uz.parseBindingListItem=function(t){return t},uz.parseMaybeDefault=function(t,e,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(RN.eq))return n;var r=this.startNodeAt(t,e);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},uz.checkLVal=function(t,e,n){switch(void 0===e&&(e=0),t.type){case"Identifier":2===e&&"let"===t.name&&this.raiseRecoverable(t.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(e?"Binding ":"Assigning to ")+t.name+" in strict mode"),n&&(VN(n,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),n[t.name]=!0),0!==e&&5!==e&&this.declareName(t.name,e,t.start);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":e&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.checkLVal(o,e,n)}break;case"Property":this.checkLVal(t.value,e,n);break;case"ArrayPattern":for(var a=0,s=t.elements;a<s.length;a+=1){var u=s[a];u&&this.checkLVal(u,e,n)}break;case"AssignmentPattern":this.checkLVal(t.left,e,n);break;case"RestElement":this.checkLVal(t.argument,e,n);break;case"ParenthesizedExpression":this.checkLVal(t.expression,e,n);break;default:this.raise(t.start,(e?"Binding":"Assigning to")+" rvalue")}};var lz=QN.prototype;lz.checkPropClash=function(t,e,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type||this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var r,i=t.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var o=t.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===o&&(e.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),e.proto=!0);else{var a=e[r="$"+r];if(a)("init"===o?this.strict&&a.init||a.get||a.set:a.init||a[o])&&this.raiseRecoverable(i.start,"Redefinition of property");else a=e[r]={init:!1,get:!1,set:!1};a[o]=!0}}},lz.parseExpression=function(t,e){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(t,e);if(this.type===RN.comma){var o=this.startNodeAt(n,r);for(o.expressions=[i];this.eat(RN.comma);)o.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(o,"SequenceExpression")}return i},lz.parseMaybeAssign=function(t,e,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(t);this.exprAllowed=!1}var r=!1,i=-1,o=-1;e?(i=e.parenthesizedAssign,o=e.trailingComma,e.parenthesizedAssign=e.trailingComma=-1):(e=new ez,r=!0);var a=this.start,s=this.startLoc;this.type!==RN.parenL&&this.type!==RN.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(t,e);if(n&&(u=n.call(this,u,a,s)),this.type.isAssign){var l=this.startNodeAt(a,s);return l.operator=this.value,l.left=this.type===RN.eq?this.toAssignable(u,!1,e):u,r||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=l.left.start&&(e.shorthandAssign=-1),this.checkLVal(u),this.next(),l.right=this.parseMaybeAssign(t),this.finishNode(l,"AssignmentExpression")}return r&&this.checkExpressionErrors(e,!0),i>-1&&(e.parenthesizedAssign=i),o>-1&&(e.trailingComma=o),u},lz.parseMaybeConditional=function(t,e){var n=this.start,r=this.startLoc,i=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return i;if(this.eat(RN.question)){var o=this.startNodeAt(n,r);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(RN.colon),o.alternate=this.parseMaybeAssign(t),this.finishNode(o,"ConditionalExpression")}return i},lz.parseExprOps=function(t,e){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(e,!1);return this.checkExpressionErrors(e)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,t)},lz.parseExprOp=function(t,e,n,r,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==RN._in)&&o>r){var a=this.type===RN.logicalOR||this.type===RN.logicalAND,s=this.type===RN.coalesce;s&&(o=RN.logicalAND.binop);var u=this.value;this.next();var l=this.start,c=this.startLoc,h=this.parseExprOp(this.parseMaybeUnary(null,!1),l,c,o,i),p=this.buildBinary(e,n,t,h,u,a||s);return(a&&this.type===RN.coalesce||s&&(this.type===RN.logicalOR||this.type===RN.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(p,e,n,r,i)}return t},lz.buildBinary=function(t,e,n,r,i,o){var a=this.startNodeAt(t,e);return a.left=n,a.operator=i,a.right=r,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")},lz.parseMaybeUnary=function(t,e){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),e=!0;else if(this.type.prefix){var o=this.startNode(),a=this.type===RN.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(t,!0),a?this.checkLVal(o.argument):this.strict&&"delete"===o.operator&&"Identifier"===o.argument.type?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):e=!0,n=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(t),this.checkExpressionErrors(t))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var s=this.startNodeAt(r,i);s.operator=this.value,s.prefix=!1,s.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(s,"UpdateExpression")}}return!e&&this.eat(RN.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},lz.parseExprSubscripts=function(t){var e=this.start,n=this.startLoc,r=this.parseExprAtom(t);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,e,n);return t&&"MemberExpression"===i.type&&(t.parenthesizedAssign>=i.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=i.start&&(t.parenthesizedBind=-1)),i},lz.parseSubscripts=function(t,e,n,r){for(var i=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&t.end-t.start==5&&this.potentialArrowAt===t.start,o=!1;;){var a=this.parseSubscript(t,e,n,r,i,o);if(a.optional&&(o=!0),a===t||"ArrowFunctionExpression"===a.type){if(o){var s=this.startNodeAt(e,n);s.expression=a,a=this.finishNode(s,"ChainExpression")}return a}t=a}},lz.parseSubscript=function(t,e,n,r,i,o){var a=this.options.ecmaVersion>=11,s=a&&this.eat(RN.questionDot);r&&s&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(RN.bracketL);if(u||s&&this.type!==RN.parenL&&this.type!==RN.backQuote||this.eat(RN.dot)){var l=this.startNodeAt(e,n);l.object=t,l.property=u?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),l.computed=!!u,u&&this.expect(RN.bracketR),a&&(l.optional=s),t=this.finishNode(l,"MemberExpression")}else if(!r&&this.eat(RN.parenL)){var c=new ez,h=this.yieldPos,p=this.awaitPos,f=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var d=this.parseExprList(RN.parenR,this.options.ecmaVersion>=8,!1,c);if(i&&!s&&!this.canInsertSemicolon()&&this.eat(RN.arrow))return this.checkPatternErrors(c,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=h,this.awaitPos=p,this.awaitIdentPos=f,this.parseArrowExpression(this.startNodeAt(e,n),d,!0);this.checkExpressionErrors(c,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=p||this.awaitPos,this.awaitIdentPos=f||this.awaitIdentPos;var v=this.startNodeAt(e,n);v.callee=t,v.arguments=d,a&&(v.optional=s),t=this.finishNode(v,"CallExpression")}else if(this.type===RN.backQuote){(s||o)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var m=this.startNodeAt(e,n);m.tag=t,m.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(m,"TaggedTemplateExpression")}return t},lz.parseExprAtom=function(t){this.type===RN.slash&&this.readRegexp();var e,n=this.potentialArrowAt===this.start;switch(this.type){case RN._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),e=this.startNode(),this.next(),this.type!==RN.parenL||this.allowDirectSuper||this.raise(e.start,"super() call outside constructor of a subclass"),this.type!==RN.dot&&this.type!==RN.bracketL&&this.type!==RN.parenL&&this.unexpected(),this.finishNode(e,"Super");case RN._this:return e=this.startNode(),this.next(),this.finishNode(e,"ThisExpression");case RN.name:var r=this.start,i=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(RN._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(RN.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===RN.name&&!o)return a=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(RN.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[a],!0)}return a;case RN.regexp:var s=this.value;return(e=this.parseLiteral(s.value)).regex={pattern:s.pattern,flags:s.flags},e;case RN.num:case RN.string:return this.parseLiteral(this.value);case RN._null:case RN._true:case RN._false:return(e=this.startNode()).value=this.type===RN._null?null:this.type===RN._true,e.raw=this.type.keyword,this.next(),this.finishNode(e,"Literal");case RN.parenL:var u=this.start,l=this.parseParenAndDistinguishExpression(n);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(l)&&(t.parenthesizedAssign=u),t.parenthesizedBind<0&&(t.parenthesizedBind=u)),l;case RN.bracketL:return e=this.startNode(),this.next(),e.elements=this.parseExprList(RN.bracketR,!0,!0,t),this.finishNode(e,"ArrayExpression");case RN.braceL:return this.parseObj(!1,t);case RN._function:return e=this.startNode(),this.next(),this.parseFunction(e,0);case RN._class:return this.parseClass(this.startNode(),!1);case RN._new:return this.parseNew();case RN.backQuote:return this.parseTemplate();case RN._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},lz.parseExprImport=function(){var t=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var e=this.parseIdent(!0);switch(this.type){case RN.parenL:return this.parseDynamicImport(t);case RN.dot:return t.meta=e,this.parseImportMeta(t);default:this.unexpected()}},lz.parseDynamicImport=function(t){if(this.next(),t.source=this.parseMaybeAssign(),!this.eat(RN.parenR)){var e=this.start;this.eat(RN.comma)&&this.eat(RN.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(t,"ImportExpression")},lz.parseImportMeta=function(t){this.next();var e=this.containsEsc;return t.property=this.parseIdent(!0),"meta"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(t.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(t.start,"Cannot use 'import.meta' outside a module"),this.finishNode(t,"MetaProperty")},lz.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),110===e.raw.charCodeAt(e.raw.length-1)&&(e.bigint=e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")},lz.parseParenExpression=function(){this.expect(RN.parenL);var t=this.parseExpression();return this.expect(RN.parenR),t},lz.parseParenAndDistinguishExpression=function(t){var e,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o,a=this.start,s=this.startLoc,u=[],l=!0,c=!1,h=new ez,p=this.yieldPos,f=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==RN.parenR;){if(l?l=!1:this.expect(RN.comma),i&&this.afterTrailingComma(RN.parenR,!0)){c=!0;break}if(this.type===RN.ellipsis){o=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===RN.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,h,this.parseParenItem))}var d=this.start,v=this.startLoc;if(this.expect(RN.parenR),t&&!this.canInsertSemicolon()&&this.eat(RN.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=p,this.awaitPos=f,this.parseParenArrowList(n,r,u);u.length&&!c||this.unexpected(this.lastTokStart),o&&this.unexpected(o),this.checkExpressionErrors(h,!0),this.yieldPos=p||this.yieldPos,this.awaitPos=f||this.awaitPos,u.length>1?((e=this.startNodeAt(a,s)).expressions=u,this.finishNodeAt(e,"SequenceExpression",d,v)):e=u[0]}else e=this.parseParenExpression();if(this.options.preserveParens){var m=this.startNodeAt(n,r);return m.expression=e,this.finishNode(m,"ParenthesizedExpression")}return e},lz.parseParenItem=function(t){return t},lz.parseParenArrowList=function(t,e,n){return this.parseArrowExpression(this.startNodeAt(t,e),n)};var cz=[];lz.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var t=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(RN.dot)){t.meta=e;var n=this.containsEsc;return t.property=this.parseIdent(!0),"target"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(t.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(t.start,"'new.target' can only be used in functions"),this.finishNode(t,"MetaProperty")}var r=this.start,i=this.startLoc,o=this.type===RN._import;return t.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),o&&"ImportExpression"===t.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(RN.parenL)?t.arguments=this.parseExprList(RN.parenR,this.options.ecmaVersion>=8,!1):t.arguments=cz,this.finishNode(t,"NewExpression")},lz.parseTemplateElement=function(t){var e=t.isTagged,n=this.startNode();return this.type===RN.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===RN.backQuote,this.finishNode(n,"TemplateElement")},lz.parseTemplate=function(t){void 0===t&&(t={});var e=t.isTagged;void 0===e&&(e=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:e});for(n.quasis=[r];!r.tail;)this.type===RN.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(RN.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(RN.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(n,"TemplateLiteral")},lz.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===RN.name||this.type===RN.num||this.type===RN.string||this.type===RN.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===RN.star)&&!ON.test(this.input.slice(this.lastTokEnd,this.start))},lz.parseObj=function(t,e){var n=this.startNode(),r=!0,i={};for(n.properties=[],this.next();!this.eat(RN.braceR);){if(r)r=!1;else if(this.expect(RN.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(RN.braceR))break;var o=this.parseProperty(t,e);t||this.checkPropClash(o,i,e),n.properties.push(o)}return this.finishNode(n,t?"ObjectPattern":"ObjectExpression")},lz.parseProperty=function(t,e){var n,r,i,o,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(RN.ellipsis))return t?(a.argument=this.parseIdent(!1),this.type===RN.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===RN.parenL&&e&&(e.parenthesizedAssign<0&&(e.parenthesizedAssign=this.start),e.parenthesizedBind<0&&(e.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,e),this.type===RN.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(t||e)&&(i=this.start,o=this.startLoc),t||(n=this.eat(RN.star)));var s=this.containsEsc;return this.parsePropertyName(a),!t&&!s&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(RN.star),this.parsePropertyName(a,e)):r=!1,this.parsePropertyValue(a,t,n,r,i,o,e,s),this.finishNode(a,"Property")},lz.parsePropertyValue=function(t,e,n,r,i,o,a,s){if((n||r)&&this.type===RN.colon&&this.unexpected(),this.eat(RN.colon))t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),t.kind="init";else if(this.options.ecmaVersion>=6&&this.type===RN.parenL)e&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(n,r);else if(e||s||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===RN.comma||this.type===RN.braceR||this.type===RN.eq)this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(t.key),"await"!==t.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),t.kind="init",e?t.value=this.parseMaybeDefault(i,o,t.key):this.type===RN.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),t.value=this.parseMaybeDefault(i,o,t.key)):t.value=t.key,t.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1);var u="get"===t.kind?0:1;if(t.value.params.length!==u){var l=t.value.start;"get"===t.kind?this.raiseRecoverable(l,"getter should have no params"):this.raiseRecoverable(l,"setter should have exactly one param")}else"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")}},lz.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(RN.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(RN.bracketR),t.key;t.computed=!1}return t.key=this.type===RN.num||this.type===RN.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},lz.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},lz.parseMethod=function(t,e,n){var r=this.startNode(),i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=t),this.options.ecmaVersion>=8&&(r.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|KN(e,r.generator)|(n?128:0)),this.expect(RN.parenL),r.params=this.parseBindingList(RN.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(r,"FunctionExpression")},lz.parseArrowExpression=function(t,e,n){var r=this.yieldPos,i=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(16|KN(n,!1)),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=o,this.finishNode(t,"ArrowFunctionExpression")},lz.parseFunctionBody=function(t,e,n){var r=e&&this.type!==RN.braceL,i=this.strict,o=!1;if(r)t.body=this.parseMaybeAssign(),t.expression=!0,this.checkParams(t,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);i&&!a||(o=this.strictDirective(this.end))&&a&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list");var s=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(t,!i&&!o&&!e&&!n&&this.isSimpleParamList(t.params)),this.strict&&t.id&&this.checkLVal(t.id,5),t.body=this.parseBlock(!1,void 0,o&&!i),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=s}this.exitScope()},lz.isSimpleParamList=function(t){for(var e=0,n=t;e<n.length;e+=1){if("Identifier"!==n[e].type)return!1}return!0},lz.checkParams=function(t,e){for(var n={},r=0,i=t.params;r<i.length;r+=1){var o=i[r];this.checkLVal(o,1,e?null:n)}},lz.parseExprList=function(t,e,n,r){for(var i=[],o=!0;!this.eat(t);){if(o)o=!1;else if(this.expect(RN.comma),e&&this.afterTrailingComma(t))break;var a=void 0;n&&this.type===RN.comma?a=null:this.type===RN.ellipsis?(a=this.parseSpread(r),r&&this.type===RN.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):a=this.parseMaybeAssign(!1,r),i.push(a)}return i},lz.checkUnreserved=function(t){var e=t.start,n=t.end,r=t.name;(this.inGenerator&&"yield"===r&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(e,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(e,n).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+r+"' is reserved"))},lz.parseIdent=function(t,e){var n=this.startNode();return this.type===RN.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!t),this.finishNode(n,"Identifier"),t||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},lz.parseYield=function(t){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===RN.semi||this.canInsertSemicolon()||this.type!==RN.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(RN.star),e.argument=this.parseMaybeAssign(t)),this.finishNode(e,"YieldExpression")},lz.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!1),this.finishNode(t,"AwaitExpression")};var hz=QN.prototype;hz.raise=function(t,e){var n=qN(this.input,t);e+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(e);throw r.pos=t,r.loc=n,r.raisedAt=this.pos,r},hz.raiseRecoverable=hz.raise,hz.curPosition=function(){if(this.options.locations)return new WN(this.curLine,this.pos-this.lineStart)};var pz=QN.prototype,fz=function(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[]};pz.enterScope=function(t){this.scopeStack.push(new fz(t))},pz.exitScope=function(){this.scopeStack.pop()},pz.treatFunctionsAsVarInScope=function(t){return 2&t.flags||!this.inModule&&1&t.flags},pz.declareName=function(t,e,n){var r=!1;if(2===e){var i=this.currentScope();r=i.lexical.indexOf(t)>-1||i.functions.indexOf(t)>-1||i.var.indexOf(t)>-1,i.lexical.push(t),this.inModule&&1&i.flags&&delete this.undefinedExports[t]}else if(4===e){this.currentScope().lexical.push(t)}else if(3===e){var o=this.currentScope();r=this.treatFunctionsAsVar?o.lexical.indexOf(t)>-1:o.lexical.indexOf(t)>-1||o.var.indexOf(t)>-1,o.functions.push(t)}else for(var a=this.scopeStack.length-1;a>=0;--a){var s=this.scopeStack[a];if(s.lexical.indexOf(t)>-1&&!(32&s.flags&&s.lexical[0]===t)||!this.treatFunctionsAsVarInScope(s)&&s.functions.indexOf(t)>-1){r=!0;break}if(s.var.push(t),this.inModule&&1&s.flags&&delete this.undefinedExports[t],3&s.flags)break}r&&this.raiseRecoverable(n,"Identifier '"+t+"' has already been declared")},pz.checkLocalExport=function(t){-1===this.scopeStack[0].lexical.indexOf(t.name)&&-1===this.scopeStack[0].var.indexOf(t.name)&&(this.undefinedExports[t.name]=t)},pz.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},pz.currentVarScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(3&e.flags)return e}},pz.currentThisScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(3&e.flags&&!(16&e.flags))return e}};var dz=function(t,e,n){this.type="",this.start=e,this.end=0,t.options.locations&&(this.loc=new ZN(t,n)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[e,0])},vz=QN.prototype;function mz(t,e,n,r){return t.type=e,t.end=n,this.options.locations&&(t.loc.end=r),this.options.ranges&&(t.range[1]=n),t}vz.startNode=function(){return new dz(this,this.start,this.startLoc)},vz.startNodeAt=function(t,e){return new dz(this,t,e)},vz.finishNode=function(t,e){return mz.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)},vz.finishNodeAt=function(t,e,n,r){return mz.call(this,t,e,n,r)};var yz=function(t,e,n,r,i){this.token=t,this.isExpr=!!e,this.preserveSpace=!!n,this.override=r,this.generator=!!i},gz={b_stat:new yz("{",!1),b_expr:new yz("{",!0),b_tmpl:new yz("${",!1),p_stat:new yz("(",!1),p_expr:new yz("(",!0),q_tmpl:new yz("`",!0,!0,(function(t){return t.tryReadTemplateToken()})),f_stat:new yz("function",!1),f_expr:new yz("function",!0),f_expr_gen:new yz("function",!0,!1,null,!0),f_gen:new yz("function",!1,!1,null,!0)},_z=QN.prototype;_z.initialContext=function(){return[gz.b_stat]},_z.braceIsBlock=function(t){var e=this.curContext();return e===gz.f_expr||e===gz.f_stat||(t!==RN.colon||e!==gz.b_stat&&e!==gz.b_expr?t===RN._return||t===RN.name&&this.exprAllowed?ON.test(this.input.slice(this.lastTokEnd,this.start)):t===RN._else||t===RN.semi||t===RN.eof||t===RN.parenR||t===RN.arrow||(t===RN.braceL?e===gz.b_stat:t!==RN._var&&t!==RN._const&&t!==RN.name&&!this.exprAllowed):!e.isExpr)},_z.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if("function"===e.token)return e.generator}return!1},_z.updateContext=function(t){var e,n=this.type;n.keyword&&t===RN.dot?this.exprAllowed=!1:(e=n.updateContext)?e.call(this,t):this.exprAllowed=n.beforeExpr},RN.parenR.updateContext=RN.braceR.updateContext=function(){if(1!==this.context.length){var t=this.context.pop();t===gz.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr}else this.exprAllowed=!0},RN.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?gz.b_stat:gz.b_expr),this.exprAllowed=!0},RN.dollarBraceL.updateContext=function(){this.context.push(gz.b_tmpl),this.exprAllowed=!0},RN.parenL.updateContext=function(t){var e=t===RN._if||t===RN._for||t===RN._with||t===RN._while;this.context.push(e?gz.p_stat:gz.p_expr),this.exprAllowed=!0},RN.incDec.updateContext=function(){},RN._function.updateContext=RN._class.updateContext=function(t){!t.beforeExpr||t===RN.semi||t===RN._else||t===RN._return&&ON.test(this.input.slice(this.lastTokEnd,this.start))||(t===RN.colon||t===RN.braceL)&&this.curContext()===gz.b_stat?this.context.push(gz.f_stat):this.context.push(gz.f_expr),this.exprAllowed=!1},RN.backQuote.updateContext=function(){this.curContext()===gz.q_tmpl?this.context.pop():this.context.push(gz.q_tmpl),this.exprAllowed=!1},RN.star.updateContext=function(t){if(t===RN._function){var e=this.context.length-1;this.context[e]===gz.f_expr?this.context[e]=gz.f_expr_gen:this.context[e]=gz.f_gen}this.exprAllowed=!0},RN.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==RN.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var xz="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",bz=xz+" Extended_Pictographic",wz={9:xz,10:bz,11:bz},Sz="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ez="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Az=Ez+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Tz={9:Ez,10:Az,11:Az+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho"},Cz={};function kz(t){var e=Cz[t]={binary:HN(wz[t]+" "+Sz),nonBinary:{General_Category:HN(Sz),Script:HN(Tz[t])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}kz(9),kz(10),kz(11);var Mz=QN.prototype,Iz=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Cz[t.options.ecmaVersion>=11?11:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function Pz(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function Lz(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function Rz(t){return t>=65&&t<=90||t>=97&&t<=122}function Oz(t){return Rz(t)||95===t}function Dz(t){return Oz(t)||Nz(t)}function Nz(t){return t>=48&&t<=57}function zz(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function Fz(t){return t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:t-48}function Bz(t){return t>=48&&t<=55}Iz.prototype.reset=function(t,e,n){var r=-1!==n.indexOf("u");this.start=0|t,this.source=e+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},Iz.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},Iz.prototype.at=function(t,e){void 0===e&&(e=!1);var n=this.source,r=n.length;if(t>=r)return-1;var i=n.charCodeAt(t);if(!e&&!this.switchU||i<=55295||i>=57344||t+1>=r)return i;var o=n.charCodeAt(t+1);return o>=56320&&o<=57343?(i<<10)+o-56613888:i},Iz.prototype.nextIndex=function(t,e){void 0===e&&(e=!1);var n=this.source,r=n.length;if(t>=r)return r;var i,o=n.charCodeAt(t);return!e&&!this.switchU||o<=55295||o>=57344||t+1>=r||(i=n.charCodeAt(t+1))<56320||i>57343?t+1:t+2},Iz.prototype.current=function(t){return void 0===t&&(t=!1),this.at(this.pos,t)},Iz.prototype.lookahead=function(t){return void 0===t&&(t=!1),this.at(this.nextIndex(this.pos,t),t)},Iz.prototype.advance=function(t){void 0===t&&(t=!1),this.pos=this.nextIndex(this.pos,t)},Iz.prototype.eat=function(t,e){return void 0===e&&(e=!1),this.current(e)===t&&(this.advance(e),!0)},Mz.validateRegExpFlags=function(t){for(var e=t.validFlags,n=t.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===e.indexOf(i)&&this.raise(t.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(t.start,"Duplicate regular expression flag")}},Mz.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},Mz.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,n=t.backReferenceNames;e<n.length;e+=1){var r=n[e];-1===t.groupNames.indexOf(r)&&t.raise("Invalid named capture referenced")}},Mz.regexp_disjunction=function(t){for(this.regexp_alternative(t);t.eat(124);)this.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},Mz.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););},Mz.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!!(t.switchU?this.regexp_eatAtom(t):this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},Mz.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!n,!0}return t.pos=e,!1},Mz.regexp_eatQuantifier=function(t,e){return void 0===e&&(e=!1),!!this.regexp_eatQuantifierPrefix(t,e)&&(t.eat(63),!0)},Mz.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)},Mz.regexp_eatBracedQuantifier=function(t,e){var n=t.pos;if(t.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(i=t.lastIntValue),t.eat(125)))return-1!==i&&i<r&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=n}return!1},Mz.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},Mz.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1},Mz.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=e}return!1},Mz.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},Mz.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},Mz.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},Mz.regexp_eatSyntaxCharacter=function(t){var e=t.current();return!!Lz(e)&&(t.lastIntValue=e,t.advance(),!0)},Mz.regexp_eatPatternCharacters=function(t){for(var e=t.pos,n=0;-1!==(n=t.current())&&!Lz(n);)t.advance();return t.pos!==e},Mz.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return!(-1===e||36===e||e>=40&&e<=43||46===e||63===e||91===e||94===e||124===e)&&(t.advance(),!0)},Mz.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return-1!==t.groupNames.indexOf(t.lastStringValue)&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},Mz.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},Mz.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=Pz(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=Pz(t.lastIntValue);return!0}return!1},Mz.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,n=this.options.ecmaVersion>=11,r=t.current(n);return t.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,n)&&(r=t.lastIntValue),function(t){return AN(t,!0)||36===t||95===t}(r)?(t.lastIntValue=r,!0):(t.pos=e,!1)},Mz.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,n=this.options.ecmaVersion>=11,r=t.current(n);return t.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,n)&&(r=t.lastIntValue),function(t){return TN(t,!0)||36===t||95===t||8204===t||8205===t}(r)?(t.lastIntValue=r,!0):(t.pos=e,!1)},Mz.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},Mz.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var n=t.lastIntValue;if(t.switchU)return n>t.maxBackReference&&(t.maxBackReference=n),!0;if(n<=t.numCapturingParens)return!0;t.pos=e}return!1},Mz.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},Mz.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t,!1)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},Mz.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1},Mz.regexp_eatZero=function(t){return 48===t.current()&&!Nz(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},Mz.regexp_eatControlEscape=function(t){var e=t.current();return 116===e?(t.lastIntValue=9,t.advance(),!0):110===e?(t.lastIntValue=10,t.advance(),!0):118===e?(t.lastIntValue=11,t.advance(),!0):102===e?(t.lastIntValue=12,t.advance(),!0):114===e&&(t.lastIntValue=13,t.advance(),!0)},Mz.regexp_eatControlLetter=function(t){var e=t.current();return!!Rz(e)&&(t.lastIntValue=e%32,t.advance(),!0)},Mz.regexp_eatRegExpUnicodeEscapeSequence=function(t,e){void 0===e&&(e=!1);var n,r=t.pos,i=e||t.switchU;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var o=t.lastIntValue;if(i&&o>=55296&&o<=56319){var a=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var s=t.lastIntValue;if(s>=56320&&s<=57343)return t.lastIntValue=1024*(o-55296)+(s-56320)+65536,!0}t.pos=a,t.lastIntValue=o}return!0}if(i&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&((n=t.lastIntValue)>=0&&n<=1114111))return!0;i&&t.raise("Invalid unicode escape"),t.pos=r}return!1},Mz.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var e=t.current();return!(99===e||t.switchN&&107===e)&&(t.lastIntValue=e,t.advance(),!0)},Mz.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do{t.lastIntValue=10*t.lastIntValue+(e-48),t.advance()}while((e=t.current())>=48&&e<=57);return!0}return!1},Mz.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(function(t){return 100===t||68===t||115===t||83===t||119===t||87===t}(e))return t.lastIntValue=-1,t.advance(),!0;if(t.switchU&&this.options.ecmaVersion>=9&&(80===e||112===e)){if(t.lastIntValue=-1,t.advance(),t.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(t)&&t.eat(125))return!0;t.raise("Invalid property name")}return!1},Mz.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var n=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,n,r),!0}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var i=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,i),!0}return!1},Mz.regexp_validateUnicodePropertyNameAndValue=function(t,e,n){VN(t.unicodeProperties.nonBinary,e)||t.raise("Invalid property name"),t.unicodeProperties.nonBinary[e].test(n)||t.raise("Invalid property value")},Mz.regexp_validateUnicodePropertyNameOrValue=function(t,e){t.unicodeProperties.binary.test(e)||t.raise("Invalid property name")},Mz.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";Oz(e=t.current());)t.lastStringValue+=Pz(e),t.advance();return""!==t.lastStringValue},Mz.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";Dz(e=t.current());)t.lastStringValue+=Pz(e),t.advance();return""!==t.lastStringValue},Mz.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},Mz.regexp_eatCharacterClass=function(t){if(t.eat(91)){if(t.eat(94),this.regexp_classRanges(t),t.eat(93))return!0;t.raise("Unterminated character class")}return!1},Mz.regexp_classRanges=function(t){for(;this.regexp_eatClassAtom(t);){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var n=t.lastIntValue;!t.switchU||-1!==e&&-1!==n||t.raise("Invalid character class"),-1!==e&&-1!==n&&e>n&&t.raise("Range out of order in character class")}}},Mz.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var n=t.current();(99===n||Bz(n))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var r=t.current();return 93!==r&&(t.lastIntValue=r,t.advance(),!0)},Mz.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},Mz.regexp_eatClassControlLetter=function(t){var e=t.current();return!(!Nz(e)&&95!==e)&&(t.lastIntValue=e%32,t.advance(),!0)},Mz.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1},Mz.regexp_eatDecimalDigits=function(t){var e=t.pos,n=0;for(t.lastIntValue=0;Nz(n=t.current());)t.lastIntValue=10*t.lastIntValue+(n-48),t.advance();return t.pos!==e},Mz.regexp_eatHexDigits=function(t){var e=t.pos,n=0;for(t.lastIntValue=0;zz(n=t.current());)t.lastIntValue=16*t.lastIntValue+Fz(n),t.advance();return t.pos!==e},Mz.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var n=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=64*e+8*n+t.lastIntValue:t.lastIntValue=8*e+n}else t.lastIntValue=e;return!0}return!1},Mz.regexp_eatOctalDigit=function(t){var e=t.current();return Bz(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)},Mz.regexp_eatFixedHexDigits=function(t,e){var n=t.pos;t.lastIntValue=0;for(var r=0;r<e;++r){var i=t.current();if(!zz(i))return t.pos=n,!1;t.lastIntValue=16*t.lastIntValue+Fz(i),t.advance()}return!0};var Uz=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new ZN(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},jz=QN.prototype;function Vz(t){return"function"!=typeof BigInt?null:BigInt(t.replace(/_/g,""))}function Gz(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}jz.next=function(t){!t&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Uz(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},jz.getToken=function(){return this.next(),new Uz(this)},"undefined"!=typeof Symbol&&(jz[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===RN.eof,value:e}}}}),jz.curContext=function(){return this.context[this.context.length-1]},jz.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(RN.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},jz.readToken=function(t){return AN(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},jz.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);return t<=55295||t>=57344?t:(t<<10)+this.input.charCodeAt(this.pos+1)-56613888},jz.skipBlockComment=function(){var t,e=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations)for(DN.lastIndex=n;(t=DN.exec(this.input))&&t.index<this.pos;)++this.curLine,this.lineStart=t.index+t[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,e,this.curPosition())},jz.skipLineComment=function(t){for(var e=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!NN(r);)r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,n,this.curPosition())},jz.skipSpace=function(){t:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(!(t>8&&t<14||t>=5760&&zN.test(String.fromCharCode(t))))break t;++this.pos}}},jz.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=t,this.value=e,this.updateContext(n)},jz.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===e?(this.pos+=3,this.finishToken(RN.ellipsis)):(++this.pos,this.finishToken(RN.dot))},jz.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(RN.assign,2):this.finishOp(RN.slash,1)},jz.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),n=1,r=42===t?RN.star:RN.modulo;return this.options.ecmaVersion>=7&&42===t&&42===e&&(++n,r=RN.starstar,e=this.input.charCodeAt(this.pos+2)),61===e?this.finishOp(RN.assign,n+1):this.finishOp(r,n)},jz.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);if(e===t){if(this.options.ecmaVersion>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(RN.assign,3);return this.finishOp(124===t?RN.logicalOR:RN.logicalAND,2)}return 61===e?this.finishOp(RN.assign,2):this.finishOp(124===t?RN.bitwiseOR:RN.bitwiseAND,1)},jz.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(RN.assign,2):this.finishOp(RN.bitwiseXOR,1)},jz.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?45!==e||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!ON.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(RN.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===e?this.finishOp(RN.assign,2):this.finishOp(RN.plusMin,1)},jz.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),n=1;return e===t?(n=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(RN.assign,n+1):this.finishOp(RN.bitShift,n)):33!==e||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===e&&(n=2),this.finishOp(RN.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},jz.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(RN.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===e&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(RN.arrow)):this.finishOp(61===t?RN.eq:RN.prefix,1)},jz.readToken_question=function(){var t=this.options.ecmaVersion;if(t>=11){var e=this.input.charCodeAt(this.pos+1);if(46===e){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(RN.questionDot,2)}if(63===e){if(t>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(RN.assign,3);return this.finishOp(RN.coalesce,2)}}return this.finishOp(RN.question,1)},jz.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(RN.parenL);case 41:return++this.pos,this.finishToken(RN.parenR);case 59:return++this.pos,this.finishToken(RN.semi);case 44:return++this.pos,this.finishToken(RN.comma);case 91:return++this.pos,this.finishToken(RN.bracketL);case 93:return++this.pos,this.finishToken(RN.bracketR);case 123:return++this.pos,this.finishToken(RN.braceL);case 125:return++this.pos,this.finishToken(RN.braceR);case 58:return++this.pos,this.finishToken(RN.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(RN.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(120===e||88===e)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===e||79===e)return this.readRadixNumber(8);if(98===e||66===e)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 63:return this.readToken_question();case 126:return this.finishOp(RN.prefix,1)}this.raise(this.pos,"Unexpected character '"+Gz(t)+"'")},jz.finishOp=function(t,e){var n=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,n)},jz.readRegexp=function(){for(var t,e,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(ON.test(r)&&this.raise(n,"Unterminated regular expression"),t)t=!1;else{if("["===r)e=!0;else if("]"===r&&e)e=!1;else if("/"===r&&!e)break;t="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var o=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(o);var s=this.regexpState||(this.regexpState=new Iz(this));s.reset(n,i,a),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var u=null;try{u=new RegExp(i,a)}catch(t){}return this.finishToken(RN.regexp,{pattern:i,flags:a,value:u})},jz.readInt=function(t,e,n){for(var r=this.options.ecmaVersion>=12&&void 0===e,i=n&&48===this.input.charCodeAt(this.pos),o=this.pos,a=0,s=0,u=0,l=null==e?1/0:e;u<l;++u,++this.pos){var c=this.input.charCodeAt(this.pos),h=void 0;if(r&&95===c)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===s&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===u&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),s=c;else{if((h=c>=97?c-97+10:c>=65?c-65+10:c>=48&&c<=57?c-48:1/0)>=t)break;s=c,a=a*t+h}}return r&&95===s&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===o||null!=e&&this.pos-o!==e?null:a},jz.readRadixNumber=function(t){var e=this.pos;this.pos+=2;var n=this.readInt(t);return null==n&&this.raise(this.start+2,"Expected number in radix "+t),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n=Vz(this.input.slice(e,this.pos)),++this.pos):AN(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(RN.num,n)},jz.readNumber=function(t){var e=this.pos;t||null!==this.readInt(10,void 0,!0)||this.raise(e,"Invalid number");var n=this.pos-e>=2&&48===this.input.charCodeAt(e);n&&this.strict&&this.raise(e,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!t&&this.options.ecmaVersion>=11&&110===r){var i=Vz(this.input.slice(e,this.pos));return++this.pos,AN(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(RN.num,i)}n&&/[89]/.test(this.input.slice(e,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(43!==(r=this.input.charCodeAt(++this.pos))&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(e,"Invalid number")),AN(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var o=function(t,e){return e?parseInt(t,8):parseFloat(t.replace(/_/g,""))}(this.input.slice(e,this.pos),n);return this.finishToken(RN.num,o)},jz.readCodePoint=function(){var t;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var e=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(e,"Code point out of bounds")}else t=this.readHexChar(4);return t},jz.readString=function(t){for(var e="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===t)break;92===r?(e+=this.input.slice(n,this.pos),e+=this.readEscapedChar(!1),n=this.pos):(NN(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(n,this.pos++),this.finishToken(RN.string,e)};var Hz={};jz.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t!==Hz)throw t;this.readInvalidTemplateToken()}this.inTemplateElement=!1},jz.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Hz;this.raise(t,e)},jz.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==RN.template&&this.type!==RN.invalidTemplate?(t+=this.input.slice(e,this.pos),this.finishToken(RN.template,t)):36===n?(this.pos+=2,this.finishToken(RN.dollarBraceL)):(++this.pos,this.finishToken(RN.backQuote));if(92===n)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(NN(n)){switch(t+=this.input.slice(e,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(n)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}},jz.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(RN.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},jz.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Gz(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(t){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(e>=48&&e<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,e=this.input.charCodeAt(this.pos),"0"===r&&56!==e&&57!==e||!this.strict&&!t||this.invalidStringToken(this.pos-1-r.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return NN(e)?"":String.fromCharCode(e)}},jz.readHexChar=function(t){var e=this.pos,n=this.readInt(16,t);return null===n&&this.invalidStringToken(e,"Bad character escape sequence"),n},jz.readWord1=function(){this.containsEsc=!1;for(var t="",e=!0,n=this.pos,r=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(TN(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,t+=this.input.slice(n,this.pos);var o=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(e?AN:TN)(a,r)||this.invalidStringToken(o,"Invalid Unicode escape"),t+=Gz(a),n=this.pos}e=!1}return t+this.input.slice(n,this.pos)},jz.readWord=function(){var t=this.readWord1(),e=RN.name;return this.keywords.test(t)&&(e=PN[t]),this.finishToken(e,t)};function Wz(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function Zz(t){var e="function"==typeof Map?new Map:void 0;return Zz=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return qz(t,arguments,Yz(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Xz(r,t)},Zz(t)}function qz(t,e,n){return qz=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Xz(i,n.prototype),i},qz.apply(null,arguments)}function Xz(t,e){return Xz=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Xz(t,e)}function Yz(t){return Yz=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Yz(t)}QN.acorn={Parser:QN,version:"7.4.1",defaultOptions:XN,Position:WN,SourceLocation:ZN,getLineInfo:qN,Node:dz,TokenType:CN,tokTypes:RN,keywordTypes:PN,TokContext:yz,tokContexts:gz,isIdentifierChar:TN,isIdentifierStart:AN,Token:Uz,isNewLine:NN,lineBreak:ON,lineBreakG:DN,nonASCIIwhitespace:zN};var Kz=function(t){function e(){return t.apply(this,arguments)||this}return Wz(e,t),e}(Zz(Error)),Qz=function(t){function e(){return t.apply(this,arguments)||this}return Wz(e,t),e}(Zz(SyntaxError)),Jz=function(t){function e(){return t.apply(this,arguments)||this}return Wz(e,t),e}(Zz(ReferenceError)),$z=function(t){function e(){return t.apply(this,arguments)||this}return Wz(e,t),e}(Zz(TypeError)),tF=function(t){function e(){return t.apply(this,arguments)||this}return Wz(e,t),e}(Kz),eF=function(t){function e(){return t.apply(this,arguments)||this}return Wz(e,t),e}(Qz),nF=function(t){function e(){return t.apply(this,arguments)||this}return Wz(e,t),e}(Jz),rF={UnknownError:[3001,"%0",tF],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",tF],NodeTypeSyntaxError:[1001,"Unknown node type: %0",nF],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",nF],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",nF],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",nF],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",nF],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",nF],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",nF],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",nF],ParamTypeSyntaxError:[1009,"Unknown param type: %0",nF],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",nF],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Jz],VariableUndefinedReferenceError:[2002,"%0 is not defined",Jz],IsNotConstructor:[2003,"%0 is not a constructor",$z]};function iF(t,e,n){return iF=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&oF(i,n.prototype),i},iF.apply(null,arguments)}function oF(t,e){return oF=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},oF(t,e)}function aF(t,e){Object.defineProperty(t,"name",{value:e,writable:!1,enumerable:!1,configurable:!0})}var sF=Object.prototype.hasOwnProperty,uF=Symbol("Break"),lF=Symbol("Continue"),cF=Symbol("DefaultCase"),hF=Symbol("EmptyStatementReturn"),pF=Symbol("WithScopeName"),fF=Symbol("SuperScopeName"),dF=Symbol("RootScopeName"),vF=Symbol("GlobalScopeName");function mF(t){return"function"==typeof t}var yF=function(){function t(t){this.interpreter=t}return t.prototype.generator=function(){var t=this.interpreter;return{getOptions:t.getOptions.bind(t),getCurrentScope:function(){return this.getCurrentScope()}.bind(t),getGlobalScope:function(){return this.getGlobalScope()}.bind(t),getCurrentContext:function(){return this.getCurrentContext()}.bind(t),getExecStartTime:t.getExecStartTime.bind(t)}},t}();function gF(t,e,n){if(void 0===n&&(n=!0),!(t instanceof yF))throw new Error("Illegal call");if("string"!=typeof e)return e;if(e){var r=t.generator(),i={timeout:r.getOptions().timeout,_initEnv:function(){n||this.setCurrentContext(r.getCurrentContext()),this.execStartTime=r.getExecStartTime(),this.execEndTime=this.execStartTime}},o=n?r.getGlobalScope():r.getCurrentScope();return new TF(o,i).evaluate(e)}}function _F(t){if(!(t instanceof yF))throw new Error("Illegal call");for(var e=t.generator(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r.pop(),a=new TF(e.getGlobalScope(),e.getOptions()),s="\n\t\t    (function anonymous("+r.join(",")+"){\n\t\t        "+o+"\n\t\t    });\n\t\t    ";return a.evaluate(s)}Object.defineProperty(gF,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(_F,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var xF=function(t){this.value=t},bF=function(t){this.value=t},wF=function(t){this.value=t},SF=function(t,e,n){void 0===e&&(e=null),this.name=n,this.parent=e,this.data=t,this.labelStack=[]};function EF(){}var AF={NaN:NaN,Infinity:1/0,undefined:void 0,Object:Object,Array:Array,String:String,Boolean:Boolean,Number:Number,Date:Date,RegExp:RegExp,Error:Error,URIError:URIError,TypeError:TypeError,RangeError:RangeError,SyntaxError:SyntaxError,ReferenceError:ReferenceError,Float32Array:Float32Array,Float64Array:Float64Array,Uint32Array:Uint32Array,Math:Math,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,isFinite:isFinite,decodeURI:decodeURI,decodeURIComponent:decodeURIComponent,encodeURI:encodeURI,encodeURIComponent:encodeURIComponent,escape:escape,unescape:unescape,eval:gF,Function:_F};"undefined"!=typeof JSON&&(AF.JSON=JSON),"undefined"!=typeof Promise&&(AF.Promise=Promise),"undefined"!=typeof Set&&(AF.Set=Set),"undefined"!=typeof Map&&(AF.Map=Map),"undefined"!=typeof Symbol&&(AF.Symbol=Symbol),"undefined"!=typeof Proxy&&(AF.Proxy=Proxy),"undefined"!=typeof WeakMap&&(AF.WeakMap=WeakMap),"undefined"!=typeof WeakSet&&(AF.WeakSet=WeakSet),"undefined"!=typeof Reflect&&(AF.Reflect=Reflect);var TF=function(){function t(e,n){void 0===e&&(e=t.global),void 0===n&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||t.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:void 0===n.globalContextInFunction?t.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=e||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var e=t.prototype;return e.initEnvironment=function(t){var e;if(t instanceof SF)e=t;else{var n=null,r=this.createSuperScope(t);this.options.rootContext&&(n=new SF(function(t){return Object.create(t)}(this.options.rootContext),r,dF)),e=new SF(t,n||r,vF)}this.globalScope=e,this.currentScope=this.globalScope,this.globalContext=e.data,this.currentContext=e.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var i=this.options._initEnv;i&&i.call(this)},e.getExecStartTime=function(){return this.execStartTime},e.getExecutionTime=function(){return this.execEndTime-this.execStartTime},e.setExecTimeout=function(t){void 0===t&&(t=0),this.options.timeout=t},e.getOptions=function(){return this.options},e.getGlobalScope=function(){return this.globalScope},e.getCurrentScope=function(){return this.currentScope},e.getCurrentContext=function(){return this.currentContext},e.isInterruptThrow=function(t){return t instanceof tF||t instanceof nF||t instanceof eF},e.createSuperScope=function(t){var e=Object.assign({},AF);return Object.keys(e).forEach((function(n){n in t&&delete e[n]})),new SF(e,null,fF)},e.setCurrentContext=function(t){this.currentContext=t},e.setCurrentScope=function(t){this.currentScope=t},e.evaluate=function(e){var n;if(void 0===e&&(e=""),e)return n=function(t,e){return QN.parse(t,e)}(e,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||t.ecmaVersion}),this.evaluateNode(n,e)},e.appendCode=function(t){return this.evaluate(t)},e.evaluateNode=function(t,e){var n=this;void 0===e&&(e=""),this.value=void 0,this.source=e,this.sourceList.push(e),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var r=this.getCurrentScope(),i=this.getCurrentContext(),o=r.labelStack.concat([]),a=this.callStack.concat([]);try{var s=this.createClosure(t);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),s()}catch(t){throw t}finally{n.setCurrentScope(r),n.setCurrentContext(i),r.labelStack=o,n.callStack=a,this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},e.createErrorMessage=function(t,e,n){var r=t[1].replace("%0",String(e));return null!==n&&(r+=this.getNodePosition(n||this.lastExecNode)),r},e.createError=function(t,e){return new e(t)},e.createThrowError=function(t,e){return this.createError(t,e)},e.createInternalThrowError=function(t,e,n){return this.createError(this.createErrorMessage(t,e,n),t[2])},e.checkTimeout=function(){if(!this.isRunning)return!1;var t=this.options.timeout||0;return Date.now()-this.execStartTime>t},e.getNodePosition=function(t){if(t){return t.loc?" ["+t.loc.start.line+":"+t.loc.start.column+"]":""}return""},e.createClosure=function(t){var e,n=this;switch(t.type){case"BinaryExpression":e=this.binaryExpressionHandler(t);break;case"LogicalExpression":e=this.logicalExpressionHandler(t);break;case"UnaryExpression":e=this.unaryExpressionHandler(t);break;case"UpdateExpression":e=this.updateExpressionHandler(t);break;case"ObjectExpression":e=this.objectExpressionHandler(t);break;case"ArrayExpression":e=this.arrayExpressionHandler(t);break;case"CallExpression":e=this.callExpressionHandler(t);break;case"NewExpression":e=this.newExpressionHandler(t);break;case"MemberExpression":e=this.memberExpressionHandler(t);break;case"ThisExpression":e=this.thisExpressionHandler(t);break;case"SequenceExpression":e=this.sequenceExpressionHandler(t);break;case"Literal":e=this.literalHandler(t);break;case"Identifier":e=this.identifierHandler(t);break;case"AssignmentExpression":e=this.assignmentExpressionHandler(t);break;case"FunctionDeclaration":e=this.functionDeclarationHandler(t);break;case"VariableDeclaration":e=this.variableDeclarationHandler(t);break;case"BlockStatement":case"Program":e=this.programHandler(t);break;case"ExpressionStatement":e=this.expressionStatementHandler(t);break;case"EmptyStatement":e=this.emptyStatementHandler(t);break;case"ReturnStatement":e=this.returnStatementHandler(t);break;case"FunctionExpression":e=this.functionExpressionHandler(t);break;case"IfStatement":e=this.ifStatementHandler(t);break;case"ConditionalExpression":e=this.conditionalExpressionHandler(t);break;case"ForStatement":e=this.forStatementHandler(t);break;case"WhileStatement":e=this.whileStatementHandler(t);break;case"DoWhileStatement":e=this.doWhileStatementHandler(t);break;case"ForInStatement":e=this.forInStatementHandler(t);break;case"WithStatement":e=this.withStatementHandler(t);break;case"ThrowStatement":e=this.throwStatementHandler(t);break;case"TryStatement":e=this.tryStatementHandler(t);break;case"ContinueStatement":e=this.continueStatementHandler(t);break;case"BreakStatement":e=this.breakStatementHandler(t);break;case"SwitchStatement":e=this.switchStatementHandler(t);break;case"LabeledStatement":e=this.labeledStatementHandler(t);break;case"DebuggerStatement":e=this.debuggerStatementHandler(t);break;default:throw this.createInternalThrowError(rF.NodeTypeSyntaxError,t.type,t)}return function(){var r=n.options.timeout;if(r&&r>0&&n.checkTimeout())throw n.createInternalThrowError(rF.ExecutionTimeOutError,r,null);return n.lastExecNode=t,e.apply(void 0,arguments)}},e.binaryExpressionHandler=function(t){var e=this,n=this.createClosure(t.left),r=this.createClosure(t.right);return function(){var i=n(),o=r();switch(t.operator){case"==":return i==o;case"!=":return i!=o;case"===":return i===o;case"!==":return i!==o;case"<":return i<o;case"<=":return i<=o;case">":return i>o;case">=":return i>=o;case"<<":return i<<o;case">>":return i>>o;case">>>":return i>>>o;case"+":return i+o;case"-":return i-o;case"*":return i*o;case"**":return Math.pow(i,o);case"/":return i/o;case"%":return i%o;case"|":return i|o;case"^":return i^o;case"&":return i&o;case"in":return i in o;case"instanceof":return i instanceof o;default:throw e.createInternalThrowError(rF.BinaryOperatorSyntaxError,t.operator,t)}}},e.logicalExpressionHandler=function(t){var e=this,n=this.createClosure(t.left),r=this.createClosure(t.right);return function(){switch(t.operator){case"||":return n()||r();case"&&":return n()&&r();default:throw e.createInternalThrowError(rF.LogicalOperatorSyntaxError,t.operator,t)}}},e.unaryExpressionHandler=function(t){var e,n=this;if("delete"===t.operator){var r=this.createObjectGetter(t.argument),i=this.createNameGetter(t.argument);return function(){return delete r()[i()]}}if("typeof"===t.operator&&"Identifier"===t.argument.type){var o=this.createObjectGetter(t.argument),a=this.createNameGetter(t.argument);e=function(){return o()[a()]}}else e=this.createClosure(t.argument);return function(){var r=e();switch(t.operator){case"-":return-r;case"+":return+r;case"!":return!r;case"~":return~r;case"void":return;case"typeof":return typeof r;default:throw n.createInternalThrowError(rF.UnaryOperatorSyntaxError,t.operator,t)}}},e.updateExpressionHandler=function(t){var e=this,n=this.createObjectGetter(t.argument),r=this.createNameGetter(t.argument);return function(){var i=n(),o=r();switch(e.assertVariable(i,o,t),t.operator){case"++":return t.prefix?++i[o]:i[o]++;case"--":return t.prefix?--i[o]:i[o]--;default:throw e.createInternalThrowError(rF.UpdateOperatorSyntaxError,t.operator,t)}}},e.objectExpressionHandler=function(t){var e=this,n=[];var r=Object.create(null);return t.properties.forEach((function(t){var i=t.kind,o=function(t){return"Identifier"===t.type?t.name:"Literal"===t.type?t.value:this.throwError(rF.ObjectStructureSyntaxError,t.type,t)}(t.key);r[o]&&"init"!==i||(r[o]={}),r[o][i]=e.createClosure(t.value),n.push({key:o,property:t})})),function(){for(var t={},e=n.length,i=0;i<e;i++){var o=n[i],a=o.key,s=r[a],u=s.init?s.init():void 0,l=s.get?s.get():function(){},c=s.set?s.set():function(t){};if("set"in s||"get"in s){var h={configurable:!0,enumerable:!0,get:l,set:c};Object.defineProperty(t,a,h)}else{var p=o.property,f=p.kind;"Identifier"!==p.key.type||"FunctionExpression"!==p.value.type||"init"!==f||p.value.id||aF(u,p.key.name),t[a]=u}}return t}},e.arrayExpressionHandler=function(t){var e=this,n=t.elements.map((function(t){return t?e.createClosure(t):t}));return function(){for(var t=n.length,e=Array(t),r=0;r<t;r++){var i=n[r];i&&(e[r]=i())}return e}},e.safeObjectGet=function(t,e,n){return t[e]},e.createCallFunctionGetter=function(t){var e=this;if("MemberExpression"===t.type){var n=this.createClosure(t.object),r=this.createMemberKeyGetter(t),i=this.source;return function(){var o=n(),a=r(),s=e.safeObjectGet(o,a,t);if(!s||!mF(s)){var u=i.slice(t.start,t.end);throw e.createInternalThrowError(rF.FunctionUndefinedReferenceError,u,t)}return s.__IS_EVAL_FUNC?function(t){return s(new yF(e),t,!0)}:s.__IS_FUNCTION_FUNC?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return s.apply(void 0,[new yF(e)].concat(n))}:s.bind(o)}}var o=this.createClosure(t);return function(){var n="";"Identifier"===t.type&&(n=t.name);var r=o();if(!r||!mF(r))throw e.createInternalThrowError(rF.FunctionUndefinedReferenceError,n,t);if("Identifier"===t.type&&r.__IS_EVAL_FUNC&&"eval"===n)return function(t){var i=e.getScopeFromName(n,e.getCurrentScope()),o=i.name===fF||i.name===vF||i.name===dF;return r(new yF(e),t,!o)};if(r.__IS_EVAL_FUNC)return function(t){return r(new yF(e),t,!0)};if(r.__IS_FUNCTION_FUNC)return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.apply(void 0,[new yF(e)].concat(n))};var i=e.options.globalContextInFunction;if("Identifier"===t.type){var a=e.getIdentifierScope(t);a.name===pF&&(i=a.data)}return r.bind(i)}},e.callExpressionHandler=function(t){var e=this,n=this.createCallFunctionGetter(t.callee),r=t.arguments.map((function(t){return e.createClosure(t)}));return function(){return n().apply(void 0,r.map((function(t){return t()})))}},e.functionExpressionHandler=function(t){var e=this,n=this,r=this.source,i=this.collectDeclVars,o=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var a=t.id?t.id.name:"",s=t.params.length,u=t.params.map((function(t){return e.createParamNameGetter(t)})),l=this.createClosure(t.body),c=this.collectDeclVars,h=this.collectDeclFuncs;return this.collectDeclVars=i,this.collectDeclFuncs=o,function(){var e=n.getCurrentScope(),i=function t(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.callStack.push(""+a);var s=n.getCurrentScope(),p=function(t,e){return void 0===t&&(t=null),new SF(Object.create(null),t,e)}(e,"FunctionScope("+a+")");n.setCurrentScope(p),n.addDeclarationsToScope(c,h,p),a&&(p.data[a]=t),p.data.arguments=arguments,u.forEach((function(t,e){p.data[t()]=i[e]}));var f=n.getCurrentContext();n.setCurrentContext(this);var d=l();if(n.setCurrentContext(f),n.setCurrentScope(s),n.callStack.pop(),d instanceof xF)return d.value};return aF(i,a),Object.defineProperty(i,"length",{value:s,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(i,"toString",{value:function(){return r.slice(t.start,t.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(i,"valueOf",{value:function(){return r.slice(t.start,t.end)},writable:!0,configurable:!0,enumerable:!1}),i}},e.newExpressionHandler=function(t){var e=this,n=this.source,r=this.createClosure(t.callee),i=t.arguments.map((function(t){return e.createClosure(t)}));return function(){var o=r();if(!mF(o)||o.__IS_EVAL_FUNC){var a=t.callee,s=n.slice(a.start,a.end);throw e.createInternalThrowError(rF.IsNotConstructor,s,t)}return o.__IS_FUNCTION_FUNC?o.apply(void 0,[new yF(e)].concat(i.map((function(t){return t()})))):iF(o,i.map((function(t){return t()})))}},e.memberExpressionHandler=function(t){var e=this.createClosure(t.object),n=this.createMemberKeyGetter(t);return function(){return e()[n()]}},e.thisExpressionHandler=function(t){var e=this;return function(){return e.getCurrentContext()}},e.sequenceExpressionHandler=function(t){var e=this,n=t.expressions.map((function(t){return e.createClosure(t)}));return function(){for(var t,e=n.length,r=0;r<e;r++){t=(0,n[r])()}return t}},e.literalHandler=function(t){return function(){return t.regex?new RegExp(t.regex.pattern,t.regex.flags):t.value}},e.identifierHandler=function(t){var e=this;return function(){var n=e.getCurrentScope(),r=e.getScopeDataFromName(t.name,n);return e.assertVariable(r,t.name,t),r[t.name]}},e.getIdentifierScope=function(t){var e=this.getCurrentScope();return this.getScopeFromName(t.name,e)},e.assignmentExpressionHandler=function(t){var e=this;"Identifier"!==t.left.type||"FunctionExpression"!==t.right.type||t.right.id||(t.right.id={type:"Identifier",name:t.left.name});var n=this.createObjectGetter(t.left),r=this.createNameGetter(t.left),i=this.createClosure(t.right);return function(){var o=n(),a=r(),s=i();switch("="!==t.operator&&e.assertVariable(o,a,t),t.operator){case"=":return o[a]=s;case"+=":return o[a]+=s;case"-=":return o[a]-=s;case"*=":return o[a]*=s;case"**=":return o[a]=Math.pow(o[a],s);case"/=":return o[a]/=s;case"%=":return o[a]%=s;case"<<=":return o[a]<<=s;case">>=":return o[a]>>=s;case">>>=":return o[a]>>>=s;case"&=":return o[a]&=s;case"^=":return o[a]^=s;case"|=":return o[a]|=s;default:throw e.createInternalThrowError(rF.AssignmentExpressionSyntaxError,t.type,t)}}},e.functionDeclarationHandler=function(t){if(t.id){var e=this.functionExpressionHandler(t);Object.defineProperty(e,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(t.id.name,e)}return function(){return hF}},e.getVariableName=function(t){if("Identifier"===t.type)return t.name;throw this.createInternalThrowError(rF.VariableTypeSyntaxError,t.type,t)},e.variableDeclarationHandler=function(t){for(var e,n=this,r=[],i=0;i<t.declarations.length;i++){var o=t.declarations[i];this.varDeclaration(this.getVariableName(o.id)),o.init&&r.push({type:"AssignmentExpression",operator:"=",left:o.id,right:o.init})}return r.length&&(e=this.createClosure({type:"BlockStatement",body:r})),function(){if(e){var t=n.isVarDeclMode;n.isVarDeclMode=!0,e(),n.isVarDeclMode=t}return hF}},e.assertVariable=function(t,e,n){if(t===this.globalScope.data&&!(e in t))throw this.createInternalThrowError(rF.VariableUndefinedReferenceError,e,n)},e.programHandler=function(t){var e=this,n=t.body.map((function(t){return e.createClosure(t)}));return function(){for(var t=hF,r=0;r<n.length;r++){var i=n[r],o=e.setValue(i());if(o!==hF&&((t=o)instanceof xF||t instanceof bF||t instanceof wF||t===uF||t===lF))break}return t}},e.expressionStatementHandler=function(t){return this.createClosure(t.expression)},e.emptyStatementHandler=function(t){return function(){return hF}},e.returnStatementHandler=function(t){var e=t.argument?this.createClosure(t.argument):EF;return function(){return new xF(e())}},e.ifStatementHandler=function(t){var e=this.createClosure(t.test),n=this.createClosure(t.consequent),r=t.alternate?this.createClosure(t.alternate):
/*!important*/
function(){return hF};return function(){return e()?n():r()}},e.conditionalExpressionHandler=function(t){return this.ifStatementHandler(t)},e.forStatementHandler=function(t){var e=this,n=EF,r=t.test?this.createClosure(t.test):function(){return!0},i=EF,o=this.createClosure(t.body);return"ForStatement"===t.type&&(n=t.init?this.createClosure(t.init):n,i=t.update?this.createClosure(t.update):EF),function(a){var s,u=hF,l="DoWhileStatement"===t.type;for(a&&"LabeledStatement"===a.type&&(s=a.label.name),n();l||r();i()){l=!1;var c=e.setValue(o());if(c!==hF&&c!==lF){if(c===uF)break;if((u=c)instanceof wF&&u.value===s)u=hF;else if(u instanceof xF||u instanceof bF||u instanceof wF)break}}return u}},e.whileStatementHandler=function(t){return this.forStatementHandler(t)},e.doWhileStatementHandler=function(t){return this.forStatementHandler(t)},e.forInStatementHandler=function(t){var e=this,n=t.left,r=this.createClosure(t.right),i=this.createClosure(t.body);return"VariableDeclaration"===t.left.type&&(this.createClosure(t.left)(),n=t.left.declarations[0].id),function(t){var o,a,s=hF;t&&"LabeledStatement"===t.type&&(o=t.label.name);var u=r();for(a in u){e.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:n,right:{type:"Literal",value:a}})();var l=e.setValue(i());if(l!==hF&&l!==lF){if(l===uF)break;if((s=l)instanceof wF&&s.value===o)s=hF;else if(s instanceof xF||s instanceof bF||s instanceof wF)break}}return s}},e.withStatementHandler=function(t){var e=this,n=this.createClosure(t.object),r=this.createClosure(t.body);return function(){var t=n(),i=e.getCurrentScope(),o=new SF(t,i,pF);e.setCurrentScope(o);var a=e.setValue(r());return e.setCurrentScope(i),a}},e.throwStatementHandler=function(t){var e=this,n=this.createClosure(t.argument);return function(){throw e.setValue(void 0),n()}},e.tryStatementHandler=function(t){var e=this,n=this.createClosure(t.block),r=t.handler?this.catchClauseHandler(t.handler):null,i=t.finalizer?this.createClosure(t.finalizer):null;return function(){var t,o,a=e.getCurrentScope(),s=e.getCurrentContext(),u=a.labelStack.concat([]),l=e.callStack.concat([]),c=hF,h=function(){e.setCurrentScope(a),e.setCurrentContext(s),a.labelStack=u,e.callStack=l};try{(c=e.setValue(n()))instanceof xF&&(t=c)}catch(n){if(h(),e.isInterruptThrow(n))throw n;if(r)try{(c=e.setValue(r(n)))instanceof xF&&(t=c)}catch(t){if(h(),e.isInterruptThrow(t))throw t;o=t}}if(i)try{(c=i())instanceof xF&&(t=c)}catch(t){if(h(),e.isInterruptThrow(t))throw t;o=t}if(o)throw o;return t||c}},e.catchClauseHandler=function(t){var e=this,n=this.createParamNameGetter(t.param),r=this.createClosure(t.body);return function(t){var i,o=e.getCurrentScope().data,a=n(),s=sF.call(o,a),u=o[a];return o[a]=t,i=r(),s?o[a]=u:delete o[a],i}},e.continueStatementHandler=function(t){return function(){return t.label?new wF(t.label.name):lF}},e.breakStatementHandler=function(t){return function(){return t.label?new bF(t.label.name):uF}},e.switchStatementHandler=function(t){var e=this,n=this.createClosure(t.discriminant),r=t.cases.map((function(t){return e.switchCaseHandler(t)}));return function(){for(var t,i,o,a=n(),s=!1,u=0;u<r.length;u++){var l=r[u](),c=l.testClosure();if(c!==cF){if(s||c===a){if(s=!0,(i=e.setValue(l.bodyClosure()))===hF)continue;if(i===uF)break;if((t=i)instanceof xF||t instanceof bF||t instanceof wF||t===lF)break}}else o=l}!s&&o&&((i=e.setValue(o.bodyClosure()))===hF||i===uF||i===lF||(t=i));return t}},e.switchCaseHandler=function(t){var e=t.test?this.createClosure(t.test):function(){return cF},n=this.createClosure({type:"BlockStatement",body:t.consequent});return function(){return{testClosure:e,bodyClosure:n}}},e.labeledStatementHandler=function(t){var e=this,n=t.label.name,r=this.createClosure(t.body);return function(){var i,o=e.getCurrentScope();return o.labelStack.push(n),(i=r(t))instanceof bF&&i.value===n&&(i=hF),o.labelStack.pop(),i}},e.debuggerStatementHandler=function(t){return function(){return hF}},e.createParamNameGetter=function(t){if("Identifier"===t.type)return function(){return t.name};throw this.createInternalThrowError(rF.ParamTypeSyntaxError,t.type,t)},e.createObjectKeyGetter=function(t){var e;return e="Identifier"===t.type?function(){return t.name}:this.createClosure(t),function(){return e()}},e.createMemberKeyGetter=function(t){return t.computed?this.createClosure(t.property):this.createObjectKeyGetter(t.property)},e.createObjectGetter=function(t){var e=this;switch(t.type){case"Identifier":return function(){return e.getScopeDataFromName(t.name,e.getCurrentScope())};case"MemberExpression":return this.createClosure(t.object);default:throw this.createInternalThrowError(rF.AssignmentTypeSyntaxError,t.type,t)}},e.createNameGetter=function(t){switch(t.type){case"Identifier":return function(){return t.name};case"MemberExpression":return this.createMemberKeyGetter(t);default:throw this.createInternalThrowError(rF.AssignmentTypeSyntaxError,t.type,t)}},e.varDeclaration=function(t){this.collectDeclVars[t]=void 0},e.funcDeclaration=function(t,e){this.collectDeclFuncs[t]=e},e.addDeclarationsToScope=function(t,e,n){var r=n.data;for(var i in e){var o=e[i];r[i]=o?o():o}for(var a in t)a in r||(r[a]=void 0)},e.getScopeValue=function(t,e){return this.getScopeFromName(t,e).data[t]},e.getScopeDataFromName=function(t,e){return this.getScopeFromName(t,e).data},e.getScopeFromName=function(t,e){var n=e;do{if(t in n.data)return n}while(n=n.parent);return this.globalScope},e.setValue=function(t){var e=this.callStack.length;return this.isVarDeclMode||e||t===hF||t===uF||t===lF||t instanceof bF||t instanceof wF||(this.value=t instanceof xF?t.value:t),t},e.getValue=function(){return this.value},t}();function CF(t,e,n){void 0===e&&(e=[]),void 0===n&&(n={});var r=n.parsingContext,i=void 0===n.timeout?0:n.timeout,o="\n    (function anonymous("+e.join(",")+"){\n         "+t+"\n    });\n    ";return new TF(r,{ecmaVersion:n.ecmaVersion,timeout:i,rootContext:n.rootContext,globalContextInFunction:n.globalContextInFunction}).evaluate(o)}function kF(t,e,n){return new TF(e,n).evaluate(t)}TF.version="0.0.3",TF.eval=gF,TF.Function=_F,TF.ecmaVersion=5,TF.globalContextInFunction=void 0,TF.global=Object.create(null);var MF=kF,IF=function(){function t(t){this._code=t}var e=t.prototype;return e.runInContext=function(t){return kF(this._code,t)},e.runInNewContext=function(t){return kF(this._code,t)},t}(),PF=Object.freeze({__proto__:null,createContext:function(t){return void 0===t&&(t=Object.create(null)),t},compileFunction:CF,runInContext:kF,runInNewContext:MF,Script:IF}),LF=function(t,e,n){return kF(t,e,n)};var RF=Object.freeze({__proto__:null,Interpreter:TF,vm:PF,evaluate:LF,Function:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return CF(e.pop()||"",e)},default:LF}),OF=N(RF);!function(t,e){t.exports=function(t){var e=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},n=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},r="\n";function i(t){return"undefined"!=typeof atob?atob(t):"base64:"+t}function o(t){var e=new Error("(regl) "+t);throw console.error(e),e}function a(t,e){t||o(e)}function s(t){return t?": "+t:""}function u(t,e,n){t in e||o("unknown parameter ("+t+")"+s(n)+". possible values: "+Object.keys(e).join())}function l(t,n){e(t)||o("invalid parameter type"+s(n)+". must be a typed array")}function c(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function h(t,e,n){c(t,e)||o("invalid parameter type"+s(n)+". expected "+e+", got "+typeof t)}function p(t,e){t>=0&&(0|t)===t||o("invalid parameter type, ("+t+")"+s(e)+". must be a nonnegative integer")}function f(t,e,n){e.indexOf(t)<0&&o("invalid value"+s(n)+". must be one of: "+e)}var d=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function v(t){Object.keys(t).forEach((function(t){d.indexOf(t)<0&&o('invalid regl constructor argument "'+t+'". must be one of '+d)}))}function m(t,e){for(t+="";t.length<e;)t=" "+t;return t}function y(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function g(t,e){this.number=t,this.line=e,this.errors=[]}function _(t,e,n){this.file=t,this.line=e,this.message=n}function x(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function b(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function w(t,e){var n=t.split("\n"),r=1,o=0,a={unknown:new y,0:new y};a.unknown.name=a[0].name=e||x(),a.unknown.lines.push(new g(0,""));for(var s=0;s<n.length;++s){var u=n[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(r=0|c[1],c[2]&&((o=0|c[2])in a||(a[o]=new y)));break;case"define":var h=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);h&&(a[o].name=h[1]?i(h[2]):h[2])}a[o].lines.push(new g(r++,u))}return Object.keys(a).forEach((function(t){var e=a[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),a}function S(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new _(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new _("unknown",0,t))}})),e}function E(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))}function A(t,e,n,i,o){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var s=t.getShaderInfoLog(e),u=i===t.FRAGMENT_SHADER?"fragment":"vertex";L(n,"string",u+" shader source must be a string",o);var l=w(n,o),c=S(s);E(l,c),Object.keys(l).forEach((function(t){var e=l[t];if(e.hasErrors){var n=[""],i=[""];o("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){o(m(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(t.line+r,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(n){var i=n.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),e=Math.max(t.line.indexOf(s,e),0)}else e=0;o(m("| ",6)),o(m("^^^",e+3)+r,"font-weight:bold"),o(m("| ",6)),o(i+r,"font-weight:bold")})),o(m("| ",6)+r)}else o(m(t.number,4)+"|  "),o(t.line+r,"color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(i[0]=n.join("%c"),console.log.apply(console,i))}function o(t,e){n.push(t),i.push(e||"")}})),a.raise("Error compiling "+u+" shader, "+l[0].name)}}function T(t,e,n,i,o){if(!t.getProgramParameter(e,t.LINK_STATUS)){var s=t.getProgramInfoLog(e),u=w(n,o),l='Error linking program with vertex shader, "'+w(i,o)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+l+r+"%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(l+r+s),a.raise(l)}}function C(t){t._commandRef=x()}function k(t,e,n,r){function i(t){return t?r.id(t):0}function o(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}C(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var a=t._uniformSet={};o(a,e.static),o(a,e.dynamic);var s=t._attributeSet={};o(s,n.static),o(s,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function M(t,e){var n=b();o(t+" in command "+(e||x())+("unknown"===n?"":" called from "+n))}function I(t,e,n){t||M(e,n||x())}function P(t,e,n,r){t in e||M("unknown parameter ("+t+")"+s(n)+". possible values: "+Object.keys(e).join(),r||x())}function L(t,e,n,r){c(t,e)||M("invalid parameter type"+s(n)+". expected "+e+", got "+typeof t,r||x())}function R(t){t()}function O(t,e,n){t.texture?f(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):f(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var D=33071,N=9728,z=9984,F=9985,B=9986,U=9987,j=5121,V=5122,G=5123,H=5124,W=5125,Z=5126,q=32819,X=32820,Y=33635,K=34042,Q=36193,J={};function $(t,e){return t===X||t===q||t===Y?2:t===K?4:J[t]*e}function tt(t){return!(t&t-1||!t)}function et(t,e,n){var r,i=e.width,o=e.height,s=e.channels;a(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),t.wrapS===D&&t.wrapT===D||a(tt(i)&&tt(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==o&&a(t.minFilter!==z&&t.minFilter!==B&&t.minFilter!==F&&t.minFilter!==U,"min filter requires mipmap"):(a(tt(i)&&tt(o),"texture must be a square power of 2 to support mipmapping"),a(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),e.type===Z&&(n.extensions.indexOf("oes_texture_float_linear")<0&&a(t.minFilter===N&&t.magFilter===N,"filter not supported, must enable oes_texture_float_linear"),a(!t.genMipmaps,"mipmap generation not supported with float textures"));var u=e.images;for(r=0;r<16;++r)if(u[r]){var l=i>>r,c=o>>r;a(e.mipmask&1<<r,"missing mipmap data");var h=u[r];if(a(h.width===l&&h.height===c,"invalid shape for mip images"),a(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed);else if(h.data){var p=Math.ceil($(h.type,s)*l/h.unpackAlignment)*h.unpackAlignment;a(h.data.byteLength===p*c,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else t.genMipmaps||a(0==(e.mipmask&1<<r),"extra mipmap data");e.compressed&&a(!t.genMipmaps,"mipmap generation for compressed images not supported")}function nt(t,e,n,r){var i=t.width,o=t.height,s=t.channels;a(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),a(i===o,"cube map must be square"),a(e.wrapS===D&&e.wrapT===D,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];a(l.width===i&&l.height===o,"inconsistent cube map face shape"),e.genMipmaps&&(a(!l.compressed,"can not generate mipmap for compressed textures"),a(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,h=0;h<16;++h){var p=c[h];if(p){var f=i>>h,d=o>>h;a(l.mipmask&1<<h,"missing mipmap data"),a(p.width===f&&p.height===d,"invalid shape for mip images"),a(p.format===t.format&&p.internalformat===t.internalformat&&p.type===t.type,"incompatible type for mip image"),p.compressed||(p.data?a(p.data.byteLength===f*d*Math.max($(p.type,s),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):p.element||p.copy)}}}}J[5120]=J[j]=1,J[V]=J[G]=J[Q]=J[Y]=J[q]=J[X]=2,J[H]=J[W]=J[Z]=J[K]=4;var rt=n(a,{optional:R,raise:o,commandRaise:M,command:I,parameter:u,commandParameter:P,constructor:v,type:h,commandType:L,isTypedArray:l,nni:p,oneOf:f,shaderError:A,linkError:T,callSite:b,saveCommandRef:C,saveDrawInfo:k,framebufferFormat:O,guessCommand:x,texture2D:et,textureCube:nt}),it=0,ot=0,at=5,st=6;function ut(t,e){this.id=it++,this.type=t,this.data=e}function lt(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ct(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+lt(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return ct(t.substr(0,r.index)).concat(ct(r[1])).concat(ct(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+lt(t)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(ct(i[a]));return o}function ht(t){return"["+ct(t).join("][")+"]"}function pt(t,e){return new ut(t,ht(e+""))}function ft(t){return"function"==typeof t&&!t._reglType||t instanceof ut}function dt(t,e){return"function"==typeof t?new ut(ot,t):"number"==typeof t||"boolean"==typeof t?new ut(at,t):Array.isArray(t)?new ut(st,t.map((function(t,n){return dt(t,e+"["+n+"]")}))):t instanceof ut?t:void rt(!1,"invalid option type in uniform "+e)}var vt={DynamicVariable:ut,define:pt,isDynamic:ft,unbox:dt,accessor:ht},mt={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},yt="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,gt=yt?function(){return+new Date}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function _t(){var t={"":0},e=[""];return{id:function(n){var r=t[n];return r||(r=t[n]=e.length,e.push(n),r)},str:function(t){return e[t]}}}function xt(t,e,r){var i,o=document.createElement("canvas");function a(){var e=window.innerWidth,n=window.innerHeight;if(t!==document.body){var i=o.getBoundingClientRect();e=i.right-i.left,n=i.bottom-i.top}o.width=r*e,o.height=r*n}function s(){i?i.disconnect():window.removeEventListener("resize",a),t.removeChild(o)}return n(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),t.appendChild(o),t===document.body&&(o.style.position="absolute",n(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(t):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:s}}function bt(t,e){function n(n){try{return t.getContext(n,e)}catch(t){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function wt(t){return"string"==typeof t.nodeName&&"function"==typeof t.appendChild&&"function"==typeof t.getBoundingClientRect}function St(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}function Et(t){return"string"==typeof t?t.split():(rt(Array.isArray(t),"invalid extension array"),t)}function At(t){return"string"==typeof t?(rt("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function Tt(t){var e,n,r,i,o=t||{},a={},s=[],u=[],l="undefined"==typeof window?1:window.devicePixelRatio,c=!1,h=function(t){t&&rt.raise(t)},p=function(){};if("string"==typeof o?(rt("undefined"!=typeof document,"selector queries only supported in DOM environments"),e=document.querySelector(o),rt(e,"invalid query string for element")):"object"==typeof o?wt(o)?e=o:St(o)?r=(i=o).canvas:(rt.constructor(o),"gl"in o?i=o.gl:"canvas"in o?r=At(o.canvas):"container"in o&&(n=At(o.container)),"attributes"in o&&(a=o.attributes,rt.type(a,"object","invalid context attributes")),"extensions"in o&&(s=Et(o.extensions)),"optionalExtensions"in o&&(u=Et(o.optionalExtensions)),"onDone"in o&&(rt.type(o.onDone,"function","invalid or missing onDone callback"),h=o.onDone),"profile"in o&&(c=!!o.profile),"pixelRatio"in o&&(l=+o.pixelRatio,rt(l>0,"invalid pixel ratio"))):rt.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?r=e:n=e),!i){if(!r){rt("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var f=xt(n||document.body,h,l);if(!f)return null;r=f.canvas,p=f.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),i=bt(r,a)}return i?{gl:i,canvas:r,container:n,extensions:s,optionalExtensions:u,pixelRatio:l,profile:c,onDone:h,onDestroy:p}:(p(),h("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ct(t,e){var n={};function r(t){rt.type(t,"string","extension name must be string");var e,r=t.toLowerCase();try{e=n[r]=i(t)}catch(t){}return!!e}function i(e){return t.getExtension(e)?t.getExtension(e):t.getExtension(e.toLowerCase())?t.getExtension(e.toLowerCase()):null}for(var o=0;o<e.extensions.length;++o){var a=e.extensions[o];if(!r(a))return e.onDestroy(),e.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}function kt(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}var Mt=5120,It=5121,Pt=5122,Lt=5123,Rt=5124,Ot=5125,Dt=5126;function Nt(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function zt(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function Ft(){var t=kt(8,(function(){return[]}));function e(e){var n=Nt(e),r=t[zt(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[zt(e.byteLength)>>2].push(e)}function r(t,n){var r=null;switch(t){case Mt:r=new Int8Array(e(n),0,n);break;case It:r=new Uint8Array(e(n),0,n);break;case Pt:r=new Int16Array(e(2*n),0,n);break;case Lt:r=new Uint16Array(e(2*n),0,n);break;case Rt:r=new Int32Array(e(4*n),0,n);break;case Ot:r=new Uint32Array(e(4*n),0,n);break;case Dt:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(t){n(t.buffer)}return{alloc:e,free:n,allocType:r,freeType:i}}var Bt=Ft();Bt.zero=Ft();var Ut=3408,jt=3410,Vt=3411,Gt=3412,Ht=3413,Wt=3414,Zt=3415,qt=33901,Xt=33902,Yt=3379,Kt=3386,Qt=34921,Jt=36347,$t=36348,te=35661,ee=35660,ne=34930,re=36349,ie=34076,oe=34024,ae=7936,se=7937,ue=7938,le=35724,ce=34047,he=36063,pe=34852,fe=3553,de=34067,ve=34069,me=33984,ye=6408,ge=5126,_e=5121,xe=36160,be=36053,we=36064,Se=16384,Ee=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(ce));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(pe),i=t.getParameter(he));var o=!!e.oes_texture_float;if(o){var a=t.createTexture();t.bindTexture(fe,a),t.texImage2D(fe,0,ye,1,1,0,ye,ge,null);var s=t.createFramebuffer();if(t.bindFramebuffer(xe,s),t.framebufferTexture2D(xe,we,fe,a,0),t.bindTexture(fe,null),t.checkFramebufferStatus(xe)!==be)o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(Se);var u=Bt.allocType(ge,4);t.readPixels(0,0,1,1,ye,ge,u),t.getError()?o=!1:(t.deleteFramebuffer(s),t.deleteTexture(a),o=1===u[0]),Bt.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=t.createTexture(),h=Bt.allocType(_e,36);t.activeTexture(me),t.bindTexture(de,c),t.texImage2D(ve,0,ye,3,3,0,ye,_e,h),Bt.freeType(h),t.bindTexture(de,null),t.deleteTexture(c),l=!t.getError()}return{colorBits:[t.getParameter(jt),t.getParameter(Vt),t.getParameter(Gt),t.getParameter(Ht)],depthBits:t.getParameter(Wt),stencilBits:t.getParameter(Zt),subpixelBits:t.getParameter(Ut),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(qt),lineWidthDims:t.getParameter(Xt),maxViewportDims:t.getParameter(Kt),maxCombinedTextureUnits:t.getParameter(te),maxCubeMapSize:t.getParameter(ie),maxRenderbufferSize:t.getParameter(oe),maxTextureUnits:t.getParameter(ne),maxTextureSize:t.getParameter(Yt),maxAttributes:t.getParameter(Qt),maxVertexUniforms:t.getParameter(Jt),maxVertexTextureUnits:t.getParameter(ee),maxVaryingVectors:t.getParameter($t),maxFragmentUniforms:t.getParameter(re),glsl:t.getParameter(le),renderer:t.getParameter(se),vendor:t.getParameter(ae),version:t.getParameter(ue),readFloat:o,npotTextureCube:l}};function Ae(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var Te=function(t){return Object.keys(t).map((function(e){return t[e]}))},Ce={shape:Re,flatten:Le};function ke(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}function Me(t,e,n,r){for(var i=0,o=0;o<e;++o)for(var a=t[o],s=0;s<n;++s)r[i++]=a[s]}function Ie(t,e,n,r,i,o){for(var a=o,s=0;s<e;++s)for(var u=t[s],l=0;l<n;++l)for(var c=u[l],h=0;h<r;++h)i[a++]=c[h]}function Pe(t,e,n,r,i){for(var o=1,a=n+1;a<e.length;++a)o*=e[a];var s=e[n];if(e.length-n==4){var u=e[n+1],l=e[n+2],c=e[n+3];for(a=0;a<s;++a)Ie(t[a],u,l,c,r,i),i+=o}else for(a=0;a<s;++a)Pe(t[a],e,n+1,r,i),i+=o}function Le(t,e,n,r){var i=1;if(e.length)for(var o=0;o<e.length;++o)i*=e[o];else i=0;var a=r||Bt.allocType(n,i);switch(e.length){case 0:break;case 1:ke(t,e[0],a);break;case 2:Me(t,e[0],e[1],a);break;case 3:Ie(t,e[0],e[1],e[2],a,0);break;default:Pe(t,e,0,a,0)}return a}function Re(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e}var Oe={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},De={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Ne={dynamic:35048,stream:35040,static:35044},ze=Ce.flatten,Fe=Ce.shape,Be=35044,Ue=35040,je=5121,Ve=5126,Ge=[];function He(t){return 0|Oe[Object.prototype.toString.call(t)]}function We(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function Ze(t,e,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)t[s++]=e[i*u+o*l+a]}function qe(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=Be,this.byteLength=0,this.dimension=1,this.dtype=je,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){f(this)};var u=[];function l(t,e){var n=u.pop();return n||(n=new s(t)),n.bind(),p(n,e,Ue,0,1,!1),n}function c(t){u.push(t)}function h(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function p(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||Ve,n.length>0)if(Array.isArray(n[0])){s=Fe(n);for(var l=1,c=1;c<s.length;++c)l*=s[c];t.dimension=l,h(t,u=ze(n,s,t.dtype),r),a?t.persistentData=u:Bt.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var p=Bt.allocType(t.dtype,n.length);We(p,n),h(t,p,r),a?t.persistentData=p:Bt.freeType(p)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||He(n[0])||Ve,h(t,u=ze(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:Bt.freeType(u)):rt.raise("invalid buffer data")}else if(e(n))t.dtype=i||He(n),t.dimension=o,h(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(Ae(n)){s=n.shape;var f=n.stride,d=n.offset,v=0,m=0,y=0,g=0;1===s.length?(v=s[0],m=1,y=f[0],g=0):2===s.length?(v=s[0],m=s[1],y=f[0],g=f[1]):rt.raise("invalid shape"),t.dtype=i||He(n.data)||Ve,t.dimension=m;var _=Bt.allocType(t.dtype,v*m);Ze(_,n.data,v,m,y,g,d),h(t,_,r),a?t.persistentData=_:Bt.freeType(_)}else n instanceof ArrayBuffer?(t.dtype=je,t.dimension=o,h(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):rt.raise("invalid buffer data")}function f(e){n.bufferCount--,i(e);var r=e.buffer;rt(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}function d(i,o,u,l){n.bufferCount++;var c=new s(o);function h(n){var i=Be,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||Ae(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(rt.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(rt(null===o||Array.isArray(o)||e(o)||Ae(o),"invalid data for buffer"),o=n.data),"usage"in n&&(rt.parameter(n.usage,Ne,"invalid buffer usage"),i=Ne[n.usage]),"type"in n&&(rt.parameter(n.type,De,"invalid buffer type"),s=De[n.type]),"dimension"in n&&(rt.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(rt.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),c.bind(),o?p(c,o,i,s,u,l):(a&&t.bufferData(c.type,a,i),c.dtype=s||je,c.usage=i,c.dimension=u,c.byteLength=a),r.profile&&(c.stats.size=c.byteLength*Ge[c.dtype]),h}function d(e,n){rt(n+e.byteLength<=c.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+c.byteLength),t.bufferSubData(c.type,n,e)}function v(t,n){var r,i=0|(n||0);if(c.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=Bt.allocType(c.dtype,t.length);We(o,t),d(o,i),Bt.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=Fe(t);var a=ze(t,r,c.dtype);d(a,i),Bt.freeType(a)}else rt.raise("invalid buffer data")}else if(Ae(t)){r=t.shape;var s=t.stride,u=0,l=0,p=0,f=0;1===r.length?(u=r[0],l=1,p=s[0],f=0):2===r.length?(u=r[0],l=r[1],p=s[0],f=s[1]):rt.raise("invalid shape");var v=Array.isArray(t.data)?c.dtype:He(t.data),m=Bt.allocType(v,u*l);Ze(m,t.data,u,l,p,f,t.offset),d(m,i),Bt.freeType(m)}else rt.raise("invalid data for buffer subdata");return h}return a[c.id]=c,u||h(i),h._reglType="buffer",h._buffer=c,h.subdata=v,r.profile&&(h.stats=c.stats),h.destroy=function(){f(c)},h}function v(){Te(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(a).forEach((function(e){t+=a[e].stats.size})),t}),{create:d,createStream:l,destroyStream:c,clear:function(){Te(a).forEach(f),u.forEach(f)},getBuffer:function(t){return t&&t._buffer instanceof s?t._buffer:null},restore:v,_initBuffer:p}}Ge[5120]=1,Ge[5122]=2,Ge[5124]=4,Ge[5121]=1,Ge[5123]=2,Ge[5125]=4,Ge[5126]=4;var Xe=4,Ye={points:0,point:0,lines:1,line:1,triangles:4,triangle:Xe,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Ke=0,Qe=1,Je=4,$e=5120,tn=5121,en=5122,nn=5123,rn=5124,on=5125,an=34963,sn=35040,un=35044;function ln(t,n,r,i){var o={},a=0,s={uint8:tn,uint16:nn};function u(t){this.id=a++,o[this.id]=this,this.buffer=t,this.primType=Je,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=on),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(t){var e=l.pop();return e||(e=new u(r.create(null,an,!0,!1)._buffer)),p(e,t,sn,-1,-1,0,0),e}function h(t){l.push(t)}function p(i,o,a,s,u,l,c){var h;if(i.buffer.bind(),o){var p=c;c||e(o)&&(!Ae(o)||e(o.data))||(p=n.oes_element_index_uint?on:nn),r._initBuffer(i.buffer,o,a,p,3)}else t.bufferData(an,l,a),i.buffer.dtype=h||tn,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(h=c,!c){switch(i.buffer.dtype){case tn:case $e:h=tn;break;case nn:case en:h=nn;break;case on:case rn:h=on;break;default:rt.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,rt(h!==on||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var f=u;f<0&&(f=i.buffer.byteLength,h===nn?f>>=1:h===on&&(f>>=2)),i.vertCount=f;var d=s;if(s<0){d=Je;var v=i.buffer.dimension;1===v&&(d=Ke),2===v&&(d=Qe),3===v&&(d=Je)}i.primType=d}function f(t){i.elementsCount--,rt(null!==t.buffer,"must not double destroy elements"),delete o[t.id],t.buffer.destroy(),t.buffer=null}function d(t,n){var o=r.create(null,an,!0),a=new u(o._buffer);function l(t){if(t)if("number"==typeof t)o(t),a.primType=Je,a.vertCount=0|t,a.type=tn;else{var n=null,r=un,i=-1,u=-1,c=0,h=0;Array.isArray(t)||e(t)||Ae(t)?n=t:(rt.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,rt(Array.isArray(n)||e(n)||Ae(n),"invalid data for element buffer")),"usage"in t&&(rt.parameter(t.usage,Ne,"invalid element buffer usage"),r=Ne[t.usage]),"primitive"in t&&(rt.parameter(t.primitive,Ye,"invalid element buffer primitive"),i=Ye[t.primitive]),"count"in t&&(rt("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(rt.parameter(t.type,s,"invalid buffer type"),h=s[t.type]),"length"in t?c=0|t.length:(c=u,h===nn||h===en?c*=2:h!==on&&h!==rn||(c*=4))),p(a,n,r,i,u,c,h)}else o(),a.primType=Je,a.vertCount=0,a.type=tn;return l}return i.elementsCount++,l(t),l._reglType="elements",l._elements=a,l.subdata=function(t,e){return o.subdata(t,e),l},l.destroy=function(){f(a)},l}return{create:d,createStream:c,destroyStream:h,getElements:function(t){return"function"==typeof t&&t._elements instanceof u?t._elements:null},clear:function(){Te(o).forEach(f)}}}var cn=new Float32Array(1),hn=new Uint32Array(cn.buffer),pn=5123;function fn(t){for(var e=Bt.allocType(pn,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{cn[0]=t[n];var r=hn[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)e[n]=i;else if(o<-14){var s=-14-o;e[n]=i+(a+1024>>s)}else e[n]=o>15?i+31744:i+(o+15<<10)+a}return e}function dn(t){return Array.isArray(t)||e(t)}var vn=function(t){return!(t&t-1||!t)},mn=34467,yn=3553,gn=34067,_n=34069,xn=6408,bn=6406,wn=6407,Sn=6409,En=6410,An=32854,Tn=32855,Cn=36194,kn=32819,Mn=32820,In=33635,Pn=34042,Ln=6402,Rn=34041,On=35904,Dn=35906,Nn=36193,zn=33776,Fn=33777,Bn=33778,Un=33779,jn=35986,Vn=35987,Gn=34798,Hn=35840,Wn=35841,Zn=35842,qn=35843,Xn=36196,Yn=5121,Kn=5123,Qn=5125,Jn=5126,$n=10242,tr=10243,er=10497,nr=33071,rr=33648,ir=10240,or=10241,ar=9728,sr=9729,ur=9984,lr=9985,cr=9986,hr=9987,pr=33170,fr=4352,dr=4353,vr=4354,mr=34046,yr=3317,gr=37440,_r=37441,xr=37443,br=37444,wr=33984,Sr=[ur,cr,lr,hr],Er=[0,Sn,En,wn,xn],Ar={};function Tr(t){return"[object "+t+"]"}Ar[Sn]=Ar[bn]=Ar[Ln]=1,Ar[Rn]=Ar[En]=2,Ar[wn]=Ar[On]=3,Ar[xn]=Ar[Dn]=4;var Cr=Tr("HTMLCanvasElement"),kr=Tr("OffscreenCanvas"),Mr=Tr("CanvasRenderingContext2D"),Ir=Tr("ImageBitmap"),Pr=Tr("HTMLImageElement"),Lr=Tr("HTMLVideoElement"),Rr=Object.keys(Oe).concat([Cr,kr,Mr,Ir,Pr,Lr]),Or=[];Or[Yn]=1,Or[Jn]=4,Or[Nn]=2,Or[Kn]=2,Or[Qn]=4;var Dr=[];function Nr(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function zr(t){return!!Array.isArray(t)&&!(0===t.length||!dn(t[0]))}function Fr(t){return Object.prototype.toString.call(t)}function Br(t){return Fr(t)===Cr}function Ur(t){return Fr(t)===kr}function jr(t){return Fr(t)===Mr}function Vr(t){return Fr(t)===Ir}function Gr(t){return Fr(t)===Pr}function Hr(t){return Fr(t)===Lr}function Wr(t){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&t&&t.getContext)}function Zr(t){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&t&&"src"in t&&"crossOrigin"in t)}function qr(t){if(!t)return!1;if(Wr(t)||Zr(t))return!0;var e=Fr(t);return Rr.indexOf(e)>=0||Nr(t)||zr(t)||Ae(t)}function Xr(t){return 0|Oe[Object.prototype.toString.call(t)]}function Yr(t,e){var n=e.length;switch(t.type){case Yn:case Kn:case Qn:case Jn:var r=Bt.allocType(t.type,n);r.set(e),t.data=r;break;case Nn:t.data=fn(e);break;default:rt.raise("unsupported texture type, must specify a typed array")}}function Kr(t,e){return Bt.allocType(t.type===Nn?Jn:t.type,e)}function Qr(t,e){t.type===Nn?(t.data=fn(e),Bt.freeType(e)):t.data=e}function Jr(t,e,n,r,i,o){for(var a=t.width,s=t.height,u=t.channels,l=Kr(t,a*s*u),c=0,h=0;h<s;++h)for(var p=0;p<a;++p)for(var f=0;f<u;++f)l[c++]=e[n*p+r*h+i*f+o];Qr(t,l)}function $r(t,e,n,r,i,o){var a;if(a=void 0!==Dr[t]?Dr[t]:Ar[t]*Or[e],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function ti(t,r,i,o,a,s,u){var l={"don't care":fr,"dont care":fr,nice:vr,fast:dr},c={repeat:er,clamp:nr,mirror:rr},h={nearest:ar,linear:sr},p=n({mipmap:hr,"nearest mipmap nearest":ur,"linear mipmap nearest":lr,"nearest mipmap linear":cr,"linear mipmap linear":hr},h),f={none:0,browser:br},d={uint8:Yn,rgba4:kn,rgb565:In,"rgb5 a1":Mn},v={alpha:bn,luminance:Sn,"luminance alpha":En,rgb:wn,rgba:xn,rgba4:An,"rgb5 a1":Tn,rgb565:Cn},m={};r.ext_srgb&&(v.srgb=On,v.srgba=Dn),r.oes_texture_float&&(d.float32=d.float=Jn),r.oes_texture_half_float&&(d.float16=d["half float"]=Nn),r.webgl_depth_texture&&(n(v,{depth:Ln,"depth stencil":Rn}),n(d,{uint16:Kn,uint32:Qn,"depth stencil":Pn})),r.webgl_compressed_texture_s3tc&&n(m,{"rgb s3tc dxt1":zn,"rgba s3tc dxt1":Fn,"rgba s3tc dxt3":Bn,"rgba s3tc dxt5":Un}),r.webgl_compressed_texture_atc&&n(m,{"rgb atc":jn,"rgba atc explicit alpha":Vn,"rgba atc interpolated alpha":Gn}),r.webgl_compressed_texture_pvrtc&&n(m,{"rgb pvrtc 4bppv1":Hn,"rgb pvrtc 2bppv1":Wn,"rgba pvrtc 4bppv1":Zn,"rgba pvrtc 2bppv1":qn}),r.webgl_compressed_texture_etc1&&(m["rgb etc1"]=Xn);var y=Array.prototype.slice.call(t.getParameter(mn)||new Uint32Array(0));Object.keys(m).forEach((function(t){var e=m[t];y.indexOf(e)>=0&&(v[t]=e)}));var g=Object.keys(v);i.textureFormats=g;var _=[];Object.keys(v).forEach((function(t){var e=v[t];_[e]=t}));var x=[];Object.keys(d).forEach((function(t){var e=d[t];x[e]=t}));var b=[];Object.keys(h).forEach((function(t){var e=h[t];b[e]=t}));var w=[];Object.keys(p).forEach((function(t){var e=p[t];w[e]=t}));var S=[];Object.keys(c).forEach((function(t){var e=c[t];S[e]=t}));var E=g.reduce((function(t,e){var n=v[e];return n===Sn||n===bn||n===Sn||n===En||n===Ln||n===Rn||r.ext_srgb&&(n===On||n===Dn)?t[n]=n:n===Tn||e.indexOf("rgba")>=0?t[n]=xn:t[n]=wn,t}),{});function A(){this.internalformat=xn,this.format=xn,this.type=Yn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=br,this.width=0,this.height=0,this.channels=0}function T(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function C(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(rt.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(rt.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(rt.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(rt.parameter(e.colorSpace,f,"invalid colorSpace"),t.colorSpace=f[e.colorSpace]),"type"in e){var n=e.type;rt(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),rt(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),rt(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),rt.parameter(n,d,"invalid texture type"),t.type=d[n]}var o=t.width,a=t.height,s=t.channels,u=!1;"shape"in e?(rt(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),o=e.shape[0],a=e.shape[1],3===e.shape.length&&(s=e.shape[2],rt(s>0&&s<=4,"invalid number of channels"),u=!0),rt(o>=0&&o<=i.maxTextureSize,"invalid width"),rt(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in e&&(o=a=e.radius,rt(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in e&&(o=e.width,rt(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in e&&(a=e.height,rt(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in e&&(s=e.channels,rt(s>0&&s<=4,"invalid number of channels"),u=!0)),t.width=0|o,t.height=0|a,t.channels=0|s;var l=!1;if("format"in e){var c=e.format;rt(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),rt.parameter(c,v,"invalid texture format");var h=t.internalformat=v[c];t.format=E[h],c in d&&("type"in e||(t.type=d[c])),c in m&&(t.compressed=!0),l=!0}!u&&l?t.channels=Ar[t.format]:u&&!l?t.channels!==Er[t.format]&&(t.format=t.internalformat=Er[t.channels]):l&&u&&rt(t.channels===Ar[t.format],"number of channels inconsistent with specified format")}}function k(e){t.pixelStorei(gr,e.flipY),t.pixelStorei(_r,e.premultiplyAlpha),t.pixelStorei(xr,e.colorSpace),t.pixelStorei(yr,e.unpackAlignment)}function M(){A.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(t,n){var r=null;if(qr(n)?r=n:n&&(rt.type(n,"object","invalid pixel data type"),C(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),qr(n.data)&&(r=n.data)),rt(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){rt(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,rt(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Yn||(t.type=Xr(r));else if(Nr(r))t.channels=t.channels||4,Yr(t,r),t.alignment=1,t.needsFree=!0;else if(Ae(r)){var u=r.data;Array.isArray(u)||t.type!==Yn||(t.type=Xr(u));var l,c,h,p,f,d,v=r.shape,m=r.stride;3===v.length?(h=v[2],d=m[2]):(rt(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),l=v[0],c=v[1],p=m[0],f=m[1],t.alignment=1,t.width=l,t.height=c,t.channels=h,t.format=t.internalformat=Er[h],t.needsFree=!0,Jr(t,u,p,f,d,r.offset)}else if(Wr(r)||Br(r)||Ur(r)||jr(r))Wr(r)||Br(r)||Ur(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(Vr(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(Gr(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(Zr(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(Hr(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(zr(r)){var y=t.width||r[0].length,g=t.height||r.length,_=t.channels;_=dn(r[0][0])?_||r[0][0].length:_||1;for(var x=Ce.shape(r),b=1,w=0;w<x.length;++w)b*=x[w];var S=Kr(t,b);Ce.flatten(r,x,"",S),Qr(t,S),t.alignment=1,t.width=y,t.height=g,t.channels=_,t.format=t.internalformat=Er[_],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===Jn?rt(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Nn&&rt(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function P(e,n,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,l=e.type,c=e.width,h=e.height;k(e),i?t.texImage2D(n,r,u,u,l,i):e.compressed?t.compressedTexImage2D(n,r,s,c,h,0,a):e.needsCopy?(o(),t.copyTexImage2D(n,r,u,e.xOffset,e.yOffset,c,h,0)):t.texImage2D(n,r,u,c,h,0,u,l,a||null)}function L(e,n,r,i,a){var s=e.element,u=e.data,l=e.internalformat,c=e.format,h=e.type,p=e.width,f=e.height;k(e),s?t.texSubImage2D(n,a,r,i,c,h,s):e.compressed?t.compressedTexSubImage2D(n,a,r,i,l,p,f,u):e.needsCopy?(o(),t.copyTexSubImage2D(n,a,r,i,e.xOffset,e.yOffset,p,f)):t.texSubImage2D(n,a,r,i,p,f,c,h,u)}var R=[];function O(){return R.pop()||new M}function D(t){t.needsFree&&Bt.freeType(t.data),M.call(t),R.push(t)}function N(){A.call(this),this.genMipmaps=!1,this.mipmapHint=fr,this.mipmask=0,this.images=Array(16)}function z(t,e,n){var r=t.images[0]=O();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function F(t,e){var n=null;if(qr(e))T(n=t.images[0]=O(),t),I(n,e),t.mipmask=1;else if(C(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)T(n=t.images[i]=O(),t),n.width>>=i,n.height>>=i,I(n,r[i]),t.mipmask|=1<<i;else T(n=t.images[0]=O(),t),I(n,e),t.mipmask=1;T(t,t.images[0]),!t.compressed||t.internalformat!==zn&&t.internalformat!==Fn&&t.internalformat!==Bn&&t.internalformat!==Un||rt(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function B(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;P(n[r],e,r)}}var U=[];function j(){var t=U.pop()||new N;A.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function V(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&D(e[n]),e[n]=null;U.push(t)}function G(){this.minFilter=ar,this.magFilter=ar,this.wrapS=nr,this.wrapT=nr,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=fr}function H(t,e){if("min"in e){var n=e.min;rt.parameter(n,p),t.minFilter=p[n],Sr.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;rt.parameter(r,h),t.magFilter=h[r]}var o=t.wrapS,a=t.wrapT;if("wrap"in e){var s=e.wrap;"string"==typeof s?(rt.parameter(s,c),o=a=c[s]):Array.isArray(s)&&(rt.parameter(s[0],c),rt.parameter(s[1],c),o=c[s[0]],a=c[s[1]])}else{if("wrapS"in e){var u=e.wrapS;rt.parameter(u,c),o=c[u]}if("wrapT"in e){var f=e.wrapT;rt.parameter(f,c),a=c[f]}}if(t.wrapS=o,t.wrapT=a,"anisotropic"in e){var d=e.anisotropic;rt("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var v=!1;switch(typeof e.mipmap){case"string":rt.parameter(e.mipmap,l,"invalid mipmap hint"),t.mipmapHint=l[e.mipmap],t.genMipmaps=!0,v=!0;break;case"boolean":v=t.genMipmaps=e.mipmap;break;case"object":rt(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,v=!0;break;default:rt.raise("invalid mipmap type")}v&&!("min"in e)&&(t.minFilter=ur)}}function W(e,n){t.texParameteri(n,or,e.minFilter),t.texParameteri(n,ir,e.magFilter),t.texParameteri(n,$n,e.wrapS),t.texParameteri(n,tr,e.wrapT),r.ext_texture_filter_anisotropic&&t.texParameteri(n,mr,e.anisotropic),e.genMipmaps&&(t.hint(pr,e.mipmapHint),t.generateMipmap(n))}var Z=0,q={},X=i.maxTextureUnits,Y=Array(X).map((function(){return null}));function K(e){A.call(this),this.mipmask=0,this.internalformat=xn,this.id=Z++,this.refCount=1,this.target=e,this.texture=t.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new G,u.profile&&(this.stats={size:0})}function Q(e){t.activeTexture(wr),t.bindTexture(e.target,e.texture)}function J(){var e=Y[0];e?t.bindTexture(e.target,e.texture):t.bindTexture(yn,null)}function $(e){var n=e.texture;rt(n,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(t.activeTexture(wr+r),t.bindTexture(i,null),Y[r]=null),t.deleteTexture(n),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete q[e.id],s.textureCount--}function tt(e,n){var r=new K(yn);function o(t,e){var n=r.texInfo;G.call(n);var a=j();return"number"==typeof t?z(a,0|t,"number"==typeof e?0|e:0|t):t?(rt.type(t,"object","invalid arguments to regl.texture"),H(n,t),F(a,t)):z(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,T(r,a),rt.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,Q(r),B(a,yn),W(n,yn),J(),V(a),u.profile&&(r.stats.size=$r(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=_[r.internalformat],o.type=x[r.type],o.mag=b[n.magFilter],o.min=w[n.minFilter],o.wrapS=S[n.wrapS],o.wrapT=S[n.wrapT],o}function a(t,e,n,i){rt(!!t,"must specify image data");var a=0|e,s=0|n,u=0|i,l=O();return T(l,r),l.width=0,l.height=0,I(l,t),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,rt(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),rt(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),rt(r.mipmask&1<<u,"missing mipmap data"),rt(l.data||l.element||l.needsCopy,"missing image data"),Q(r),L(l,yn,a,s,u),J(),D(l),o}function l(e,n){var i=0|e,a=0|n||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,Q(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=a>>s;if(!l||!c)break;t.texImage2D(yn,s,r.format,l,c,0,r.format,r.type,null)}return J(),u.profile&&(r.stats.size=$r(r.internalformat,r.type,i,a,!1,!1)),o}return q[r.id]=r,s.textureCount++,o(e,n),o.subimage=a,o.resize=l,o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o}function et(e,n,r,o,a,l){var c=new K(gn);q[c.id]=c,s.cubeCount++;var h=new Array(6);function p(t,e,n,r,o,a){var s,l=c.texInfo;for(G.call(l),s=0;s<6;++s)h[s]=j();if("number"!=typeof t&&t)if("object"==typeof t)if(e)F(h[0],t),F(h[1],e),F(h[2],n),F(h[3],r),F(h[4],o),F(h[5],a);else if(H(l,t),C(c,t),"faces"in t){var f=t.faces;for(rt(Array.isArray(f)&&6===f.length,"cube faces must be a length 6 array"),s=0;s<6;++s)rt("object"==typeof f[s]&&!!f[s],"invalid input for cube map face"),T(h[s],c),F(h[s],f[s])}else for(s=0;s<6;++s)F(h[s],t);else rt.raise("invalid arguments to cube map");else{var d=0|t||1;for(s=0;s<6;++s)z(h[s],d,d)}for(T(c,h[0]),rt.optional((function(){i.npotTextureCube||rt(vn(c.width)&&vn(c.height),"your browser does not support non power or two texture dimensions")})),l.genMipmaps?c.mipmask=(h[0].width<<1)-1:c.mipmask=h[0].mipmask,rt.textureCube(c,l,h,i),c.internalformat=h[0].internalformat,p.width=h[0].width,p.height=h[0].height,Q(c),s=0;s<6;++s)B(h[s],_n+s);for(W(l,gn),J(),u.profile&&(c.stats.size=$r(c.internalformat,c.type,p.width,p.height,l.genMipmaps,!0)),p.format=_[c.internalformat],p.type=x[c.type],p.mag=b[l.magFilter],p.min=w[l.minFilter],p.wrapS=S[l.wrapS],p.wrapT=S[l.wrapT],s=0;s<6;++s)V(h[s]);return p}function f(t,e,n,r,i){rt(!!e,"must specify image data"),rt("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=O();return T(u,c),u.width=0,u.height=0,I(u,e),u.width=u.width||(c.width>>s)-o,u.height=u.height||(c.height>>s)-a,rt(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),rt(o>=0&&a>=0&&o+u.width<=c.width&&a+u.height<=c.height,"texture.subimage write out of bounds"),rt(c.mipmask&1<<s,"missing mipmap data"),rt(u.data||u.element||u.needsCopy,"missing image data"),Q(c),L(u,_n+t,o,a,s),J(),D(u),p}function d(e){var n=0|e;if(n!==c.width){p.width=c.width=n,p.height=c.height=n,Q(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)t.texImage2D(_n+r,i,c.format,n>>i,n>>i,0,c.format,c.type,null);return J(),u.profile&&(c.stats.size=$r(c.internalformat,c.type,p.width,p.height,!1,!0)),p}}return p(e,n,r,o,a,l),p.subimage=f,p.resize=d,p._reglType="textureCube",p._texture=c,u.profile&&(p.stats=c.stats),p.destroy=function(){c.decRef()},p}function nt(){for(var e=0;e<X;++e)t.activeTexture(wr+e),t.bindTexture(yn,null),Y[e]=null;Te(q).forEach($),s.cubeCount=0,s.textureCount=0}function it(){for(var e=0;e<X;++e){var n=Y[e];n&&(n.bindCount=0,n.unit=-1,Y[e]=null)}Te(q).forEach((function(e){e.texture=t.createTexture(),t.bindTexture(e.target,e.texture);for(var n=0;n<32;++n)if(0!=(e.mipmask&1<<n))if(e.target===yn)t.texImage2D(yn,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)t.texImage2D(_n+r,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);W(e.texInfo,e.target)}))}function ot(){for(var e=0;e<X;++e){var n=Y[e];n&&(n.bindCount=0,n.unit=-1,Y[e]=null),t.activeTexture(wr+e),t.bindTexture(yn,null),t.bindTexture(gn,null)}}return n(K.prototype,{bind:function(){var e=this;e.bindCount+=1;var n=e.unit;if(n<0){for(var r=0;r<X;++r){var i=Y[r];if(i){if(i.bindCount>0)continue;i.unit=-1}Y[r]=e,n=r;break}n>=X&&rt.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<n+1&&(s.maxTextureUnits=n+1),e.unit=n,t.activeTexture(wr+n),t.bindTexture(e.target,e.texture)}return n},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&$(this)}}),u.profile&&(s.getTotalTextureSize=function(){var t=0;return Object.keys(q).forEach((function(e){t+=q[e].stats.size})),t}),{create2D:tt,createCube:et,clear:nt,getTexture:function(t){return null},restore:it,refresh:ot}}Dr[An]=2,Dr[Tn]=2,Dr[Cn]=2,Dr[Rn]=4,Dr[zn]=.5,Dr[Fn]=.5,Dr[Bn]=1,Dr[Un]=1,Dr[jn]=.5,Dr[Vn]=1,Dr[Gn]=1,Dr[Hn]=.5,Dr[Wn]=.25,Dr[Zn]=.5,Dr[qn]=.25,Dr[Xn]=.5;var ei=36161,ni=32854,ri=32855,ii=36194,oi=33189,ai=36168,si=34041,ui=35907,li=34836,ci=34842,hi=34843,pi=[];function fi(t,e,n){return pi[t]*e*n}pi[ni]=2,pi[ri]=2,pi[ii]=2,pi[oi]=2,pi[ai]=1,pi[si]=4,pi[ui]=4,pi[li]=16,pi[ci]=8,pi[hi]=6;var di=function(t,e,n,r,i){var o={rgba4:ni,rgb565:ii,"rgb5 a1":ri,depth:oi,stencil:ai,"depth stencil":si};e.ext_srgb&&(o.srgba=ui),e.ext_color_buffer_half_float&&(o.rgba16f=ci,o.rgb16f=hi),e.webgl_color_buffer_float&&(o.rgba32f=li);var a=[];Object.keys(o).forEach((function(t){var e=o[t];a[e]=t}));var s=0,u={};function l(t){this.id=s++,this.refCount=1,this.renderbuffer=t,this.format=ni,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(e){var n=e.renderbuffer;rt(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(ei,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete u[e.id],r.renderbufferCount--}function h(e,s){var c=new l(t.createRenderbuffer());function h(e,r){var s=0,u=0,l=ni;if("object"==typeof e&&e){var p=e;if("shape"in p){var f=p.shape;rt(Array.isArray(f)&&f.length>=2,"invalid renderbuffer shape"),s=0|f[0],u=0|f[1]}else"radius"in p&&(s=u=0|p.radius),"width"in p&&(s=0|p.width),"height"in p&&(u=0|p.height);"format"in p&&(rt.parameter(p.format,o,"invalid renderbuffer format"),l=o[p.format])}else"number"==typeof e?(s=0|e,u="number"==typeof r?0|r:s):e?rt.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(rt(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return h.width=c.width=s,h.height=c.height=u,c.format=l,t.bindRenderbuffer(ei,c.renderbuffer),t.renderbufferStorage(ei,l,s,u),rt(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=fi(c.format,c.width,c.height)),h.format=a[c.format],h}function p(e,r){var o=0|e,a=0|r||o;return o===c.width&&a===c.height||(rt(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=c.width=o,h.height=c.height=a,t.bindRenderbuffer(ei,c.renderbuffer),t.renderbufferStorage(ei,c.format,o,a),rt(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=fi(c.format,c.width,c.height))),h}return u[c.id]=c,r.renderbufferCount++,h(e,s),h.resize=p,h._reglType="renderbuffer",h._renderbuffer=c,i.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h}function p(){Te(u).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(ei,e.renderbuffer),t.renderbufferStorage(ei,e.format,e.width,e.height)})),t.bindRenderbuffer(ei,null)}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(u).forEach((function(e){t+=u[e].stats.size})),t}),{create:h,clear:function(){Te(u).forEach(c)},restore:p}},vi=36160,mi=36161,yi=3553,gi=34069,_i=36064,xi=36096,bi=36128,wi=33306,Si=36053,Ei=36054,Ai=36055,Ti=36057,Ci=36061,ki=36193,Mi=5121,Ii=5126,Pi=6407,Li=6408,Ri=6402,Oi=[Pi,Li],Di=[];Di[Li]=4,Di[Pi]=3;var Ni=[];Ni[Mi]=1,Ni[Ii]=4,Ni[ki]=2;var zi=33189,Fi=36168,Bi=34041,Ui=[32854,32855,36194,35907,34842,34843,34836],ji={};function Vi(t,e,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&l.push("srgba"),e.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),e.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function h(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function p(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function f(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);rt(i===e&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=t.renderbuffer._renderbuffer;rt(a.width===e&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(e,n){n&&(n.texture?t.framebufferTexture2D(vi,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(vi,e,mi,n.renderbuffer._renderbuffer.renderbuffer))}function v(t){var e=yi,n=null,r=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),rt.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,rt(e===yi)):"textureCube"===o?(n=i,rt(e>=gi&&e<gi+6,"invalid cube map target")):"renderbuffer"===o?(r=i,e=mi):rt.raise("invalid regl object for attachment"),new h(e,n,r)}function m(t,e,n,r,a){if(n){var s=i.create2D({width:t,height:e,format:r,type:a});return s._texture.refCount=0,new h(yi,s,null)}var u=o.create({width:t,height:e,format:r});return u._renderbuffer.refCount=0,new h(mi,null,u)}function y(t){return t&&(t.texture||t.renderbuffer)}function g(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}e.oes_texture_half_float&&c.push("half float","float16"),e.oes_texture_float&&c.push("float","float32");var _=0,x={};function b(){this.id=_++,x[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function w(t){t.colorAttachments.forEach(p),p(t.depthAttachment),p(t.stencilAttachment),p(t.depthStencilAttachment)}function S(e){var n=e.framebuffer;rt(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,a.framebufferCount--,delete x[e.id]}function E(e){var n;t.bindFramebuffer(vi,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)d(_i+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(vi,_i+n,yi,null,0);t.framebufferTexture2D(vi,wi,yi,null,0),t.framebufferTexture2D(vi,xi,yi,null,0),t.framebufferTexture2D(vi,bi,yi,null,0),d(xi,e.depthAttachment),d(bi,e.stencilAttachment),d(wi,e.depthStencilAttachment);var o=t.checkFramebufferStatus(vi);t.isContextLost()||o===Si||rt.raise("framebuffer configuration not supported, status = "+ji[o]),t.bindFramebuffer(vi,s.next?s.next.framebuffer:null),s.cur=s.next,t.getError()}function A(t,i){var o=new b;function h(t,n){var i;rt(s.next!==o,"can not update framebuffer which is currently in use");var a=0,p=0,d=!0,g=!0,_=null,x=!0,b="rgba",S="uint8",A=1,T=null,C=null,k=null,M=!1;if("number"==typeof t)a=0|t,p=0|n||a;else if(t){rt.type(t,"object","invalid arguments for framebuffer");var I=t;if("shape"in I){var P=I.shape;rt(Array.isArray(P)&&P.length>=2,"invalid shape for framebuffer"),a=P[0],p=P[1]}else"radius"in I&&(a=p=I.radius),"width"in I&&(a=I.width),"height"in I&&(p=I.height);("color"in I||"colors"in I)&&(_=I.color||I.colors,Array.isArray(_)&&rt(1===_.length||e.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in I&&(A=0|I.colorCount,rt(A>0,"invalid color buffer count")),"colorTexture"in I&&(x=!!I.colorTexture,b="rgba4"),"colorType"in I&&(S=I.colorType,x?(rt(e.oes_texture_float||!("float"===S||"float32"===S),"you must enable OES_texture_float in order to use floating point framebuffer objects"),rt(e.oes_texture_half_float||!("half float"===S||"float16"===S),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===S||"float16"===S?(rt(e.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),b="rgba16f"):"float"!==S&&"float32"!==S||(rt(e.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),b="rgba32f"),rt.oneOf(S,c,"invalid color type")),"colorFormat"in I&&(b=I.colorFormat,u.indexOf(b)>=0?x=!0:l.indexOf(b)>=0?x=!1:rt.optional((function(){x?rt.oneOf(I.colorFormat,u,"invalid color format for texture"):rt.oneOf(I.colorFormat,l,"invalid color format for renderbuffer")})))),("depthTexture"in I||"depthStencilTexture"in I)&&(M=!(!I.depthTexture&&!I.depthStencilTexture),rt(!M||e.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in I&&("boolean"==typeof I.depth?d=I.depth:(T=I.depth,g=!1)),"stencil"in I&&("boolean"==typeof I.stencil?g=I.stencil:(C=I.stencil,d=!1)),"depthStencil"in I&&("boolean"==typeof I.depthStencil?d=g=I.depthStencil:(k=I.depthStencil,d=!1,g=!1))}else a=p=1;var L=null,R=null,O=null,D=null;if(Array.isArray(_))L=_.map(v);else if(_)L=[v(_)];else for(L=new Array(A),i=0;i<A;++i)L[i]=m(a,p,x,b,S);rt(e.webgl_draw_buffers||L.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),rt(L.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||L[0].width,p=p||L[0].height,T?R=v(T):d&&!g&&(R=m(a,p,M,"depth","uint32")),C?O=v(C):g&&!d&&(O=m(a,p,!1,"stencil","uint8")),k?D=v(k):!T&&!C&&g&&d&&(D=m(a,p,M,"depth stencil","depth stencil")),rt(!!T+!!C+!!k<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var N=null;for(i=0;i<L.length;++i)if(f(L[i],a,p),rt(!L[i]||L[i].texture&&Oi.indexOf(L[i].texture._texture.format)>=0||L[i].renderbuffer&&Ui.indexOf(L[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),L[i]&&L[i].texture){var z=Di[L[i].texture._texture.format]*Ni[L[i].texture._texture.type];null===N?N=z:rt(N===z,"all color attachments much have the same number of bits per pixel.")}return f(R,a,p),rt(!R||R.texture&&R.texture._texture.format===Ri||R.renderbuffer&&R.renderbuffer._renderbuffer.format===zi,"invalid depth attachment for framebuffer object"),f(O,a,p),rt(!O||O.renderbuffer&&O.renderbuffer._renderbuffer.format===Fi,"invalid stencil attachment for framebuffer object"),f(D,a,p),rt(!D||D.texture&&D.texture._texture.format===Bi||D.renderbuffer&&D.renderbuffer._renderbuffer.format===Bi,"invalid depth-stencil attachment for framebuffer object"),w(o),o.width=a,o.height=p,o.colorAttachments=L,o.depthAttachment=R,o.stencilAttachment=O,o.depthStencilAttachment=D,h.color=L.map(y),h.depth=y(R),h.stencil=y(O),h.depthStencil=y(D),h.width=o.width,h.height=o.height,E(o),h}function p(t,e){rt(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===o.width&&r===o.height)return h;for(var i=o.colorAttachments,a=0;a<i.length;++a)g(i[a],n,r);return g(o.depthAttachment,n,r),g(o.stencilAttachment,n,r),g(o.depthStencilAttachment,n,r),o.width=h.width=n,o.height=h.height=r,E(o),h}return a.framebufferCount++,h(t,i),n(h,{resize:p,_reglType:"framebuffer",_framebuffer:o,destroy:function(){S(o),w(o)},use:function(t){s.setFBO({framebuffer:h},t)}})}function T(t){var o=Array(6);function a(t){var r;rt(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,h={color:null},p=0,f=null,d="rgba",v="uint8",m=1;if("number"==typeof t)p=0|t;else if(t){rt.type(t,"object","invalid arguments for framebuffer");var y=t;if("shape"in y){var g=y.shape;rt(Array.isArray(g)&&g.length>=2,"invalid shape for framebuffer"),rt(g[0]===g[1],"cube framebuffer must be square"),p=g[0]}else"radius"in y&&(p=0|y.radius),"width"in y?(p=0|y.width,"height"in y&&rt(y.height===p,"must be square")):"height"in y&&(p=0|y.height);("color"in y||"colors"in y)&&(f=y.color||y.colors,Array.isArray(f)&&rt(1===f.length||e.webgl_draw_buffers,"multiple render targets not supported")),f||("colorCount"in y&&(m=0|y.colorCount,rt(m>0,"invalid color buffer count")),"colorType"in y&&(rt.oneOf(y.colorType,c,"invalid color type"),v=y.colorType),"colorFormat"in y&&(d=y.colorFormat,rt.oneOf(y.colorFormat,u,"invalid color format for texture"))),"depth"in y&&(h.depth=y.depth),"stencil"in y&&(h.stencil=y.stencil),"depthStencil"in y&&(h.depthStencil=y.depthStencil)}else p=1;if(f)if(Array.isArray(f))for(l=[],r=0;r<f.length;++r)l[r]=f[r];else l=[f];else{l=Array(m);var _={radius:p,format:d,type:v};for(r=0;r<m;++r)l[r]=i.createCube(_)}for(h.color=Array(l.length),r=0;r<l.length;++r){var x=l[r];rt("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),p=p||x.width,rt(x.width===p&&x.height===p,"invalid cube map shape"),h.color[r]={target:gi,data:l[r]}}for(r=0;r<6;++r){for(var b=0;b<l.length;++b)h.color[b].target=gi+r;r>0&&(h.depth=o[0].depth,h.stencil=o[0].stencil,h.depthStencil=o[0].depthStencil),o[r]?o[r](h):o[r]=A(h)}return n(a,{width:p,height:p,color:l})}function l(t){var e,n=0|t;if(rt(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)o[e].resize(n);return a.width=a.height=n,a}return a(t),n(a,{faces:o,resize:l,_reglType:"framebufferCube",destroy:function(){o.forEach((function(t){t.destroy()}))}})}function C(){s.cur=null,s.next=null,s.dirty=!0,Te(x).forEach((function(e){e.framebuffer=t.createFramebuffer(),E(e)}))}return n(s,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof b)return e}return null},create:A,createCube:T,clear:function(){Te(x).forEach(S)},restore:C})}ji[Si]="complete",ji[Ei]="incomplete attachment",ji[Ti]="incomplete dimensions",ji[Ai]="incomplete, missing attachment",ji[Ci]="unsupported";var Gi=5126,Hi=34962,Wi=34963,Zi=["attributes","elements","offset","count","primitive","instances"];function qi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Gi,this.offset=0,this.stride=0,this.divisor=0}function Xi(t,n,r,i,o,a,s){for(var u=r.maxAttributes,l=new Array(u),c=0;c<u;++c)l[c]=new qi;var h=0,p={},f={Record:qi,scope:{},state:l,currentVAO:null,targetVAO:null,restore:v()?w:function(){},createVAO:S,getVAO:y,destroyBuffer:d,setVAO:v()?g:_,clear:v()?x:function(){}};function d(e){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}}function v(){return n.oes_vertex_array_object}function m(){return n.angle_instanced_arrays}function y(t){return"function"==typeof t&&t._vao?t._vao:null}function g(t){if(t!==f.currentVAO){var e=v();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),f.currentVAO=t}}function _(e){if(e!==f.currentVAO){if(e)e.bindAttrs();else{for(var n=m(),r=0;r<l.length;++r){var i=l[r];i.buffer?(t.enableVertexAttribArray(r),i.buffer.bind(),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?t.bindBuffer(Wi,s.elements.buffer.buffer):t.bindBuffer(Wi,null)}f.currentVAO=e}}function x(){Te(p).forEach((function(t){t.destroy()}))}function b(){this.id=++h,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var t=v();this.vao=t?t.createVertexArrayOES():null,p[this.id]=this,this.buffers=[]}function w(){v()&&Te(p).forEach((function(t){t.refresh()}))}function S(t){var r=new b;function s(t){var i;if(Array.isArray(t))i=t,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(rt("object"==typeof t,"invalid arguments for create vao"),rt("attributes"in t,"must specify attributes for vao"),t.elements){var l=t.elements;r.ownsElements?"function"==typeof l&&"elements"===l._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(l),r.ownsElements=!1):a.getElements(t.elements)?(r.elements=t.elements,r.ownsElements=!1):(r.elements=a.create(t.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=t.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in t&&(r.offset=0|t.offset),"count"in t&&(r.count=0|t.count),"instances"in t&&(r.instances=0|t.instances),"primitive"in t&&(rt(t.primitive in Ye,"bad primitive type: "+t.primitive),r.primitive=Ye[t.primitive]),rt.optional((function(){for(var e=Object.keys(t),n=0;n<e.length;++n)rt(Zi.indexOf(e[n])>=0,'invalid option for vao: "'+e[n]+'" valid options are '+Zi)})),rt(Array.isArray(i),"attributes must be an array")}rt(i.length<u,"too many attributes"),rt(i.length>0,"must specify at least one attribute");var c={},h=r.attributes;h.length=i.length;for(var p=0;p<i.length;++p){var f,d=i[p],v=h[p]=new qi,m=d.data||d;Array.isArray(m)||e(m)||Ae(m)?(r.buffers[p]&&(f=r.buffers[p],e(m)&&f._buffer.byteLength>=m.byteLength?f.subdata(m):(f.destroy(),r.buffers[p]=null)),r.buffers[p]||(f=r.buffers[p]=o.create(d,Hi,!1,!0)),v.buffer=o.getBuffer(f),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1,c[p]=1):o.getBuffer(d)?(v.buffer=o.getBuffer(d),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1):o.getBuffer(d.buffer)?(v.buffer=o.getBuffer(d.buffer),v.size=0|(+d.size||v.buffer.dimension),v.normalized=!!d.normalized||!1,"type"in d?(rt.parameter(d.type,De,"invalid buffer type"),v.type=De[d.type]):v.type=v.buffer.dtype,v.offset=0|(d.offset||0),v.stride=0|(d.stride||0),v.divisor=0|(d.divisor||0),v.state=1,rt(v.size>=1&&v.size<=4,"size must be between 1 and 4"),rt(v.offset>=0,"invalid offset"),rt(v.stride>=0&&v.stride<=255,"stride must be between 0 and 255"),rt(v.divisor>=0,"divisor must be positive"),rt(!v.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in d?(rt(p>0,"first attribute must not be a constant"),v.x=+d.x||0,v.y=+d.y||0,v.z=+d.z||0,v.w=+d.w||0,v.state=2):rt(!1,"invalid attribute spec for location "+p)}for(var y=0;y<r.buffers.length;++y)!c[y]&&r.buffers[y]&&(r.buffers[y].destroy(),r.buffers[y]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var t=0;t<r.buffers.length;++t)r.buffers[t]&&r.buffers[t].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(t)}return b.prototype.bindAttrs=function(){for(var e=m(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(Hi,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<u;++o)t.disableVertexAttribArray(o);var s=a.getElements(this.elements);s?t.bindBuffer(Wi,s.buffer.buffer):t.bindBuffer(Wi,null)},b.prototype.refresh=function(){var t=v();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),f.currentVAO=null,t.bindVertexArrayOES(null))},b.prototype.destroy=function(){if(this.vao){var t=v();this===f.currentVAO&&(f.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),p[this.id]&&(delete p[this.id],i.vaoCount-=1)},f}var Yi=35632,Ki=35633,Qi=35718,Ji=35721;function $i(t,e,r,i){var o={},a={};function s(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function u(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function l(n,r,i){var s=n===Yi?o:a,u=s[r];if(!u){var l=e.str(r);u=t.createShader(n),t.shaderSource(u,l),t.compileShader(u),rt.shaderError(t,u,l,n,i),s[r]=u}return u}var c={},h=[],p=0;function f(t,e){this.id=p++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,r,o){var a,c,h=l(Yi,n.fragId),p=l(Ki,n.vertId),f=n.program=t.createProgram();if(t.attachShader(f,h),t.attachShader(f,p),o)for(a=0;a<o.length;++a){var d=o[a];t.bindAttribLocation(f,d[0],d[1])}t.linkProgram(f),rt.linkError(t,f,e.str(n.fragId),e.str(n.vertId),r);var v=t.getProgramParameter(f,Qi);i.profile&&(n.stats.uniformsCount=v);var m=n.uniforms;for(a=0;a<v;++a)if(c=t.getActiveUniform(f,a))if(c.size>1)for(var y=0;y<c.size;++y){var g=c.name.replace("[0]","["+y+"]");u(m,new s(g,e.id(g),t.getUniformLocation(f,g),c))}else u(m,new s(c.name,e.id(c.name),t.getUniformLocation(f,c.name),c));var _=t.getProgramParameter(f,Ji);i.profile&&(n.stats.attributesCount=_);var x=n.attributes;for(a=0;a<_;++a)(c=t.getActiveAttrib(f,a))&&u(x,new s(c.name,e.id(c.name),t.getAttribLocation(f,c.name),c))}function v(){o={},a={};for(var t=0;t<h.length;++t)d(h[t],null,h[t].attributes.map((function(t){return[t.location,t.name]})))}return i.profile&&(r.getMaxUniformsCount=function(){var t=0;return h.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return h.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);Te(o).forEach(e),o={},Te(a).forEach(e),a={},h.forEach((function(e){t.deleteProgram(e.program)})),h.length=0,c={},r.shaderCount=0},program:function(e,i,s,u){rt.command(e>=0,"missing vertex shader",s),rt.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var p=l[e];if(p&&(p.refCount++,!u))return p;var v=new f(i,e);return r.shaderCount++,d(v,s,u),p||(l[e]=v),h.push(v),n(v,{destroy:function(){if(v.refCount--,v.refCount<=0){t.deleteProgram(v.program);var e=h.indexOf(v);h.splice(e,1),r.shaderCount--}l[v.vertId].refCount<=0&&(t.deleteShader(a[v.vertId]),delete a[v.vertId],delete c[v.fragId][v.vertId]),Object.keys(c[v.fragId]).length||(t.deleteShader(o[v.fragId]),delete o[v.fragId],delete c[v.fragId])}})},restore:v,shader:l,frag:-1,vert:-1}}var to=6408,eo=5121,no=3333,ro=5126;function io(t,n,r,i,o,a,s){function u(u){var l;null===n.next?(rt(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=eo):(rt(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,rt.optional((function(){a.oes_texture_float?(rt(l===eo||l===ro,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===ro&&rt(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):rt(l===eo,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var c=0,h=0,p=i.framebufferWidth,f=i.framebufferHeight,d=null;e(u)?d=u:u&&(rt.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,h=0|u.y,rt(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),rt(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),p=0|(u.width||i.framebufferWidth-c),f=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(l===eo?rt(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===ro&&rt(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),rt(p>0&&p+c<=i.framebufferWidth,"invalid width for read pixels"),rt(f>0&&f+h<=i.framebufferHeight,"invalid height for read pixels"),r();var v=p*f*4;return d||(l===eo?d=new Uint8Array(v):l===ro&&(d=d||new Float32Array(v))),rt.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),rt(d.byteLength>=v,"data buffer for regl.read() too small"),t.pixelStorei(no,4),t.readPixels(c,h,p,f,to,l,d),d}function l(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=u(t)})),e}function c(t){return t&&"framebuffer"in t?l(t):u(t)}return c}function oo(t){return Array.prototype.slice.call(t)}function ao(t){return oo(t).join("")}function so(){var e=0,r=[],i=[];function o(t){for(var n=0;n<i.length;++n)if(i[n]===t)return r[n];var o="g"+e++;return r.push(o),i.push(t),o}function a(){var t=[];function r(){t.push.apply(t,oo(arguments))}var i=[];function o(){var n="v"+e++;return i.push(n),arguments.length>0&&(t.push(n,"="),t.push.apply(t,oo(arguments)),t.push(";")),n}return n(r,{def:o,toString:function(){return ao([i.length>0?"var "+i.join(",")+";":"",ao(t)])}})}function s(){var t=a(),e=a(),r=t.toString,i=e.toString;function o(n,r){e(n,r,"=",t.def(n,r),";")}return n((function(){t.apply(t,oo(arguments))}),{def:t.def,entry:t,exit:e,save:o,set:function(e,n,r){o(e,n),t(e,n,"=",r,";")},toString:function(){return r()+i()}})}function u(){var t=ao(arguments),e=s(),r=s(),i=e.toString,o=r.toString;return n(e,{then:function(){return e.apply(e,oo(arguments)),this},else:function(){return r.apply(r,oo(arguments)),this},toString:function(){var e=o();return e&&(e="else{"+e+"}"),ao(["if(",t,"){",i(),"}",e])}})}var l=a(),c={};function h(t,e){var r=[];function i(){var t="a"+r.length;return r.push(t),t}e=e||0;for(var o=0;o<e;++o)i();var a=s(),u=a.toString;return c[t]=n(a,{arg:i,toString:function(){return ao(["function(",r.join(),"){",u(),"}"])}})}function p(){var e=['"use strict";',l,"return {"];Object.keys(c).forEach((function(t){e.push('"',t,'":',c[t].toString(),",")})),e.push("}");var n=ao(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?t.Function.apply(null,r.concat(n)):Function.apply(null,r.concat(n))).apply(null,i)}return{global:l,link:o,block:a,proc:h,scope:s,cond:u,compile:p}}var uo="xyzw".split(""),lo=5121,co=1,ho=2,po=0,fo=1,vo=2,mo=3,yo=4,go=5,_o=6,xo="dither",bo="blend.enable",wo="blend.color",So="blend.equation",Eo="blend.func",Ao="depth.enable",To="depth.func",Co="depth.range",ko="depth.mask",Mo="colorMask",Io="cull.enable",Po="cull.face",Lo="frontFace",Ro="lineWidth",Oo="polygonOffset.enable",Do="polygonOffset.offset",No="sample.alpha",zo="sample.enable",Fo="sample.coverage",Bo="stencil.enable",Uo="stencil.mask",jo="stencil.func",Vo="stencil.opFront",Go="stencil.opBack",Ho="scissor.enable",Wo="scissor.box",Zo="viewport",qo="profile",Xo="framebuffer",Yo="vert",Ko="frag",Qo="elements",Jo="primitive",$o="count",ta="offset",ea="instances",na="vao",ra="Width",ia="Height",oa=Xo+ra,aa=Xo+ia,sa=Zo+ra,ua=Zo+ia,la="drawingBuffer",ca=la+ra,ha=la+ia,pa=[Eo,So,jo,Vo,Go,Fo,Zo,Wo,Do],fa=34962,da=34963,va=3553,ma=34067,ya=2884,ga=3042,_a=3024,xa=2960,ba=2929,wa=3089,Sa=32823,Ea=32926,Aa=32928,Ta=5126,Ca=35664,ka=35665,Ma=35666,Ia=5124,Pa=35667,La=35668,Ra=35669,Oa=35670,Da=35671,Na=35672,za=35673,Fa=35674,Ba=35675,Ua=35676,ja=35678,Va=35680,Ga=4,Ha=1028,Wa=1029,Za=2304,qa=2305,Xa=32775,Ya=32776,Ka=519,Qa=7680,Ja=0,$a=1,ts=32774,es=513,ns=36160,rs=36064,is={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},os=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],as={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ss={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},us={frag:35632,vert:35633},ls={cw:Za,ccw:qa};function cs(t){return Array.isArray(t)||e(t)||Ae(t)}function hs(t){return t.sort((function(t,e){return t===Zo?-1:e===Zo?1:t<e?-1:1}))}function ps(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function fs(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function ds(t){return new ps(!1,!1,!1,t)}function vs(t,e){var n=t.type;if(n===po){var r=t.data.length;return new ps(!0,r>=1,r>=2,e)}if(n===yo){var i=t.data;return new ps(i.thisDep,i.contextDep,i.propDep,e)}if(n===go)return new ps(!1,!1,!1,e);if(n===_o){for(var o=!1,a=!1,s=!1,u=0;u<t.data.length;++u){var l=t.data[u];if(l.type===fo)s=!0;else if(l.type===vo)a=!0;else if(l.type===mo)o=!0;else if(l.type===po){o=!0;var c=l.data;c>=1&&(a=!0),c>=2&&(s=!0)}else l.type===yo&&(o=o||l.data.thisDep,a=a||l.data.contextDep,s=s||l.data.propDep)}return new ps(o,a,s,e)}return new ps(n===mo,n===vo,n===fo,e)}var ms=new ps(!1,!1,!1,(function(){}));function ys(t,e,r,i,o,a,s,u,l,c,h,p,f,d,v){var m=c.Record,y={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(y.min=Xa,y.max=Ya);var g=r.angle_instanced_arrays,_=r.webgl_draw_buffers,x=r.oes_vertex_array_object,b={dirty:!0,profile:v.profile},w={},S=[],E={},A={};function T(t){return t.replace(".","_")}function C(t,e,n){var r=T(t);S.push(t),w[r]=b[r]=!!n,E[r]=e}function k(t,e,n){var r=T(t);S.push(t),Array.isArray(n)?(b[r]=n.slice(),w[r]=n.slice()):b[r]=w[r]=n,A[r]=e}C(xo,_a),C(bo,ga),k(wo,"blendColor",[0,0,0,0]),k(So,"blendEquationSeparate",[ts,ts]),k(Eo,"blendFuncSeparate",[$a,Ja,$a,Ja]),C(Ao,ba,!0),k(To,"depthFunc",es),k(Co,"depthRange",[0,1]),k(ko,"depthMask",!0),k(Mo,Mo,[!0,!0,!0,!0]),C(Io,ya),k(Po,"cullFace",Wa),k(Lo,Lo,qa),k(Ro,Ro,1),C(Oo,Sa),k(Do,"polygonOffset",[0,0]),C(No,Ea),C(zo,Aa),k(Fo,"sampleCoverage",[1,!1]),C(Bo,xa),k(Uo,"stencilMask",-1),k(jo,"stencilFunc",[Ka,0,-1]),k(Vo,"stencilOpSeparate",[Ha,Qa,Qa,Qa]),k(Go,"stencilOpSeparate",[Wa,Qa,Qa,Qa]),C(Ho,wa),k(Wo,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),k(Zo,Zo,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var M={gl:t,context:f,strings:e,next:w,current:b,draw:p,elements:a,buffer:o,shader:h,attributes:c.state,vao:c,uniforms:l,framebuffer:u,extensions:r,timer:d,isBufferArgs:cs},I={primTypes:Ye,compareFuncs:as,blendFuncs:is,blendEquations:y,stencilOps:ss,glTypes:De,orientationType:ls};rt.optional((function(){M.isArrayLike=dn})),_&&(I.backBuffer=[Wa],I.drawBuffer=kt(i.maxDrawbuffers,(function(t){return 0===t?[0]:kt(t,(function(t){return rs+t}))})));var P=0;function L(){var t=so(),n=t.link,r=t.global;t.id=P++,t.batchId="0";var i=n(M),o=t.shared={props:"a0"};Object.keys(M).forEach((function(t){o[t]=r.def(i,".",t)})),rt.optional((function(){t.CHECK=n(rt),t.commandStr=rt.guessCommand(),t.command=n(t.commandStr),t.assert=function(t,e,r){t("if(!(",e,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},I.invalidBlendCombinations=os}));var a=t.next={},s=t.current={};Object.keys(A).forEach((function(t){Array.isArray(b[t])&&(a[t]=r.def(o.next,".",t),s[t]=r.def(o.current,".",t))}));var u=t.constants={};Object.keys(I).forEach((function(t){u[t]=r.def(JSON.stringify(I[t]))})),t.invoke=function(e,r){switch(r.type){case po:var i=["this",o.context,o.props,t.batchId];return e.def(n(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case fo:return e.def(o.props,r.data);case vo:return e.def(o.context,r.data);case mo:return e.def("this",r.data);case yo:return r.data.append(t,e),r.data.ref;case go:return r.data.toString();case _o:return r.data.map((function(n){return t.invoke(e,n)}))}},t.attribCache={};var l={};return t.scopeAttrib=function(t){var r=e.id(t);if(r in l)return l[r];var i=c.scope[r];return i||(i=c.scope[r]=new m),l[r]=n(i)},t}function R(t){var e,n=t.static,r=t.dynamic;if(qo in n){var i=!!n[qo];(e=ds((function(t,e){return i}))).enable=i}else if(qo in r){var o=r[qo];e=vs(o,(function(t,e){return t.invoke(e,o)}))}return e}function O(t,e){var n=t.static,r=t.dynamic;if(Xo in n){var i=n[Xo];return i?(i=u.getFramebuffer(i),rt.command(i,"invalid framebuffer object"),ds((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var o=r.context;return e.set(o,"."+oa,n+".width"),e.set(o,"."+aa,n+".height"),n}))):ds((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+oa,r+"."+ca),e.set(r,"."+aa,r+"."+ha),"null"}))}if(Xo in r){var o=r[Xo];return vs(o,(function(t,e){var n=t.invoke(e,o),r=t.shared,i=r.framebuffer,a=e.def(i,".getFramebuffer(",n,")");rt.optional((function(){t.assert(e,"!"+n+"||"+a,"invalid framebuffer object")})),e.set(i,".next",a);var s=r.context;return e.set(s,"."+oa,a+"?"+a+".width:"+s+"."+ca),e.set(s,"."+aa,a+"?"+a+".height:"+s+"."+ha),a}))}return null}function D(t,e,n){var r=t.static,i=t.dynamic;function o(t){if(t in r){var o=r[t];rt.commandType(o,"object","invalid "+t,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,rt.command(a>=0,"invalid "+t,n.commandStr)):u=!1,"height"in o?(s=0|o.height,rt.command(s>=0,"invalid "+t,n.commandStr)):u=!1,new ps(!u&&e&&e.thisDep,!u&&e&&e.contextDep,!u&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=a;"width"in o||(r=e.def(n,".",oa,"-",l));var i=s;return"height"in o||(i=e.def(n,".",aa,"-",c)),[l,c,r,i]}))}if(t in i){var h=i[t],p=vs(h,(function(e,n){var r=e.invoke(n,h);rt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",oa,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",aa,"-",a,")");return rt.optional((function(){e.assert(n,s+">=0&&"+u+">=0","invalid "+t)})),[o,a,s,u]}));return e&&(p.thisDep=p.thisDep||e.thisDep,p.contextDep=p.contextDep||e.contextDep,p.propDep=p.propDep||e.propDep),p}return e?new ps(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",oa),e.def(n,".",aa)]})):null}var a=o(Zo);if(a){var s=a;a=new ps(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=s.append(t,e),r=t.shared.context;return e.set(r,"."+sa,n[2]),e.set(r,"."+ua,n[3]),n}))}return{viewport:a,scissor_box:o(Wo)}}function N(t,e){var n=t.static;if("string"==typeof n[Ko]&&"string"==typeof n[Yo]){if(Object.keys(e.dynamic).length>0)return null;var r=e.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)rt("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}function z(t,n,r){var i=t.static,o=t.dynamic;function a(t){if(t in i){var n=e.id(i[t]);rt.optional((function(){h.shader(us[t],n,rt.guessCommand())}));var r=ds((function(){return n}));return r.id=n,r}if(t in o){var a=o[t];return vs(a,(function(e,n){var r=e.invoke(n,a),i=n.def(e.shared.strings,".id(",r,")");return rt.optional((function(){n(e.shared.shader,".shader(",us[t],",",i,",",e.command,");")})),i}))}return null}var s,u=a(Ko),l=a(Yo),c=null;return fs(u)&&fs(l)?(c=h.program(l.id,u.id,null,r),s=ds((function(t,e){return t.link(c)}))):s=new ps(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(t,e){var n,r=t.shared.shader;n=u?u.append(t,e):e.def(r,".",Ko);var i=r+".program("+(l?l.append(t,e):e.def(r,".",Yo))+","+n;return rt.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}function F(t,e){var n=t.static,r=t.dynamic,i={},o=!1;function s(){if(na in n){var t=n[na];return null!==t&&null===c.getVAO(t)&&(t=c.createVAO(t)),o=!0,i.vao=t,ds((function(e){var n=c.getVAO(t);return n?e.link(n):"null"}))}if(na in r){o=!0;var e=r[na];return vs(e,(function(t,n){var r=t.invoke(n,e);return n.def(t.shared.vao+".getVAO("+r+")")}))}return null}var u=s(),l=!1;function h(){if(Qo in n){var t=n[Qo];if(i.elements=t,cs(t)){var s=i.elements=a.create(t,!0);t=a.getElements(s),l=!0}else t&&(t=a.getElements(t),l=!0,rt.command(t,"invalid elements",e.commandStr));var c=ds((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return c.value=t,c}if(Qo in r){l=!0;var h=r[Qo];return vs(h,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,o=t.invoke(e,h),a=e.def("null"),s=e.def(r,"(",o,")"),u=t.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return rt.optional((function(){t.assert(u.else,"!"+o+"||"+a,"invalid elements")})),e.entry(u),e.exit(t.cond(s).then(i,".destroyStream(",a,");")),t.ELEMENTS=a,a}))}return o?new ps(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.elements+".getElements("+t.shared.vao+".currentVAO.elements):null")})):null}var p=h();function f(){if(Jo in n){var t=n[Jo];return i.primitive=t,rt.commandParameter(t,Ye,"invalid primitve",e.commandStr),ds((function(e,n){return Ye[t]}))}if(Jo in r){var a=r[Jo];return vs(a,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,a);return rt.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys(Ye))})),e.def(n,"[",r,"]")}))}return l?fs(p)?p.value?ds((function(t,e){return e.def(t.ELEMENTS,".primType")})):ds((function(){return Ga})):new ps(p.thisDep,p.contextDep,p.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",Ga)})):o?new ps(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.primitive:"+Ga)})):null}function d(t,a){if(t in n){var s=0|n[t];return a?i.offset=s:i.instances=s,rt.command(!a||s>=0,"invalid "+t,e.commandStr),ds((function(t,e){return a&&(t.OFFSET=s),s}))}if(t in r){var c=r[t];return vs(c,(function(e,n){var r=e.invoke(n,c);return a&&(e.OFFSET=r,rt.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}if(a){if(l)return ds((function(t,e){return t.OFFSET=0,0}));if(o)return new ps(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.offset:0")}))}else if(o)return new ps(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.instances:-1")}));return null}var v=d(ta,!0);function m(){if($o in n){var t=0|n[$o];return i.count=t,rt.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),ds((function(){return t}))}if($o in r){var a=r[$o];return vs(a,(function(t,e){var n=t.invoke(e,a);return rt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(l){if(fs(p)){if(p)return v?new ps(v.thisDep,v.contextDep,v.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return rt.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):ds((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var s=ds((function(){return-1}));return rt.optional((function(){s.MISSING=!0})),s}var c=new ps(p.thisDep||v.thisDep,p.contextDep||v.contextDep,p.propDep||v.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return rt.optional((function(){c.DYNAMIC=!0})),c}if(o){var h=new ps(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao,".currentVAO?",t.shared.vao,".currentVAO.count:-1")}));return h}return null}var y=f(),g=m(),_=d(ea,!1);return{elements:p,primitive:y,count:g,instances:_,offset:v,vao:u,vaoActive:o,elementsActive:l,static:i}}function B(t,e){var n=t.static,r=t.dynamic,o={};return S.forEach((function(t){var a=T(t);function s(e,i){if(t in n){var s=e(n[t]);o[a]=ds((function(){return s}))}else if(t in r){var u=r[t];o[a]=vs(u,(function(t,e){return i(t,e,t.invoke(e,u))}))}}switch(t){case Io:case bo:case xo:case Bo:case Ao:case Ho:case Oo:case No:case zo:case ko:return s((function(n){return rt.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return rt.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case To:return s((function(n){return rt.commandParameter(n,as,"invalid "+t,e.commandStr),as[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return rt.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(as))})),n.def(i,"[",r,"]")}));case Co:return s((function(t){return rt.command(dn(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return rt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case Eo:return s((function(t){rt.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,o="dstAlpha"in t?t.dstAlpha:t.dst;return rt.commandParameter(n,is,a+".srcRGB",e.commandStr),rt.commandParameter(r,is,a+".srcAlpha",e.commandStr),rt.commandParameter(i,is,a+".dstRGB",e.commandStr),rt.commandParameter(o,is,a+".dstAlpha",e.commandStr),rt.command(-1===os.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[is[n],is[i],is[r],is[o]]}),(function(e,n,r){var i=e.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return rt.optional((function(){e.assert(n,s+" in "+i,"invalid "+t+"."+o+a+", must be one of "+Object.keys(is))})),s}rt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");rt.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case So:return s((function(n){return"string"==typeof n?(rt.commandParameter(n,y,"invalid "+t,e.commandStr),[y[n],y[n]]):"object"==typeof n?(rt.commandParameter(n.rgb,y,t+".rgb",e.commandStr),rt.commandParameter(n.alpha,y,t+".alpha",e.commandStr),[y[n.rgb],y[n.alpha]]):void rt.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,o=n.def(),a=n.def(),s=e.cond("typeof ",r,'==="string"');return rt.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(y))}n(s.then,t,r),e.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(s.else,t+".rgb",r+".rgb"),n(s.else,t+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case wo:return s((function(t){return rt.command(dn(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),kt(4,(function(e){return+t[e]}))}),(function(t,e,n){return rt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),kt(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case Uo:return s((function(t){return rt.commandType(t,"number",a,e.commandStr),0|t}),(function(t,e,n){return rt.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case jo:return s((function(n){rt.commandType(n,"object",a,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return rt.commandParameter(r,as,t+".cmp",e.commandStr),rt.commandType(i,"number",t+".ref",e.commandStr),rt.commandType(o,"number",t+".mask",e.commandStr),[as[r],i,o]}),(function(t,e,n){var r=t.constants.compareFuncs;return rt.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Qa),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case Vo:case Go:return s((function(n){rt.commandType(n,"object",a,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return rt.commandParameter(r,ss,t+".fail",e.commandStr),rt.commandParameter(i,ss,t+".zfail",e.commandStr),rt.commandParameter(o,ss,t+".zpass",e.commandStr),[t===Go?Wa:Ha,ss[r],ss[i],ss[o]]}),(function(e,n,r){var i=e.constants.stencilOps;function o(o){return rt.optional((function(){e.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+t+"."+o+", must be one of "+Object.keys(ss))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Qa)}return rt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===Go?Wa:Ha,o("fail"),o("zfail"),o("zpass")]}));case Do:return s((function(t){rt.commandType(t,"object",a,e.commandStr);var n=0|t.factor,r=0|t.units;return rt.commandType(n,"number",a+".factor",e.commandStr),rt.commandType(r,"number",a+".units",e.commandStr),[n,r]}),(function(e,n,r){return rt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Po:return s((function(t){var n=0;return"front"===t?n=Ha:"back"===t&&(n=Wa),rt.command(!!n,a,e.commandStr),n}),(function(t,e,n){return rt.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',Ha,":",Wa)}));case Ro:return s((function(t){return rt.command("number"==typeof t&&t>=i.lineWidthDims[0]&&t<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return rt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case Lo:return s((function(t){return rt.commandParameter(t,ls,a,e.commandStr),ls[t]}),(function(t,e,n){return rt.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?'+Za+":"+qa)}));case Mo:return s((function(t){return rt.command(dn(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return rt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),kt(4,(function(t){return"!!"+n+"["+t+"]"}))}));case Fo:return s((function(t){rt.command("object"==typeof t&&t,a,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return rt.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){return rt.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),o}function U(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,o=n[t];if("number"==typeof o||"boolean"==typeof o)r=ds((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=ds((function(t){return t.link(o)})):"framebuffer"===a||"framebufferCube"===a?(rt.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=ds((function(t){return t.link(o.color[0])}))):rt.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else dn(o)?r=ds((function(e){return e.global.def("[",kt(o.length,(function(n){return rt.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+t,e.commandStr),o[n]})),"]")})):rt.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=o,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=vs(e,(function(t,n){return t.invoke(n,e)}))})),i}function j(t,n){var r=t.static,i=t.dynamic,a={};return Object.keys(r).forEach((function(t){var i=r[t],s=e.id(t),u=new m;if(cs(i))u.state=co,u.buffer=o.getBuffer(o.create(i,fa,!1,!0)),u.type=0;else{var l=o.getBuffer(i);if(l)u.state=co,u.buffer=l,u.type=0;else if(rt.command("object"==typeof i&&i,"invalid data for attribute "+t,n.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=ho,"number"==typeof c?u.x=c:(rt.command(dn(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+t,n.commandStr),uo.forEach((function(t,e){e<c.length&&(u[t]=c[e])})))}else{l=cs(i.buffer)?o.getBuffer(o.create(i.buffer,fa,!1,!0)):o.getBuffer(i.buffer),rt.command(!!l,'missing buffer for attribute "'+t+'"',n.commandStr);var h=0|i.offset;rt.command(h>=0,'invalid offset for attribute "'+t+'"',n.commandStr);var p=0|i.stride;rt.command(p>=0&&p<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',n.commandStr);var f=0|i.size;rt.command(!("size"in i)||f>0&&f<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',n.commandStr);var d=!!i.normalized,v=0;"type"in i&&(rt.commandParameter(i.type,De,"invalid type for attribute "+t,n.commandStr),v=De[i.type]);var y=0|i.divisor;rt.optional((function(){"divisor"in i&&(rt.command(0===y||g,'cannot specify divisor for attribute "'+t+'", instancing not supported',n.commandStr),rt.command(y>=0,'invalid divisor for attribute "'+t+'"',n.commandStr));var e=n.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(n){rt.command(r.indexOf(n)>=0,'unknown parameter "'+n+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",e)}))})),u.buffer=l,u.state=co,u.size=f,u.normalized=d,u.type=v||l.dtype,u.offset=h,u.stride=p,u.divisor=y}}a[t]=ds((function(t,e){var n=t.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(t){r[t]=u[t]})),u.buffer&&(r.buffer=t.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(t){var e=i[t];function n(n,r){var i=n.invoke(r,e),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;rt.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var l={isStream:r.def(!1)},c=new m;c.state=co,Object.keys(c).forEach((function(t){l[t]=r.def(""+c[t])}));var h=l.buffer,p=l.type;function f(t){r(l[t],"=",i,".",t,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",h,"=",u,".createStream(",fa,",",i,");",p,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",p,"=",h,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",ho,";","if(typeof "+i+'.constant === "number"){',l[uo[0]],"=",i,".constant;",uo.slice(1).map((function(t){return l[t]})).join("="),"=0;","}else{",uo.map((function(t,e){return l[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",fa,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",p,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",l.normalized,"=!!",i,".normalized;"),f("size"),f("offset"),f("stride"),f("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",h,");","}"),l}a[t]=vs(e,n)})),a}function V(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=ds((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=vs(e,(function(t,n){return t.invoke(n,e)}))})),r}function G(t,e,n,i,o){var a=t.static,s=t.dynamic;rt.optional((function(){var t=[Xo,Yo,Ko,Qo,Jo,ta,$o,ea,qo,na].concat(S);function e(e){Object.keys(e).forEach((function(e){rt.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',o.commandStr)}))}e(a),e(s)}));var u=N(t,e),l=O(t),h=D(t,l,o),p=F(t,o),f=B(t,o),d=z(t,o,u);function v(t){var e=h[t];e&&(f[t]=e)}v(Zo),v(T(Wo));var m=Object.keys(f).length>0,y={framebuffer:l,draw:p,shader:d,state:f,dirty:m,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(y.profile=R(t),y.uniforms=U(n,o),y.drawVAO=y.scopeVAO=p.vao,!y.drawVAO&&d.program&&!u&&r.angle_instanced_arrays&&p.static.elements){var g=!0,_=d.program.attributes.map((function(t){var n=e.static[t];return g=g&&!!n,n}));if(g&&_.length>0){var x=c.getVAO(c.createVAO({attributes:_,elements:p.static.elements}));y.drawVAO=new ps(null,null,null,(function(t,e){return t.link(x)})),y.useVAO=!0}}return u?y.useVAO=!0:y.attributes=j(e,o),y.context=V(i),y}function H(t,e,n){var r=t.shared.context,i=t.scope();Object.keys(n).forEach((function(o){e.save(r,"."+o);var a=n[o].append(t,e);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),e(i)}function W(t,e,n,r){var i,o=t.shared,a=o.gl,s=o.framebuffer;_&&(i=e.def(o.extensions,".webgl_draw_buffers"));var u,l=t.constants,c=l.drawBuffer,h=l.backBuffer;u=n?n.append(t,e):e.def(s,".next"),r||e("if(",u,"!==",s,".cur){"),e("if(",u,"){",a,".bindFramebuffer(",ns,",",u,".framebuffer);"),_&&e(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),e("}else{",a,".bindFramebuffer(",ns,",null);"),_&&e(i,".drawBuffersWEBGL(",h,");"),e("}",s,".cur=",u,";"),r||e("}")}function Z(t,e,n){var r=t.shared,i=r.gl,o=t.current,a=t.next,s=r.current,u=r.next,l=t.cond(s,".dirty");S.forEach((function(e){var r,c,h=T(e);if(!(h in n.state))if(h in a){r=a[h],c=o[h];var p=kt(b[h].length,(function(t){return l.def(r,"[",t,"]")}));l(t.cond(p.map((function(t,e){return t+"!=="+c+"["+e+"]"})).join("||")).then(i,".",A[h],"(",p,");",p.map((function(t,e){return c+"["+e+"]="+t})).join(";"),";"))}else{r=l.def(u,".",h);var f=t.cond(r,"!==",s,".",h);l(f),h in E?f(t.cond(r).then(i,".enable(",E[h],");").else(i,".disable(",E[h],");"),s,".",h,"=",r,";"):f(i,".",A[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),e(l)}function q(t,e,n,r){var i=t.shared,o=t.current,a=i.current,s=i.gl;hs(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(t,e);if(E[i]){var c=E[i];fs(u)?e(s,l?".enable(":".disable(",c,");"):e(t.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),e(a,".",i,"=",l,";")}else if(dn(l)){var h=o[i];e(s,".",A[i],"(",l,");",l.map((function(t,e){return h+"["+e+"]="+t})).join(";"),";")}else e(s,".",A[i],"(",l,");",a,".",i,"=",l,";")}}))}function X(t,e){g&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function Y(t,e,n,r,i){var o,a,s,u=t.shared,l=t.stats,c=u.current,h=u.timer,p=n.profile;function f(){return"undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM||"undefined"==typeof performance?"Date.now()":"performance.now()"}function v(t){t(o=e.def(),"=",f(),";"),"string"==typeof i?t(l,".count+=",i,";"):t(l,".count++;"),d&&(r?t(a=e.def(),"=",h,".getNumPendingQueries();"):t(h,".beginQuery(",l,");"))}function m(t){t(l,".cpuTime+=",f(),"-",o,";"),d&&(r?t(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",l,");"):t(h,".endQuery();"))}function y(t){var n=e.def(c,".profile");e(c,".profile=",t,";"),e.exit(c,".profile=",n,";")}if(p){if(fs(p))return void(p.enable?(v(e),m(e.exit),y("true")):y("false"));y(s=p.append(t,e))}else s=e.def(c,".profile");var g=t.block();v(g),e("if(",s,"){",g,"}");var _=t.block();m(_),e.exit("if(",s,"){",_,"}")}function K(t,e,n,r,i){var o=t.shared;function a(t){switch(t){case Ca:case Pa:case Da:return 2;case ka:case La:case Na:return 3;case Ma:case Ra:case za:return 4;default:return 1}}function s(n,r,i){var a=o.gl,s=e.def(n,".location"),u=e.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,h=[i.x,i.y,i.z,i.w],p=["buffer","normalized","offset","stride"];function f(){e("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",u,".type!==",o,"||",u,".size!==",n,"||",p.map((function(t){return u+"."+t+"!=="+i[t]})).join("||"),"){",a,".bindBuffer(",fa,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",p.map((function(t){return u+"."+t+"="+i[t]+";"})).join(""),"}"),g){var l=i.divisor;e("if(",u,".divisor!==",l,"){",t.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){e("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",uo.map((function(t,e){return u+"."+t+"!=="+h[e]})).join("||"),"){",a,".vertexAttrib4f(",s,",",h,");",uo.map((function(t,e){return u+"."+t+"="+h[e]+";"})).join(""),"}")}l===co?f():l===ho?d():(e("if(",l,"===",co,"){"),f(),e("}else{"),d(),e("}"))}r.forEach((function(r){var o,u=r.name,l=n.attributes[u];if(l){if(!i(l))return;o=l.append(t,e)}else{if(!i(ms))return;var c=t.scopeAttrib(u);rt.optional((function(){t.assert(e,c+".state","missing attribute "+u)})),o={},Object.keys(new m).forEach((function(t){o[t]=e.def(c,".",t)}))}s(t.link(r),a(r.info.type),o)}))}function Q(t,n,r,i,o,a){for(var s,u=t.shared,l=u.gl,c=0;c<i.length;++c){var h,p=i[c],f=p.name,d=p.info.type,v=r.uniforms[f],m=t.link(p)+".location";if(v){if(!o(v))continue;if(fs(v)){var y=v.value;if(rt.command(null!=y,'missing uniform "'+f+'"',t.commandStr),d===ja||d===Va){rt.command("function"==typeof y&&(d===ja&&("texture2d"===y._reglType||"framebuffer"===y._reglType)||d===Va&&("textureCube"===y._reglType||"framebufferCube"===y._reglType)),"invalid texture for uniform "+f,t.commandStr);var g=t.link(y._texture||y.color[0]._texture);n(l,".uniform1i(",m,",",g+".bind());"),n.exit(g,".unbind();")}else if(d===Fa||d===Ba||d===Ua){rt.optional((function(){rt.command(dn(y),"invalid matrix for uniform "+f,t.commandStr),rt.command(d===Fa&&4===y.length||d===Ba&&9===y.length||d===Ua&&16===y.length,"invalid length for matrix uniform "+f,t.commandStr)}));var _=t.global.def("new Float32Array(["+Array.prototype.slice.call(y)+"])"),x=2;d===Ba?x=3:d===Ua&&(x=4),n(l,".uniformMatrix",x,"fv(",m,",false,",_,");")}else{switch(d){case Ta:rt.commandType(y,"number","uniform "+f,t.commandStr),s="1f";break;case Ca:rt.command(dn(y)&&2===y.length,"uniform "+f,t.commandStr),s="2f";break;case ka:rt.command(dn(y)&&3===y.length,"uniform "+f,t.commandStr),s="3f";break;case Ma:rt.command(dn(y)&&4===y.length,"uniform "+f,t.commandStr),s="4f";break;case Oa:rt.commandType(y,"boolean","uniform "+f,t.commandStr),s="1i";break;case Ia:rt.commandType(y,"number","uniform "+f,t.commandStr),s="1i";break;case Da:case Pa:rt.command(dn(y)&&2===y.length,"uniform "+f,t.commandStr),s="2i";break;case Na:case La:rt.command(dn(y)&&3===y.length,"uniform "+f,t.commandStr),s="3i";break;case za:case Ra:rt.command(dn(y)&&4===y.length,"uniform "+f,t.commandStr),s="4i"}n(l,".uniform",s,"(",m,",",dn(y)?Array.prototype.slice.call(y):y,");")}continue}h=v.append(t,n)}else{if(!o(ms))continue;h=n.def(u.uniforms,"[",e.id(f),"]")}d===ja?(rt(!Array.isArray(h),"must specify a scalar prop for textures"),n("if(",h,"&&",h,'._reglType==="framebuffer"){',h,"=",h,".color[0];","}")):d===Va&&(rt(!Array.isArray(h),"must specify a scalar prop for cube maps"),n("if(",h,"&&",h,'._reglType==="framebufferCube"){',h,"=",h,".color[0];","}")),rt.optional((function(){function e(e,r){t.assert(n,e,'bad data or missing for uniform "'+f+'".  '+r)}function r(t){rt(!Array.isArray(h),"must not specify an array type for uniform"),e("typeof "+h+'==="'+t+'"',"invalid type, expected "+t)}function i(n,r){Array.isArray(h)?rt(h.length===n,"must have length "+n):e(u.isArrayLike+"("+h+")&&"+h+".length==="+n,"invalid vector, should have length "+n,t.commandStr)}function o(n){rt(!Array.isArray(h),"must not specify a value type"),e("typeof "+h+'==="function"&&'+h+'._reglType==="texture'+(n===va?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(d){case Ia:r("number");break;case Pa:i(2);break;case La:i(3);break;case Ra:i(4);break;case Ta:r("number");break;case Ca:i(2);break;case ka:i(3);break;case Ma:i(4);break;case Oa:r("boolean");break;case Da:i(2);break;case Na:i(3);break;case za:case Fa:i(4);break;case Ba:i(9);break;case Ua:i(16);break;case ja:o(va);break;case Va:o(ma)}}));var b=1;switch(d){case ja:case Va:var w=n.def(h,"._texture");n(l,".uniform1i(",m,",",w,".bind());"),n.exit(w,".unbind();");continue;case Ia:case Oa:s="1i";break;case Pa:case Da:s="2i",b=2;break;case La:case Na:s="3i",b=3;break;case Ra:case za:s="4i",b=4;break;case Ta:s="1f";break;case Ca:s="2f",b=2;break;case ka:s="3f",b=3;break;case Ma:s="4f",b=4;break;case Fa:s="Matrix2fv";break;case Ba:s="Matrix3fv";break;case Ua:s="Matrix4fv"}if("M"===s.charAt(0)){n(l,".uniform",s,"(",m,",");var S=Math.pow(d-Fa+2,2),E=t.global.def("new Float32Array(",S,")");Array.isArray(h)?n("false,(",kt(S,(function(t){return E+"["+t+"]="+h[t]})),",",E,")"):n("false,(Array.isArray(",h,")||",h," instanceof Float32Array)?",h,":(",kt(S,(function(t){return E+"["+t+"]="+h+"["+t+"]"})),",",E,")"),n(");")}else if(b>1){for(var A=[],T=[],C=0;C<b;++C)Array.isArray(h)?T.push(h[C]):T.push(n.def(h+"["+C+"]")),a&&A.push(n.def());a&&n("if(!",t.batchId,"||",A.map((function(t,e){return t+"!=="+T[e]})).join("||"),"){",A.map((function(t,e){return t+"="+T[e]+";"})).join("")),n(l,".uniform",s,"(",m,",",T.join(","),");"),a&&n("}")}else{if(rt(!Array.isArray(h),"uniform value must not be an array"),a){var k=n.def();n("if(!",t.batchId,"||",k,"!==",h,"){",k,"=",h,";")}n(l,".uniform",s,"(",m,",",h,");"),a&&n("}")}}}function J(t,e,n,r){var i=t.shared,o=i.gl,a=i.draw,s=r.draw;function u(){var u,l=s.elements,c=e;return l?((l.contextDep&&r.contextDynamic||l.propDep)&&(c=n),u=l.append(t,c),s.elementsActive&&c("if("+u+")"+o+".bindBuffer("+da+","+u+".buffer.buffer);")):(u=c.def(),c(u,"=",a,".",Qo,";","if(",u,"){",o,".bindBuffer(",da,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",t.shared.elements+".getElements("+i.vao,".currentVAO.elements);",x?"":"if("+u+")"+o+".bindBuffer("+da+","+u+".buffer.buffer);","}")),u}function l(){var i,o=s.count,u=e;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(t,u),rt.optional((function(){o.MISSING&&t.assert(e,"false","missing vertex count"),o.DYNAMIC&&t.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",$o),rt.optional((function(){t.assert(u,i+">=0","missing vertex count")}))),i}var c=u();function h(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(t,n):o.append(t,e):e.def(a,".",i)}var p,f,d=h(Jo),v=h(ta),m=l();if("number"==typeof m){if(0===m)return}else n("if(",m,"){"),n.exit("}");g&&(p=h(ea),f=t.instancing);var y=c+".type",_=s.elements&&fs(s.elements)&&!s.vaoActive;function b(){function t(){n(f,".drawElementsInstancedANGLE(",[d,m,y,v+"<<(("+y+"-"+lo+")>>1)",p],");")}function e(){n(f,".drawArraysInstancedANGLE(",[d,v,m,p],");")}c&&"null"!==c?_?t():(n("if(",c,"){"),t(),n("}else{"),e(),n("}")):e()}function w(){function t(){n(o+".drawElements("+[d,m,y,v+"<<(("+y+"-"+lo+")>>1)"]+");")}function e(){n(o+".drawArrays("+[d,v,m]+");")}c&&"null"!==c?_?t():(n("if(",c,"){"),t(),n("}else{"),e(),n("}")):e()}g&&("number"!=typeof p||p>=0)?"string"==typeof p?(n("if(",p,">0){"),b(),n("}else if(",p,"<0){"),w(),n("}")):b():w()}function $(t,e,n,r,i){var o=L(),a=o.proc("body",i);return rt.optional((function(){o.commandStr=e.commandStr,o.command=o.link(e.commandStr)})),g&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),t(o,a,n,r),o.compile().body}function tt(t,e,n,r){X(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),K(t,e,n,r.attributes,(function(){return!0}))),Q(t,e,n,r.uniforms,(function(){return!0}),!1),J(t,e,e,n)}function et(t,e){var n=t.proc("draw",1);X(t,n),H(t,n,e.context),W(t,n,e.framebuffer),Z(t,n,e),q(t,n,e.state),Y(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)tt(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(t.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",t.link((function(n){return $(tt,t,e,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function nt(t,e,n,r){function i(){return!0}t.batchId="a1",X(t,e),K(t,e,n,r.attributes,i),Q(t,e,n,r.uniforms,i,!1),J(t,e,e,n)}function it(t,e,n,r){X(t,e);var i=n.contextDep,o=e.def(),a="a0",s="a1",u=e.def();t.shared.props=u,t.batchId=o;var l=t.scope(),c=t.scope();function h(t){return t.contextDep&&i||t.propDep}function p(t){return!h(t)}if(e(l.entry,"for(",o,"=0;",o,"<",s,";++",o,"){",u,"=",a,"[",o,"];",c,"}",l.exit),n.needsContext&&H(t,c,n.context),n.needsFramebuffer&&W(t,c,n.framebuffer),q(t,c,n.state,h),n.profile&&h(n.profile)&&Y(t,c,n,!1,!0),r)n.useVAO?n.drawVAO?h(n.drawVAO)?c(t.shared.vao,".setVAO(",n.drawVAO.append(t,c),");"):l(t.shared.vao,".setVAO(",n.drawVAO.append(t,l),");"):l(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(l(t.shared.vao,".setVAO(null);"),K(t,l,n,r.attributes,p),K(t,c,n,r.attributes,h)),Q(t,l,n,r.uniforms,p,!1),Q(t,c,n,r.uniforms,h,!0),J(t,l,c,n);else{var f=t.global.def("{}"),d=n.shader.progVar.append(t,c),v=c.def(d,".id"),m=c.def(f,"[",v,"]");c(t.shared.gl,".useProgram(",d,".program);","if(!",m,"){",m,"=",f,"[",v,"]=",t.link((function(e){return $(nt,t,n,e,2)})),"(",d,");}",m,".call(this,a0[",o,"],",o,");")}}function ot(t,e){var n=t.proc("batch",2);t.batchId="0",X(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(H(t,n,e.context),i=!1);var o=e.framebuffer,a=!1;function s(t){return t.contextDep&&r||t.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||W(t,n,o)):W(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),Z(t,n,e),q(t,n,e.state,(function(t){return!s(t)})),e.profile&&s(e.profile)||Y(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=a;var u=e.shader.progVar;if(u.contextDep&&r||u.propDep)it(t,n,e,null);else{var l=u.append(t,n);if(n(t.shared.gl,".useProgram(",l,".program);"),e.shader.program)it(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var c=t.global.def("{}"),h=n.def(l,".id"),p=n.def(c,"[",h,"]");n(t.cond(p).then(p,".call(this,a0,a1);").else(p,"=",c,"[",h,"]=",t.link((function(n){return $(it,t,e,n,2)})),"(",l,");",p,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function at(t,n){var r=t.proc("scope",3);t.batchId="a2";var i=t.shared,o=i.current;function a(e){var o=n.shader[e];o&&r.set(i.shader,"."+e,o.append(t,r))}H(t,r,n.context),n.framebuffer&&n.framebuffer.append(t,r),hs(Object.keys(n.state)).forEach((function(e){var o=n.state[e].append(t,r);dn(o)?o.forEach((function(n,i){r.set(t.next[e],"["+i+"]",n)})):r.set(i.next,"."+e,o)})),Y(t,r,n,!0,!0),[Qo,ta,$o,ea,Jo].forEach((function(e){var o=n.draw[e];o&&r.set(i.draw,"."+e,""+o.append(t,r))})),Object.keys(n.uniforms).forEach((function(o){var a=n.uniforms[o].append(t,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+e.id(o)+"]",a)})),Object.keys(n.attributes).forEach((function(e){var i=n.attributes[e].append(t,r),o=t.scopeAttrib(e);Object.keys(new m).forEach((function(t){r.set(o,"."+t,i[t])}))})),n.scopeVAO&&r.set(i.vao,".targetVAO",n.scopeVAO.append(t,r)),a(Yo),a(Ko),Object.keys(n.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",t.shared.context,",a0,",t.batchId,");")}function st(t){if("object"==typeof t&&!dn(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(vt.isDynamic(t[e[n]]))return!0;return!1}}function ut(t,e,n){var r=e.static[n];if(r&&st(r)){var i=t.global,o=Object.keys(r),a=!1,s=!1,u=!1,l=t.global.def("{}");o.forEach((function(e){var n=r[e];if(vt.isDynamic(n)){"function"==typeof n&&(n=r[e]=vt.unbox(n));var o=vs(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(l,".",e,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n))}i(";")}})),e.dynamic[n]=new vt.DynamicVariable(yo,{thisDep:a,contextDep:s,propDep:u,ref:l,append:c}),delete e.static[n]}function c(t,e){o.forEach((function(n){var i=r[n];if(vt.isDynamic(i)){var o=t.invoke(e,i);e(l,".",n,"=",o,";")}}))}}function lt(t,e,r,i,o){var a=L();a.stats=a.link(o),Object.keys(e.static).forEach((function(t){ut(a,e,t)})),pa.forEach((function(e){ut(a,t,e)}));var s=G(t,e,r,i,a);return et(a,s),at(a,s),ot(a,s),n(a.compile(),{destroy:function(){s.shader.program.destroy()}})}return{next:w,current:b,procs:function(){var t=L(),e=t.proc("poll"),n=t.proc("refresh"),o=t.block();e(o),n(o);var a,s=t.shared,u=s.gl,l=s.next,c=s.current;o(c,".dirty=false;"),W(t,e),W(t,n,null,!0),g&&(a=t.link(g)),r.oes_vertex_array_object&&n(t.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<i.maxAttributes;++h){var p=n.def(s.attributes,"[",h,"]"),f=t.cond(p,".buffer");f.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",fa,",",p,".buffer.buffer);",u,".vertexAttribPointer(",h,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;"),n(f),g&&n(a,".vertexAttribDivisorANGLE(",h,",",p,".divisor);")}return n(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(E).forEach((function(r){var i=E[r],a=o.def(l,".",r),s=t.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",c,".",r,"=",a,";"),n(s),e("if(",a,"!==",c,".",r,"){",s,"}")})),Object.keys(A).forEach((function(r){var i,a,s=A[r],h=b[r],p=t.block();if(p(u,".",s,"("),dn(h)){var f=h.length;i=t.global.def(l,".",r),a=t.global.def(c,".",r),p(kt(f,(function(t){return i+"["+t+"]"})),");",kt(f,(function(t){return a+"["+t+"]="+i+"["+t+"];"})).join("")),e("if(",kt(f,(function(t){return i+"["+t+"]!=="+a+"["+t+"]"})).join("||"),"){",p,"}")}else i=o.def(l,".",r),a=o.def(c,".",r),p(i,");",c,".",r,"=",i,";"),e("if(",i,"!==",a,"){",p,"}");n(p)})),t.compile()}(),compile:lt}}function gs(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var _s=34918,xs=34919,bs=35007,ws=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||e.ext_disjoint_timer_query.createQueryEXT()}function i(t){n.push(t)}var o=[];function a(t){var n=r();e.ext_disjoint_timer_query.beginQueryEXT(bs,n),o.push(n),f(o.length-1,o.length,t)}function s(){e.ext_disjoint_timer_query.endQueryEXT(bs)}function u(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var l=[];function c(){return l.pop()||new u}function h(t){l.push(t)}var p=[];function f(t,e,n){var r=c();r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,p.push(r)}var d=[],v=[];function m(){var t,n,r=o.length;if(0!==r){v.length=Math.max(v.length,r+1),d.length=Math.max(d.length,r+1),d[0]=0,v[0]=0;var a=0;for(t=0,n=0;n<o.length;++n){var s=o[n];e.ext_disjoint_timer_query.getQueryObjectEXT(s,xs)?(a+=e.ext_disjoint_timer_query.getQueryObjectEXT(s,_s),i(s)):o[t++]=s,d[n+1]=a,v[n+1]=t}for(o.length=t,t=0,n=0;n<p.length;++n){var u=p[n],l=u.startQueryIndex,c=u.endQueryIndex;u.sum+=d[c]-d[l];var f=v[l],m=v[c];m===f?(u.stats.gpuTime+=u.sum/1e6,h(u)):(u.startQueryIndex=f,u.endQueryIndex=m,p[t++]=u)}p.length=t}}return{beginQuery:a,endQuery:s,pushScopeStats:f,update:m,getNumPendingQueries:function(){return o.length},clear:function(){n.push.apply(n,o);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);o.length=0,n.length=0},restore:function(){o.length=0,n.length=0}}},Ss=16384,Es=256,As=1024,Ts=34962,Cs="webglcontextlost",ks="webglcontextrestored",Ms=1,Is=2,Ps=3;function Ls(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}function Rs(t){var e=Tt(t);if(!e)return null;var r=e.gl,i=r.getContextAttributes(),o=r.isContextLost(),a=Ct(r,e);if(!a)return null;var s=_t(),u=gs(),l=a.extensions,c=ws(r,l),h=gt(),p=r.drawingBufferWidth,f=r.drawingBufferHeight,d={tick:0,time:0,viewportWidth:p,viewportHeight:f,framebufferWidth:p,framebufferHeight:f,drawingBufferWidth:p,drawingBufferHeight:f,pixelRatio:e.pixelRatio},v={},m={elements:null,primitive:4,count:-1,offset:0,instances:-1},y=Ee(r,l),g=qe(r,u,e,b),_=ln(r,l,g,u),x=Xi(r,l,y,u,g,_,m);function b(t){return x.destroyBuffer(t)}var w=$i(r,s,u,e),S=ti(r,l,y,(function(){T.procs.poll()}),d,u,e),E=di(r,l,y,u,e),A=Vi(r,l,y,S,E,u),T=ys(r,s,l,y,g,_,S,A,v,x,w,m,d,c,e),C=io(r,A,T.procs.poll,d,i,l,y),k=T.next,M=r.canvas,I=[],P=[],L=[],R=[e.onDestroy],O=null;function D(){if(0===I.length)return c&&c.update(),void(O=null);O=mt.next(D),X();for(var t=I.length-1;t>=0;--t){var e=I[t];e&&e(d,null,0)}r.flush(),c&&c.update()}function N(){!O&&I.length>0&&(O=mt.next(D))}function z(){O&&(mt.cancel(D),O=null)}function F(t){t.preventDefault(),o=!0,z(),P.forEach((function(t){t()}))}function B(t){r.getError(),o=!1,a.restore(),w.restore(),g.restore(),S.restore(),E.restore(),A.restore(),x.restore(),c&&c.restore(),T.procs.refresh(),N(),L.forEach((function(t){t()}))}var U="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;function j(){I.length=0,z(),!U&&M&&(M.removeEventListener(Cs,F),M.removeEventListener(ks,B)),w.clear(),A.clear(),E.clear(),x.clear(),S.clear(),_.clear(),g.clear(),c&&c.clear(),R.forEach((function(t){t()}))}function V(t){function e(t){var e=n({},t);function r(t){if(t in e){var n=e[t];delete e[t],Object.keys(n).forEach((function(r){e[t+"."+r]=n[r]}))}}return delete e.uniforms,delete e.attributes,delete e.context,delete e.vao,"stencil"in e&&e.stencil.op&&(e.stencil.opBack=e.stencil.opFront=e.stencil.op,delete e.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(e.vao=t.vao),e}function r(t,e){var n={},r={};return Object.keys(t).forEach((function(i){var o=t[i];if(vt.isDynamic(o))r[i]=vt.unbox(o,i);else{if(e&&Array.isArray(o))for(var a=0;a<o.length;++a)if(vt.isDynamic(o[a]))return void(r[i]=vt.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}rt(!!t,"invalid args to regl({...})"),rt.type(t,"object","invalid args to regl({...})");var i=r(t.context||{},!0),a=r(t.uniforms||{},!0),s=r(t.attributes||{},!1),u=r(e(t),!1),l={gpuTime:0,cpuTime:0,count:0},c=T.compile(u,s,a,i,l),h=c.draw,p=c.batch,f=c.scope,d=[];function v(t){for(;d.length<t;)d.push(null);return d}function m(t,e){var n;if(o&&rt.raise("context lost"),"function"==typeof t)return f.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)f.call(this,null,e,n);else{if(!Array.isArray(t))return f.call(this,t,e,0);for(n=0;n<t.length;++n)f.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return p.call(this,v(0|t),0|t)}else{if(!Array.isArray(t))return h.call(this,t);if(t.length)return p.call(this,t,t.length)}}return n(m,{stats:l,destroy:function(){c.destroy()}})}!U&&M&&(M.addEventListener(Cs,F,!1),M.addEventListener(ks,B,!1));var G=A.setFBO=V({framebuffer:vt.define.call(null,Ms,"framebuffer")});function H(t,e){var n=0;T.procs.poll();var i=e.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=Ss),"depth"in e&&(r.clearDepth(+e.depth),n|=Es),"stencil"in e&&(r.clearStencil(0|e.stencil),n|=As),rt(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function W(t){if(rt("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var e=0;e<6;++e)G(n({framebuffer:t.framebuffer.faces[e]},t),H);else G(t,H);else H(null,t)}function Z(t){function e(){var e=Ls(I,t);function n(){var t=Ls(I,n);I[t]=I[I.length-1],I.length-=1,I.length<=0&&z()}rt(e>=0,"cannot cancel a frame twice"),I[e]=n}return rt.type(t,"function","regl.frame() callback must be a function"),I.push(t),N(),{cancel:e}}function q(){var t=k.viewport,e=k.scissor_box;t[0]=t[1]=e[0]=e[1]=0,d.viewportWidth=d.framebufferWidth=d.drawingBufferWidth=t[2]=e[2]=r.drawingBufferWidth,d.viewportHeight=d.framebufferHeight=d.drawingBufferHeight=t[3]=e[3]=r.drawingBufferHeight}function X(){d.tick+=1,d.time=K(),q(),T.procs.poll()}function Y(){S.refresh(),q(),T.procs.refresh(),c&&c.update()}function K(){return(gt()-h)/1e3}function Q(t,e){var n;switch(rt.type(e,"function","listener callback must be a function"),t){case"frame":return Z(e);case"lost":n=P;break;case"restore":n=L;break;case"destroy":n=R;break;default:rt.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}}Y();var J=n(V,{clear:W,prop:vt.define.bind(null,Ms),context:vt.define.bind(null,Is),this:vt.define.bind(null,Ps),draw:V({}),buffer:function(t){return g.create(t,Ts,!1,!1)},elements:function(t){return _.create(t,!1)},texture:S.create2D,cube:S.createCube,renderbuffer:E.create,framebuffer:A.create,framebufferCube:A.createCube,vao:x.createVAO,attributes:i,frame:Z,on:Q,limits:y,hasExtension:function(t){return y.extensions.indexOf(t.toLowerCase())>=0},read:C,destroy:j,_gl:r,_refresh:Y,poll:function(){X(),c&&c.update()},now:K,stats:u});return e.onDone(null,J),J}return Rs}(OF)}(fN);var DF,NF,zF,FF,BF,UF,jF,VF,GF,HF,WF,ZF,qF,XF,YF,KF=fN.exports,QF=function(){function t(e,n){Ee(this,t);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return Te(t,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}(),JF=(kt(DF={},pf.POINTS,"points"),kt(DF,pf.LINES,"lines"),kt(DF,pf.LINE_LOOP,"line loop"),kt(DF,pf.LINE_STRIP,"line strip"),kt(DF,pf.TRIANGLES,"triangles"),kt(DF,pf.TRIANGLE_FAN,"triangle fan"),kt(DF,pf.TRIANGLE_STRIP,"triangle strip"),DF),$F=(kt(NF={},pf.STATIC_DRAW,"static"),kt(NF,pf.DYNAMIC_DRAW,"dynamic"),kt(NF,pf.STREAM_DRAW,"stream"),NF),tB=(kt(zF={},pf.BYTE,"int8"),kt(zF,pf.UNSIGNED_INT,"int16"),kt(zF,pf.INT,"int32"),kt(zF,pf.UNSIGNED_BYTE,"uint8"),kt(zF,pf.UNSIGNED_SHORT,"uint16"),kt(zF,pf.UNSIGNED_INT,"uint32"),kt(zF,pf.FLOAT,"float"),zF),eB=(kt(FF={},pf.ALPHA,"alpha"),kt(FF,pf.LUMINANCE,"luminance"),kt(FF,pf.LUMINANCE_ALPHA,"luminance alpha"),kt(FF,pf.RGB,"rgb"),kt(FF,pf.RGBA,"rgba"),kt(FF,pf.RGBA4,"rgba4"),kt(FF,pf.RGB5_A1,"rgb5 a1"),kt(FF,pf.RGB565,"rgb565"),kt(FF,pf.DEPTH_COMPONENT,"depth"),kt(FF,pf.DEPTH_STENCIL,"depth stencil"),FF),nB=(kt(BF={},pf.DONT_CARE,"dont care"),kt(BF,pf.NICEST,"nice"),kt(BF,pf.FASTEST,"fast"),BF),rB=(kt(UF={},pf.NEAREST,"nearest"),kt(UF,pf.LINEAR,"linear"),kt(UF,pf.LINEAR_MIPMAP_LINEAR,"mipmap"),kt(UF,pf.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),kt(UF,pf.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),kt(UF,pf.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),UF),iB=(kt(jF={},pf.REPEAT,"repeat"),kt(jF,pf.CLAMP_TO_EDGE,"clamp"),kt(jF,pf.MIRRORED_REPEAT,"mirror"),jF),oB=(kt(VF={},pf.NONE,"none"),kt(VF,pf.BROWSER_DEFAULT_WEBGL,"browser"),VF),aB=(kt(GF={},pf.NEVER,"never"),kt(GF,pf.ALWAYS,"always"),kt(GF,pf.LESS,"less"),kt(GF,pf.LEQUAL,"lequal"),kt(GF,pf.GREATER,"greater"),kt(GF,pf.GEQUAL,"gequal"),kt(GF,pf.EQUAL,"equal"),kt(GF,pf.NOTEQUAL,"notequal"),GF),sB=(kt(HF={},pf.FUNC_ADD,"add"),kt(HF,pf.MIN_EXT,"min"),kt(HF,pf.MAX_EXT,"max"),kt(HF,pf.FUNC_SUBTRACT,"subtract"),kt(HF,pf.FUNC_REVERSE_SUBTRACT,"reverse subtract"),HF),uB=(kt(WF={},pf.ZERO,"zero"),kt(WF,pf.ONE,"one"),kt(WF,pf.SRC_COLOR,"src color"),kt(WF,pf.ONE_MINUS_SRC_COLOR,"one minus src color"),kt(WF,pf.SRC_ALPHA,"src alpha"),kt(WF,pf.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),kt(WF,pf.DST_COLOR,"dst color"),kt(WF,pf.ONE_MINUS_DST_COLOR,"one minus dst color"),kt(WF,pf.DST_ALPHA,"dst alpha"),kt(WF,pf.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),kt(WF,pf.CONSTANT_COLOR,"constant color"),kt(WF,pf.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),kt(WF,pf.CONSTANT_ALPHA,"constant alpha"),kt(WF,pf.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),kt(WF,pf.SRC_ALPHA_SATURATE,"src alpha saturate"),WF),lB=(kt(ZF={},pf.NEVER,"never"),kt(ZF,pf.ALWAYS,"always"),kt(ZF,pf.LESS,"less"),kt(ZF,pf.LEQUAL,"lequal"),kt(ZF,pf.GREATER,"greater"),kt(ZF,pf.GEQUAL,"gequal"),kt(ZF,pf.EQUAL,"equal"),kt(ZF,pf.NOTEQUAL,"notequal"),ZF),cB=(kt(qF={},pf.ZERO,"zero"),kt(qF,pf.KEEP,"keep"),kt(qF,pf.REPLACE,"replace"),kt(qF,pf.INVERT,"invert"),kt(qF,pf.INCR,"increment"),kt(qF,pf.DECR,"decrement"),kt(qF,pf.INCR_WRAP,"increment wrap"),kt(qF,pf.DECR_WRAP,"decrement wrap"),qF),hB=(kt(XF={},pf.FRONT,"front"),kt(XF,pf.BACK,"back"),XF),pB=function(){function t(e,n){Ee(this,t);var r=n.data,i=n.usage,o=n.type;this.buffer=e.buffer({data:r,usage:$F[i||pf.STATIC_DRAW],type:tB[o||pf.UNSIGNED_BYTE]})}return Te(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var e=t.data,n=t.offset;this.buffer.subdata(e,n)}}]),t}(),fB=function(){function t(e,n){Ee(this,t);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=e.elements({data:r,usage:$F[i||pf.STATIC_DRAW],type:tB[o||pf.UNSIGNED_BYTE],count:a})}return Te(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var e=t.data;this.elements.subdata(e)}},{key:"destroy",value:function(){}}]),t}(),dB=function(){function t(e,n){Ee(this,t);var r=n.width,i=n.height,o=n.color,a=n.colors,s={width:r,height:i};Array.isArray(a)&&(s.colors=a.map((function(t){return t.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=e.framebuffer(s)}return Te(t,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.framebuffer.resize(e,n)}}]),t}(),vB=function(){function t(e,n){Ee(this,t),kt(this,"destroyed",!1),kt(this,"uniforms",{}),this.reGl=e;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,s=n.primitive,u=n.count,l=n.elements,c=n.depth,h=n.cull,p=n.instances,f={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach((function(t){f[t]=e.prop(t)})));var d={};Object.keys(o).forEach((function(t){d[t]=o[t].get()}));var v={attributes:d,frag:i,uniforms:f,vert:r,colorMask:e.prop("colorMask"),lineWidth:1,blend:{enable:e.prop("blend.enable"),func:e.prop("blend.func"),equation:e.prop("blend.equation"),color:e.prop("blend.color")},stencil:{enable:e.prop("stencil.enable"),mask:e.prop("stencil.mask"),func:e.prop("stencil.func"),opFront:e.prop("stencil.opFront"),opBack:e.prop("stencil.opBack")},primitive:JF[void 0===s?pf.TRIANGLES:s]};p&&(v.instances=p),u?v.count=u:l&&(v.elements=l.get()),this.initDepthDrawParams({depth:c},v),this.initCullDrawParams({cull:h},v),this.drawCommand=e(v),this.drawParams=v}return Te(t,[{key:"updateAttributesAndElements",value:function(t,e){var n={};Object.keys(t).forEach((function(e){n[e]=t[e].get()})),this.drawParams.attributes=n,this.drawParams.elements=e.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var e={};Object.keys(t).forEach((function(n){e[n]=t[n].get()})),this.drawParams.attributes=e,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=It(It({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,e){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=It(It({},this.uniforms),this.extractUniforms(t.uniforms||{})),r={};Object.keys(n).forEach((function(t){var e=Tt(n[t]);"boolean"===e||"number"===e||Array.isArray(n[t])||n[t].BYTES_PER_ELEMENT?r[t]=n[t]:r[t]=n[t].get()})),r.blend=e?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),r.stencil=this.getStencilDrawParams(t),r.colorMask=this.getColorMaskDrawParams(t,e),this.drawCommand(r)}}},{key:"destroy",value:function(){var t,e;null===(t=this.drawParams)||void 0===t||null===(e=t.elements)||void 0===e||e.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(t){null==t||t.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,e){var n=t.depth;n&&(e.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:aB[n.func||pf.LESS],range:n.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var e=t.blend||{},n=e.enable,r=e.func,i=e.equation,o=e.color,a=void 0===o?[0,0,0,0]:o;return{enable:!!n,func:{srcRGB:uB[r&&r.srcRGB||pf.SRC_ALPHA],srcAlpha:uB[r&&r.srcAlpha||pf.SRC_ALPHA],dstRGB:uB[r&&r.dstRGB||pf.ONE_MINUS_SRC_ALPHA],dstAlpha:uB[r&&r.dstAlpha||pf.ONE_MINUS_SRC_ALPHA]},equation:{rgb:sB[i&&i.rgb||pf.FUNC_ADD],alpha:sB[i&&i.alpha||pf.FUNC_ADD]},color:a}}},{key:"getStencilDrawParams",value:function(t){var e=t.stencil||{},n=e.enable,r=e.mask,i=void 0===r?-1:r,o=e.func,a=void 0===o?{cmp:pf.ALWAYS,ref:0,mask:-1}:o,s=e.opFront,u=void 0===s?{fail:pf.KEEP,zfail:pf.KEEP,zpass:pf.KEEP}:s,l=e.opBack,c=void 0===l?{fail:pf.KEEP,zfail:pf.KEEP,zpass:pf.KEEP}:l;return{enable:!!n,mask:i,func:It(It({},a),{},{cmp:lB[a.cmp]}),opFront:{fail:cB[u.fail],zfail:cB[u.zfail],zpass:cB[u.zpass]},opBack:{fail:cB[c.fail],zfail:cB[c.zfail],zpass:cB[c.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,e){var n=t.stencil;return null!=n&&n.enable&&n.opFront&&!e?[!1,!1,!1,!1]:[!0,!0,!0,!0]}},{key:"initCullDrawParams",value:function(t,e){var n=t.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?pf.BACK:i;e.cull={enable:!!r,face:hB[o]}}}},{key:"extractUniforms",value:function(t){var e=this,n={};return Object.keys(t).forEach((function(r){e.extractUniformsRecursively(r,t[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(t,e,n,r){var i=this;null===e||"number"==typeof e||"boolean"==typeof e||Array.isArray(e)&&"number"==typeof e[0]||ti.exports.isTypedArray(e)||""===e||"resize"in e?n["".concat(r&&r+".").concat(t)]=e:(ti.exports.isPlainObject(e)&&Object.keys(e).forEach((function(o){i.extractUniformsRecursively(o,e[o],n,"".concat(r&&r+".").concat(t))})),Array.isArray(e)&&e.forEach((function(e,o){Object.keys(e).forEach((function(a){i.extractUniformsRecursively(a,e[a],n,"".concat(r&&r+".").concat(t,"[").concat(o,"]"))}))})))}}]),t}(),mB=function(){function t(e,n){Ee(this,t),kt(this,"isDestroy",!1);var r=n.data,i=n.type,o=void 0===i?pf.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,h=void 0===c?pf.RGBA:c,p=n.mipmap,f=void 0!==p&&p,d=n.wrapS,v=void 0===d?pf.CLAMP_TO_EDGE:d,m=n.wrapT,y=void 0===m?pf.CLAMP_TO_EDGE:m,g=n.aniso,_=void 0===g?0:g,x=n.alignment,b=void 0===x?1:x,w=n.premultiplyAlpha,S=void 0!==w&&w,E=n.mag,A=void 0===E?pf.NEAREST:E,T=n.min,C=void 0===T?pf.NEAREST:T,k=n.colorSpace,M=void 0===k?pf.BROWSER_DEFAULT_WEBGL:k,I=n.x,P=void 0===I?0:I,L=n.y,R=void 0===L?0:L,O=n.copy,D=void 0!==O&&O;this.width=a,this.height=s;var N={width:a,height:s,type:tB[o],format:eB[h],wrapS:iB[v],wrapT:iB[y],mag:rB[A],min:rB[C],alignment:b,flipY:l,colorSpace:oB[M],premultiplyAlpha:S,aniso:_,x:P,y:R,copy:D};r&&(N.data=r),"number"==typeof f?N.mipmap=nB[f]:"boolean"==typeof f&&(N.mipmap=f),this.texture=e.texture(N)}return Te(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.texture.resize(e,n),this.width=e,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var t;this.isDestroy||(null===(t=this.texture)||void 0===t||t.destroy());this.isDestroy=!0}}]),t}(),yB=ku.injectable()(YF=function(){function t(){var e=this;Ee(this,t),kt(this,"createModel",(function(t){return new vB(e.gl,t)})),kt(this,"createAttribute",(function(t){return new QF(e.gl,t)})),kt(this,"createBuffer",(function(t){return new pB(e.gl,t)})),kt(this,"createElements",(function(t){return new fB(e.gl,t)})),kt(this,"createTexture2D",(function(t){return new mB(e.gl,t)})),kt(this,"createFramebuffer",(function(t){return new dB(e.gl,t)})),kt(this,"useFramebuffer",(function(t,n){e.gl({framebuffer:t?t.get():null})(n)})),kt(this,"clear",(function(t){var n,r=t.color,i=t.depth,o=t.stencil,a=t.framebuffer,s=void 0===a?null:a,u={color:r,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(n=e.gl)||void 0===n||n.clear(u)})),kt(this,"viewport",(function(t){var n=t.x,r=t.y,i=t.width,o=t.height;e.gl._gl.viewport(n,r,i,o),e.width=i,e.height=o,e.gl._refresh()})),kt(this,"readPixels",(function(t){var n=t.framebuffer,r={x:t.x,y:t.y,width:t.width,height:t.height};return n&&(r.framebuffer=n.get()),e.gl.read(r)})),kt(this,"getViewportSize",(function(){return{width:e.gl._gl.drawingBufferWidth,height:e.gl._gl.drawingBufferHeight}})),kt(this,"getContainer",(function(){return Jn?e.canvas:null===(t=e.canvas)||void 0===t?void 0:t.parentElement;var t})),kt(this,"getCanvas",(function(){return e.canvas})),kt(this,"getGLContext",(function(){return e.gl._gl})),kt(this,"destroy",(function(){var t,n,r;e.canvas=null,null===(t=e.gl)||void 0===t||null===(n=t._gl)||void 0===n||null===(r=n.getExtension("WEBGL_lose_context"))||void 0===r||r.loseContext(),e.gl.destroy(),e.gl=null}))}var e;return Te(t,[{key:"init",value:(e=Zt(Kt.mark((function t(e,n,r){var i=this;return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.canvas=e,!r){t.next=5;break}this.gl=r,t.next=8;break;case 5:return t.next=7,new Promise((function(t,e){KF({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(n,r){!n&&r||e(n),t(r)}})}));case 7:this.gl=t.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return t.stop()}}),t,this)}))),function(t,n,r){return e.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),t}())||YF;function gB(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ze(t);if(e){var i=ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ne(this,n)}}var _B,xB,bB,wB,SB=["selectstart","selecting","selectend"],EB=function(t){Oe(n,t);var e=gB(n);function n(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ee(this,n),kt(De(r=e.call(this)),"isEnable",!1),kt(De(r),"onDragStart",(function(t){r.box.style.display="block",r.startEvent=r.endEvent=t,r.syncBoxBound(),r.emit("selectstart",r.getLngLatBox(),r.startEvent,r.endEvent)})),kt(De(r),"onDragging",(function(t){r.endEvent=t,r.syncBoxBound(),r.emit("selecting",r.getLngLatBox(),r.startEvent,r.endEvent)})),kt(De(r),"onDragEnd",(function(t){r.endEvent=t,r.box.style.display="none",r.emit("selectend",r.getLngLatBox(),r.startEvent,r.endEvent)})),r.scene=t,r.options=i,r}return Te(n,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var e=ri("div",void 0,this.container);e.classList.add("l7-select-box"),t&&e.classList.add(t),e.style.display="none",this.box=e}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,e=t.x,n=t.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(e,i),s=Math.min(n,o),u=Math.abs(e-i),l=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(l,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,e=t.lng,n=t.lat,r=this.endEvent.lngLat,i=r.lng,o=r.lat;return vi(function(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}([Ft([[e,n],[i,o]])]))}}]),n}(Oi.exports.EventEmitter),AB=function(){function t(e){Ee(this,t);var n,r=e.id,i=e.map,o=e.canvas,a=e.hasBaseMap,s=function(){var t=new ku.Container;return t.parent=ry,t.bind(Hh.SceneID).toConstantValue("".concat(ay++)),t.bind(Hh.IShaderModuleService).to(jv).inSingletonScope(),t.bind(Hh.ILayerService).to(Hf).inSingletonScope(),t.bind(Hh.IDebugService).to(ef).inSingletonScope(),t.bind(Hh.ISceneService).to(Pv).inSingletonScope(),t.bind(Hh.ICameraService).to(vp).inSingletonScope(),t.bind(Hh.ICoordinateSystemService).to($p).inSingletonScope(),t.bind(Hh.IInteractionService).to(Cf).inSingletonScope(),t.bind(Hh.IPickingService).to(Bf).inSingletonScope(),t.bind(Hh.IControlService).to(Ap).inSingletonScope(),t.bind(Hh.IMarkerService).to(Tp).inSingletonScope(),t.bind(Hh.IIconService).to(dp).inSingletonScope(),t.bind(Hh.IFontService).to(lp).inSingletonScope(),t.bind(Hh.IPopupService).to(Cp).inSingletonScope(),t.bind(Hh.INormalPass).to(Qv).whenTargetNamed("clear"),t.bind(Hh.INormalPass).to(lm).whenTargetNamed("pixelPicking"),t.bind(Hh.INormalPass).to(Qm).whenTargetNamed("render"),t.bind(Hh.INormalPass).to(ny).whenTargetNamed("taa"),t.bind(Hh.IFactoryNormalPass).toFactory((function(t){return function(e){return t.container.getNamed(Hh.INormalPass,e)}})),t.bind(Hh.IPostProcessingPass).to(Am).whenTargetNamed("copy"),t.bind(Hh.IPostProcessingPass).to(fm).whenTargetNamed("bloom"),t.bind(Hh.IPostProcessingPass).to(mm).whenTargetNamed("blurH"),t.bind(Hh.IPostProcessingPass).to(_m).whenTargetNamed("blurV"),t.bind(Hh.IPostProcessingPass).to(Om).whenTargetNamed("noise"),t.bind(Hh.IPostProcessingPass).to(Gm).whenTargetNamed("sepia"),t.bind(Hh.IPostProcessingPass).to(wm).whenTargetNamed("colorHalftone"),t.bind(Hh.IPostProcessingPass).to(km).whenTargetNamed("hexagonalPixelate"),t.bind(Hh.IPostProcessingPass).to(Pm).whenTargetNamed("ink"),t.bind(Hh.IFactoryPostProcessingPass).toFactory((function(t){return function(e){var n=t.container.getNamed(Hh.IPostProcessingPass,e);return n.setName(e),n}})),t}();this.container=s,i.setContainer(s,r,o,a),s.bind(Hh.IRendererService).to(yB).inSingletonScope(),this.sceneService=s.get(Hh.ISceneService),this.mapService=s.get(Hh.IMapService),this.iconService=s.get(Hh.IIconService),this.fontService=s.get(Hh.IFontService),this.controlService=s.get(Hh.IControlService),this.layerService=s.get(Hh.ILayerService),this.debugService=s.get(Hh.IDebugService),this.debugService.setEnable(e.debug),this.markerService=s.get(Hh.IMarkerService),this.interactionService=s.get(Hh.IInteractionService),this.popupService=s.get(Hh.IPopupService),this.boxSelect=new EB(this,{}),n=(null==e?void 0:e.isMini)||!1,Yn=n,Jn?this.sceneService.initMiniScene(e):(this.initComponent(r),this.sceneService.init(e),this.initControl())}var e,n,r,i,o;return Te(t,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:(o=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.sceneService.exportPng(e));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"exportMap",value:(i=Zt(Kt.mark((function t(e){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.sceneService.exportPng(e));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"registerRenderService",value:function(t){var e=this;this.sceneService.loaded?new t(this).init():this.on("loaded",(function(){new t(e).init()}))}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var e=this,n=sy(this.container);if(t.setContainer(n,this.container),this.sceneService.addLayer(t),t.inited){var r=this.initMask(t);this.addMask(r,t.id)}else t.on("inited",(function(){var n=e.initMask(t);e.addMask(n,t.id)}))}},{key:"initMask",value:function(t){var e=t.getLayerConfig(),n=e.mask,r=e.maskfence,i=e.maskColor,o=void 0===i?"#000":i,a=e.maskOpacity,s=void 0===a?0:a;if(n&&r)return(new JI).source(r).shape("fill").style({color:o,opacity:s})}},{key:"addMask",value:function(t,e){if(t){var n=this.getLayer(e);if(n){var r=sy(this.container);t.setContainer(r,this.container),n.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:(r=Zt(Kt.mark((function t(e,n){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layerService.remove(e,n);case 2:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"removeAllLayer",value:(n=Zt(Kt.mark((function t(){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.layerService.removeAllLayers();case 2:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,e){this.fontService.addIconFont(t,e)}},{key:"addIconFonts",value:function(t){var e=this;t.forEach((function(t){var n=$r(t,2),r=n[0],i=n[1];e.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(t,e){var n=this;this.fontService.once("fontloaded",(function(t){n.emit("fontloaded",t)})),this.fontService.addFontFace(t,e)}},{key:"addImage",value:(e=Zt(Kt.mark((function t(e,n){return Kt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Jn){t.next=5;break}return t.next=3,this.iconService.addImage(e,n);case 3:t.next=6;break;case 5:this.iconService.addImageMini(e,n,this.sceneService);case 6:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,e){this.fontService.addIconGlyphs(e)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers 已废弃，请使用 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,e){var n;SB.includes(t)?null===(n=this.boxSelect)||void 0===n||n.on(t,e):Py.includes(t)?this.sceneService.on(t,e):this.mapService.on(t,e)}},{key:"once",value:function(t,e){var n;SB.includes(t)?null===(n=this.boxSelect)||void 0===n||n.once(t,e):Py.includes(t)?this.sceneService.once(t,e):this.mapService.once(t,e)}},{key:"emit",value:function(t,e){-1===Py.indexOf(t)?this.mapService.on(t,e):this.sceneService.emit(t,e)}},{key:"off",value:function(t,e){var n;SB.includes(t)?null===(n=this.boxSelect)||void 0===n||n.off(t,e):Py.includes(t)?this.sceneService.off(t,e):this.mapService.off(t,e)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,e){return this.mapService.setCenter(t,e)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,e){this.mapService.panBy(t,e)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,e){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(t,e||It(It({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(t,e){this.mapService.setZoomAndCenter(t,e)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,e){this.container.bind(Hh.IPostProcessingPass).to(t).whenTargetNamed(e)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),e&&this.boxSelect.once("selectend",(function(){t.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){var e,n;this.controlService.init({container:(e=t,n=e,"string"==typeof e&&(n=tr.document.getElementById(e)),n)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),e=t.logoVisible,n=t.logoPosition;e&&this.addControl(new bg({position:n}))}}]),t}(),TB=function(){function t(){this._events={}}return t.prototype.on=function(t,e,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!n}),this},t.prototype.once=function(t,e){return this.on(t,e,!0)},t.prototype.emit=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this._events[t]||[],o=this._events["*"]||[],a=function(r){for(var i=r.length,o=0;o<i;o++)if(r[o]){var a=r[o],s=a.callback;a.once&&(r.splice(o,1),0===r.length&&delete e._events[t],i--,o--),s.apply(e,n)}};a(i),a(o)},t.prototype.off=function(t,e){if(t)if(e){for(var n=this._events[t]||[],r=n.length,i=0;i<r;i++)n[i].callback===e&&(n.splice(i,1),r--,i--);0===n.length&&delete this._events[t]}else delete this._events[t];else this._events={};return this},t.prototype.getEvents=function(){return this._events},t}();function CB(t){_B||(_B=document.createElement("table"),xB=document.createElement("tr"),bB=/^\s*<(\w+|!)[^>]*>/,wB={tr:document.createElement("tbody"),tbody:_B,thead:_B,tfoot:_B,td:xB,th:xB,"*":document.createElement("div")});var e=bB.test(t)&&RegExp.$1;e&&e in wB||(e="*");var n=wB[e];t="string"==typeof t?t.replace(/(^\s*)|(\s*$)/g,""):t,n.innerHTML=""+t;var r=n.childNodes[0];return r&&n.contains(r)&&n.removeChild(r),r}function kB(t,e){if(t)for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n]);return t}var MB,IB='\n  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",\n  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",\n  SimSun, "sans-serif"',PB="l7plot-tooltip",LB="l7plot-tooltip__title",RB="l7plot-tooltip__list",OB="l7plot-tooltip__list-item",DB="l7plot-tooltip__name",NB="l7plot-tooltip__value",zB='<div class="'.concat(PB,'">\n  <div class="').concat(LB,'"></div>\n  <ul class="').concat(RB,'"></ul>\n</div>'),FB='<li class="'.concat(OB,'" data-index={index}>\n  <span class="').concat(DB,'">{name}</span>\n  <span class="').concat(NB,'">{value}</span>\n</li>'),BB=((MB={})[PB]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:IB,lineHeight:"20px",padding:"10px 10px 6px 10px"},MB[LB]={marginBottom:"4px"},MB[RB]={margin:"0px",listStyleType:"none",padding:"0px"},MB[OB]={listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},MB[DB]={},MB[NB]={marginLeft:"30px"},MB);function UB(t){for(var e=t.childNodes,n=e.length-1;n>=0;n--)t.removeChild(e[n])}var jB,VB,GB=function(){function t(t){this.destroyed=!1,this.options=b({},this.getDefaultOptions(),t),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}return t.prototype.getDefaultOptions=function(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}},t.prototype.getContainer=function(){return this.container},t.prototype.getParentContainer=function(){var t,e=this.options.parent;if(!e)return t;if(f(e)){var n=document.getElementById(e);if(!n)throw new Error("No parent id ".concat(e));t=n}else t=e;return t},t.prototype.initContainer=function(){var t=this.createDom(this.options.containerTpl),e=this.getParentContainer();return e&&e.appendChild(t),t},t.prototype.initVisible=function(){this.options.visible?this.show():this.hide()},t.prototype.initCapture=function(){this.setCapture(this.options.capture)},t.prototype.update=function(t){this.options=b({},this.options,t),this.updateInner(t),this.afterUpdate(t)},t.prototype.updateInner=function(t){t.domStyles&&this.applyStyles()},t.prototype.afterUpdate=function(t){t.capture&&this.setCapture(t.capture)},t.prototype.setCapture=function(t){var e=t?"auto":"none";this.container.style.pointerEvents=e},t.prototype.applyStyles=function(){var t=this.options.domStyles;if(t){var e=this.container;this.applyChildrenStyles(e,t);var n,r=this.options.className;if(r&&(n=r,e.className.match(new RegExp("(\\s|^)".concat(n,"(\\s|$)")))))kB(e,t[r])}},t.prototype.applyChildrenStyles=function(t,e){c(e,(function(e,n){c(t.getElementsByClassName(n),(function(t){kB(t,e)}))}))},t.prototype.applyStyle=function(t,e){var n=this.options.domStyles;n&&kB(e,n[t])},t.prototype.createDom=function(t){return void 0===t&&(t="<div></div>"),CB(t)},t.prototype.removeDom=function(){var t=this.container;t&&t.parentNode&&t.parentNode.removeChild(t)},t.prototype.destroy=function(){this.removeEvent(),this.removeDom(),this.destroyed=!0},t}(),HB=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k(e,t),e.prototype.getDefaultOptions=function(){return b({},t.prototype.getDefaultOptions.call(this),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:zB,itemTpl:FB,domStyles:BB,className:PB})},e.prototype.initContainer=function(){var e=this.options.customContent;if(e){var n=this.getHtmlContentNode(e),r=this.getParentContainer();return r&&r.appendChild(n),n}return t.prototype.initContainer.call(this)},e.prototype.initDom=function(){this.cacheDoms()},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(LB)[0],n=t.getElementsByClassName(RB)[0];this.titleDom=e,this.listDom=n},e.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},e.prototype.show=function(){var t=this.container;t&&!this.destroyed&&kB(t,{visibility:"visible"})},e.prototype.hide=function(){var t=this.container;t&&!this.destroyed&&kB(t,{visibility:"hidden"})},e.prototype.updateInner=function(e){this.options.customContent?this.renderCustomContent(this.options.customContent):(e.title&&this.resetTitle(),e.items&&this.renderItems()),t.prototype.updateInner.call(this,e)},e.prototype.renderCustomContent=function(t){var e=this.container.parentNode,n=this.getHtmlContentNode(t),r=this.container;e&&e.replaceChild(n,r),this.container=n,this.applyStyles()},e.prototype.getHtmlContentNode=function(t){var e=t(this.options.title||"",this.options.items);return f(e)?this.createDom(e):e},e.prototype.resetTitle=function(){var t=this.options.title;this.options.showTitle&&t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},e.prototype.showTitle=function(){var t=this.titleDom;t&&kB(t,{display:"block"})},e.prototype.hideTitle=function(){var t=this.titleDom;t&&kB(t,{display:"none"})},e.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},e.prototype.renderItems=function(){var t=this;this.clearItemDoms();var e=this.options.items,n=this.options.itemTpl||FB,r=this.listDom;r&&(e.forEach((function(e){var i=I({},e),o=m(n,i),a=t.createDom(o);r.appendChild(a)})),this.applyChildrenStyles(r,this.options.domStyles))},e.prototype.clearItemDoms=function(){this.listDom&&UB(this.listDom)},e.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},e}(GB),WB="l7plot-legend l7plot-legend__category",ZB="l7plot-legend__title",qB="l7plot-legend__category-list",XB="l7plot-legend__list-item",YB="l7plot-legend__category-marker",KB="l7plot-legend__category-value",QB='<div class="'.concat(WB,'">\n  <div class="').concat(ZB,'"></div>\n  <ul class="').concat(qB,'"></ul>\n</div>'),JB='<li class="'.concat(XB,'" data-index={index}>\n  <span class="').concat(YB,'" style="background:{color}"></span>\n  <span class="').concat(KB,'">{value}</span>\n</li>'),$B=((jB={})[WB]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:IB,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},jB[ZB]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},jB[qB]={margin:"0px",listStyleType:"none",padding:"0px"},jB[XB]={listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},jB[YB]={width:"10px",height:"10px"},jB[KB]={paddingLeft:"8px"},jB),tU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k(e,t),e.prototype.getDefaultOptions=function(){return b({},t.prototype.getDefaultOptions.call(this),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:QB,itemTpl:JB,domStyles:$B,className:WB})},e.prototype.initContainer=function(){var e=this.options.customContent;if(e){var n=this.getHtmlContentNode(e),r=this.getParentContainer();return r&&r.appendChild(n),n}return t.prototype.initContainer.call(this)},e.prototype.initDom=function(){this.cacheDoms()},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(ZB)[0],n=t.getElementsByClassName(qB)[0];this.titleDom=e,this.listDom=n},e.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},e.prototype.show=function(){var t=this.container;t&&!this.destroyed&&kB(t,{visibility:"visible"})},e.prototype.hide=function(){var t=this.container;t&&!this.destroyed&&kB(t,{visibility:"hidden"})},e.prototype.updateInner=function(e){this.options.customContent?this.renderCustomContent(this.options.customContent):(e.title&&this.resetTitle(),e.items&&this.renderItems()),t.prototype.updateInner.call(this,e)},e.prototype.renderCustomContent=function(t){var e=this.container.parentNode,n=this.getHtmlContentNode(t),r=this.container;e&&e.replaceChild(n,r),this.container=n,this.applyStyles()},e.prototype.getHtmlContentNode=function(t){var e=t(this.options.title||"",this.options.items);return f(e)?this.createDom(e):e},e.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},e.prototype.showTitle=function(){var t=this.titleDom;t&&kB(t,{display:"block"})},e.prototype.hideTitle=function(){var t=this.titleDom;t&&kB(t,{display:"none"})},e.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},e.prototype.renderItems=function(){var t=this;this.clearItemDoms();var e=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,n=this.options.itemTpl||JB,r=this.listDom;r&&(e.forEach((function(e){var i=""===e.value?"—":Array.isArray(e.value)?e.value.join(" - "):e.value,o=I(I({},e),{value:i}),a=m(n,o),s=t.createDom(a);r.appendChild(s)})),this.applyChildrenStyles(r,this.options.domStyles))},e.prototype.clearItemDoms=function(){this.listDom&&UB(this.listDom)},e.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},e}(GB),eU="l7plot-legend l7plot-legend__continue",nU="l7plot-legend__title",rU="l7plot-legend__ribbon-container",iU="l7plot-legend__ribbon",oU="l7plot-legend__gradient-bar",aU="l7plot-legend__value-range",sU='<div class="'.concat(eU,'">\n  <div class="').concat(nU,'"></div>\n  <div class="').concat(rU,'"></div>\n</div>'),uU='<div class="'.concat(iU,'">\n  <span class="').concat(aU,'">{min}</span>\n  <div class="').concat(oU,'" style="background-image: {backgroundImage}"></div>\n  <span class="').concat(aU,'">{max}</span>\n</div>'),lU=((VB={})[eU]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:IB,padding:"10px",lineHeight:1,fontSize:"12px"},VB[nU]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},VB[iU]={display:"flex",alignItems:"center"},VB[oU]={width:"140px",height:"14px",margin:"0px 5px"},VB[aU]={padding:"0px"},VB),cU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k(e,t),e.prototype.getDefaultOptions=function(){return b({},t.prototype.getDefaultOptions.call(this),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:sU,ribbonTpl:uU,domStyles:lU,className:eU})},e.prototype.initContainer=function(){var e=this.options.customContent;if(e){var n=this.getHtmlContentNode(e),r=this.getParentContainer();return r&&r.appendChild(n),n}return t.prototype.initContainer.call(this)},e.prototype.initDom=function(){this.cacheDoms()},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(nU)[0],n=t.getElementsByClassName(rU)[0];this.titleDom=e,this.ribbonContainerDom=n},e.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())},e.prototype.show=function(){var t=this.container;t&&!this.destroyed&&kB(t,{visibility:"visible"})},e.prototype.hide=function(){var t=this.container;t&&!this.destroyed&&kB(t,{visibility:"hidden"})},e.prototype.updateInner=function(e){this.options.customContent?this.renderCustomContent(this.options.customContent):(e.title&&this.resetTitle(),e.colors&&this.renderRibbon()),t.prototype.updateInner.call(this,e)},e.prototype.renderCustomContent=function(t){var e=this.container.parentNode,n=this.getHtmlContentNode(t),r=this.container;e&&e.replaceChild(n,r),this.container=n,this.applyStyles()},e.prototype.getHtmlContentNode=function(t){var e=t(this.options.title||"",this.options.min,this.options.max,this.options.colors);return f(e)?this.createDom(e):e},e.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},e.prototype.showTitle=function(){var t=this.titleDom;t&&kB(t,{display:"block"})},e.prototype.hideTitle=function(){var t=this.titleDom;t&&kB(t,{display:"none"})},e.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},e.prototype.renderRibbon=function(){this.clearRibbonContainerDoms();var t=this.options,e=t.min,n=t.max,r=t.colors,i=t.ribbonTpl,o=void 0===i?uU:i,a=this.ribbonContainerDom;if(a){var s=m(o,{min:e,max:n,backgroundImage:"linear-gradient(to right, ".concat(r.join(", "),")")}),u=this.createDom(s);a.appendChild(u),this.applyChildrenStyles(a,this.options.domStyles)}},e.prototype.clearRibbonContainerDoms=function(){this.ribbonContainerDom&&UB(this.ribbonContainerDom)},e.prototype.clear=function(){this.setTitle(""),this.clearRibbonContainerDoms()},e}(GB),hU=function(t){function e(e){var n=t.call(this,e)||this;return n.legendComponents=[],n.options=e,n.legendComponents=n.initLegendComponents(e.items),n}return k(e,t),e.prototype.initLegendComponents=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];if("category"===r.type){var i=new tU({title:r.options.title,items:r.options.items,className:r.options.className,customContent:r.options.customContent,domStyles:r.options.domStyles});e.push(i)}else if("continue"===r.type){i=new cU({title:r.options.title,min:r.options.min,max:r.options.max,colors:r.options.colors,className:r.options.className,customContent:r.options.customContent,domStyles:r.options.domStyles});e.push(i)}}return e},e.prototype.getDefaultOptions=function(){return{position:"bottomleft"}},e.prototype.onAdd=function(){var t=window.document.createElement("div");return t.className="l7plot-legend-container",this.legendComponents.forEach((function(e){var n=e.getContainer();t.appendChild(n)})),t},e.prototype.onRemove=function(){this.legendComponents.forEach((function(t){t.destroy()}))},e}(cg),pU="object"==typeof global&&global&&global.Object===Object&&global,fU="object"==typeof self&&self&&self.Object===Object&&self,dU=pU||fU||Function("return this")(),vU=dU.Symbol,mU=Object.prototype,yU=mU.hasOwnProperty,gU=mU.toString,_U=vU?vU.toStringTag:void 0;var xU=Object.prototype.toString;var bU="[object Null]",wU="[object Undefined]",SU=vU?vU.toStringTag:void 0;function EU(t){return null==t?void 0===t?wU:bU:SU&&SU in Object(t)?function(t){var e=yU.call(t,_U),n=t[_U];try{t[_U]=void 0;var r=!0}catch(t){}var i=gU.call(t);return r&&(e?t[_U]=n:delete t[_U]),i}(t):function(t){return xU.call(t)}(t)}var AU="[object Symbol]";function TU(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&EU(t)==AU}var CU=Array.isArray,kU=1/0,MU=vU?vU.prototype:void 0,IU=MU?MU.toString:void 0;function PU(t){if("string"==typeof t)return t;if(CU(t))return function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}(t,PU)+"";if(TU(t))return IU?IU.call(t):"";var e=t+"";return"0"==e&&1/t==-kU?"-0":e}var LU=/\s/;var RU=/^\s+/;function OU(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&LU.test(t.charAt(e)););return e}(t)+1).replace(RU,""):t}function DU(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var NU=NaN,zU=/^[-+]0x[0-9a-f]+$/i,FU=/^0b[01]+$/i,BU=/^0o[0-7]+$/i,UU=parseInt;function jU(t){if("number"==typeof t)return t;if(TU(t))return NU;if(DU(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=DU(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=OU(t);var n=FU.test(t);return n||BU.test(t)?UU(t.slice(2),n?2:8):zU.test(t)?NU:+t}var VU=1/0,GU=17976931348623157e292;function HU(t){var e=function(t){return t?(t=jU(t))===VU||t===-VU?(t<0?-1:1)*GU:t==t?t:0:0===t?t:0}(t),n=e%1;return e==e?n?e-n:e:0}var WU="[object AsyncFunction]",ZU="[object Function]",qU="[object GeneratorFunction]",XU="[object Proxy]";var YU=dU["__core-js_shared__"],KU=function(){var t=/[^.]+$/.exec(YU&&YU.keys&&YU.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var QU=Function.prototype.toString;var JU=/^\[object .+?Constructor\]$/,$U=Function.prototype,tj=Object.prototype,ej=$U.toString,nj=tj.hasOwnProperty,rj=RegExp("^"+ej.call(nj).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ij(t){if(!DU(t)||(e=t,KU&&KU in e))return!1;var e,n=function(t){if(!DU(t))return!1;var e=EU(t);return e==ZU||e==qU||e==WU||e==XU}(t)?rj:JU;return n.test(function(t){if(null!=t){try{return QU.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function oj(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return ij(n)?n:void 0}var aj=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,sj=/^\w*$/;var uj=oj(Object,"create");var lj=Object.prototype.hasOwnProperty;var cj=Object.prototype.hasOwnProperty;function hj(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function pj(t,e){for(var n,r,i=t.length;i--;)if((n=t[i][0])===(r=e)||n!=n&&r!=r)return i;return-1}hj.prototype.clear=function(){this.__data__=uj?uj(null):{},this.size=0},hj.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},hj.prototype.get=function(t){var e=this.__data__;if(uj){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return lj.call(e,t)?e[t]:void 0},hj.prototype.has=function(t){var e=this.__data__;return uj?void 0!==e[t]:cj.call(e,t)},hj.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=uj&&void 0===e?"__lodash_hash_undefined__":e,this};var fj=Array.prototype.splice;function dj(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}dj.prototype.clear=function(){this.__data__=[],this.size=0},dj.prototype.delete=function(t){var e=this.__data__,n=pj(e,t);return!(n<0)&&(n==e.length-1?e.pop():fj.call(e,n,1),--this.size,!0)},dj.prototype.get=function(t){var e=this.__data__,n=pj(e,t);return n<0?void 0:e[n][1]},dj.prototype.has=function(t){return pj(this.__data__,t)>-1},dj.prototype.set=function(t,e){var n=this.__data__,r=pj(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var vj=oj(dU,"Map");function mj(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function yj(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}yj.prototype.clear=function(){this.size=0,this.__data__={hash:new hj,map:new(vj||dj),string:new hj}},yj.prototype.delete=function(t){var e=mj(this,t).delete(t);return this.size-=e?1:0,e},yj.prototype.get=function(t){return mj(this,t).get(t)},yj.prototype.has=function(t){return mj(this,t).has(t)},yj.prototype.set=function(t,e){var n=mj(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};var gj="Expected a function";function _j(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(gj);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(_j.Cache||yj),n}_j.Cache=yj;var xj,bj,wj,Sj=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ej=/\\(\\)?/g,Aj=(xj=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Sj,(function(t,n,r,i){e.push(r?i.replace(Ej,"$1"):n||t)})),e},bj=_j(xj,(function(t){return 500===wj.size&&wj.clear(),t})),wj=bj.cache,bj),Tj=Aj;function Cj(t){return null==t?"":PU(t)}function kj(t,e){return CU(t)?t:function(t,e){if(CU(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!TU(t))||sj.test(t)||!aj.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:Tj(Cj(t))}var Mj=1/0;function Ij(t){if("string"==typeof t||TU(t))return t;var e=t+"";return"0"==e&&1/t==-Mj?"-0":e}function Pj(t,e,n){var r=null==t?void 0:function(t,e){for(var n=0,r=(e=kj(e,t)).length;null!=t&&n<r;)t=t[Ij(e[n++])];return n&&n==r?t:void 0}(t,e);return void 0===r?n:r}var Lj=dU.isFinite,Rj=Math.min;var Oj=function(t){var e=Math[t];return function(t,n){if(t=jU(t),(n=null==n?0:Rj(HU(n),292))&&Lj(t)){var r=(Cj(t)+"e").split("e");return+((r=(Cj(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round"),Dj=Oj,Nj=(new Object).toString,zj=function(t,e){return Nj.call(t)==="[object "+e+"]"},Fj=function(t){return zj(t,"Array")},Bj=function(t){if(!function(t){return"object"==typeof t&&null!==t}(t)||!zj(t,"Object"))return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Uj=function(t,e,n,r){for(var i in n=n||0,r=r||5,e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=e[i];o?Bj(o)?(Bj(t[i])||(t[i]={}),n<r?Uj(t[i],o,n+1,r):t[i]=e[i]):Fj(o)?(t[i]=[],t[i]=t[i].concat(o)):t[i]=o:t[i]=o}},jj=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)Uj(t,e[r]);return t},Vj=["mousemove","click"],Gj=function(t){function e(e,n,r){var i=t.call(this)||this;i.currentVisible=!1,i.interactionTriggerHander=function(t){var e=t.feature,n=t.featureId,r=i.options,o=r.title,a=r.customTitle,s=r.items,u=r.customItems,l="Feature"===e.type&&e.geometry&&e.properties?e.properties:e,c=[];if(u){var h=u(e);if(!Array.isArray(h))throw new Error("customItems return array");c=h}else s&&s.forEach((function(t){if(f(t)){var e=t.split(".").pop()||t;void 0!==(r=Pj(l,t))&&c.push({name:e,value:r})}else{var r,i=t.field,o=t.alias,a=t.customValue,s=o||i.split(".").pop()||i;void 0!==(r=Pj(l,i))&&c.push({name:s,value:a?a(r,l,n):r})}}));var p={title:a?a(l):o,items:c};i.updateTooltip(t,p)},i.interactionUntriggerHander=function(){i.hideTooltip()},i.scene=e,i.interactionLayers=n,i.options=jj({},i.getDefaultOptions(),r);var o=i.options,a=o.offsets,s=o.title,u=o.showTitle,l=o.customContent,c=o.domStyles,h=o.anchor,p=o.className;return i.marker=new ug({offsets:a,anchor:h,draggable:!1}),i.tooltipComponent=new HB({title:s,showTitle:u,items:[],customContent:l,domStyles:c,className:p}),i.setComponent(),i.initInteractionEvent(),i}return k(e,t),e.prototype.getDefaultOptions=function(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:pr["TOP-LEFT"]}},e.prototype.update=function(t){this.marker.remove(),this.currentVisible=!1,this.options=jj({},this.options,t);var e=this.options,n=e.offsets,r=e.showTitle,i=e.customContent,o=e.domStyles,a=e.anchor,s=e.className;this.marker=new ug({offsets:n,anchor:a,draggable:!1}),this.tooltipComponent.update({showTitle:r,customContent:i,domStyles:o,className:s}),this.setComponent()},e.prototype.initInteractionEvent=function(){var t=this,e=this.options.trigger||"mousemove";if(!Vj.includes(e))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach((function(n){var r=n.layer;r.on(e,t.interactionTriggerHander),r.on("un".concat(e),t.interactionUntriggerHander)}))},e.prototype.unBindInteractionEvent=function(){var t=this,e=this.options.trigger||"mousemove";this.interactionLayers.forEach((function(n){var r=n.layer;r.off(e,t.interactionTriggerHander),r.off("un".concat(e),t.interactionUntriggerHander)}))},e.prototype.updateTooltip=function(t,e){var n=t.lngLat,r=t.x,i=t.y;if(this.options.showComponent&&(this.updateComponent(e),this.setPostion(n)),this.currentVisible){var o={type:"tooltip:change",data:e,lngLat:n,x:r,y:i};this.emit("tooltip:change",o)}else{this.showTooltip();var a={type:"tooltip:show",data:e,lngLat:n,x:r,y:i};this.emit("tooltip:show",a)}},e.prototype.showTooltip=function(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)},e.prototype.hideTooltip=function(){if(this.currentVisible){this.options.showComponent&&this.marker.remove(),this.currentVisible=!1;this.emit("tooltip:hide",{type:"tooltip:hide"})}},e.prototype.updateComponent=function(t){w(this.lastComponentOptions,t)||(this.tooltipComponent.update(t),this.lastComponentOptions=t)},e.prototype.setComponent=function(){var t=this.tooltipComponent.getContainer(),e=window.document.createElement("div");e.style.cursor="auto",e.style.userSelect="text",e.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(t){e.addEventListener(t,(function(t){return t.stopPropagation()}))})),e.appendChild(t),this.marker.setElement(e)},e.prototype.setPostion=function(t){this.marker.setLnglat(t)},e.prototype.destroy=function(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()},e}(TB),Hj=function(t){function e(e,n){void 0===e&&(e=[]),void 0===n&&(n={});var r=t.call(this)||this;return r.name=n.name?n.name:T("layerGroup"),r.layers=e,r}return k(e,t),e.prototype.addTo=function(t){var e=this;this.scene=t;var n=0,r=this.layers.length;this.layers.forEach((function(i){i.once("inited",(function(t){n++,e.emit("inited",t),n===r&&e.emit("inited-all")})),i.addTo(t)}))},e.prototype.hasLayer=function(t){return this.layers.some((function(e){return e===t}))},e.prototype.addLayer=function(t){var e=this;this.layers.push(t),this.scene&&(t.once("inited",(function(t){return e.emit("inited",t)})),t.addTo(this.scene))},e.prototype.removeLayer=function(t){var e=this.layers.findIndex((function(e){return e===t}));return-1!==e&&(this.layers.splice(e,1),this.scene&&t.remove(this.scene),!0)},e.prototype.getLayers=function(){return this.layers},e.prototype.getInteractionLayers=function(){return this.layers.filter((function(t){return t.interaction}))},e.prototype.getLayer=function(t){return this.layers.find((function(e){return e.layer.id===t}))},e.prototype.getLayerByName=function(t){return this.layers.find((function(e){return e.name===t}))},e.prototype.removeAllLayer=function(){var t=this;this.layers.forEach((function(e){t.scene&&e.remove(t.scene)})),this.layers=[]},e.prototype.isEmpty=function(){return 0===this.layers.length},e}(TB),Wj=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],Zj=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],qj=["inited","add","remove","dataUpdate","click","unclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick"],Xj={map:{type:t.BaseMapType.Amap},logo:!0},Yj=function(i){function o(t){var e=i.call(this)||this;return e.inited=!1,e.sceneLoaded=!1,e.layersLoaded=!1,e.loaded=!1,e.layerGroup=new Hj,e.options=jj({},e.getDefaultOptions(),t),e.lastOptions=e.options,e}return k(o,i),o.prototype.getDefaultOptions=function(){return o.DefaultOptions},o.prototype.createContainer=function(t){var e=this.options,n=e.width,r=e.height,i="string"==typeof t?document.getElementById(t):t;return i.style.position||(i.style.position="relative"),n&&(i.style.width||(i.style.width="".concat(n,"px"))),r&&(i.style.height||(i.style.height="".concat(r,"px"))),i},o.prototype.createTheme=function(){return l(this.options.theme)?jj({},lt("default"),et(this.options.theme)):lt(this.options.theme)},o.prototype.createMap=function(){var e=this.options.map?this.options.map:Xj.map,n=e.type,r=P(e,["type"]),i=Object.assign({style:this.theme.mapStyle},r);return n===t.BaseMapType.Amap?new W_(i):n===t.BaseMapType.AmapV1?new N_(i):n===t.BaseMapType.AmapV2?new W_(i):n===t.BaseMapType.Mapbox?new SC(i):new pC(i)},o.prototype.createScene=function(){var t=this.options,e=t.logo,n=t.antialias,r=t.preserveDrawingBuffer,i=y(e)?{logoVisible:e}:{logoVisible:null==e?void 0:e.visible,logoPosition:null==e?void 0:e.position},o=Object.assign({antialias:n,preserveDrawingBuffer:r},i),a=this.createMap();return new AB(I({id:this.container,map:a},o))},o.prototype.registerResources=function(){var t=this;e.size&&e.forEach((function(e,n){!t.scene.hasImage(n)&&t.scene.addImage(n,e)})),n.size&&n.forEach((function(e,n){t.scene.addFontFace(n,e)})),r.size&&r.forEach((function(e,n){t.scene.addIconFont(n,e)}))},o.prototype.update=function(t){this.updateOption(t),t.map&&!w(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.render(),this.emit("update")},o.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=jj({},this.options,t)},o.prototype.updateMap=function(t){var e;if(this.scene){var n=t.style,r=t.center,i=t.zoom,o=t.rotation,a=t.pitch;g(a)||this.scene.setPitch(a),g(o)||this.scene.setRotation(o),n&&n!==(null===(e=this.lastOptions.map)||void 0===e?void 0:e.style)&&this.scene.setMapStyle(n),i&&r&&this.scene.setZoomAndCenter(i,r)}},o.prototype.changeSize=function(t,e){this.options.width===t&&this.options.height===e||(this.container.style.width="".concat(t,"px"),this.container.style.height="".concat(e,"px"),this.options=Object.assign(this.options,{width:t,height:e}))},o.prototype.on=function(t,e,n){return this.proxyEventHander("on",t,e,n),this},o.prototype.once=function(t,e){return this.proxyEventHander("once",t,e),this},o.prototype.off=function(t,e){return this.proxyEventHander("off",t,e),this},o.prototype.proxyEventHander=function(t,e,n,r){var o=Wj.find((function(t){return t.adaptation===e}));if(o)this.scene[t](o.original,n);else if(-1!==Zj.indexOf(e))this.scene[t](e,n);else if(e.includes("Layer:")){var a=O(e.split(":"),2),s=a[0],u=a[1];if(!(this[s]&&this[s][t])||-1===qj.indexOf(u))throw new Error('No event name "'.concat(e,'"'));this[s][t](u,n)}else i.prototype[t].call(this,e,n,r)},o.prototype.getScene=function(){return this.scene},o.prototype.getMap=function(){var e,n,r,i;return(null===(e=this.options.map)||void 0===e?void 0:e.type)===t.BaseMapType.Amap||(null===(n=this.options.map)||void 0===n?void 0:n.type)===t.BaseMapType.AmapV2||(null===(r=this.options.map)||void 0===r?void 0:r.type)===t.BaseMapType.Mapbox||(null===(i=this.options.map)||void 0===i||i.type,t.BaseMapType.Map),this.scene.map},o.prototype.addLayer=function(t){this.layerGroup.addLayer(t)},o.prototype.getLayes=function(){return console.warn("Replace to use getLayers()"),this.getLayers()},o.prototype.getLayers=function(){return this.layerGroup.getLayers()},o.prototype.getLayerByName=function(t){return this.layerGroup.getLayerByName(t)},o.prototype.removeLayer=function(t){return this.layerGroup.removeLayer(t)},o.prototype.removeAllLayer=function(){this.layerGroup.removeAllLayer()},o.prototype.zoomIn=function(){this.scene.zoomIn()},o.prototype.zoomOut=function(){this.scene.zoomOut()},o.prototype.setPitch=function(t){this.scene.setPitch(t)},o.prototype.fitBounds=function(t){this.scene.fitBounds(t)},o.prototype.setMapStatus=function(t){this.scene.setMapStatus(t)},o.prototype.setBgColor=function(t){this.scene.setBgColor(t)},o.prototype.initComponents=function(){this.initControls(),this.initTooltip()},o.prototype.updateComponents=function(){this.updateControls(),this.initTooltip()},o.prototype.initControls=function(){var t=this.options,e=t.zoom,n=t.scale,r=t.layerMenu,i=t.legend;n&&this.addScaleControl(n),e&&this.addZoomControl(e),r&&this.addLayerMenuControl(r),i&&(this.addLegendControl(i),this.emit("add-legend"))},o.prototype.updateControls=function(){var t=this.options,e=t.zoom,n=t.scale,r=t.layerMenu,i=t.legend;w(this.lastOptions.zoom,e)||(e?this.updateZoomControl(e):this.removeZoomControl()),w(this.lastOptions.scale,n)||(n?this.updateScaleControl(n):this.removeScaleControl()),w(this.lastOptions.layerMenu,r)||(r?this.updateLayerMenuControl(r):this.removeLayerMenuControl()),w(this.lastOptions.legend,i)||(i?this.updateLegendControl(i):this.removeLegendControl())},o.prototype.addZoomControl=function(t){this.zoomControl||(this.zoomControl=new Tg(t),this.scene.addControl(this.zoomControl))},o.prototype.updateZoomControl=function(t){this.zoomControl?(this.removeZoomControl(),this.addZoomControl(t)):this.addZoomControl(t)},o.prototype.removeZoomControl=function(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)},o.prototype.addScaleControl=function(t){this.scaleControl||(this.scaleControl=new Sg(t),this.scene.addControl(this.scaleControl))},o.prototype.updateScaleControl=function(t){this.scaleControl?(this.removeScaleControl(),this.addScaleControl(t)):this.addScaleControl(t)},o.prototype.removeScaleControl=function(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)},o.prototype.addLayerMenuControl=function(t){this.layerGroup.getLayers().forEach((function(t){t.name,t.layer}))},o.prototype.updateLayerMenuControl=function(t){this.removeLayerMenuControl(),this.addLayerMenuControl(t)},o.prototype.removeLayerMenuControl=function(){},o.prototype.getLegendOptions=function(){return{}},o.prototype.addLegendControl=function(t){if(!this.legendControl){var e=this.theme.components.legend,n=jj({},this.getLegendOptions(),t),r=n.type,i=n.position,o=P(n,["type","position"]),a=[];if("category"===r){var s=jj({},{domStyles:e.category.domStyles},o);a.push({type:r,options:s})}else if("continue"===r){var u=jj({},{domStyles:e.continue.domStyles},o);a.push({type:r,options:u})}a.length&&(this.legendControl=new hU({position:i,items:a}),this.scene.addControl(this.legendControl))}},o.prototype.updateLegendControl=function(t){this.legendControl?(this.removeLegendControl(),this.addLegendControl(t)):this.addLegendControl(t)},o.prototype.removeLegendControl=function(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)},o.prototype.initTooltip=function(){var t=this;this.tooltip&&this.tooltip.destroy();var e=this.options.tooltip;if(e){var n=jj({},{domStyles:this.theme.components.tooltip.domStyles},e),r=this.layerGroup.getInteractionLayers();this.tooltip=new Gj(this.scene,r,n),this.tooltip.on("*",(function(e){return t.emit(e.type,e)}))}},o.prototype.exportPng=function(t){return this.scene.exportPng(t)},o.prototype.destroy=function(){var t;i.prototype.off.call(this,"*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),null===(t=this.tooltip)||void 0===t||t.destroy(),this.scene.destroy()},o.DefaultOptions=Xj,o}(TB),Kj=function(){function t(){}return t.aggregation=function(t,e){var n=e.type,r={type:void 0===n?"grid":n,size:e.radius,method:e.method,field:e.field};t.transforms?(t.transforms=t.transforms.filter((function(t){return t.type!==r.type})),t.transforms.push(r)):t.transforms=[r]},t}(),Qj=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"],Jj=function(e){function n(t){var n=e.call(this)||this;return n.options=jj({},n.getDefaultOptions(),t),n.lastOptions=n.options,n}return k(n,e),n.prototype.getDefaultOptions=function(){return{}},n.prototype.pickLayerConfig=function(t){return E(t,Qj)},n.prototype.addTo=function(t){t.addLayer(this.layer)},n.prototype.remove=function(t){t.removeLayer(this.layer)},n.prototype.update=function(t){this.updateOption(t),this.updateConfig(t)},n.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=jj({},this.options,t)},n.prototype.updateConfig=function(t){g(t.zIndex)||w(this.lastOptions.zIndex,this.options.zIndex)||this.setIndex(t.zIndex),g(t.blend)||w(this.lastOptions.blend,this.options.blend)||this.setBlend(t.blend),g(t.minZoom)||w(this.lastOptions.minZoom,this.options.minZoom)||this.setMinZoom(t.minZoom),g(t.maxZoom)||w(this.lastOptions.maxZoom,this.options.maxZoom)||this.setMinZoom(t.maxZoom),g(t.visible)||w(this.lastOptions.visible,this.options.visible)||(t.visible?this.show():this.hide())},n.prototype.render=function(){this.layer.renderLayers()},n.prototype.setSource=function(t){if(t instanceof $y)this.layer.setSource(t);else{var e=t.data,n=t.aggregation,r=P(t,["data","aggregation"]);n&&Kj.aggregation(r,n),this.layer.getSource()?this.layer.setData(e,r):this.layer.source(e,r)}},n.prototype.changeData=function(t){this.setSource(t)},n.prototype.setIndex=function(t){this.layer.setIndex(t)},n.prototype.setBlend=function(t){this.layer.setBlend(t)},n.prototype.setMinZoom=function(t){this.layer.setMinZoom(t)},n.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t)},n.prototype.show=function(){this.layer.inited&&this.layer.show()},n.prototype.hide=function(){this.layer.inited&&this.layer.hide()},n.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},n.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():this.options.visible},n.prototype.fitBounds=function(t){this.layer.fitBounds(t)},n.prototype.on=function(t,n){return-1!==qj.indexOf(t)?this.layer.on(t,n):e.prototype.on.call(this,t,n),this},n.prototype.once=function(t,n){return-1!==qj.indexOf(t)?this.layer.once(t,n):e.prototype.once.call(this,t,n),this},n.prototype.off=function(t,n){return-1!==qj.indexOf(t)?this.layer.off(t,n):e.prototype.off.call(this,t,n),this},n.LayerType=t.LayerType,n.LayerConfigkeys=Qj,n}(TB);function $j(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i={};return t.forEach((function(t,e){i[t]=n[e]})),delete i[void 0],e(i)}}var tV=function(){function t(){}return t.shape=function(e,n){if(f(n))e.shape(n);else if(s(n)){var r=[];e.shape(r.join("*"),$j(r,n))}else if(l(n)){var i=n.field?n.field:"";if(s(n.value)){r=u(i)?i:i.split("*");e.shape(i,$j(r,n.value))}else e.shape(i,n.value);f(i)&&n.scale&&t.scale(e,i,n.scale)}},t.size=function(e,n){if(a(n,"Number"))e.size(n);else if(u(n))e.size(n);else if(s(n)){var r=[];e.size(r.join("*"),$j(r,n))}else if(l(n)){var i=n.field?n.field:"";if(s(n.value)){r=u(i)?i:i.split("*");e.size(i,$j(r,n.value))}else e.size(i,n.value);f(i)&&n.scale&&t.scale(e,i,n.scale)}},t.color=function(e,n){if(f(n))e.color(n);else if(s(n)){var r=[];e.color(r.join("*"),$j(r,n))}else if(l(n)){var i=n.field?n.field:"";if(s(n.value)){r=u(i)?i:i.split("*");e.color(i,$j(r,n.value))}else e.color(i,n.value);f(i)&&n.scale&&t.scale(e,i,n.scale)}},t.style=function(t,e){e&&t.style(e)},t.state=function(t,e){var n=e.active,r=e.select;n&&t.active(n),r&&t.select(r)},t.rotate=function(t,e){f(e)||s(e)},t.texture=function(t,e){f(e)&&t.texture(e)},t.animate=function(t,e){(y(e)||l(e))&&t.animate(e)},t.scale=function(t,e,n){t.scale(e,n)},t.filter=function(t,e){var n=e.field?e.field:"",r=u(n)?n:n.split("*");t.filter(r.join("*"),$j(r,e.value))},t}();var eV={style:{fontSize:12}},nV=[],rV=function(t){function e(e){var n=t.call(this,e)||this;n.type=Jj.LayerType.TextLayer,n.interaction=!1;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||T(n.type),n.layer=new yI(I(I({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return k(e,t),e.prototype.getDefaultOptions=function(){return eV},e.prototype.mappingLayer=function(t,e){!function(t,e){var n=e.field,r=e.content,i=e.style,o=void 0===i?{}:i,a=e.state,s=o.fontSize,u=o.fill,l={field:n||r||"",value:"text"};tV.shape(t,l),s&&tV.size(t,s),u&&tV.color(t,u),o&&tV.style(t,o),a&&tV.state(t,a)}(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=eV,e.LayerOptionsKeys=Jj.LayerConfigkeys.concat(nV),e}(Jj),iV={autoFit:!1},oV=function(e){function n(t,n){var r=this;if("string"==typeof t||t instanceof Element){if(void 0===n)throw new Error("options is undefined");(r=e.call(this,n)||this).container=r.createContainer(t),r.theme=r.createTheme(),r.scene=r.createScene(),r.registerResources(),r.initSource()}else r=e.call(this,t)||this;return r}return k(n,e),n.prototype.initSource=function(){this.source=this.createSource(),this.render(),this.inited=!0},n.prototype.initLayersEvent=function(){},n.prototype.getDefaultOptions=function(){return n.DefaultOptions},n.prototype.createSource=function(){var t=this.options.source,e=t.data,n=t.aggregation,r=P(t,["data","aggregation"]);return n&&Kj.aggregation(r,n),new $y(e,r)},n.prototype.createLabelLayer=function(t,e,n){var r=n||{},i=r.visible,o=r.minZoom,a=r.maxZoom,s=r.zIndex;return new rV(I({name:"labelLayer",visible:i,minZoom:o,maxZoom:a,zIndex:(void 0===s?0:s)+.1,source:t},e))},n.prototype.updateLabelLayer=function(t,e,n,r){e?r?r.update(I({},e)):(r=this.createLabelLayer(t,e,n),this.layerGroup.addLayer(r)):!1===e&&r&&this.layerGroup.removeLayer(r)},n.prototype.render=function(){var t=this,e=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),e.addTo(this.scene),this.layerGroup=e):(this.layerGroup=e,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(function(){t.onSceneLoaded()}))),this.initLayersEvent()},n.prototype.onSceneLoaded=function(){var t=this;this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",(function(){t.onLayersLoaded()})),this.layerGroup.addTo(this.scene)},n.prototype.onLayersLoaded=function(){this.layersLoaded=!0,this.initComponents(),this.loaded=!0,this.emit("loaded")},n.prototype.attachToScene=function(t,e){this.scene=t,this.theme=e||lt("default"),this.registerResources(),this.initSource()},n.prototype.unattachFromScene=function(){var t;this.removeAllLayer(),null===(t=this.tooltip)||void 0===t||t.destroy()},n.prototype.addToScene=function(t){this.attachToScene(t)},n.prototype.removeFromScene=function(){var t;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),null===(t=this.tooltip)||void 0===t||t.destroy()},n.prototype.update=function(t){if(this.updateOption(t),t.map&&!w(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.scene.setEnableRender(!1),t.source&&!w(this.lastOptions.source,this.options.source)){var e=t.source,n=e.data,r=P(e,["data"]);this.changeData(n,r)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")},n.prototype.changeData=function(t,e){var n=this;this.options.source=jj({},this.options.source,I({data:t},e));var r=this.options.source,i=r.aggregation,o=P(r,["aggregation"]);i&&Kj.aggregation(o,i),this.source.setData(this.options.source.data,o);var a=this.options.legend;a&&setTimeout((function(){n.updateLegendControl(a)})),this.emit("change-data")},n.DefaultOptions=iV,n.PlotType=t.PlotType,n}(Yj),aV=jj({},oV.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}});var sV=function(t){return function(t){return!Array.isArray(t[0].value)}(t)?t:t.map((function(t){return I(I({},t),{value:[Dj(t.value[0],2),Dj(t.value[1],2)]})}))},uV={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"circle",size:12,color:"#5FD3A6"},lV=["shape","color","size","style","state","animate"],cV=function(t){function e(e){var n=t.call(this,e)||this;n.type=Jj.LayerType.DotLayer,n.interaction=!0;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||T(n.type),n.layer=new yI(I(I({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return k(e,t),e.prototype.getDefaultOptions=function(){return uV},e.prototype.mappingLayer=function(t,e){!function(t,e){var n=e.shape,r=e.color,i=e.size,o=e.style,a=e.state,s=e.animate;n&&tV.shape(t,n),i&&tV.size(t,i),r&&tV.color(t,r),o&&tV.style(t,o),a&&tV.state(t,a),s&&tV.animate(t,s)}(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?sV(t):[]},e.DefaultOptions=uV,e.LayerOptionsKeys=Jj.LayerConfigkeys.concat(lV),e}(Jj),hV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=oV.PlotType.Dot,e}return k(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.dotLayer=new cV(I({source:t},E(this.options,cV.LayerOptionsKeys)));var e=new Hj([this.dotLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=E(t,cV.LayerOptionsKeys);this.dotLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.getLegendOptions=function(){var t=this.dotLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=aV,e}(oV),pV=jj({},oV.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}}),fV=["color","size","style","state","animate"],dV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=cV.LayerType.DotDensity,e.interaction=!1,e}return k(e,t),e.prototype.getDefaultOptions=function(){return jj({},cV.DefaultOptions,{shape:"dot",size:1})},e.LayerOptionsKeys=cV.LayerConfigkeys.concat(fV),e}(cV),vV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=oV.PlotType.DotDensity,e}return k(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){return this.dotDensityLayer=new dV(I({source:t},E(this.options,dV.LayerOptionsKeys))),new Hj([this.dotDensityLayer])},e.prototype.updateLayers=function(t){var e=E(t,dV.LayerOptionsKeys);this.dotDensityLayer.update(e)},e.DefaultOptions=pV,e}(oV),mV=jj({},oV.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}});var yV={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"heatmap",size:{value:[0,1]},style:{intensity:3,radius:20,opacity:1,colorsRamp:[{color:"rgba(33,102,172,0.0)",position:0},{color:"rgb(103,169,207)",position:.2},{color:"rgb(209,229,240)",position:.4},{color:"rgb(253,219,199)",position:.6},{color:"rgb(239,138,98)",position:.8},{color:"rgb(178,24,43,1.0)",position:1}]}},gV=["shape","color","size","style","state"],_V=function(t){function e(e){var n=t.call(this,e)||this;n.type=Jj.LayerType.HeatmapLayer,n.interaction=!1;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||T(n.type),n.layer=new qk(I(I({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return k(e,t),e.prototype.getDefaultOptions=function(){return yV},e.prototype.mappingLayer=function(t,e){!function(t,e){var n=e.shape,r=e.size,i=e.style,o=e.state;n&&tV.shape(t,n),r&&tV.size(t,r),i&&("colorsRamp"in i&&(i.rampColors=function(t){var e=t.colorsRamp,n={colors:[],positions:[]};return e.forEach((function(t){var e=t.color,r=t.position;n.colors.push(e),n.positions.push(r)})),n}(i)),tV.style(t,i)),o&&tV.state(t,o)}(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=yV,e.LayerOptionsKeys=Jj.LayerConfigkeys.concat(gV),e}(Jj),xV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=oV.PlotType.Heatmap,e}return k(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.heatmapLayer=new _V(I({source:t},E(this.options,_V.LayerOptionsKeys)));var e=new Hj([this.heatmapLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=E(t,_V.LayerOptionsKeys);this.heatmapLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.getLegendOptions=function(){var t,e=this.heatmapLayer.layer.getLegendItems("size");return Array.isArray(e)&&0!==e.length?{type:"continue",min:e[0].value,max:e[e.length-1].value,colors:null===(t=this.heatmapLayer.options.style)||void 0===t?void 0:t.colorsRamp.map((function(t){return t.color}))}:{}},e.DefaultOptions=mV,e}(oV),bV=jj({},oV.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"grid",radius:15e3,method:"sum"}}});var wV={source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"grid",field:"",radius:15e3,method:"sum"}},shape:"square",color:"#5FD3A6",style:{coverage:.9,angle:0,opacity:1}},SV=["shape","color","size","style","state"],EV=function(t){function e(e){var n=t.call(this,e)||this;n.type=Jj.LayerType.GridLayer,n.interaction=!1;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||T(n.type),n.layer=new qk(I(I({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return k(e,t),e.prototype.getDefaultOptions=function(){return wV},e.prototype.mappingLayer=function(t,e){!function(t,e){var n=e.shape,r=e.color,i=e.size,o=e.style,a=e.state;n&&tV.shape(t,n),i&&tV.size(t,i),r&&tV.color(t,r),o&&tV.style(t,o),a&&tV.state(t,a)}(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=wV,e.LayerOptionsKeys=Jj.LayerConfigkeys.concat(SV),e}(Jj),AV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=oV.PlotType.Grid,e}return k(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.gridLayer=new EV(I({source:t},E(this.options,EV.LayerOptionsKeys)));var e=new Hj([this.gridLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=E(t,EV.LayerOptionsKeys);this.gridLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.DefaultOptions=bV,e}(oV),TV=jj({},oV.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"hexagon",radius:15e3,method:"sum"}}});var CV={source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"hexagon",field:"",radius:15e3,method:"sum"}},shape:"hexagon",color:"#5FD3A6",style:{coverage:.9,angle:0,opacity:1}},kV=["shape","color","size","style","state"],MV=function(t){function e(e){var n=t.call(this,e)||this;n.type=Jj.LayerType.HexbinLayer,n.interaction=!1;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||T(n.type),n.layer=new qk(I(I({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return k(e,t),e.prototype.getDefaultOptions=function(){return CV},e.prototype.mappingLayer=function(t,e){!function(t,e){var n=e.shape,r=e.color,i=e.size,o=e.style,a=e.state;n&&tV.shape(t,n),i&&tV.size(t,i),r&&tV.color(t,r),o&&tV.style(t,o),a&&tV.state(t,a)}(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.DefaultOptions=CV,e.LayerOptionsKeys=Jj.LayerConfigkeys.concat(kV),e}(Jj),IV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=oV.PlotType.Hexbin,e}return k(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.hexbinLayer=new MV(I({source:t},E(this.options,MV.LayerOptionsKeys)));var e=new Hj([this.hexbinLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=E(t,MV.LayerOptionsKeys);this.hexbinLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.DefaultOptions=TV,e}(oV),PV=jj({},oV.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}});var LV={},RV=["shape","color","size","style","state","animate"],OV=function(t){function e(e){var n=t.call(this,e)||this;n.type=Jj.LayerType.LinesLayer,n.interaction=!0;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||T(n.type),n.layer=new TM(I(I({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return k(e,t),e.prototype.getDefaultOptions=function(){return LV},e.prototype.mappingLayer=function(t,e){!function(t,e){var n=e.shape,r=e.color,i=e.size,o=e.style,a=e.state,s=e.animate,u=e.texture;n&&tV.shape(t,n),i&&tV.size(t,i),r&&tV.color(t,r),o&&tV.style(t,o),a&&tV.state(t,a),s&&tV.animate(t,s),u&&tV.texture(t,u)}(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?sV(t):[]},e.DefaultOptions=LV,e.LayerOptionsKeys=Jj.LayerConfigkeys.concat(RV),e}(Jj),DV=["color","size","style","state","animate"],NV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=OV.LayerType.PathLayer,e}return k(e,t),e.prototype.getDefaultOptions=function(){return jj({},OV.DefaultOptions,{shape:"line"})},e.LayerOptionsKeys=OV.LayerConfigkeys.concat(DV),e}(OV),zV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=oV.PlotType.Path,e}return k(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){return this.pathLayer=new NV(I({source:t},E(this.options,NV.LayerOptionsKeys))),new Hj([this.pathLayer])},e.prototype.updateLayers=function(t){var e=E(t,NV.LayerOptionsKeys);this.pathLayer.update(e)},e.prototype.getLegendOptions=function(){var t=this.pathLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=PV,e}(oV),FV=jj({},oV.DefaultOptions,{source:{data:[],parser:{type:"json"}},shape:"arc"}),BV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=OV.LayerType.ArcLayer,e}return k(e,t),e.prototype.getDefaultOptions=function(){return jj({},OV.DefaultOptions,{shape:"arc"})},e}(OV),UV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=oV.PlotType.Flow,e}return k(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.flowLayer=new BV(I({name:"flowLayer",source:t},E(this.options,BV.LayerOptionsKeys)));var e=new Hj([this.flowLayer]);return this.options.radiation&&(this.radiationLayer=this.createRadiationLayer(t),e.addLayer(this.radiationLayer)),this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e},e.prototype.parserPointData=function(t){var e=[];return t.data.dataArray.forEach((function(t){var n=O(t.coordinates,2)[1];e.push(I(I({},t),{coordinates:n}))})),e},e.prototype.createRadiationLayer=function(t){var e=this,n=this.parserPointData(t),r=this.options.radiation||{},i=r.enabled,o=void 0===i||i,a=r.color,s=r.size,u=void 0===s?20:s,l=r.shape,c=void 0===l?"circle":l,h=r.animate,p=new cV({name:"radiationLayer",source:{data:n,parser:{type:"json",coordinates:"coordinates"}},visible:o,color:a,size:u,shape:c,animate:void 0===h||h}),f=function(){var t=e.parserPointData(e.source);p.layer.setData(t)};return t.on("update",f),p.on("remove",(function(){t.off("update",f)})),p},e.prototype.createLabelLayer=function(t,e){var n=this,r=this.parserPointData(t),i=this.options,o=i.visible,a=i.minZoom,s=i.maxZoom,u=i.zIndex,l=new rV(I({name:"labelLayer",source:{data:r,parser:{type:"json",coordinates:"coordinates"}},visible:o,minZoom:a,maxZoom:s,zIndex:(void 0===u?0:u)+.1},e)),c=function(){var t=n.parserPointData(n.source);l.layer.setData(t)};return t.on("update",c),l.on("remove",(function(){t.off("update",c)})),l},e.prototype.updateLayers=function(t){var e=E(t,BV.LayerOptionsKeys);if(this.flowLayer.update(e),t.radiation)if(this.radiationLayer){var n=I(I({},t.radiation),{visible:t.radiation.enabled});this.radiationLayer.update(n)}else this.radiationLayer=this.createRadiationLayer(this.source),this.layerGroup.addLayer(this.radiationLayer);this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.getLegendOptions=function(){var t=this.flowLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=FV,e}(oV),jV=jj({},oV.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}}),VV="#2f54eb",GV={active:{fill:!1,stroke:VV,lineWidth:1.5,lineOpacity:.8},select:{fill:!1,stroke:VV,lineWidth:1.5,lineOpacity:.8}},HV=function(t){return g(t)||(!1===t.active?GV.active=Object.assign(GV.active,{fill:!1,stroke:!1}):"object"==typeof t.active&&(!1===t.active.fill?GV.active.fill=!1:"string"==typeof t.active.fill&&(GV.active.fill=t.active.fill),!1===t.active.stroke?GV.active.stroke=!1:"string"==typeof t.active.stroke&&(GV.active.stroke=t.active.stroke),"number"==typeof t.active.lineWidth&&(GV.active.lineWidth=t.active.lineWidth),"number"==typeof t.active.lineOpacity&&(GV.active.lineOpacity=t.active.lineOpacity)),!1===t.select?GV.select=Object.assign(GV.select,{fill:!1,stroke:!1}):"object"==typeof t.select&&(!1===t.select.fill?GV.select.fill=!1:"string"==typeof t.select.fill&&(GV.select.fill=t.select.fill),!1===t.select.stroke?GV.select.stroke=!1:"string"==typeof t.select.stroke&&(GV.select.stroke=t.select.stroke),"number"==typeof t.select.lineWidth&&(GV.select.lineWidth=t.select.lineWidth),"number"==typeof t.select.lineOpacity&&(GV.select.lineOpacity=t.select.lineOpacity))),GV};var WV={visible:!0,state:{active:!1,select:!1},enabledMultiSelect:!1},ZV=["color","style","state","enabledMultiSelect"],qV=function(t){function e(e){var n=t.call(this,e)||this;n.selectData=[],n.type=Jj.LayerType.AreaLayer,n.interaction=!0,n.onHighlighHandle=function(t){var e=t.feature,r=t.featureId;n.setHighlightLayerSource(e,r)},n.onUnhighlighHandle=function(){n.setHighlightLayerSource()},n.onSelectHandle=function(t){var e=n.options.enabledMultiSelect,r=t.feature,i=t.featureId,o=_(n.selectData),a=o.findIndex((function(t){return t.featureId===i}));if(-1===a)e?o.push({feature:r,featureId:i}):o=[{feature:r,featureId:i}],n.emit("select",r,_(o));else{var s=o[a];e?o.splice(a,1):o=[],n.emit("unselect",s,_(o))}n.setSelectLayerSource(o)};var r=n.options,i=r.name,o=r.source,a=r.visible,s=r.minZoom,u=r.maxZoom,l=r.zIndex,c=void 0===l?0:l,h=n.pickLayerConfig(n.options),p=HV(n.options.state);return n.name=i||T(n.type),n.layer=new kI(I(I({},h),{name:n.name})),n.strokeLayer=new TM({name:"strokeLayer",visible:a,zIndex:c,minZoom:s,maxZoom:u}),n.highlightLayer=new TM({name:"highlightLayer",visible:a&&Boolean(p.active.stroke),zIndex:c+.1,minZoom:s,maxZoom:u}),n.selectFillLayer=new kI({name:"selectFillLayer",visible:a&&Boolean(p.select.fill),zIndex:c+.1,minZoom:s,maxZoom:u}),n.selectStrokeLayer=new TM({name:"selectStrokeLayer",visible:a&&Boolean(p.select.stroke),zIndex:c+.1,minZoom:s,maxZoom:u}),n.mappingLayer(n.options),n.setSource(o),n.initEvent(),n}return k(e,t),e.prototype.getDefaultOptions=function(){return WV},e.prototype.mappingLayer=function(t){!function(t,e,n,r,i,o){var a=o.color,s=o.style,u=o.state,l=HV(u),c={active:!1!==l.active.fill&&{color:l.active.fill},select:!1},h={opacity:null==s?void 0:s.opacity},p=null==s?void 0:s.lineWidth,f=null==s?void 0:s.stroke,d={opacity:null==s?void 0:s.lineOpacity,dashArray:null==s?void 0:s.lineDash,lineType:null==s?void 0:s.lineType};if(tV.shape(t,"fill"),a&&tV.color(t,a),h&&tV.style(t,h),c&&tV.state(t,c),tV.shape(e,"line"),p&&tV.size(e,p),f&&tV.color(e,f),d&&tV.style(e,d),l.active.stroke){var v=l.active.stroke,m=l.active.lineWidth||p,y={opacity:l.active.lineOpacity};tV.shape(n,"line"),m&&tV.size(n,m),v&&tV.color(n,v),y&&tV.style(n,y)}if(l.select.fill){var g=l.select.fill;tV.shape(r,"fill"),g&&tV.color(r,g),h&&tV.style(r,h),tV.state(r,{select:!1,active:!1})}if(l.select.stroke){var _=l.select.stroke,x=(m=l.select.lineWidth||p,{opacity:l.select.lineOpacity});tV.shape(i,"line"),m&&tV.size(i,m),_&&tV.color(i,_),x&&tV.style(i,x)}}(this.layer,this.strokeLayer,this.highlightLayer,this.selectFillLayer,this.selectStrokeLayer,t)},e.prototype.setSource=function(e){t.prototype.setSource.call(this,e),this.setStrokeLayerSource(),this.setHighlightLayerSource(),this.selectFillLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.selectStrokeLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}})},e.prototype.setStrokeLayerSource=function(){var t=this.layer.getSource();if(t)this.strokeLayer.setSource(t);else{var e=this.layer.sourceOption,n=e.data,r=e.options;this.strokeLayer.source(n,r)}},e.prototype.setHighlightLayerSource=function(t,e){if(void 0===e&&(e=-999),this.highlightLayerData!==e){var n=t?[t]:[];this.highlightLayer.setData({type:"FeatureCollection",features:n},{parser:{type:"geojson"}}),this.highlightLayerData=e}},e.prototype.setSelectLayerSource=function(t){if(void 0===t&&(t=[]),this.selectData.length!==t.length||!w(this.selectData.map((function(t){return t.featureId})),t.map((function(t){return t.featureId})))){var e=t.map((function(t){return t.feature}));this.selectFillLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectStrokeLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectData=t}},e.prototype.initEvent=function(){this.layer.off("mousemove",this.onHighlighHandle),this.layer.off("unmousemove",this.onHighlighHandle),this.layer.off("click",this.onSelectHandle),this.selectData=[],this.highlightLayerData=null,this.options.state&&(this.options.state.active&&(this.layer.on("mousemove",this.onHighlighHandle),this.layer.on("unmousemove",this.onUnhighlighHandle)),this.options.state.select&&this.layer.on("click",this.onSelectHandle))},e.prototype.addTo=function(t){t.addLayer(this.layer),t.addLayer(this.strokeLayer),t.addLayer(this.highlightLayer),t.addLayer(this.selectFillLayer),t.addLayer(this.selectStrokeLayer)},e.prototype.remove=function(t){t.removeLayer(this.layer),t.removeLayer(this.strokeLayer),t.removeLayer(this.highlightLayer),t.removeLayer(this.selectFillLayer),t.removeLayer(this.selectStrokeLayer)},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this.mappingLayer(this.options),this.options.visible){g(e.state)||w(this.lastOptions.state,this.options.state)||this.updateHighlightLayer();var n=HV(this.options.state);n.active.stroke&&this.setHighlightLayerSource(),(n.select.fill||n.select.stroke)&&this.setSelectLayerSource()}this.initEvent()},e.prototype.updateHighlightLayer=function(){var t=HV(this.options.state),e=HV(this.lastOptions.state);e.active.stroke!==t.active.stroke&&(t.active.stroke?this.highlightLayer.show():this.highlightLayer.hide()),e.select.fill!==t.select.fill&&(t.select.fill?this.selectFillLayer.show():this.selectFillLayer.hide()),e.select.stroke!==t.select.stroke&&(t.select.stroke?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())},e.prototype.setIndex=function(t){this.layer.setIndex(t),this.strokeLayer.setIndex(t),this.highlightLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1)},e.prototype.setMinZoom=function(t){this.layer.setMinZoom(t),this.strokeLayer.setMinZoom(t),this.highlightLayer.setMinZoom(t),this.selectFillLayer.setMinZoom(t),this.selectStrokeLayer.setMinZoom(t)},e.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t),this.strokeLayer.setMaxZoom(t),this.highlightLayer.setMaxZoom(t),this.selectFillLayer.setMaxZoom(t),this.selectStrokeLayer.setMaxZoom(t)},e.prototype.show=function(){this.layer.inited&&(this.layer.show(),this.strokeLayer.show(),this.selectFillLayer.show(),this.selectStrokeLayer.show())},e.prototype.hide=function(){this.layer.inited&&(this.layer.hide(),this.strokeLayer.hide(),this.selectFillLayer.hide(),this.selectStrokeLayer.hide())},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?sV(t):[]},e.prototype.setActive=function(t){},e.prototype.setSelect=function(t){},e.DefaultOptions=WV,e.LayerOptionsKeys=Jj.LayerConfigkeys.concat(ZV),e}(Jj),XV=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=oV.PlotType.Area,e}return k(e,t),e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.createLayers=function(t){this.areaLayer=new qV(I({source:t},E(this.options,qV.LayerOptionsKeys)));var e=new Hj([this.areaLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e},e.prototype.updateLayers=function(t){var e=E(t,qV.LayerOptionsKeys);this.areaLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.initLayersEvent=function(){},e.prototype.getLegendOptions=function(){var t=this.areaLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.DefaultOptions=jV,e}(oV),YV=new Map;var KV=jj({},oV.DefaultOptions,{source:{data:[],joinBy:{geoField:"adcode"}},viewLevel:{level:"country",adcode:"100000"},chinaBorder:!0}),QV={world:"country",country:"province",province:"city",city:"district",district:"district"},JV="https://gw.alipayobjects.com/os/alisis/geo-data-v0.1.2",$V="".concat(JV,"/choropleth-data"),tG={national:{color:"red",width:1,opacity:1},dispute:{color:"red",width:1,opacity:.8,dashArray:[2,4]},coast:{color:"blue",width:.7,opacity:.8},hkm:{color:"gray",width:.7,opacity:.8,dashArray:[2,4]}};function eG(t){return t}function nG(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,o=function(t,e){var n=function(t){if(null==t)return eG;var e,n,r=t.scale[0],i=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=n=0);var u=2,l=t.length,c=new Array(l);for(c[0]=(e+=t[0])*r+o,c[1]=(n+=t[1])*i+a;u<l;)c[u]=t[u],++u;return c}}(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],o=0,a=i.length;o<a;++o)e.push(n(i[o],o));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,a)}function o(t){return n(t)}function a(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function u(t){return t.map(s)}function l(t){var e,n=t.type;switch(n){case"GeometryCollection":return{type:n,geometries:t.geometries.map(l)};case"Point":e=o(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(o);break;case"LineString":e=a(t.arcs);break;case"MultiLineString":e=t.arcs.map(a);break;case"Polygon":e=u(t.arcs);break;case"MultiPolygon":e=t.arcs.map(u);break;default:return null}return{type:n,coordinates:e}}return l(e)}(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:n,properties:i,geometry:o}:{type:"Feature",id:n,bbox:r,properties:i,geometry:o}}var rG=function(t){try{return e=t,"string"==typeof(n="json")&&(n=e.objects[n]),"GeometryCollection"===n.type?{type:"FeatureCollection",features:n.geometries.map((function(t){return nG(e,t)}))}:nG(e,n)}catch(t){throw new Error('Failed convert to geojson from topojson, topojson default layer name "json"')}var e,n},iG=function(t){return E(t,["source","color","style","state","label","tooltip"])},oG=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=oV.PlotType.Choropleth,e.chinaBoundaryData={type:"FeatureCollection",features:[]},e.currentDistrictData={type:"FeatureCollection",features:[]},e.drillSteps=[],e.drillStacks=[],e.onDrillDownHander=function(t){var n,r=e.options.drill,i=r.steps,o=r.onDown,a=null===(n=t.feature)||void 0===n?void 0:n.properties,s=a.adcode;if(e.drillStacks.length!==i.length+1){var u=e.drillStacks.slice(-1)[0],l=e.drillStacks.length-1,c=e.drillSteps[l],h=c.level,p=c.granularity,f=void 0===p?QV[h]:p,d=P(c,["level","granularity"]),v={nativeEvent:!0,from:{level:u.level,adcode:u.adcode,granularity:u.granularity},to:{level:h,adcode:s,granularity:f,properties:a}},m=function(t){void 0===t&&(t={});var n={level:h,adcode:s,granularity:f},r=jj({},d,t);e.changeView(n,r).then((function(t){t&&(e.drillStacks.push(t),e.emit("drilldown",v))}))};o?o(v.from,v.to,m):m()}},e.onDrillUpHander=function(){var t=e.options.drill.onUp;if(!(0===e.drillStacks.length||1===e.drillStacks.length)){var n=e.drillStacks.length-1,r=e.drillStacks[n],i=e.drillStacks[n-1],o={nativeEvent:!0,from:{level:r.level,adcode:r.adcode,granularity:r.granularity},to:{level:i.level,adcode:i.adcode,granularity:i.granularity}},a=function(t){void 0===t&&(t={});var n=o.to,r=jj({},i.config,t);e.changeView(n,r).then((function(t){t&&(e.drillStacks.pop(),e.emit("drillup",o))}))};t?t(o.from,o.to,a):a()}},e}return k(e,t),e.prototype.initSource=function(){var t=this;this.getInitDistrictData().then((function(){t.source=t.createSource(),t.render(),t.inited=!0}))},e.prototype.render=function(){var t=this;if(this.inited)this.scene.setEnableRender(!0),this.scene.render();else{var e=this.createLayers(this.source);this.layerGroup=e,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(function(){t.onSceneLoaded()})),this.initLayersEvent()}},e.prototype.update=function(t){var e,n,r,i=this;if(this.updateOption(t),t.map&&!w(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),t.drill&&!1!==t.drill.enabled&&!w(null===(e=this.lastOptions.drill)||void 0===e?void 0:e.steps,null===(n=this.options.drill)||void 0===n?void 0:n.steps)&&(this.drillReset(),this.initDrillEvent()),this.scene.setEnableRender(!1),t.viewLevel&&!w(this.lastOptions.viewLevel,this.options.viewLevel)){var o=null===(r=t.source)||void 0===r?void 0:r.joinBy.geoData;this.getDistrictData(o).then((function(){var e=i.options.source,n=e.data,r=P(e,["data"]);i.changeData(n,r),i.updateLayers(t),i.render(),i.updateComponents(),i.emit("update")}))}else{if(t.source&&!w(this.lastOptions.source,this.options.source)){var a=this.options.source,s=a.data,u=P(a,["data"]);this.changeData(s,u)}this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")}},e.prototype.getDefaultOptions=function(){return e.DefaultOptions},e.prototype.parserSourceConfig=function(t){var e=t.data,n=t.joinBy,r=P(t,["data","joinBy"]),i=n.sourceField,o=n.geoField,a=n.geoData,s={type:"join",sourceField:i,targetField:o,data:e};return r.transforms?r.transforms.push(s):r.transforms=[s],r.parser&&delete r.parser,{data:a,sourceCFG:r}},e.prototype.createSource=function(){var t=this.parserSourceConfig(this.options.source),e=t.data,n=t.sourceCFG;return new $y(e,n)},e.prototype.changeData=function(t,e){var n=this;this.options.source=jj({},this.options.source,I({data:t},e));var r=this.parserSourceConfig(this.options.source),i=r.data,o=r.sourceCFG;this.source.setData(i,o);var a=this.options.legend;a&&setTimeout((function(){n.updateLegendControl(a)})),this.emit("change-data")},e.prototype.createLayers=function(t){this.fillAreaLayer=new qV(I({name:"fillAreaLayer",source:t},E(this.options,qV.LayerOptionsKeys)));var e=new Hj([this.fillAreaLayer]);this.options.chinaBorder&&this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options).forEach((function(t){return e.addLayer(t)}));return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e},e.prototype.createCountryBoundaryLayer=function(t,e){var n=function(t,e){var n=e||{},r=n.visible,i=n.minZoom,o=n.maxZoom,a=n.zIndex,s=void 0===a?0:a,u=n.chinaBorder,l="object"==typeof u?jj({},tG,u):tG,c=t.features.filter((function(t){var e=t.properties;return["coast","national"].includes(null==e?void 0:e.type)})),h=t.features.filter((function(t){var e=t.properties;return"dispute"===(null==e?void 0:e.type)})),p=t.features.filter((function(t){var e=t.properties;return"hkm"===(null==e?void 0:e.type)})),f=new NV({name:"chinaBoundaryLayer",visible:r,minZoom:i,maxZoom:o,zIndex:s+.1,source:{data:{type:"FeatureCollection",features:c},parser:{type:"geojson"}},color:{field:"type",value:function(t){var e=t.type;return l[e].color}},size:{field:"type",value:function(t){var e=t.type;return l[e].width}},style:{opacity:l.national.opacity}});return{chinaBoundaryLayer:f,chinaHkmBoundaryLayer:new NV({name:"chinaHkmBoundaryLayer",visible:r,minZoom:i,maxZoom:o,zIndex:s+.1,source:{data:{type:"FeatureCollection",features:p},parser:{type:"geojson"}},color:l.hkm.color,size:l.hkm.width,style:{opacity:l.hkm.opacity,lineType:"dash",dashArray:l.hkm.dashArray}}),chinaDisputeBoundaryLayer:new NV({name:"chinaDisputeBoundaryLayer",visible:r,minZoom:i,maxZoom:o,zIndex:s+.1,source:{data:{type:"FeatureCollection",features:h},parser:{type:"geojson"}},color:l.dispute.color,size:l.dispute.width,style:{opacity:l.dispute.opacity,lineType:"dash",dashArray:l.dispute.dashArray}})}}(t,e),r=n.chinaBoundaryLayer,i=n.chinaHkmBoundaryLayer,o=n.chinaDisputeBoundaryLayer;return this.chinaBoundaryLayer=r,this.chinaHkmBoundaryLayer=i,this.chinaDisputeBoundaryLayer=o,[r,i,o]},e.prototype.createLabelLayer=function(t,e){var n=this,r=t.originData.features.map((function(t){var e=t.properties;return Object.assign({},e,{centroid:e.centroid||e.center})})).filter((function(t){return t.centroid})),i=this.options,o=i.visible,a=i.minZoom,s=i.maxZoom,u=i.zIndex,l=void 0===u?0:u,c=new rV(I({name:"labelLayer",source:{data:r,parser:{type:"json",coordinates:"centroid"},transforms:t.transforms},visible:o,minZoom:a,maxZoom:s,zIndex:l+.1},e)),h=function(){var e=n.source.originData.features.map((function(t){return t.properties})).filter((function(t){return t.centroid}));c.layer.setData(e,{transforms:t.transforms})};return t.on("update",h),c.on("remove",(function(){t.off("update",h)})),c},e.prototype.updateLayers=function(t){var e=this,n=E(t,qV.LayerOptionsKeys);this.fillAreaLayer.update(n);var r=function(){e.createCountryBoundaryLayer(e.chinaBoundaryData,e.options).forEach((function(t){return e.layerGroup.addLayer(t)}))},i=function(){e.chinaBoundaryLayer&&e.layerGroup.removeLayer(e.chinaBoundaryLayer),e.chinaHkmBoundaryLayer&&e.layerGroup.removeLayer(e.chinaHkmBoundaryLayer),e.chinaDisputeBoundaryLayer&&e.layerGroup.removeLayer(e.chinaDisputeBoundaryLayer)};t.chinaBorder?this.chinaBoundaryLayer?(i(),r()):r():!1===t.chinaBorder&&i(),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},e.prototype.initLayersEvent=function(){this.initDrillEvent()},e.prototype.initDrillEvent=function(){if(this.lastOptions.drill){var t=this.lastOptions.drill,e=t.triggerUp,n=void 0===e?"unclick":e,r=t.triggerDown,i=void 0===r?"click":r;this.fillAreaLayer.off(n,this.onDrillUpHander),this.fillAreaLayer.off(i,this.onDrillDownHander)}if(this.options.drill&&!1!==this.options.drill.enabled){var o=this.options.drill,a=o.steps,s=o.triggerUp,u=void 0===s?"unclick":s,l=o.triggerDown,c=void 0===l?"click":l,h=a.map((function(t){return"string"==typeof t?{level:t,granularity:QV[t]}:(t.granularity||(t.granularity=QV[t.level]),t)}));if(function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++){var r=t[n],i=r.level,o=r.granularity;if(e[n].level!==i||e[n].granularity!==o)return!1}return!0}(h,this.drillSteps)||(this.drillSteps=h,this.drillStacks=[]),!this.drillStacks.length){var p=this.options.viewLevel,f=p.level,d=p.adcode,v=p.granularity,m=void 0===v?QV[f]:v,y=iG(this.options);this.drillStacks=[{level:f,adcode:d,granularity:m,config:y}]}this.fillAreaLayer.on(u,this.onDrillUpHander),this.fillAreaLayer.on(c,this.onDrillDownHander)}},e.prototype.drillReset=function(){this.drillStacks=[]},e.prototype.getCurrentDrillSteps=function(){return this.drillStacks.map((function(t){return E(t,["level","adcode","granularity"])}))},e.prototype.getLegendOptions=function(){var t=this.fillAreaLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}},e.prototype.fetchData=function(t,e,n){return L(this,void 0,void 0,(function(){var r,i,o,a,s,u,l,c;return R(this,(function(h){switch(h.label){case 0:return r="".concat(e,"_").concat(t,"_").concat(n),p=r,(i=YV.get(p))?[2,i]:(o=function(t){var e={url:$V,type:"topojson",extension:"topo.json"};return g(t)||("string"==typeof t?e.url=t:(e.url=(null==t?void 0:t.url)||$V,e.type=t.type,e.extension="topojson"===t.type?"topo.json":"json")),e}(this.options.geoArea),a=o.url,s=o.type,u=o.extension,(c=this.options.customFetchGeoData)?[4,c({url:a,level:t,adcode:e,granularity:n,extension:u})]:[3,2]);case 1:return l=h.sent(),[3,5];case 2:return[4,fetch("".concat(a,"/").concat(t,"/").concat(r,".").concat(u))];case 3:return[4,h.sent().json()];case 4:l=h.sent(),h.label=5;case 5:return"topojson"===s&&(l=rG(l)),function(t,e){YV.set(t,e)}(r,l),[2,l]}var p}))}))},e.prototype.getInitDistrictData=function(){var t;return L(this,void 0,void 0,(function(){var e,n,r,i;return R(this,(function(o){switch(o.label){case 0:e=this.fetchData("country","100000","boundary"),n=null===(t=this.options.source)||void 0===t?void 0:t.joinBy.geoData,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Promise.all([e,this.getDistrictData(n)])];case 2:return i=O.apply(void 0,[o.sent(),1]),this.chinaBoundaryData=i[0],[3,4];case 3:throw r=o.sent(),new Error("Failed to get china boundary data，".concat(r));case 4:return[2]}}))}))},e.prototype.getDistrictData=function(t){return L(this,void 0,void 0,(function(){var e,n,r,i,o,a,s,u;return R(this,(function(l){switch(l.label){case 0:e=this.options.viewLevel,n=e.level,r=e.adcode,i=e.granularity,o=void 0===i?QV[n]:i,a=t?Promise.resolve(t):this.fetchData(n,r,o),l.label=1;case 1:return l.trys.push([1,3,,4]),s=this,[4,a];case 2:return s.currentDistrictData=l.sent(),this.options.source=jj({},this.options.source,{joinBy:{geoData:this.currentDistrictData}}),[3,4];case 3:throw u=l.sent(),new Error("Failed to get district data，".concat(u));case 4:return[2]}}))}))},e.prototype.drillDown=function(t,e){var n=this;void 0===e&&(e={});var r=this.drillStacks.slice(-1)[0],i=t.level,o=t.adcode,a=t.granularity,s={nativeEvent:!1,from:{level:r.level,adcode:r.adcode,granularity:r.granularity},to:{level:i,adcode:o,granularity:a}};this.changeView(t,e).then((function(t){t&&(n.drillStacks.push(t),n.emit("drilldown",s))}))},e.prototype.drillUp=function(t,e){var n=this;void 0===t&&(t={});var r=this.drillStacks.length;if(![0,1].includes(r)){var i=e?this.drillStacks.findIndex((function(t){return t.level===e})):-1,o=-1!==i,a=o?i:r-2,s=this.drillStacks[a],u=s.config,l=P(s,["config"]),c=jj({},u,t),h=this.drillStacks[this.drillStacks.length-1],p={nativeEvent:!1,from:{level:h.level,adcode:h.adcode,granularity:h.granularity},to:{level:l.level,adcode:l.adcode,granularity:l.granularity}};this.changeView(l,c).then((function(t){t&&(o?n.drillStacks.splice(i+1):n.drillStacks.pop(),n.emit("drillup",p))}))}},e.prototype.changeView=function(t,e){return void 0===e&&(e={}),L(this,void 0,void 0,(function(){var n,r,i,o,a,s;return R(this,(function(u){switch(u.label){case 0:return n=t.level,r=t.adcode,i=t.granularity,o=void 0===i?QV[n]:i,[4,this.fetchData(n,r,o)];case 1:return(a=u.sent()).features.length?(s=jj({},iG(this.options),e,{viewLevel:{level:n,adcode:r,granularity:o},source:{joinBy:{geoData:a}}}),this.update(s),[2,{level:n,adcode:r,granularity:o,config:s}]):[2]}}))}))},e.DefaultOptions=KV,e.GeoDataUrl=JV,e.GeoAreaUrl=$V,e}(oV),aG=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=cV.LayerType.IconLayer,e}return k(e,t),e.prototype.getDefaultOptions=function(){return jj({},cV.DefaultOptions,{color:void 0})},e}(cV),sG=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=cV.LayerType.ColumnLayer,e}return k(e,t),e.prototype.getDefaultOptions=function(){return jj({},cV.DefaultOptions,{shape:"cylinder"})},e}(cV);var uG,lG,cG={},hG=["color","size","style","state"],pG=function(t){function e(e){var n=t.call(this,e)||this;n.type=Jj.LayerType.PrismLayer,n.interaction=!0;var r=n.options,i=r.name,o=r.source,a=n.pickLayerConfig(n.options);return n.name=i||T(n.type),n.layer=new kI(I(I({},a),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return k(e,t),e.prototype.getDefaultOptions=function(){return cG},e.prototype.mappingLayer=function(t,e){!function(t,e){var n=e.color,r=e.size,i=e.style,o=e.state;tV.shape(t,"extrude"),r&&tV.size(t,r),n&&tV.color(t,n),i&&tV.style(t,i),o&&tV.state(t,o)}(t,e)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.mappingLayer(this.layer,this.options)},e.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");return Array.isArray(t)&&0!==t.length?sV(t):[]},e.DefaultOptions=cG,e.LayerOptionsKeys=Jj.LayerConfigkeys.concat(hG),e}(Jj),fG=((uG={})[t.PlotType.Dot]=hV,uG[t.PlotType.DotDensity]=vV,uG[t.PlotType.Heatmap]=xV,uG[t.PlotType.Grid]=AV,uG[t.PlotType.Hexbin]=IV,uG[t.PlotType.Path]=zV,uG[t.PlotType.Flow]=UV,uG[t.PlotType.Area]=XV,uG[t.PlotType.Choropleth]=oG,uG),dG=((lG={})[t.LayerType.TextLayer]=rV,lG[t.LayerType.DotLayer]=cV,lG[t.LayerType.IconLayer]=aG,lG[t.LayerType.DotDensity]=dV,lG[t.LayerType.ColumnLayer]=sG,lG[t.LayerType.HeatmapLayer]=_V,lG[t.LayerType.GridLayer]=EV,lG[t.LayerType.HexbinLayer]=MV,lG[t.LayerType.PathLayer]=NV,lG[t.LayerType.ArcLayer]=BV,lG[t.LayerType.AreaLayer]=qV,lG[t.LayerType.PrismLayer]=pG,lG),vG={},mG=function(t){function e(e,n){var r=t.call(this,n)||this;return r.plots=[],r.container=r.createContainer(e),r.theme=r.createTheme(),r.scene=r.createScene(),r.registerResources(),r.render(),r.inited=!0,r}return k(e,t),e.prototype.getDefaultOptions=function(){return jj({},Yj.DefaultOptions,e.DefaultOptions)},e.prototype.createLayers=function(){for(var t=new Hj([]),e=this.options.layers||[],n=0;n<e.length;n++){var r=this.createLayer(e[n]);t.addLayer(r)}return t},e.prototype.createLayer=function(t){var e=t.type,n=P(t,["type"]),r=dG[e];if(g(r))throw new Error("Don't exist ".concat(e," layer"));return new r(n)},e.prototype.addLayer=function(e){if(function(t){return"function"==typeof t.render}(e))t.prototype.addLayer.call(this,e);else{var n=this.createLayer(e);t.prototype.addLayer.call(this,n)}},e.prototype.removeLayerByName=function(t){var e=this.layerGroup.getLayerByName(t);return!!e&&this.layerGroup.removeLayer(e)},e.prototype.updateLayers=function(t){},e.prototype.updatePlots=function(t){},e.prototype.render=function(){var t=this,e=this.createLayers();this.inited?(this.layerGroup.removeAllLayer(),e.addTo(this.scene),this.layerGroup=e,this.updateControls()):(this.layerGroup=e,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(function(){t.onSceneLoaded()})))},e.prototype.onSceneLoaded=function(){var t=this;this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",(function(){t.onLayersLoaded()})),this.layerGroup.addTo(this.scene)},e.prototype.onLayersLoaded=function(){this.layersLoaded=!0,this.renderPlots(),this.initControls(),this.loaded=!0,this.emit("loaded")},e.prototype.renderPlots=function(){for(var t=this.options.plots||[],e=0;e<t.length;e++){var n=t[e],r=this.createPlot(n);this.plots.push(r)}},e.prototype.createPlot=function(t){var e=t.type;t.legend,t.layerMenu;var n=P(t,["type","legend","layerMenu"]),r=fG[e];if(g(r))throw new Error("Don't exist ".concat(e," plot"));var i=new r(n);return i.attachToScene(this.scene,this.theme),i},e.prototype.addPlot=function(t){var e=this.createPlot(t);this.plots.push(e)},e.prototype.getPlots=function(){return this.plots},e.prototype.getPlotByName=function(t){return this.plots.find((function(e){var n;return(null===(n=e.options)||void 0===n?void 0:n.name)===t}))},e.prototype.removePlotByName=function(t){var e=this.plots.findIndex((function(e){var n;return(null===(n=e.options)||void 0===n?void 0:n.name)===t}));return-1!==e&&(O(this.plots.splice(e,1),1)[0].unattachFromScene(),!0)},e.prototype.removeAllPlot=function(){this.plots.forEach((function(t){t.unattachFromScene()})),this.plots=[]},e.DefaultOptions=vG,e}(Yj);t.ArcLayer=BV,t.Area=XV,t.AreaLayer=qV,t.Choropleth=oG,t.Dot=hV,t.DotDensity=vV,t.DotDensityLayer=dV,t.DotLayer=cV,t.Flow=UV,t.Grid=AV,t.GridLayer=EV,t.Heatmap=xV,t.HeatmapLayer=_V,t.Hexbin=IV,t.HexbinLayer=MV,t.IconLayer=aG,t.L7Plot=mG,t.Map=Yj,t.Path=zV,t.PathLayer=NV,t.Plot=oV,t.PrismLayer=pG,t.TextLayer=rV,t.TooltipAnchorType=pr,t.getTheme=lt,t.registerFontFace=function(t,e){n.set(t,e)},t.registerIconFont=function(t,e){r.set(t,e)},t.registerIconFonts=function(t){t.forEach((function(t){r.set(t.name,t.fontUnicode)}))},t.registerImage=function(t,n){e.set(t,n)},t.registerImages=function(t){t.forEach((function(t){e.set(t.id,t.image)}))},t.registerTheme=function(t,e,n){void 0===n&&(n="light"),ut[v(t)]="light"===n?et(e):nt(e)},t.unregisterFontFace=function(t){return n.delete(t)},t.unregisterIconFont=function(t){return r.delete(t)},t.unregisterImage=function(t){return e.delete(t)},t.version="0.5.5",Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=l7plot.min.js.map
